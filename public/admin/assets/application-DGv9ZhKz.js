
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * https://fantastic-admin.github.io
 */

import{_ as Ie}from"./index.vue_vue_type_script_setup_true_lang-Ddax1S58.js";import{_ as Ae}from"./index.vue_vue_type_script_setup_true_lang-FDL5yZdU.js";import{d as xe,r as f,m as S,n as J,a as ke,p as i,q as De,g as r,c as P,b as t,w as a,e as y,h as _,F as j,s as B,i as n,v as Te,x as Ue,y as Pe,z as u,t as x,A as w,B as ze,C as Ce,D as Me,E as Ge,G as z,H as X,j as Fe,_ as qe,k as Z}from"./index-TOhlAu5k.js";import{A as C}from"./app-D0kRaQvA.js";import{u as Ne}from"./utcformatTime-Bq4gDWNx.js";import{Q as he,M as $e}from"./index-BE-LteFu.js";const Se={style:{maxWidth:"350px"}},je={style:{maxHeight:"50px",cursor:"pointer"}},Be={style:{maxWidth:"350px"}},Re={style:{maxHeight:"50px",cursor:"pointer"}},Le=["src"],Ke={class:"mr-5 flex justify-end"},He=xe({__name:"application",setup(Oe){const R=f(),L=f(0),A=f(!1),M=f(!1),c=S({catId:"",name:"",status:"",role:"",page:1,size:10,isGPTs:0,gizmoID:"",isFixedModel:0,appModel:""}),K=f(`/api/upload/file?dir=${encodeURIComponent("system/app")}`),q=f(),k=f(0),D=f(!1),H=f(0),o=S({catId:"",name:"",preset:"",des:"",coverImg:"",demoData:"",order:100,status:0,isGPTs:0,gizmoID:"",isFixedModel:0,appModel:""}),E=S({catId:[{required:!0,message:"请选择App分类",trigger:"change"}],name:[{required:!0,message:"请填写App名称",trigger:"blur"}],preset:[{required:!1,message:"请填写App预设信息",trigger:"blur"}],des:[{required:!0,message:"请填写App描述",trigger:"blur"}],coverImg:[{required:!1,message:"请填写App封面图片地址",trigger:"blur"}],demoData:[{required:!1,message:"请填写App演示数据",trigger:"blur"}],isGPTs:[{required:!0,message:"是否GPTs",trigger:"blur"}],gizmoID:[{required:!1,message:"GPTs 的ID",trigger:"blur"}],order:[{required:!1,message:"请填写排序ID",trigger:"blur"}],status:[{required:!0,message:"请选择App状态",trigger:"change"}],isFixedModel:[{required:!0,message:"请选择App是否固定模型",trigger:"blur"}],appModel:[{required:!1,message:"请选择App使用的模型",trigger:"change"}]}),O=f([]),N=f([]),ee=J(()=>k.value?"更新应用":"新增应用"),le=J(()=>k.value?"确认更新":"确认新增");async function V(){try{M.value=!0;const s=await C.queryApp(c),{rows:e,count:d}=s.data;M.value=!1,L.value=d,O.value=e.sort((m,v)=>v.order-m.order)}catch{M.value=!1}}async function te(){const s=await C.queryCats({size:100}),{rows:e}=s.data;N.value=e}function ae(s){k.value=s.id,D.value=s.role==="user",H.value=s.status;const{name:e,status:d,des:m,order:v,coverImg:T,catId:U,preset:p,demoData:g,isGPTs:I,gizmoID:G,isFixedModel:F,appModel:h}=s;Ge(()=>{Object.assign(o,{name:e,status:d,des:m,order:v,coverImg:T,catId:U,preset:p,demoData:g,isGPTs:I,gizmoID:G,isFixedModel:F,appModel:h})}),A.value=!0}function oe(s){k.value=0,s==null||s.resetFields()}async function se(s){await C.deleteApp({id:s.id}),z.success("删除分类成功"),V()}function ne(s){s==null||s.resetFields(),V()}const Y=(s,e)=>{console.log("response: ",s.data),o.coverImg=s.data},re=s=>{if(["image/png","image/jpeg","image/gif","image/webp"].includes(s.type)){if(s.size/1024>300)return z.error("当前限制文件最大不超过 300KB!"),!1}else return z.error("当前系统仅支持 PNG、JPEG、GIF、和 WebP 格式的图片!"),!1};async function de(){if(o.coverImg){const s=await pe(o.coverImg);ie(s,Y)}}function ie(s,e){const d=new FormData;d.append("file",s),X.post(K.value,d,{headers:{"Content-Type":"multipart/form-data"}}).then(m=>{e(m.data)}).catch(m=>{console.error("上传失败",m)})}async function pe(s){const e=await X.get(s,{responseType:"blob"});let d="downloaded_file";const m=e.headers["content-disposition"];if(m){const v=/filename="([^"]+)"/.exec(m);v!=null&&v[1]&&(d=v[1])}else d=ue(s);return new File([e.data],d,{type:e.data.type})}function ue(s){const d=new URL(s).pathname;return d.substring(d.lastIndexOf("/")+1)}function me(s){s==null||s.validate(async e=>{if(e){if(k.value){const d={id:k.value,...o};D.value&&Object.assign(d,{status:H.value}),await C.updateApp(d),z({type:"success",message:"更新应用成功！"})}else await C.createApp(o),z({type:"success",message:"创建新的应用成功！"});A.value=!1,V()}})}return ke(()=>{V(),te()}),(s,e)=>{const d=Fe,m=qe,v=Ae,T=i("el-option"),U=i("el-select"),p=i("el-form-item"),g=i("el-input"),I=i("el-button"),G=i("el-form"),F=Ie,h=i("el-image"),b=i("el-table-column"),fe=i("el-tag"),W=i("el-tooltip"),ce=i("el-popconfirm"),ge=i("el-table"),_e=i("el-pagination"),ve=i("el-row"),$=i("el-switch"),Q=i("el-icon"),be=i("el-upload"),ye=i("el-dialog"),we=De("loading");return r(),P("div",null,[t(v,null,{title:a(()=>e[22]||(e[22]=[y("div",{class:"flex items-center gap-4"},"应用配置",-1)])),content:a(()=>e[23]||(e[23]=[y("div",{class:"text-sm/6"},[y("div",null," 应用一旦创建，可能会被多处使用，请保持规范命名分类，后续尽量变更而不是删除。 "),y("div",null," 可自行选择应用是否固定模型。GPTs 需单独在特殊模型中配置 gpts 模型，并自行搜索填写 gizmoID（例如：g-alKfVrz9K）。 ")],-1)])),default:a(()=>[t(m,{outline:"",onClick:e[0]||(e[0]=l=>A.value=!0)},{default:a(()=>[t(d,{name:"ic:baseline-plus"}),e[24]||(e[24]=_(" 新增应用 "))]),_:1})]),_:1}),t(F,null,{default:a(()=>[t(G,{ref_key:"formRef",ref:R,inline:!0,model:c},{default:a(()=>[t(p,{label:"App分类",prop:"catId"},{default:a(()=>[t(U,{modelValue:c.catId,"onUpdate:modelValue":e[1]||(e[1]=l=>c.catId=l),placeholder:"请选择App分类",clearable:"",style:{width:"160px"}},{default:a(()=>[(r(!0),P(j,null,B(n(N),l=>(r(),u(T,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(p,{label:"App名称",prop:"name"},{default:a(()=>[t(g,{modelValue:c.name,"onUpdate:modelValue":e[2]||(e[2]=l=>c.name=l),placeholder:"App名称[模糊搜索]",clearable:"",onKeydown:Te(Ue(V,["prevent"]),["enter"])},null,8,["modelValue","onKeydown"])]),_:1}),t(p,null,{default:a(()=>[t(I,{type:"primary",onClick:V},{default:a(()=>e[25]||(e[25]=[_(" 查询 ")])),_:1}),t(I,{onClick:e[3]||(e[3]=l=>ne(n(R)))},{default:a(()=>e[26]||(e[26]=[_(" 重置 ")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(F,{style:{width:"100%"}},{default:a(()=>[Pe((r(),u(ge,{border:"",data:n(O),style:{width:"100%"},size:"large"},{default:a(()=>[t(b,{prop:"coverImg",label:"应用封面",width:"100"},{default:a(l=>[t(h,{style:{height:"50px"},src:l.row.coverImg,fit:"fill"},null,8,["src"])]),_:1}),t(b,{prop:"catName",label:"应用分类",width:"100"}),t(b,{prop:"name",label:"应用名称",width:"120"}),t(b,{prop:"status",label:"应用状态",width:"100"},{default:a(l=>[t(fe,{type:l.row.status===1?"success":"danger"},{default:a(()=>[_(x(n(he)[l.row.status]),1)]),_:2},1032,["type"])]),_:1}),t(b,{prop:"order",label:"排序ID"}),e[29]||(e[29]=_(" /> ")),t(b,{prop:"preset",label:"预设信息",width:"400"},{default:a(l=>[t(W,{class:"box-item",effect:"dark",placement:"top-start"},{content:a(()=>[y("div",Se,x(l.row.preset),1)]),default:a(()=>[y("div",je,x(l.row.preset),1)]),_:2},1024)]),_:1}),t(b,{prop:"des",label:"描述信息",width:"300"},{default:a(l=>[t(W,{class:"box-item",effect:"dark",placement:"top-start"},{content:a(()=>[y("div",Be,x(l.row.des),1)]),default:a(()=>[y("div",Re,x(l.row.des),1)]),_:2},1024)]),_:1}),t(b,{prop:"createdAt",label:"创建时间",width:"120"},{default:a(l=>[_(x(n(Ne)(l.row.createdAt,"YYYY-MM-DD")),1)]),_:1}),t(b,{label:"操作",width:"200"},{default:a(l=>[l.row.role==="system"||l.row.public?(r(),u(I,{key:0,link:"",type:"primary",size:"small",onClick:Ve=>ae(l.row)},{default:a(()=>e[27]||(e[27]=[_(" 编辑 ")])),_:2},1032,["onClick"])):w("",!0),l.row.role==="system"?(r(),u(ce,{key:1,title:"确认删除此应用么?",width:"200","icon-color":"red",onConfirm:Ve=>se(l.row)},{reference:a(()=>[t(I,{link:"",type:"danger",size:"small"},{default:a(()=>e[28]||(e[28]=[_(" 删除应用 ")])),_:1})]),_:2},1032,["onConfirm"])):w("",!0)]),_:1})]),_:1},8,["data"])),[[we,n(M)]]),t(ve,{class:"mt-5 flex justify-end"},{default:a(()=>[t(_e,{"current-page":c.page,"onUpdate:currentPage":e[4]||(e[4]=l=>c.page=l),"page-size":c.size,"onUpdate:pageSize":e[5]||(e[5]=l=>c.size=l),class:"mr-5","page-sizes":[10,20,30,50],layout:"total, sizes, prev, pager, next, jumper",total:n(L),onSizeChange:V,onCurrentChange:V},null,8,["current-page","page-size","total"])]),_:1})]),_:1}),t(ye,{modelValue:n(A),"onUpdate:modelValue":e[20]||(e[20]=l=>Me(A)?A.value=l:null),"close-on-click-modal":!1,title:n(ee),width:"570",onClose:e[21]||(e[21]=l=>oe(n(q)))},{footer:a(()=>[y("span",Ke,[t(I,{onClick:e[18]||(e[18]=l=>A.value=!1)},{default:a(()=>e[30]||(e[30]=[_("取消")])),_:1}),t(I,{type:"primary",onClick:e[19]||(e[19]=l=>me(n(q)))},{default:a(()=>[_(x(n(le)),1)]),_:1})])]),default:a(()=>[t(G,{ref_key:"formPackageRef",ref:q,"label-position":"right","label-width":"100px",model:o,rules:E},{default:a(()=>[t(p,{label:"App分类",prop:"catId"},{default:a(()=>[t(U,{modelValue:o.catId,"onUpdate:modelValue":e[6]||(e[6]=l=>o.catId=l),placeholder:"请选择App分类",clearable:"",style:{width:"100%"}},{default:a(()=>[(r(!0),P(j,null,B(n(N),l=>(r(),u(T,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(p,{label:"App名称",prop:"name"},{default:a(()=>[t(g,{modelValue:o.name,"onUpdate:modelValue":e[7]||(e[7]=l=>o.name=l),placeholder:"请填写App名称"},null,8,["modelValue"])]),_:1}),n(D)?w("",!0):(r(),u(p,{key:0,label:"App状态",prop:"status"},{default:a(()=>[t($,{modelValue:o.status,"onUpdate:modelValue":e[8]||(e[8]=l=>o.status=l),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1})),t(p,{label:"App描述",prop:"des"},{default:a(()=>[t(g,{modelValue:o.des,"onUpdate:modelValue":e[9]||(e[9]=l=>o.des=l),type:"textarea",placeholder:"请填写App介绍信息、用于对外展示...",rows:4},null,8,["modelValue"])]),_:1}),n(D)?w("",!0):(r(),u(p,{key:1,label:"启用GPTs",prop:"isGPTs"},{default:a(()=>[t($,{modelValue:o.isGPTs,"onUpdate:modelValue":e[10]||(e[10]=l=>o.isGPTs=l),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1})),Number(o.isGPTs)===1?(r(),u(p,{key:2,label:"gizmoID",prop:"gizmoID"},{default:a(()=>[t(g,{modelValue:o.gizmoID,"onUpdate:modelValue":e[11]||(e[11]=l=>o.gizmoID=l),placeholder:"请填写 GPTs 使用的 gizmoID"},null,8,["modelValue"])]),_:1})):w("",!0),Number(o.isGPTs)!==1?(r(),u(p,{key:3,label:"App预设",prop:"preset"},{default:a(()=>[t(g,{modelValue:o.preset,"onUpdate:modelValue":e[12]||(e[12]=l=>o.preset=l),type:"textarea",placeholder:"请填写App预设信息、用于给AI预设身份...",rows:4},null,8,["modelValue"])]),_:1})):w("",!0),!n(D)&&Number(o.isGPTs)!==1?(r(),u(p,{key:4,label:"固定模型",prop:"isFixedModel"},{default:a(()=>[t($,{modelValue:o.isFixedModel,"onUpdate:modelValue":e[13]||(e[13]=l=>o.isFixedModel=l),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1})):w("",!0),Number(o.isFixedModel)===1&&Number(o.isGPTs)!==1?(r(),u(p,{key:5,label:"使用模型",prop:"appModel"},{default:a(()=>[t(U,{modelValue:o.appModel,"onUpdate:modelValue":e[14]||(e[14]=l=>o.appModel=l),filterable:"","allow-create":"",placeholder:"请选择应用使用的模型",clearable:""},{default:a(()=>[(r(!0),P(j,null,B(n($e),l=>(r(),u(T,{key:l,label:l,value:l},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):w("",!0),t(p,{label:"示例内容",prop:"demoData"},{default:a(()=>[t(g,{modelValue:o.demoData,"onUpdate:modelValue":e[15]||(e[15]=l=>o.demoData=l),type:"textarea",placeholder:"请填写App的demo示例数据、每换行一次表示一个新的示例...",rows:4},null,8,["modelValue"])]),_:1}),t(p,{label:"应用图标",prop:"coverImg"},{default:a(()=>[t(g,{modelValue:o.coverImg,"onUpdate:modelValue":e[16]||(e[16]=l=>o.coverImg=l),placeholder:"请填写或上传应用图标",clearable:""},{append:a(()=>[t(be,{class:"avatar-uploader",action:n(K),"show-file-list":!1,"on-success":Y,"before-upload":re,style:{display:"flex","align-items":"center","justify-content":"center"}},{default:a(()=>[o.coverImg?(r(),P("img",{key:0,src:o.coverImg,style:{"max-width":"1.5rem","max-height":"1.5rem",margin:"5px 0","object-fit":"contain"}},null,8,Le)):(r(),u(Q,{key:1,style:{width:"1rem"}},{default:a(()=>[t(n(ze))]),_:1}))]),_:1},8,["action"]),o.coverImg?(r(),u(Q,{key:0,onClick:de,style:{"margin-left":"35px",width:"1rem"}},{default:a(()=>[t(n(Ce))]),_:1})):w("",!0)]),_:1},8,["modelValue"])]),_:1}),t(p,{label:"排序ID",prop:"order"},{default:a(()=>[t(g,{modelValue:o.order,"onUpdate:modelValue":e[17]||(e[17]=l=>o.order=l),modelModifiers:{number:!0},placeholder:"请填写排序ID[数字越大越靠前]"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}});typeof Z=="function"&&Z(He);export{He as default};
