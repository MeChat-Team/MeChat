
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * https://fantastic-admin.github.io
 */

import{_ as K}from"./index.vue_vue_type_script_setup_true_lang-Ddax1S58.js";import{_ as Q}from"./index.vue_vue_type_script_setup_true_lang-FDL5yZdU.js";import{I as x,d as W,r as p,m as X,a as Z,p as n,q as E,g as u,c as b,b as e,w as a,e as ee,F as P,s as I,i as s,h as f,y as te,z as v,t as k,L as le,G as z,k as N}from"./index-TOhlAu5k.js";import{P as ae,f as oe,g as re,h as ne}from"./index-BE-LteFu.js";import{u as se}from"./utcformatTime-Bq4gDWNx.js";const O={queryAllOrder:m=>x.get("order/queryAll",{params:m}),deleteOrder:m=>x.post("order/delete",m),deleteNotPay:()=>x.post("order/deleteNotPay")},ie=W({__name:"index",setup(m){const _=p(!1),g=p(!1),V=p([]),C=p(),S=p(0),T=p(0),o=X({userId:"",platform:"",status:"",page:1,size:15}),U=p([]);async function d(){_.value=!0;try{const r=await O.queryAllOrder(o);_.value=!1;const{rows:l,count:h,total_price:c}=r.data;S.value=h,U.value=l,T.value=c}catch{_.value=!1}}async function Y(r){const l=await le.queryAllUser({size:30,username:r});V.value=l.data.rows}function L(r){r==null||r.resetFields(),d()}async function q(r){const{orderId:l}=r;await O.deleteOrder({orderId:l}),z.success("删除订单完成!"),d()}async function F(){g.value=!0;try{await O.deleteNotPay(),z.success("删除未支付订单完成!"),await d(),g.value=!1}catch{z.error("删除未支付订单失败!"),g.value=!1}}return Z(()=>{d()}),(r,l)=>{const h=Q,c=n("el-option"),A=n("el-select"),w=n("el-form-item"),y=n("el-button"),D=n("el-popconfirm"),R=n("el-form"),B=n("el-statistic"),M=K,i=n("el-table-column"),$=n("el-tag"),j=n("el-table"),G=n("el-pagination"),H=n("el-row"),J=E("loading");return u(),b("div",null,[e(h,null,{title:a(()=>l[6]||(l[6]=[ee("div",{class:"flex items-center gap-4"},"订单列表",-1)])),_:1}),e(M,{class:"flex items-start justify-between"},{default:a(()=>[e(R,{ref_key:"formRef",ref:C,inline:!0,model:o},{default:a(()=>[e(w,{label:"用户名称",prop:"userId"},{default:a(()=>[e(A,{modelValue:o.userId,"onUpdate:modelValue":l[0]||(l[0]=t=>o.userId=t),filterable:"",clearable:"",remote:"","reserve-keyword":"",placeholder:"用户姓名[模糊搜索]","remote-show-suffix":"","remote-method":Y,style:{width:"180px"}},{default:a(()=>[(u(!0),b(P,null,I(s(V),t=>(u(),v(c,{key:t.id,label:t.username,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(w,{label:"支付平台",prop:"platform"},{default:a(()=>[e(A,{modelValue:o.platform,"onUpdate:modelValue":l[1]||(l[1]=t=>o.platform=t),clearable:"",placeholder:"请选择支付平台","remote-show-suffix":"",style:{width:"160px"}},{default:a(()=>[(u(!0),b(P,null,I(s(ae),t=>(u(),v(c,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(w,{label:"支付状态",prop:"status"},{default:a(()=>[e(A,{modelValue:o.status,"onUpdate:modelValue":l[2]||(l[2]=t=>o.status=t),clearable:"",placeholder:"请选择支付状态","remote-show-suffix":"",style:{width:"160px"}},{default:a(()=>[(u(!0),b(P,null,I(s(oe),t=>(u(),v(c,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(w,null,{default:a(()=>[e(y,{type:"primary",onClick:d},{default:a(()=>l[7]||(l[7]=[f(" 查询 ")])),_:1}),e(y,{onClick:l[3]||(l[3]=t=>L(s(C)))},{default:a(()=>l[8]||(l[8]=[f(" 重置 ")])),_:1}),e(D,{title:"确认删除所有未支付订单么?",onConfirm:F},{reference:a(()=>[e(y,{type:"danger"},{default:a(()=>l[9]||(l[9]=[f(" 删除所有未支付订单 ")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"]),e(B,{title:"累计已支付订单金额",value:s(T)},null,8,["value"])]),_:1}),e(M,{style:{width:"100%"}},{default:a(()=>[te((u(),v(j,{border:"",data:s(U),style:{width:"100%"},size:"large","tooltip-options":{}},{default:a(()=>[e(i,{fixed:"",prop:"orderId",label:"订单ID",width:"315"}),e(i,{prop:"userInfo.username",label:"用户名称",width:"180"}),e(i,{prop:"userInfo.email",label:"用户邮箱",width:"200"}),e(i,{prop:"goodsInfo.name",label:"套餐名称",width:"140"}),e(i,{prop:"price",label:"商品单价",width:"110"}),e(i,{prop:"count",label:"购买数量",width:"90",align:"center"}),e(i,{prop:"total",label:"订单总价",width:"90",align:"center"}),e(i,{prop:"total",label:"支付平台",width:"90",align:"center"},{default:a(t=>[f(k(s(re)[t.row.payPlatform]),1)]),_:1}),e(i,{prop:"status",label:"支付状态",width:"90",align:"center"},{default:a(t=>[e($,{type:t.row.status===1?"success":"warning"},{default:a(()=>[f(k(s(ne)[t.row.status]),1)]),_:2},1032,["type"])]),_:1}),e(i,{prop:"createdAt",label:"订单时间",width:"200",fixed:"right"},{default:a(t=>[f(k(s(se)(t.row.createdAt,"YYYY-MM-DD hh:mm:ss")),1)]),_:1}),e(i,{fixed:"right",label:"操作"},{default:a(t=>[e(D,{title:"确认删除此订单么、删除订单不可恢复?",width:"400","icon-color":"red",onConfirm:ue=>q(t.row)},{reference:a(()=>[e(y,{link:"",type:"danger",size:"small",loading:s(g)},{default:a(()=>l[10]||(l[10]=[f(" 删除订单 ")])),_:1},8,["loading"])]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"])),[[J,s(_)]]),e(H,{class:"mt-5 flex justify-end"},{default:a(()=>[e(G,{"current-page":o.page,"onUpdate:currentPage":l[4]||(l[4]=t=>o.page=t),"page-size":o.size,"onUpdate:pageSize":l[5]||(l[5]=t=>o.size=t),class:"mr-5","page-sizes":[15,30,50,100],layout:"total, sizes, prev, pager, next, jumper",total:s(S),onSizeChange:d,onCurrentChange:d},null,8,["current-page","page-size","total"])]),_:1})]),_:1})])}}});typeof N=="function"&&N(ie);export{ie as default};
