
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * https://fantastic-admin.github.io
 */

import{_ as ve}from"./index.vue_vue_type_script_setup_true_lang-Ddax1S58.js";import{_ as ye}from"./index.vue_vue_type_script_setup_true_lang-FDL5yZdU.js";import{I as U,d as we,r as d,m as A,n as E,a as Ve,p as i,q as Pe,g as w,c as O,b as t,w as a,e as p,A as L,h as f,y as xe,i as u,z as T,t as x,F as ke,s as Ie,B as Ce,C as Se,D as Ue,E as De,G as k,H as M,j as he,_ as ze,k as R}from"./index-TOhlAu5k.js";import{Q as Ae}from"./index-BE-LteFu.js";const D={pluginList:c=>U.get("plugin/pluginList",{params:c}),delPlugin:c=>U.post("plugin/delPlugin",c),createPlugin:c=>U.post("plugin/createPlugin",c),updatePlugin:c=>U.post("plugin/updatePlugin",c)},Oe={class:"text-sm/6"};const Te={style:{maxWidth:"350px"}},$e={style:{maxHeight:"50px",cursor:"pointer"}},je=["src"],Be={class:"flex justify-end mr-5"},Fe=we({__name:"plugin",setup(c){d();const $=d(0),_=d(!1),I=d(!1),G=["dall-e-3","stable-diffusion","flux-draw","midjourney","suno-music","luma-video","cog-video","net-search","mind-map"],V=A({name:"",pluginImg:"",description:"",demoData:"",isEnabled:1,isSystemPlugin:0,parameters:"",sortOrder:100,page:1,size:10}),j=d(`/api/upload/file?dir=${encodeURIComponent("system/plugin")}`),h=d(),v=d(0),H=d(!1),Q=d(0),o=A({name:"",pluginImg:"",description:"",demoData:"",isEnabled:1,isSystemPlugin:0,parameters:"",sortOrder:100}),W=A({name:[{required:!0,message:"请填写App名称",trigger:"blur"}],description:[{required:!0,message:"请填写App介绍信息、用于对外展示",trigger:"blur"}],pluginImg:[{required:!1,message:"请上传插件封面",trigger:"blur"}],demoData:[{required:!1,message:"请填写演示数据",trigger:"blur"}],isEnabled:[{required:!0,type:"number",message:"请选择插件状态",trigger:"change"}],isSystemPlugin:[{required:!0,type:"number",message:"请选择是否为系统插件",trigger:"change"}],parameters:[{required:!0,message:"请填写调用参数",trigger:"blur"}],sortOrder:[{required:!0,type:"number",message:"请填写排序值",trigger:"change"}]}),B=d([]);d([]);const J=E(()=>v.value?"更新插件":"新增插件"),K=E(()=>v.value?"确认更新":"确认新增");async function P(){try{I.value=!0;const n=await D.pluginList(V),{rows:e,count:s}=n.data;I.value=!1,$.value=s,B.value=e.sort((r,g)=>g.order-r.order)}catch{I.value=!1}}function X(n){v.value=n.id,H.value=n.role==="user",Q.value=n.status;const{name:e,pluginImg:s,description:r,demoData:g,isEnabled:z,isSystemPlugin:m,parameters:C,sortOrder:y}=n;De(()=>{Object.assign(o,{name:e,pluginImg:s,description:r,demoData:g,isEnabled:z,isSystemPlugin:m,parameters:C,sortOrder:y})}),_.value=!0}function Y(n){v.value=0,n==null||n.resetFields()}async function Z(n){await D.delPlugin({id:n.id}),k.success("删除分类成功"),P()}const F=(n,e)=>{console.log("response: ",n.data),o.pluginImg=n.data};async function ee(){if(o.pluginImg){const n=await le(o.pluginImg);te(n,F)}}function te(n,e){const s=new FormData;s.append("file",n),M.post(j.value,s,{headers:{"Content-Type":"multipart/form-data"}}).then(r=>{e(r.data)}).catch(r=>{console.error("上传失败",r)})}async function le(n){const e=await M.get(n,{responseType:"blob"});let s="downloaded_file";const r=e.headers["content-disposition"];if(r){const g=/filename="([^"]+)"/.exec(r);g!=null&&g[1]&&(s=g[1])}else s=ae(n);return new File([e.data],s,{type:e.data.type})}function ae(n){const s=new URL(n).pathname;return s.substring(s.lastIndexOf("/")+1)}const ne=n=>{if(["image/png","image/jpeg","image/gif","image/webp"].includes(n.type)){if(n.size/1024>300)return k.error("当前限制文件最大不超过 300KB!"),!1}else return k.error("当前系统仅支持 PNG、JPEG、GIF 和 WebP 格式的图片!"),!1};function oe(n){n==null||n.validate(async e=>{if(e){if(v.value){const s={id:v.value,...o};await D.updatePlugin(s),k({type:"success",message:"更新插件成功！"})}else await D.createPlugin(o),k({type:"success",message:"创建新的插件成功！"});_.value=!1,P()}})}return Ve(()=>{P()}),(n,e)=>{const s=he,r=ze,g=ye,z=i("el-image"),m=i("el-table-column"),C=i("el-tag"),y=i("el-button"),se=i("el-popconfirm"),ie=i("el-table"),re=i("el-pagination"),ue=i("el-row"),de=ve,S=i("el-input"),b=i("el-form-item"),N=i("el-switch"),pe=i("el-option"),me=i("el-select"),q=i("el-icon"),ge=i("el-upload"),ce=i("el-form"),fe=i("el-dialog"),_e=Pe("loading");return w(),O("div",null,[t(g,null,{title:a(()=>e[14]||(e[14]=[p("div",{class:"flex items-center gap-4"},"插件设置",-1)])),content:a(()=>[p("div",Oe,[e[16]||(e[16]=p("div",null," 可自定义插件名称、描述和头像用于前端显示，同时需要设置对应的插件参数。 ",-1)),e[17]||(e[17]=p("div",null,"插件系统包含，内置插件和普通插件两种。",-1)),e[18]||(e[18]=p("div",null," 内置插件已支持Suno音乐（参数：suno-music）、Midjourney绘图（参数：midjourney）、Stable Diffusion绘图（参数：stable-diffusion）、 ",-1)),e[19]||(e[19]=p("div",null," Dalle绘画（参数：dall-e-3）、LumaVideo（参数：luma-video）、CogVideoX（参数：cog-video）、Flux绘画（参数：flux-draw），均需通过创意模型配置对应模型。 ",-1)),L("",!0),e[20]||(e[20]=p("div",null," 若内置插件参数不在支持列表内，将以插件参数作为模型，调用对应模型。 ",-1))])]),default:a(()=>[t(r,{outline:"",onClick:e[0]||(e[0]=l=>_.value=!0)},{default:a(()=>[t(s,{name:"ic:baseline-plus"}),e[21]||(e[21]=f(" 添加插件 "))]),_:1})]),_:1}),t(de,{style:{width:"100%"}},{default:a(()=>[xe((w(),T(ie,{border:"",data:u(B),style:{width:"100%"},size:"large"},{default:a(()=>[t(m,{prop:"pluginImg",label:"封面",width:"100"},{default:a(l=>[t(z,{style:{height:"50px"},src:l.row.pluginImg,fit:"fill"},null,8,["src"])]),_:1}),t(m,{prop:"sortOrder",label:"排序",width:"120"}),e[24]||(e[24]=f(" /> ")),t(m,{prop:"name",label:"名称",width:"120"}),t(m,{prop:"parameters",label:"调用参数",width:"120"}),t(m,{prop:"description",label:"描述信息"},{default:a(l=>[p("template",null,[p("div",Te,x(l.row.description),1)]),p("div",$e,x(l.row.description),1)]),_:1}),t(m,{prop:"isSystemPlugin",label:"分类",width:"100"},{default:a(l=>[t(C,{type:l.row.isSystemPlugin===1?"success":"info"},{default:a(()=>[f(x(l.row.isSystemPlugin===1?"内置插件":"普通插件"),1)]),_:2},1032,["type"])]),_:1}),t(m,{prop:"isEnabled",label:"状态",width:"100"},{default:a(l=>[t(C,{type:l.row.isEnabled===1?"success":"danger"},{default:a(()=>[f(x(u(Ae)[l.row.isEnabled]),1)]),_:2},1032,["type"])]),_:1}),t(m,{label:"操作",width:"200"},{default:a(l=>[t(y,{link:"",type:"primary",size:"small",onClick:be=>X(l.row)},{default:a(()=>e[22]||(e[22]=[f(" 编辑 ")])),_:2},1032,["onClick"]),t(se,{title:"确认删除此插件么?",width:"200","icon-color":"red",onConfirm:be=>Z(l.row)},{reference:a(()=>[t(y,{link:"",type:"danger",size:"small"},{default:a(()=>e[23]||(e[23]=[f(" 删除 ")])),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"])),[[_e,u(I)]]),t(ue,{class:"flex justify-end mt-5"},{default:a(()=>[t(re,{"current-page":V.page,"onUpdate:currentPage":e[1]||(e[1]=l=>V.page=l),"page-size":V.size,"onUpdate:pageSize":e[2]||(e[2]=l=>V.size=l),class:"mr-5","page-sizes":[10,20,30,50],layout:"total, sizes, prev, pager, next, jumper",total:u($),onSizeChange:P,onCurrentChange:P},null,8,["current-page","page-size","total"])]),_:1})]),_:1}),t(fe,{modelValue:u(_),"onUpdate:modelValue":e[12]||(e[12]=l=>Ue(_)?_.value=l:null),"close-on-click-modal":!1,title:u(J),width:"570",onClose:e[13]||(e[13]=l=>Y(u(h)))},{footer:a(()=>[p("span",Be,[t(y,{onClick:e[10]||(e[10]=l=>_.value=!1)},{default:a(()=>e[25]||(e[25]=[f("取消")])),_:1}),t(y,{type:"primary",onClick:e[11]||(e[11]=l=>oe(u(h)))},{default:a(()=>[f(x(u(K)),1)]),_:1})])]),default:a(()=>[t(ce,{ref_key:"formPackageRef",ref:h,"label-position":"right","label-width":"100px",model:o,rules:W},{default:a(()=>[t(b,{label:"插件名称",prop:"name"},{default:a(()=>[t(S,{modelValue:o.name,"onUpdate:modelValue":e[3]||(e[3]=l=>o.name=l),placeholder:"请填写插件名称"},null,8,["modelValue"])]),_:1}),t(b,{label:"插件状态",prop:"isEnabled"},{default:a(()=>[t(N,{modelValue:o.isEnabled,"onUpdate:modelValue":e[4]||(e[4]=l=>o.isEnabled=l),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1}),t(b,{label:"插件描述",prop:"description"},{default:a(()=>[t(S,{modelValue:o.description,"onUpdate:modelValue":e[5]||(e[5]=l=>o.description=l),type:"textarea",placeholder:"请填写插件描述、用于对外展示...",rows:4},null,8,["modelValue"])]),_:1}),t(b,{label:"系统插件",prop:"status"},{default:a(()=>[t(N,{modelValue:o.isSystemPlugin,"onUpdate:modelValue":e[6]||(e[6]=l=>o.isSystemPlugin=l),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1}),t(b,{label:"插件参数",prop:"parameters"},{default:a(()=>[t(me,{modelValue:o.parameters,"onUpdate:modelValue":e[7]||(e[7]=l=>o.parameters=l),placeholder:"请选择或填写插件参数",filterable:"","allow-create":"","default-first-option":"",clearable:""},{default:a(()=>[(w(),O(ke,null,Ie(G,l=>t(pe,{key:l,label:l,value:l},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),t(b,{label:"插件图标",prop:"pluginImg"},{default:a(()=>[t(S,{modelValue:o.pluginImg,"onUpdate:modelValue":e[8]||(e[8]=l=>o.pluginImg=l),placeholder:"请填写或上传插件图标",clearable:""},{append:a(()=>[t(ge,{class:"avatar-uploader",action:u(j),"show-file-list":!1,"on-success":F,"before-upload":ne,style:{display:"flex","align-items":"center","justify-content":"center"}},{default:a(()=>[o.pluginImg?(w(),O("img",{key:0,src:o.pluginImg,style:{"max-width":"1.5rem","max-height":"1.5rem",margin:"5px 0","object-fit":"contain"}},null,8,je)):(w(),T(q,{key:1,style:{width:"1rem"}},{default:a(()=>[t(u(Ce))]),_:1}))]),_:1},8,["action"]),o.pluginImg?(w(),T(q,{key:0,onClick:ee,style:{"margin-left":"35px",width:"1rem"}},{default:a(()=>[t(u(Se))]),_:1})):L("",!0)]),_:1},8,["modelValue"])]),_:1}),t(b,{label:"排序ID",prop:"sortOrder"},{default:a(()=>[t(S,{modelValue:o.sortOrder,"onUpdate:modelValue":e[9]||(e[9]=l=>o.sortOrder=l),modelModifiers:{number:!0},placeholder:"请填写排序ID[数字越大越靠前]"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}});typeof R=="function"&&R(Fe);export{Fe as default};
