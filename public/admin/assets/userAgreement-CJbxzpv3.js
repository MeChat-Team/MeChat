
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * https://fantastic-admin.github.io
 */

import{_ as $}from"./index.vue_vue_type_script_setup_true_lang-FDL5yZdU.js";import{d as q,u as B,m as E,n as H,r as g,a as M,p as r,g as j,c as N,b as t,w as n,e as _,h as P,i as R,G as p,H as D,j as F,_ as G,k as x}from"./index-TOhlAu5k.js";import{a as A}from"./config-CFeX2CT3.js";import{E as K}from"./style-DgYNa2Ji.js";const L=q({__name:"userAgreement",setup(z){const V=B(),a=E({isAutoOpenAgreement:"",agreementInfo:"",agreementTitle:""});H(()=>V.settings.app.colorScheme);const C=g({agreementTitle:[{required:!0,trigger:"blur",message:"请填写用户协议标题"}],agreementInfo:[{required:!0,trigger:"blur",message:"请填写用户协议具体内容"}]}),y=g();async function v(){const o=await A.queryConfig({keys:["agreementInfo","agreementTitle","isAutoOpenAgreement"]}),{agreementInfo:e,agreementTitle:i,isAutoOpenAgreement:s}=o.data;e&&Object.assign(a,{agreementInfo:e,agreementTitle:i,isAutoOpenAgreement:s})}function I(){var o;(o=y.value)==null||o.validate(async e=>{if(e){try{await A.setConfig({settings:O(a)}),p.success("变更用户协议信息成功")}catch{}v()}else p.error("请填写完整信息")})}const b=g(`/api/upload/file?dir=${encodeURIComponent("system/others")}`);function O(o){return Object.keys(o).map(e=>({configKey:e,configVal:o[e]}))}function T(o){}async function k(o,e){const i=await Promise.all(Array.from(o).map(s=>new Promise(async(f,d)=>{var m;const u=new FormData;u.append("file",s);try{const l=await D.post(b.value,u,{headers:{"Content-Type":"multipart/form-data"}});(m=l==null?void 0:l.data)!=null&&m.data||p.error("图片上传失败，请检查您的配置信息！"),f(l.data.data)}catch(l){p.error(l||"图片上传失败，请检查您的配置信息！"),d(l)}})));e(i.map(s=>s)),p({message:"图片上传成功！",type:"success"})}return M(()=>{v()}),(o,e)=>{const i=F,s=G,f=$,d=r("el-input"),u=r("el-form-item"),m=r("el-col"),l=r("el-switch"),U=r("el-tooltip"),w=r("el-row"),h=r("el-form"),S=r("el-card");return j(),N("div",null,[t(f,null,{title:n(()=>e[3]||(e[3]=[_("div",{class:"flex items-center gap-4"},"用户协议设置",-1)])),content:n(()=>e[4]||(e[4]=[_("div",{class:"text-sm/6"},[_("div",null," 用户协议设置用于配置用户端显示的用户协议页面。支持使用Markdown语法或HTML标签来创建内容，为灵活的内容格式提供便利。 ")],-1)])),default:n(()=>[t(s,{outline:"",onClick:I},{default:n(()=>[t(i,{name:"i-ri:file-text-line"}),e[5]||(e[5]=P(" 保存设置 "))]),_:1})]),_:1}),t(S,{style:{margin:"20px"}},{default:n(()=>[t(h,{ref_key:"formRef",ref:y,rules:C.value,model:a,"label-width":"120px"},{default:n(()=>[t(w,null,{default:n(()=>[t(m,{xs:24,md:20,lg:15,xl:10},{default:n(()=>[t(u,{label:"用户协议标题",prop:"agreementTitle"},{default:n(()=>[t(d,{modelValue:a.agreementTitle,"onUpdate:modelValue":e[0]||(e[0]=c=>a.agreementTitle=c),rows:1,placeholder:"用户协议标题",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),t(m,{xs:24,md:20,lg:15,xl:10},{default:n(()=>[t(u,{label:"开启用户协议",prop:"isAutoOpenAgreement"},{default:n(()=>[t(U,{content:"开启后，用户在注册时将会弹出用户协议页面",placement:"top","show-after":500},{default:n(()=>[t(l,{modelValue:a.isAutoOpenAgreement,"onUpdate:modelValue":e[1]||(e[1]=c=>a.isAutoOpenAgreement=c),"active-value":"1","inactive-value":"0"},null,8,["modelValue"])]),_:1})]),_:1}),t(m,{xs:24,md:20,lg:15,xl:12})]),_:1})]),_:1}),t(w,null,{default:n(()=>[t(m,{span:24},{default:n(()=>[t(u,{label:"用户协议内容",prop:"agreementInfo"},{default:n(()=>[t(R(K),{modelValue:a.agreementInfo,"onUpdate:modelValue":e[2]||(e[2]=c=>a.agreementInfo=c),style:{"min-height":"80vh"},onOnChange:T,onOnUploadImg:k},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["rules","model"])]),_:1})])}}});typeof x=="function"&&x(L);export{L as default};
