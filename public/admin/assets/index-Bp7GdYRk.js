
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * https://fantastic-admin.github.io
 */

import{I as v,d as K,r as p,a as O,p as s,q as P,g as h,c as S,e as D,b as l,w as o,i as q,B,h as g,y as Q,z as M,M as X,G as _,l as Y}from"./index-TOhlAu5k.js";const Z=n=>v.get("gallery/query",{params:n}),ee=n=>v.post("gallery/set",n),le=n=>v.post("gallery/delete",{id:n}),te=(n,m)=>v.post("gallery/visible",{id:n,visible:m}),oe=n=>v.post("upload",n,{headers:{"Content-Type":"multipart/form-data"}}),ae={class:"gallery-container"},re={class:"operation-bar"},se=["src"],ne={class:"dialog-footer"},ie=K({__name:"index",setup(n){const m=p(!1),k=p([]),c=p(!1),y=p(""),b=p(!1),V=p(),r=p({id:void 0,imageUrl:"",category:"",prompt:"",order:100,isShow:!0,width:0,height:0}),I={imageUrl:[{required:!0,message:"请上传图片",trigger:"change"}],category:[{required:!0,message:"请输入分类",trigger:"blur"}],prompt:[{required:!0,message:"请输入提示词",trigger:"blur"}]},U=async()=>{m.value=!0;try{const a=await Z({});a.success&&(k.value=a.data)}catch(a){console.error(a)}m.value=!1},E=()=>{y.value="添加图片",r.value={id:void 0,imageUrl:"",category:"",prompt:"",order:100,isShow:!0,width:0,height:0},c.value=!0},G=a=>{y.value="编辑图片",r.value={...a},c.value=!0},L=async a=>{try{await X.confirm("确认删除该图片吗？","提示",{type:"warning"}),(await le({id:a.id})).success&&(_.success("删除成功"),U())}catch(e){console.error(e)}},$=async a=>{try{(await te({id:a.id})).success&&_.success("操作成功")}catch(e){console.error(e)}},N=a=>a.type.startsWith("image/")?a.size/1024/1024<10?!0:(_.error("图片大小不能超过 10MB！"),!1):(_.error("只能上传图片文件！"),!1),T=async a=>{try{const e=new FormData;e.append("file",a.file);const u=await oe(e);if(u.success){e.append("imageUrl",u.data.url);const i=new Image;i.src=u.data.url,i.onload=()=>{e.append("width",i.width.toString()),e.append("height",i.height.toString())}}}catch(e){console.error(e)}},z=async()=>{V.value&&await V.value.validate(async a=>{if(a){b.value=!0;try{(await ee(r.value)).success&&(_.success("操作成功"),c.value=!1,U())}catch(e){console.error(e)}b.value=!1}})};return O(()=>{U()}),(a,e)=>{const u=s("el-icon"),i=s("el-button"),d=s("el-table-column"),F=s("el-image"),x=s("el-switch"),R=s("el-table"),A=s("el-upload"),f=s("el-form-item"),C=s("el-input"),W=s("el-input-number"),j=s("el-form"),H=s("el-dialog"),J=P("loading");return h(),S("div",ae,[D("div",re,[l(i,{type:"primary",onClick:E},{default:o(()=>[l(u,null,{default:o(()=>[l(q(B))]),_:1}),e[6]||(e[6]=g("上传图片 "))]),_:1})]),Q((h(),M(R,{data:k.value,style:{width:"100%"}},{default:o(()=>[l(d,{prop:"id",label:"ID",width:"80"}),l(d,{label:"图片",width:"120"},{default:o(t=>[l(F,{src:t.row.imageUrl,"preview-src-list":[t.row.imageUrl],fit:"cover",style:{width:"100px",height:"100px"}},null,8,["src","preview-src-list"])]),_:1}),l(d,{prop:"category",label:"分类",width:"120"}),l(d,{prop:"prompt",label:"提示词","show-overflow-tooltip":""}),l(d,{prop:"width",label:"宽度",width:"80"}),l(d,{prop:"height",label:"高度",width:"80"}),l(d,{prop:"order",label:"排序",width:"80"}),l(d,{label:"状态",width:"80"},{default:o(t=>[l(x,{modelValue:t.row.isShow,"onUpdate:modelValue":w=>t.row.isShow=w,onChange:w=>$(t.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),l(d,{label:"操作",width:"120",fixed:"right"},{default:o(t=>[l(i,{link:"",type:"primary",onClick:w=>G(t.row)},{default:o(()=>e[7]||(e[7]=[g("编辑")])),_:2},1032,["onClick"]),l(i,{link:"",type:"danger",onClick:w=>L(t.row)},{default:o(()=>e[8]||(e[8]=[g("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[J,m.value]]),l(H,{title:y.value,modelValue:c.value,"onUpdate:modelValue":e[5]||(e[5]=t=>c.value=t),width:"600px","close-on-click-modal":!1},{footer:o(()=>[D("span",ne,[l(i,{onClick:e[4]||(e[4]=t=>c.value=!1)},{default:o(()=>e[9]||(e[9]=[g("取消")])),_:1}),l(i,{type:"primary",onClick:z,loading:b.value},{default:o(()=>e[10]||(e[10]=[g(" 确定 ")])),_:1},8,["loading"])])]),default:o(()=>[l(j,{ref_key:"formRef",ref:V,model:r.value,rules:I,"label-width":"80px"},{default:o(()=>[l(f,{label:"图片",prop:"imageUrl"},{default:o(()=>[l(A,{class:"avatar-uploader","show-file-list":!1,"before-upload":N,"http-request":T},{default:o(()=>[r.value.imageUrl?(h(),S("img",{key:0,src:r.value.imageUrl,class:"avatar"},null,8,se)):(h(),M(u,{key:1,class:"avatar-uploader-icon"},{default:o(()=>[l(q(B))]),_:1}))]),_:1})]),_:1}),l(f,{label:"分类",prop:"category"},{default:o(()=>[l(C,{modelValue:r.value.category,"onUpdate:modelValue":e[0]||(e[0]=t=>r.value.category=t),placeholder:"请输入分类"},null,8,["modelValue"])]),_:1}),l(f,{label:"提示词",prop:"prompt"},{default:o(()=>[l(C,{modelValue:r.value.prompt,"onUpdate:modelValue":e[1]||(e[1]=t=>r.value.prompt=t),type:"textarea",placeholder:"请输入提示词"},null,8,["modelValue"])]),_:1}),l(f,{label:"排序",prop:"order"},{default:o(()=>[l(W,{modelValue:r.value.order,"onUpdate:modelValue":e[2]||(e[2]=t=>r.value.order=t),min:0},null,8,["modelValue"])]),_:1}),l(f,{label:"状态",prop:"isShow"},{default:o(()=>[l(x,{modelValue:r.value.isShow,"onUpdate:modelValue":e[3]||(e[3]=t=>r.value.isShow=t)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"])])}}}),ue=Y(ie,[["__scopeId","data-v-556d8f1d"]]);export{ue as default};
