
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * https://fantastic-admin.github.io
 */

import{_ as H}from"./index.vue_vue_type_script_setup_true_lang-Ddax1S58.js";import{_ as K}from"./index.vue_vue_type_script_setup_true_lang-FDL5yZdU.js";import{d as N,r as d,m as $,a as j,p as n,q as P,g as c,c as C,b as t,w as l,e as g,F as O,s as G,i,v as J,x as Q,h as u,y as W,z as T,t as _,L as X,k as A}from"./index-TOhlAu5k.js";import{A as Z}from"./chat-C6_gHGd-.js";import{u as E}from"./utcformatTime-Bq4gDWNx.js";import{m as v}from"./marked.esm-93NuQbMa.js";const ee={class:"answer"},te=["innerHTML"],oe=N({__name:"chat",setup(le){const V=new v.Renderer;v.setOptions({renderer:V,gfm:!0,pedantic:!1});const m=d(!1),b=d(),h=d(),y=d(0),a=$({userId:"",prompt:"",page:1,size:10}),k=d([]);async function p(){m.value=!0;try{const r=await Z.queryChatAll(a);m.value=!1;const{rows:o,count:f}=r.data;y.value=f,k.value=o}catch{m.value=!1}}async function U(r){const o=await X.queryAllUser({size:30,username:r});b.value=o.data.rows}function D(r){r==null||r.resetFields(),p()}return j(()=>{p()}),(r,o)=>{const f=K,I=n("el-option"),L=n("el-select"),w=n("el-form-item"),M=n("el-input"),z=n("el-button"),S=n("el-form"),x=H,s=n("el-table-column"),q=n("el-popover"),B=n("el-table"),R=n("el-pagination"),Y=n("el-row"),F=P("loading");return c(),C("div",null,[t(f,null,{title:l(()=>o[5]||(o[5]=[g("div",{class:"flex items-center gap-4"},"对话记录",-1)])),_:1}),t(x,null,{default:l(()=>[t(S,{ref_key:"formRef",ref:h,inline:!0,model:a},{default:l(()=>[t(w,{label:"用户名称",prop:"userId"},{default:l(()=>[t(L,{modelValue:a.userId,"onUpdate:modelValue":o[0]||(o[0]=e=>a.userId=e),filterable:"",clearable:"",remote:"","reserve-keyword":"",placeholder:"用户姓名[模糊搜索]","remote-show-suffix":"","remote-method":U,style:{width:"160px"}},{default:l(()=>[(c(!0),C(O,null,G(i(b),e=>(c(),T(I,{key:e.id,label:e.username,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(w,{label:"用户询问的问题",prop:"prompt"},{default:l(()=>[t(M,{modelValue:a.prompt,"onUpdate:modelValue":o[1]||(o[1]=e=>a.prompt=e),placeholder:"提问问题[模糊搜索]",onKeydown:J(Q(p,["prevent"]),["enter"])},null,8,["modelValue","onKeydown"])]),_:1}),t(w,null,{default:l(()=>[t(z,{type:"primary",onClick:p},{default:l(()=>o[6]||(o[6]=[u(" 查询 ")])),_:1}),t(z,{onClick:o[2]||(o[2]=e=>D(i(h)))},{default:l(()=>o[7]||(o[7]=[u(" 重置 ")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(x,{style:{width:"100%"}},{default:l(()=>[W((c(),T(B,{border:"",data:i(k),style:{width:"100%"},size:"large","tooltip-options":{}},{default:l(()=>[t(s,{fixed:"",prop:"username",label:"用户名称",width:"150"}),t(s,{prop:"createdAt",label:"角色",width:"80"},{default:l(e=>[u(_(e.row.role==="user"?"用户":"电脑"),1)]),_:1}),t(s,{prop:"email",label:"用户邮箱",width:"200"}),t(s,{prop:"answer",label:"用户询问/AI回复",width:"400"},{default:l(e=>[t(q,{placement:"top",width:"450",trigger:"click"},{reference:l(()=>[g("div",ee,_(e.row.role==="user"?e.row.prompt:e.row.answer),1)]),default:l(()=>[g("div",{class:"answer_container",innerHTML:i(v)(e.row.role==="user"?e.row.prompt:e.row.answer||"")},null,8,te)]),_:2},1024)]),_:1}),t(s,{prop:"completionTokens",label:"提问/回答Token",width:"140",align:"center"},{default:l(e=>[u(_(e.row.role==="user"?e.row.promptTokens:e.row.completionTokens),1)]),_:1}),t(s,{prop:"totalTokens",label:"总计Token",width:"110",align:"center"}),t(s,{prop:"model",label:"模型",width:"200"}),t(s,{prop:"createdAt",label:"提问时间",width:"200"},{default:l(e=>[u(_(i(E)(e.row.createdAt,"YYYY-MM-DD hh:mm:ss")),1)]),_:1})]),_:1},8,["data"])),[[F,i(m)]]),t(Y,{class:"mt-5 flex justify-end"},{default:l(()=>[t(R,{"current-page":a.page,"onUpdate:currentPage":o[3]||(o[3]=e=>a.page=e),"page-size":a.size,"onUpdate:pageSize":o[4]||(o[4]=e=>a.size=e),class:"mr-5","page-sizes":[10,20,30,50],layout:"total, sizes, prev, pager, next, jumper",total:i(y),onSizeChange:p,onCurrentChange:p},null,8,["current-page","page-size","total"])]),_:1})]),_:1})])}}});typeof A=="function"&&A(oe);export{oe as default};
