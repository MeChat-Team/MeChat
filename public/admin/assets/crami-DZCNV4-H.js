
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * https://fantastic-admin.github.io
 */

import{_ as _e}from"./index.vue_vue_type_script_setup_true_lang-Ddax1S58.js";import{_ as ve}from"./index.vue_vue_type_script_setup_true_lang-FDL5yZdU.js";import{d as Ce,r as m,m as N,n as we,a as ke,p as u,q as Ve,g as r,c as w,b as t,w as a,e as _,i as n,z as g,h as s,A as x,F as D,s as j,y as xe,t as $,D as T,L as Ue,G as h,_ as Me,j as $e,k as X}from"./index-TOhlAu5k.js";import{A as I}from"./package-BOFbsru1.js";import{C as Ie}from"./index-BE-LteFu.js";import{u as ze}from"./utcformatTime-Bq4gDWNx.js";const Ae={key:1},De={class:"dialog-footer"},je={style:{"max-height":"200px",overflow:"scroll"}},qe={class:"dialog-footer"},Se=Ce({__name:"crami",setup(Le){const B=m(),P=m(0),k=m(!1),U=m(!1),q=m(),M=m(0),F=m([]),O=m([]),v=m(!1),C=m([]),Y=m([]),d=N({packageId:null,count:1,drawMjCount:0,model3Count:0,model4Count:0}),p=N({useId:"",status:"",page:1,size:15}),Z=N({packageId:[{required:!0,message:"请选择套餐类型",trigger:"change"}],days:[{required:!0,message:"请填写有效期天数",trigger:"blur"}],count:[{required:!0,message:"请填写想要生成的数量",trigger:"blur"}],drawMjCount:[{required:!0,message:"卡密携带绘画数量",trigger:"blur"}],model3Count:[{required:!0,message:"卡密携带基础模型对话数量",trigger:"blur"}],model4Count:[{required:!0,message:"卡密携带高级模型金额",trigger:"blur"}]}),S=m([]);async function y(){try{v.value=!0;const o=await I.queryAllCrami(p),{rows:e,count:b}=o.data;v.value=!1,P.value=b,S.value=e}catch{v.value=!1}}async function E(o){const e=await Ue.queryAllUser({size:30,username:o});O.value=e.data.rows}async function ee(){const o=await I.queryAllPackage({size:100});F.value=o.data.rows}function le(){ee(),k.value=!0}async function te(o){o==null||o.validate(async e=>{e&&(await I.createCrami(d),h({type:"success",message:"生成卡密成功！"}),k.value=!1,y())})}function ae(o){o==null||o.resetFields()}function oe(o){o==null||o.resetFields(),y()}async function ne(o){await I.delCrami({id:o.id}),h({type:"success",message:"删除卡密成功！"}),y()}async function re(o){C.value=o}async function ue(){try{v.value=!0,await I.batchDelCrami({ids:C.value.map(o=>o.id)}),v.value=!1,h({type:"success",message:"删除卡密成功！"}),y()}catch{v.value=!1}}function se(){U.value=!0;const o=C.value.map(e=>`${e.code}<---->${e.packageName||"自定义套餐"}`);Y.value=o}function de(o){return o.join(`
`)}function ie(o,e){const b=de(o),L=new Blob([b],{type:"text/plain"}),z=URL.createObjectURL(L),f=document.createElement("a");f.href=z,f.download=`${e}.txt`,document.body.appendChild(f),f.click(),document.body.removeChild(f),setTimeout(()=>URL.revokeObjectURL(z),0)}function me(){const o=C.value.map(e=>`${e.code}<---->${e.packageName||"自定义套餐"}`);ie(o,"卡密信息")}const pe=we(()=>S.value.some(o=>o.email));return ke(()=>{y()}),(o,e)=>{const b=Me,L=$e,z=ve,f=u("el-option"),R=u("el-select"),c=u("el-form-item"),V=u("el-button"),H=u("el-form"),G=_e,i=u("el-table-column"),J=u("el-tag"),fe=u("el-popconfirm"),ce=u("el-table"),ge=u("el-pagination"),K=u("el-row"),ye=u("el-switch"),A=u("el-input"),Q=u("el-dialog"),be=Ve("loading");return r(),w("div",null,[t(z,null,{title:a(()=>e[17]||(e[17]=[_("div",{class:"flex items-center gap-4"},"卡密设置",-1)])),content:a(()=>e[18]||(e[18]=[_("div",{class:"text-sm/6"},[_("div",null,"可生成套餐类卡密与自定义卡密，套餐类卡密的设置项更多。"),_("div",null," 过期时间表示卡密的过期时间，不是用户充值后的有效期，设置为0表示永不过期。 ")],-1)])),default:a(()=>[n(C).length?(r(),g(b,{key:0,outline:"",type:"danger",onClick:se},{default:a(()=>e[19]||(e[19]=[s(" 显示选中卡密 ")])),_:1})):x("",!0),n(C).length?(r(),g(b,{key:1,outline:"",type:"danger",onClick:ue},{default:a(()=>e[20]||(e[20]=[s(" 批量删除卡密 ")])),_:1})):x("",!0),n(C).length?(r(),g(b,{key:2,outline:"",type:"primary",onClick:me},{default:a(()=>e[21]||(e[21]=[s(" 批量导出卡密 ")])),_:1})):x("",!0),t(b,{outline:"",type:"success",onClick:le},{default:a(()=>[t(L,{name:"ic:baseline-plus"}),e[22]||(e[22]=s(" 批量生成卡密 "))]),_:1})]),_:1}),t(G,null,{default:a(()=>[t(H,{ref_key:"formRef",ref:B,inline:!0,model:p},{default:a(()=>[t(c,{label:"用户名称",prop:"useId"},{default:a(()=>[t(R,{modelValue:p.useId,"onUpdate:modelValue":e[0]||(e[0]=l=>p.useId=l),filterable:"",clearable:"",remote:"","reserve-keyword":"",placeholder:"用户姓名[模糊搜索]","remote-show-suffix":"","remote-method":E,style:{width:"160px"}},{default:a(()=>[(r(!0),w(D,null,j(n(O),l=>(r(),g(f,{key:l.id,label:l.username,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(c,{label:"卡密状态",prop:"status"},{default:a(()=>[t(R,{modelValue:p.status,"onUpdate:modelValue":e[1]||(e[1]=l=>p.status=l),placeholder:"请选择卡密状态",clearable:"",style:{width:"160px"}},{default:a(()=>[(r(!0),w(D,null,j(n(Ie),l=>(r(),g(f,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(c,null,{default:a(()=>[t(V,{type:"primary",onClick:y},{default:a(()=>e[23]||(e[23]=[s(" 查询 ")])),_:1}),t(V,{onClick:e[2]||(e[2]=l=>oe(n(B)))},{default:a(()=>e[24]||(e[24]=[s(" 重置 ")])),_:1})]),_:1}),e[25]||(e[25]=_("div",{style:{float:"right"}},null,-1))]),_:1},8,["model"])]),_:1}),t(G,{style:{width:"100%"}},{default:a(()=>[xe((r(),g(ce,{border:"",data:n(S),style:{width:"100%"},size:"large",onSelectionChange:re},{default:a(()=>[t(i,{type:"selection",width:"55"}),t(i,{prop:"code",label:"卡密账号",width:"180"}),t(i,{prop:"packageName",label:"套餐类型",width:"180"},{default:a(l=>[t(J,{type:l.row.packageName?"success":"danger"},{default:a(()=>[s($(l.row.packageName||"自定义卡密"),1)]),_:2},1032,["type"])]),_:1}),t(i,{prop:"code",label:"卡密状态",width:"180"},{default:a(l=>[t(J,{type:l.row.status?"danger":"success"},{default:a(()=>[s($(l.row.status?"已使用":"未使用"),1)]),_:2},1032,["type"])]),_:1}),t(i,{prop:"useId",label:"使用人ID",width:"90"}),n(pe)?(r(),g(i,{key:0,prop:"email",label:"使用人邮箱",width:"180"})):x("",!0),t(i,{prop:"model3Count",label:"基础模型额度"}),t(i,{prop:"model4Count",label:"高级模型额度"}),t(i,{prop:"drawMjCount",label:"绘画模型额度"}),t(i,{prop:"days",label:"有效天数"},{default:a(l=>[s($(l.row.days>0?`${l.row.days}天`:"永久"),1)]),_:1}),t(i,{prop:"createdAt",label:"注册时间",width:"200"},{default:a(l=>[s($(n(ze)(l.row.createdAt,"YYYY-MM-DD hh:mm:ss")),1)]),_:1}),t(i,{label:"操作"},{default:a(l=>[t(fe,{title:"确认删除此卡密么?",width:"200","icon-color":"red",onConfirm:W=>ne(l.row)},{reference:a(()=>[t(V,{link:"",type:"danger",size:"small"},{default:a(()=>e[26]||(e[26]=[s(" 删除卡密 ")])),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"])),[[be,n(v)]]),t(K,{class:"mt-5 flex justify-end"},{default:a(()=>[t(ge,{"current-page":p.page,"onUpdate:currentPage":e[3]||(e[3]=l=>p.page=l),"page-size":p.size,"onUpdate:pageSize":e[4]||(e[4]=l=>p.size=l),class:"mr-5","page-sizes":[15,50,100,200],layout:"total, sizes, prev, pager, next, jumper",total:n(P),onSizeChange:y,onCurrentChange:y},null,8,["current-page","page-size","total"])]),_:1})]),_:1}),t(Q,{modelValue:n(k),"onUpdate:modelValue":e[13]||(e[13]=l=>T(k)?k.value=l:null),title:"生成卡密",width:"450",onClose:e[14]||(e[14]=l=>ae(n(q)))},{footer:a(()=>[_("span",De,[t(V,{onClick:e[11]||(e[11]=l=>k.value=!1)},{default:a(()=>e[27]||(e[27]=[s("放弃生成")])),_:1}),t(V,{type:"primary",onClick:e[12]||(e[12]=l=>te(n(q)))},{default:a(()=>e[28]||(e[28]=[s(" 确定生成 ")])),_:1})])]),default:a(()=>[t(H,{ref_key:"formCramiRef",ref:q,"label-position":"right","label-width":"100px",model:d,rules:Z},{default:a(()=>[t(K,null,{default:a(()=>[t(c,{label:"是否生成自定义卡密","label-width":"170px"},{default:a(()=>[t(ye,{modelValue:n(M),"onUpdate:modelValue":e[5]||(e[5]=l=>T(M)?M.value=l:null),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1})]),_:1}),n(M)?x("",!0):(r(),g(c,{key:0,label:"套餐类型",prop:"packageId"},{default:a(()=>[t(R,{modelValue:d.packageId,"onUpdate:modelValue":e[6]||(e[6]=l=>d.packageId=l),modelModifiers:{number:!0},placeholder:"请选择套餐类型",clearable:"",style:{width:"100%"}},{default:a(()=>[(r(!0),w(D,null,j(n(F),l=>(r(),g(f,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})),n(M)?(r(),w("div",Ae,[t(c,{label:"基础模型额度",prop:"model3Count"},{default:a(()=>[t(A,{modelValue:d.model3Count,"onUpdate:modelValue":e[7]||(e[7]=l=>d.model3Count=l),modelModifiers:{number:!0},type:"number",placeholder:"卡密携带基础模型额度"},null,8,["modelValue"])]),_:1}),t(c,{label:"高级模型额度",prop:"model4Count"},{default:a(()=>[t(A,{modelValue:d.model4Count,"onUpdate:modelValue":e[8]||(e[8]=l=>d.model4Count=l),modelModifiers:{number:!0},type:"number",placeholder:"卡密携带高级模型额度"},null,8,["modelValue"])]),_:1}),t(c,{label:"绘画模型额度",prop:"drawMjCount"},{default:a(()=>[t(A,{modelValue:d.drawMjCount,"onUpdate:modelValue":e[9]||(e[9]=l=>d.drawMjCount=l),modelModifiers:{number:!0},type:"number",placeholder:"卡密携带绘画积分额度"},null,8,["modelValue"])]),_:1})])):x("",!0),t(c,{label:"生成数量",prop:"count"},{default:a(()=>[t(A,{modelValue:d.count,"onUpdate:modelValue":e[10]||(e[10]=l=>d.count=l),modelModifiers:{number:!0},type:"number",placeholder:"本次生成的张数"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"]),t(Q,{modelValue:n(U),"onUpdate:modelValue":e[16]||(e[16]=l=>T(U)?U.value=l:null),title:"卡密列表"},{footer:a(()=>[_("span",qe,[t(V,{onClick:e[15]||(e[15]=l=>U.value=!1)},{default:a(()=>e[29]||(e[29]=[s("关闭弹窗")])),_:1})])]),default:a(()=>[_("div",je,[(r(!0),w(D,null,j(n(Y),(l,W)=>(r(),w("div",{key:W},$(l),1))),128))])]),_:1},8,["modelValue"])])}}});typeof X=="function"&&X(Se);export{Se as default};
