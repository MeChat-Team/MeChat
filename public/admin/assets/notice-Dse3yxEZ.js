
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * https://fantastic-admin.github.io
 */

import{_ as S}from"./index.vue_vue_type_script_setup_true_lang-FDL5yZdU.js";import{d as $,u as q,m as B,n as E,r as _,a as H,p as s,g as M,c as j,b as t,w as o,e as g,h as P,i as R,G as f,H as D,j as F,_ as G,k as x}from"./index-TOhlAu5k.js";import{a as V}from"./config-CFeX2CT3.js";import{E as K}from"./style-DgYNa2Ji.js";const L=$({__name:"notice",setup(z){const C=q(),l=B({isAutoOpenNotice:"",noticeInfo:"",noticeTitle:""});E(()=>C.settings.app.colorScheme);const I=_({noticeTitle:[{required:!0,trigger:"blur",message:"请填写公告标题"}],noticeInfo:[{required:!0,trigger:"blur",message:"请填写公告具体信息"}]}),y=_();async function v(){const n=await V.queryConfig({keys:["noticeInfo","noticeTitle","isAutoOpenNotice"]}),{noticeInfo:e,noticeTitle:c,isAutoOpenNotice:i}=n.data;e&&Object.assign(l,{noticeInfo:e,noticeTitle:c,isAutoOpenNotice:i})}function b(){var n;(n=y.value)==null||n.validate(async e=>{if(e){try{await V.setConfig({settings:T(l)}),f.success("变更配置信息成功")}catch{}v()}else f.error("请填写完整信息")})}const O=_(`/api/upload/file?dir=${encodeURIComponent("system/others")}`);function T(n){return Object.keys(n).map(e=>({configKey:e,configVal:n[e]}))}function N(n){}async function k(n,e){const c=await Promise.all(Array.from(n).map(i=>new Promise(async(p,d)=>{var r;const u=new FormData;u.append("file",i);try{const a=await D.post(O.value,u,{headers:{"Content-Type":"multipart/form-data"}});(r=a==null?void 0:a.data)!=null&&r.data||f.error("图片上传失败、请检查您的配置信息！"),p(a.data.data)}catch(a){f.error(a||"图片上传失败、请检查您的配置信息！"),d(a)}})));e(c.map(i=>i)),f({message:"图片上传成功！",type:"success"})}return H(()=>{v()}),(n,e)=>{const c=F,i=G,p=S,d=s("el-input"),u=s("el-form-item"),r=s("el-col"),a=s("el-switch"),A=s("el-tooltip"),w=s("el-row"),U=s("el-form"),h=s("el-card");return M(),j("div",null,[t(p,null,{title:o(()=>e[3]||(e[3]=[g("div",{class:"flex items-center gap-4"},"公告设置说明",-1)])),content:o(()=>e[4]||(e[4]=[g("div",{class:"text-sm/6"},[g("div",null," 公告设置用于配置用户端显示的公告页面。支持使用Markdown语法或HTML标签来创建内容，为灵活的内容格式提供便利。 ")],-1)])),default:o(()=>[t(i,{outline:"",onClick:b},{default:o(()=>[t(c,{name:"i-ri:file-text-line"}),e[5]||(e[5]=P(" 保存设置 "))]),_:1})]),_:1}),t(h,{style:{margin:"20px"}},{default:o(()=>[t(U,{ref_key:"formRef",ref:y,rules:I.value,model:l,"label-width":"120px"},{default:o(()=>[t(w,null,{default:o(()=>[t(r,{xs:24,md:20,lg:15,xl:10},{default:o(()=>[t(u,{label:"公告标题",prop:"noticeTitle"},{default:o(()=>[t(d,{modelValue:l.noticeTitle,"onUpdate:modelValue":e[0]||(e[0]=m=>l.noticeTitle=m),rows:1,placeholder:"公告标题",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),t(r,{offset:2,xs:24,md:20,lg:15,xl:10},{default:o(()=>[t(u,{label:"自动打开公告",prop:"isAutoOpenNotice"},{default:o(()=>[t(A,{content:"设为自动打开则网站初始化会打开、用户仍可以选择24小时不再查看、选择关闭则不会主动打开！",placement:"top","show-after":500},{default:o(()=>[t(a,{modelValue:l.isAutoOpenNotice,"onUpdate:modelValue":e[1]||(e[1]=m=>l.isAutoOpenNotice=m),"active-value":"1","inactive-value":"0"},null,8,["modelValue"])]),_:1})]),_:1}),t(r,{xs:24,md:20,lg:15,xl:12})]),_:1})]),_:1}),t(w,null,{default:o(()=>[t(r,{span:24},{default:o(()=>[t(u,{label:"公告信息",prop:"noticeInfo"},{default:o(()=>[t(R(K),{modelValue:l.noticeInfo,"onUpdate:modelValue":e[2]||(e[2]=m=>l.noticeInfo=m),style:{"min-height":"80vh"},onOnChange:N,onOnUploadImg:k},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["rules","model"])]),_:1})])}}});typeof x=="function"&&x(L);export{L as default};
