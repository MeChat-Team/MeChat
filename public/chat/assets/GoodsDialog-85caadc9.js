import{k as $,r as v,c as l,o as Q,b as U,R as d,U as q,V as F,S as c,a2 as o,a4 as k,K as u,a8 as i,W as C,F as S,a7 as N,a6 as _,j as K,z as X}from"./vue-cbfd7fa1.js";import{a as Y}from"./crami-d8c30777.js";import{f as Z}from"./order-6324301d.js";import{e as ee}from"./user-337d128a.js";import{u as te}from"./useBasicLayout-5485175e.js";import{u as oe,c as se,t as g}from"./index-d0602d6a.js";import{C as ae}from"./CheckOne-6d4df2ce.js";import{e as ne,d as ie}from"./naive-ui-8add5bf4.js";import{C as re}from"./Close-713c54f1.js";import{_ as le}from"./_plugin-vue_export-helper-c27b6911.js";import"./vueuse-motion-6e187fab.js";import"./index-e53e2518.js";const de={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50"},ce={class:"flex justify-between items-center p-3"},ue={class:"text-xl font-bold"},ge={class:"w-full overflow-y-auto p-4 mx-auto m-2 grid grid-cols-1 gap-3 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4"},fe=["onClick"],pe={class:"relative"},me={class:"text-lg font-semibold leading-8"},ye={key:0,class:"flex justify-between items-end min-h-28"},he={class:"text-sm font-bold mr-1 w-[120px]"},ve={class:"font-bold"},_e={key:1,class:"flex justify-between items-end min-h-28"},xe={class:"text-sm font-bold mr-1 w-[120px]"},be={class:"font-bold"},we={key:2,class:"flex justify-between items-end min-h-28"},ke={class:"text-sm font-bold mr-1 w-[120px]"},Ce={class:"font-bold"},Se={class:"mt-6 flex items-baseline gap-x-1"},Ne={class:"text-4xl font-bold tracking-tight"},Me={class:"mt-6 flex flex-col gap-4"},Be=["onClick"],Pe={role:"list",class:"mt-8 space-y-3 text-sm leading-6 text-gray-600 dark:text-gray-400"},je=$({__name:"GoodsDialog",props:{visible:{type:Boolean}},setup(We){const r=oe(),p=se(),y=v(!0),x=v([]),b=ne();ie();const M=v(!1),B=l(()=>r.globalConfig.model3Name||g("goods.basicModelQuota")),{isMobile:P}=te(),j=l(()=>r.globalConfig.model4Name)||g("goods.advancedModelQuota"),W=l(()=>r.globalConfig.drawMjName)||g("goods.drawingQuota"),D=l(()=>Number(r.globalConfig.isHideModel3Point)===1),E=l(()=>Number(r.globalConfig.isHideModel4Point)===1),G=l(()=>Number(r.globalConfig.isHideDrawMjPoint)===1),I=l(()=>{var s;const e=window.navigator.userAgent.toLowerCase();return e.match(/MicroMessenger/i)&&((s=e==null?void 0:e.match(/MicroMessenger/i))==null?void 0:s[0])==="micromessenger"}),f=l(()=>{const{payHupiStatus:e,payEpayStatus:s,payMpayStatus:t,payWechatStatus:n,payLtzfStatus:a}=r.globalConfig;return Number(n)===1?"wechat":Number(t)===1?"mpay":Number(e)===1?"hupi":Number(s)===1?"epay":Number(a)===1?"ltzf":null}),L=l(()=>{const{payEpayChannel:e,payMpayChannel:s}=r.globalConfig;return f.value==="mpay"?s?JSON.parse(s):[]:f.value==="epay"?e?JSON.parse(e):[]:f.value==="wechat"?["wxpay"]:f.value==="hupi"?["wxpay"]:f.value==="ltzf"?["wxpay"]:[]});Q(()=>{A(),I.value&&z()}),U(()=>{x.value=[],y.value=!0});async function z(){const e=window.location.href.replace(/#.*$/,""),s=await ee({url:e}),{appId:t,nonceStr:n,timestamp:a,signature:m}=s.data;t&&(wx.config({debug:!1,appId:t,timestamp:a,nonceStr:n,signature:m,jsApiList:["chooseWXPay"]}),wx.ready(()=>{}),wx.error(()=>{}))}function h(e){const{appId:s,timeStamp:t,nonceStr:n,package:a,signType:m,paySign:T}=e;WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:s,timeStamp:t,nonceStr:n,package:a,signType:m,paySign:T},V=>{V.err_msg==="get_brand_wcpay_request:ok"?(b.success(g("goods.purchaseSuccess")),setTimeout(()=>{r.getUserInfo(),p.updateGoodsDialog(!1)},500)):b.success(g("goods.paymentNotSuccessful"))})}async function O(e){if(M.value)return;function s(){const t=window.navigator.userAgent.toLowerCase(),n=t.indexOf("micromessenger")!==-1,a=t.indexOf("windows")===-1&&t.indexOf("macintosh")===-1;return n&&a}if(s()&&f.value==="wechat"&&Number(r.globalConfig.payWechatStatus)===1){if(typeof WeixinJSBridge>"u")document.addEventListener?document.addEventListener("WeixinJSBridgeReady",h,!1):document.attachEvent&&(document.attachEvent("WeixinJSBridgeReady",h),document.attachEvent("onWeixinJSBridgeReady",h));else{const t=await Z({goodsId:e.id,payType:"jsapi"}),{success:n,data:a}=t;n&&h(a)}return}p.updateOrderInfo({pkgInfo:e}),p.updateGoodsDialog(!1),p.updatePayDialog(!0)}async function A(){y.value=!0;try{const e=await Y({status:1,size:30});x.value=e.data.rows,y.value=!1}catch{y.value=!1}}const w=v(""),J=e=>{w.value=e.name};function H(e){if(!L.value.length){b.warning(g("goods.paymentNotEnabled"));return}O(e)}function R(e){return e.split(`
`)}return(e,s)=>(d(),q(X,{name:"modal-fade"},{default:F(()=>[e.visible?(d(),c("div",de,[o("div",{class:k(["bg-white dark:bg-gray-900 flex flex-col relative",u(P)?" w-full h-full":"max-h-[80vh] rounded-lg shadow-lg w-full max-w-7xl p-4 mx-2 "])},[o("div",ce,[o("span",ue,i(u(g)("goods.selectProducts")),1),C(u(re),{size:"18",class:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",onClick:s[0]||(s[0]=t=>u(p).updateGoodsDialog(!1))})]),o("div",ge,[(d(!0),c(S,null,N(x.value,(t,n)=>(d(),c("div",{key:n,class:k([t.name==w.value?"ring-2 ring-indigo-500 shadow-md":"ring-2 ring-gray-200 dark:ring-gray-800 ","rounded-lg p-8 hover:shadow-md"]),onClick:a=>J(t)},[o("div",pe,[o("b",me,i(t.name),1)]),D.value?_("",!0):(d(),c("div",ye,[o("span",he,i(B.value),1),o("span",ve,i(t.model3Count>99999?"无限额度":t.model3Count),1)])),E.value?_("",!0):(d(),c("div",_e,[o("span",xe,i(u(j)),1),o("span",be,i(t.model4Count>99999?"无限额度":t.model4Count),1)])),G.value?_("",!0):(d(),c("div",we,[o("span",ke,i(u(W)),1),o("span",Ce,i(t.drawMjCount>99999?"无限额度":t.drawMjCount),1)])),o("div",Se,[o("span",Ne,i(`￥${t.price}`),1)]),o("div",Me,[o("button",{onClick:a=>H(t),class:k(["block w-full rounded-md shadow-sm px-3 py-2 text-center text-sm font-semibold leading-6",[t.name==w.value?"text-white bg-indigo-600 hover:bg-indigo-500 focus-visible:outline-offset-2 focus-visible:outline-indigo-600 focus-visible:outline focus-visible:outline-2":"ring-1 ring-primary-200 dark:ring-gray-800 dark:bg-gray-800 text-primary-500 hover:ring-primary-300 dark:hover:bg-gray-700"]])},i(u(g)("goods.buyPackage")),11,Be)]),o("ul",Pe,[(d(!0),c(S,null,N(R(t.des),(a,m)=>(d(),c("li",{key:m,class:"flex gap-x-3"},[C(u(ae),{theme:"filled",size:"24",class:"text-gray-500"}),K(" "+i(a),1)]))),128))])],10,fe))),128))])],2)])):_("",!0)]),_:1}))}});const Ve=le(je,[["__scopeId","data-v-4844baa1"]]);export{Ve as default};
