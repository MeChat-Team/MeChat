import{k as G,r as m,c as o,w as U,R as a,U as W,V as k,S as i,a2 as t,j as u,a8 as l,a6 as c,K as p,W as J,F as D,a7 as M,a4 as C,z as K}from"./vue-cbfd7fa1.js";import{p as R,l as Y,u as q,c as X,t as v}from"./index-d0602d6a.js";import{u as Z}from"./useBasicLayout-5485175e.js";import{e as $,M as ee}from"./naive-ui-8add5bf4.js";import{_ as te}from"./_plugin-vue_export-helper-c27b6911.js";import"./vueuse-motion-6e187fab.js";function se(){return R({url:"/signin/sign"})}function oe(){return Y({url:"/signin/signinLog"})}const ne={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50"},ae={class:"bg-white dark:bg-gray-900 p-6 rounded-lg shadow-lg w-full max-w-xl max-h-[80vh] overflow-y-auto"},ie={class:"flex justify-between items-center mb-4"},le={class:"text-base"},re={class:"text-[red]"},ue={class:"bg-gray-50 mb-5 p-2 rounded-md border border-gray-200 dark:border-gray-700 dark:bg-gray-700"},de={key:0},ge={class:"mx-2 text-primary-500"},ce={key:1},fe={class:"mx-2 text-primary-500"},me={key:2},pe={class:"mx-2 text-primary-500"},ve={class:"mt-2 grid grid-cols-7 text-sm"},ye=["datetime"],be={class:"flex mt-3 w-full"},_e=["disabled"],xe=G({__name:"SignInDialog",props:{visible:{type:Boolean}},setup(S){const y=S,n=q(),N=X(),d=m(!1);Z();const g=m([]),j=$(),f=m(!1),b=new Date().toISOString().split("T")[0],P=o(()=>g.value.map(e=>{var s;return{...e,day:(s=e.signInDate.split("-").pop())==null?void 0:s.replace(/^0/,""),isToday:e.signInDate===b}})),L=o(()=>n.globalConfig.model3Name||v("pay.baseModelQuota")),T=o(()=>n.globalConfig.model4Name)||v("pay.advancedModelQuota"),B=o(()=>n.globalConfig.drawMjName)||v("pay.MJDrawingQuota"),A=o(()=>Number(n.globalConfig.isHideModel3Point)===1),H=o(()=>Number(n.globalConfig.isHideModel4Point)===1),V=o(()=>Number(n.globalConfig.isHideDrawMjPoint)===1);function F(){N.updateSignInDialog(!1)}const z=o(()=>n.userInfo.consecutiveDays),_=o(()=>{var e;return Number((e=n.globalConfig)==null?void 0:e.signInModel3Count)||0}),x=o(()=>{var e;return Number((e=n.globalConfig)==null?void 0:e.signInModel4Count)||0}),w=o(()=>{var e;return Number((e=n.globalConfig)==null?void 0:e.signInMjDrawToken)||0}),h=o(()=>g.value.some(e=>e.signInDate===b&&e.isSigned));async function I(){try{d.value=!0;const e=await oe();console.log("fetchSignLogAPI response:",e),e.success&&(g.value=e.data||[],console.log("signInData:",g.value)),d.value=!1}catch(e){d.value=!1,console.error("Error fetching sign-in log:",e)}}async function E(){try{f.value=!0;const e=await se();console.log("fetchSignInAPI response:",e),e.success&&(j.success("签到成功！"),await I(),n.getUserInfo()),f.value=!1}catch(e){f.value=!1,console.error("Error during sign-in:",e)}}async function O(){d.value=!0,await I(),d.value=!1}U(()=>y.visible,e=>{e&&O()});function Q(e,s){return new Date(e,s,1).getDay()}return(e,s)=>(a(),W(K,{name:"modal-fade"},{default:k(()=>[y.visible?(a(),i("div",ne,[t("div",ae,[t("div",ie,[t("span",le,[s[2]||(s[2]=u(" 签到奖励 ")),t("span",null,[s[0]||(s[0]=u("（已连续签到")),t("b",re,l(z.value),1),s[1]||(s[1]=u("天）"))])]),t("button",{onClick:F,class:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"},s[3]||(s[3]=[t("span",{class:"sr-only"},"Close",-1),t("svg",{class:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),t("div",ue,[s[4]||(s[4]=u(" 每日签到赠送： ")),_.value>0&&!A.value?(a(),i("span",de,[t("b",ge,l(_.value),1),u(l(L.value),1)])):c("",!0),x.value>0&&!H.value?(a(),i("span",ce,[t("b",fe,l(x.value),1),u(l(p(T)),1)])):c("",!0),w.value>0&&!V.value?(a(),i("span",me,[t("b",pe,l(w.value),1),u(l(p(B)),1)])):c("",!0)]),J(p(ee),{show:d.value},{default:k(()=>[s[5]||(s[5]=t("div",{class:"mt-10 grid grid-cols-7 text-center text-xs leading-6 text-gray-500 dark:text-gray-400"},[t("div",null,"日"),t("div",null,"一"),t("div",null,"二"),t("div",null,"三"),t("div",null,"四"),t("div",null,"五"),t("div",null,"六")],-1)),t("div",ve,[(a(!0),i(D,null,M(Q(new Date().getFullYear(),new Date().getMonth()),r=>(a(),i("div",{key:"empty-"+r,class:"py-2"}))),128)),(a(!0),i(D,null,M(P.value,r=>(a(),i("div",{key:r.signInDate,class:"py-2"},[t("button",{type:"button",class:C([r.isToday?"bg-primary-600 text-white":r.isSigned?"text-primary-600":"text-gray-900 dark:text-gray-100","hover:bg-gray-200 dark:hover:bg-gray-700 mx-auto flex h-8 w-8 items-center justify-center rounded-full"])},[t("time",{datetime:r.signInDate},l(r.day),9,ye)],2)]))),128))])]),_:1},8,["show"]),t("div",be,[t("button",{class:C(["w-full py-2 px-4 rounded text-white",h.value?"bg-gray-400 cursor-not-allowed":"bg-primary-600"]),disabled:h.value,onClick:E}," 签到 ",10,_e)])])])):c("",!0)]),_:1}))}});const Ce=te(xe,[["__scopeId","data-v-8f584477"]]);export{Ce as default};
