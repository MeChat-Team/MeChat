'use strict';const _0xe0f969=_0x314e;(function(_0x119b2a,_0x4ee71b){const _0x130b3a=_0x314e,_0x36720c=_0x119b2a();while(!![]){try{const _0x1ac261=-parseInt(_0x130b3a(0x194))/0x1+parseInt(_0x130b3a(0x1a1))/0x2*(-parseInt(_0x130b3a(0x1b8))/0x3)+parseInt(_0x130b3a(0x1b2))/0x4+-parseInt(_0x130b3a(0x1ad))/0x5*(parseInt(_0x130b3a(0x1a8))/0x6)+-parseInt(_0x130b3a(0x19a))/0x7*(-parseInt(_0x130b3a(0x1b4))/0x8)+-parseInt(_0x130b3a(0x1bf))/0x9+parseInt(_0x130b3a(0x195))/0xa;if(_0x1ac261===_0x4ee71b)break;else _0x36720c['push'](_0x36720c['shift']());}catch(_0x4c6ff1){_0x36720c['push'](_0x36720c['shift']());}}}(_0x1786,0xb2376));function _0x1786(){const _0x53ca87=['30805BUSuQP','AuthService','JwtAuthGuard','metadata','user','4563476MDTYLh','validateToken','285704LvpUmM','../../modules/redisCache/redisCache.service','canActivate','__metadata','5847TVtZnK','Injectable','getOwnPropertyDescriptor','ModuleRef','RedisCacheService','@nestjs/core','object','4666428pPaGxz','err:\x20','extractToken','../../modules/auth/auth.service','UNAUTHORIZED','toString','length','handleRequest','Bearer','decorate','defineProperty','@nestjs/common','x-website-domain','authorization','1290112SXcUWs','29498720BFXyQP','redisCacheService','getJwtSecret','@nestjs/passport','GlobalConfigService','21rUCRCN','../../modules/globalConfig/globalConfig.service','authService','design:paramtypes','UnauthorizedException','verify','__decorate','786wxiAkP','slice','log','jsonwebtoken','split','AuthGuard','headers','870VbMCBW','jwt','checkTokenAuth','moduleRef','function'];_0x1786=function(){return _0x53ca87;};return _0x1786();}var __decorate=this&&this[_0xe0f969(0x1a0)]||function(_0x7fa13f,_0x289d55,_0xbd5075,_0x1e5dad){const _0x106cf5=_0xe0f969;var _0x31d140=arguments[_0x106cf5(0x1c5)],_0x38b37d=_0x31d140<0x3?_0x289d55:_0x1e5dad===null?_0x1e5dad=Object[_0x106cf5(0x1ba)](_0x289d55,_0xbd5075):_0x1e5dad,_0x5623a3;if(typeof Reflect===_0x106cf5(0x1be)&&typeof Reflect[_0x106cf5(0x1c8)]===_0x106cf5(0x1ac))_0x38b37d=Reflect['decorate'](_0x7fa13f,_0x289d55,_0xbd5075,_0x1e5dad);else{for(var _0x4b7053=_0x7fa13f['length']-0x1;_0x4b7053>=0x0;_0x4b7053--)if(_0x5623a3=_0x7fa13f[_0x4b7053])_0x38b37d=(_0x31d140<0x3?_0x5623a3(_0x38b37d):_0x31d140>0x3?_0x5623a3(_0x289d55,_0xbd5075,_0x38b37d):_0x5623a3(_0x289d55,_0xbd5075))||_0x38b37d;}return _0x31d140>0x3&&_0x38b37d&&Object[_0x106cf5(0x1c9)](_0x289d55,_0xbd5075,_0x38b37d),_0x38b37d;},__metadata=this&&this[_0xe0f969(0x1b7)]||function(_0x52f2ac,_0x22d633){const _0x2dcdc6=_0xe0f969;if(typeof Reflect===_0x2dcdc6(0x1be)&&typeof Reflect[_0x2dcdc6(0x1b0)]===_0x2dcdc6(0x1ac))return Reflect[_0x2dcdc6(0x1b0)](_0x52f2ac,_0x22d633);};Object[_0xe0f969(0x1c9)](exports,'__esModule',{'value':!![]}),exports[_0xe0f969(0x1af)]=void 0x0;function _0x314e(_0x31ccba,_0xd11500){const _0x178616=_0x1786();return _0x314e=function(_0x314ef0,_0x503358){_0x314ef0=_0x314ef0-0x191;let _0x176bba=_0x178616[_0x314ef0];return _0x176bba;},_0x314e(_0x31ccba,_0xd11500);}const globalConfig_service_1=require(_0xe0f969(0x19b)),redisCache_service_1=require(_0xe0f969(0x1b5)),common_1=require(_0xe0f969(0x191)),core_1=require(_0xe0f969(0x1bd)),passport_1=require(_0xe0f969(0x198)),jwt=require(_0xe0f969(0x1a4)),auth_service_1=require(_0xe0f969(0x1c2));let JwtAuthGuard=class JwtAuthGuard extends(0x0,passport_1[_0xe0f969(0x1a6)])(_0xe0f969(0x1a9)){constructor(_0xe3267d,_0x448f46,_0x3ae458,_0x284f81){const _0xf3afb7=_0xe0f969;super(),this[_0xf3afb7(0x196)]=_0xe3267d,this['moduleRef']=_0x448f46,this['globalConfigService']=_0x3ae458,this[_0xf3afb7(0x19c)]=_0x284f81;}async[_0xe0f969(0x1b6)](_0x5c1557){const _0x3fa756=_0xe0f969;!this['redisCacheService']&&(this[_0x3fa756(0x196)]=this[_0x3fa756(0x1ab)]['get'](redisCache_service_1['RedisCacheService'],{'strict':![]}));const _0x46a6d7=_0x5c1557['switchToHttp']()['getRequest'](),_0x14b79c=_0x46a6d7[_0x3fa756(0x1a7)][_0x3fa756(0x192)],_0x382773=this[_0x3fa756(0x1c1)](_0x46a6d7);return _0x46a6d7[_0x3fa756(0x1b1)]=await this[_0x3fa756(0x1b3)](_0x382773),await this['redisCacheService'][_0x3fa756(0x1aa)](_0x382773,_0x46a6d7),!![];}[_0xe0f969(0x1c1)](_0x375d54){const _0x2e36e2=_0xe0f969;if(!_0x375d54[_0x2e36e2(0x1a7)]['authorization']){if(_0x375d54[_0x2e36e2(0x1a7)]['fingerprint']){let _0x2dfd91=_0x375d54[_0x2e36e2(0x1a7)]['fingerprint'];_0x2dfd91>0x7fffffff&&(_0x2dfd91=_0x2dfd91[_0x2e36e2(0x1c4)]()[_0x2e36e2(0x1a2)](-0x9),_0x2dfd91=Number(String(Number(_0x2dfd91))));const _0x235254=this['authService']['createTokenFromFingerprint'](_0x2dfd91);return _0x235254;}return null;}const _0x4bfee3=_0x375d54[_0x2e36e2(0x1a7)][_0x2e36e2(0x193)][_0x2e36e2(0x1a5)]('\x20');if(_0x4bfee3['length']!==0x2||_0x4bfee3[0x0]!==_0x2e36e2(0x1c7))return null;return _0x4bfee3[0x1];}async['validateToken'](_0x261ab1){const _0x450fca=_0xe0f969;try{const _0x5c8ac0=await this[_0x450fca(0x196)][_0x450fca(0x197)](),_0x2e1a68=await jwt[_0x450fca(0x19f)](_0x261ab1,_0x5c8ac0);return _0x2e1a68;}catch(_0x4893a5){throw new common_1['HttpException']('亲爱的用户,请登录后继续操作,我们正在等您的到来！',common_1['HttpStatus'][_0x450fca(0x1c3)]);}}[_0xe0f969(0x1c6)](_0x644c12,_0xcd10f1,_0x30b608){const _0x539631=_0xe0f969;if(_0x644c12||!_0xcd10f1){console[_0x539631(0x1a3)](_0x539631(0x1c0),_0x644c12);throw _0x644c12||new common_1[(_0x539631(0x19e))]();}return _0xcd10f1;}};JwtAuthGuard=__decorate([(0x0,common_1[_0xe0f969(0x1b9)])(),__metadata(_0xe0f969(0x19d),[redisCache_service_1[_0xe0f969(0x1bc)],core_1[_0xe0f969(0x1bb)],globalConfig_service_1[_0xe0f969(0x199)],auth_service_1[_0xe0f969(0x1ae)]])],JwtAuthGuard),exports[_0xe0f969(0x1af)]=JwtAuthGuard;