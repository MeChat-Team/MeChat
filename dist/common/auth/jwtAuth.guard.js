'use strict';const _0x26172c=_0x54c8;(function(_0xb8360b,_0x554afc){const _0x27d159=_0x54c8,_0x2607e4=_0xb8360b();while(!![]){try{const _0x418d7f=-parseInt(_0x27d159(0x101))/0x1*(parseInt(_0x27d159(0x109))/0x2)+parseInt(_0x27d159(0xeb))/0x3+-parseInt(_0x27d159(0x113))/0x4+parseInt(_0x27d159(0xf6))/0x5*(-parseInt(_0x27d159(0xe5))/0x6)+parseInt(_0x27d159(0x106))/0x7*(parseInt(_0x27d159(0xe0))/0x8)+parseInt(_0x27d159(0x116))/0x9*(-parseInt(_0x27d159(0xf2))/0xa)+parseInt(_0x27d159(0xe7))/0xb*(parseInt(_0x27d159(0x10f))/0xc);if(_0x418d7f===_0x554afc)break;else _0x2607e4['push'](_0x2607e4['shift']());}catch(_0x21c3c4){_0x2607e4['push'](_0x2607e4['shift']());}}}(_0x5553,0x4b334));var __decorate=this&&this[_0x26172c(0x114)]||function(_0x2a3372,_0x13f62e,_0x3d5603,_0x28a421){const _0x135d8b=_0x26172c;var _0xebe701=arguments[_0x135d8b(0xf1)],_0x31f319=_0xebe701<0x3?_0x13f62e:_0x28a421===null?_0x28a421=Object['getOwnPropertyDescriptor'](_0x13f62e,_0x3d5603):_0x28a421,_0x1bb016;if(typeof Reflect===_0x135d8b(0xf5)&&typeof Reflect['decorate']==='function')_0x31f319=Reflect[_0x135d8b(0xdf)](_0x2a3372,_0x13f62e,_0x3d5603,_0x28a421);else{for(var _0x275c63=_0x2a3372['length']-0x1;_0x275c63>=0x0;_0x275c63--)if(_0x1bb016=_0x2a3372[_0x275c63])_0x31f319=(_0xebe701<0x3?_0x1bb016(_0x31f319):_0xebe701>0x3?_0x1bb016(_0x13f62e,_0x3d5603,_0x31f319):_0x1bb016(_0x13f62e,_0x3d5603))||_0x31f319;}return _0xebe701>0x3&&_0x31f319&&Object['defineProperty'](_0x13f62e,_0x3d5603,_0x31f319),_0x31f319;},__metadata=this&&this[_0x26172c(0xe4)]||function(_0x59c7ea,_0x5781d8){const _0x5bea30=_0x26172c;if(typeof Reflect===_0x5bea30(0xf5)&&typeof Reflect[_0x5bea30(0xf8)]===_0x5bea30(0x100))return Reflect['metadata'](_0x59c7ea,_0x5781d8);};Object[_0x26172c(0x105)](exports,_0x26172c(0x10b),{'value':!![]}),exports['JwtAuthGuard']=void 0x0;const globalConfig_service_1=require(_0x26172c(0xf0)),redisCache_service_1=require(_0x26172c(0xe6)),common_1=require(_0x26172c(0x104)),core_1=require(_0x26172c(0xf7)),passport_1=require(_0x26172c(0xf3)),jwt=require(_0x26172c(0xe8)),auth_service_1=require(_0x26172c(0x10c));function _0x5553(){const _0x6373d4=['defineProperty','107366tyoRrI','toString','ModuleRef','94310nAyDVc','Injectable','__esModule','../../modules/auth/auth.service','split','headers','246276KkigcH','authService','authorization','get','35528RihKwP','__decorate','AuthGuard','9lbUBpq','err:\x20','GlobalConfigService','verify','decorate','192iAqMji','亲爱的用户,请登录后继续操作,我们正在等您的到来！','RedisCacheService','log','__metadata','66gfQNwU','../../modules/redisCache/redisCache.service','451MrKQCf','jsonwebtoken','HttpException','redisCacheService','489180nkHgkX','UNAUTHORIZED','getRequest','JwtAuthGuard','checkTokenAuth','../../modules/globalConfig/globalConfig.service','length','5195490lAJAuB','@nestjs/passport','slice','object','29370UJaWEb','@nestjs/core','metadata','moduleRef','design:paramtypes','extractToken','x-website-domain','user','Bearer','getJwtSecret','function','10frREug','fingerprint','UnauthorizedException','@nestjs/common'];_0x5553=function(){return _0x6373d4;};return _0x5553();}let JwtAuthGuard=class JwtAuthGuard extends(0x0,passport_1[_0x26172c(0x115)])('jwt'){constructor(_0x4f8d56,_0x534416,_0x44f986,_0x437e73){const _0x2e87b2=_0x26172c;super(),this[_0x2e87b2(0xea)]=_0x4f8d56,this[_0x2e87b2(0xf9)]=_0x534416,this['globalConfigService']=_0x44f986,this[_0x2e87b2(0x110)]=_0x437e73;}async['canActivate'](_0x580b43){const _0x5a6e52=_0x26172c;!this['redisCacheService']&&(this['redisCacheService']=this['moduleRef'][_0x5a6e52(0x112)](redisCache_service_1[_0x5a6e52(0xe2)],{'strict':![]}));const _0x43ad8e=_0x580b43['switchToHttp']()[_0x5a6e52(0xed)](),_0x587072=_0x43ad8e[_0x5a6e52(0x10e)][_0x5a6e52(0xfc)],_0x3a389a=this[_0x5a6e52(0xfb)](_0x43ad8e);return _0x43ad8e[_0x5a6e52(0xfd)]=await this['validateToken'](_0x3a389a),await this['redisCacheService'][_0x5a6e52(0xef)](_0x3a389a,_0x43ad8e),!![];}[_0x26172c(0xfb)](_0x261ed6){const _0x22c65d=_0x26172c;if(!_0x261ed6['headers'][_0x22c65d(0x111)]){if(_0x261ed6[_0x22c65d(0x10e)][_0x22c65d(0x102)]){let _0x389470=_0x261ed6[_0x22c65d(0x10e)][_0x22c65d(0x102)];_0x389470>0x7fffffff&&(_0x389470=_0x389470[_0x22c65d(0x107)]()[_0x22c65d(0xf4)](-0x9),_0x389470=Number(String(Number(_0x389470))));const _0x4acd96=this[_0x22c65d(0x110)]['createTokenFromFingerprint'](_0x389470);return _0x4acd96;}return null;}const _0x3bcf43=_0x261ed6[_0x22c65d(0x10e)][_0x22c65d(0x111)][_0x22c65d(0x10d)]('\x20');if(_0x3bcf43[_0x22c65d(0xf1)]!==0x2||_0x3bcf43[0x0]!==_0x22c65d(0xfe))return null;return _0x3bcf43[0x1];}async['validateToken'](_0x10f760){const _0x1759a1=_0x26172c;try{const _0x327901=await this[_0x1759a1(0xea)][_0x1759a1(0xff)](),_0x2f33c8=await jwt[_0x1759a1(0xde)](_0x10f760,_0x327901);return _0x2f33c8;}catch(_0x254d4b){throw new common_1[(_0x1759a1(0xe9))](_0x1759a1(0xe1),common_1['HttpStatus'][_0x1759a1(0xec)]);}}['handleRequest'](_0x45d78f,_0xd4151b,_0xcf0c9d){const _0x4d6cf5=_0x26172c;if(_0x45d78f||!_0xd4151b){console[_0x4d6cf5(0xe3)](_0x4d6cf5(0x117),_0x45d78f);throw _0x45d78f||new common_1[(_0x4d6cf5(0x103))]();}return _0xd4151b;}};function _0x54c8(_0x4a3a4b,_0x14eb14){const _0x55536d=_0x5553();return _0x54c8=function(_0x54c8c2,_0x36a1fb){_0x54c8c2=_0x54c8c2-0xde;let _0x50edd6=_0x55536d[_0x54c8c2];return _0x50edd6;},_0x54c8(_0x4a3a4b,_0x14eb14);}JwtAuthGuard=__decorate([(0x0,common_1[_0x26172c(0x10a)])(),__metadata(_0x26172c(0xfa),[redisCache_service_1[_0x26172c(0xe2)],core_1[_0x26172c(0x108)],globalConfig_service_1[_0x26172c(0x118)],auth_service_1['AuthService']])],JwtAuthGuard),exports[_0x26172c(0xee)]=JwtAuthGuard;