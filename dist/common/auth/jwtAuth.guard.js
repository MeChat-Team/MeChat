'use strict';const _0x16d36c=_0xbcb4;function _0x3cbe(){const _0x1b21f9=['ModuleRef','6579JYefDO','jwt','split','authorization','function','Injectable','decorate','../../modules/globalConfig/globalConfig.service','redisCacheService','@nestjs/core','亲爱的用户,请登录后继续操作,我们正在等您的到来！','authService','Bearer','UNAUTHORIZED','3018072HNbrus','HttpException','../../modules/redisCache/redisCache.service','moduleRef','verify','getOwnPropertyDescriptor','user','1207230ZYlYln','switchToHttp','log','jsonwebtoken','321987eMVOBq','headers','24eYMgbf','14NImuWE','length','@nestjs/passport','handleRequest','AuthService','RedisCacheService','metadata','toString','__esModule','err:\x20','2030273FCMmzd','588825yAZkuZ','checkTokenAuth','extractToken','validateToken','AuthGuard','getJwtSecret','defineProperty','HttpStatus','getRequest','__metadata','../../modules/auth/auth.service','globalConfigService','5630KyvzYG','@nestjs/common','design:paramtypes','fingerprint','object','__decorate','3746112bJCBte','UnauthorizedException','slice','JwtAuthGuard'];_0x3cbe=function(){return _0x1b21f9;};return _0x3cbe();}(function(_0x3dab8c,_0x367da6){const _0xcf239d=_0xbcb4,_0x443525=_0x3dab8c();while(!![]){try{const _0x5eb040=parseInt(_0xcf239d(0x1f9))/0x1+parseInt(_0xcf239d(0x1ee))/0x2*(parseInt(_0xcf239d(0x1eb))/0x3)+parseInt(_0xcf239d(0x1e0))/0x4+-parseInt(_0xcf239d(0x1e7))/0x5*(parseInt(_0xcf239d(0x1ed))/0x6)+parseInt(_0xcf239d(0x1f8))/0x7+-parseInt(_0xcf239d(0x1cd))/0x8+parseInt(_0xcf239d(0x1d2))/0x9*(-parseInt(_0xcf239d(0x1c7))/0xa);if(_0x5eb040===_0x367da6)break;else _0x443525['push'](_0x443525['shift']());}catch(_0xafb515){_0x443525['push'](_0x443525['shift']());}}}(_0x3cbe,0x839cc));var __decorate=this&&this[_0x16d36c(0x1cc)]||function(_0x5cc292,_0xdce180,_0x293e8c,_0x266090){const _0x203737=_0x16d36c;var _0x2efa8=arguments[_0x203737(0x1ef)],_0x5bea61=_0x2efa8<0x3?_0xdce180:_0x266090===null?_0x266090=Object[_0x203737(0x1e5)](_0xdce180,_0x293e8c):_0x266090,_0x2a057a;if(typeof Reflect===_0x203737(0x1cb)&&typeof Reflect[_0x203737(0x1d8)]===_0x203737(0x1d6))_0x5bea61=Reflect[_0x203737(0x1d8)](_0x5cc292,_0xdce180,_0x293e8c,_0x266090);else{for(var _0x24bff7=_0x5cc292[_0x203737(0x1ef)]-0x1;_0x24bff7>=0x0;_0x24bff7--)if(_0x2a057a=_0x5cc292[_0x24bff7])_0x5bea61=(_0x2efa8<0x3?_0x2a057a(_0x5bea61):_0x2efa8>0x3?_0x2a057a(_0xdce180,_0x293e8c,_0x5bea61):_0x2a057a(_0xdce180,_0x293e8c))||_0x5bea61;}return _0x2efa8>0x3&&_0x5bea61&&Object['defineProperty'](_0xdce180,_0x293e8c,_0x5bea61),_0x5bea61;},__metadata=this&&this[_0x16d36c(0x202)]||function(_0x1d46d1,_0x245c56){const _0x969984=_0x16d36c;if(typeof Reflect===_0x969984(0x1cb)&&typeof Reflect[_0x969984(0x1f4)]===_0x969984(0x1d6))return Reflect[_0x969984(0x1f4)](_0x1d46d1,_0x245c56);};function _0xbcb4(_0x38de37,_0x1b96c3){const _0x3cbe7f=_0x3cbe();return _0xbcb4=function(_0xbcb424,_0x3b3318){_0xbcb424=_0xbcb424-0x1c7;let _0x26ef44=_0x3cbe7f[_0xbcb424];return _0x26ef44;},_0xbcb4(_0x38de37,_0x1b96c3);}Object[_0x16d36c(0x1ff)](exports,_0x16d36c(0x1f6),{'value':!![]}),exports[_0x16d36c(0x1d0)]=void 0x0;const globalConfig_service_1=require(_0x16d36c(0x1d9)),redisCache_service_1=require(_0x16d36c(0x1e2)),common_1=require(_0x16d36c(0x1c8)),core_1=require(_0x16d36c(0x1db)),passport_1=require(_0x16d36c(0x1f0)),jwt=require(_0x16d36c(0x1ea)),auth_service_1=require(_0x16d36c(0x203));let JwtAuthGuard=class JwtAuthGuard extends(0x0,passport_1[_0x16d36c(0x1fd)])(_0x16d36c(0x1d3)){constructor(_0xf1386,_0x8f969b,_0x22886b,_0x34e3bf){const _0x29fc8d=_0x16d36c;super(),this[_0x29fc8d(0x1da)]=_0xf1386,this['moduleRef']=_0x8f969b,this[_0x29fc8d(0x204)]=_0x22886b,this[_0x29fc8d(0x1dd)]=_0x34e3bf;}async['canActivate'](_0x3c73fa){const _0x9a9d09=_0x16d36c;!this['redisCacheService']&&(this[_0x9a9d09(0x1da)]=this[_0x9a9d09(0x1e3)]['get'](redisCache_service_1[_0x9a9d09(0x1f3)],{'strict':![]}));const _0x5f5e86=_0x3c73fa[_0x9a9d09(0x1e8)]()[_0x9a9d09(0x201)](),_0x31fe80=_0x5f5e86['headers']['x-website-domain'],_0x246429=this[_0x9a9d09(0x1fb)](_0x5f5e86);return _0x5f5e86[_0x9a9d09(0x1e6)]=await this[_0x9a9d09(0x1fc)](_0x246429),await this['redisCacheService'][_0x9a9d09(0x1fa)](_0x246429,_0x5f5e86),!![];}['extractToken'](_0x6ad29){const _0x40129c=_0x16d36c;if(!_0x6ad29['headers'][_0x40129c(0x1d5)]){if(_0x6ad29['headers'][_0x40129c(0x1ca)]){let _0x2ed808=_0x6ad29[_0x40129c(0x1ec)][_0x40129c(0x1ca)];_0x2ed808>0x7fffffff&&(_0x2ed808=_0x2ed808[_0x40129c(0x1f5)]()[_0x40129c(0x1cf)](-0x9),_0x2ed808=Number(String(Number(_0x2ed808))));const _0x1a3732=this[_0x40129c(0x1dd)]['createTokenFromFingerprint'](_0x2ed808);return _0x1a3732;}return null;}const _0xf4be68=_0x6ad29[_0x40129c(0x1ec)][_0x40129c(0x1d5)][_0x40129c(0x1d4)]('\x20');if(_0xf4be68[_0x40129c(0x1ef)]!==0x2||_0xf4be68[0x0]!==_0x40129c(0x1de))return null;return _0xf4be68[0x1];}async[_0x16d36c(0x1fc)](_0x5e997d){const _0x4a24c2=_0x16d36c;try{const _0x5c6f00=await this[_0x4a24c2(0x1da)][_0x4a24c2(0x1fe)](),_0x5903bd=await jwt[_0x4a24c2(0x1e4)](_0x5e997d,_0x5c6f00);return _0x5903bd;}catch(_0x3ca7f1){throw new common_1[(_0x4a24c2(0x1e1))](_0x4a24c2(0x1dc),common_1[_0x4a24c2(0x200)][_0x4a24c2(0x1df)]);}}[_0x16d36c(0x1f1)](_0x428e6f,_0x2b87ef,_0x218840){const _0x4e0517=_0x16d36c;if(_0x428e6f||!_0x2b87ef){console[_0x4e0517(0x1e9)](_0x4e0517(0x1f7),_0x428e6f);throw _0x428e6f||new common_1[(_0x4e0517(0x1ce))]();}return _0x2b87ef;}};JwtAuthGuard=__decorate([(0x0,common_1[_0x16d36c(0x1d7)])(),__metadata(_0x16d36c(0x1c9),[redisCache_service_1[_0x16d36c(0x1f3)],core_1[_0x16d36c(0x1d1)],globalConfig_service_1['GlobalConfigService'],auth_service_1[_0x16d36c(0x1f2)]])],JwtAuthGuard),exports['JwtAuthGuard']=JwtAuthGuard;