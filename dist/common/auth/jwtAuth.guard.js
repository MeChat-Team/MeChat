'use strict';function _0x532d(){const _0x1208f6=['canActivate','defineProperty','globalConfigService','2332209EkzBIp','authService','../../modules/redisCache/redisCache.service','metadata','err:\x20','authorization','HttpStatus','@nestjs/passport','validateToken','AuthGuard','32pdsibX','decorate','1002385CTrcsx','__decorate','48cUJvLX','length','UNAUTHORIZED','headers','jwt','x-website-domain','getJwtSecret','Bearer','redisCacheService','11290401tXVHAU','split','3HoTlpd','2060092UAAsUp','JwtAuthGuard','6GhYmlp','design:paramtypes','handleRequest','1MGRpxY','jsonwebtoken','function','toString','1992390DeNGRv','876274wuBLZx','user','@nestjs/core','createTokenFromFingerprint','../../modules/auth/auth.service','moduleRef','switchToHttp','6389120hRrOqw','object','@nestjs/common','../../modules/globalConfig/globalConfig.service','extractToken','RedisCacheService','getOwnPropertyDescriptor','fingerprint','getRequest'];_0x532d=function(){return _0x1208f6;};return _0x532d();}const _0x2dd357=_0x41fd;(function(_0x5d30e1,_0x1dce84){const _0x3f6ad8=_0x41fd,_0x222a4d=_0x5d30e1();while(!![]){try{const _0x16b13d=parseInt(_0x3f6ad8(0x1c5))/0x1*(parseInt(_0x3f6ad8(0x1c9))/0x2)+parseInt(_0x3f6ad8(0x1bf))/0x3*(parseInt(_0x3f6ad8(0x1c0))/0x4)+parseInt(_0x3f6ad8(0x1b2))/0x5*(parseInt(_0x3f6ad8(0x1c2))/0x6)+parseInt(_0x3f6ad8(0x1ca))/0x7*(parseInt(_0x3f6ad8(0x1b0))/0x8)+-parseInt(_0x3f6ad8(0x1bd))/0x9+parseInt(_0x3f6ad8(0x1d1))/0xa+-parseInt(_0x3f6ad8(0x1dd))/0xb*(parseInt(_0x3f6ad8(0x1b4))/0xc);if(_0x16b13d===_0x1dce84)break;else _0x222a4d['push'](_0x222a4d['shift']());}catch(_0x23d775){_0x222a4d['push'](_0x222a4d['shift']());}}}(_0x532d,0xb6ce2));var __decorate=this&&this[_0x2dd357(0x1b3)]||function(_0x11a2eb,_0x49b6b3,_0x295152,_0x402b0a){const _0x4cb882=_0x2dd357;var _0x1e794a=arguments['length'],_0x107b68=_0x1e794a<0x3?_0x49b6b3:_0x402b0a===null?_0x402b0a=Object[_0x4cb882(0x1d7)](_0x49b6b3,_0x295152):_0x402b0a,_0x5800ab;if(typeof Reflect===_0x4cb882(0x1d2)&&typeof Reflect[_0x4cb882(0x1b1)]===_0x4cb882(0x1c7))_0x107b68=Reflect[_0x4cb882(0x1b1)](_0x11a2eb,_0x49b6b3,_0x295152,_0x402b0a);else{for(var _0xe3174d=_0x11a2eb[_0x4cb882(0x1b5)]-0x1;_0xe3174d>=0x0;_0xe3174d--)if(_0x5800ab=_0x11a2eb[_0xe3174d])_0x107b68=(_0x1e794a<0x3?_0x5800ab(_0x107b68):_0x1e794a>0x3?_0x5800ab(_0x49b6b3,_0x295152,_0x107b68):_0x5800ab(_0x49b6b3,_0x295152))||_0x107b68;}return _0x1e794a>0x3&&_0x107b68&&Object[_0x4cb882(0x1db)](_0x49b6b3,_0x295152,_0x107b68),_0x107b68;},__metadata=this&&this['__metadata']||function(_0x2799fd,_0x301fdf){const _0x44441f=_0x2dd357;if(typeof Reflect==='object'&&typeof Reflect[_0x44441f(0x1e0)]==='function')return Reflect[_0x44441f(0x1e0)](_0x2799fd,_0x301fdf);};function _0x41fd(_0x11578e,_0x2030ac){const _0x532ded=_0x532d();return _0x41fd=function(_0x41fd7b,_0x3961be){_0x41fd7b=_0x41fd7b-0x1af;let _0x3b05e9=_0x532ded[_0x41fd7b];return _0x3b05e9;},_0x41fd(_0x11578e,_0x2030ac);}Object[_0x2dd357(0x1db)](exports,'__esModule',{'value':!![]}),exports[_0x2dd357(0x1c1)]=void 0x0;const globalConfig_service_1=require(_0x2dd357(0x1d4)),redisCache_service_1=require(_0x2dd357(0x1df)),common_1=require(_0x2dd357(0x1d3)),core_1=require(_0x2dd357(0x1cc)),passport_1=require(_0x2dd357(0x1e4)),jwt=require(_0x2dd357(0x1c6)),auth_service_1=require(_0x2dd357(0x1ce));let JwtAuthGuard=class JwtAuthGuard extends(0x0,passport_1[_0x2dd357(0x1af)])(_0x2dd357(0x1b8)){constructor(_0x1bc4c8,_0x2bcf3c,_0x5c33a3,_0x528697){const _0x3b5d63=_0x2dd357;super(),this['redisCacheService']=_0x1bc4c8,this[_0x3b5d63(0x1cf)]=_0x2bcf3c,this[_0x3b5d63(0x1dc)]=_0x5c33a3,this[_0x3b5d63(0x1de)]=_0x528697;}async[_0x2dd357(0x1da)](_0x262695){const _0xc5e6e4=_0x2dd357;!this[_0xc5e6e4(0x1bc)]&&(this[_0xc5e6e4(0x1bc)]=this[_0xc5e6e4(0x1cf)]['get'](redisCache_service_1[_0xc5e6e4(0x1d6)],{'strict':![]}));const _0x4db43d=_0x262695[_0xc5e6e4(0x1d0)]()[_0xc5e6e4(0x1d9)](),_0x2eb718=_0x4db43d[_0xc5e6e4(0x1b7)][_0xc5e6e4(0x1b9)],_0x20a793=this[_0xc5e6e4(0x1d5)](_0x4db43d);return _0x4db43d[_0xc5e6e4(0x1cb)]=await this[_0xc5e6e4(0x1e5)](_0x20a793),await this[_0xc5e6e4(0x1bc)]['checkTokenAuth'](_0x20a793,_0x4db43d),!![];}[_0x2dd357(0x1d5)](_0x47753c){const _0x495a03=_0x2dd357;if(!_0x47753c[_0x495a03(0x1b7)][_0x495a03(0x1e2)]){if(_0x47753c[_0x495a03(0x1b7)][_0x495a03(0x1d8)]){let _0x2d5f6d=_0x47753c['headers'][_0x495a03(0x1d8)];_0x2d5f6d>0x7fffffff&&(_0x2d5f6d=_0x2d5f6d[_0x495a03(0x1c8)]()['slice'](-0x9),_0x2d5f6d=Number(String(Number(_0x2d5f6d))));const _0x588a1c=this['authService'][_0x495a03(0x1cd)](_0x2d5f6d);return _0x588a1c;}return null;}const _0xc825e=_0x47753c['headers'][_0x495a03(0x1e2)][_0x495a03(0x1be)]('\x20');if(_0xc825e[_0x495a03(0x1b5)]!==0x2||_0xc825e[0x0]!==_0x495a03(0x1bb))return null;return _0xc825e[0x1];}async[_0x2dd357(0x1e5)](_0x27e5ce){const _0x5681f2=_0x2dd357;try{const _0x348b67=await this[_0x5681f2(0x1bc)][_0x5681f2(0x1ba)](),_0x4a57b4=await jwt['verify'](_0x27e5ce,_0x348b67);return _0x4a57b4;}catch(_0x13085e){throw new common_1['HttpException']('亲爱的用户,请登录后继续操作,我们正在等您的到来！',common_1[_0x5681f2(0x1e3)][_0x5681f2(0x1b6)]);}}[_0x2dd357(0x1c4)](_0x343f21,_0x227a90,_0x45c42d){const _0x3efb27=_0x2dd357;if(_0x343f21||!_0x227a90){console['log'](_0x3efb27(0x1e1),_0x343f21);throw _0x343f21||new common_1['UnauthorizedException']();}return _0x227a90;}};JwtAuthGuard=__decorate([(0x0,common_1['Injectable'])(),__metadata(_0x2dd357(0x1c3),[redisCache_service_1['RedisCacheService'],core_1['ModuleRef'],globalConfig_service_1['GlobalConfigService'],auth_service_1['AuthService']])],JwtAuthGuard),exports[_0x2dd357(0x1c1)]=JwtAuthGuard;