'use strict';function _0x1204(_0x10b293,_0x4a912a){const _0x1ff356=_0x1ff3();return _0x1204=function(_0x1204ed,_0x349eb4){_0x1204ed=_0x1204ed-0x1a9;let _0x46fbca=_0x1ff356[_0x1204ed];return _0x46fbca;},_0x1204(_0x10b293,_0x4a912a);}const _0x12c171=_0x1204;(function(_0x55d213,_0xf33ddd){const _0x3fd694=_0x1204,_0xc101fd=_0x55d213();while(!![]){try{const _0x1cc7a8=-parseInt(_0x3fd694(0x1bb))/0x1*(parseInt(_0x3fd694(0x1dc))/0x2)+-parseInt(_0x3fd694(0x1d8))/0x3*(-parseInt(_0x3fd694(0x1b3))/0x4)+parseInt(_0x3fd694(0x1ac))/0x5*(-parseInt(_0x3fd694(0x1da))/0x6)+-parseInt(_0x3fd694(0x1d1))/0x7+-parseInt(_0x3fd694(0x1c0))/0x8*(parseInt(_0x3fd694(0x1bc))/0x9)+parseInt(_0x3fd694(0x1c4))/0xa*(-parseInt(_0x3fd694(0x1d9))/0xb)+-parseInt(_0x3fd694(0x1d4))/0xc*(-parseInt(_0x3fd694(0x1b9))/0xd);if(_0x1cc7a8===_0xf33ddd)break;else _0xc101fd['push'](_0xc101fd['shift']());}catch(_0xa632ef){_0xc101fd['push'](_0xc101fd['shift']());}}}(_0x1ff3,0xa3100));function _0x1ff3(){const _0x563432=['__metadata','AuthService','HttpStatus','../../modules/redisCache/redisCache.service','length','redisCacheService','951314EokxIu','handleRequest','log','1992Jkipiv','AuthGuard','__decorate','JwtAuthGuard','657123nSWfyW','6127pltYSN','16488YEDjLT','ModuleRef','2aQSUPZ','Bearer','switchToHttp','extractToken','headers','createTokenFromFingerprint','getRequest','canActivate','fingerprint','metadata','object','validateToken','340bZxXYV','toString','user','getJwtSecret','@nestjs/core','x-website-domain','defineProperty','4wfzVub','@nestjs/passport','HttpException','design:paramtypes','slice','authService','238615TYkItP','@nestjs/common','1000055LLYgBt','9938223oXMheM','jsonwebtoken','moduleRef','decorate','8PmfGnm','split','jwt','UNAUTHORIZED','3070snBGDO','__esModule','function','getOwnPropertyDescriptor','err:\x20','checkTokenAuth','get'];_0x1ff3=function(){return _0x563432;};return _0x1ff3();}var __decorate=this&&this[_0x12c171(0x1d6)]||function(_0x6edabc,_0x4c8323,_0x15eb2f,_0x566d79){const _0x19a682=_0x12c171;var _0x2cfd9a=arguments[_0x19a682(0x1cf)],_0x53ac7c=_0x2cfd9a<0x3?_0x4c8323:_0x566d79===null?_0x566d79=Object[_0x19a682(0x1c7)](_0x4c8323,_0x15eb2f):_0x566d79,_0x5dad7d;if(typeof Reflect===_0x19a682(0x1aa)&&typeof Reflect['decorate']===_0x19a682(0x1c6))_0x53ac7c=Reflect[_0x19a682(0x1bf)](_0x6edabc,_0x4c8323,_0x15eb2f,_0x566d79);else{for(var _0x540b98=_0x6edabc[_0x19a682(0x1cf)]-0x1;_0x540b98>=0x0;_0x540b98--)if(_0x5dad7d=_0x6edabc[_0x540b98])_0x53ac7c=(_0x2cfd9a<0x3?_0x5dad7d(_0x53ac7c):_0x2cfd9a>0x3?_0x5dad7d(_0x4c8323,_0x15eb2f,_0x53ac7c):_0x5dad7d(_0x4c8323,_0x15eb2f))||_0x53ac7c;}return _0x2cfd9a>0x3&&_0x53ac7c&&Object[_0x19a682(0x1b2)](_0x4c8323,_0x15eb2f,_0x53ac7c),_0x53ac7c;},__metadata=this&&this[_0x12c171(0x1cb)]||function(_0x5bffbc,_0x2f62e6){const _0x3665db=_0x12c171;if(typeof Reflect===_0x3665db(0x1aa)&&typeof Reflect[_0x3665db(0x1a9)]==='function')return Reflect['metadata'](_0x5bffbc,_0x2f62e6);};Object[_0x12c171(0x1b2)](exports,_0x12c171(0x1c5),{'value':!![]}),exports[_0x12c171(0x1d7)]=void 0x0;const globalConfig_service_1=require('../../modules/globalConfig/globalConfig.service'),redisCache_service_1=require(_0x12c171(0x1ce)),common_1=require(_0x12c171(0x1ba)),core_1=require(_0x12c171(0x1b0)),passport_1=require(_0x12c171(0x1b4)),jwt=require(_0x12c171(0x1bd)),auth_service_1=require('../../modules/auth/auth.service');let JwtAuthGuard=class JwtAuthGuard extends(0x0,passport_1[_0x12c171(0x1d5)])(_0x12c171(0x1c2)){constructor(_0xca4dab,_0x3f434c,_0x1a969d,_0x26782e){const _0x1d0e64=_0x12c171;super(),this[_0x1d0e64(0x1d0)]=_0xca4dab,this['moduleRef']=_0x3f434c,this['globalConfigService']=_0x1a969d,this[_0x1d0e64(0x1b8)]=_0x26782e;}async[_0x12c171(0x1e3)](_0x1f9758){const _0x3214b2=_0x12c171;!this[_0x3214b2(0x1d0)]&&(this[_0x3214b2(0x1d0)]=this[_0x3214b2(0x1be)][_0x3214b2(0x1ca)](redisCache_service_1['RedisCacheService'],{'strict':![]}));const _0x56d432=_0x1f9758[_0x3214b2(0x1de)]()[_0x3214b2(0x1e2)](),_0x25238b=_0x56d432[_0x3214b2(0x1e0)][_0x3214b2(0x1b1)],_0x4ce26c=this[_0x3214b2(0x1df)](_0x56d432);return _0x56d432[_0x3214b2(0x1ae)]=await this['validateToken'](_0x4ce26c),await this[_0x3214b2(0x1d0)][_0x3214b2(0x1c9)](_0x4ce26c,_0x56d432),!![];}[_0x12c171(0x1df)](_0x3da7d4){const _0x4415ed=_0x12c171;if(!_0x3da7d4[_0x4415ed(0x1e0)]['authorization']){if(_0x3da7d4[_0x4415ed(0x1e0)][_0x4415ed(0x1e4)]){let _0x281cc5=_0x3da7d4[_0x4415ed(0x1e0)]['fingerprint'];_0x281cc5>0x7fffffff&&(_0x281cc5=_0x281cc5[_0x4415ed(0x1ad)]()[_0x4415ed(0x1b7)](-0x9),_0x281cc5=Number(String(Number(_0x281cc5))));const _0x230247=this[_0x4415ed(0x1b8)][_0x4415ed(0x1e1)](_0x281cc5);return _0x230247;}return null;}const _0xb8ba64=_0x3da7d4[_0x4415ed(0x1e0)]['authorization'][_0x4415ed(0x1c1)]('\x20');if(_0xb8ba64[_0x4415ed(0x1cf)]!==0x2||_0xb8ba64[0x0]!==_0x4415ed(0x1dd))return null;return _0xb8ba64[0x1];}async[_0x12c171(0x1ab)](_0x1fe6ef){const _0x14f11a=_0x12c171;try{const _0x2d6c54=await this[_0x14f11a(0x1d0)][_0x14f11a(0x1af)](),_0xb03f35=await jwt['verify'](_0x1fe6ef,_0x2d6c54);return _0xb03f35;}catch(_0x163671){throw new common_1[(_0x14f11a(0x1b5))]('亲爱的用户,请登录后继续操作,我们正在等您的到来！',common_1[_0x14f11a(0x1cd)][_0x14f11a(0x1c3)]);}}[_0x12c171(0x1d2)](_0x18d16b,_0x16cdee,_0x489066){const _0x3dd91d=_0x12c171;if(_0x18d16b||!_0x16cdee){console[_0x3dd91d(0x1d3)](_0x3dd91d(0x1c8),_0x18d16b);throw _0x18d16b||new common_1['UnauthorizedException']();}return _0x16cdee;}};JwtAuthGuard=__decorate([(0x0,common_1['Injectable'])(),__metadata(_0x12c171(0x1b6),[redisCache_service_1['RedisCacheService'],core_1[_0x12c171(0x1db)],globalConfig_service_1['GlobalConfigService'],auth_service_1[_0x12c171(0x1cc)]])],JwtAuthGuard),exports['JwtAuthGuard']=JwtAuthGuard;