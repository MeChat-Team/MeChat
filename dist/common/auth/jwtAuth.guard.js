'use strict';const _0xb7819b=_0x4148;function _0x2dcd(){const _0x533afd=['moduleRef','user','function','98463MMYddE','jsonwebtoken','err:\x20','__esModule','../../modules/redisCache/redisCache.service','HttpStatus','fingerprint','@nestjs/common','authorization','headers','getJwtSecret','HttpException','108AYmwoc','137389YFDBRr','globalConfigService','verify','GlobalConfigService','canActivate','JwtAuthGuard','2904450hyjldb','slice','ModuleRef','validateToken','__metadata','RedisCacheService','__decorate','length','object','split','1VUOfXc','10yhOUar','15ikcirH','defineProperty','jwt','@nestjs/passport','92sjruKT','../../modules/globalConfig/globalConfig.service','Bearer','../../modules/auth/auth.service','toString','get','193830OtGEJE','decorate','authService','5383300GaovMj','1326974cOPHMn','getOwnPropertyDescriptor','redisCacheService','design:paramtypes','getRequest','UnauthorizedException','metadata','extractToken','5804181LsQmCm','log','x-website-domain','360XeysUZ','createTokenFromFingerprint','Injectable','checkTokenAuth'];_0x2dcd=function(){return _0x533afd;};return _0x2dcd();}(function(_0x39f6c3,_0x59d739){const _0x2fe33b=_0x4148,_0x1a2c3a=_0x39f6c3();while(!![]){try{const _0x33acee=parseInt(_0x2fe33b(0x132))/0x1*(parseInt(_0x2fe33b(0x128))/0x2)+parseInt(_0x2fe33b(0x154))/0x3*(parseInt(_0x2fe33b(0x138))/0x4)+parseInt(_0x2fe33b(0x134))/0x5*(-parseInt(_0x2fe33b(0x13e))/0x6)+-parseInt(_0x2fe33b(0x122))/0x7*(-parseInt(_0x2fe33b(0x14d))/0x8)+parseInt(_0x2fe33b(0x14a))/0x9*(-parseInt(_0x2fe33b(0x133))/0xa)+-parseInt(_0x2fe33b(0x142))/0xb*(parseInt(_0x2fe33b(0x121))/0xc)+-parseInt(_0x2fe33b(0x141))/0xd;if(_0x33acee===_0x59d739)break;else _0x1a2c3a['push'](_0x1a2c3a['shift']());}catch(_0x5eb44f){_0x1a2c3a['push'](_0x1a2c3a['shift']());}}}(_0x2dcd,0xcf335));var __decorate=this&&this[_0xb7819b(0x12e)]||function(_0x47b704,_0x43b623,_0x5b4f4b,_0x1c2218){const _0x134414=_0xb7819b;var _0x405e49=arguments[_0x134414(0x12f)],_0x5bba30=_0x405e49<0x3?_0x43b623:_0x1c2218===null?_0x1c2218=Object[_0x134414(0x143)](_0x43b623,_0x5b4f4b):_0x1c2218,_0x497495;if(typeof Reflect==='object'&&typeof Reflect[_0x134414(0x13f)]===_0x134414(0x153))_0x5bba30=Reflect['decorate'](_0x47b704,_0x43b623,_0x5b4f4b,_0x1c2218);else{for(var _0x18a5f7=_0x47b704[_0x134414(0x12f)]-0x1;_0x18a5f7>=0x0;_0x18a5f7--)if(_0x497495=_0x47b704[_0x18a5f7])_0x5bba30=(_0x405e49<0x3?_0x497495(_0x5bba30):_0x405e49>0x3?_0x497495(_0x43b623,_0x5b4f4b,_0x5bba30):_0x497495(_0x43b623,_0x5b4f4b))||_0x5bba30;}return _0x405e49>0x3&&_0x5bba30&&Object[_0x134414(0x135)](_0x43b623,_0x5b4f4b,_0x5bba30),_0x5bba30;},__metadata=this&&this[_0xb7819b(0x12c)]||function(_0x58a3bc,_0x2dfa0a){const _0x192d73=_0xb7819b;if(typeof Reflect===_0x192d73(0x130)&&typeof Reflect['metadata']===_0x192d73(0x153))return Reflect[_0x192d73(0x148)](_0x58a3bc,_0x2dfa0a);};Object[_0xb7819b(0x135)](exports,_0xb7819b(0x157),{'value':!![]}),exports[_0xb7819b(0x127)]=void 0x0;const globalConfig_service_1=require(_0xb7819b(0x139)),redisCache_service_1=require(_0xb7819b(0x158)),common_1=require(_0xb7819b(0x11c)),core_1=require('@nestjs/core'),passport_1=require(_0xb7819b(0x137)),jwt=require(_0xb7819b(0x155)),auth_service_1=require(_0xb7819b(0x13b));function _0x4148(_0x619e8,_0x21156f){const _0x2dcd7a=_0x2dcd();return _0x4148=function(_0x414811,_0x9ffdc4){_0x414811=_0x414811-0x11c;let _0x1fc4c8=_0x2dcd7a[_0x414811];return _0x1fc4c8;},_0x4148(_0x619e8,_0x21156f);}let JwtAuthGuard=class JwtAuthGuard extends(0x0,passport_1['AuthGuard'])(_0xb7819b(0x136)){constructor(_0x39971a,_0x341c44,_0x2c6dc7,_0x5254e9){const _0x1bc849=_0xb7819b;super(),this[_0x1bc849(0x144)]=_0x39971a,this[_0x1bc849(0x151)]=_0x341c44,this[_0x1bc849(0x123)]=_0x2c6dc7,this[_0x1bc849(0x140)]=_0x5254e9;}async[_0xb7819b(0x126)](_0x50880d){const _0x2beee9=_0xb7819b;!this[_0x2beee9(0x144)]&&(this['redisCacheService']=this[_0x2beee9(0x151)][_0x2beee9(0x13d)](redisCache_service_1[_0x2beee9(0x12d)],{'strict':![]}));const _0x3fa6f0=_0x50880d['switchToHttp']()[_0x2beee9(0x146)](),_0x40dfe6=_0x3fa6f0[_0x2beee9(0x11e)][_0x2beee9(0x14c)],_0x41082b=this[_0x2beee9(0x149)](_0x3fa6f0);return _0x3fa6f0[_0x2beee9(0x152)]=await this['validateToken'](_0x41082b),await this[_0x2beee9(0x144)][_0x2beee9(0x150)](_0x41082b,_0x3fa6f0),!![];}[_0xb7819b(0x149)](_0x5f4621){const _0x102c15=_0xb7819b;if(!_0x5f4621[_0x102c15(0x11e)]['authorization']){if(_0x5f4621['headers'][_0x102c15(0x15a)]){let _0x1677fe=_0x5f4621[_0x102c15(0x11e)][_0x102c15(0x15a)];_0x1677fe>0x7fffffff&&(_0x1677fe=_0x1677fe[_0x102c15(0x13c)]()[_0x102c15(0x129)](-0x9),_0x1677fe=Number(String(Number(_0x1677fe))));const _0x5c4699=this['authService'][_0x102c15(0x14e)](_0x1677fe);return _0x5c4699;}return null;}const _0x32a266=_0x5f4621[_0x102c15(0x11e)][_0x102c15(0x11d)][_0x102c15(0x131)]('\x20');if(_0x32a266[_0x102c15(0x12f)]!==0x2||_0x32a266[0x0]!==_0x102c15(0x13a))return null;return _0x32a266[0x1];}async[_0xb7819b(0x12b)](_0x4ec321){const _0x76633c=_0xb7819b;try{const _0x7832b8=await this[_0x76633c(0x144)][_0x76633c(0x11f)](),_0x36fe6f=await jwt[_0x76633c(0x124)](_0x4ec321,_0x7832b8);return _0x36fe6f;}catch(_0x24bf4a){throw new common_1[(_0x76633c(0x120))]('亲爱的用户,请登录后继续操作,我们正在等您的到来！',common_1[_0x76633c(0x159)]['UNAUTHORIZED']);}}['handleRequest'](_0x574d32,_0x5be913,_0x25ec1d){const _0x36b6b7=_0xb7819b;if(_0x574d32||!_0x5be913){console[_0x36b6b7(0x14b)](_0x36b6b7(0x156),_0x574d32);throw _0x574d32||new common_1[(_0x36b6b7(0x147))]();}return _0x5be913;}};JwtAuthGuard=__decorate([(0x0,common_1[_0xb7819b(0x14f)])(),__metadata(_0xb7819b(0x145),[redisCache_service_1[_0xb7819b(0x12d)],core_1[_0xb7819b(0x12a)],globalConfig_service_1[_0xb7819b(0x125)],auth_service_1['AuthService']])],JwtAuthGuard),exports[_0xb7819b(0x127)]=JwtAuthGuard;