'use strict';const _0xaa883c=_0x4fbb;(function(_0xd04e88,_0x3b32d7){const _0x7bf0b9=_0x4fbb,_0x15bc96=_0xd04e88();while(!![]){try{const _0x26c5a8=-parseInt(_0x7bf0b9(0x9a))/0x1*(-parseInt(_0x7bf0b9(0x82))/0x2)+parseInt(_0x7bf0b9(0x7d))/0x3*(parseInt(_0x7bf0b9(0x7f))/0x4)+-parseInt(_0x7bf0b9(0x95))/0x5+-parseInt(_0x7bf0b9(0x72))/0x6+parseInt(_0x7bf0b9(0x6e))/0x7*(parseInt(_0x7bf0b9(0x9c))/0x8)+-parseInt(_0x7bf0b9(0x74))/0x9*(-parseInt(_0x7bf0b9(0x8d))/0xa)+-parseInt(_0x7bf0b9(0x73))/0xb*(parseInt(_0x7bf0b9(0x96))/0xc);if(_0x26c5a8===_0x3b32d7)break;else _0x15bc96['push'](_0x15bc96['shift']());}catch(_0x1a4a76){_0x15bc96['push'](_0x15bc96['shift']());}}}(_0x45c2,0x2f137));var __decorate=this&&this[_0xaa883c(0x98)]||function(_0x2842b3,_0x2c2c5d,_0x12fcdb,_0x28d909){const _0x19f9d2=_0xaa883c;var _0x394c23=arguments['length'],_0x595178=_0x394c23<0x3?_0x2c2c5d:_0x28d909===null?_0x28d909=Object[_0x19f9d2(0x6c)](_0x2c2c5d,_0x12fcdb):_0x28d909,_0x6cd31e;if(typeof Reflect===_0x19f9d2(0x6a)&&typeof Reflect[_0x19f9d2(0x83)]==='function')_0x595178=Reflect['decorate'](_0x2842b3,_0x2c2c5d,_0x12fcdb,_0x28d909);else{for(var _0x2e4a3d=_0x2842b3['length']-0x1;_0x2e4a3d>=0x0;_0x2e4a3d--)if(_0x6cd31e=_0x2842b3[_0x2e4a3d])_0x595178=(_0x394c23<0x3?_0x6cd31e(_0x595178):_0x394c23>0x3?_0x6cd31e(_0x2c2c5d,_0x12fcdb,_0x595178):_0x6cd31e(_0x2c2c5d,_0x12fcdb))||_0x595178;}return _0x394c23>0x3&&_0x595178&&Object[_0x19f9d2(0x90)](_0x2c2c5d,_0x12fcdb,_0x595178),_0x595178;},__metadata=this&&this[_0xaa883c(0x76)]||function(_0x53bb35,_0x2b386a){const _0x4d2516=_0xaa883c;if(typeof Reflect===_0x4d2516(0x6a)&&typeof Reflect[_0x4d2516(0x88)]===_0x4d2516(0x77))return Reflect[_0x4d2516(0x88)](_0x53bb35,_0x2b386a);};function _0x4fbb(_0x413d6f,_0x4adf76){const _0x45c21a=_0x45c2();return _0x4fbb=function(_0x4fbbb4,_0x47e40e){_0x4fbbb4=_0x4fbbb4-0x66;let _0x53bdad=_0x45c21a[_0x4fbbb4];return _0x53bdad;},_0x4fbb(_0x413d6f,_0x4adf76);}Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports['JwtAuthGuard']=void 0x0;const globalConfig_service_1=require('../../modules/globalConfig/globalConfig.service'),redisCache_service_1=require('../../modules/redisCache/redisCache.service'),common_1=require(_0xaa883c(0x6f)),core_1=require(_0xaa883c(0x9e)),passport_1=require(_0xaa883c(0x67)),jwt=require(_0xaa883c(0x6b)),auth_service_1=require(_0xaa883c(0x97));let JwtAuthGuard=class JwtAuthGuard extends(0x0,passport_1[_0xaa883c(0x7b)])(_0xaa883c(0x8b)){constructor(_0x29d2f7,_0x3ffb5a,_0x290dec,_0x2c061a){const _0x301af5=_0xaa883c;super(),this['redisCacheService']=_0x29d2f7,this[_0x301af5(0x9f)]=_0x3ffb5a,this[_0x301af5(0x8a)]=_0x290dec,this[_0x301af5(0x92)]=_0x2c061a;}async['canActivate'](_0x51e2bc){const _0xb24f33=_0xaa883c;!this[_0xb24f33(0x69)]&&(this[_0xb24f33(0x69)]=this['moduleRef']['get'](redisCache_service_1[_0xb24f33(0x68)],{'strict':![]}));const _0x448ae6=_0x51e2bc[_0xb24f33(0x7a)]()[_0xb24f33(0x79)](),_0xd7f052=_0x448ae6['headers'][_0xb24f33(0x70)],_0x482847=this[_0xb24f33(0x8c)](_0x448ae6);return _0x448ae6['user']=await this[_0xb24f33(0x8e)](_0x482847),await this['redisCacheService'][_0xb24f33(0x81)](_0x482847,_0x448ae6),!![];}[_0xaa883c(0x8c)](_0x3127a6){const _0x58388f=_0xaa883c;if(!_0x3127a6['headers']['authorization']){if(_0x3127a6[_0x58388f(0x84)][_0x58388f(0x86)]){let _0x497137=_0x3127a6['headers']['fingerprint'];_0x497137>0x7fffffff&&(_0x497137=_0x497137[_0x58388f(0x93)]()[_0x58388f(0x80)](-0x9),_0x497137=Number(String(Number(_0x497137))));const _0xfc7f9d=this['authService'][_0x58388f(0x99)](_0x497137);return _0xfc7f9d;}return null;}const _0x310f9c=_0x3127a6[_0x58388f(0x84)]['authorization'][_0x58388f(0x9d)]('\x20');if(_0x310f9c[_0x58388f(0x87)]!==0x2||_0x310f9c[0x0]!=='Bearer')return null;return _0x310f9c[0x1];}async['validateToken'](_0x390b04){const _0x56a93f=_0xaa883c;try{const _0x5a15bb=await this[_0x56a93f(0x69)][_0x56a93f(0x6d)](),_0x15f20d=await jwt[_0x56a93f(0x66)](_0x390b04,_0x5a15bb);return _0x15f20d;}catch(_0xa8d921){throw new common_1[(_0x56a93f(0x94))](_0x56a93f(0x8f),common_1[_0x56a93f(0x9b)][_0x56a93f(0x7c)]);}}['handleRequest'](_0x4f9c9e,_0x183b7b,_0x526b56){const _0x2b560d=_0xaa883c;if(_0x4f9c9e||!_0x183b7b){console[_0x2b560d(0x91)](_0x2b560d(0x85),_0x4f9c9e);throw _0x4f9c9e||new common_1['UnauthorizedException']();}return _0x183b7b;}};function _0x45c2(){const _0x5b9a1b=['AuthGuard','UNAUTHORIZED','306msrAVu','AuthService','12076pjuIzZ','slice','checkTokenAuth','2INQzZy','decorate','headers','err:\x20','fingerprint','length','metadata','design:paramtypes','globalConfigService','jwt','extractToken','1648390pwjfos','validateToken','亲爱的用户,请登录后继续操作,我们正在等您的到来！','defineProperty','log','authService','toString','HttpException','683165rKmGDd','37416owYCNG','../../modules/auth/auth.service','__decorate','createTokenFromFingerprint','248683QevEgd','HttpStatus','1184MNgyPP','split','@nestjs/core','moduleRef','GlobalConfigService','verify','@nestjs/passport','RedisCacheService','redisCacheService','object','jsonwebtoken','getOwnPropertyDescriptor','getJwtSecret','6041gBxmgi','@nestjs/common','x-website-domain','Injectable','2220384AGJtCa','528yZGkaO','9ryfxsF','JwtAuthGuard','__metadata','function','ModuleRef','getRequest','switchToHttp'];_0x45c2=function(){return _0x5b9a1b;};return _0x45c2();}JwtAuthGuard=__decorate([(0x0,common_1[_0xaa883c(0x71)])(),__metadata(_0xaa883c(0x89),[redisCache_service_1[_0xaa883c(0x68)],core_1[_0xaa883c(0x78)],globalConfig_service_1[_0xaa883c(0xa0)],auth_service_1[_0xaa883c(0x7e)]])],JwtAuthGuard),exports[_0xaa883c(0x75)]=JwtAuthGuard;