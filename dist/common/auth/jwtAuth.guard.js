'use strict';const _0x336e3a=_0x2d4f;(function(_0x22280a,_0x3e7c40){const _0x1c1fdc=_0x2d4f,_0x4592d4=_0x22280a();while(!![]){try{const _0x55d3a8=-parseInt(_0x1c1fdc(0x88))/0x1*(-parseInt(_0x1c1fdc(0x7d))/0x2)+-parseInt(_0x1c1fdc(0x68))/0x3*(-parseInt(_0x1c1fdc(0x8a))/0x4)+parseInt(_0x1c1fdc(0x83))/0x5+-parseInt(_0x1c1fdc(0x72))/0x6+-parseInt(_0x1c1fdc(0x7a))/0x7+-parseInt(_0x1c1fdc(0x93))/0x8*(parseInt(_0x1c1fdc(0x99))/0x9)+-parseInt(_0x1c1fdc(0x7f))/0xa*(-parseInt(_0x1c1fdc(0x71))/0xb);if(_0x55d3a8===_0x3e7c40)break;else _0x4592d4['push'](_0x4592d4['shift']());}catch(_0xbfe65a){_0x4592d4['push'](_0x4592d4['shift']());}}}(_0x54ee,0xd5bfb));function _0x2d4f(_0x2c2caa,_0x17fe14){const _0x54eebb=_0x54ee();return _0x2d4f=function(_0x2d4f9a,_0x21759b){_0x2d4f9a=_0x2d4f9a-0x64;let _0x48dee2=_0x54eebb[_0x2d4f9a];return _0x48dee2;},_0x2d4f(_0x2c2caa,_0x17fe14);}function _0x54ee(){const _0x28709c=['7114904HTvfpT','split','authService','../../modules/redisCache/redisCache.service','decorate','__esModule','9zCgJgM','object','headers','GlobalConfigService','JwtAuthGuard','UNAUTHORIZED','21lDcLuu','defineProperty','Injectable','log','validateToken','__metadata','extractToken','x-website-domain','fingerprint','1229833DtsYdB','2128854GXBVCI','亲爱的用户,请登录后继续操作,我们正在等您的到来！','user','ModuleRef','length','authorization','jwt','@nestjs/passport','11606609OiRotl','metadata','@nestjs/core','412NMVtxl','getJwtSecret','120ioVkvf','AuthService','HttpException','handleRequest','305375aCkaJu','__decorate','verify','RedisCacheService','redisCacheService','4015TzgdGT','toString','884556guuDDP','design:paramtypes','getOwnPropertyDescriptor','moduleRef','@nestjs/common','UnauthorizedException','../../modules/globalConfig/globalConfig.service','function','Bearer'];_0x54ee=function(){return _0x28709c;};return _0x54ee();}var __decorate=this&&this[_0x336e3a(0x84)]||function(_0x39aabf,_0xb855fe,_0x2414d5,_0xbba376){const _0x5d2380=_0x336e3a;var _0x29f14d=arguments['length'],_0x24a9c2=_0x29f14d<0x3?_0xb855fe:_0xbba376===null?_0xbba376=Object[_0x5d2380(0x8c)](_0xb855fe,_0x2414d5):_0xbba376,_0x39e391;if(typeof Reflect===_0x5d2380(0x9a)&&typeof Reflect[_0x5d2380(0x97)]===_0x5d2380(0x91))_0x24a9c2=Reflect[_0x5d2380(0x97)](_0x39aabf,_0xb855fe,_0x2414d5,_0xbba376);else{for(var _0xa87dcd=_0x39aabf[_0x5d2380(0x76)]-0x1;_0xa87dcd>=0x0;_0xa87dcd--)if(_0x39e391=_0x39aabf[_0xa87dcd])_0x24a9c2=(_0x29f14d<0x3?_0x39e391(_0x24a9c2):_0x29f14d>0x3?_0x39e391(_0xb855fe,_0x2414d5,_0x24a9c2):_0x39e391(_0xb855fe,_0x2414d5))||_0x24a9c2;}return _0x29f14d>0x3&&_0x24a9c2&&Object[_0x5d2380(0x69)](_0xb855fe,_0x2414d5,_0x24a9c2),_0x24a9c2;},__metadata=this&&this[_0x336e3a(0x6d)]||function(_0xbe768c,_0x321734){const _0x53e3cc=_0x336e3a;if(typeof Reflect===_0x53e3cc(0x9a)&&typeof Reflect[_0x53e3cc(0x7b)]===_0x53e3cc(0x91))return Reflect['metadata'](_0xbe768c,_0x321734);};Object[_0x336e3a(0x69)](exports,_0x336e3a(0x98),{'value':!![]}),exports[_0x336e3a(0x66)]=void 0x0;const globalConfig_service_1=require(_0x336e3a(0x90)),redisCache_service_1=require(_0x336e3a(0x96)),common_1=require(_0x336e3a(0x8e)),core_1=require(_0x336e3a(0x7c)),passport_1=require(_0x336e3a(0x79)),jwt=require('jsonwebtoken'),auth_service_1=require('../../modules/auth/auth.service');let JwtAuthGuard=class JwtAuthGuard extends(0x0,passport_1['AuthGuard'])(_0x336e3a(0x78)){constructor(_0x144110,_0x1b95a9,_0x30d194,_0x50be99){const _0x1ecdb6=_0x336e3a;super(),this['redisCacheService']=_0x144110,this[_0x1ecdb6(0x8d)]=_0x1b95a9,this['globalConfigService']=_0x30d194,this[_0x1ecdb6(0x95)]=_0x50be99;}async['canActivate'](_0x4b51d7){const _0x1671d8=_0x336e3a;!this['redisCacheService']&&(this[_0x1671d8(0x87)]=this[_0x1671d8(0x8d)]['get'](redisCache_service_1['RedisCacheService'],{'strict':![]}));const _0x479b35=_0x4b51d7['switchToHttp']()['getRequest'](),_0x26ca9f=_0x479b35[_0x1671d8(0x64)][_0x1671d8(0x6f)],_0x48af59=this[_0x1671d8(0x6e)](_0x479b35);return _0x479b35[_0x1671d8(0x74)]=await this[_0x1671d8(0x6c)](_0x48af59),await this[_0x1671d8(0x87)]['checkTokenAuth'](_0x48af59,_0x479b35),!![];}['extractToken'](_0x2f876b){const _0x44ebda=_0x336e3a;if(!_0x2f876b[_0x44ebda(0x64)][_0x44ebda(0x77)]){if(_0x2f876b[_0x44ebda(0x64)][_0x44ebda(0x70)]){let _0x483ca6=_0x2f876b[_0x44ebda(0x64)][_0x44ebda(0x70)];_0x483ca6>0x7fffffff&&(_0x483ca6=_0x483ca6[_0x44ebda(0x89)]()['slice'](-0x9),_0x483ca6=Number(String(Number(_0x483ca6))));const _0x293c4d=this[_0x44ebda(0x95)]['createTokenFromFingerprint'](_0x483ca6);return _0x293c4d;}return null;}const _0x32d3f0=_0x2f876b['headers'][_0x44ebda(0x77)][_0x44ebda(0x94)]('\x20');if(_0x32d3f0[_0x44ebda(0x76)]!==0x2||_0x32d3f0[0x0]!==_0x44ebda(0x92))return null;return _0x32d3f0[0x1];}async[_0x336e3a(0x6c)](_0x49c381){const _0x43ce9c=_0x336e3a;try{const _0x417ce3=await this['redisCacheService'][_0x43ce9c(0x7e)](),_0x3fe92b=await jwt[_0x43ce9c(0x85)](_0x49c381,_0x417ce3);return _0x3fe92b;}catch(_0x6f6be){throw new common_1[(_0x43ce9c(0x81))](_0x43ce9c(0x73),common_1['HttpStatus'][_0x43ce9c(0x67)]);}}[_0x336e3a(0x82)](_0x5431cd,_0x2c053a,_0x30fb98){const _0x2d3fc2=_0x336e3a;if(_0x5431cd||!_0x2c053a){console[_0x2d3fc2(0x6b)]('err:\x20',_0x5431cd);throw _0x5431cd||new common_1[(_0x2d3fc2(0x8f))]();}return _0x2c053a;}};JwtAuthGuard=__decorate([(0x0,common_1[_0x336e3a(0x6a)])(),__metadata(_0x336e3a(0x8b),[redisCache_service_1[_0x336e3a(0x86)],core_1[_0x336e3a(0x75)],globalConfig_service_1[_0x336e3a(0x65)],auth_service_1[_0x336e3a(0x80)]])],JwtAuthGuard),exports[_0x336e3a(0x66)]=JwtAuthGuard;