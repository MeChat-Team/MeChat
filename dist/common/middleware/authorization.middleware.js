'use strict';const _0x2aa20a=_0x383c;function _0x1fee(){const _0x586f62=['encrypt','5ntlXrM','function','getOwnPropertyDescriptor','RedisCacheService','2636830jSWISK','logger','design:paramtypes','headers','11QDJcWu','__esModule','9956070gMhHAY','rocketAiKey','../utils/wishCrypto','post','configVal','1669004RQdcuT','object','__metadata','decorate','AuthorizationMiddleware','发送的验证请求数据:\x20','use','60942xkcFVN','connection','2954OaJfkR','typeorm','status','code','3203301AZtUNH','true','SELECT\x20configVal\x20FROM\x20config\x20WHERE\x20configKey=?','3448gJvgxw','getTime','default','HttpStatus','../utils/baseRequest','length','baseRequest','split','/api/config/setKey','HttpException','458KMrNUh','站点未授权','redisCacheService','wishGet','Connection','Injectable','path','wishSet','站点尚未授权','host','FORBIDDEN','x-forwarded-host','json','log','stringify','metadata','29574XDRaAo','defineProperty','__decorate','远程授权验证响应:\x20'];_0x1fee=function(){return _0x586f62;};return _0x1fee();}(function(_0x42c963,_0x10533d){const _0x3a94a2=_0x383c,_0x386663=_0x42c963();while(!![]){try{const _0x2b984a=parseInt(_0x3a94a2(0x178))/0x1*(-parseInt(_0x3a94a2(0x189))/0x2)+parseInt(_0x3a94a2(0x17c))/0x3+-parseInt(_0x3a94a2(0x16f))/0x4+-parseInt(_0x3a94a2(0x160))/0x5*(parseInt(_0x3a94a2(0x176))/0x6)+parseInt(_0x3a94a2(0x164))/0x7+parseInt(_0x3a94a2(0x17f))/0x8*(parseInt(_0x3a94a2(0x15b))/0x9)+-parseInt(_0x3a94a2(0x16a))/0xa*(parseInt(_0x3a94a2(0x168))/0xb);if(_0x2b984a===_0x10533d)break;else _0x386663['push'](_0x386663['shift']());}catch(_0x307919){_0x386663['push'](_0x386663['shift']());}}}(_0x1fee,0xb9d9a));function _0x383c(_0x3dfccb,_0x292dd0){const _0x1fee10=_0x1fee();return _0x383c=function(_0x383c96,_0x5b546d){_0x383c96=_0x383c96-0x158;let _0x5ea27c=_0x1fee10[_0x383c96];return _0x5ea27c;},_0x383c(_0x3dfccb,_0x292dd0);}var __decorate=this&&this[_0x2aa20a(0x15d)]||function(_0x1886ec,_0x4812e2,_0x55cadc,_0x56dcaa){const _0x24c038=_0x2aa20a;var _0x50693d=arguments[_0x24c038(0x184)],_0x174384=_0x50693d<0x3?_0x4812e2:_0x56dcaa===null?_0x56dcaa=Object[_0x24c038(0x162)](_0x4812e2,_0x55cadc):_0x56dcaa,_0x4a4299;if(typeof Reflect===_0x24c038(0x170)&&typeof Reflect[_0x24c038(0x172)]===_0x24c038(0x161))_0x174384=Reflect[_0x24c038(0x172)](_0x1886ec,_0x4812e2,_0x55cadc,_0x56dcaa);else{for(var _0x5bc702=_0x1886ec['length']-0x1;_0x5bc702>=0x0;_0x5bc702--)if(_0x4a4299=_0x1886ec[_0x5bc702])_0x174384=(_0x50693d<0x3?_0x4a4299(_0x174384):_0x50693d>0x3?_0x4a4299(_0x4812e2,_0x55cadc,_0x174384):_0x4a4299(_0x4812e2,_0x55cadc))||_0x174384;}return _0x50693d>0x3&&_0x174384&&Object[_0x24c038(0x15c)](_0x4812e2,_0x55cadc,_0x174384),_0x174384;},__metadata=this&&this[_0x2aa20a(0x171)]||function(_0x1c0f7e,_0x531921){const _0x311a23=_0x2aa20a;if(typeof Reflect===_0x311a23(0x170)&&typeof Reflect[_0x311a23(0x15a)]===_0x311a23(0x161))return Reflect[_0x311a23(0x15a)](_0x1c0f7e,_0x531921);};Object[_0x2aa20a(0x15c)](exports,_0x2aa20a(0x169),{'value':!![]}),exports['AuthorizationMiddleware']=void 0x0;const common_1=require('@nestjs/common'),typeorm_1=require(_0x2aa20a(0x179)),redisCache_service_1=require('../../modules/redisCache/redisCache.service'),baseRequest_1=require(_0x2aa20a(0x183)),wishCrypto_1=require(_0x2aa20a(0x16c)),hourTimer=0x3c*0x3c*0x3e8;let AuthorizationMiddleware=class AuthorizationMiddleware{constructor(_0x323fe7,_0x1f6081){const _0x492f9c=_0x2aa20a;this[_0x492f9c(0x177)]=_0x323fe7,this[_0x492f9c(0x18b)]=_0x1f6081,this[_0x492f9c(0x165)]=new common_1['Logger'](_0x492f9c(0x173));}async[_0x2aa20a(0x175)](_0x4d7a5c,_0x15ccd4,_0x246c3c){const _0xe6e1f8=_0x2aa20a;var _0x334c7c,_0x5de75f;const _0x5db540=_0x4d7a5c[_0xe6e1f8(0x167)][_0xe6e1f8(0x194)]||_0x4d7a5c[_0xe6e1f8(0x167)][_0xe6e1f8(0x192)],_0x37f5bd=((_0x334c7c=_0x5db540===null||_0x5db540===void 0x0?void 0x0:_0x5db540[_0xe6e1f8(0x186)](':'))===null||_0x334c7c===void 0x0?void 0x0:_0x334c7c[0x0])||'';if(_0x4d7a5c[_0xe6e1f8(0x18f)]===_0xe6e1f8(0x187))return _0x246c3c();if(process['env']['ISDEV']===_0xe6e1f8(0x17d))return _0x246c3c();try{const _0x3ed551=_0xe6e1f8(0x16b);let _0xe9622d=await this[_0xe6e1f8(0x177)]['query'](_0xe6e1f8(0x17e),[_0x3ed551]);_0xe9622d=(_0x5de75f=_0xe9622d[0x0])===null||_0x5de75f===void 0x0?void 0x0:_0x5de75f[_0xe6e1f8(0x16e)];if(!_0xe9622d)return _0x15ccd4[_0xe6e1f8(0x17a)](0x193)[_0xe6e1f8(0x195)]({'message':_0xe6e1f8(0x191)});const _0x5655e1=await this[_0xe6e1f8(0x18b)][_0xe6e1f8(0x18c)](_0xe9622d);if(_0x5655e1)try{const _0x4cda81=new Date()[_0xe6e1f8(0x180)](),_0x5d5283=wishCrypto_1[_0xe6e1f8(0x181)]['decrypt'](_0x5655e1);if(_0x4cda81<Number(_0x5d5283))return _0x246c3c();}catch(_0x40f884){}const _0x28404e={'domain':_0x37f5bd,'authCode':_0xe9622d};this[_0xe6e1f8(0x165)][_0xe6e1f8(0x158)](_0xe6e1f8(0x174)+JSON[_0xe6e1f8(0x159)](_0x28404e));const _0x4f79ea=await(0x0,baseRequest_1[_0xe6e1f8(0x185)])({'method':_0xe6e1f8(0x16d),'url':'http://authorization.nodeai.cn/api/domainAuth/checkDomain/mechat','data':_0x28404e});this[_0xe6e1f8(0x165)]['log'](_0xe6e1f8(0x15e)+JSON[_0xe6e1f8(0x159)](_0x4f79ea));if(_0x4f79ea[_0xe6e1f8(0x17b)]==0x7)throw new common_1[(_0xe6e1f8(0x188))](_0xe6e1f8(0x18a),common_1[_0xe6e1f8(0x182)][_0xe6e1f8(0x193)]);else{const _0x4b4b16=new Date()[_0xe6e1f8(0x180)](),_0x7e785f=_0x4b4b16+hourTimer,_0x49833b=wishCrypto_1['default'][_0xe6e1f8(0x15f)](''+_0x7e785f);await this[_0xe6e1f8(0x18b)][_0xe6e1f8(0x190)](_0xe9622d,_0x49833b,0x3c*0x3c*0x1),_0x246c3c();}}catch(_0x1eae28){throw new common_1[(_0xe6e1f8(0x188))]('站点未授权',common_1[_0xe6e1f8(0x182)]['FORBIDDEN']);}}};AuthorizationMiddleware=__decorate([(0x0,common_1[_0x2aa20a(0x18e)])(),__metadata(_0x2aa20a(0x166),[typeorm_1[_0x2aa20a(0x18d)],redisCache_service_1[_0x2aa20a(0x163)]])],AuthorizationMiddleware),exports['AuthorizationMiddleware']=AuthorizationMiddleware;