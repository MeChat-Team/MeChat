'use strict';const _0x53908b=_0x5c65;function _0x5c65(_0x47c3c0,_0x19a163){const _0x20ad83=_0x20ad();return _0x5c65=function(_0x5c6588,_0x15f834){_0x5c6588=_0x5c6588-0x8a;let _0xd71758=_0x20ad83[_0x5c6588];return _0xd71758;},_0x5c65(_0x47c3c0,_0x19a163);}(function(_0x424e3c,_0x4e8799){const _0x55edb7=_0x5c65,_0x14692b=_0x424e3c();while(!![]){try{const _0x3769a6=-parseInt(_0x55edb7(0xc5))/0x1+parseInt(_0x55edb7(0x90))/0x2+parseInt(_0x55edb7(0xd1))/0x3*(-parseInt(_0x55edb7(0xd0))/0x4)+parseInt(_0x55edb7(0xc2))/0x5+parseInt(_0x55edb7(0xd6))/0x6*(parseInt(_0x55edb7(0xa8))/0x7)+-parseInt(_0x55edb7(0xa5))/0x8*(-parseInt(_0x55edb7(0xcb))/0x9)+-parseInt(_0x55edb7(0xd3))/0xa;if(_0x3769a6===_0x4e8799)break;else _0x14692b['push'](_0x14692b['shift']());}catch(_0x3d723d){_0x14692b['push'](_0x14692b['shift']());}}}(_0x20ad,0x9dc55));var __decorate=this&&this[_0x53908b(0x9a)]||function(_0x57509e,_0x485b3c,_0x10821b,_0x4a0002){const _0x200e2b=_0x53908b;var _0x25487d=arguments[_0x200e2b(0xd2)],_0x48f3c5=_0x25487d<0x3?_0x485b3c:_0x4a0002===null?_0x4a0002=Object[_0x200e2b(0xd4)](_0x485b3c,_0x10821b):_0x4a0002,_0x12103c;if(typeof Reflect===_0x200e2b(0xab)&&typeof Reflect[_0x200e2b(0xc9)]==='function')_0x48f3c5=Reflect['decorate'](_0x57509e,_0x485b3c,_0x10821b,_0x4a0002);else{for(var _0x9a019=_0x57509e['length']-0x1;_0x9a019>=0x0;_0x9a019--)if(_0x12103c=_0x57509e[_0x9a019])_0x48f3c5=(_0x25487d<0x3?_0x12103c(_0x48f3c5):_0x25487d>0x3?_0x12103c(_0x485b3c,_0x10821b,_0x48f3c5):_0x12103c(_0x485b3c,_0x10821b))||_0x48f3c5;}return _0x25487d>0x3&&_0x48f3c5&&Object[_0x200e2b(0x96)](_0x485b3c,_0x10821b,_0x48f3c5),_0x48f3c5;},__metadata=this&&this[_0x53908b(0xb9)]||function(_0x579bbf,_0x2f4cee){const _0x29ca97=_0x53908b;if(typeof Reflect===_0x29ca97(0xab)&&typeof Reflect['metadata']===_0x29ca97(0x94))return Reflect['metadata'](_0x579bbf,_0x2f4cee);},__param=this&&this[_0x53908b(0xc1)]||function(_0x21bd7b,_0x534fbd){return function(_0x4ef0c7,_0x248250){_0x534fbd(_0x4ef0c7,_0x248250,_0x21bd7b);};};Object[_0x53908b(0x96)](exports,'__esModule',{'value':!![]}),exports[_0x53908b(0xc3)]=void 0x0;function _0x20ad(){const _0x31585e=['find','6077652edIfHf','log','signin.signInTime\x20>=\x20:firstDay','default','YYYY-MM-DD\x20HH:mm:ss','./signIn.entity','获取签到数据失败！','day','1076094oVXFPN','debug','HttpException','RechargeType','function','Repository','defineProperty','push','typeorm','createQueryBuilder','__decorate','getSigninLog','globalConfigService','save','SigninEntity','YYYY-MM-DD','signin.signInDate\x20as\x20signInDate,\x20signin.isSigned\x20as\x20isSigned','SIGN_IN','andWhere','isSigned','./../globalConfig/globalConfig.service','6668008Zqvfkx','error:\x20','findOne','7OeLfXY','sign','HttpStatus','object','addBalanceToUser','../../common/utils/date','昨天没签到、今天重置天数！','../../common/constants/balance.constant','BAD_REQUEST','startOf','GlobalConfigService','userBalanceService','user','UserBalanceService','userEntity','month','format','__metadata','Injectable','saveRecordRechargeLog','signin','昨天签到了、今天是连续签到！','用户不存在','signInDate','./../userBalance/userBalance.service','__param','2060785fhmZnR','SigninService','UserEntity','560346HtEpzd','subtract','signin.signInTime\x20<=\x20:lastDay','getRawMany','decorate','InjectRepository','9lIjzey','signinEntity','getDate','今日已签到、改天再来吧!.','Logger','123572JOqrGH','18tkdMYT','length','14047140hlCwQZ','getOwnPropertyDescriptor'];_0x20ad=function(){return _0x31585e;};return _0x20ad();}const globalConfig_service_1=require(_0x53908b(0xa4)),userBalance_service_1=require(_0x53908b(0xc0)),common_1=require('@nestjs/common'),signIn_entity_1=require(_0x53908b(0x8d)),typeorm_1=require('@nestjs/typeorm'),typeorm_2=require(_0x53908b(0x98)),date_1=require(_0x53908b(0xad)),user_entity_1=require('../user/user.entity'),balance_constant_1=require(_0x53908b(0xaf));let SigninService=class SigninService{constructor(_0x5305dd,_0x5ac57c,_0x5a3f73,_0x4c5410){const _0x5be7e4=_0x53908b;this[_0x5be7e4(0xcc)]=_0x5305dd,this[_0x5be7e4(0xb6)]=_0x5ac57c,this[_0x5be7e4(0xb3)]=_0x5a3f73,this[_0x5be7e4(0x9c)]=_0x4c5410;}async[_0x53908b(0xa9)](_0x229cc8){const _0x4cbb8c=_0x53908b,{id:_0xff94d7}=_0x229cc8[_0x4cbb8c(0xb4)],_0x459c02=(0x0,date_1[_0x4cbb8c(0x8b)])(new Date())[_0x4cbb8c(0xb8)]('YYYY-MM-DD'),_0x46542f=await this[_0x4cbb8c(0xcc)][_0x4cbb8c(0xa7)]({'where':{'userId':_0xff94d7,'signInDate':_0x459c02}});if(_0x46542f)throw new common_1['HttpException'](_0x4cbb8c(0xce),common_1[_0x4cbb8c(0xaa)][_0x4cbb8c(0xb0)]);const {model3Count:_0x470711,model4Count:_0x14ebaa,drawMjCount:_0x4e71ae}=await this['globalConfigService']['getSignatureGiftConfig']();await this[_0x4cbb8c(0xcc)][_0x4cbb8c(0x9d)]({'userId':_0xff94d7,'signInTime':new Date(),'signInDate':_0x459c02,'isSigned':!![]}),await this['userBalanceService'][_0x4cbb8c(0xac)](_0xff94d7,{'model3Count':_0x470711,'model4Count':_0x14ebaa,'drawMjCount':_0x4e71ae}),await this[_0x4cbb8c(0xb3)][_0x4cbb8c(0xbb)]({'userId':_0xff94d7,'rechargeType':balance_constant_1[_0x4cbb8c(0x93)][_0x4cbb8c(0xa1)],'model3Count':_0x470711,'model4Count':_0x14ebaa,'drawMjCount':_0x4e71ae});const _0x309ab0=(0x0,date_1[_0x4cbb8c(0x8b)])(new Date())[_0x4cbb8c(0xc6)](0x1,_0x4cbb8c(0x8f))['format']('YYYY-MM-DD'),_0x30f4e6=await this[_0x4cbb8c(0xcc)][_0x4cbb8c(0xa7)]({'where':{'userId':_0xff94d7,'signInDate':_0x309ab0}});if(_0x30f4e6){common_1[_0x4cbb8c(0xcf)]['debug']('用户'+_0xff94d7+_0x4cbb8c(0xbd),_0x4cbb8c(0xc3));const _0xb4b7b5=await this[_0x4cbb8c(0xb6)][_0x4cbb8c(0xa7)]({'where':{'id':_0xff94d7}});if(!_0xb4b7b5)throw new common_1['HttpException'](_0x4cbb8c(0xbe),common_1[_0x4cbb8c(0xaa)]['BAD_REQUEST']);const {consecutiveDays:consecutiveDays=0x0}=_0xb4b7b5;await this[_0x4cbb8c(0xb6)]['update']({'id':_0xff94d7},{'consecutiveDays':consecutiveDays+0x1});}else common_1[_0x4cbb8c(0xcf)][_0x4cbb8c(0x91)]('用户'+_0xff94d7+_0x4cbb8c(0xae),_0x4cbb8c(0xc3)),await this[_0x4cbb8c(0xb6)]['update']({'id':_0xff94d7},{'consecutiveDays':0x1});return'Sign\x20in\x20successful.';}async[_0x53908b(0x9b)](_0x535cc0){const _0x3a80a4=_0x53908b;try{const {id:_0x23c54c}=_0x535cc0[_0x3a80a4(0xb4)],_0x380e5c=(0x0,date_1[_0x3a80a4(0x8b)])()[_0x3a80a4(0xb1)](_0x3a80a4(0xb7))[_0x3a80a4(0xb8)]('YYYY-MM-DD\x20HH:mm:ss'),_0x585248=(0x0,date_1[_0x3a80a4(0x8b)])()['endOf'](_0x3a80a4(0xb7))[_0x3a80a4(0xb8)](_0x3a80a4(0x8c)),_0x552196=this[_0x3a80a4(0xcc)][_0x3a80a4(0x99)](_0x3a80a4(0xbc)),_0xec8b3a=await _0x552196['select'](_0x3a80a4(0xa0))['andWhere']('signin.userId\x20=\x20:userId',{'userId':_0x535cc0[_0x3a80a4(0xb4)]['id']})['andWhere'](_0x3a80a4(0x8a),{'firstDay':_0x380e5c})[_0x3a80a4(0xa2)](_0x3a80a4(0xc7),{'lastDay':_0x585248})[_0x3a80a4(0xc8)](),_0x4f9b35=new Date(_0x380e5c),_0x2016d9=new Date(_0x585248),_0x158821=[],_0x196784=new Date(_0x4f9b35);while(_0x196784<=_0x2016d9){_0x158821['push']((0x0,date_1['default'])(new Date(_0x196784))[_0x3a80a4(0xb8)](_0x3a80a4(0x9f))),_0x196784['setDate'](_0x196784[_0x3a80a4(0xcd)]()+0x1);}const _0x37b6a5=[];for(const _0x30674a of _0x158821){const _0x6b5d58=_0xec8b3a[_0x3a80a4(0xd5)](_0x1b1364=>_0x1b1364[_0x3a80a4(0xbf)]===_0x30674a);!_0x6b5d58?_0x37b6a5[_0x3a80a4(0x97)]({'signInDate':_0x30674a,'isSigned':![]}):(_0x6b5d58[_0x3a80a4(0xa3)]=!![],_0x37b6a5[_0x3a80a4(0x97)](_0x6b5d58));}return _0x37b6a5;}catch(_0x449955){console[_0x3a80a4(0xd7)](_0x3a80a4(0xa6),_0x449955);throw new common_1[(_0x3a80a4(0x92))](_0x3a80a4(0x8e),common_1[_0x3a80a4(0xaa)][_0x3a80a4(0xb0)]);}}};SigninService=__decorate([(0x0,common_1[_0x53908b(0xba)])(),__param(0x0,(0x0,typeorm_1[_0x53908b(0xca)])(signIn_entity_1[_0x53908b(0x9e)])),__param(0x1,(0x0,typeorm_1[_0x53908b(0xca)])(user_entity_1[_0x53908b(0xc4)])),__metadata('design:paramtypes',[typeorm_2[_0x53908b(0x95)],typeorm_2[_0x53908b(0x95)],userBalance_service_1[_0x53908b(0xb5)],globalConfig_service_1[_0x53908b(0xb2)]])],SigninService),exports['SigninService']=SigninService;