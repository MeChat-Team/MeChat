'use strict';const _0x1020cf=_0x14da;(function(_0x4596f4,_0x102491){const _0x714480=_0x14da,_0x29d8db=_0x4596f4();while(!![]){try{const _0x383320=-parseInt(_0x714480(0x156))/0x1+-parseInt(_0x714480(0x14e))/0x2+-parseInt(_0x714480(0x123))/0x3+parseInt(_0x714480(0x127))/0x4+parseInt(_0x714480(0x143))/0x5*(parseInt(_0x714480(0x152))/0x6)+-parseInt(_0x714480(0x16c))/0x7*(parseInt(_0x714480(0x161))/0x8)+parseInt(_0x714480(0x15d))/0x9*(parseInt(_0x714480(0x14c))/0xa);if(_0x383320===_0x102491)break;else _0x29d8db['push'](_0x29d8db['shift']());}catch(_0x4cb179){_0x29d8db['push'](_0x29d8db['shift']());}}}(_0x2757,0xb54e4));var __decorate=this&&this[_0x1020cf(0x16e)]||function(_0x183480,_0x2b6414,_0x495bd1,_0x4c096d){const _0x329ad1=_0x1020cf;var _0x2df50f=arguments['length'],_0x4a30fa=_0x2df50f<0x3?_0x2b6414:_0x4c096d===null?_0x4c096d=Object[_0x329ad1(0x140)](_0x2b6414,_0x495bd1):_0x4c096d,_0x2cad09;if(typeof Reflect==='object'&&typeof Reflect[_0x329ad1(0x124)]===_0x329ad1(0x14f))_0x4a30fa=Reflect[_0x329ad1(0x124)](_0x183480,_0x2b6414,_0x495bd1,_0x4c096d);else{for(var _0x5439fa=_0x183480[_0x329ad1(0x136)]-0x1;_0x5439fa>=0x0;_0x5439fa--)if(_0x2cad09=_0x183480[_0x5439fa])_0x4a30fa=(_0x2df50f<0x3?_0x2cad09(_0x4a30fa):_0x2df50f>0x3?_0x2cad09(_0x2b6414,_0x495bd1,_0x4a30fa):_0x2cad09(_0x2b6414,_0x495bd1))||_0x4a30fa;}return _0x2df50f>0x3&&_0x4a30fa&&Object['defineProperty'](_0x2b6414,_0x495bd1,_0x4a30fa),_0x4a30fa;},__metadata=this&&this[_0x1020cf(0x145)]||function(_0x5f2561,_0x5bf369){const _0x393dda=_0x1020cf;if(typeof Reflect===_0x393dda(0x16d)&&typeof Reflect[_0x393dda(0x149)]===_0x393dda(0x14f))return Reflect[_0x393dda(0x149)](_0x5f2561,_0x5bf369);},__param=this&&this[_0x1020cf(0x146)]||function(_0x46fefb,_0x4ed0bd){return function(_0x52f069,_0x297133){_0x4ed0bd(_0x52f069,_0x297133,_0x46fefb);};};function _0x14da(_0x1cbfc8,_0x451668){const _0x2757d2=_0x2757();return _0x14da=function(_0x14da69,_0x512770){_0x14da69=_0x14da69-0x120;let _0x58a3f7=_0x2757d2[_0x14da69];return _0x58a3f7;},_0x14da(_0x1cbfc8,_0x451668);}Object[_0x1020cf(0x13d)](exports,_0x1020cf(0x144),{'value':!![]}),exports[_0x1020cf(0x163)]=void 0x0;const globalConfig_service_1=require(_0x1020cf(0x12e)),userBalance_service_1=require(_0x1020cf(0x167)),common_1=require(_0x1020cf(0x158)),signIn_entity_1=require(_0x1020cf(0x155)),typeorm_1=require(_0x1020cf(0x147)),typeorm_2=require(_0x1020cf(0x15a)),date_1=require(_0x1020cf(0x153)),user_entity_1=require(_0x1020cf(0x126)),balance_constant_1=require(_0x1020cf(0x13f));let SigninService=class SigninService{constructor(_0x58286d,_0x17b327,_0x31e45e,_0xbc3fbb){const _0x2b6892=_0x1020cf;this[_0x2b6892(0x159)]=_0x58286d,this[_0x2b6892(0x125)]=_0x17b327,this[_0x2b6892(0x154)]=_0x31e45e,this[_0x2b6892(0x16b)]=_0xbc3fbb;}async[_0x1020cf(0x121)](_0x5afa0d){const _0x927123=_0x1020cf,{id:_0x3c66ed}=_0x5afa0d[_0x927123(0x15c)],_0x3cfe60=(0x0,date_1[_0x927123(0x120)])(new Date())[_0x927123(0x13a)](_0x927123(0x162)),_0x8b7313=await this['signinEntity']['findOne']({'where':{'userId':_0x3c66ed,'signInDate':_0x3cfe60}});if(_0x8b7313)throw new common_1[(_0x927123(0x137))]('今日已签到、改天再来吧!.',common_1[_0x927123(0x15e)][_0x927123(0x13e)]);const {model3Count:_0x449e71,model4Count:_0x17bc32,drawMjCount:_0x2ff5c7}=await this[_0x927123(0x16b)][_0x927123(0x157)]();await this[_0x927123(0x159)][_0x927123(0x129)]({'userId':_0x3c66ed,'signInTime':new Date(),'signInDate':_0x3cfe60,'isSigned':!![]}),await this[_0x927123(0x154)][_0x927123(0x151)](_0x3c66ed,{'model3Count':_0x449e71,'model4Count':_0x17bc32,'drawMjCount':_0x2ff5c7}),await this[_0x927123(0x154)][_0x927123(0x15f)]({'userId':_0x3c66ed,'rechargeType':balance_constant_1[_0x927123(0x128)][_0x927123(0x130)],'model3Count':_0x449e71,'model4Count':_0x17bc32,'drawMjCount':_0x2ff5c7});const _0x2d8ffa=(0x0,date_1[_0x927123(0x120)])(new Date())[_0x927123(0x12c)](0x1,'day')[_0x927123(0x13a)]('YYYY-MM-DD'),_0xfe4265=await this['signinEntity'][_0x927123(0x142)]({'where':{'userId':_0x3c66ed,'signInDate':_0x2d8ffa}});if(_0xfe4265){common_1[_0x927123(0x122)][_0x927123(0x16a)]('用户'+_0x3c66ed+_0x927123(0x141),_0x927123(0x163));const _0xb4cc22=await this[_0x927123(0x125)][_0x927123(0x142)]({'where':{'id':_0x3c66ed}});if(!_0xb4cc22)throw new common_1[(_0x927123(0x137))]('用户不存在',common_1['HttpStatus'][_0x927123(0x13e)]);const {consecutiveDays:consecutiveDays=0x0}=_0xb4cc22;await this[_0x927123(0x125)][_0x927123(0x132)]({'id':_0x3c66ed},{'consecutiveDays':consecutiveDays+0x1});}else common_1['Logger'][_0x927123(0x16a)]('用户'+_0x3c66ed+_0x927123(0x150),_0x927123(0x163)),await this['userEntity']['update']({'id':_0x3c66ed},{'consecutiveDays':0x1});return _0x927123(0x15b);}async[_0x1020cf(0x138)](_0x5f565e){const _0xfb25b6=_0x1020cf;try{const {id:_0x1774f6}=_0x5f565e[_0xfb25b6(0x15c)],_0x42d078=(0x0,date_1[_0xfb25b6(0x120)])()[_0xfb25b6(0x139)]('month')['format'](_0xfb25b6(0x12b)),_0x1d8a4d=(0x0,date_1[_0xfb25b6(0x120)])()[_0xfb25b6(0x164)](_0xfb25b6(0x14a))['format'](_0xfb25b6(0x12b)),_0x3e40ad=this[_0xfb25b6(0x159)][_0xfb25b6(0x148)]('signin'),_0x557f93=await _0x3e40ad['select'](_0xfb25b6(0x160))[_0xfb25b6(0x165)](_0xfb25b6(0x133),{'userId':_0x5f565e[_0xfb25b6(0x15c)]['id']})[_0xfb25b6(0x165)](_0xfb25b6(0x13c),{'firstDay':_0x42d078})[_0xfb25b6(0x165)](_0xfb25b6(0x131),{'lastDay':_0x1d8a4d})['getRawMany'](),_0x161375=new Date(_0x42d078),_0x5150fb=new Date(_0x1d8a4d),_0x44f2ae=[],_0xa2d07e=new Date(_0x161375);while(_0xa2d07e<=_0x5150fb){_0x44f2ae[_0xfb25b6(0x12f)]((0x0,date_1['default'])(new Date(_0xa2d07e))[_0xfb25b6(0x13a)]('YYYY-MM-DD')),_0xa2d07e[_0xfb25b6(0x166)](_0xa2d07e['getDate']()+0x1);}const _0x148bf1=[];for(const _0x459c86 of _0x44f2ae){const _0x592f6f=_0x557f93[_0xfb25b6(0x135)](_0x4f780d=>_0x4f780d['signInDate']===_0x459c86);!_0x592f6f?_0x148bf1[_0xfb25b6(0x12f)]({'signInDate':_0x459c86,'isSigned':![]}):(_0x592f6f[_0xfb25b6(0x13b)]=!![],_0x148bf1['push'](_0x592f6f));}return _0x148bf1;}catch(_0x988a77){console[_0xfb25b6(0x12d)]('error:\x20',_0x988a77);throw new common_1['HttpException']('获取签到数据失败！',common_1[_0xfb25b6(0x15e)]['BAD_REQUEST']);}}};function _0x2757(){const _0x3828b4=['YYYY-MM-DD\x20HH:mm:ss','subtract','log','./../globalConfig/globalConfig.service','push','SIGN_IN','signin.signInTime\x20<=\x20:lastDay','update','signin.userId\x20=\x20:userId','UserBalanceService','find','length','HttpException','getSigninLog','startOf','format','isSigned','signin.signInTime\x20>=\x20:firstDay','defineProperty','BAD_REQUEST','../../common/constants/balance.constant','getOwnPropertyDescriptor','昨天签到了、今天是连续签到！','findOne','5jCxKin','__esModule','__metadata','__param','@nestjs/typeorm','createQueryBuilder','metadata','month','Injectable','20694830jDoIFA','InjectRepository','2784326qMaLke','function','昨天没签到、今天重置天数！','addBalanceToUser','5365104lLHORG','../../common/utils/date','userBalanceService','./signIn.entity','207548LiSsDF','getSignatureGiftConfig','@nestjs/common','signinEntity','typeorm','Sign\x20in\x20successful.','user','9rhzFPn','HttpStatus','saveRecordRechargeLog','signin.signInDate\x20as\x20signInDate,\x20signin.isSigned\x20as\x20isSigned','32cmUJbB','YYYY-MM-DD','SigninService','endOf','andWhere','setDate','./../userBalance/userBalance.service','design:paramtypes','GlobalConfigService','debug','globalConfigService','1494297kDURhu','object','__decorate','default','sign','Logger','999918vbSRpv','decorate','userEntity','../user/user.entity','2263448ldzRRL','RechargeType','save','SigninEntity'];_0x2757=function(){return _0x3828b4;};return _0x2757();}SigninService=__decorate([(0x0,common_1[_0x1020cf(0x14b)])(),__param(0x0,(0x0,typeorm_1[_0x1020cf(0x14d)])(signIn_entity_1[_0x1020cf(0x12a)])),__param(0x1,(0x0,typeorm_1[_0x1020cf(0x14d)])(user_entity_1['UserEntity'])),__metadata(_0x1020cf(0x168),[typeorm_2['Repository'],typeorm_2['Repository'],userBalance_service_1[_0x1020cf(0x134)],globalConfig_service_1[_0x1020cf(0x169)]])],SigninService),exports[_0x1020cf(0x163)]=SigninService;