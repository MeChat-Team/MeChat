'use strict';const _0x5b092c=_0x5bde;(function(_0x12df53,_0x2838a5){const _0x2f44dc=_0x5bde,_0x30c565=_0x12df53();while(!![]){try{const _0x1d0f1c=parseInt(_0x2f44dc(0xb1))/0x1+parseInt(_0x2f44dc(0xb4))/0x2+-parseInt(_0x2f44dc(0xa9))/0x3+-parseInt(_0x2f44dc(0xa4))/0x4+parseInt(_0x2f44dc(0x98))/0x5*(-parseInt(_0x2f44dc(0xd1))/0x6)+parseInt(_0x2f44dc(0xc0))/0x7+parseInt(_0x2f44dc(0xce))/0x8;if(_0x1d0f1c===_0x2838a5)break;else _0x30c565['push'](_0x30c565['shift']());}catch(_0x11624c){_0x30c565['push'](_0x30c565['shift']());}}}(_0x5093,0xb09c6));var __decorate=this&&this[_0x5b092c(0xa5)]||function(_0x46eb9f,_0x172712,_0x924e25,_0x28be38){const _0x4d288c=_0x5b092c;var _0x4f9cbd=arguments['length'],_0x54a80a=_0x4f9cbd<0x3?_0x172712:_0x28be38===null?_0x28be38=Object[_0x4d288c(0xb8)](_0x172712,_0x924e25):_0x28be38,_0x5ae36b;if(typeof Reflect===_0x4d288c(0x91)&&typeof Reflect[_0x4d288c(0xcf)]===_0x4d288c(0x89))_0x54a80a=Reflect[_0x4d288c(0xcf)](_0x46eb9f,_0x172712,_0x924e25,_0x28be38);else{for(var _0x327e85=_0x46eb9f[_0x4d288c(0xaf)]-0x1;_0x327e85>=0x0;_0x327e85--)if(_0x5ae36b=_0x46eb9f[_0x327e85])_0x54a80a=(_0x4f9cbd<0x3?_0x5ae36b(_0x54a80a):_0x4f9cbd>0x3?_0x5ae36b(_0x172712,_0x924e25,_0x54a80a):_0x5ae36b(_0x172712,_0x924e25))||_0x54a80a;}return _0x4f9cbd>0x3&&_0x54a80a&&Object[_0x4d288c(0xcc)](_0x172712,_0x924e25,_0x54a80a),_0x54a80a;},__metadata=this&&this[_0x5b092c(0xc5)]||function(_0xc3c80d,_0x5e2f93){const _0x2fae42=_0x5b092c;if(typeof Reflect===_0x2fae42(0x91)&&typeof Reflect[_0x2fae42(0x8d)]==='function')return Reflect[_0x2fae42(0x8d)](_0xc3c80d,_0x5e2f93);},__param=this&&this['__param']||function(_0x55ca16,_0x4618c3){return function(_0x4b1a7d,_0x19784b){_0x4618c3(_0x4b1a7d,_0x19784b,_0x55ca16);};};Object[_0x5b092c(0xcc)](exports,'__esModule',{'value':!![]}),exports['SigninService']=void 0x0;function _0x5bde(_0x262e44,_0x257d39){const _0x509388=_0x5093();return _0x5bde=function(_0x5bde2c,_0x503e08){_0x5bde2c=_0x5bde2c-0x88;let _0x49315f=_0x509388[_0x5bde2c];return _0x49315f;},_0x5bde(_0x262e44,_0x257d39);}function _0x5093(){const _0x3adc14=['__decorate','month','InjectRepository','save','297981dFvQCF','./../globalConfig/globalConfig.service','getSigninLog','Logger','user','GlobalConfigService','length','debug','1002993rgyFMj','signin.signInTime\x20>=\x20:firstDay','signin.signInTime\x20<=\x20:lastDay','81856poCuje','signin','findOne','update','getOwnPropertyDescriptor','andWhere','log','saveRecordRechargeLog','昨天没签到、今天重置天数！','YYYY-MM-DD','HttpStatus','获取签到数据失败！','7068670TczIPQ','@nestjs/typeorm','SigninService','getRawMany','find','__metadata','isSigned','signin.userId\x20=\x20:userId','userEntity','signin.signInDate\x20as\x20signInDate,\x20signin.isSigned\x20as\x20isSigned','default','userBalanceService','defineProperty','UserBalanceService','1141216KcZFCB','decorate','sign','17670pHktBs','signinEntity','SigninEntity','用户不存在','signInDate','function','UserEntity','select','SIGN_IN','metadata','addBalanceToUser','BAD_REQUEST','design:paramtypes','object','getSignatureGiftConfig','endOf','昨天签到了、今天是连续签到！','Sign\x20in\x20successful.','Repository','startOf','765xglshv','setDate','typeorm','subtract','今日已签到、改天再来吧!.','format','HttpException','createQueryBuilder','YYYY-MM-DD\x20HH:mm:ss','RechargeType','push','../../common/utils/date','3692292ybazsK'];_0x5093=function(){return _0x3adc14;};return _0x5093();}const globalConfig_service_1=require(_0x5b092c(0xaa)),userBalance_service_1=require('./../userBalance/userBalance.service'),common_1=require('@nestjs/common'),signIn_entity_1=require('./signIn.entity'),typeorm_1=require(_0x5b092c(0xc1)),typeorm_2=require(_0x5b092c(0x9a)),date_1=require(_0x5b092c(0xa3)),user_entity_1=require('../user/user.entity'),balance_constant_1=require('../../common/constants/balance.constant');let SigninService=class SigninService{constructor(_0x366fcd,_0x225288,_0x33ecf2,_0x8de8ce){const _0x2b0240=_0x5b092c;this[_0x2b0240(0xd2)]=_0x366fcd,this[_0x2b0240(0xc8)]=_0x225288,this[_0x2b0240(0xcb)]=_0x33ecf2,this['globalConfigService']=_0x8de8ce;}async[_0x5b092c(0xd0)](_0x3655b1){const _0x284b67=_0x5b092c,{id:_0x31fbe6}=_0x3655b1[_0x284b67(0xad)],_0xa601ae=(0x0,date_1[_0x284b67(0xca)])(new Date())[_0x284b67(0x9d)](_0x284b67(0xbd)),_0x3bde98=await this['signinEntity']['findOne']({'where':{'userId':_0x31fbe6,'signInDate':_0xa601ae}});if(_0x3bde98)throw new common_1[(_0x284b67(0x9e))](_0x284b67(0x9c),common_1[_0x284b67(0xbe)][_0x284b67(0x8f)]);const {model3Count:_0x52bdda,model4Count:_0x159466,drawMjCount:_0x1abfb6}=await this['globalConfigService'][_0x284b67(0x92)]();await this['signinEntity'][_0x284b67(0xa8)]({'userId':_0x31fbe6,'signInTime':new Date(),'signInDate':_0xa601ae,'isSigned':!![]}),await this[_0x284b67(0xcb)][_0x284b67(0x8e)](_0x31fbe6,{'model3Count':_0x52bdda,'model4Count':_0x159466,'drawMjCount':_0x1abfb6}),await this['userBalanceService'][_0x284b67(0xbb)]({'userId':_0x31fbe6,'rechargeType':balance_constant_1[_0x284b67(0xa1)][_0x284b67(0x8c)],'model3Count':_0x52bdda,'model4Count':_0x159466,'drawMjCount':_0x1abfb6});const _0x435264=(0x0,date_1[_0x284b67(0xca)])(new Date())[_0x284b67(0x9b)](0x1,'day')[_0x284b67(0x9d)]('YYYY-MM-DD'),_0x3890cd=await this[_0x284b67(0xd2)][_0x284b67(0xb6)]({'where':{'userId':_0x31fbe6,'signInDate':_0x435264}});if(_0x3890cd){common_1[_0x284b67(0xac)][_0x284b67(0xb0)]('用户'+_0x31fbe6+_0x284b67(0x94),_0x284b67(0xc2));const _0x54d7de=await this[_0x284b67(0xc8)][_0x284b67(0xb6)]({'where':{'id':_0x31fbe6}});if(!_0x54d7de)throw new common_1[(_0x284b67(0x9e))](_0x284b67(0xd4),common_1[_0x284b67(0xbe)][_0x284b67(0x8f)]);const {consecutiveDays:consecutiveDays=0x0}=_0x54d7de;await this[_0x284b67(0xc8)][_0x284b67(0xb7)]({'id':_0x31fbe6},{'consecutiveDays':consecutiveDays+0x1});}else common_1['Logger']['debug']('用户'+_0x31fbe6+_0x284b67(0xbc),_0x284b67(0xc2)),await this['userEntity'][_0x284b67(0xb7)]({'id':_0x31fbe6},{'consecutiveDays':0x1});return _0x284b67(0x95);}async[_0x5b092c(0xab)](_0x45b003){const _0x24144f=_0x5b092c;try{const {id:_0xba8258}=_0x45b003['user'],_0x4d80f8=(0x0,date_1[_0x24144f(0xca)])()[_0x24144f(0x97)]('month')[_0x24144f(0x9d)](_0x24144f(0xa0)),_0x4fc8b5=(0x0,date_1[_0x24144f(0xca)])()[_0x24144f(0x93)](_0x24144f(0xa6))[_0x24144f(0x9d)](_0x24144f(0xa0)),_0x3b4078=this[_0x24144f(0xd2)][_0x24144f(0x9f)](_0x24144f(0xb5)),_0x225951=await _0x3b4078[_0x24144f(0x8b)](_0x24144f(0xc9))[_0x24144f(0xb9)](_0x24144f(0xc7),{'userId':_0x45b003['user']['id']})[_0x24144f(0xb9)](_0x24144f(0xb2),{'firstDay':_0x4d80f8})[_0x24144f(0xb9)](_0x24144f(0xb3),{'lastDay':_0x4fc8b5})[_0x24144f(0xc3)](),_0x1bbc3e=new Date(_0x4d80f8),_0x1c585c=new Date(_0x4fc8b5),_0x308bf2=[],_0x32050c=new Date(_0x1bbc3e);while(_0x32050c<=_0x1c585c){_0x308bf2[_0x24144f(0xa2)]((0x0,date_1['default'])(new Date(_0x32050c))[_0x24144f(0x9d)](_0x24144f(0xbd))),_0x32050c[_0x24144f(0x99)](_0x32050c['getDate']()+0x1);}const _0x546bb8=[];for(const _0x5100d7 of _0x308bf2){const _0x41e059=_0x225951[_0x24144f(0xc4)](_0x312924=>_0x312924[_0x24144f(0x88)]===_0x5100d7);!_0x41e059?_0x546bb8[_0x24144f(0xa2)]({'signInDate':_0x5100d7,'isSigned':![]}):(_0x41e059[_0x24144f(0xc6)]=!![],_0x546bb8[_0x24144f(0xa2)](_0x41e059));}return _0x546bb8;}catch(_0x5581fa){console[_0x24144f(0xba)]('error:\x20',_0x5581fa);throw new common_1['HttpException'](_0x24144f(0xbf),common_1[_0x24144f(0xbe)][_0x24144f(0x8f)]);}}};SigninService=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,typeorm_1[_0x5b092c(0xa7)])(signIn_entity_1[_0x5b092c(0xd3)])),__param(0x1,(0x0,typeorm_1[_0x5b092c(0xa7)])(user_entity_1[_0x5b092c(0x8a)])),__metadata(_0x5b092c(0x90),[typeorm_2[_0x5b092c(0x96)],typeorm_2[_0x5b092c(0x96)],userBalance_service_1[_0x5b092c(0xcd)],globalConfig_service_1[_0x5b092c(0xae)]])],SigninService),exports['SigninService']=SigninService;