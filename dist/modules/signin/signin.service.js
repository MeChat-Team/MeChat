'use strict';const _0x4f3cc0=_0xa5f6;function _0xa5f6(_0x1657ef,_0x9c5953){const _0x17c78d=_0x17c7();return _0xa5f6=function(_0xa5f611,_0x44c49d){_0xa5f611=_0xa5f611-0x113;let _0x597a60=_0x17c78d[_0xa5f611];return _0x597a60;},_0xa5f6(_0x1657ef,_0x9c5953);}(function(_0x50543e,_0x27925c){const _0x2a96ad=_0xa5f6,_0x1d99b6=_0x50543e();while(!![]){try{const _0x52b243=-parseInt(_0x2a96ad(0x140))/0x1+-parseInt(_0x2a96ad(0x11f))/0x2+parseInt(_0x2a96ad(0x157))/0x3*(-parseInt(_0x2a96ad(0x147))/0x4)+parseInt(_0x2a96ad(0x12f))/0x5*(-parseInt(_0x2a96ad(0x121))/0x6)+-parseInt(_0x2a96ad(0x117))/0x7*(parseInt(_0x2a96ad(0x129))/0x8)+parseInt(_0x2a96ad(0x136))/0x9+parseInt(_0x2a96ad(0x14b))/0xa;if(_0x52b243===_0x27925c)break;else _0x1d99b6['push'](_0x1d99b6['shift']());}catch(_0x3f7977){_0x1d99b6['push'](_0x1d99b6['shift']());}}}(_0x17c7,0x3a031));var __decorate=this&&this['__decorate']||function(_0x1ec5c3,_0x4b54de,_0x3642bf,_0x3e4a86){const _0x20d50c=_0xa5f6;var _0x34716b=arguments['length'],_0x339ce6=_0x34716b<0x3?_0x4b54de:_0x3e4a86===null?_0x3e4a86=Object['getOwnPropertyDescriptor'](_0x4b54de,_0x3642bf):_0x3e4a86,_0x2f4f39;if(typeof Reflect==='object'&&typeof Reflect[_0x20d50c(0x13a)]===_0x20d50c(0x113))_0x339ce6=Reflect[_0x20d50c(0x13a)](_0x1ec5c3,_0x4b54de,_0x3642bf,_0x3e4a86);else{for(var _0x49aea1=_0x1ec5c3['length']-0x1;_0x49aea1>=0x0;_0x49aea1--)if(_0x2f4f39=_0x1ec5c3[_0x49aea1])_0x339ce6=(_0x34716b<0x3?_0x2f4f39(_0x339ce6):_0x34716b>0x3?_0x2f4f39(_0x4b54de,_0x3642bf,_0x339ce6):_0x2f4f39(_0x4b54de,_0x3642bf))||_0x339ce6;}return _0x34716b>0x3&&_0x339ce6&&Object[_0x20d50c(0x120)](_0x4b54de,_0x3642bf,_0x339ce6),_0x339ce6;},__metadata=this&&this[_0x4f3cc0(0x14a)]||function(_0x58f3ef,_0x27f2dd){const _0x79cb0c=_0x4f3cc0;if(typeof Reflect===_0x79cb0c(0x137)&&typeof Reflect[_0x79cb0c(0x135)]===_0x79cb0c(0x113))return Reflect[_0x79cb0c(0x135)](_0x58f3ef,_0x27f2dd);},__param=this&&this[_0x4f3cc0(0x151)]||function(_0x5d4175,_0x56572c){return function(_0x100aa2,_0x5dff36){_0x56572c(_0x100aa2,_0x5dff36,_0x5d4175);};};Object[_0x4f3cc0(0x120)](exports,'__esModule',{'value':!![]}),exports[_0x4f3cc0(0x11d)]=void 0x0;const globalConfig_service_1=require(_0x4f3cc0(0x139)),userBalance_service_1=require(_0x4f3cc0(0x126)),common_1=require('@nestjs/common'),signIn_entity_1=require('./signIn.entity'),typeorm_1=require(_0x4f3cc0(0x14c)),typeorm_2=require(_0x4f3cc0(0x116)),date_1=require(_0x4f3cc0(0x11c)),user_entity_1=require('../user/user.entity'),balance_constant_1=require(_0x4f3cc0(0x13d));let SigninService=class SigninService{constructor(_0x2abee0,_0x1e7f6a,_0x2d5120,_0x4bf76e){const _0x31677c=_0x4f3cc0;this[_0x31677c(0x13c)]=_0x2abee0,this[_0x31677c(0x144)]=_0x1e7f6a,this['userBalanceService']=_0x2d5120,this[_0x31677c(0x133)]=_0x4bf76e;}async['sign'](_0x171c39){const _0x1918d5=_0x4f3cc0,{id:_0x810e73}=_0x171c39['user'],_0x4844fd=(0x0,date_1[_0x1918d5(0x119)])(new Date())[_0x1918d5(0x125)](_0x1918d5(0x128)),_0x5583c8=await this[_0x1918d5(0x13c)][_0x1918d5(0x13f)]({'where':{'userId':_0x810e73,'signInDate':_0x4844fd}});if(_0x5583c8)throw new common_1[(_0x1918d5(0x15b))](_0x1918d5(0x114),common_1[_0x1918d5(0x153)][_0x1918d5(0x132)]);const {model3Count:_0x40954d,model4Count:_0x458035,drawMjCount:_0x1453c5}=await this[_0x1918d5(0x133)][_0x1918d5(0x159)]();await this[_0x1918d5(0x13c)][_0x1918d5(0x13e)]({'userId':_0x810e73,'signInTime':new Date(),'signInDate':_0x4844fd,'isSigned':!![]}),await this[_0x1918d5(0x124)][_0x1918d5(0x12d)](_0x810e73,{'model3Count':_0x40954d,'model4Count':_0x458035,'drawMjCount':_0x1453c5}),await this[_0x1918d5(0x124)]['saveRecordRechargeLog']({'userId':_0x810e73,'rechargeType':balance_constant_1[_0x1918d5(0x115)][_0x1918d5(0x11a)],'model3Count':_0x40954d,'model4Count':_0x458035,'drawMjCount':_0x1453c5});const _0x440371=(0x0,date_1['default'])(new Date())['subtract'](0x1,_0x1918d5(0x145))[_0x1918d5(0x125)](_0x1918d5(0x128)),_0x1c54a0=await this[_0x1918d5(0x13c)][_0x1918d5(0x13f)]({'where':{'userId':_0x810e73,'signInDate':_0x440371}});if(_0x1c54a0){common_1[_0x1918d5(0x138)]['debug']('用户'+_0x810e73+_0x1918d5(0x13b),_0x1918d5(0x11d));const _0x353476=await this[_0x1918d5(0x144)][_0x1918d5(0x13f)]({'where':{'id':_0x810e73}});if(!_0x353476)throw new common_1[(_0x1918d5(0x15b))](_0x1918d5(0x156),common_1['HttpStatus']['BAD_REQUEST']);const {consecutiveDays:consecutiveDays=0x0}=_0x353476;await this[_0x1918d5(0x144)]['update']({'id':_0x810e73},{'consecutiveDays':consecutiveDays+0x1});}else common_1[_0x1918d5(0x138)][_0x1918d5(0x150)]('用户'+_0x810e73+_0x1918d5(0x14f),_0x1918d5(0x11d)),await this[_0x1918d5(0x144)][_0x1918d5(0x12c)]({'id':_0x810e73},{'consecutiveDays':0x1});return'Sign\x20in\x20successful.';}async['getSigninLog'](_0xdb27a3){const _0x57681e=_0x4f3cc0;try{const {id:_0x17ccd0}=_0xdb27a3[_0x57681e(0x12e)],_0x4b66b9=(0x0,date_1['default'])()[_0x57681e(0x15a)](_0x57681e(0x122))[_0x57681e(0x125)](_0x57681e(0x143)),_0x50bf4a=(0x0,date_1[_0x57681e(0x119)])()[_0x57681e(0x130)]('month')[_0x57681e(0x125)](_0x57681e(0x143)),_0x4b2eed=this[_0x57681e(0x13c)][_0x57681e(0x154)](_0x57681e(0x11b)),_0x2af7f6=await _0x4b2eed[_0x57681e(0x134)]('signin.signInDate\x20as\x20signInDate,\x20signin.isSigned\x20as\x20isSigned')[_0x57681e(0x11e)](_0x57681e(0x118),{'userId':_0xdb27a3[_0x57681e(0x12e)]['id']})[_0x57681e(0x11e)]('signin.signInTime\x20>=\x20:firstDay',{'firstDay':_0x4b66b9})[_0x57681e(0x11e)](_0x57681e(0x123),{'lastDay':_0x50bf4a})['getRawMany'](),_0x410e4f=new Date(_0x4b66b9),_0x15043b=new Date(_0x50bf4a),_0x10e3c3=[],_0x38dfe2=new Date(_0x410e4f);while(_0x38dfe2<=_0x15043b){_0x10e3c3[_0x57681e(0x148)]((0x0,date_1[_0x57681e(0x119)])(new Date(_0x38dfe2))['format'](_0x57681e(0x128))),_0x38dfe2[_0x57681e(0x152)](_0x38dfe2[_0x57681e(0x146)]()+0x1);}const _0x27c07a=[];for(const _0x3be29b of _0x10e3c3){const _0x5c20cd=_0x2af7f6[_0x57681e(0x141)](_0x30d0dd=>_0x30d0dd[_0x57681e(0x15c)]===_0x3be29b);!_0x5c20cd?_0x27c07a[_0x57681e(0x148)]({'signInDate':_0x3be29b,'isSigned':![]}):(_0x5c20cd[_0x57681e(0x158)]=!![],_0x27c07a['push'](_0x5c20cd));}return _0x27c07a;}catch(_0x20b2bb){console[_0x57681e(0x12b)](_0x57681e(0x14d),_0x20b2bb);throw new common_1[(_0x57681e(0x15b))](_0x57681e(0x149),common_1[_0x57681e(0x153)]['BAD_REQUEST']);}}};function _0x17c7(){const _0x6b5c97=['InjectRepository','BAD_REQUEST','globalConfigService','select','metadata','340272jGZUYz','object','Logger','./../globalConfig/globalConfig.service','decorate','昨天签到了、今天是连续签到！','signinEntity','../../common/constants/balance.constant','save','findOne','448671nckmEz','find','Repository','YYYY-MM-DD\x20HH:mm:ss','userEntity','day','getDate','60zzxknW','push','获取签到数据失败！','__metadata','15888510ItmyON','@nestjs/typeorm','error:\x20','design:paramtypes','昨天没签到、今天重置天数！','debug','__param','setDate','HttpStatus','createQueryBuilder','GlobalConfigService','用户不存在','71943emEpPc','isSigned','getSignatureGiftConfig','startOf','HttpException','signInDate','function','今日已签到、改天再来吧!.','RechargeType','typeorm','56YtLWRW','signin.userId\x20=\x20:userId','default','SIGN_IN','signin','../../common/utils/date','SigninService','andWhere','94320NipqLB','defineProperty','144SCSrSQ','month','signin.signInTime\x20<=\x20:lastDay','userBalanceService','format','./../userBalance/userBalance.service','UserBalanceService','YYYY-MM-DD','332376BSykCq','Injectable','log','update','addBalanceToUser','user','41900DXhMnS','endOf'];_0x17c7=function(){return _0x6b5c97;};return _0x17c7();}SigninService=__decorate([(0x0,common_1[_0x4f3cc0(0x12a)])(),__param(0x0,(0x0,typeorm_1[_0x4f3cc0(0x131)])(signIn_entity_1['SigninEntity'])),__param(0x1,(0x0,typeorm_1[_0x4f3cc0(0x131)])(user_entity_1['UserEntity'])),__metadata(_0x4f3cc0(0x14e),[typeorm_2[_0x4f3cc0(0x142)],typeorm_2['Repository'],userBalance_service_1[_0x4f3cc0(0x127)],globalConfig_service_1[_0x4f3cc0(0x155)]])],SigninService),exports[_0x4f3cc0(0x11d)]=SigninService;