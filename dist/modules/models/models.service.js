'use strict';function _0x18a0(_0xc07202,_0x3c1abb){const _0x5a4715=_0x5a47();return _0x18a0=function(_0x18a0f1,_0x1142e4){_0x18a0f1=_0x18a0f1-0x9a;let _0x1e57ea=_0x5a4715[_0x18a0f1];return _0x1e57ea;},_0x18a0(_0xc07202,_0x3c1abb);}const _0x5be1fd=_0x18a0;(function(_0x48591b,_0x111911){const _0x3c13a6=_0x18a0,_0x3e5899=_0x48591b();while(!![]){try{const _0x3b40af=-parseInt(_0x3c13a6(0x9d))/0x1*(-parseInt(_0x3c13a6(0xd9))/0x2)+-parseInt(_0x3c13a6(0xb4))/0x3*(-parseInt(_0x3c13a6(0xeb))/0x4)+-parseInt(_0x3c13a6(0xa5))/0x5*(parseInt(_0x3c13a6(0xf4))/0x6)+-parseInt(_0x3c13a6(0xc6))/0x7+-parseInt(_0x3c13a6(0xdf))/0x8*(parseInt(_0x3c13a6(0xa2))/0x9)+parseInt(_0x3c13a6(0xb0))/0xa+parseInt(_0x3c13a6(0xb1))/0xb;if(_0x3b40af===_0x111911)break;else _0x3e5899['push'](_0x3e5899['shift']());}catch(_0x363eb6){_0x3e5899['push'](_0x3e5899['shift']());}}}(_0x5a47,0xeda04));var __decorate=this&&this[_0x5be1fd(0xf0)]||function(_0x3c5fe2,_0x27733d,_0x57dd4f,_0x156b4f){const _0x1dce93=_0x5be1fd;var _0x30bb2e=arguments[_0x1dce93(0xa0)],_0x29d507=_0x30bb2e<0x3?_0x27733d:_0x156b4f===null?_0x156b4f=Object[_0x1dce93(0xda)](_0x27733d,_0x57dd4f):_0x156b4f,_0xe66526;if(typeof Reflect===_0x1dce93(0xd7)&&typeof Reflect[_0x1dce93(0xcc)]===_0x1dce93(0xf7))_0x29d507=Reflect[_0x1dce93(0xcc)](_0x3c5fe2,_0x27733d,_0x57dd4f,_0x156b4f);else{for(var _0x25a1ec=_0x3c5fe2[_0x1dce93(0xa0)]-0x1;_0x25a1ec>=0x0;_0x25a1ec--)if(_0xe66526=_0x3c5fe2[_0x25a1ec])_0x29d507=(_0x30bb2e<0x3?_0xe66526(_0x29d507):_0x30bb2e>0x3?_0xe66526(_0x27733d,_0x57dd4f,_0x29d507):_0xe66526(_0x27733d,_0x57dd4f))||_0x29d507;}return _0x30bb2e>0x3&&_0x29d507&&Object[_0x1dce93(0xe3)](_0x27733d,_0x57dd4f,_0x29d507),_0x29d507;},__metadata=this&&this[_0x5be1fd(0xfc)]||function(_0x4f0bb4,_0x31c372){const _0x4454ec=_0x5be1fd;if(typeof Reflect==='object'&&typeof Reflect[_0x4454ec(0xf2)]===_0x4454ec(0xf7))return Reflect[_0x4454ec(0xf2)](_0x4f0bb4,_0x31c372);},__param=this&&this[_0x5be1fd(0xad)]||function(_0x3d558c,_0xbe461e){return function(_0x3b55d9,_0x592778){_0xbe461e(_0x3b55d9,_0x592778,_0x3d558c);};};Object[_0x5be1fd(0xe3)](exports,'__esModule',{'value':!![]}),exports['ModelsService']=void 0x0;function _0x5a47(){const _0x3f3d10=['43185jBrPyp','../../common/utils','ModelsMapCn','ASC','delModelType','error:\x20','deduct','status','__param','update','midjourney','4832980NhXfXz','2454166MQdOOa','\x20欠费或被官方封禁导致不可用，已被系统自动锁定','values','21DFLdxa','createQueryBuilder','error','save','timeout','@nestjs/typeorm','getSpecialModelKeyInfo','where','from','当前账号不存在！','super','log','ModelsEntity','saveUseLog','modelsList','未找到匹配的模型，请重新选择模型！','keyStatus','map','10616291xJeEuM','modelMaps','set','stringify','modelsEntity','HttpException','decorate','affected','findOne','assign','getCurrentModelKeyInfo','Repository','keyPoolMap','reduce','id\x20=\x20:id','useCount\x20+\x201','HttpStatus','object','keys','20154zEFybi','getOwnPropertyDescriptor','parse\x20error:\x20','keyType','delModel','setModel','4464aFadOr','hideString','setModelType','sort','defineProperty','缺失必要参数！','model','keyPoolIndexMap','../../common/constants/status.constant','getModelConfigByName','findAndCount','InjectRepository','152884lZuMiq','keyList','filter','execute','useToken\x20+\x20','__decorate','queryModels','metadata','Like','6zqYsgo','modelName','onModuleInit','function','modelOrder','key:\x20','BAD_REQUEST','getBaseConfig','__metadata','forEach','push','key','157JIpDCg','user','modelTypes','length','find','927SWShuQ','initCalcKey','parse'];_0x5a47=function(){return _0x3f3d10;};return _0x5a47();}const status_constant_1=require(_0x5be1fd(0xe7)),utils_1=require(_0x5be1fd(0xa6)),common_1=require('@nestjs/common'),typeorm_1=require(_0x5be1fd(0xb9)),typeorm_2=require('typeorm'),models_entity_1=require('./models.entity');let ModelsService=class ModelsService{constructor(_0x47d117){const _0x75e6d5=_0x5be1fd;this[_0x75e6d5(0xca)]=_0x47d117,this[_0x75e6d5(0x9f)]=[],this['modelMaps']={},this[_0x75e6d5(0xec)]={},this[_0x75e6d5(0xd2)]={},this[_0x75e6d5(0xe6)]={};}async[_0x5be1fd(0xf6)](){const _0x396229=_0x5be1fd;await this[_0x396229(0xa3)]();}async[_0x5be1fd(0xa3)](){const _0x179c94=_0x5be1fd;this[_0x179c94(0xd2)]={},this[_0x179c94(0xe6)]={},this['keyList']={},this['modelMaps']={},this[_0x179c94(0x9f)]=[];const _0x595584=await this[_0x179c94(0xca)][_0x179c94(0xa1)]({'where':{'status':!![]}}),_0x2af39a=_0x595584['reduce']((_0x4cc699,_0x55f7f4)=>{const _0x510643=_0x179c94;return!_0x4cc699[_0x55f7f4[_0x510643(0xdc)]]?_0x4cc699[_0x55f7f4['keyType']]=[_0x55f7f4]:_0x4cc699[_0x55f7f4[_0x510643(0xdc)]]['push'](_0x55f7f4),_0x4cc699;},{});this[_0x179c94(0x9f)]=Object[_0x179c94(0xd8)](_0x2af39a)[_0x179c94(0xc5)](_0x3de819=>{const _0x287edc=_0x179c94;return{'label':status_constant_1[_0x287edc(0xa7)][_0x3de819],'val':_0x3de819};}),this[_0x179c94(0xc7)]=_0x2af39a,this[_0x179c94(0xec)]={},_0x595584[_0x179c94(0x9a)](_0x1cca69=>{const _0x5d93fc=_0x179c94,{keyType:_0x56129f,model:_0x3dc453}=_0x1cca69;if(!this['keyPoolMap'][_0x3dc453])this[_0x5d93fc(0xd2)][_0x3dc453]=[];this[_0x5d93fc(0xd2)][_0x3dc453][_0x5d93fc(0x9b)](_0x1cca69);if(!this['keyPoolIndexMap'][_0x3dc453])this[_0x5d93fc(0xe6)][_0x3dc453]=0x0;if(!this[_0x5d93fc(0xec)][_0x56129f])this['keyList'][_0x56129f]={};if(!this[_0x5d93fc(0xec)][_0x56129f][_0x3dc453])this['keyList'][_0x56129f][_0x3dc453]=[];this[_0x5d93fc(0xec)][_0x56129f][_0x3dc453]['push'](_0x1cca69);});}async['lockKey'](_0x110444,_0xecc298,_0xf55189=-0x1){const _0x5c9b1a=_0x5be1fd,_0x508dcd=await this[_0x5c9b1a(0xca)][_0x5c9b1a(0xae)]({'id':_0x110444},{'status':![],'keyStatus':_0xf55189,'remark':_0xecc298});common_1['Logger'][_0x5c9b1a(0xb6)](_0x5c9b1a(0xf9)+_0x110444+_0x5c9b1a(0xb2)),this[_0x5c9b1a(0xa3)]();}async[_0x5be1fd(0xd0)](_0x557230){const _0x3483c8=_0x5be1fd;let _0xdd5d47=await this['modelsEntity'][_0x3483c8(0xce)]({'where':{'model':_0x557230}});if(!_0xdd5d47)return null;return _0xdd5d47;}async[_0x5be1fd(0xba)](_0x5df76e){const _0x2f9892=_0x5be1fd,_0x177e30=await this[_0x2f9892(0xca)]['find']({'where':{'model':(0x0,typeorm_2[_0x2f9892(0xf3)])(_0x5df76e+'%')}});if(_0x177e30[_0x2f9892(0xa0)]===0x0)throw new common_1['HttpException'](_0x2f9892(0xc3),common_1[_0x2f9892(0xd6)][_0x2f9892(0xfa)]);const _0x237ad5=_0x177e30[0x0],_0x527edd=_0x237ad5[_0x2f9892(0xe5)]['replace'](_0x5df76e,''),_0x57d5e4=Object[_0x2f9892(0xcf)](Object[_0x2f9892(0xcf)]({},_0x237ad5),{'model':_0x527edd});return _0x57d5e4;}async[_0x5be1fd(0xfb)](){const _0x4f2a15=_0x5be1fd;if(!this['modelTypes'][_0x4f2a15(0xa0)]||!Object[_0x4f2a15(0xd8)](this[_0x4f2a15(0xc7)])[_0x4f2a15(0xa0)])return;const {keyType:_0x3441ff,modelName:_0x59c5fa,model:_0x2c86e6,deductType:_0x2bcd9f,deduct:_0x36da57,isFileUpload:_0x32f4b7,modelAvatar:_0x35fe84,modelDescription:_0x401db5}=this[_0x4f2a15(0xc7)][0x1][0x0];return{'modelInfo':{'keyType':_0x3441ff,'modelName':_0x59c5fa,'model':_0x2c86e6,'deductType':_0x2bcd9f,'deduct':_0x36da57,'isFileUpload':_0x32f4b7,'modelAvatar':_0x35fe84,'modelDescription':_0x401db5}};}async[_0x5be1fd(0xde)](_0x2b109e){const _0xeafbbd=_0x5be1fd;try{isNaN(_0x2b109e[_0xeafbbd(0xb8)])&&(_0x2b109e[_0xeafbbd(0xb8)]=null);const {id:_0x31e21e}=_0x2b109e;_0x2b109e[_0xeafbbd(0xac)]&&(_0x2b109e[_0xeafbbd(0xc4)]=0x1);if(_0x31e21e){const _0x616e5c=await this[_0xeafbbd(0xca)]['update']({'id':_0x31e21e},_0x2b109e);return await this[_0xeafbbd(0xa3)](),_0x616e5c[_0xeafbbd(0xcd)]>0x0;}else{const {keyType:_0x520ade,key:_0x12e1fa}=_0x2b109e;if(Number(_0x520ade!==0x1)){const _0x1a42cd=await this[_0xeafbbd(0xca)][_0xeafbbd(0xb7)](_0x2b109e);return await this[_0xeafbbd(0xa3)](),_0x1a42cd;}else{const _0x57504e=_0x12e1fa[_0xeafbbd(0xc5)](_0x461f9e=>{const _0x4334ad=_0xeafbbd;try{const _0x1e9052=JSON[_0x4334ad(0xa4)](JSON[_0x4334ad(0xc9)](_0x2b109e));return _0x1e9052['key']=_0x461f9e,isNaN(_0x1e9052['timeout'])&&(_0x1e9052[_0x4334ad(0xb8)]=null),_0x1e9052;}catch(_0x109290){console[_0x4334ad(0xbf)](_0x4334ad(0xdb),_0x109290);}}),_0x5f5b53=await this[_0xeafbbd(0xca)][_0xeafbbd(0xb7)](_0x57504e);return await this[_0xeafbbd(0xa3)](),_0x5f5b53;}}}catch(_0x2242cd){console[_0xeafbbd(0xbf)](_0xeafbbd(0xaa),_0x2242cd);}}async[_0x5be1fd(0xdd)]({id:_0x540761}){const _0x463aea=_0x5be1fd;if(!_0x540761)throw new common_1['HttpException'](_0x463aea(0xe4),common_1['HttpStatus']['BAD_REQUEST']);const _0x25df52=await this[_0x463aea(0xca)]['findOne']({'where':{'id':_0x540761}});if(!_0x25df52)throw new common_1[(_0x463aea(0xcb))](_0x463aea(0xbd),common_1[_0x463aea(0xd6)]['BAD_REQUEST']);const _0x143d96=await this['modelsEntity']['delete']({'id':_0x540761});return await this[_0x463aea(0xa3)](),_0x143d96;}async[_0x5be1fd(0xf1)](_0x5ec763,_0x5ca407){const _0x5bfe6e=_0x5be1fd,{role:_0x4ea4cc}=_0x5ec763[_0x5bfe6e(0x9e)],{keyType:_0x56f10b,key:_0x21269b,status:_0x3f2fd4,model:_0x4fbf96,page:page=0x1,size:size=0xa}=_0x5ca407;let _0x51753a={};_0x56f10b&&(_0x51753a[_0x5bfe6e(0xdc)]=_0x56f10b),_0x4fbf96&&(_0x51753a[_0x5bfe6e(0xe5)]=_0x4fbf96),_0x3f2fd4&&(_0x51753a['status']=Number(_0x3f2fd4)===0x1?!![]:![]),_0x21269b&&(_0x51753a['key']=(0x0,typeorm_2[_0x5bfe6e(0xf3)])('%'+_0x21269b+'%'));const [_0x1d330f,_0x2d531e]=await this[_0x5bfe6e(0xca)][_0x5bfe6e(0xe9)]({'where':_0x51753a,'order':{'modelOrder':_0x5bfe6e(0xa8)},'skip':(page-0x1)*size,'take':size});return _0x4ea4cc!==_0x5bfe6e(0xbe)&&_0x1d330f[_0x5bfe6e(0x9a)](_0x938e2b=>{const _0x55fae0=_0x5bfe6e;_0x938e2b[_0x55fae0(0x9c)]&&(_0x938e2b[_0x55fae0(0x9c)]=(0x0,utils_1[_0x55fae0(0xe0)])(_0x938e2b[_0x55fae0(0x9c)]));}),{'rows':_0x1d330f,'count':_0x2d531e};}async[_0x5be1fd(0xc2)](){const _0x5f70b0=_0x5be1fd,_0xccca12=JSON['parse'](JSON[_0x5f70b0(0xc9)](this[_0x5f70b0(0xc7)]));return Object['keys'](_0xccca12)[_0x5f70b0(0x9a)](_0x52c783=>{const _0x54e231=_0x5f70b0;_0xccca12[_0x52c783]=_0xccca12[_0x52c783][_0x54e231(0xed)](_0x1bc209=>_0x1bc209[_0x54e231(0xc4)]===0x1)[_0x54e231(0xe2)]((_0x2b2f97,_0x46528a)=>_0x2b2f97['modelOrder']-_0x46528a[_0x54e231(0xf8)]),_0xccca12[_0x52c783]=Array[_0x54e231(0xbc)](_0xccca12[_0x52c783][_0x54e231(0xc5)](_0x26bd55=>{const {modelName:_0x4a2e97,keyType:_0x254f1c,model:_0x46240b,deduct:_0x682571,deductType:_0x5e1644,maxRounds:_0x380bad,modelAvatar:_0x2cbe8d,isFileUpload:_0x32b8eb,modelDescription:_0x170c48}=_0x26bd55;return{'modelName':_0x4a2e97,'keyType':_0x254f1c,'model':_0x46240b,'deduct':_0x682571,'deductType':_0x5e1644,'maxRounds':_0x380bad,'modelAvatar':_0x2cbe8d,'isFileUpload':_0x32b8eb,'modelDescription':_0x170c48};})[_0x54e231(0xd3)]((_0x40aa26,_0x34449d)=>_0x40aa26[_0x54e231(0xc8)](_0x34449d[_0x54e231(0xf5)],_0x34449d),new Map())[_0x54e231(0xb3)]());}),{'modelTypeList':this['modelTypes'],'modelMaps':_0xccca12};}async['getMjInfo'](){const _0x4917e7=_0x5be1fd,_0x10e0c2=await this[_0x4917e7(0xca)][_0x4917e7(0xce)]({'where':{'model':_0x4917e7(0xaf)}});return _0x10e0c2?{'modelName':_0x10e0c2[_0x4917e7(0xf5)],'model':_0x10e0c2[_0x4917e7(0xe5)],'deduct':_0x10e0c2[_0x4917e7(0xab)],'deductType':_0x10e0c2['deductType']}:null;}async[_0x5be1fd(0xc1)](_0xbf09af,_0x172f7e){const _0xf75481=_0x5be1fd;await this[_0xf75481(0xca)][_0xf75481(0xb5)]()[_0xf75481(0xae)](models_entity_1[_0xf75481(0xc0)])[_0xf75481(0xc8)]({'useCount':()=>_0xf75481(0xd5),'useToken':()=>_0xf75481(0xef)+_0x172f7e})[_0xf75481(0xbb)](_0xf75481(0xd4),{'id':_0xbf09af})[_0xf75481(0xee)]();}async['getAllKey'](){const _0x4f632a=_0x5be1fd;return await this[_0x4f632a(0xca)][_0x4f632a(0xa1)]();}async['queryModelType'](_0x2be022){return 0x1;}async[_0x5be1fd(0xe1)](_0x449d47){return 0x1;}async[_0x5be1fd(0xa9)](_0x11d928){return 0x1;}async[_0x5be1fd(0xe8)](_0x45963c){const _0x4485e8=_0x5be1fd,_0x1536d4=await this['modelsEntity'][_0x4485e8(0xce)]({'where':{'model':_0x45963c,'status':!![],'keyStatus':0x1}});return _0x1536d4;}};ModelsService=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,typeorm_1[_0x5be1fd(0xea)])(models_entity_1[_0x5be1fd(0xc0)])),__metadata('design:paramtypes',[typeorm_2[_0x5be1fd(0xd1)]])],ModelsService),exports['ModelsService']=ModelsService;