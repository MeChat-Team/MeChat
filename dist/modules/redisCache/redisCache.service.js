'use strict';const _0x7f678c=_0x3e52;function _0x182b(){const _0x2ec46f=['defineProperty','redisClient','115764MtXxbF','180wVKkGs','super','admin','1646586ndLMQs','getJwtSecret','zRange','297vEFOeF','tokens:','42396roHEcP','88130FmFYBQ','design:paramtypes','29280tqHvpU','ttl','Injectable','__param','metadata','visitor','includes','JWT_SECRET','string','expire','HttpStatus','invalidateTokens','HttpException','393478WiSmAs','__metadata','REDIS_CLIENT','function','del','forEach','get','saveToken','checkTokenAuth','getOwnPropertyDescriptor','token:','length','__decorate','UNAUTHORIZED','388064LhWvWS','BAD_REQUEST','decorate','649XOTeoE','847CAtxqB','set','RedisCacheService','wishSet'];_0x182b=function(){return _0x2ec46f;};return _0x182b();}(function(_0x1391a1,_0x15c34b){const _0x49bd72=_0x3e52,_0x3945b6=_0x1391a1();while(!![]){try{const _0x41de04=parseInt(_0x49bd72(0x15d))/0x1+-parseInt(_0x49bd72(0x175))/0x2+parseInt(_0x49bd72(0x179))/0x3+parseInt(_0x49bd72(0x150))/0x4*(-parseInt(_0x49bd72(0x176))/0x5)+-parseInt(_0x49bd72(0x14d))/0x6*(parseInt(_0x49bd72(0x16f))/0x7)+-parseInt(_0x49bd72(0x16b))/0x8*(-parseInt(_0x49bd72(0x14b))/0x9)+parseInt(_0x49bd72(0x14e))/0xa*(-parseInt(_0x49bd72(0x16e))/0xb);if(_0x41de04===_0x15c34b)break;else _0x3945b6['push'](_0x3945b6['shift']());}catch(_0xeea85a){_0x3945b6['push'](_0x3945b6['shift']());}}}(_0x182b,0xceb9d));var __decorate=this&&this[_0x7f678c(0x169)]||function(_0x5df1ae,_0x35b215,_0x30cbaf,_0x38046a){const _0x1a3339=_0x7f678c;var _0x2308b6=arguments[_0x1a3339(0x168)],_0xf0548d=_0x2308b6<0x3?_0x35b215:_0x38046a===null?_0x38046a=Object[_0x1a3339(0x166)](_0x35b215,_0x30cbaf):_0x38046a,_0x3184ef;if(typeof Reflect==='object'&&typeof Reflect['decorate']===_0x1a3339(0x160))_0xf0548d=Reflect[_0x1a3339(0x16d)](_0x5df1ae,_0x35b215,_0x30cbaf,_0x38046a);else{for(var _0x195e88=_0x5df1ae[_0x1a3339(0x168)]-0x1;_0x195e88>=0x0;_0x195e88--)if(_0x3184ef=_0x5df1ae[_0x195e88])_0xf0548d=(_0x2308b6<0x3?_0x3184ef(_0xf0548d):_0x2308b6>0x3?_0x3184ef(_0x35b215,_0x30cbaf,_0xf0548d):_0x3184ef(_0x35b215,_0x30cbaf))||_0xf0548d;}return _0x2308b6>0x3&&_0xf0548d&&Object[_0x1a3339(0x173)](_0x35b215,_0x30cbaf,_0xf0548d),_0xf0548d;},__metadata=this&&this[_0x7f678c(0x15e)]||function(_0x3318a2,_0x242dcc){const _0x242623=_0x7f678c;if(typeof Reflect==='object'&&typeof Reflect[_0x242623(0x154)]===_0x242623(0x160))return Reflect[_0x242623(0x154)](_0x3318a2,_0x242dcc);},__param=this&&this[_0x7f678c(0x153)]||function(_0x1117c4,_0x40d4af){return function(_0x41ffcd,_0x11c93e){_0x40d4af(_0x41ffcd,_0x11c93e,_0x1117c4);};};Object[_0x7f678c(0x173)](exports,'__esModule',{'value':!![]}),exports[_0x7f678c(0x171)]=void 0x0;const common_1=require('@nestjs/common');function _0x3e52(_0x4e6ba3,_0x360fe0){const _0x182b54=_0x182b();return _0x3e52=function(_0x3e5270,_0x241b16){_0x3e5270=_0x3e5270-0x14b;let _0x1a3dd4=_0x182b54[_0x3e5270];return _0x1a3dd4;},_0x3e52(_0x4e6ba3,_0x360fe0);}let RedisCacheService=class RedisCacheService{constructor(_0x25d73b){const _0x2e55a3=_0x7f678c;this[_0x2e55a3(0x174)]=_0x25d73b;}async['get'](_0x1b62dc){const _0x5d90c4=_0x7f678c,{key:_0x176d26}=_0x1b62dc,_0x310476=await this['redisClient'][_0x5d90c4(0x163)](_0x176d26);return await this['redisClient'][_0x5d90c4(0x163)](_0x176d26);}async[_0x7f678c(0x170)](_0x2ab09e,_0x22be87){const _0x2d217d=_0x7f678c;try{const {key:_0x5d8e4f,val:_0x3633dd}=_0x2ab09e;await this[_0x2d217d(0x174)][_0x2d217d(0x170)](_0x5d8e4f,_0x3633dd),_0x22be87&&await this[_0x2d217d(0x174)][_0x2d217d(0x159)](_0x5d8e4f,_0x22be87);return;}catch(_0x95ee21){throw new common_1[(_0x2d217d(0x15c))](_0x95ee21,common_1[_0x2d217d(0x15a)][_0x2d217d(0x16c)]);}}async[_0x7f678c(0x17a)](){const _0x5b3ee3=_0x7f678c,_0x2d96be=await this[_0x5b3ee3(0x174)]['get'](_0x5b3ee3(0x157));if(!_0x2d96be)throw new Error('JWT\x20secret\x20not\x20found\x20in\x20Redis');return _0x2d96be;}async['ttl'](_0xf75032){const _0x1fa7be=_0x7f678c;return await this[_0x1fa7be(0x174)][_0x1fa7be(0x151)](_0xf75032);}async[_0x7f678c(0x161)](_0x5ee840){const _0x3f0963=_0x7f678c,{key:_0x5c318b}=_0x5ee840;await this[_0x3f0963(0x174)]['del'](_0x5c318b);return;}async[_0x7f678c(0x164)](_0x57ccfd,_0x26453d){const _0x15ddf9=_0x7f678c,_0xfc51bf=await this[_0x15ddf9(0x174)][_0x15ddf9(0x17b)](_0x15ddf9(0x14c)+_0x57ccfd,0x0,-0x1);await this[_0x15ddf9(0x15b)](_0x57ccfd,_0xfc51bf),this[_0x15ddf9(0x174)][_0x15ddf9(0x170)](_0x15ddf9(0x167)+_0x57ccfd,_0x26453d);}async[_0x7f678c(0x15b)](_0x5193e3,_0x4b6c3c){const _0x85b3bf=_0x7f678c;_0x4b6c3c[_0x85b3bf(0x162)](_0x5902fe=>{const _0x224c9f=_0x85b3bf;this['redisClient'][_0x224c9f(0x161)](_0x224c9f(0x167)+_0x5193e3+':'+_0x5902fe);});}async[_0x7f678c(0x165)](_0x56035d,_0x265589){const _0x4b48a7=_0x7f678c,{id:_0x4679a3,role:_0x2bda30}=_0x265589['user'];if(_0x2bda30===_0x4b48a7(0x155))return!![];const _0x57c304=await this[_0x4b48a7(0x174)]['get']('token:'+_0x4679a3);if(_0x57c304===null)return await this[_0x4b48a7(0x174)][_0x4b48a7(0x170)](_0x4b48a7(0x167)+_0x4679a3,_0x56035d),!![];if(_0x57c304!==_0x56035d){if([_0x4b48a7(0x177),_0x4b48a7(0x178)][_0x4b48a7(0x156)](_0x2bda30))return!![];throw new common_1[(_0x4b48a7(0x15c))]('您已在其他设备覆盖登录、请您重新登录！',common_1['HttpStatus'][_0x4b48a7(0x16a)]);}}async['wishGet'](_0x47cb27){const _0x52dc14=_0x7f678c,_0x5103ff=await this[_0x52dc14(0x174)][_0x52dc14(0x163)](_0x47cb27);try{return JSON['parse'](_0x5103ff);}catch(_0x5e9797){}return _0x5103ff;}async[_0x7f678c(0x172)](_0x4a8783,_0x2e0613,_0x1c7076){const _0x20e89c=_0x7f678c,_0x24dc57=typeof _0x2e0613===_0x20e89c(0x158)?_0x2e0613:JSON['stringify'](_0x2e0613);await this[_0x20e89c(0x174)]['set'](_0x4a8783,_0x24dc57),_0x1c7076&&await this[_0x20e89c(0x174)][_0x20e89c(0x159)](_0x4a8783,_0x1c7076);}};RedisCacheService=__decorate([(0x0,common_1[_0x7f678c(0x152)])(),__param(0x0,(0x0,common_1['Inject'])(_0x7f678c(0x15f))),__metadata(_0x7f678c(0x14f),[Object])],RedisCacheService),exports[_0x7f678c(0x171)]=RedisCacheService;