'use strict';const _0x38faf9=_0x83d0;function _0x68ea(){const _0x108ef7=['916KDGSJv','expire','JWT_SECRET','RedisCacheService','checkTokenAuth','admin','del','1903599jbJPwq','639CQoVHe','646AiJcOP','saveToken','374WVktUN','token:','stringify','HttpException','__decorate','zRange','length','ttl','object','@nestjs/common','visitor','wishGet','__param','set','57408nPTQbS','UNAUTHORIZED','BAD_REQUEST','user','__esModule','string','28917012AfONeL','wishSet','__metadata','parse','HttpStatus','29450WexCdW','您已在其他设备覆盖登录、请您重新登录！','17720lzAoWh','64190fldPAT','design:paramtypes','REDIS_CLIENT','super','defineProperty','JWT\x20secret\x20not\x20found\x20in\x20Redis','Inject','getJwtSecret','300rnqZMD','redisClient','getOwnPropertyDescriptor','get','2386PqYhWW','invalidateTokens'];_0x68ea=function(){return _0x108ef7;};return _0x68ea();}(function(_0x38db77,_0x5737a5){const _0x65de2=_0x83d0,_0x133da0=_0x38db77();while(!![]){try{const _0x9f297d=-parseInt(_0x65de2(0xa3))/0x1*(parseInt(_0x65de2(0xcd))/0x2)+-parseInt(_0x65de2(0xa1))/0x3+-parseInt(_0x65de2(0xcf))/0x4*(-parseInt(_0x65de2(0xc0))/0x5)+-parseInt(_0x65de2(0xc9))/0x6*(parseInt(_0x65de2(0xc1))/0x7)+-parseInt(_0x65de2(0xb3))/0x8*(parseInt(_0x65de2(0xa2))/0x9)+-parseInt(_0x65de2(0xbe))/0xa*(parseInt(_0x65de2(0xa5))/0xb)+parseInt(_0x65de2(0xb9))/0xc;if(_0x9f297d===_0x5737a5)break;else _0x133da0['push'](_0x133da0['shift']());}catch(_0x125d9b){_0x133da0['push'](_0x133da0['shift']());}}}(_0x68ea,0xb69d6));var __decorate=this&&this[_0x38faf9(0xa9)]||function(_0x4f93af,_0x3f9b2a,_0x1063cc,_0x4f42f3){const _0x4f1e1a=_0x38faf9;var _0x3e978c=arguments[_0x4f1e1a(0xab)],_0x5a2a25=_0x3e978c<0x3?_0x3f9b2a:_0x4f42f3===null?_0x4f42f3=Object[_0x4f1e1a(0xcb)](_0x3f9b2a,_0x1063cc):_0x4f42f3,_0x5bd345;if(typeof Reflect===_0x4f1e1a(0xad)&&typeof Reflect['decorate']==='function')_0x5a2a25=Reflect['decorate'](_0x4f93af,_0x3f9b2a,_0x1063cc,_0x4f42f3);else{for(var _0x329e67=_0x4f93af[_0x4f1e1a(0xab)]-0x1;_0x329e67>=0x0;_0x329e67--)if(_0x5bd345=_0x4f93af[_0x329e67])_0x5a2a25=(_0x3e978c<0x3?_0x5bd345(_0x5a2a25):_0x3e978c>0x3?_0x5bd345(_0x3f9b2a,_0x1063cc,_0x5a2a25):_0x5bd345(_0x3f9b2a,_0x1063cc))||_0x5a2a25;}return _0x3e978c>0x3&&_0x5a2a25&&Object[_0x4f1e1a(0xc5)](_0x3f9b2a,_0x1063cc,_0x5a2a25),_0x5a2a25;},__metadata=this&&this[_0x38faf9(0xbb)]||function(_0x58fd48,_0x15a102){const _0xb45d9d=_0x38faf9;if(typeof Reflect===_0xb45d9d(0xad)&&typeof Reflect['metadata']==='function')return Reflect['metadata'](_0x58fd48,_0x15a102);},__param=this&&this[_0x38faf9(0xb1)]||function(_0x1709e5,_0xb318ac){return function(_0x1cfa3f,_0x226657){_0xb318ac(_0x1cfa3f,_0x226657,_0x1709e5);};};Object[_0x38faf9(0xc5)](exports,_0x38faf9(0xb7),{'value':!![]}),exports['RedisCacheService']=void 0x0;function _0x83d0(_0x5cbd3b,_0x52416d){const _0x68ea07=_0x68ea();return _0x83d0=function(_0x83d078,_0x5796fa){_0x83d078=_0x83d078-0xa1;let _0xa28446=_0x68ea07[_0x83d078];return _0xa28446;},_0x83d0(_0x5cbd3b,_0x52416d);}const common_1=require(_0x38faf9(0xae));let RedisCacheService=class RedisCacheService{constructor(_0x1fd500){const _0x399104=_0x38faf9;this[_0x399104(0xca)]=_0x1fd500;}async['get'](_0x158dec){const _0x137956=_0x38faf9,{key:_0x3f9c57}=_0x158dec,_0x19f7cc=await this[_0x137956(0xca)][_0x137956(0xcc)](_0x3f9c57);return await this[_0x137956(0xca)][_0x137956(0xcc)](_0x3f9c57);}async[_0x38faf9(0xb2)](_0xeb1364,_0x1c2dfd){const _0x11f27b=_0x38faf9;try{const {key:_0x54b537,val:_0xa80d11}=_0xeb1364;await this[_0x11f27b(0xca)][_0x11f27b(0xb2)](_0x54b537,_0xa80d11),_0x1c2dfd&&await this['redisClient'][_0x11f27b(0xd0)](_0x54b537,_0x1c2dfd);return;}catch(_0x37de7b){throw new common_1['HttpException'](_0x37de7b,common_1[_0x11f27b(0xbd)][_0x11f27b(0xb5)]);}}async[_0x38faf9(0xc8)](){const _0xabd947=_0x38faf9,_0x31d96e=await this['redisClient'][_0xabd947(0xcc)](_0xabd947(0xd1));if(!_0x31d96e)throw new Error(_0xabd947(0xc6));return _0x31d96e;}async[_0x38faf9(0xac)](_0x2b6804){const _0x1c16df=_0x38faf9;return await this[_0x1c16df(0xca)][_0x1c16df(0xac)](_0x2b6804);}async[_0x38faf9(0xd5)](_0x5580d5){const _0x218f4c=_0x38faf9,{key:_0x2f9063}=_0x5580d5;await this[_0x218f4c(0xca)]['del'](_0x2f9063);return;}async[_0x38faf9(0xa4)](_0x3412aa,_0x1efb24){const _0x247041=_0x38faf9,_0x278f92=await this[_0x247041(0xca)][_0x247041(0xaa)]('tokens:'+_0x3412aa,0x0,-0x1);await this[_0x247041(0xce)](_0x3412aa,_0x278f92),this['redisClient'][_0x247041(0xb2)]('token:'+_0x3412aa,_0x1efb24);}async[_0x38faf9(0xce)](_0x4acea1,_0x2a30d3){_0x2a30d3['forEach'](_0x3fdbcc=>{const _0x5d7595=_0x83d0;this['redisClient'][_0x5d7595(0xd5)](_0x5d7595(0xa6)+_0x4acea1+':'+_0x3fdbcc);});}async[_0x38faf9(0xd3)](_0x223b35,_0x121fbe){const _0x588ed4=_0x38faf9,{id:_0x498c8c,role:_0x46a45e}=_0x121fbe[_0x588ed4(0xb6)];if(_0x46a45e===_0x588ed4(0xaf))return!![];const _0x56eb1e=await this[_0x588ed4(0xca)][_0x588ed4(0xcc)]('token:'+_0x498c8c);if(_0x56eb1e===null)return await this[_0x588ed4(0xca)]['set']('token:'+_0x498c8c,_0x223b35),!![];if(_0x56eb1e!==_0x223b35){if([_0x588ed4(0xc4),_0x588ed4(0xd4)]['includes'](_0x46a45e))return!![];throw new common_1[(_0x588ed4(0xa8))](_0x588ed4(0xbf),common_1[_0x588ed4(0xbd)][_0x588ed4(0xb4)]);}}async[_0x38faf9(0xb0)](_0x103621){const _0x53fa9d=_0x38faf9,_0x1689a1=await this[_0x53fa9d(0xca)]['get'](_0x103621);try{return JSON[_0x53fa9d(0xbc)](_0x1689a1);}catch(_0x11a673){}return _0x1689a1;}async[_0x38faf9(0xba)](_0x29b8b0,_0x330b38,_0x3b8674){const _0x5104e8=_0x38faf9,_0x539c3f=typeof _0x330b38===_0x5104e8(0xb8)?_0x330b38:JSON[_0x5104e8(0xa7)](_0x330b38);await this[_0x5104e8(0xca)]['set'](_0x29b8b0,_0x539c3f),_0x3b8674&&await this[_0x5104e8(0xca)][_0x5104e8(0xd0)](_0x29b8b0,_0x3b8674);}};RedisCacheService=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,common_1[_0x38faf9(0xc7)])(_0x38faf9(0xc3))),__metadata(_0x38faf9(0xc2),[Object])],RedisCacheService),exports[_0x38faf9(0xd2)]=RedisCacheService;