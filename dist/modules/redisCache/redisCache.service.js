'use strict';const _0x54ff2a=_0xeea9;(function(_0x1eca5a,_0x1a8d64){const _0xd7ad73=_0xeea9,_0xbd26ea=_0x1eca5a();while(!![]){try{const _0x1a4409=-parseInt(_0xd7ad73(0x1d2))/0x1*(parseInt(_0xd7ad73(0x1e1))/0x2)+parseInt(_0xd7ad73(0x1c0))/0x3+parseInt(_0xd7ad73(0x1bb))/0x4+-parseInt(_0xd7ad73(0x1bc))/0x5+parseInt(_0xd7ad73(0x1c9))/0x6*(parseInt(_0xd7ad73(0x1db))/0x7)+parseInt(_0xd7ad73(0x1d6))/0x8+parseInt(_0xd7ad73(0x1c7))/0x9*(-parseInt(_0xd7ad73(0x1d3))/0xa);if(_0x1a4409===_0x1a8d64)break;else _0xbd26ea['push'](_0xbd26ea['shift']());}catch(_0x178a1c){_0xbd26ea['push'](_0xbd26ea['shift']());}}}(_0x1c18,0xc2241));function _0xeea9(_0x202ee8,_0x5b903f){const _0x1c187f=_0x1c18();return _0xeea9=function(_0xeea94e,_0x494e48){_0xeea94e=_0xeea94e-0x1b7;let _0x1e04f1=_0x1c187f[_0xeea94e];return _0x1e04f1;},_0xeea9(_0x202ee8,_0x5b903f);}function _0x1c18(){const _0x4bc39c=['RedisCacheService','2149552jhsfdA','2333000jsIEPM','BAD_REQUEST','wishSet','getOwnPropertyDescriptor','2823840OlqPXw','super','design:paramtypes','invalidateTokens','UNAUTHORIZED','__esModule','wishGet','9qoFVsG','decorate','162jdsGVa','length','Injectable','defineProperty','tokens:','HttpStatus','checkTokenAuth','user','HttpException','199oULZor','13878290zMwGuO','REDIS_CLIENT','__decorate','12204992mUsqEW','metadata','redisClient','您已在其他设备覆盖登录、请您重新登录！','set','93268wHuudE','Inject','getJwtSecret','get','includes','expire','7180RgBZjl','string','@nestjs/common','admin','ttl','token:','function','del','parse','object','forEach','saveToken'];_0x1c18=function(){return _0x4bc39c;};return _0x1c18();}var __decorate=this&&this[_0x54ff2a(0x1d5)]||function(_0x5c57a4,_0x5ee430,_0x3a7087,_0x1cedd0){const _0x14a9a8=_0x54ff2a;var _0x6724ad=arguments['length'],_0x2e386b=_0x6724ad<0x3?_0x5ee430:_0x1cedd0===null?_0x1cedd0=Object[_0x14a9a8(0x1bf)](_0x5ee430,_0x3a7087):_0x1cedd0,_0x5d0e04;if(typeof Reflect===_0x14a9a8(0x1b7)&&typeof Reflect[_0x14a9a8(0x1c8)]===_0x14a9a8(0x1e7))_0x2e386b=Reflect['decorate'](_0x5c57a4,_0x5ee430,_0x3a7087,_0x1cedd0);else{for(var _0x39629b=_0x5c57a4[_0x14a9a8(0x1ca)]-0x1;_0x39629b>=0x0;_0x39629b--)if(_0x5d0e04=_0x5c57a4[_0x39629b])_0x2e386b=(_0x6724ad<0x3?_0x5d0e04(_0x2e386b):_0x6724ad>0x3?_0x5d0e04(_0x5ee430,_0x3a7087,_0x2e386b):_0x5d0e04(_0x5ee430,_0x3a7087))||_0x2e386b;}return _0x6724ad>0x3&&_0x2e386b&&Object['defineProperty'](_0x5ee430,_0x3a7087,_0x2e386b),_0x2e386b;},__metadata=this&&this['__metadata']||function(_0x3cc2ab,_0x5e59bd){const _0x2eb54d=_0x54ff2a;if(typeof Reflect===_0x2eb54d(0x1b7)&&typeof Reflect[_0x2eb54d(0x1d7)]==='function')return Reflect[_0x2eb54d(0x1d7)](_0x3cc2ab,_0x5e59bd);},__param=this&&this['__param']||function(_0x3b66b8,_0x1213b2){return function(_0x151076,_0x4ad1c4){_0x1213b2(_0x151076,_0x4ad1c4,_0x3b66b8);};};Object[_0x54ff2a(0x1cc)](exports,_0x54ff2a(0x1c5),{'value':!![]}),exports[_0x54ff2a(0x1ba)]=void 0x0;const common_1=require(_0x54ff2a(0x1e3));let RedisCacheService=class RedisCacheService{constructor(_0x40c6ed){const _0x55e9d9=_0x54ff2a;this[_0x55e9d9(0x1d8)]=_0x40c6ed;}async['get'](_0x139e7d){const _0x110588=_0x54ff2a,{key:_0x764afb}=_0x139e7d,_0x5f12c6=await this[_0x110588(0x1d8)][_0x110588(0x1de)](_0x764afb);return await this[_0x110588(0x1d8)][_0x110588(0x1de)](_0x764afb);}async['set'](_0x3ca7b2,_0xd2ddc3){const _0x38384f=_0x54ff2a;try{const {key:_0x5565ac,val:_0x48b413}=_0x3ca7b2;await this[_0x38384f(0x1d8)][_0x38384f(0x1da)](_0x5565ac,_0x48b413),_0xd2ddc3&&await this[_0x38384f(0x1d8)][_0x38384f(0x1e0)](_0x5565ac,_0xd2ddc3);return;}catch(_0x208b55){throw new common_1[(_0x38384f(0x1d1))](_0x208b55,common_1[_0x38384f(0x1ce)][_0x38384f(0x1bd)]);}}async[_0x54ff2a(0x1dd)](){const _0xb2b9d2=_0x54ff2a,_0x3ac9b5=await this[_0xb2b9d2(0x1d8)]['get']('JWT_SECRET');if(!_0x3ac9b5)throw new Error('JWT\x20secret\x20not\x20found\x20in\x20Redis');return _0x3ac9b5;}async[_0x54ff2a(0x1e5)](_0x44c8cc){const _0x48f83d=_0x54ff2a;return await this[_0x48f83d(0x1d8)][_0x48f83d(0x1e5)](_0x44c8cc);}async[_0x54ff2a(0x1e8)](_0x5a0048){const _0x9a91e5=_0x54ff2a,{key:_0x4d94ae}=_0x5a0048;await this[_0x9a91e5(0x1d8)][_0x9a91e5(0x1e8)](_0x4d94ae);return;}async[_0x54ff2a(0x1b9)](_0x3f43ee,_0x1f7888){const _0x4b5e76=_0x54ff2a,_0xec1819=await this[_0x4b5e76(0x1d8)]['zRange'](_0x4b5e76(0x1cd)+_0x3f43ee,0x0,-0x1);await this['invalidateTokens'](_0x3f43ee,_0xec1819),this['redisClient'][_0x4b5e76(0x1da)](_0x4b5e76(0x1e6)+_0x3f43ee,_0x1f7888);}async[_0x54ff2a(0x1c3)](_0x337d70,_0x487b50){const _0x3a9d2d=_0x54ff2a;_0x487b50[_0x3a9d2d(0x1b8)](_0x27285d=>{const _0x3f6edf=_0x3a9d2d;this[_0x3f6edf(0x1d8)]['del'](_0x3f6edf(0x1e6)+_0x337d70+':'+_0x27285d);});}async[_0x54ff2a(0x1cf)](_0x15362d,_0x3c564b){const _0x3f4609=_0x54ff2a,{id:_0x2ab08a,role:_0x30418b}=_0x3c564b[_0x3f4609(0x1d0)];if(_0x30418b==='visitor')return!![];const _0x583cb1=await this[_0x3f4609(0x1d8)][_0x3f4609(0x1de)](_0x3f4609(0x1e6)+_0x2ab08a);if(_0x583cb1===null)return await this[_0x3f4609(0x1d8)][_0x3f4609(0x1da)]('token:'+_0x2ab08a,_0x15362d),!![];if(_0x583cb1!==_0x15362d){if([_0x3f4609(0x1c1),_0x3f4609(0x1e4)][_0x3f4609(0x1df)](_0x30418b))return!![];throw new common_1['HttpException'](_0x3f4609(0x1d9),common_1[_0x3f4609(0x1ce)][_0x3f4609(0x1c4)]);}}async[_0x54ff2a(0x1c6)](_0x20e8f9){const _0x14b309=_0x54ff2a,_0x3d1f16=await this[_0x14b309(0x1d8)][_0x14b309(0x1de)](_0x20e8f9);try{return JSON[_0x14b309(0x1e9)](_0x3d1f16);}catch(_0x5d5820){}return _0x3d1f16;}async[_0x54ff2a(0x1be)](_0x14d745,_0x4f1e92,_0x26a889){const _0x3877e9=_0x54ff2a,_0xe91907=typeof _0x4f1e92===_0x3877e9(0x1e2)?_0x4f1e92:JSON['stringify'](_0x4f1e92);await this[_0x3877e9(0x1d8)]['set'](_0x14d745,_0xe91907),_0x26a889&&await this[_0x3877e9(0x1d8)][_0x3877e9(0x1e0)](_0x14d745,_0x26a889);}};RedisCacheService=__decorate([(0x0,common_1[_0x54ff2a(0x1cb)])(),__param(0x0,(0x0,common_1[_0x54ff2a(0x1dc)])(_0x54ff2a(0x1d4))),__metadata(_0x54ff2a(0x1c2),[Object])],RedisCacheService),exports[_0x54ff2a(0x1ba)]=RedisCacheService;