'use strict';const _0x4ef70f=_0x5a0d;(function(_0x305209,_0x24dc77){const _0x446fc0=_0x5a0d,_0x2200e3=_0x305209();while(!![]){try{const _0x2ffce8=parseInt(_0x446fc0(0x1dd))/0x1+-parseInt(_0x446fc0(0x1d2))/0x2*(-parseInt(_0x446fc0(0x1c8))/0x3)+-parseInt(_0x446fc0(0x1ef))/0x4*(-parseInt(_0x446fc0(0x1c0))/0x5)+-parseInt(_0x446fc0(0x1d5))/0x6+-parseInt(_0x446fc0(0x1c2))/0x7*(-parseInt(_0x446fc0(0x1e3))/0x8)+parseInt(_0x446fc0(0x1cb))/0x9+parseInt(_0x446fc0(0x1da))/0xa*(-parseInt(_0x446fc0(0x1e0))/0xb);if(_0x2ffce8===_0x24dc77)break;else _0x2200e3['push'](_0x2200e3['shift']());}catch(_0x3bcf5b){_0x2200e3['push'](_0x2200e3['shift']());}}}(_0x1233,0x38a56));function _0x1233(){const _0x233336=['decorate','string','redisClient','expire','tokens:','1762544oWxvlV','visitor','5wyEVmN','Injectable','54124OqZACZ','@nestjs/common','forEach','zRange','saveToken','HttpStatus','15UfKNCX','Inject','JWT_SECRET','1501596yfrzzG','token:','__decorate','super','function','__esModule','del','1590SuagOL','BAD_REQUEST','design:paramtypes','826536cXFCKL','admin','getJwtSecret','JWT\x20secret\x20not\x20found\x20in\x20Redis','defineProperty','3697970knsjNf','set','RedisCacheService','120388ByNNsh','__metadata','includes','11tEydQx','get','length','8VRjnHY','UNAUTHORIZED','checkTokenAuth','ttl','wishSet','parse','wishGet'];_0x1233=function(){return _0x233336;};return _0x1233();}function _0x5a0d(_0x2e973f,_0x555150){const _0x1233e6=_0x1233();return _0x5a0d=function(_0x5a0d68,_0x410536){_0x5a0d68=_0x5a0d68-0x1bf;let _0x12c04f=_0x1233e6[_0x5a0d68];return _0x12c04f;},_0x5a0d(_0x2e973f,_0x555150);}var __decorate=this&&this[_0x4ef70f(0x1cd)]||function(_0x472099,_0x3e8b12,_0x588520,_0x4927ef){const _0x9551ad=_0x4ef70f;var _0x3d105f=arguments[_0x9551ad(0x1e2)],_0x3458ca=_0x3d105f<0x3?_0x3e8b12:_0x4927ef===null?_0x4927ef=Object['getOwnPropertyDescriptor'](_0x3e8b12,_0x588520):_0x4927ef,_0x188734;if(typeof Reflect==='object'&&typeof Reflect['decorate']===_0x9551ad(0x1cf))_0x3458ca=Reflect[_0x9551ad(0x1ea)](_0x472099,_0x3e8b12,_0x588520,_0x4927ef);else{for(var _0x528b04=_0x472099['length']-0x1;_0x528b04>=0x0;_0x528b04--)if(_0x188734=_0x472099[_0x528b04])_0x3458ca=(_0x3d105f<0x3?_0x188734(_0x3458ca):_0x3d105f>0x3?_0x188734(_0x3e8b12,_0x588520,_0x3458ca):_0x188734(_0x3e8b12,_0x588520))||_0x3458ca;}return _0x3d105f>0x3&&_0x3458ca&&Object[_0x9551ad(0x1d9)](_0x3e8b12,_0x588520,_0x3458ca),_0x3458ca;},__metadata=this&&this[_0x4ef70f(0x1de)]||function(_0x80a79b,_0x3d01fb){const _0x2cb8ce=_0x4ef70f;if(typeof Reflect==='object'&&typeof Reflect['metadata']===_0x2cb8ce(0x1cf))return Reflect['metadata'](_0x80a79b,_0x3d01fb);},__param=this&&this['__param']||function(_0x596a95,_0x120cb6){return function(_0x4cb55b,_0x2ecfee){_0x120cb6(_0x4cb55b,_0x2ecfee,_0x596a95);};};Object[_0x4ef70f(0x1d9)](exports,_0x4ef70f(0x1d0),{'value':!![]}),exports[_0x4ef70f(0x1dc)]=void 0x0;const common_1=require(_0x4ef70f(0x1c3));let RedisCacheService=class RedisCacheService{constructor(_0x15860f){const _0x5240f3=_0x4ef70f;this[_0x5240f3(0x1ec)]=_0x15860f;}async[_0x4ef70f(0x1e1)](_0x1cc404){const _0x4a5b88=_0x4ef70f,{key:_0x320738}=_0x1cc404,_0x4c5806=await this[_0x4a5b88(0x1ec)][_0x4a5b88(0x1e1)](_0x320738);return await this[_0x4a5b88(0x1ec)]['get'](_0x320738);}async[_0x4ef70f(0x1db)](_0x31840f,_0x5d113e){const _0x5f22c3=_0x4ef70f;try{const {key:_0xadb32b,val:_0x3aeca6}=_0x31840f;await this['redisClient'][_0x5f22c3(0x1db)](_0xadb32b,_0x3aeca6),_0x5d113e&&await this[_0x5f22c3(0x1ec)][_0x5f22c3(0x1ed)](_0xadb32b,_0x5d113e);return;}catch(_0x3641af){throw new common_1['HttpException'](_0x3641af,common_1[_0x5f22c3(0x1c7)][_0x5f22c3(0x1d3)]);}}async[_0x4ef70f(0x1d7)](){const _0x59f0b9=_0x4ef70f,_0x379577=await this['redisClient'][_0x59f0b9(0x1e1)](_0x59f0b9(0x1ca));if(!_0x379577)throw new Error(_0x59f0b9(0x1d8));return _0x379577;}async[_0x4ef70f(0x1e6)](_0x1c4f5e){const _0x4ee8c8=_0x4ef70f;return await this[_0x4ee8c8(0x1ec)][_0x4ee8c8(0x1e6)](_0x1c4f5e);}async[_0x4ef70f(0x1d1)](_0x3fe5d6){const _0x179e79=_0x4ef70f,{key:_0x248234}=_0x3fe5d6;await this[_0x179e79(0x1ec)][_0x179e79(0x1d1)](_0x248234);return;}async[_0x4ef70f(0x1c6)](_0x4e091b,_0x3a3835){const _0x19c0f7=_0x4ef70f,_0x3d4f7f=await this[_0x19c0f7(0x1ec)][_0x19c0f7(0x1c5)](_0x19c0f7(0x1ee)+_0x4e091b,0x0,-0x1);await this['invalidateTokens'](_0x4e091b,_0x3d4f7f),this['redisClient'][_0x19c0f7(0x1db)](_0x19c0f7(0x1cc)+_0x4e091b,_0x3a3835);}async['invalidateTokens'](_0x40d3f8,_0x5e15e4){const _0xd844e2=_0x4ef70f;_0x5e15e4[_0xd844e2(0x1c4)](_0x5f0bd2=>{const _0x3f3521=_0xd844e2;this[_0x3f3521(0x1ec)][_0x3f3521(0x1d1)](_0x3f3521(0x1cc)+_0x40d3f8+':'+_0x5f0bd2);});}async[_0x4ef70f(0x1e5)](_0x3463bb,_0x44b70f){const _0x13d648=_0x4ef70f,{id:_0x23c121,role:_0x575402}=_0x44b70f['user'];if(_0x575402===_0x13d648(0x1bf))return!![];const _0x3aa099=await this['redisClient'][_0x13d648(0x1e1)](_0x13d648(0x1cc)+_0x23c121);if(_0x3aa099===null)return await this[_0x13d648(0x1ec)][_0x13d648(0x1db)](_0x13d648(0x1cc)+_0x23c121,_0x3463bb),!![];if(_0x3aa099!==_0x3463bb){if([_0x13d648(0x1ce),_0x13d648(0x1d6)][_0x13d648(0x1df)](_0x575402))return!![];throw new common_1['HttpException']('您已在其他设备覆盖登录、请您重新登录！',common_1[_0x13d648(0x1c7)][_0x13d648(0x1e4)]);}}async[_0x4ef70f(0x1e9)](_0x5d675b){const _0x1b5990=_0x4ef70f,_0x4b9ed9=await this[_0x1b5990(0x1ec)][_0x1b5990(0x1e1)](_0x5d675b);try{return JSON[_0x1b5990(0x1e8)](_0x4b9ed9);}catch(_0x146b09){}return _0x4b9ed9;}async[_0x4ef70f(0x1e7)](_0x4f8d56,_0x5d3fea,_0x118412){const _0x27d0cb=_0x4ef70f,_0x57c0ee=typeof _0x5d3fea===_0x27d0cb(0x1eb)?_0x5d3fea:JSON['stringify'](_0x5d3fea);await this[_0x27d0cb(0x1ec)]['set'](_0x4f8d56,_0x57c0ee),_0x118412&&await this['redisClient'][_0x27d0cb(0x1ed)](_0x4f8d56,_0x118412);}};RedisCacheService=__decorate([(0x0,common_1[_0x4ef70f(0x1c1)])(),__param(0x0,(0x0,common_1[_0x4ef70f(0x1c9)])('REDIS_CLIENT')),__metadata(_0x4ef70f(0x1d4),[Object])],RedisCacheService),exports[_0x4ef70f(0x1dc)]=RedisCacheService;