'use strict';const _0x4ddd30=_0x19fe;(function(_0x1be904,_0x5a3b48){const _0x1c590d=_0x19fe,_0x3cf25e=_0x1be904();while(!![]){try{const _0x4373b5=-parseInt(_0x1c590d(0x1a0))/0x1*(parseInt(_0x1c590d(0x186))/0x2)+parseInt(_0x1c590d(0x18c))/0x3*(parseInt(_0x1c590d(0x1a7))/0x4)+parseInt(_0x1c590d(0x19c))/0x5+parseInt(_0x1c590d(0x1a2))/0x6+-parseInt(_0x1c590d(0x190))/0x7*(-parseInt(_0x1c590d(0x1a1))/0x8)+-parseInt(_0x1c590d(0x180))/0x9+-parseInt(_0x1c590d(0x1af))/0xa;if(_0x4373b5===_0x5a3b48)break;else _0x3cf25e['push'](_0x3cf25e['shift']());}catch(_0x22d0b0){_0x3cf25e['push'](_0x3cf25e['shift']());}}}(_0x1520,0x841fe));function _0x1520(){const _0x4cd2dd=['__decorate','del','includes','JWT_SECRET','forEach','visitor','get','356300UQOUIV','invalidateTokens','metadata','tokens:','44463oZNjly','24cnTgKT','6089184seRweX','__metadata','stringify','Inject','__esModule','317476onVxKl','token:','user','Injectable','__param','HttpException','decorate','@nestjs/common','6574870PDwHcx','defineProperty','8811135YjOPwo','parse','design:paramtypes','ttl','wishGet','set','2fKhwHB','HttpStatus','getJwtSecret','redisClient','saveToken','length','39FcOkEc','RedisCacheService','expire','JWT\x20secret\x20not\x20found\x20in\x20Redis','243194GaLXqf','zRange','function','REDIS_CLIENT','getOwnPropertyDescriptor'];_0x1520=function(){return _0x4cd2dd;};return _0x1520();}var __decorate=this&&this[_0x4ddd30(0x195)]||function(_0x570e67,_0x306f2c,_0x31c935,_0x2c97e5){const _0x991f2=_0x4ddd30;var _0x1be08f=arguments[_0x991f2(0x18b)],_0x2043ac=_0x1be08f<0x3?_0x306f2c:_0x2c97e5===null?_0x2c97e5=Object[_0x991f2(0x194)](_0x306f2c,_0x31c935):_0x2c97e5,_0x4a1f30;if(typeof Reflect==='object'&&typeof Reflect['decorate']===_0x991f2(0x192))_0x2043ac=Reflect[_0x991f2(0x1ad)](_0x570e67,_0x306f2c,_0x31c935,_0x2c97e5);else{for(var _0x4d67b0=_0x570e67[_0x991f2(0x18b)]-0x1;_0x4d67b0>=0x0;_0x4d67b0--)if(_0x4a1f30=_0x570e67[_0x4d67b0])_0x2043ac=(_0x1be08f<0x3?_0x4a1f30(_0x2043ac):_0x1be08f>0x3?_0x4a1f30(_0x306f2c,_0x31c935,_0x2043ac):_0x4a1f30(_0x306f2c,_0x31c935))||_0x2043ac;}return _0x1be08f>0x3&&_0x2043ac&&Object['defineProperty'](_0x306f2c,_0x31c935,_0x2043ac),_0x2043ac;},__metadata=this&&this[_0x4ddd30(0x1a3)]||function(_0x49c099,_0x2e6adf){const _0x40d779=_0x4ddd30;if(typeof Reflect==='object'&&typeof Reflect[_0x40d779(0x19e)]==='function')return Reflect['metadata'](_0x49c099,_0x2e6adf);},__param=this&&this[_0x4ddd30(0x1ab)]||function(_0x399aea,_0x5af2d9){return function(_0x37b4ba,_0x2aab53){_0x5af2d9(_0x37b4ba,_0x2aab53,_0x399aea);};};Object[_0x4ddd30(0x1b0)](exports,_0x4ddd30(0x1a6),{'value':!![]}),exports[_0x4ddd30(0x18d)]=void 0x0;const common_1=require(_0x4ddd30(0x1ae));function _0x19fe(_0x4e07f0,_0x551906){const _0x15208f=_0x1520();return _0x19fe=function(_0x19fe46,_0x47d4fa){_0x19fe46=_0x19fe46-0x180;let _0x1d519e=_0x15208f[_0x19fe46];return _0x1d519e;},_0x19fe(_0x4e07f0,_0x551906);}let RedisCacheService=class RedisCacheService{constructor(_0x443605){const _0x2d3acc=_0x4ddd30;this[_0x2d3acc(0x189)]=_0x443605;}async[_0x4ddd30(0x19b)](_0x2e6e38){const _0x14fd11=_0x4ddd30,{key:_0x5085ed}=_0x2e6e38,_0x100e2b=await this['redisClient'][_0x14fd11(0x19b)](_0x5085ed);return await this[_0x14fd11(0x189)][_0x14fd11(0x19b)](_0x5085ed);}async[_0x4ddd30(0x185)](_0x25dd30,_0x494fe9){const _0x4078b3=_0x4ddd30;try{const {key:_0x16d80d,val:_0x2a4501}=_0x25dd30;await this[_0x4078b3(0x189)][_0x4078b3(0x185)](_0x16d80d,_0x2a4501),_0x494fe9&&await this['redisClient'][_0x4078b3(0x18e)](_0x16d80d,_0x494fe9);return;}catch(_0x2d9250){throw new common_1[(_0x4078b3(0x1ac))](_0x2d9250,common_1[_0x4078b3(0x187)]['BAD_REQUEST']);}}async[_0x4ddd30(0x188)](){const _0x44f54d=_0x4ddd30,_0xc76361=await this['redisClient'][_0x44f54d(0x19b)](_0x44f54d(0x198));if(!_0xc76361)throw new Error(_0x44f54d(0x18f));return _0xc76361;}async[_0x4ddd30(0x183)](_0x412840){const _0x4881fa=_0x4ddd30;return await this['redisClient'][_0x4881fa(0x183)](_0x412840);}async[_0x4ddd30(0x196)](_0x2c9fc5){const _0x2ef483=_0x4ddd30,{key:_0x45c907}=_0x2c9fc5;await this[_0x2ef483(0x189)][_0x2ef483(0x196)](_0x45c907);return;}async[_0x4ddd30(0x18a)](_0x21bacd,_0x149441){const _0x241a5b=_0x4ddd30,_0x427cf0=await this['redisClient'][_0x241a5b(0x191)](_0x241a5b(0x19f)+_0x21bacd,0x0,-0x1);await this[_0x241a5b(0x19d)](_0x21bacd,_0x427cf0),this[_0x241a5b(0x189)][_0x241a5b(0x185)]('token:'+_0x21bacd,_0x149441);}async[_0x4ddd30(0x19d)](_0x479e0c,_0x18c21c){const _0xb0a447=_0x4ddd30;_0x18c21c[_0xb0a447(0x199)](_0x1aefa9=>{const _0x264836=_0xb0a447;this['redisClient']['del'](_0x264836(0x1a8)+_0x479e0c+':'+_0x1aefa9);});}async['checkTokenAuth'](_0x421402,_0x255127){const _0x1dea25=_0x4ddd30,{id:_0x4275d5,role:_0x5928d3}=_0x255127[_0x1dea25(0x1a9)];if(_0x5928d3===_0x1dea25(0x19a))return!![];const _0x2c70ed=await this[_0x1dea25(0x189)][_0x1dea25(0x19b)](_0x1dea25(0x1a8)+_0x4275d5);if(_0x2c70ed===null)return await this[_0x1dea25(0x189)][_0x1dea25(0x185)](_0x1dea25(0x1a8)+_0x4275d5,_0x421402),!![];if(_0x2c70ed!==_0x421402){if(['super','admin'][_0x1dea25(0x197)](_0x5928d3))return!![];throw new common_1[(_0x1dea25(0x1ac))]('您已在其他设备覆盖登录、请您重新登录！',common_1[_0x1dea25(0x187)]['UNAUTHORIZED']);}}async[_0x4ddd30(0x184)](_0x5a5585){const _0x7f7fce=_0x4ddd30,_0x250c45=await this[_0x7f7fce(0x189)]['get'](_0x5a5585);try{return JSON[_0x7f7fce(0x181)](_0x250c45);}catch(_0x21d091){}return _0x250c45;}async['wishSet'](_0x414c87,_0x5e9dea,_0x57c921){const _0x38a951=_0x4ddd30,_0x5d374a=typeof _0x5e9dea==='string'?_0x5e9dea:JSON[_0x38a951(0x1a4)](_0x5e9dea);await this[_0x38a951(0x189)][_0x38a951(0x185)](_0x414c87,_0x5d374a),_0x57c921&&await this[_0x38a951(0x189)]['expire'](_0x414c87,_0x57c921);}};RedisCacheService=__decorate([(0x0,common_1[_0x4ddd30(0x1aa)])(),__param(0x0,(0x0,common_1[_0x4ddd30(0x1a5)])(_0x4ddd30(0x193))),__metadata(_0x4ddd30(0x182),[Object])],RedisCacheService),exports['RedisCacheService']=RedisCacheService;