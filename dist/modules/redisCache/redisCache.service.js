'use strict';const _0x1367bf=_0x5c28;function _0x2f3a(){const _0x3b12ca=['includes','visitor','1532035SlAqQT','getOwnPropertyDescriptor','saveToken','Inject','user','super','parse','length','__metadata','57099fDdWBR','HttpStatus','get','redisClient','invalidateTokens','UNAUTHORIZED','expire','forEach','function','@nestjs/common','__param','20cvGcyq','114774BDMYZb','72YeSwDQ','JWT\x20secret\x20not\x20found\x20in\x20Redis','string','token:','wishGet','7887690xJHBhK','defineProperty','set','RedisCacheService','decorate','getJwtSecret','354qEnbMj','3582960eiVkKT','BAD_REQUEST','metadata','33bvfZlF','design:paramtypes','del','object','JWT_SECRET','2179014fnuEjR','REDIS_CLIENT','ttl','zRange','HttpException','1278621nyDKlM','checkTokenAuth'];_0x2f3a=function(){return _0x3b12ca;};return _0x2f3a();}(function(_0xe7f272,_0x1e8dfb){const _0x1e246d=_0x5c28,_0x206595=_0xe7f272();while(!![]){try{const _0x12a919=-parseInt(_0x1e246d(0x9a))/0x1+-parseInt(_0x1e246d(0xa7))/0x2+parseInt(_0x1e246d(0xaf))/0x3+parseInt(_0x1e246d(0x99))/0x4*(parseInt(_0x1e246d(0xb8))/0x5)+-parseInt(_0x1e246d(0xa6))/0x6*(parseInt(_0x1e246d(0xc1))/0x7)+parseInt(_0x1e246d(0x9b))/0x8*(-parseInt(_0x1e246d(0xb4))/0x9)+-parseInt(_0x1e246d(0xa0))/0xa*(-parseInt(_0x1e246d(0xaa))/0xb);if(_0x12a919===_0x1e8dfb)break;else _0x206595['push'](_0x206595['shift']());}catch(_0xd48ad3){_0x206595['push'](_0x206595['shift']());}}}(_0x2f3a,0xea04e));var __decorate=this&&this['__decorate']||function(_0x415aa4,_0xfd98dc,_0x17c3c2,_0x28dc54){const _0x446b72=_0x5c28;var _0x1e7406=arguments[_0x446b72(0xbf)],_0x357882=_0x1e7406<0x3?_0xfd98dc:_0x28dc54===null?_0x28dc54=Object[_0x446b72(0xb9)](_0xfd98dc,_0x17c3c2):_0x28dc54,_0x1d8a7a;if(typeof Reflect==='object'&&typeof Reflect[_0x446b72(0xa4)]===_0x446b72(0x96))_0x357882=Reflect[_0x446b72(0xa4)](_0x415aa4,_0xfd98dc,_0x17c3c2,_0x28dc54);else{for(var _0xd4c0d3=_0x415aa4[_0x446b72(0xbf)]-0x1;_0xd4c0d3>=0x0;_0xd4c0d3--)if(_0x1d8a7a=_0x415aa4[_0xd4c0d3])_0x357882=(_0x1e7406<0x3?_0x1d8a7a(_0x357882):_0x1e7406>0x3?_0x1d8a7a(_0xfd98dc,_0x17c3c2,_0x357882):_0x1d8a7a(_0xfd98dc,_0x17c3c2))||_0x357882;}return _0x1e7406>0x3&&_0x357882&&Object[_0x446b72(0xa1)](_0xfd98dc,_0x17c3c2,_0x357882),_0x357882;},__metadata=this&&this[_0x1367bf(0xc0)]||function(_0x4ef7de,_0x58e7b0){const _0x4b9360=_0x1367bf;if(typeof Reflect===_0x4b9360(0xad)&&typeof Reflect['metadata']===_0x4b9360(0x96))return Reflect[_0x4b9360(0xa9)](_0x4ef7de,_0x58e7b0);},__param=this&&this[_0x1367bf(0x98)]||function(_0x4ccd90,_0x12aa6f){return function(_0x511b16,_0x31d2a5){_0x12aa6f(_0x511b16,_0x31d2a5,_0x4ccd90);};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[_0x1367bf(0xa3)]=void 0x0;const common_1=require(_0x1367bf(0x97));function _0x5c28(_0x442723,_0x2d6e1f){const _0x2f3a36=_0x2f3a();return _0x5c28=function(_0x5c2832,_0x57e8c7){_0x5c2832=_0x5c2832-0x96;let _0x11ccee=_0x2f3a36[_0x5c2832];return _0x11ccee;},_0x5c28(_0x442723,_0x2d6e1f);}let RedisCacheService=class RedisCacheService{constructor(_0x31fae7){const _0x25ddf8=_0x1367bf;this[_0x25ddf8(0xc4)]=_0x31fae7;}async[_0x1367bf(0xc3)](_0x2f43c3){const _0x4f7c73=_0x1367bf,{key:_0x17902e}=_0x2f43c3,_0x416c5f=await this[_0x4f7c73(0xc4)][_0x4f7c73(0xc3)](_0x17902e);return await this[_0x4f7c73(0xc4)][_0x4f7c73(0xc3)](_0x17902e);}async['set'](_0x721500,_0x5a1ada){const _0x5590f2=_0x1367bf;try{const {key:_0x20be05,val:_0x52e6f0}=_0x721500;await this[_0x5590f2(0xc4)][_0x5590f2(0xa2)](_0x20be05,_0x52e6f0),_0x5a1ada&&await this[_0x5590f2(0xc4)][_0x5590f2(0xc7)](_0x20be05,_0x5a1ada);return;}catch(_0x32d6f1){throw new common_1[(_0x5590f2(0xb3))](_0x32d6f1,common_1['HttpStatus'][_0x5590f2(0xa8)]);}}async[_0x1367bf(0xa5)](){const _0x3ef67d=_0x1367bf,_0x4d3e99=await this[_0x3ef67d(0xc4)]['get'](_0x3ef67d(0xae));if(!_0x4d3e99)throw new Error(_0x3ef67d(0x9c));return _0x4d3e99;}async[_0x1367bf(0xb1)](_0x314b82){const _0x2e4fd8=_0x1367bf;return await this[_0x2e4fd8(0xc4)][_0x2e4fd8(0xb1)](_0x314b82);}async['del'](_0x209bee){const _0x1047dd=_0x1367bf,{key:_0xf5e6cd}=_0x209bee;await this[_0x1047dd(0xc4)][_0x1047dd(0xac)](_0xf5e6cd);return;}async[_0x1367bf(0xba)](_0x351abe,_0x3c5e4f){const _0x4ab7fb=_0x1367bf,_0x163a1b=await this['redisClient'][_0x4ab7fb(0xb2)]('tokens:'+_0x351abe,0x0,-0x1);await this[_0x4ab7fb(0xc5)](_0x351abe,_0x163a1b),this[_0x4ab7fb(0xc4)][_0x4ab7fb(0xa2)](_0x4ab7fb(0x9e)+_0x351abe,_0x3c5e4f);}async[_0x1367bf(0xc5)](_0x443e08,_0x239c72){const _0x430f5b=_0x1367bf;_0x239c72[_0x430f5b(0xc8)](_0x4c366b=>{const _0x490e8f=_0x430f5b;this[_0x490e8f(0xc4)][_0x490e8f(0xac)](_0x490e8f(0x9e)+_0x443e08+':'+_0x4c366b);});}async[_0x1367bf(0xb5)](_0x11992c,_0x45251b){const _0x152bf6=_0x1367bf,{id:_0x228ccf,role:_0x1be5af}=_0x45251b[_0x152bf6(0xbc)];if(_0x1be5af===_0x152bf6(0xb7))return!![];const _0x361538=await this[_0x152bf6(0xc4)][_0x152bf6(0xc3)](_0x152bf6(0x9e)+_0x228ccf);if(_0x361538===null)return await this[_0x152bf6(0xc4)][_0x152bf6(0xa2)](_0x152bf6(0x9e)+_0x228ccf,_0x11992c),!![];if(_0x361538!==_0x11992c){if([_0x152bf6(0xbd),'admin'][_0x152bf6(0xb6)](_0x1be5af))return!![];throw new common_1[(_0x152bf6(0xb3))]('您已在其他设备覆盖登录、请您重新登录！',common_1[_0x152bf6(0xc2)][_0x152bf6(0xc6)]);}}async[_0x1367bf(0x9f)](_0x1205c9){const _0x223982=_0x1367bf,_0xfeecf2=await this[_0x223982(0xc4)][_0x223982(0xc3)](_0x1205c9);try{return JSON[_0x223982(0xbe)](_0xfeecf2);}catch(_0x50c545){}return _0xfeecf2;}async['wishSet'](_0x76473a,_0x514795,_0x4e021e){const _0xf81802=_0x1367bf,_0x338f41=typeof _0x514795===_0xf81802(0x9d)?_0x514795:JSON['stringify'](_0x514795);await this[_0xf81802(0xc4)]['set'](_0x76473a,_0x338f41),_0x4e021e&&await this[_0xf81802(0xc4)][_0xf81802(0xc7)](_0x76473a,_0x4e021e);}};RedisCacheService=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,common_1[_0x1367bf(0xbb)])(_0x1367bf(0xb0))),__metadata(_0x1367bf(0xab),[Object])],RedisCacheService),exports['RedisCacheService']=RedisCacheService;