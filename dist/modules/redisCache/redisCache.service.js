'use strict';const _0x2e0fd2=_0x23cf;(function(_0x16795c,_0x524b74){const _0x2c082f=_0x23cf,_0x136b1f=_0x16795c();while(!![]){try{const _0xa3483b=-parseInt(_0x2c082f(0x1f6))/0x1*(parseInt(_0x2c082f(0x1e8))/0x2)+-parseInt(_0x2c082f(0x1dc))/0x3+-parseInt(_0x2c082f(0x1dd))/0x4+-parseInt(_0x2c082f(0x1e6))/0x5+parseInt(_0x2c082f(0x1d5))/0x6+-parseInt(_0x2c082f(0x1f3))/0x7+parseInt(_0x2c082f(0x1e5))/0x8;if(_0xa3483b===_0x524b74)break;else _0x136b1f['push'](_0x136b1f['shift']());}catch(_0x50eaef){_0x136b1f['push'](_0x136b1f['shift']());}}}(_0x1b05,0x84c41));var __decorate=this&&this[_0x2e0fd2(0x1de)]||function(_0x370df8,_0x12902a,_0x374c62,_0x491c4b){const _0x27f3cc=_0x2e0fd2;var _0x61921d=arguments[_0x27f3cc(0x1f5)],_0x248398=_0x61921d<0x3?_0x12902a:_0x491c4b===null?_0x491c4b=Object[_0x27f3cc(0x1e0)](_0x12902a,_0x374c62):_0x491c4b,_0x30a3f7;if(typeof Reflect===_0x27f3cc(0x1d6)&&typeof Reflect[_0x27f3cc(0x1d2)]===_0x27f3cc(0x1ee))_0x248398=Reflect[_0x27f3cc(0x1d2)](_0x370df8,_0x12902a,_0x374c62,_0x491c4b);else{for(var _0x86f811=_0x370df8['length']-0x1;_0x86f811>=0x0;_0x86f811--)if(_0x30a3f7=_0x370df8[_0x86f811])_0x248398=(_0x61921d<0x3?_0x30a3f7(_0x248398):_0x61921d>0x3?_0x30a3f7(_0x12902a,_0x374c62,_0x248398):_0x30a3f7(_0x12902a,_0x374c62))||_0x248398;}return _0x61921d>0x3&&_0x248398&&Object[_0x27f3cc(0x1e4)](_0x12902a,_0x374c62,_0x248398),_0x248398;},__metadata=this&&this[_0x2e0fd2(0x1e1)]||function(_0x2db377,_0x2f6573){const _0x326c2c=_0x2e0fd2;if(typeof Reflect===_0x326c2c(0x1d6)&&typeof Reflect[_0x326c2c(0x1e7)]==='function')return Reflect[_0x326c2c(0x1e7)](_0x2db377,_0x2f6573);},__param=this&&this[_0x2e0fd2(0x1d4)]||function(_0x4637a5,_0x464253){return function(_0x4cb217,_0x326a59){_0x464253(_0x4cb217,_0x326a59,_0x4637a5);};};Object[_0x2e0fd2(0x1e4)](exports,_0x2e0fd2(0x1d0),{'value':!![]}),exports['RedisCacheService']=void 0x0;function _0x1b05(){const _0x2d8f2d=['UNAUTHORIZED','getOwnPropertyDescriptor','__metadata','invalidateTokens','HttpException','defineProperty','19542864nMgyGz','3176985Nynspc','metadata','2bJXvqX','wishGet','token:','del','stringify','ttl','function','redisClient','set','string','checkTokenAuth','2611322zNaUVo','get','length','319517MUCAXL','expire','HttpStatus','REDIS_CLIENT','tokens:','Injectable','您已在其他设备覆盖登录、请您重新登录！','__esModule','@nestjs/common','decorate','getJwtSecret','__param','6123366AWlNRg','object','includes','saveToken','JWT_SECRET','zRange','admin','3112113EAXKZh','2217116lNcgUU','__decorate'];_0x1b05=function(){return _0x2d8f2d;};return _0x1b05();}const common_1=require(_0x2e0fd2(0x1d1));function _0x23cf(_0x20841b,_0x3bf4ba){const _0x1b0541=_0x1b05();return _0x23cf=function(_0x23cf2f,_0x2fe433){_0x23cf2f=_0x23cf2f-0x1cf;let _0x32b5fe=_0x1b0541[_0x23cf2f];return _0x32b5fe;},_0x23cf(_0x20841b,_0x3bf4ba);}let RedisCacheService=class RedisCacheService{constructor(_0x2f98cc){const _0x27e24e=_0x2e0fd2;this[_0x27e24e(0x1ef)]=_0x2f98cc;}async[_0x2e0fd2(0x1f4)](_0x1bfc5a){const _0x40b7a3=_0x2e0fd2,{key:_0x457c82}=_0x1bfc5a,_0x20a67b=await this[_0x40b7a3(0x1ef)][_0x40b7a3(0x1f4)](_0x457c82);return await this[_0x40b7a3(0x1ef)][_0x40b7a3(0x1f4)](_0x457c82);}async['set'](_0x10fb0b,_0x163ba5){const _0x2299d5=_0x2e0fd2;try{const {key:_0x4fe3df,val:_0x311447}=_0x10fb0b;await this[_0x2299d5(0x1ef)][_0x2299d5(0x1f0)](_0x4fe3df,_0x311447),_0x163ba5&&await this[_0x2299d5(0x1ef)][_0x2299d5(0x1f7)](_0x4fe3df,_0x163ba5);return;}catch(_0x3e92dc){throw new common_1[(_0x2299d5(0x1e3))](_0x3e92dc,common_1[_0x2299d5(0x1f8)]['BAD_REQUEST']);}}async[_0x2e0fd2(0x1d3)](){const _0x127cb3=_0x2e0fd2,_0x381e17=await this[_0x127cb3(0x1ef)][_0x127cb3(0x1f4)](_0x127cb3(0x1d9));if(!_0x381e17)throw new Error('JWT\x20secret\x20not\x20found\x20in\x20Redis');return _0x381e17;}async[_0x2e0fd2(0x1ed)](_0x4aeba9){const _0x503f90=_0x2e0fd2;return await this[_0x503f90(0x1ef)][_0x503f90(0x1ed)](_0x4aeba9);}async[_0x2e0fd2(0x1eb)](_0x5998c4){const _0x286ff4=_0x2e0fd2,{key:_0xad0ac6}=_0x5998c4;await this['redisClient'][_0x286ff4(0x1eb)](_0xad0ac6);return;}async[_0x2e0fd2(0x1d8)](_0x25cd9b,_0x4b4b61){const _0x196754=_0x2e0fd2,_0x5616cc=await this[_0x196754(0x1ef)][_0x196754(0x1da)](_0x196754(0x1fa)+_0x25cd9b,0x0,-0x1);await this[_0x196754(0x1e2)](_0x25cd9b,_0x5616cc),this[_0x196754(0x1ef)]['set'](_0x196754(0x1ea)+_0x25cd9b,_0x4b4b61);}async[_0x2e0fd2(0x1e2)](_0x50b1e6,_0x54d9a9){_0x54d9a9['forEach'](_0x2de916=>{const _0xc5048c=_0x23cf;this[_0xc5048c(0x1ef)][_0xc5048c(0x1eb)]('token:'+_0x50b1e6+':'+_0x2de916);});}async[_0x2e0fd2(0x1f2)](_0x191892,_0x1caf55){const _0x5b8b29=_0x2e0fd2,{id:_0x5ef7bb,role:_0xea0ff4}=_0x1caf55['user'];if(_0xea0ff4==='visitor')return!![];const _0x53df51=await this['redisClient']['get'](_0x5b8b29(0x1ea)+_0x5ef7bb);if(_0x53df51===null)return await this[_0x5b8b29(0x1ef)]['set'](_0x5b8b29(0x1ea)+_0x5ef7bb,_0x191892),!![];if(_0x53df51!==_0x191892){if(['super',_0x5b8b29(0x1db)][_0x5b8b29(0x1d7)](_0xea0ff4))return!![];throw new common_1[(_0x5b8b29(0x1e3))](_0x5b8b29(0x1cf),common_1['HttpStatus'][_0x5b8b29(0x1df)]);}}async[_0x2e0fd2(0x1e9)](_0x732424){const _0x52bfe8=_0x2e0fd2,_0x26af3a=await this[_0x52bfe8(0x1ef)]['get'](_0x732424);try{return JSON['parse'](_0x26af3a);}catch(_0x2ddd67){}return _0x26af3a;}async['wishSet'](_0xdd3464,_0x934633,_0xe9ab41){const _0x5860c0=_0x2e0fd2,_0x431f27=typeof _0x934633===_0x5860c0(0x1f1)?_0x934633:JSON[_0x5860c0(0x1ec)](_0x934633);await this['redisClient'][_0x5860c0(0x1f0)](_0xdd3464,_0x431f27),_0xe9ab41&&await this[_0x5860c0(0x1ef)]['expire'](_0xdd3464,_0xe9ab41);}};RedisCacheService=__decorate([(0x0,common_1[_0x2e0fd2(0x1fb)])(),__param(0x0,(0x0,common_1['Inject'])(_0x2e0fd2(0x1f9))),__metadata('design:paramtypes',[Object])],RedisCacheService),exports['RedisCacheService']=RedisCacheService;