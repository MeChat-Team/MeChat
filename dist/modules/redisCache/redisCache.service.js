'use strict';const _0x2445f3=_0x2595;(function(_0x3326f5,_0x5e3ebe){const _0x49b580=_0x2595,_0xe45353=_0x3326f5();while(!![]){try{const _0x3c6b4e=-parseInt(_0x49b580(0x1a8))/0x1*(parseInt(_0x49b580(0x18c))/0x2)+-parseInt(_0x49b580(0x1b3))/0x3*(parseInt(_0x49b580(0x195))/0x4)+-parseInt(_0x49b580(0x1ad))/0x5+-parseInt(_0x49b580(0x199))/0x6*(parseInt(_0x49b580(0x1a7))/0x7)+parseInt(_0x49b580(0x1a5))/0x8+-parseInt(_0x49b580(0x18a))/0x9*(-parseInt(_0x49b580(0x1a4))/0xa)+parseInt(_0x49b580(0x1ab))/0xb;if(_0x3c6b4e===_0x5e3ebe)break;else _0xe45353['push'](_0xe45353['shift']());}catch(_0x3ea6af){_0xe45353['push'](_0xe45353['shift']());}}}(_0x413e,0x37845));var __decorate=this&&this[_0x2445f3(0x18e)]||function(_0x219a15,_0x5eaa10,_0x947d73,_0x30e6f5){const _0x2f4828=_0x2445f3;var _0x24957a=arguments[_0x2f4828(0x1b7)],_0x492169=_0x24957a<0x3?_0x5eaa10:_0x30e6f5===null?_0x30e6f5=Object[_0x2f4828(0x193)](_0x5eaa10,_0x947d73):_0x30e6f5,_0x252b6f;if(typeof Reflect===_0x2f4828(0x1b0)&&typeof Reflect[_0x2f4828(0x1a3)]===_0x2f4828(0x19a))_0x492169=Reflect[_0x2f4828(0x1a3)](_0x219a15,_0x5eaa10,_0x947d73,_0x30e6f5);else{for(var _0x13de69=_0x219a15['length']-0x1;_0x13de69>=0x0;_0x13de69--)if(_0x252b6f=_0x219a15[_0x13de69])_0x492169=(_0x24957a<0x3?_0x252b6f(_0x492169):_0x24957a>0x3?_0x252b6f(_0x5eaa10,_0x947d73,_0x492169):_0x252b6f(_0x5eaa10,_0x947d73))||_0x492169;}return _0x24957a>0x3&&_0x492169&&Object[_0x2f4828(0x194)](_0x5eaa10,_0x947d73,_0x492169),_0x492169;},__metadata=this&&this[_0x2445f3(0x197)]||function(_0xd09743,_0x301dff){const _0x320751=_0x2445f3;if(typeof Reflect===_0x320751(0x1b0)&&typeof Reflect[_0x320751(0x1b2)]===_0x320751(0x19a))return Reflect['metadata'](_0xd09743,_0x301dff);},__param=this&&this[_0x2445f3(0x1b8)]||function(_0x4f2855,_0x571e3c){return function(_0x46ee6d,_0x6e2908){_0x571e3c(_0x46ee6d,_0x6e2908,_0x4f2855);};};Object[_0x2445f3(0x194)](exports,'__esModule',{'value':!![]}),exports[_0x2445f3(0x19d)]=void 0x0;const common_1=require('@nestjs/common');let RedisCacheService=class RedisCacheService{constructor(_0x5ad736){const _0x5b391a=_0x2445f3;this[_0x5b391a(0x1aa)]=_0x5ad736;}async[_0x2445f3(0x19f)](_0xb0691){const _0x3b3487=_0x2445f3,{key:_0xda2f9a}=_0xb0691,_0x56a6eb=await this[_0x3b3487(0x1aa)][_0x3b3487(0x19f)](_0xda2f9a);return await this['redisClient'][_0x3b3487(0x19f)](_0xda2f9a);}async[_0x2445f3(0x1a2)](_0x212c7a,_0x7433f1){const _0x1c3618=_0x2445f3;try{const {key:_0xadaf4,val:_0x229c86}=_0x212c7a;await this[_0x1c3618(0x1aa)]['set'](_0xadaf4,_0x229c86),_0x7433f1&&await this[_0x1c3618(0x1aa)][_0x1c3618(0x192)](_0xadaf4,_0x7433f1);return;}catch(_0x1ce7c3){throw new common_1[(_0x1c3618(0x1af))](_0x1ce7c3,common_1['HttpStatus'][_0x1c3618(0x189)]);}}async[_0x2445f3(0x19b)](){const _0x41539e=_0x2445f3,_0x2d7a51=await this[_0x41539e(0x1aa)][_0x41539e(0x19f)]('JWT_SECRET');if(!_0x2d7a51)throw new Error(_0x41539e(0x1a0));return _0x2d7a51;}async[_0x2445f3(0x1b6)](_0x407ee0){const _0x1e53e3=_0x2445f3;return await this[_0x1e53e3(0x1aa)][_0x1e53e3(0x1b6)](_0x407ee0);}async[_0x2445f3(0x196)](_0x55def5){const _0x10f528=_0x2445f3,{key:_0x194781}=_0x55def5;await this[_0x10f528(0x1aa)][_0x10f528(0x196)](_0x194781);return;}async[_0x2445f3(0x18f)](_0x1717ba,_0xd02f30){const _0x4a79ff=_0x2445f3,_0x152ad8=await this[_0x4a79ff(0x1aa)]['zRange'](_0x4a79ff(0x198)+_0x1717ba,0x0,-0x1);await this['invalidateTokens'](_0x1717ba,_0x152ad8),this['redisClient'][_0x4a79ff(0x1a2)](_0x4a79ff(0x1b1)+_0x1717ba,_0xd02f30);}async[_0x2445f3(0x1b4)](_0x43fd8d,_0x316137){_0x316137['forEach'](_0x2f166d=>{const _0x160628=_0x2595;this[_0x160628(0x1aa)][_0x160628(0x196)](_0x160628(0x1b1)+_0x43fd8d+':'+_0x2f166d);});}async[_0x2445f3(0x18b)](_0x4ce14d,_0x5baa0c){const _0x1d4972=_0x2445f3,{id:_0x43929e,role:_0x3dc267}=_0x5baa0c[_0x1d4972(0x18d)];if(_0x3dc267==='visitor')return!![];const _0x30235f=await this['redisClient'][_0x1d4972(0x19f)]('token:'+_0x43929e);if(_0x30235f===null)return await this[_0x1d4972(0x1aa)]['set']('token:'+_0x43929e,_0x4ce14d),!![];if(_0x30235f!==_0x4ce14d){if([_0x1d4972(0x1ae),_0x1d4972(0x1a1)][_0x1d4972(0x19e)](_0x3dc267))return!![];throw new common_1[(_0x1d4972(0x1af))](_0x1d4972(0x19c),common_1[_0x1d4972(0x1b5)]['UNAUTHORIZED']);}}async['wishGet'](_0x20cc66){const _0x90ee2d=_0x2445f3,_0x563666=await this['redisClient'][_0x90ee2d(0x19f)](_0x20cc66);try{return JSON[_0x90ee2d(0x1a9)](_0x563666);}catch(_0x462f71){}return _0x563666;}async[_0x2445f3(0x1a6)](_0x4cf41d,_0x40ea8a,_0x4b9cb8){const _0xc7afa2=_0x2445f3,_0x2fda08=typeof _0x40ea8a==='string'?_0x40ea8a:JSON[_0xc7afa2(0x191)](_0x40ea8a);await this[_0xc7afa2(0x1aa)][_0xc7afa2(0x1a2)](_0x4cf41d,_0x2fda08),_0x4b9cb8&&await this[_0xc7afa2(0x1aa)][_0xc7afa2(0x192)](_0x4cf41d,_0x4b9cb8);}};function _0x2595(_0x5ce3c0,_0x1c3abb){const _0x413e1d=_0x413e();return _0x2595=function(_0x259545,_0x4ee8cc){_0x259545=_0x259545-0x189;let _0x4fdc19=_0x413e1d[_0x259545];return _0x4fdc19;},_0x2595(_0x5ce3c0,_0x1c3abb);}RedisCacheService=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,common_1[_0x2445f3(0x1ac)])('REDIS_CLIENT')),__metadata(_0x2445f3(0x190),[Object])],RedisCacheService),exports['RedisCacheService']=RedisCacheService;function _0x413e(){const _0x575979=['saveToken','design:paramtypes','stringify','expire','getOwnPropertyDescriptor','defineProperty','1415692ubDjuG','del','__metadata','tokens:','1218pzWeSR','function','getJwtSecret','您已在其他设备覆盖登录、请您重新登录！','RedisCacheService','includes','get','JWT\x20secret\x20not\x20found\x20in\x20Redis','admin','set','decorate','20NUUdAo','2872040wsmYEq','wishSet','6209ZhPlgv','1253tYKXEb','parse','redisClient','9232388tyILKx','Inject','2007545MWzFjj','super','HttpException','object','token:','metadata','3YcPDUO','invalidateTokens','HttpStatus','ttl','length','__param','BAD_REQUEST','60498bZSYux','checkTokenAuth','78HLnjxg','user','__decorate'];_0x413e=function(){return _0x575979;};return _0x413e();}