'use strict';const _0x421264=_0x3c67;(function(_0x1addbb,_0x15582b){const _0x27d918=_0x3c67,_0xfdf1f4=_0x1addbb();while(!![]){try{const _0xa1bb8b=-parseInt(_0x27d918(0x9f))/0x1*(-parseInt(_0x27d918(0xb3))/0x2)+parseInt(_0x27d918(0xaa))/0x3+-parseInt(_0x27d918(0xb6))/0x4+parseInt(_0x27d918(0xb1))/0x5*(-parseInt(_0x27d918(0x8e))/0x6)+-parseInt(_0x27d918(0xae))/0x7*(parseInt(_0x27d918(0x92))/0x8)+parseInt(_0x27d918(0x98))/0x9*(parseInt(_0x27d918(0xa6))/0xa)+-parseInt(_0x27d918(0x88))/0xb*(-parseInt(_0x27d918(0xa8))/0xc);if(_0xa1bb8b===_0x15582b)break;else _0xfdf1f4['push'](_0xfdf1f4['shift']());}catch(_0x3b87c3){_0xfdf1f4['push'](_0xfdf1f4['shift']());}}}(_0x4b5a,0xb7c51));var __decorate=this&&this[_0x421264(0xa2)]||function(_0x52cab7,_0x3001bf,_0x2a38a9,_0x297cd1){const _0x47dea1=_0x421264;var _0x1478d=arguments['length'],_0x349895=_0x1478d<0x3?_0x3001bf:_0x297cd1===null?_0x297cd1=Object[_0x47dea1(0xa4)](_0x3001bf,_0x2a38a9):_0x297cd1,_0x369080;if(typeof Reflect===_0x47dea1(0x90)&&typeof Reflect[_0x47dea1(0xac)]===_0x47dea1(0xb2))_0x349895=Reflect[_0x47dea1(0xac)](_0x52cab7,_0x3001bf,_0x2a38a9,_0x297cd1);else{for(var _0x2b59fe=_0x52cab7[_0x47dea1(0x99)]-0x1;_0x2b59fe>=0x0;_0x2b59fe--)if(_0x369080=_0x52cab7[_0x2b59fe])_0x349895=(_0x1478d<0x3?_0x369080(_0x349895):_0x1478d>0x3?_0x369080(_0x3001bf,_0x2a38a9,_0x349895):_0x369080(_0x3001bf,_0x2a38a9))||_0x349895;}return _0x1478d>0x3&&_0x349895&&Object[_0x47dea1(0xb4)](_0x3001bf,_0x2a38a9,_0x349895),_0x349895;},__metadata=this&&this['__metadata']||function(_0x358aca,_0x2bd9e8){const _0x1f90fc=_0x421264;if(typeof Reflect===_0x1f90fc(0x90)&&typeof Reflect[_0x1f90fc(0xb7)]===_0x1f90fc(0xb2))return Reflect[_0x1f90fc(0xb7)](_0x358aca,_0x2bd9e8);},__param=this&&this[_0x421264(0x9c)]||function(_0x2371fb,_0x315258){return function(_0xa09ae1,_0x5be3ff){_0x315258(_0xa09ae1,_0x5be3ff,_0x2371fb);};};function _0x4b5a(){const _0x3a9680=['metadata','wishGet','wishSet','zRange','__esModule','expire','REDIS_CLIENT','2574jpUPmu','HttpException','forEach','getJwtSecret','invalidateTokens','token:','696294QcdKBe','ttl','object','Injectable','16IGvkir','Inject','UNAUTHORIZED','includes','RedisCacheService','set','9ajnhwu','length','visitor','parse','__param','design:paramtypes','您已在其他设备覆盖登录、请您重新登录！','1115458RMWGFY','del','HttpStatus','__decorate','get','getOwnPropertyDescriptor','@nestjs/common','11591980XNJrBF','user','53808xPOsQa','checkTokenAuth','2285892AjafaH','string','decorate','JWT\x20secret\x20not\x20found\x20in\x20Redis','3577497FThScT','BAD_REQUEST','stringify','50QgQaFH','function','2VsDKgj','defineProperty','redisClient','4602092cewbWJ'];_0x4b5a=function(){return _0x3a9680;};return _0x4b5a();}Object[_0x421264(0xb4)](exports,_0x421264(0xbb),{'value':!![]}),exports['RedisCacheService']=void 0x0;const common_1=require(_0x421264(0xa5));function _0x3c67(_0x1ebf64,_0x58041d){const _0x4b5acb=_0x4b5a();return _0x3c67=function(_0x3c670e,_0x2a3d35){_0x3c670e=_0x3c670e-0x86;let _0x597f31=_0x4b5acb[_0x3c670e];return _0x597f31;},_0x3c67(_0x1ebf64,_0x58041d);}let RedisCacheService=class RedisCacheService{constructor(_0x243213){this['redisClient']=_0x243213;}async['get'](_0x32a279){const _0x1048fb=_0x421264,{key:_0x4641e7}=_0x32a279,_0x133a00=await this[_0x1048fb(0xb5)]['get'](_0x4641e7);return await this[_0x1048fb(0xb5)][_0x1048fb(0xa3)](_0x4641e7);}async[_0x421264(0x97)](_0x3cb646,_0x520560){const _0x404bfc=_0x421264;try{const {key:_0x4676e8,val:_0x1b1c24}=_0x3cb646;await this[_0x404bfc(0xb5)][_0x404bfc(0x97)](_0x4676e8,_0x1b1c24),_0x520560&&await this[_0x404bfc(0xb5)][_0x404bfc(0x86)](_0x4676e8,_0x520560);return;}catch(_0x17ada9){throw new common_1[(_0x404bfc(0x89))](_0x17ada9,common_1[_0x404bfc(0xa1)][_0x404bfc(0xaf)]);}}async[_0x421264(0x8b)](){const _0x326ae2=_0x421264,_0x1266bf=await this['redisClient'][_0x326ae2(0xa3)]('JWT_SECRET');if(!_0x1266bf)throw new Error(_0x326ae2(0xad));return _0x1266bf;}async[_0x421264(0x8f)](_0xbfcffa){const _0x22bf20=_0x421264;return await this[_0x22bf20(0xb5)][_0x22bf20(0x8f)](_0xbfcffa);}async['del'](_0x38b7bd){const {key:_0x31a5a6}=_0x38b7bd;await this['redisClient']['del'](_0x31a5a6);return;}async['saveToken'](_0x1d4ae3,_0x1b8095){const _0x5b7c34=_0x421264,_0x466dba=await this['redisClient'][_0x5b7c34(0xba)]('tokens:'+_0x1d4ae3,0x0,-0x1);await this['invalidateTokens'](_0x1d4ae3,_0x466dba),this[_0x5b7c34(0xb5)][_0x5b7c34(0x97)](_0x5b7c34(0x8d)+_0x1d4ae3,_0x1b8095);}async[_0x421264(0x8c)](_0x50f1e7,_0x477d89){const _0x35a5f6=_0x421264;_0x477d89[_0x35a5f6(0x8a)](_0x39b4fc=>{const _0x4b44e8=_0x35a5f6;this['redisClient'][_0x4b44e8(0xa0)](_0x4b44e8(0x8d)+_0x50f1e7+':'+_0x39b4fc);});}async[_0x421264(0xa9)](_0x475ce1,_0x5213d9){const _0x12337f=_0x421264,{id:_0x19f23c,role:_0x3effe2}=_0x5213d9[_0x12337f(0xa7)];if(_0x3effe2===_0x12337f(0x9a))return!![];const _0x51ddd6=await this[_0x12337f(0xb5)][_0x12337f(0xa3)](_0x12337f(0x8d)+_0x19f23c);if(_0x51ddd6===null)return await this['redisClient']['set'](_0x12337f(0x8d)+_0x19f23c,_0x475ce1),!![];if(_0x51ddd6!==_0x475ce1){if(['super','admin'][_0x12337f(0x95)](_0x3effe2))return!![];throw new common_1[(_0x12337f(0x89))](_0x12337f(0x9e),common_1[_0x12337f(0xa1)][_0x12337f(0x94)]);}}async[_0x421264(0xb8)](_0x3d1971){const _0x365e29=_0x421264,_0x389532=await this[_0x365e29(0xb5)][_0x365e29(0xa3)](_0x3d1971);try{return JSON[_0x365e29(0x9b)](_0x389532);}catch(_0x14dafc){}return _0x389532;}async[_0x421264(0xb9)](_0x155204,_0x590e15,_0x365b13){const _0x173fbb=_0x421264,_0x22bac1=typeof _0x590e15===_0x173fbb(0xab)?_0x590e15:JSON[_0x173fbb(0xb0)](_0x590e15);await this[_0x173fbb(0xb5)][_0x173fbb(0x97)](_0x155204,_0x22bac1),_0x365b13&&await this['redisClient'][_0x173fbb(0x86)](_0x155204,_0x365b13);}};RedisCacheService=__decorate([(0x0,common_1[_0x421264(0x91)])(),__param(0x0,(0x0,common_1[_0x421264(0x93)])(_0x421264(0x87))),__metadata(_0x421264(0x9d),[Object])],RedisCacheService),exports[_0x421264(0x96)]=RedisCacheService;