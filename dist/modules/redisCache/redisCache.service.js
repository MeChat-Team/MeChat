'use strict';const _0x54fa66=_0x1d50;(function(_0x45d504,_0x18a8d2){const _0x4cb382=_0x1d50,_0x55da12=_0x45d504();while(!![]){try{const _0x4e977a=parseInt(_0x4cb382(0x98))/0x1*(parseInt(_0x4cb382(0x8c))/0x2)+-parseInt(_0x4cb382(0x6d))/0x3*(parseInt(_0x4cb382(0x93))/0x4)+-parseInt(_0x4cb382(0x8b))/0x5+-parseInt(_0x4cb382(0x82))/0x6+parseInt(_0x4cb382(0x6a))/0x7*(-parseInt(_0x4cb382(0x94))/0x8)+-parseInt(_0x4cb382(0x8d))/0x9*(-parseInt(_0x4cb382(0x7c))/0xa)+-parseInt(_0x4cb382(0x73))/0xb*(-parseInt(_0x4cb382(0x87))/0xc);if(_0x4e977a===_0x18a8d2)break;else _0x55da12['push'](_0x55da12['shift']());}catch(_0x2439fc){_0x55da12['push'](_0x55da12['shift']());}}}(_0x10b1,0x38b83));var __decorate=this&&this[_0x54fa66(0x70)]||function(_0x33edf3,_0x459e2a,_0x45dfc4,_0x5518f7){const _0xedf3ce=_0x54fa66;var _0xebc33d=arguments['length'],_0x158aad=_0xebc33d<0x3?_0x459e2a:_0x5518f7===null?_0x5518f7=Object['getOwnPropertyDescriptor'](_0x459e2a,_0x45dfc4):_0x5518f7,_0x168904;if(typeof Reflect==='object'&&typeof Reflect[_0xedf3ce(0x96)]===_0xedf3ce(0x90))_0x158aad=Reflect['decorate'](_0x33edf3,_0x459e2a,_0x45dfc4,_0x5518f7);else{for(var _0x2d2c27=_0x33edf3[_0xedf3ce(0x76)]-0x1;_0x2d2c27>=0x0;_0x2d2c27--)if(_0x168904=_0x33edf3[_0x2d2c27])_0x158aad=(_0xebc33d<0x3?_0x168904(_0x158aad):_0xebc33d>0x3?_0x168904(_0x459e2a,_0x45dfc4,_0x158aad):_0x168904(_0x459e2a,_0x45dfc4))||_0x158aad;}return _0xebc33d>0x3&&_0x158aad&&Object[_0xedf3ce(0x77)](_0x459e2a,_0x45dfc4,_0x158aad),_0x158aad;},__metadata=this&&this[_0x54fa66(0x89)]||function(_0x2e450a,_0x477fae){const _0x5acb1e=_0x54fa66;if(typeof Reflect===_0x5acb1e(0x8f)&&typeof Reflect[_0x5acb1e(0x8a)]===_0x5acb1e(0x90))return Reflect[_0x5acb1e(0x8a)](_0x2e450a,_0x477fae);},__param=this&&this[_0x54fa66(0x92)]||function(_0x5bc6af,_0xc875f3){return function(_0x34f8e4,_0x39f8b3){_0xc875f3(_0x34f8e4,_0x39f8b3,_0x5bc6af);};};Object['defineProperty'](exports,_0x54fa66(0x6f),{'value':!![]}),exports['RedisCacheService']=void 0x0;function _0x10b1(){const _0x411b54=['1030gbGtMK','set','token:','stringify','expire','您已在其他设备覆盖登录、请您重新登录！','557160dJHqhm','HttpException','checkTokenAuth','BAD_REQUEST','ttl','108EgKSMz','wishGet','__metadata','metadata','588970gPVSdo','24JYLnqX','16785cpjTMU','UNAUTHORIZED','object','function','RedisCacheService','__param','1164912Lrcrrv','280zWZvCO','Injectable','decorate','super','15443ZWSbOU','redisClient','forEach','JWT_SECRET','tokens:','zRange','15547utSnsr','get','getJwtSecret','3YgREcT','HttpStatus','__esModule','__decorate','parse','del','531091HjvQBA','admin','@nestjs/common','length','defineProperty','saveToken','visitor','Inject','wishSet'];_0x10b1=function(){return _0x411b54;};return _0x10b1();}function _0x1d50(_0x4a2895,_0x2baf3e){const _0x10b1fa=_0x10b1();return _0x1d50=function(_0x1d5023,_0x3c1b06){_0x1d5023=_0x1d5023-0x69;let _0x45d236=_0x10b1fa[_0x1d5023];return _0x45d236;},_0x1d50(_0x4a2895,_0x2baf3e);}const common_1=require(_0x54fa66(0x75));let RedisCacheService=class RedisCacheService{constructor(_0x4ff21b){const _0x452553=_0x54fa66;this[_0x452553(0x99)]=_0x4ff21b;}async[_0x54fa66(0x6b)](_0x48c79a){const _0x26e71a=_0x54fa66,{key:_0x19a1b1}=_0x48c79a,_0x293afb=await this['redisClient'][_0x26e71a(0x6b)](_0x19a1b1);return await this['redisClient'][_0x26e71a(0x6b)](_0x19a1b1);}async[_0x54fa66(0x7d)](_0xdaae05,_0x32d27a){const _0x47accb=_0x54fa66;try{const {key:_0x40d536,val:_0x5468d5}=_0xdaae05;await this['redisClient'][_0x47accb(0x7d)](_0x40d536,_0x5468d5),_0x32d27a&&await this[_0x47accb(0x99)][_0x47accb(0x80)](_0x40d536,_0x32d27a);return;}catch(_0x24b5e0){throw new common_1[(_0x47accb(0x83))](_0x24b5e0,common_1['HttpStatus'][_0x47accb(0x85)]);}}async[_0x54fa66(0x6c)](){const _0x1f0293=_0x54fa66,_0x9909a0=await this['redisClient']['get'](_0x1f0293(0x9b));if(!_0x9909a0)throw new Error('JWT\x20secret\x20not\x20found\x20in\x20Redis');return _0x9909a0;}async[_0x54fa66(0x86)](_0x5bb13a){const _0x392a75=_0x54fa66;return await this[_0x392a75(0x99)][_0x392a75(0x86)](_0x5bb13a);}async[_0x54fa66(0x72)](_0x72df56){const _0x5e6173=_0x54fa66,{key:_0x4aba8a}=_0x72df56;await this[_0x5e6173(0x99)][_0x5e6173(0x72)](_0x4aba8a);return;}async[_0x54fa66(0x78)](_0x3e35f3,_0x1e5d29){const _0x1244d0=_0x54fa66,_0x266782=await this['redisClient'][_0x1244d0(0x69)](_0x1244d0(0x9c)+_0x3e35f3,0x0,-0x1);await this['invalidateTokens'](_0x3e35f3,_0x266782),this[_0x1244d0(0x99)][_0x1244d0(0x7d)](_0x1244d0(0x7e)+_0x3e35f3,_0x1e5d29);}async['invalidateTokens'](_0x2f2845,_0x5c7502){const _0x5357b6=_0x54fa66;_0x5c7502[_0x5357b6(0x9a)](_0x178bc3=>{const _0x39c50c=_0x5357b6;this['redisClient'][_0x39c50c(0x72)](_0x39c50c(0x7e)+_0x2f2845+':'+_0x178bc3);});}async[_0x54fa66(0x84)](_0x521136,_0x33f696){const _0x15643a=_0x54fa66,{id:_0x9d174d,role:_0x3fc2a2}=_0x33f696['user'];if(_0x3fc2a2===_0x15643a(0x79))return!![];const _0x162bdf=await this[_0x15643a(0x99)][_0x15643a(0x6b)](_0x15643a(0x7e)+_0x9d174d);if(_0x162bdf===null)return await this[_0x15643a(0x99)][_0x15643a(0x7d)](_0x15643a(0x7e)+_0x9d174d,_0x521136),!![];if(_0x162bdf!==_0x521136){if([_0x15643a(0x97),_0x15643a(0x74)]['includes'](_0x3fc2a2))return!![];throw new common_1[(_0x15643a(0x83))](_0x15643a(0x81),common_1[_0x15643a(0x6e)][_0x15643a(0x8e)]);}}async[_0x54fa66(0x88)](_0x3e3fc6){const _0x38b9c8=_0x54fa66,_0x4720cb=await this['redisClient'][_0x38b9c8(0x6b)](_0x3e3fc6);try{return JSON[_0x38b9c8(0x71)](_0x4720cb);}catch(_0xbf1299){}return _0x4720cb;}async[_0x54fa66(0x7b)](_0x129be1,_0x565fd1,_0x586730){const _0x5aae34=_0x54fa66,_0x40e303=typeof _0x565fd1==='string'?_0x565fd1:JSON[_0x5aae34(0x7f)](_0x565fd1);await this[_0x5aae34(0x99)][_0x5aae34(0x7d)](_0x129be1,_0x40e303),_0x586730&&await this[_0x5aae34(0x99)][_0x5aae34(0x80)](_0x129be1,_0x586730);}};RedisCacheService=__decorate([(0x0,common_1[_0x54fa66(0x95)])(),__param(0x0,(0x0,common_1[_0x54fa66(0x7a)])('REDIS_CLIENT')),__metadata('design:paramtypes',[Object])],RedisCacheService),exports[_0x54fa66(0x91)]=RedisCacheService;