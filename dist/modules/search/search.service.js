'use strict';const _0x35a9d3=_0x6963;function _0x6963(_0x51acd1,_0xf4ecc1){const _0x372d72=_0x372d();return _0x6963=function(_0x6963fb,_0x2ae1dc){_0x6963fb=_0x6963fb-0x7e;let _0x14e18f=_0x372d72[_0x6963fb];return _0x14e18f;},_0x6963(_0x51acd1,_0xf4ecc1);}(function(_0x37dee8,_0x302c98){const _0x92fc7b=_0x6963,_0x331354=_0x37dee8();while(!![]){try{const _0x4ea52c=parseInt(_0x92fc7b(0x9a))/0x1*(parseInt(_0x92fc7b(0xbe))/0x2)+-parseInt(_0x92fc7b(0xc0))/0x3*(-parseInt(_0x92fc7b(0x92))/0x4)+-parseInt(_0x92fc7b(0x87))/0x5+-parseInt(_0x92fc7b(0xb8))/0x6*(parseInt(_0x92fc7b(0xad))/0x7)+-parseInt(_0x92fc7b(0x91))/0x8*(-parseInt(_0x92fc7b(0xb1))/0x9)+parseInt(_0x92fc7b(0x81))/0xa*(-parseInt(_0x92fc7b(0x8a))/0xb)+parseInt(_0x92fc7b(0xa6))/0xc*(parseInt(_0x92fc7b(0x9c))/0xd);if(_0x4ea52c===_0x302c98)break;else _0x331354['push'](_0x331354['shift']());}catch(_0x4f8897){_0x331354['push'](_0x331354['shift']());}}}(_0x372d,0xa5a14));var __decorate=this&&this['__decorate']||function(_0x1790e9,_0x23e027,_0x397341,_0x4f450a){const _0x1718cc=_0x6963;var _0x121de8=arguments['length'],_0x141192=_0x121de8<0x3?_0x23e027:_0x4f450a===null?_0x4f450a=Object[_0x1718cc(0x8b)](_0x23e027,_0x397341):_0x4f450a,_0x2c545d;if(typeof Reflect===_0x1718cc(0xb4)&&typeof Reflect[_0x1718cc(0xc2)]===_0x1718cc(0xb6))_0x141192=Reflect[_0x1718cc(0xc2)](_0x1790e9,_0x23e027,_0x397341,_0x4f450a);else{for(var _0x327310=_0x1790e9[_0x1718cc(0x83)]-0x1;_0x327310>=0x0;_0x327310--)if(_0x2c545d=_0x1790e9[_0x327310])_0x141192=(_0x121de8<0x3?_0x2c545d(_0x141192):_0x121de8>0x3?_0x2c545d(_0x23e027,_0x397341,_0x141192):_0x2c545d(_0x23e027,_0x397341))||_0x141192;}return _0x121de8>0x3&&_0x141192&&Object[_0x1718cc(0x9b)](_0x23e027,_0x397341,_0x141192),_0x141192;},__metadata=this&&this[_0x35a9d3(0x8c)]||function(_0x5b383e,_0x22e0b6){const _0x30f8b1=_0x35a9d3;if(typeof Reflect===_0x30f8b1(0xb4)&&typeof Reflect[_0x30f8b1(0x8e)]===_0x30f8b1(0xb6))return Reflect[_0x30f8b1(0x8e)](_0x5b383e,_0x22e0b6);};function _0x372d(){const _0x1b8e55=['8700471hZoulu','Search\x20API\x20error:\x20','application/octet-stream;\x20charset=utf-8','object','ChatService','function','json','1748178ZSIrYj','/search','fetchHotSearches','Logger','model','setHeader','12xhNFuq','message','6zFzmdk','append','decorate','../globalConfig/globalConfig.service','Search\x20error:\x20','ModelsService','Model\x20key\x20not\x20found.\x20Please\x20check\x20your\x20model\x20configuration.','HTTP\x20error!\x20status:\x20','User\x20not\x20authenticated','10LNZXxh','SearchService','length','__esModule','chatService','hotSearchAccessKey','2266060xBvXFH','searchParams','research','3466221SUPDYI','getOwnPropertyDescriptor','__metadata','hotSearchSecretKey','metadata','user','toString','8fZvKJx','1234192ZOxuNB','GET','Content-type','getConfigs','globalConfigService','status','results','format','109913EUpIrI','defineProperty','26vCenFo','hotSearchCache','write','Injectable','slice','\x20images','searchWithExternalAPI','../models/models.service','data','stringify','2213412wQywVm','CACHE_DURATION','modelsService','error','deep','search','chatProcess','28ZaUCRk','../chat/chat.service','https://www.coderutil.com/api/resou/v1/toutiao','design:paramtypes'];_0x372d=function(){return _0x1b8e55;};return _0x372d();}Object[_0x35a9d3(0x9b)](exports,_0x35a9d3(0x84),{'value':!![]}),exports[_0x35a9d3(0x82)]=void 0x0;const common_1=require('@nestjs/common'),globalConfig_service_1=require(_0x35a9d3(0xc3)),chat_service_1=require(_0x35a9d3(0xae)),models_service_1=require(_0x35a9d3(0xa3));let SearchService=class SearchService{constructor(_0x27d38f,_0x5d3e78,_0x53f02c){const _0x154f0f=_0x35a9d3;this[_0x154f0f(0x96)]=_0x27d38f,this[_0x154f0f(0x85)]=_0x5d3e78,this[_0x154f0f(0xa8)]=_0x53f02c,this[_0x154f0f(0x9d)]=null,this[_0x154f0f(0xa7)]=0xa*0x3c*0x3e8;}async['searchWithExternalAPI'](_0x539c5f){const _0x2b74d3=_0x35a9d3;try{const {searchPlatformUrl:_0x4a24f6}=await this[_0x2b74d3(0x96)]['getConfigs'](['searchPlatformUrl']),_0x3f5bb1=new URL(_0x4a24f6+_0x2b74d3(0xb9));_0x3f5bb1[_0x2b74d3(0x88)]['append']('q',_0x539c5f),_0x3f5bb1[_0x2b74d3(0x88)][_0x2b74d3(0xc1)](_0x2b74d3(0x99),_0x2b74d3(0xb7));const _0x38abbf=await fetch(_0x3f5bb1[_0x2b74d3(0x90)](),{'method':_0x2b74d3(0x93)});if(!_0x38abbf['ok'])throw new Error(_0x2b74d3(0x7f)+_0x38abbf[_0x2b74d3(0x97)]);const _0x481e3e=await _0x38abbf[_0x2b74d3(0xb7)]();return _0x481e3e[_0x2b74d3(0x98)]||[];}catch(_0x2f96bc){common_1[_0x2b74d3(0xbb)][_0x2b74d3(0xa9)](_0x2b74d3(0xb2)+_0x2f96bc[_0x2b74d3(0xbf)],_0x2b74d3(0x82));throw _0x2f96bc;}}async['fetchHotSearches'](){const _0x3bcec0=_0x35a9d3,_0x19668e=await this['globalConfigService'][_0x3bcec0(0x95)]([_0x3bcec0(0x86),_0x3bcec0(0x8d)]),_0x3c6d94=_0x19668e===null||_0x19668e===void 0x0?void 0x0:_0x19668e[_0x3bcec0(0x86)],_0x51678e=_0x19668e===null||_0x19668e===void 0x0?void 0x0:_0x19668e[_0x3bcec0(0x8d)];if(!_0x3c6d94||!_0x51678e)throw new Error('Hot\x20search\x20API\x20keys\x20not\x20configured');const _0x5a81bf=await fetch(_0x3bcec0(0xaf),{'method':_0x3bcec0(0x93),'headers':{'access-key':_0x3c6d94,'secret-key':_0x51678e}});if(!_0x5a81bf['ok'])throw new Error('HTTP\x20error!\x20status:\x20'+_0x5a81bf[_0x3bcec0(0x97)]);return await _0x5a81bf[_0x3bcec0(0xb7)]();}async['getHotSearches'](){const _0x2f2276=_0x35a9d3;try{const _0x332fea=Date['now']();if(this[_0x2f2276(0x9d)]&&_0x332fea-this[_0x2f2276(0x9d)]['timestamp']<this[_0x2f2276(0xa7)])return this[_0x2f2276(0x9d)][_0x2f2276(0xa4)];const _0x55d578=await this[_0x2f2276(0xba)]();return this[_0x2f2276(0x9d)]={'data':_0x55d578,'timestamp':_0x332fea},_0x55d578;}catch(_0x3aa155){if(this[_0x2f2276(0x9d)])return this[_0x2f2276(0x9d)][_0x2f2276(0xa4)];throw _0x3aa155;}}async[_0x35a9d3(0xab)](_0x573a9c,_0x19f2d5,_0x28cab7){const _0x4e87e5=_0x35a9d3,{prompt:_0x2fb640,model:_0x2acd81,mode:_0x2f49d0,parentMessageId:_0x44a43f}=_0x573a9c;try{if(!_0x19f2d5[_0x4e87e5(0x8f)])throw new Error(_0x4e87e5(0x80));_0x28cab7[_0x4e87e5(0xbd)](_0x4e87e5(0x94),_0x4e87e5(0xb3));if(_0x44a43f){const _0x478d11=await this['modelsService']['getCurrentModelKeyInfo'](_0x2acd81);if(!_0x478d11)throw new Error(_0x4e87e5(0x7e));const _0x54e8a1=await this[_0x4e87e5(0x85)][_0x4e87e5(0xac)]({'prompt':_0x2fb640,'model':_0x478d11[_0x4e87e5(0xbc)],'options':{'parentMessageId':_0x44a43f,'usingNetwork':!![]}},_0x19f2d5,_0x28cab7);_0x54e8a1&&_0x54e8a1['id']&&_0x28cab7['write']('\x0a'+JSON[_0x4e87e5(0xa5)]({'parentMessageId':_0x54e8a1['id']}));}else{const _0x5afadf=await this[_0x4e87e5(0xa2)](_0x2fb640);_0x28cab7[_0x4e87e5(0x9e)](JSON[_0x4e87e5(0xa5)]({'context':_0x5afadf['slice'](0x0,0x14)}));if(_0x2f49d0===_0x4e87e5(0xaa)||_0x2f49d0===_0x4e87e5(0x89)){const _0x53a182=await this[_0x4e87e5(0xa2)](_0x2fb640+_0x4e87e5(0xa1));_0x28cab7['write']('\x0a'+JSON[_0x4e87e5(0xa5)]({'images':_0x53a182[_0x4e87e5(0xa0)](0x0,0x5)}));}}_0x28cab7['end']();}catch(_0x464d6b){common_1[_0x4e87e5(0xbb)][_0x4e87e5(0xa9)](_0x4e87e5(0xc4)+_0x464d6b[_0x4e87e5(0xbf)],'SearchService');throw _0x464d6b;}}};SearchService=__decorate([(0x0,common_1[_0x35a9d3(0x9f)])(),__metadata(_0x35a9d3(0xb0),[globalConfig_service_1['GlobalConfigService'],chat_service_1[_0x35a9d3(0xb5)],models_service_1[_0x35a9d3(0xc5)]])],SearchService),exports['SearchService']=SearchService;