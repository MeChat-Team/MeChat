'use strict';const _0xa21c96=_0x1260;(function(_0xbe4042,_0x113794){const _0x13b374=_0x1260,_0x3ced34=_0xbe4042();while(!![]){try{const _0x51ad4a=-parseInt(_0x13b374(0x1f0))/0x1*(parseInt(_0x13b374(0x1df))/0x2)+parseInt(_0x13b374(0x1b5))/0x3+parseInt(_0x13b374(0x1d0))/0x4*(parseInt(_0x13b374(0x1e7))/0x5)+parseInt(_0x13b374(0x1e0))/0x6+parseInt(_0x13b374(0x1de))/0x7*(parseInt(_0x13b374(0x1c4))/0x8)+-parseInt(_0x13b374(0x1f6))/0x9*(parseInt(_0x13b374(0x1d5))/0xa)+-parseInt(_0x13b374(0x1c3))/0xb;if(_0x51ad4a===_0x113794)break;else _0x3ced34['push'](_0x3ced34['shift']());}catch(_0x9d100e){_0x3ced34['push'](_0x3ced34['shift']());}}}(_0x4a70,0x87398));function _0x4a70(){const _0x401c08=['user','User\x20not\x20authenticated','error','461280HisNGx','fetchHotSearches','Injectable','ModelsService','format','setHeader','Content-type','metadata','length','133OPmSoK','10FZDZfm','6167718zPYoVA','chatService','decorate','chatProcess','Logger','research','getConfigs','3780435sEhbqD','message','ChatService','Hot\x20search\x20API\x20keys\x20not\x20configured','../globalConfig/globalConfig.service','__esModule','hotSearchSecretKey','@nestjs/common','timestamp','183588mbDPIv','deep','json','object','write','SearchService','36yMWeYA','hotSearchCache','searchPlatformUrl','GlobalConfigService','searchParams','end','../chat/chat.service','2305191aiDSYq','defineProperty','../models/models.service','function','status','results','now','toString','Search\x20API\x20error:\x20','CACHE_DURATION','stringify','/search','HTTP\x20error!\x20status:\x20','globalConfigService','21225919ONZwPq','435168vOOskX','Model\x20key\x20not\x20found.\x20Please\x20check\x20your\x20model\x20configuration.','data','append','hotSearchAccessKey','getOwnPropertyDescriptor','\x20images','modelsService','searchWithExternalAPI','slice','getCurrentModelKeyInfo','Search\x20error:\x20','4sGIdKR','model'];_0x4a70=function(){return _0x401c08;};return _0x4a70();}var __decorate=this&&this['__decorate']||function(_0x275e13,_0x1ff943,_0x10dd32,_0x3120f1){const _0x38f583=_0x1260;var _0x569261=arguments[_0x38f583(0x1dd)],_0x3be694=_0x569261<0x3?_0x1ff943:_0x3120f1===null?_0x3120f1=Object[_0x38f583(0x1c9)](_0x1ff943,_0x10dd32):_0x3120f1,_0x2ff016;if(typeof Reflect==='object'&&typeof Reflect[_0x38f583(0x1e2)]==='function')_0x3be694=Reflect['decorate'](_0x275e13,_0x1ff943,_0x10dd32,_0x3120f1);else{for(var _0x5cc347=_0x275e13[_0x38f583(0x1dd)]-0x1;_0x5cc347>=0x0;_0x5cc347--)if(_0x2ff016=_0x275e13[_0x5cc347])_0x3be694=(_0x569261<0x3?_0x2ff016(_0x3be694):_0x569261>0x3?_0x2ff016(_0x1ff943,_0x10dd32,_0x3be694):_0x2ff016(_0x1ff943,_0x10dd32))||_0x3be694;}return _0x569261>0x3&&_0x3be694&&Object[_0x38f583(0x1b6)](_0x1ff943,_0x10dd32,_0x3be694),_0x3be694;},__metadata=this&&this['__metadata']||function(_0x14fc5d,_0x3e23a5){const _0x5add80=_0x1260;if(typeof Reflect===_0x5add80(0x1f3)&&typeof Reflect[_0x5add80(0x1dc)]===_0x5add80(0x1b8))return Reflect['metadata'](_0x14fc5d,_0x3e23a5);};Object[_0xa21c96(0x1b6)](exports,_0xa21c96(0x1ec),{'value':!![]}),exports[_0xa21c96(0x1f5)]=void 0x0;function _0x1260(_0x5582f6,_0x440cc5){const _0x4a7059=_0x4a70();return _0x1260=function(_0x1260b1,_0x53dd7e){_0x1260b1=_0x1260b1-0x1b3;let _0x33bcf3=_0x4a7059[_0x1260b1];return _0x33bcf3;},_0x1260(_0x5582f6,_0x440cc5);}const common_1=require(_0xa21c96(0x1ee)),globalConfig_service_1=require(_0xa21c96(0x1eb)),chat_service_1=require(_0xa21c96(0x1b4)),models_service_1=require(_0xa21c96(0x1b7));let SearchService=class SearchService{constructor(_0x210ea7,_0x130e96,_0xdba093){const _0x4d0920=_0xa21c96;this[_0x4d0920(0x1c2)]=_0x210ea7,this[_0x4d0920(0x1e1)]=_0x130e96,this[_0x4d0920(0x1cb)]=_0xdba093,this[_0x4d0920(0x1f7)]=null,this[_0x4d0920(0x1be)]=0xa*0x3c*0x3e8;}async[_0xa21c96(0x1cc)](_0x5effb2){const _0x1b85ad=_0xa21c96;try{const {searchPlatformUrl:_0x5c399d}=await this[_0x1b85ad(0x1c2)][_0x1b85ad(0x1e6)]([_0x1b85ad(0x1f8)]),_0x1b5fbf=new URL(_0x5c399d+_0x1b85ad(0x1c0));_0x1b5fbf[_0x1b85ad(0x1fa)][_0x1b85ad(0x1c7)]('q',_0x5effb2),_0x1b5fbf[_0x1b85ad(0x1fa)][_0x1b85ad(0x1c7)](_0x1b85ad(0x1d9),_0x1b85ad(0x1f2));const _0x59e4c0=await fetch(_0x1b5fbf[_0x1b85ad(0x1bc)](),{'method':'GET'});if(!_0x59e4c0['ok'])throw new Error(_0x1b85ad(0x1c1)+_0x59e4c0[_0x1b85ad(0x1b9)]);const _0x40e48f=await _0x59e4c0['json']();return _0x40e48f[_0x1b85ad(0x1ba)]||[];}catch(_0x47ec32){common_1['Logger']['error'](_0x1b85ad(0x1bd)+_0x47ec32[_0x1b85ad(0x1e8)],_0x1b85ad(0x1f5));throw _0x47ec32;}}async[_0xa21c96(0x1d6)](){const _0x49a634=_0xa21c96,_0x29417f=await this['globalConfigService'][_0x49a634(0x1e6)]([_0x49a634(0x1c8),_0x49a634(0x1ed)]),_0x212f5f=_0x29417f===null||_0x29417f===void 0x0?void 0x0:_0x29417f[_0x49a634(0x1c8)],_0x6cc34a=_0x29417f===null||_0x29417f===void 0x0?void 0x0:_0x29417f[_0x49a634(0x1ed)];if(!_0x212f5f||!_0x6cc34a)throw new Error(_0x49a634(0x1ea));const _0x3e3217=await fetch('https://www.coderutil.com/api/resou/v1/toutiao',{'method':'GET','headers':{'access-key':_0x212f5f,'secret-key':_0x6cc34a}});if(!_0x3e3217['ok'])throw new Error(_0x49a634(0x1c1)+_0x3e3217[_0x49a634(0x1b9)]);return await _0x3e3217[_0x49a634(0x1f2)]();}async['getHotSearches'](){const _0x2c17d9=_0xa21c96;try{const _0x47b05a=Date[_0x2c17d9(0x1bb)]();if(this['hotSearchCache']&&_0x47b05a-this[_0x2c17d9(0x1f7)][_0x2c17d9(0x1ef)]<this['CACHE_DURATION'])return this[_0x2c17d9(0x1f7)]['data'];const _0x264828=await this['fetchHotSearches']();return this[_0x2c17d9(0x1f7)]={'data':_0x264828,'timestamp':_0x47b05a},_0x264828;}catch(_0x292ef2){if(this['hotSearchCache'])return this['hotSearchCache'][_0x2c17d9(0x1c6)];throw _0x292ef2;}}async['search'](_0xc203ee,_0x1ad024,_0x40ab07){const _0x438667=_0xa21c96,{prompt:_0x33cff4,model:_0x2b5248,mode:_0x530ce1,parentMessageId:_0x500fa1}=_0xc203ee;try{if(!_0x1ad024[_0x438667(0x1d2)])throw new Error(_0x438667(0x1d3));_0x40ab07[_0x438667(0x1da)](_0x438667(0x1db),'application/octet-stream;\x20charset=utf-8');if(_0x500fa1){const _0x37a553=await this[_0x438667(0x1cb)][_0x438667(0x1ce)](_0x2b5248);if(!_0x37a553)throw new Error(_0x438667(0x1c5));const _0x4c78bf=await this[_0x438667(0x1e1)][_0x438667(0x1e3)]({'prompt':_0x33cff4,'model':_0x37a553[_0x438667(0x1d1)],'options':{'parentMessageId':_0x500fa1,'usingNetwork':!![]}},_0x1ad024,_0x40ab07);_0x4c78bf&&_0x4c78bf['id']&&_0x40ab07[_0x438667(0x1f4)]('\x0a'+JSON[_0x438667(0x1bf)]({'parentMessageId':_0x4c78bf['id']}));}else{const _0x4d22e2=await this[_0x438667(0x1cc)](_0x33cff4);_0x40ab07['write'](JSON[_0x438667(0x1bf)]({'context':_0x4d22e2[_0x438667(0x1cd)](0x0,0x14)}));if(_0x530ce1===_0x438667(0x1f1)||_0x530ce1===_0x438667(0x1e5)){const _0x3e8286=await this[_0x438667(0x1cc)](_0x33cff4+_0x438667(0x1ca));_0x40ab07['write']('\x0a'+JSON[_0x438667(0x1bf)]({'images':_0x3e8286[_0x438667(0x1cd)](0x0,0x5)}));}}_0x40ab07[_0x438667(0x1b3)]();}catch(_0x55daf9){common_1[_0x438667(0x1e4)][_0x438667(0x1d4)](_0x438667(0x1cf)+_0x55daf9[_0x438667(0x1e8)],'SearchService');throw _0x55daf9;}}};SearchService=__decorate([(0x0,common_1[_0xa21c96(0x1d7)])(),__metadata('design:paramtypes',[globalConfig_service_1[_0xa21c96(0x1f9)],chat_service_1[_0xa21c96(0x1e9)],models_service_1[_0xa21c96(0x1d8)]])],SearchService),exports[_0xa21c96(0x1f5)]=SearchService;