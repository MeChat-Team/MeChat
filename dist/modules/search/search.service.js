'use strict';const _0x39793e=_0x510d;(function(_0x1c9011,_0x5d4316){const _0x101779=_0x510d,_0x33e290=_0x1c9011();while(!![]){try{const _0x431911=parseInt(_0x101779(0x18d))/0x1*(parseInt(_0x101779(0x1a6))/0x2)+parseInt(_0x101779(0x1a4))/0x3+-parseInt(_0x101779(0x19c))/0x4*(-parseInt(_0x101779(0x1ad))/0x5)+parseInt(_0x101779(0x180))/0x6+-parseInt(_0x101779(0x18e))/0x7*(-parseInt(_0x101779(0x1b1))/0x8)+-parseInt(_0x101779(0x1bc))/0x9+-parseInt(_0x101779(0x1a5))/0xa;if(_0x431911===_0x5d4316)break;else _0x33e290['push'](_0x33e290['shift']());}catch(_0x1b7574){_0x33e290['push'](_0x33e290['shift']());}}}(_0x5c89,0x85a63));function _0x510d(_0x4a3293,_0x4ee969){const _0x5c8947=_0x5c89();return _0x510d=function(_0x510d33,_0x2b16bd){_0x510d33=_0x510d33-0x178;let _0x1aa0d1=_0x5c8947[_0x510d33];return _0x1aa0d1;},_0x510d(_0x4a3293,_0x4ee969);}var __decorate=this&&this[_0x39793e(0x1bb)]||function(_0x53a618,_0x448b9a,_0x35ba28,_0x1b2266){const _0x1579ce=_0x39793e;var _0x5be613=arguments[_0x1579ce(0x1b2)],_0x2a81f8=_0x5be613<0x3?_0x448b9a:_0x1b2266===null?_0x1b2266=Object[_0x1579ce(0x19e)](_0x448b9a,_0x35ba28):_0x1b2266,_0x12e305;if(typeof Reflect===_0x1579ce(0x193)&&typeof Reflect[_0x1579ce(0x184)]===_0x1579ce(0x186))_0x2a81f8=Reflect[_0x1579ce(0x184)](_0x53a618,_0x448b9a,_0x35ba28,_0x1b2266);else{for(var _0x527a9b=_0x53a618[_0x1579ce(0x1b2)]-0x1;_0x527a9b>=0x0;_0x527a9b--)if(_0x12e305=_0x53a618[_0x527a9b])_0x2a81f8=(_0x5be613<0x3?_0x12e305(_0x2a81f8):_0x5be613>0x3?_0x12e305(_0x448b9a,_0x35ba28,_0x2a81f8):_0x12e305(_0x448b9a,_0x35ba28))||_0x2a81f8;}return _0x5be613>0x3&&_0x2a81f8&&Object[_0x1579ce(0x179)](_0x448b9a,_0x35ba28,_0x2a81f8),_0x2a81f8;},__metadata=this&&this['__metadata']||function(_0xe0fa87,_0x3affa5){const _0x508fa4=_0x39793e;if(typeof Reflect===_0x508fa4(0x193)&&typeof Reflect[_0x508fa4(0x199)]===_0x508fa4(0x186))return Reflect[_0x508fa4(0x199)](_0xe0fa87,_0x3affa5);};Object[_0x39793e(0x179)](exports,_0x39793e(0x183),{'value':!![]}),exports[_0x39793e(0x189)]=void 0x0;function _0x5c89(){const _0x1d8820=['1856EhFYEW','stringify','getOwnPropertyDescriptor','model','User\x20not\x20authenticated','searchWithExternalAPI','write','json','1390560gPmDDn','10851680fwOmCm','12CNOUOH','modelsService','Logger','setHeader','getCurrentModelKeyInfo','message','error','2195mBucCR','timestamp','Hot\x20search\x20API\x20keys\x20not\x20configured','chatProcess','8cgitpN','length','searchParams','GET','fetchHotSearches','https://www.coderutil.com/api/resou/v1/toutiao','ModelsService','Injectable','append','globalConfigService','__decorate','5947146kgiFgo','HTTP\x20error!\x20status:\x20','defineProperty','GlobalConfigService','end','application/octet-stream;\x20charset=utf-8','searchPlatformUrl','Model\x20key\x20not\x20found.\x20Please\x20check\x20your\x20model\x20configuration.','../globalConfig/globalConfig.service','3249528VNBIuA','research','ChatService','__esModule','decorate','deep','function','../models/models.service','Content-type','SearchService','status','hotSearchSecretKey','Search\x20API\x20error:\x20','6143IndaNJ','7334089OXSITb','hotSearchCache','chatService','getConfigs','data','object','CACHE_DURATION','design:paramtypes','results','\x20images','toString','metadata','search','hotSearchAccessKey'];_0x5c89=function(){return _0x1d8820;};return _0x5c89();}const common_1=require('@nestjs/common'),globalConfig_service_1=require(_0x39793e(0x17f)),chat_service_1=require('../chat/chat.service'),models_service_1=require(_0x39793e(0x187));let SearchService=class SearchService{constructor(_0x1fc3f2,_0x470972,_0x29b456){const _0xc51c01=_0x39793e;this[_0xc51c01(0x1ba)]=_0x1fc3f2,this['chatService']=_0x470972,this[_0xc51c01(0x1a7)]=_0x29b456,this['hotSearchCache']=null,this[_0xc51c01(0x194)]=0xa*0x3c*0x3e8;}async[_0x39793e(0x1a1)](_0x47883c){const _0x32bb87=_0x39793e;try{const {searchPlatformUrl:_0x6b052}=await this[_0x32bb87(0x1ba)][_0x32bb87(0x191)]([_0x32bb87(0x17d)]),_0x302696=new URL(_0x6b052+'/search');_0x302696[_0x32bb87(0x1b3)][_0x32bb87(0x1b9)]('q',_0x47883c),_0x302696[_0x32bb87(0x1b3)][_0x32bb87(0x1b9)]('format',_0x32bb87(0x1a3));const _0x412100=await fetch(_0x302696[_0x32bb87(0x198)](),{'method':'GET'});if(!_0x412100['ok'])throw new Error(_0x32bb87(0x178)+_0x412100['status']);const _0x409eff=await _0x412100[_0x32bb87(0x1a3)]();return _0x409eff[_0x32bb87(0x196)]||[];}catch(_0xb915a6){common_1[_0x32bb87(0x1a8)][_0x32bb87(0x1ac)](_0x32bb87(0x18c)+_0xb915a6['message'],'SearchService');throw _0xb915a6;}}async['fetchHotSearches'](){const _0x1df0ec=_0x39793e,_0x135295=await this[_0x1df0ec(0x1ba)]['getConfigs']([_0x1df0ec(0x19b),_0x1df0ec(0x18b)]),_0x443004=_0x135295===null||_0x135295===void 0x0?void 0x0:_0x135295[_0x1df0ec(0x19b)],_0x468ce9=_0x135295===null||_0x135295===void 0x0?void 0x0:_0x135295['hotSearchSecretKey'];if(!_0x443004||!_0x468ce9)throw new Error(_0x1df0ec(0x1af));const _0x23c18a=await fetch(_0x1df0ec(0x1b6),{'method':_0x1df0ec(0x1b4),'headers':{'access-key':_0x443004,'secret-key':_0x468ce9}});if(!_0x23c18a['ok'])throw new Error('HTTP\x20error!\x20status:\x20'+_0x23c18a[_0x1df0ec(0x18a)]);return await _0x23c18a[_0x1df0ec(0x1a3)]();}async['getHotSearches'](){const _0x5d1885=_0x39793e;try{const _0x5050c0=Date['now']();if(this[_0x5d1885(0x18f)]&&_0x5050c0-this[_0x5d1885(0x18f)][_0x5d1885(0x1ae)]<this[_0x5d1885(0x194)])return this[_0x5d1885(0x18f)][_0x5d1885(0x192)];const _0x4b499e=await this[_0x5d1885(0x1b5)]();return this[_0x5d1885(0x18f)]={'data':_0x4b499e,'timestamp':_0x5050c0},_0x4b499e;}catch(_0x1c9e90){if(this[_0x5d1885(0x18f)])return this[_0x5d1885(0x18f)]['data'];throw _0x1c9e90;}}async[_0x39793e(0x19a)](_0x492106,_0x3418d6,_0x5b12b8){const _0x51d318=_0x39793e,{prompt:_0x5109fb,model:_0x3d8680,mode:_0x232f5e,parentMessageId:_0x6b752}=_0x492106;try{if(!_0x3418d6['user'])throw new Error(_0x51d318(0x1a0));_0x5b12b8[_0x51d318(0x1a9)](_0x51d318(0x188),_0x51d318(0x17c));if(_0x6b752){const _0x40d900=await this[_0x51d318(0x1a7)][_0x51d318(0x1aa)](_0x3d8680);if(!_0x40d900)throw new Error(_0x51d318(0x17e));const _0x2a9353=await this[_0x51d318(0x190)][_0x51d318(0x1b0)]({'prompt':_0x5109fb,'model':_0x40d900[_0x51d318(0x19f)],'options':{'parentMessageId':_0x6b752,'usingNetwork':!![]}},_0x3418d6,_0x5b12b8);_0x2a9353&&_0x2a9353['id']&&_0x5b12b8[_0x51d318(0x1a2)]('\x0a'+JSON[_0x51d318(0x19d)]({'parentMessageId':_0x2a9353['id']}));}else{const _0x55eb73=await this[_0x51d318(0x1a1)](_0x5109fb);_0x5b12b8[_0x51d318(0x1a2)](JSON[_0x51d318(0x19d)]({'context':_0x55eb73['slice'](0x0,0x14)}));if(_0x232f5e===_0x51d318(0x185)||_0x232f5e===_0x51d318(0x181)){const _0x4601e1=await this[_0x51d318(0x1a1)](_0x5109fb+_0x51d318(0x197));_0x5b12b8[_0x51d318(0x1a2)]('\x0a'+JSON['stringify']({'images':_0x4601e1['slice'](0x0,0x5)}));}}_0x5b12b8[_0x51d318(0x17b)]();}catch(_0x220f4f){common_1[_0x51d318(0x1a8)][_0x51d318(0x1ac)]('Search\x20error:\x20'+_0x220f4f[_0x51d318(0x1ab)],_0x51d318(0x189));throw _0x220f4f;}}};SearchService=__decorate([(0x0,common_1[_0x39793e(0x1b8)])(),__metadata(_0x39793e(0x195),[globalConfig_service_1[_0x39793e(0x17a)],chat_service_1[_0x39793e(0x182)],models_service_1[_0x39793e(0x1b7)]])],SearchService),exports[_0x39793e(0x189)]=SearchService;