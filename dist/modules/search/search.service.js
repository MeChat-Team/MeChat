'use strict';const _0x22e747=_0x2c81;(function(_0x5e5732,_0x4e2532){const _0x43a57b=_0x2c81,_0xfc999b=_0x5e5732();while(!![]){try{const _0x4360b6=parseInt(_0x43a57b(0x100))/0x1*(parseInt(_0x43a57b(0xeb))/0x2)+parseInt(_0x43a57b(0x120))/0x3+-parseInt(_0x43a57b(0x121))/0x4+parseInt(_0x43a57b(0xf4))/0x5*(-parseInt(_0x43a57b(0xf3))/0x6)+-parseInt(_0x43a57b(0x10e))/0x7+-parseInt(_0x43a57b(0xf6))/0x8*(parseInt(_0x43a57b(0xff))/0x9)+parseInt(_0x43a57b(0xf8))/0xa*(parseInt(_0x43a57b(0x10c))/0xb);if(_0x4360b6===_0x4e2532)break;else _0xfc999b['push'](_0xfc999b['shift']());}catch(_0xc589fd){_0xfc999b['push'](_0xfc999b['shift']());}}}(_0x4d89,0x1e586));function _0x2c81(_0x366801,_0x482337){const _0x4d8918=_0x4d89();return _0x2c81=function(_0x2c8192,_0x28bc20){_0x2c8192=_0x2c8192-0xe9;let _0x4290fe=_0x4d8918[_0x2c8192];return _0x4290fe;},_0x2c81(_0x366801,_0x482337);}var __decorate=this&&this['__decorate']||function(_0x3db5c9,_0x590af8,_0x41ca57,_0x74cea4){const _0x5b5f4c=_0x2c81;var _0x397673=arguments[_0x5b5f4c(0x105)],_0x39ad3d=_0x397673<0x3?_0x590af8:_0x74cea4===null?_0x74cea4=Object[_0x5b5f4c(0x118)](_0x590af8,_0x41ca57):_0x74cea4,_0x12ef28;if(typeof Reflect==='object'&&typeof Reflect[_0x5b5f4c(0x124)]==='function')_0x39ad3d=Reflect[_0x5b5f4c(0x124)](_0x3db5c9,_0x590af8,_0x41ca57,_0x74cea4);else{for(var _0x40e7f4=_0x3db5c9[_0x5b5f4c(0x105)]-0x1;_0x40e7f4>=0x0;_0x40e7f4--)if(_0x12ef28=_0x3db5c9[_0x40e7f4])_0x39ad3d=(_0x397673<0x3?_0x12ef28(_0x39ad3d):_0x397673>0x3?_0x12ef28(_0x590af8,_0x41ca57,_0x39ad3d):_0x12ef28(_0x590af8,_0x41ca57))||_0x39ad3d;}return _0x397673>0x3&&_0x39ad3d&&Object[_0x5b5f4c(0xf0)](_0x590af8,_0x41ca57,_0x39ad3d),_0x39ad3d;},__metadata=this&&this['__metadata']||function(_0x119a11,_0x26924d){const _0x101d72=_0x2c81;if(typeof Reflect==='object'&&typeof Reflect[_0x101d72(0x114)]==='function')return Reflect[_0x101d72(0x114)](_0x119a11,_0x26924d);};Object[_0x22e747(0xf0)](exports,_0x22e747(0x113),{'value':!![]}),exports['SearchService']=void 0x0;const common_1=require('@nestjs/common'),globalConfig_service_1=require(_0x22e747(0x106)),chat_service_1=require(_0x22e747(0x10b)),models_service_1=require(_0x22e747(0xfa));let SearchService=class SearchService{constructor(_0x2d6703,_0x2eade4,_0x52a1c5){const _0x5786a9=_0x22e747;this['globalConfigService']=_0x2d6703,this[_0x5786a9(0x104)]=_0x2eade4,this['modelsService']=_0x52a1c5,this[_0x5786a9(0x109)]=null,this['CACHE_DURATION']=0xa*0x3c*0x3e8;}async[_0x22e747(0x122)](_0x3008d8){const _0x149787=_0x22e747;try{const {searchPlatformUrl:_0x26f695}=await this[_0x149787(0xfd)][_0x149787(0x10a)]([_0x149787(0xfc)]),_0x3cddd9=new URL(_0x26f695+_0x149787(0x110));_0x3cddd9[_0x149787(0xfe)][_0x149787(0x11f)]('q',_0x3008d8),_0x3cddd9[_0x149787(0xfe)][_0x149787(0x11f)](_0x149787(0x107),'json');const _0x3ed848=await fetch(_0x3cddd9[_0x149787(0x11b)](),{'method':_0x149787(0x119)});if(!_0x3ed848['ok'])throw new Error('HTTP\x20error!\x20status:\x20'+_0x3ed848['status']);const _0x436dbe=await _0x3ed848[_0x149787(0x12a)]();return _0x436dbe[_0x149787(0xf2)]||[];}catch(_0x562be0){common_1['Logger'][_0x149787(0xec)]('Search\x20API\x20error:\x20'+_0x562be0['message'],'SearchService');throw _0x562be0;}}async[_0x22e747(0xfb)](){const _0x567e7b=_0x22e747,_0x237e4a=await this[_0x567e7b(0xfd)][_0x567e7b(0x10a)]([_0x567e7b(0x127),_0x567e7b(0x128)]),_0x227e32=_0x237e4a===null||_0x237e4a===void 0x0?void 0x0:_0x237e4a[_0x567e7b(0x127)],_0x12a821=_0x237e4a===null||_0x237e4a===void 0x0?void 0x0:_0x237e4a[_0x567e7b(0x128)];if(!_0x227e32||!_0x12a821)throw new Error(_0x567e7b(0x125));const _0x5439ac=await fetch(_0x567e7b(0xf7),{'method':_0x567e7b(0x119),'headers':{'access-key':_0x227e32,'secret-key':_0x12a821}});if(!_0x5439ac['ok'])throw new Error(_0x567e7b(0x116)+_0x5439ac['status']);return await _0x5439ac[_0x567e7b(0x12a)]();}async[_0x22e747(0x129)](){const _0x3c3cab=_0x22e747;try{const _0x492fe7=Date[_0x3c3cab(0x11d)]();if(this[_0x3c3cab(0x109)]&&_0x492fe7-this[_0x3c3cab(0x109)][_0x3c3cab(0xf9)]<this[_0x3c3cab(0x11a)])return this[_0x3c3cab(0x109)][_0x3c3cab(0xe9)];const _0x21da1b=await this['fetchHotSearches']();return this[_0x3c3cab(0x109)]={'data':_0x21da1b,'timestamp':_0x492fe7},_0x21da1b;}catch(_0x3c926e){if(this[_0x3c3cab(0x109)])return this[_0x3c3cab(0x109)]['data'];throw _0x3c926e;}}async[_0x22e747(0x10d)](_0x38c955,_0x4b7f77,_0xb13cce){const _0xd104d1=_0x22e747,{prompt:_0x2aae9b,model:_0x4089aa,mode:_0x5204f9,parentMessageId:_0x23eb37}=_0x38c955;try{if(!_0x4b7f77['user'])throw new Error(_0xd104d1(0x102));_0xb13cce[_0xd104d1(0x101)]('Content-type',_0xd104d1(0x126));if(_0x23eb37){const _0x5a7fb2=await this[_0xd104d1(0x10f)][_0xd104d1(0x111)](_0x4089aa);if(!_0x5a7fb2)throw new Error(_0xd104d1(0xee));const _0x3984c9=await this[_0xd104d1(0x104)]['chatProcess']({'prompt':_0x2aae9b,'model':_0x5a7fb2[_0xd104d1(0xef)],'options':{'parentMessageId':_0x23eb37,'usingNetwork':!![]}},_0x4b7f77,_0xb13cce);_0x3984c9&&_0x3984c9['id']&&_0xb13cce[_0xd104d1(0x103)]('\x0a'+JSON[_0xd104d1(0xed)]({'parentMessageId':_0x3984c9['id']}));}else{const _0x209b3b=await this[_0xd104d1(0x122)](_0x2aae9b);_0xb13cce[_0xd104d1(0x103)](JSON['stringify']({'context':_0x209b3b[_0xd104d1(0x115)](0x0,0x14)}));if(_0x5204f9===_0xd104d1(0xf5)||_0x5204f9===_0xd104d1(0x11c)){const _0x3f3a5b=await this[_0xd104d1(0x122)](_0x2aae9b+_0xd104d1(0x112));_0xb13cce[_0xd104d1(0x103)]('\x0a'+JSON[_0xd104d1(0xed)]({'images':_0x3f3a5b[_0xd104d1(0x115)](0x0,0x5)}));}}_0xb13cce[_0xd104d1(0x123)]();}catch(_0x3dc95d){common_1[_0xd104d1(0x11e)][_0xd104d1(0xec)](_0xd104d1(0x117)+_0x3dc95d[_0xd104d1(0x108)],_0xd104d1(0xf1));throw _0x3dc95d;}}};function _0x4d89(){const _0x376852=['7340zyjHRo','timestamp','../models/models.service','fetchHotSearches','searchPlatformUrl','globalConfigService','searchParams','63963WjYvUp','1262Tkfxby','setHeader','User\x20not\x20authenticated','write','chatService','length','../globalConfig/globalConfig.service','format','message','hotSearchCache','getConfigs','../chat/chat.service','6468wOnnRT','search','1192891zSIEwv','modelsService','/search','getCurrentModelKeyInfo','\x20images','__esModule','metadata','slice','HTTP\x20error!\x20status:\x20','Search\x20error:\x20','getOwnPropertyDescriptor','GET','CACHE_DURATION','toString','research','now','Logger','append','315261sNpNqk','126012KYQiEk','searchWithExternalAPI','end','decorate','Hot\x20search\x20API\x20keys\x20not\x20configured','application/octet-stream;\x20charset=utf-8','hotSearchAccessKey','hotSearchSecretKey','getHotSearches','json','GlobalConfigService','data','ChatService','174YsxBvY','error','stringify','Model\x20key\x20not\x20found.\x20Please\x20check\x20your\x20model\x20configuration.','model','defineProperty','SearchService','results','256524sHAFDO','20iyrZEg','deep','168bIOWrO','https://www.coderutil.com/api/resou/v1/toutiao'];_0x4d89=function(){return _0x376852;};return _0x4d89();}SearchService=__decorate([(0x0,common_1['Injectable'])(),__metadata('design:paramtypes',[globalConfig_service_1[_0x22e747(0x12b)],chat_service_1[_0x22e747(0xea)],models_service_1['ModelsService']])],SearchService),exports[_0x22e747(0xf1)]=SearchService;