'use strict';const _0x35f830=_0x4315;(function(_0x1b8e72,_0x5872c0){const _0x9c5105=_0x4315,_0xd7d07=_0x1b8e72();while(!![]){try{const _0x1fcea6=-parseInt(_0x9c5105(0x193))/0x1*(parseInt(_0x9c5105(0x1b4))/0x2)+parseInt(_0x9c5105(0x1c2))/0x3*(-parseInt(_0x9c5105(0x18f))/0x4)+-parseInt(_0x9c5105(0x195))/0x5+-parseInt(_0x9c5105(0x1ac))/0x6+-parseInt(_0x9c5105(0x1c7))/0x7*(-parseInt(_0x9c5105(0x1c3))/0x8)+-parseInt(_0x9c5105(0x1af))/0x9*(parseInt(_0x9c5105(0x1b1))/0xa)+parseInt(_0x9c5105(0x192))/0xb;if(_0x1fcea6===_0x5872c0)break;else _0xd7d07['push'](_0xd7d07['shift']());}catch(_0x38f5e5){_0xd7d07['push'](_0xd7d07['shift']());}}}(_0x3570,0xde8d7));var __decorate=this&&this[_0x35f830(0x1b7)]||function(_0x12557a,_0x2a5840,_0x5ede77,_0x44f42c){const _0x4cee95=_0x35f830;var _0xe49622=arguments[_0x4cee95(0x1b9)],_0x345bdd=_0xe49622<0x3?_0x2a5840:_0x44f42c===null?_0x44f42c=Object[_0x4cee95(0x1b5)](_0x2a5840,_0x5ede77):_0x44f42c,_0x56b3c7;if(typeof Reflect===_0x4cee95(0x1c4)&&typeof Reflect[_0x4cee95(0x1bb)]===_0x4cee95(0x1a1))_0x345bdd=Reflect[_0x4cee95(0x1bb)](_0x12557a,_0x2a5840,_0x5ede77,_0x44f42c);else{for(var _0x21a741=_0x12557a['length']-0x1;_0x21a741>=0x0;_0x21a741--)if(_0x56b3c7=_0x12557a[_0x21a741])_0x345bdd=(_0xe49622<0x3?_0x56b3c7(_0x345bdd):_0xe49622>0x3?_0x56b3c7(_0x2a5840,_0x5ede77,_0x345bdd):_0x56b3c7(_0x2a5840,_0x5ede77))||_0x345bdd;}return _0xe49622>0x3&&_0x345bdd&&Object[_0x4cee95(0x197)](_0x2a5840,_0x5ede77,_0x345bdd),_0x345bdd;},__metadata=this&&this[_0x35f830(0x1aa)]||function(_0x239145,_0x34c586){const _0x45746d=_0x35f830;if(typeof Reflect==='object'&&typeof Reflect[_0x45746d(0x1c8)]==='function')return Reflect['metadata'](_0x239145,_0x34c586);};Object[_0x35f830(0x197)](exports,_0x35f830(0x1a4),{'value':!![]}),exports['SearchService']=void 0x0;const common_1=require('@nestjs/common'),globalConfig_service_1=require('../globalConfig/globalConfig.service'),chat_service_1=require(_0x35f830(0x1bf)),models_service_1=require(_0x35f830(0x19e));let SearchService=class SearchService{constructor(_0x37f3a4,_0x39a4d5,_0x12b31f){const _0x4b4936=_0x35f830;this[_0x4b4936(0x1c5)]=_0x37f3a4,this[_0x4b4936(0x1bc)]=_0x39a4d5,this[_0x4b4936(0x1a9)]=_0x12b31f,this['hotSearchCache']=null,this[_0x4b4936(0x1c9)]=0xa*0x3c*0x3e8;}async['searchWithExternalAPI'](_0x5486b6){const _0x3f5118=_0x35f830;try{const {searchPlatformUrl:_0x3e74ed}=await this[_0x3f5118(0x1c5)]['getConfigs'](['searchPlatformUrl']),_0x22f6d6=new URL(_0x3e74ed+'/search');_0x22f6d6[_0x3f5118(0x1ce)][_0x3f5118(0x1c0)]('q',_0x5486b6),_0x22f6d6[_0x3f5118(0x1ce)][_0x3f5118(0x1c0)](_0x3f5118(0x1cc),_0x3f5118(0x198));const _0x1d12e3=await fetch(_0x22f6d6[_0x3f5118(0x1ae)](),{'method':_0x3f5118(0x1be)});if(!_0x1d12e3['ok'])throw new Error(_0x3f5118(0x1ad)+_0x1d12e3[_0x3f5118(0x1cb)]);const _0x25d4ef=await _0x1d12e3['json']();return _0x25d4ef['results']||[];}catch(_0x29012d){common_1[_0x3f5118(0x19d)]['error']('Search\x20API\x20error:\x20'+_0x29012d[_0x3f5118(0x1a0)],_0x3f5118(0x1b2));throw _0x29012d;}}async[_0x35f830(0x1d0)](){const _0x20e738=_0x35f830,_0x5b3fc5=await this[_0x20e738(0x1c5)][_0x20e738(0x1b6)]([_0x20e738(0x1a5),'hotSearchSecretKey']),_0x239331=_0x5b3fc5===null||_0x5b3fc5===void 0x0?void 0x0:_0x5b3fc5[_0x20e738(0x1a5)],_0x5b460a=_0x5b3fc5===null||_0x5b3fc5===void 0x0?void 0x0:_0x5b3fc5[_0x20e738(0x1ab)];if(!_0x239331||!_0x5b460a)throw new Error('Hot\x20search\x20API\x20keys\x20not\x20configured');const _0x1d21fa=await fetch(_0x20e738(0x190),{'method':_0x20e738(0x1be),'headers':{'access-key':_0x239331,'secret-key':_0x5b460a}});if(!_0x1d21fa['ok'])throw new Error('HTTP\x20error!\x20status:\x20'+_0x1d21fa[_0x20e738(0x1cb)]);return await _0x1d21fa[_0x20e738(0x198)]();}async[_0x35f830(0x1cf)](){const _0x59a447=_0x35f830;try{const _0x25857a=Date[_0x59a447(0x18d)]();if(this['hotSearchCache']&&_0x25857a-this[_0x59a447(0x1a3)][_0x59a447(0x1ba)]<this[_0x59a447(0x1c9)])return this[_0x59a447(0x1a3)]['data'];const _0x238a54=await this['fetchHotSearches']();return this[_0x59a447(0x1a3)]={'data':_0x238a54,'timestamp':_0x25857a},_0x238a54;}catch(_0x43b65f){if(this[_0x59a447(0x1a3)])return this[_0x59a447(0x1a3)]['data'];throw _0x43b65f;}}async[_0x35f830(0x19a)](_0x480b8a,_0x90a22,_0x1fb1aa){const _0x29ed59=_0x35f830,{prompt:_0xaa85cb,model:_0x36dcd1,mode:_0x527736,parentMessageId:_0x315b01}=_0x480b8a;try{if(!_0x90a22[_0x29ed59(0x1cd)])throw new Error(_0x29ed59(0x19b));_0x1fb1aa[_0x29ed59(0x191)](_0x29ed59(0x196),_0x29ed59(0x1b0));if(_0x315b01){const _0x20ebb6=await this[_0x29ed59(0x1a9)][_0x29ed59(0x1c1)](_0x36dcd1);if(!_0x20ebb6)throw new Error(_0x29ed59(0x1a2));const _0x8b98a6=await this[_0x29ed59(0x1bc)][_0x29ed59(0x19c)]({'prompt':_0xaa85cb,'model':_0x20ebb6['model'],'options':{'parentMessageId':_0x315b01,'usingNetwork':!![]}},_0x90a22,_0x1fb1aa);_0x8b98a6&&_0x8b98a6['id']&&_0x1fb1aa[_0x29ed59(0x1c6)]('\x0a'+JSON[_0x29ed59(0x1bd)]({'parentMessageId':_0x8b98a6['id']}));}else{const _0x198a7f=await this['searchWithExternalAPI'](_0xaa85cb);_0x1fb1aa[_0x29ed59(0x1c6)](JSON[_0x29ed59(0x1bd)]({'context':_0x198a7f[_0x29ed59(0x1b3)](0x0,0x14)}));if(_0x527736===_0x29ed59(0x1a6)||_0x527736===_0x29ed59(0x1b8)){const _0x7091a6=await this[_0x29ed59(0x1a7)](_0xaa85cb+'\x20images');_0x1fb1aa['write']('\x0a'+JSON[_0x29ed59(0x1bd)]({'images':_0x7091a6[_0x29ed59(0x1b3)](0x0,0x5)}));}}_0x1fb1aa[_0x29ed59(0x1ca)]();}catch(_0x4c409a){common_1[_0x29ed59(0x19d)][_0x29ed59(0x18e)](_0x29ed59(0x194)+_0x4c409a['message'],_0x29ed59(0x1b2));throw _0x4c409a;}}};SearchService=__decorate([(0x0,common_1['Injectable'])(),__metadata(_0x35f830(0x199),[globalConfig_service_1[_0x35f830(0x19f)],chat_service_1['ChatService'],models_service_1[_0x35f830(0x1a8)]])],SearchService),exports['SearchService']=SearchService;function _0x4315(_0x54f2b6,_0x399338){const _0x357081=_0x3570();return _0x4315=function(_0x43154d,_0x25afba){_0x43154d=_0x43154d-0x18d;let _0x153cd1=_0x357081[_0x43154d];return _0x153cd1;},_0x4315(_0x54f2b6,_0x399338);}function _0x3570(){const _0x347fb0=['getOwnPropertyDescriptor','getConfigs','__decorate','research','length','timestamp','decorate','chatService','stringify','GET','../chat/chat.service','append','getCurrentModelKeyInfo','93sWflUB','5592HIBgdH','object','globalConfigService','write','11921SllKaY','metadata','CACHE_DURATION','end','status','format','user','searchParams','getHotSearches','fetchHotSearches','now','error','28332WZKcNb','https://www.coderutil.com/api/resou/v1/toutiao','setHeader','50491617AKlkpn','1grAunn','Search\x20error:\x20','5626750eBJOXg','Content-type','defineProperty','json','design:paramtypes','search','User\x20not\x20authenticated','chatProcess','Logger','../models/models.service','GlobalConfigService','message','function','Model\x20key\x20not\x20found.\x20Please\x20check\x20your\x20model\x20configuration.','hotSearchCache','__esModule','hotSearchAccessKey','deep','searchWithExternalAPI','ModelsService','modelsService','__metadata','hotSearchSecretKey','7626498lTPHEb','HTTP\x20error!\x20status:\x20','toString','9050661ZmIZxI','application/octet-stream;\x20charset=utf-8','10HxPKXS','SearchService','slice','2494668VghQRb'];_0x3570=function(){return _0x347fb0;};return _0x3570();}