'use strict';const _0x174bf2=_0x3f7a;(function(_0x539a64,_0x55c967){const _0x290cc1=_0x3f7a,_0x5085dc=_0x539a64();while(!![]){try{const _0x5ac2dd=-parseInt(_0x290cc1(0x1ef))/0x1*(-parseInt(_0x290cc1(0x1ba))/0x2)+-parseInt(_0x290cc1(0x1bf))/0x3*(parseInt(_0x290cc1(0x1d5))/0x4)+-parseInt(_0x290cc1(0x1be))/0x5*(-parseInt(_0x290cc1(0x1c6))/0x6)+-parseInt(_0x290cc1(0x1e3))/0x7+parseInt(_0x290cc1(0x1da))/0x8+parseInt(_0x290cc1(0x1cf))/0x9*(-parseInt(_0x290cc1(0x1d2))/0xa)+-parseInt(_0x290cc1(0x1d8))/0xb;if(_0x5ac2dd===_0x55c967)break;else _0x5085dc['push'](_0x5085dc['shift']());}catch(_0x1b5338){_0x5085dc['push'](_0x5085dc['shift']());}}}(_0xff81,0x3924c));function _0x3f7a(_0x35f617,_0x4d6291){const _0xff814b=_0xff81();return _0x3f7a=function(_0x3f7a91,_0x5ce210){_0x3f7a91=_0x3f7a91-0x1b7;let _0xd90291=_0xff814b[_0x3f7a91];return _0xd90291;},_0x3f7a(_0x35f617,_0x4d6291);}function _0xff81(){const _0x1c3ac5=['CACHE_DURATION','decorate','1lTiqIk','end','write','getCurrentModelKeyInfo','toString','data','research','object','model','Search\x20API\x20error:\x20','append','slice','503108YLTSVT','Logger','getConfigs','getHotSearches','38365wXqwGr','3CoJvpY','../chat/chat.service','timestamp','error','searchPlatformUrl','__decorate','results','252quUgBR','GET','stringify','hotSearchAccessKey','status','hotSearchCache','https://www.coderutil.com/api/resou/v1/toutiao','format','/search','154971YvunNm','defineProperty','setHeader','60uWgpXJ','design:paramtypes','@nestjs/common','668744tPcQJw','SearchService','searchParams','3205543LNUtzc','ModelsService','2942312NgqKTC','GlobalConfigService','message','__metadata','function','Model\x20key\x20not\x20found.\x20Please\x20check\x20your\x20model\x20configuration.','../globalConfig/globalConfig.service','modelsService','User\x20not\x20authenticated','1019452LqlYzS','searchWithExternalAPI','getOwnPropertyDescriptor','Injectable','length','metadata','ChatService','json','fetchHotSearches','globalConfigService'];_0xff81=function(){return _0x1c3ac5;};return _0xff81();}var __decorate=this&&this[_0x174bf2(0x1c4)]||function(_0x22dff5,_0x1ad973,_0x3a8cc2,_0x52ac0c){const _0xeea9f0=_0x174bf2;var _0x17194f=arguments[_0xeea9f0(0x1e7)],_0x2aead=_0x17194f<0x3?_0x1ad973:_0x52ac0c===null?_0x52ac0c=Object[_0xeea9f0(0x1e5)](_0x1ad973,_0x3a8cc2):_0x52ac0c,_0x489594;if(typeof Reflect===_0xeea9f0(0x1f6)&&typeof Reflect[_0xeea9f0(0x1ee)]===_0xeea9f0(0x1de))_0x2aead=Reflect[_0xeea9f0(0x1ee)](_0x22dff5,_0x1ad973,_0x3a8cc2,_0x52ac0c);else{for(var _0x3b5515=_0x22dff5[_0xeea9f0(0x1e7)]-0x1;_0x3b5515>=0x0;_0x3b5515--)if(_0x489594=_0x22dff5[_0x3b5515])_0x2aead=(_0x17194f<0x3?_0x489594(_0x2aead):_0x17194f>0x3?_0x489594(_0x1ad973,_0x3a8cc2,_0x2aead):_0x489594(_0x1ad973,_0x3a8cc2))||_0x2aead;}return _0x17194f>0x3&&_0x2aead&&Object[_0xeea9f0(0x1d0)](_0x1ad973,_0x3a8cc2,_0x2aead),_0x2aead;},__metadata=this&&this[_0x174bf2(0x1dd)]||function(_0x5615de,_0x1f4f52){const _0x978b76=_0x174bf2;if(typeof Reflect==='object'&&typeof Reflect[_0x978b76(0x1e8)]===_0x978b76(0x1de))return Reflect[_0x978b76(0x1e8)](_0x5615de,_0x1f4f52);};Object[_0x174bf2(0x1d0)](exports,'__esModule',{'value':!![]}),exports['SearchService']=void 0x0;const common_1=require(_0x174bf2(0x1d4)),globalConfig_service_1=require(_0x174bf2(0x1e0)),chat_service_1=require(_0x174bf2(0x1c0)),models_service_1=require('../models/models.service');let SearchService=class SearchService{constructor(_0x5a211c,_0x571460,_0x256ef9){const _0x4bbe6e=_0x174bf2;this[_0x4bbe6e(0x1ec)]=_0x5a211c,this['chatService']=_0x571460,this[_0x4bbe6e(0x1e1)]=_0x256ef9,this[_0x4bbe6e(0x1cb)]=null,this[_0x4bbe6e(0x1ed)]=0xa*0x3c*0x3e8;}async[_0x174bf2(0x1e4)](_0x5ad4d7){const _0x185059=_0x174bf2;try{const {searchPlatformUrl:_0x55bbaf}=await this[_0x185059(0x1ec)][_0x185059(0x1bc)]([_0x185059(0x1c3)]),_0x3d4363=new URL(_0x55bbaf+_0x185059(0x1ce));_0x3d4363[_0x185059(0x1d7)][_0x185059(0x1b8)]('q',_0x5ad4d7),_0x3d4363[_0x185059(0x1d7)][_0x185059(0x1b8)](_0x185059(0x1cd),_0x185059(0x1ea));const _0x1803e0=await fetch(_0x3d4363[_0x185059(0x1f3)](),{'method':'GET'});if(!_0x1803e0['ok'])throw new Error('HTTP\x20error!\x20status:\x20'+_0x1803e0[_0x185059(0x1ca)]);const _0x251675=await _0x1803e0[_0x185059(0x1ea)]();return _0x251675[_0x185059(0x1c5)]||[];}catch(_0x2ab449){common_1[_0x185059(0x1bb)][_0x185059(0x1c2)](_0x185059(0x1b7)+_0x2ab449[_0x185059(0x1dc)],'SearchService');throw _0x2ab449;}}async['fetchHotSearches'](){const _0x160926=_0x174bf2,_0x4a1894=await this[_0x160926(0x1ec)]['getConfigs'](['hotSearchAccessKey','hotSearchSecretKey']),_0x567053=_0x4a1894===null||_0x4a1894===void 0x0?void 0x0:_0x4a1894[_0x160926(0x1c9)],_0xc4c8c8=_0x4a1894===null||_0x4a1894===void 0x0?void 0x0:_0x4a1894['hotSearchSecretKey'];if(!_0x567053||!_0xc4c8c8)throw new Error('Hot\x20search\x20API\x20keys\x20not\x20configured');const _0x590cc9=await fetch(_0x160926(0x1cc),{'method':_0x160926(0x1c7),'headers':{'access-key':_0x567053,'secret-key':_0xc4c8c8}});if(!_0x590cc9['ok'])throw new Error('HTTP\x20error!\x20status:\x20'+_0x590cc9['status']);return await _0x590cc9[_0x160926(0x1ea)]();}async[_0x174bf2(0x1bd)](){const _0x326adc=_0x174bf2;try{const _0x520f3d=Date['now']();if(this[_0x326adc(0x1cb)]&&_0x520f3d-this[_0x326adc(0x1cb)][_0x326adc(0x1c1)]<this[_0x326adc(0x1ed)])return this[_0x326adc(0x1cb)][_0x326adc(0x1f4)];const _0x30c3b8=await this[_0x326adc(0x1eb)]();return this[_0x326adc(0x1cb)]={'data':_0x30c3b8,'timestamp':_0x520f3d},_0x30c3b8;}catch(_0x3dc55d){if(this['hotSearchCache'])return this[_0x326adc(0x1cb)][_0x326adc(0x1f4)];throw _0x3dc55d;}}async['search'](_0x49b464,_0x4d22e3,_0x52dab7){const _0x117465=_0x174bf2,{prompt:_0x905c61,model:_0x3615ac,mode:_0x3a200f,parentMessageId:_0x3b416f}=_0x49b464;try{if(!_0x4d22e3['user'])throw new Error(_0x117465(0x1e2));_0x52dab7[_0x117465(0x1d1)]('Content-type','application/octet-stream;\x20charset=utf-8');if(_0x3b416f){const _0x7d8e9f=await this[_0x117465(0x1e1)][_0x117465(0x1f2)](_0x3615ac);if(!_0x7d8e9f)throw new Error(_0x117465(0x1df));const _0xb46286=await this['chatService']['chatProcess']({'prompt':_0x905c61,'model':_0x7d8e9f[_0x117465(0x1f7)],'options':{'parentMessageId':_0x3b416f,'usingNetwork':!![]}},_0x4d22e3,_0x52dab7);_0xb46286&&_0xb46286['id']&&_0x52dab7[_0x117465(0x1f1)]('\x0a'+JSON['stringify']({'parentMessageId':_0xb46286['id']}));}else{const _0x4954bd=await this[_0x117465(0x1e4)](_0x905c61);_0x52dab7['write'](JSON[_0x117465(0x1c8)]({'context':_0x4954bd[_0x117465(0x1b9)](0x0,0x14)}));if(_0x3a200f==='deep'||_0x3a200f===_0x117465(0x1f5)){const _0x45a3ce=await this['searchWithExternalAPI'](_0x905c61+'\x20images');_0x52dab7[_0x117465(0x1f1)]('\x0a'+JSON[_0x117465(0x1c8)]({'images':_0x45a3ce[_0x117465(0x1b9)](0x0,0x5)}));}}_0x52dab7[_0x117465(0x1f0)]();}catch(_0x7ac680){common_1[_0x117465(0x1bb)][_0x117465(0x1c2)]('Search\x20error:\x20'+_0x7ac680[_0x117465(0x1dc)],'SearchService');throw _0x7ac680;}}};SearchService=__decorate([(0x0,common_1[_0x174bf2(0x1e6)])(),__metadata(_0x174bf2(0x1d3),[globalConfig_service_1[_0x174bf2(0x1db)],chat_service_1[_0x174bf2(0x1e9)],models_service_1[_0x174bf2(0x1d9)]])],SearchService),exports[_0x174bf2(0x1d6)]=SearchService;