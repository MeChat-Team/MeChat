'use strict';const _0x35959e=_0x3e6b;(function(_0x1f6d52,_0x4b978a){const _0x48af3f=_0x3e6b,_0x32e515=_0x1f6d52();while(!![]){try{const _0x12c723=parseInt(_0x48af3f(0xcf))/0x1+parseInt(_0x48af3f(0xd6))/0x2+parseInt(_0x48af3f(0xb8))/0x3*(parseInt(_0x48af3f(0xa0))/0x4)+-parseInt(_0x48af3f(0xe0))/0x5+parseInt(_0x48af3f(0xa9))/0x6+-parseInt(_0x48af3f(0xb5))/0x7+parseInt(_0x48af3f(0xca))/0x8*(-parseInt(_0x48af3f(0xbf))/0x9);if(_0x12c723===_0x4b978a)break;else _0x32e515['push'](_0x32e515['shift']());}catch(_0x23145b){_0x32e515['push'](_0x32e515['shift']());}}}(_0x20d0,0x622aa));var __decorate=this&&this[_0x35959e(0xdb)]||function(_0x3b5fd9,_0x7d7ec3,_0x2ccd2f,_0x20b5cd){const _0x331aec=_0x35959e;var _0x332543=arguments['length'],_0x4f9bea=_0x332543<0x3?_0x7d7ec3:_0x20b5cd===null?_0x20b5cd=Object['getOwnPropertyDescriptor'](_0x7d7ec3,_0x2ccd2f):_0x20b5cd,_0x32ea6b;if(typeof Reflect==='object'&&typeof Reflect[_0x331aec(0xc4)]===_0x331aec(0xbb))_0x4f9bea=Reflect[_0x331aec(0xc4)](_0x3b5fd9,_0x7d7ec3,_0x2ccd2f,_0x20b5cd);else{for(var _0x2e3b88=_0x3b5fd9[_0x331aec(0x9f)]-0x1;_0x2e3b88>=0x0;_0x2e3b88--)if(_0x32ea6b=_0x3b5fd9[_0x2e3b88])_0x4f9bea=(_0x332543<0x3?_0x32ea6b(_0x4f9bea):_0x332543>0x3?_0x32ea6b(_0x7d7ec3,_0x2ccd2f,_0x4f9bea):_0x32ea6b(_0x7d7ec3,_0x2ccd2f))||_0x4f9bea;}return _0x332543>0x3&&_0x4f9bea&&Object[_0x331aec(0xb7)](_0x7d7ec3,_0x2ccd2f,_0x4f9bea),_0x4f9bea;},__metadata=this&&this[_0x35959e(0xa8)]||function(_0xdc0dea,_0x1a8ad9){const _0x384785=_0x35959e;if(typeof Reflect===_0x384785(0xc7)&&typeof Reflect[_0x384785(0xc5)]===_0x384785(0xbb))return Reflect[_0x384785(0xc5)](_0xdc0dea,_0x1a8ad9);};function _0x20d0(){const _0x1b56a0=['data','GET','Logger','901348wcQUhL','json','Content-type','status','../globalConfig/globalConfig.service','__decorate','stringify','Model\x20key\x20not\x20found.\x20Please\x20check\x20your\x20model\x20configuration.','GlobalConfigService','User\x20not\x20authenticated','1500975unNDBS','CACHE_DURATION','user','length','389020Mpsuvy','searchPlatformUrl','end','hotSearchSecretKey','HTTP\x20error!\x20status:\x20','ChatService','@nestjs/common','chatProcess','__metadata','386448QLmeLh','format','chatService','fetchHotSearches','application/octet-stream;\x20charset=utf-8','globalConfigService','Injectable','error','setHeader','deep','slice','toString','3096471GdVHYl','append','defineProperty','6XQbffL','searchWithExternalAPI','modelsService','function','message','getConfigs','hotSearchCache','27UdoXtx','../models/models.service','searchParams','getCurrentModelKeyInfo','ModelsService','decorate','metadata','Search\x20API\x20error:\x20','object','../chat/chat.service','now','658440TdCVMI','design:paramtypes','getHotSearches','write','results','681961kFtZqp','https://www.coderutil.com/api/resou/v1/toutiao','SearchService','__esModule'];_0x20d0=function(){return _0x1b56a0;};return _0x20d0();}Object[_0x35959e(0xb7)](exports,_0x35959e(0xd2),{'value':!![]}),exports['SearchService']=void 0x0;const common_1=require(_0x35959e(0xa6)),globalConfig_service_1=require(_0x35959e(0xda)),chat_service_1=require(_0x35959e(0xc8)),models_service_1=require(_0x35959e(0xc0));function _0x3e6b(_0x522b7e,_0x4bd04b){const _0x20d009=_0x20d0();return _0x3e6b=function(_0x3e6b68,_0xb48eea){_0x3e6b68=_0x3e6b68-0x9d;let _0x5121ab=_0x20d009[_0x3e6b68];return _0x5121ab;},_0x3e6b(_0x522b7e,_0x4bd04b);}let SearchService=class SearchService{constructor(_0x57abd1,_0x2fc350,_0x148bfc){const _0x3e301f=_0x35959e;this['globalConfigService']=_0x57abd1,this[_0x3e301f(0xab)]=_0x2fc350,this['modelsService']=_0x148bfc,this[_0x3e301f(0xbe)]=null,this['CACHE_DURATION']=0xa*0x3c*0x3e8;}async[_0x35959e(0xb9)](_0x5d4094){const _0x5793bc=_0x35959e;try{const {searchPlatformUrl:_0x1dca59}=await this[_0x5793bc(0xae)][_0x5793bc(0xbd)]([_0x5793bc(0xa1)]),_0x482b95=new URL(_0x1dca59+'/search');_0x482b95[_0x5793bc(0xc1)]['append']('q',_0x5d4094),_0x482b95[_0x5793bc(0xc1)][_0x5793bc(0xb6)](_0x5793bc(0xaa),'json');const _0x4221f9=await fetch(_0x482b95[_0x5793bc(0xb4)](),{'method':_0x5793bc(0xd4)});if(!_0x4221f9['ok'])throw new Error(_0x5793bc(0xa4)+_0x4221f9[_0x5793bc(0xd9)]);const _0xf9ddc7=await _0x4221f9[_0x5793bc(0xd7)]();return _0xf9ddc7[_0x5793bc(0xce)]||[];}catch(_0x4bb2fd){common_1[_0x5793bc(0xd5)][_0x5793bc(0xb0)](_0x5793bc(0xc6)+_0x4bb2fd['message'],_0x5793bc(0xd1));throw _0x4bb2fd;}}async[_0x35959e(0xac)](){const _0x2705b4=_0x35959e,_0x286f68=await this[_0x2705b4(0xae)]['getConfigs'](['hotSearchAccessKey','hotSearchSecretKey']),_0x2b08c8=_0x286f68===null||_0x286f68===void 0x0?void 0x0:_0x286f68['hotSearchAccessKey'],_0x304686=_0x286f68===null||_0x286f68===void 0x0?void 0x0:_0x286f68[_0x2705b4(0xa3)];if(!_0x2b08c8||!_0x304686)throw new Error('Hot\x20search\x20API\x20keys\x20not\x20configured');const _0x7033a6=await fetch(_0x2705b4(0xd0),{'method':_0x2705b4(0xd4),'headers':{'access-key':_0x2b08c8,'secret-key':_0x304686}});if(!_0x7033a6['ok'])throw new Error(_0x2705b4(0xa4)+_0x7033a6[_0x2705b4(0xd9)]);return await _0x7033a6[_0x2705b4(0xd7)]();}async[_0x35959e(0xcc)](){const _0x30e097=_0x35959e;try{const _0x33f083=Date[_0x30e097(0xc9)]();if(this[_0x30e097(0xbe)]&&_0x33f083-this[_0x30e097(0xbe)]['timestamp']<this[_0x30e097(0x9d)])return this['hotSearchCache'][_0x30e097(0xd3)];const _0x525bb6=await this[_0x30e097(0xac)]();return this[_0x30e097(0xbe)]={'data':_0x525bb6,'timestamp':_0x33f083},_0x525bb6;}catch(_0x5ca0fc){if(this[_0x30e097(0xbe)])return this['hotSearchCache'][_0x30e097(0xd3)];throw _0x5ca0fc;}}async['search'](_0x245f1f,_0x26f584,_0x42a240){const _0x518b3c=_0x35959e,{prompt:_0x122a41,model:_0x1092e1,mode:_0x287d27,parentMessageId:_0x38ec24}=_0x245f1f;try{if(!_0x26f584[_0x518b3c(0x9e)])throw new Error(_0x518b3c(0xdf));_0x42a240[_0x518b3c(0xb1)](_0x518b3c(0xd8),_0x518b3c(0xad));if(_0x38ec24){const _0x1fedbd=await this[_0x518b3c(0xba)][_0x518b3c(0xc2)](_0x1092e1);if(!_0x1fedbd)throw new Error(_0x518b3c(0xdd));const _0x4d6c13=await this[_0x518b3c(0xab)][_0x518b3c(0xa7)]({'prompt':_0x122a41,'model':_0x1fedbd['model'],'options':{'parentMessageId':_0x38ec24,'usingNetwork':!![]}},_0x26f584,_0x42a240);_0x4d6c13&&_0x4d6c13['id']&&_0x42a240[_0x518b3c(0xcd)]('\x0a'+JSON[_0x518b3c(0xdc)]({'parentMessageId':_0x4d6c13['id']}));}else{const _0x70af88=await this[_0x518b3c(0xb9)](_0x122a41);_0x42a240['write'](JSON[_0x518b3c(0xdc)]({'context':_0x70af88[_0x518b3c(0xb3)](0x0,0x14)}));if(_0x287d27===_0x518b3c(0xb2)||_0x287d27==='research'){const _0x2d3bc6=await this['searchWithExternalAPI'](_0x122a41+'\x20images');_0x42a240[_0x518b3c(0xcd)]('\x0a'+JSON[_0x518b3c(0xdc)]({'images':_0x2d3bc6['slice'](0x0,0x5)}));}}_0x42a240[_0x518b3c(0xa2)]();}catch(_0xe3fa0c){common_1[_0x518b3c(0xd5)][_0x518b3c(0xb0)]('Search\x20error:\x20'+_0xe3fa0c[_0x518b3c(0xbc)],'SearchService');throw _0xe3fa0c;}}};SearchService=__decorate([(0x0,common_1[_0x35959e(0xaf)])(),__metadata(_0x35959e(0xcb),[globalConfig_service_1[_0x35959e(0xde)],chat_service_1[_0x35959e(0xa5)],models_service_1[_0x35959e(0xc3)]])],SearchService),exports[_0x35959e(0xd1)]=SearchService;