'use strict';const _0x5788b9=_0x1713;(function(_0x5da868,_0x575fff){const _0x4d6214=_0x1713,_0x21b213=_0x5da868();while(!![]){try{const _0x346f0f=parseInt(_0x4d6214(0x1a9))/0x1+parseInt(_0x4d6214(0x1b4))/0x2*(-parseInt(_0x4d6214(0x189))/0x3)+-parseInt(_0x4d6214(0x1bf))/0x4*(-parseInt(_0x4d6214(0x1b7))/0x5)+parseInt(_0x4d6214(0x1ac))/0x6+-parseInt(_0x4d6214(0x16e))/0x7*(parseInt(_0x4d6214(0x17a))/0x8)+-parseInt(_0x4d6214(0x194))/0x9*(parseInt(_0x4d6214(0x164))/0xa)+parseInt(_0x4d6214(0x178))/0xb;if(_0x346f0f===_0x575fff)break;else _0x21b213['push'](_0x21b213['shift']());}catch(_0x5e2135){_0x21b213['push'](_0x21b213['shift']());}}}(_0x3c9a,0x6221d));var __decorate=this&&this[_0x5788b9(0x181)]||function(_0x40e5f9,_0x59fb5a,_0x585da1,_0x546897){const _0xbf4619=_0x5788b9;var _0x5ee3ec=arguments['length'],_0x4e3407=_0x5ee3ec<0x3?_0x59fb5a:_0x546897===null?_0x546897=Object[_0xbf4619(0x19a)](_0x59fb5a,_0x585da1):_0x546897,_0x47662c;if(typeof Reflect==='object'&&typeof Reflect[_0xbf4619(0x1a1)]===_0xbf4619(0x173))_0x4e3407=Reflect['decorate'](_0x40e5f9,_0x59fb5a,_0x585da1,_0x546897);else{for(var _0x1a8803=_0x40e5f9['length']-0x1;_0x1a8803>=0x0;_0x1a8803--)if(_0x47662c=_0x40e5f9[_0x1a8803])_0x4e3407=(_0x5ee3ec<0x3?_0x47662c(_0x4e3407):_0x5ee3ec>0x3?_0x47662c(_0x59fb5a,_0x585da1,_0x4e3407):_0x47662c(_0x59fb5a,_0x585da1))||_0x4e3407;}return _0x5ee3ec>0x3&&_0x4e3407&&Object[_0xbf4619(0x179)](_0x59fb5a,_0x585da1,_0x4e3407),_0x4e3407;},__metadata=this&&this['__metadata']||function(_0x19379c,_0x48df31){const _0xa95ccf=_0x5788b9;if(typeof Reflect===_0xa95ccf(0x1b2)&&typeof Reflect[_0xa95ccf(0x19e)]===_0xa95ccf(0x173))return Reflect['metadata'](_0x19379c,_0x48df31);},__param=this&&this[_0x5788b9(0x185)]||function(_0x7f5903,_0x3bd47b){return function(_0x595c93,_0x55f556){_0x3bd47b(_0x595c93,_0x55f556,_0x7f5903);};};Object[_0x5788b9(0x179)](exports,_0x5788b9(0x198),{'value':!![]}),exports[_0x5788b9(0x1b1)]=void 0x0;function _0x1713(_0x5cc96c,_0x40a0fc){const _0x3c9a44=_0x3c9a();return _0x1713=function(_0x1713d0,_0x18e26a){_0x1713d0=_0x1713d0-0x162;let _0x4879f0=_0x3c9a44[_0x1713d0];return _0x4879f0;},_0x1713(_0x5cc96c,_0x40a0fc);}const common_1=require(_0x5788b9(0x1b5)),swagger_1=require(_0x5788b9(0x193)),verification_service_1=require(_0x5788b9(0x169)),verification_constant_1=require('../../common/constants/verification.constant'),passport_1=require(_0x5788b9(0x16c)),user_service_1=require(_0x5788b9(0x177)),verifyCode_dto_1=require(_0x5788b9(0x1bb)),globalConfig_service_1=require(_0x5788b9(0x1ae)),common_2=require(_0x5788b9(0x1b5));function _0x3c9a(){const _0x8abcd7=['string','验证码ID','@nestjs/passport','verification','640766TOVGlg','design:paramtypes','不支持的验证码类型','code','Body','function','VerificationEnum','verifyThirdPartyCode','JWT认证失败','../user/user.service','15196346QGLKSD','defineProperty','56yLmfED','third-party/verify','验证码生成成功','验证码类型','Post','number','date-time','__decorate','thirdPartyAuthExpir','发送短信验证码','VerificationService','__param','ApiOperation','验证码发送成功','AuthGuard','129HTEVhT','发送邮箱验证码','PasswordReset','design:returntype','prototype','ApiResponse','ApiBody','verifyCode','错误类型','UNAUTHORIZED','@nestjs/swagger','711wGERTB','UseGuards','发送邮箱验证码（换绑邮箱），验证码30分钟内有效。同一邮箱1分钟内只能发送一次。','过期时间','__esModule','生成第三方应用认证验证码','getOwnPropertyDescriptor','email','ApiTags','boolean','metadata','生成一个用于第三方应用认证的验证码，需要JWT认证。验证码默认1分钟后过期。','HttpStatus','decorate','用户ID','GlobalConfigService','发送失败，可能是因为发送太频繁或参数错误','third-party/generate','VerifyCodeDto','assign','jwt','24348pNBXBn','createVerification','generateThirdPartyCode','1814784YcCSiW','验证是否成功','../globalConfig/globalConfig.service','verificationService','验证第三方应用认证码','VerificationController','object','错误信息','24230Uyozzu','@nestjs/common','验证结果消息','22955dtwzRt','design:type','getUserById','globalConfigService','./dto/verifyCode.dto','sendEmailCode','BAD_REQUEST','Req','356bWHwWA','UserService','send-email','验证码验证成功','70030MwCpJb','user','ApiBearerAuth','userService','ThirdPartyAuth','./verification.service'];_0x3c9a=function(){return _0x8abcd7;};return _0x3c9a();}let VerificationController=class VerificationController{constructor(_0x4a7922,_0x2983e0,_0x25b0f9){const _0x3cbc44=_0x5788b9;this[_0x3cbc44(0x1af)]=_0x4a7922,this['userService']=_0x2983e0,this[_0x3cbc44(0x1ba)]=_0x25b0f9;}async[_0x5788b9(0x1ab)](_0x506211){const _0x4b9b80=_0x5788b9,_0x22a254=_0x506211[_0x4b9b80(0x165)]['id'],_0x116c05=await this[_0x4b9b80(0x167)][_0x4b9b80(0x1b9)](_0x22a254),_0x388ea3=await this[_0x4b9b80(0x1ba)]['getConfigs']([_0x4b9b80(0x182)]),_0x499a33=_0x388ea3[_0x4b9b80(0x182)]?Number(_0x388ea3[_0x4b9b80(0x182)]):0x3c;return await this[_0x4b9b80(0x1af)][_0x4b9b80(0x1aa)](_0x116c05,verification_constant_1[_0x4b9b80(0x174)][_0x4b9b80(0x168)],_0x499a33);}async['verifyThirdPartyCode'](_0x3fa46c){const _0x29be07=_0x5788b9,_0x3515f6={'id':_0x3fa46c['id'],'code':Number(_0x3fa46c[_0x29be07(0x171)])};return await this['verificationService'][_0x29be07(0x190)](_0x3515f6,verification_constant_1[_0x29be07(0x174)][_0x29be07(0x168)]);}async['sendSmsCode'](_0x5d3599){const _0x386ff0=_0x5788b9,{phone:_0x74bcd7,type:_0x2ba0a3}=_0x5d3599;if(_0x2ba0a3!==verification_constant_1[_0x386ff0(0x174)]['Registration']&&_0x2ba0a3!==verification_constant_1[_0x386ff0(0x174)][_0x386ff0(0x18b)])throw new common_2['HttpException'](_0x386ff0(0x170),common_1[_0x386ff0(0x1a0)]['BAD_REQUEST']);const _0x3da66b={'id':0x0,'email':'','phone':_0x74bcd7},_0x36acce=await this['verificationService'][_0x386ff0(0x1aa)](_0x3da66b,_0x2ba0a3);return await this[_0x386ff0(0x1af)]['sendPhoneCode']({'phone':_0x74bcd7,'code':_0x36acce['code']});}async['sendEmailCode'](_0x2f27b0,_0xbc8479){const _0x2a3647=_0x5788b9,_0x4e6b8d=_0xbc8479['user']['id'],_0x2c4c1e=await this[_0x2a3647(0x167)]['getUserById'](_0x4e6b8d),_0x5cbd34=await this['verificationService'][_0x2a3647(0x1aa)](Object[_0x2a3647(0x1a7)](Object[_0x2a3647(0x1a7)]({},_0x2c4c1e),{'email':_0x2f27b0[_0x2a3647(0x19b)]}),verification_constant_1[_0x2a3647(0x174)]['ChangeEmail']);return await this[_0x2a3647(0x1af)][_0x2a3647(0x1bc)]({'email':_0x2f27b0[_0x2a3647(0x19b)],'code':_0x5cbd34[_0x2a3647(0x171)]});}};__decorate([(0x0,common_1[_0x5788b9(0x17e)])(_0x5788b9(0x1a5)),(0x0,common_1[_0x5788b9(0x195)])((0x0,passport_1[_0x5788b9(0x188)])('jwt')),(0x0,swagger_1[_0x5788b9(0x166)])(),(0x0,swagger_1[_0x5788b9(0x186)])({'summary':_0x5788b9(0x199),'description':_0x5788b9(0x19f)}),(0x0,swagger_1[_0x5788b9(0x18e)])({'status':common_1[_0x5788b9(0x1a0)]['OK'],'description':_0x5788b9(0x17c),'schema':{'type':'object','properties':{'id':{'type':_0x5788b9(0x17f),'description':_0x5788b9(0x16b)},'code':{'type':'number','description':'验证码'},'userId':{'type':'number','description':_0x5788b9(0x1a2)},'type':{'type':'number','description':_0x5788b9(0x17d)},'expiresAt':{'type':_0x5788b9(0x16a),'format':_0x5788b9(0x180),'description':_0x5788b9(0x197)},'used':{'type':_0x5788b9(0x17f),'description':'是否已使用，0未使用，1已使用'}}}}),(0x0,swagger_1['ApiResponse'])({'status':common_1[_0x5788b9(0x1a0)][_0x5788b9(0x192)],'description':_0x5788b9(0x176)}),__param(0x0,(0x0,common_1['Req'])()),__metadata(_0x5788b9(0x1b8),Function),__metadata(_0x5788b9(0x16f),[Object]),__metadata('design:returntype',Promise)],VerificationController[_0x5788b9(0x18d)],_0x5788b9(0x1ab),null),__decorate([(0x0,common_1['Post'])(_0x5788b9(0x17b)),(0x0,swagger_1[_0x5788b9(0x186)])({'summary':_0x5788b9(0x1b0),'description':'验证用户提供的第三方应用认证码是否有效'}),(0x0,swagger_1[_0x5788b9(0x18f)])({'type':verifyCode_dto_1[_0x5788b9(0x1a6)]}),(0x0,swagger_1['ApiResponse'])({'status':common_1[_0x5788b9(0x1a0)]['OK'],'description':_0x5788b9(0x163),'schema':{'type':_0x5788b9(0x1b2),'properties':{'success':{'type':_0x5788b9(0x19d),'description':_0x5788b9(0x1ad)},'message':{'type':_0x5788b9(0x16a),'description':_0x5788b9(0x1b6)}}}}),(0x0,swagger_1[_0x5788b9(0x18e)])({'status':common_1[_0x5788b9(0x1a0)][_0x5788b9(0x1bd)],'description':'验证码无效或已过期','schema':{'type':_0x5788b9(0x1b2),'properties':{'message':{'type':_0x5788b9(0x16a),'description':_0x5788b9(0x1b3)},'error':{'type':_0x5788b9(0x16a),'description':_0x5788b9(0x191)},'statusCode':{'type':'number','description':'状态码'}}}}),__param(0x0,(0x0,common_1['Body'])()),__metadata(_0x5788b9(0x1b8),Function),__metadata(_0x5788b9(0x16f),[verifyCode_dto_1[_0x5788b9(0x1a6)]]),__metadata(_0x5788b9(0x18c),Promise)],VerificationController['prototype'],_0x5788b9(0x175),null),__decorate([(0x0,common_1['Post'])('send-sms'),(0x0,swagger_1[_0x5788b9(0x186)])({'summary':_0x5788b9(0x183),'description':'发送短信验证码（注册或重置密码），验证码5分钟内有效。同一手机号1分钟内只能发送一次。'}),(0x0,swagger_1[_0x5788b9(0x18e)])({'status':common_1[_0x5788b9(0x1a0)]['OK'],'description':_0x5788b9(0x187),'type':Boolean}),(0x0,swagger_1[_0x5788b9(0x18e)])({'status':common_1[_0x5788b9(0x1a0)][_0x5788b9(0x1bd)],'description':_0x5788b9(0x1a4)}),__param(0x0,(0x0,common_1['Body'])()),__metadata(_0x5788b9(0x1b8),Function),__metadata(_0x5788b9(0x16f),[Object]),__metadata(_0x5788b9(0x18c),Promise)],VerificationController['prototype'],'sendSmsCode',null),__decorate([(0x0,common_1[_0x5788b9(0x17e)])(_0x5788b9(0x162)),(0x0,swagger_1[_0x5788b9(0x186)])({'summary':_0x5788b9(0x18a),'description':_0x5788b9(0x196)}),(0x0,swagger_1[_0x5788b9(0x18e)])({'status':common_1[_0x5788b9(0x1a0)]['OK'],'description':_0x5788b9(0x187),'type':Boolean}),(0x0,swagger_1[_0x5788b9(0x18e)])({'status':common_1[_0x5788b9(0x1a0)]['BAD_REQUEST'],'description':_0x5788b9(0x1a4)}),(0x0,common_1[_0x5788b9(0x195)])((0x0,passport_1[_0x5788b9(0x188)])(_0x5788b9(0x1a8))),(0x0,swagger_1['ApiBearerAuth'])(),__param(0x0,(0x0,common_1[_0x5788b9(0x172)])()),__param(0x1,(0x0,common_1[_0x5788b9(0x1be)])()),__metadata(_0x5788b9(0x1b8),Function),__metadata(_0x5788b9(0x16f),[Object,Object]),__metadata(_0x5788b9(0x18c),Promise)],VerificationController['prototype'],'sendEmailCode',null),VerificationController=__decorate([(0x0,swagger_1[_0x5788b9(0x19c)])('验证码'),(0x0,common_1['Controller'])(_0x5788b9(0x16d)),__metadata(_0x5788b9(0x16f),[verification_service_1[_0x5788b9(0x184)],user_service_1[_0x5788b9(0x1c0)],globalConfig_service_1[_0x5788b9(0x1a3)]])],VerificationController),exports[_0x5788b9(0x1b1)]=VerificationController;