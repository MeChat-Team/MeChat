'use strict';const _0x217fce=_0x3b9d;(function(_0x12f846,_0x1bd065){const _0x8e8353=_0x3b9d,_0x22c7d3=_0x12f846();while(!![]){try{const _0x324f77=parseInt(_0x8e8353(0xd9))/0x1+-parseInt(_0x8e8353(0xc9))/0x2*(parseInt(_0x8e8353(0xba))/0x3)+-parseInt(_0x8e8353(0xb8))/0x4+parseInt(_0x8e8353(0xe3))/0x5*(-parseInt(_0x8e8353(0x9c))/0x6)+parseInt(_0x8e8353(0xcb))/0x7*(-parseInt(_0x8e8353(0xcc))/0x8)+-parseInt(_0x8e8353(0x9b))/0x9+parseInt(_0x8e8353(0x92))/0xa;if(_0x324f77===_0x1bd065)break;else _0x22c7d3['push'](_0x22c7d3['shift']());}catch(_0x24b3b4){_0x22c7d3['push'](_0x22c7d3['shift']());}}}(_0x311f,0x384f6));var __decorate=this&&this[_0x217fce(0xcd)]||function(_0xf36598,_0x32faa3,_0x271d34,_0x4dda06){const _0x5b0413=_0x217fce;var _0x40f42a=arguments[_0x5b0413(0xa3)],_0x3bdc05=_0x40f42a<0x3?_0x32faa3:_0x4dda06===null?_0x4dda06=Object['getOwnPropertyDescriptor'](_0x32faa3,_0x271d34):_0x4dda06,_0x2dfdb4;if(typeof Reflect==='object'&&typeof Reflect[_0x5b0413(0xd8)]===_0x5b0413(0xe0))_0x3bdc05=Reflect[_0x5b0413(0xd8)](_0xf36598,_0x32faa3,_0x271d34,_0x4dda06);else{for(var _0xbd2899=_0xf36598['length']-0x1;_0xbd2899>=0x0;_0xbd2899--)if(_0x2dfdb4=_0xf36598[_0xbd2899])_0x3bdc05=(_0x40f42a<0x3?_0x2dfdb4(_0x3bdc05):_0x40f42a>0x3?_0x2dfdb4(_0x32faa3,_0x271d34,_0x3bdc05):_0x2dfdb4(_0x32faa3,_0x271d34))||_0x3bdc05;}return _0x40f42a>0x3&&_0x3bdc05&&Object[_0x5b0413(0xdc)](_0x32faa3,_0x271d34,_0x3bdc05),_0x3bdc05;},__metadata=this&&this[_0x217fce(0xe6)]||function(_0x58973a,_0x223c45){const _0x15ef54=_0x217fce;if(typeof Reflect===_0x15ef54(0xc1)&&typeof Reflect['metadata']===_0x15ef54(0xe0))return Reflect[_0x15ef54(0x91)](_0x58973a,_0x223c45);},__param=this&&this['__param']||function(_0x1f5ff7,_0x115e70){return function(_0x253dcb,_0x4de33c){_0x115e70(_0x253dcb,_0x4de33c,_0x1f5ff7);};};function _0x311f(){const _0x30b6ba=['userService','sendSmsCode','ApiTags','send-email','globalConfigService','prototype','user','544916LZRojn','code','35679gJNBeZ','232bMLWID','__decorate','sendEmailCode','验证码验证成功','验证码ID','ApiBody','UseGuards','createVerification','email','generateThirdPartyCode','string','./dto/verifyCode.dto','decorate','356508StzBdy','Req','发送邮箱验证码（换绑邮箱），验证码30分钟内有效。同一邮箱1分钟内只能发送一次。','defineProperty','number','生成一个用于第三方应用认证的验证码，需要JWT认证。验证码默认1分钟后过期。','design:paramtypes','function','发送短信验证码（注册或重置密码），验证码5分钟内有效。同一手机号1分钟内只能发送一次。','VerifyCodeDto','545975rzhjki','thirdPartyAuthExpir','验证用户提供的第三方应用认证码是否有效','__metadata','发送短信验证码','Controller','发送邮箱验证码','verifyCode','VerificationController','验证结果消息','ThirdPartyAuth','ApiBearerAuth','jwt','metadata','14502940WLJkqr','验证第三方应用认证码','sendPhoneCode','验证是否成功','Body','verifyThirdPartyCode','JWT认证失败','__esModule','过期时间','3989745vukToH','24ybQuwA','发送失败，可能是因为发送太频繁或参数错误','send-sms','ApiOperation','HttpException','ApiResponse','@nestjs/swagger','length','./verification.service','boolean','不支持的验证码类型','Registration','验证码发送成功','Post','UNAUTHORIZED','date-time','状态码','design:returntype','design:type','../../common/constants/verification.constant','用户ID','验证码无效或已过期','是否已使用，0未使用，1已使用','third-party/verify','HttpStatus','getUserById','GlobalConfigService','assign','1103200IINlMt','VerificationEnum','3OzUHdo','验证码','BAD_REQUEST','../globalConfig/globalConfig.service','验证码类型','verificationService','AuthGuard','object'];_0x311f=function(){return _0x30b6ba;};return _0x311f();}Object['defineProperty'](exports,_0x217fce(0x99),{'value':!![]}),exports[_0x217fce(0x8c)]=void 0x0;const common_1=require('@nestjs/common'),swagger_1=require(_0x217fce(0xa2)),verification_service_1=require(_0x217fce(0xa4)),verification_constant_1=require(_0x217fce(0xaf)),passport_1=require('@nestjs/passport'),user_service_1=require('../user/user.service'),verifyCode_dto_1=require(_0x217fce(0xd7)),globalConfig_service_1=require(_0x217fce(0xbd)),common_2=require('@nestjs/common');function _0x3b9d(_0x7095e6,_0x187212){const _0x311f6b=_0x311f();return _0x3b9d=function(_0x3b9d8e,_0x2575c8){_0x3b9d8e=_0x3b9d8e-0x89;let _0x347c57=_0x311f6b[_0x3b9d8e];return _0x347c57;},_0x3b9d(_0x7095e6,_0x187212);}let VerificationController=class VerificationController{constructor(_0xb5b6fe,_0xeb743,_0x5bc1be){const _0x346c3b=_0x217fce;this['verificationService']=_0xb5b6fe,this['userService']=_0xeb743,this[_0x346c3b(0xc6)]=_0x5bc1be;}async['generateThirdPartyCode'](_0x1faf5a){const _0x8f6e75=_0x217fce,_0x17d0d0=_0x1faf5a[_0x8f6e75(0xc8)]['id'],_0xa20d0f=await this[_0x8f6e75(0xc2)][_0x8f6e75(0xb5)](_0x17d0d0),_0x114a70=await this[_0x8f6e75(0xc6)]['getConfigs']([_0x8f6e75(0xe4)]),_0x308c64=_0x114a70['thirdPartyAuthExpir']?Number(_0x114a70[_0x8f6e75(0xe4)]):0x3c;return await this[_0x8f6e75(0xbf)][_0x8f6e75(0xd3)](_0xa20d0f,verification_constant_1['VerificationEnum']['ThirdPartyAuth'],_0x308c64);}async[_0x217fce(0x97)](_0x43e7f4){const _0xf13612=_0x217fce,_0x3a7a0e={'id':_0x43e7f4['id'],'code':Number(_0x43e7f4[_0xf13612(0xca)])};return await this[_0xf13612(0xbf)][_0xf13612(0x8b)](_0x3a7a0e,verification_constant_1[_0xf13612(0xb9)][_0xf13612(0x8e)]);}async['sendSmsCode'](_0x1cadd4){const _0x5f3ea7=_0x217fce,{phone:_0x564476,type:_0x47e368}=_0x1cadd4;if(_0x47e368!==verification_constant_1['VerificationEnum'][_0x5f3ea7(0xa7)]&&_0x47e368!==verification_constant_1['VerificationEnum']['PasswordReset'])throw new common_2[(_0x5f3ea7(0xa0))](_0x5f3ea7(0xa6),common_1[_0x5f3ea7(0xb4)]['BAD_REQUEST']);const _0x59ef69={'id':0x0,'email':'','phone':_0x564476},_0x50f1d0=await this[_0x5f3ea7(0xbf)]['createVerification'](_0x59ef69,_0x47e368);return await this['verificationService'][_0x5f3ea7(0x94)]({'phone':_0x564476,'code':_0x50f1d0[_0x5f3ea7(0xca)]});}async[_0x217fce(0xce)](_0x5ae60d,_0x53581f){const _0x1fba95=_0x217fce,_0x136154=_0x53581f['user']['id'],_0x2829a6=await this[_0x1fba95(0xc2)][_0x1fba95(0xb5)](_0x136154),_0x5ba0b0=await this[_0x1fba95(0xbf)]['createVerification'](Object['assign'](Object[_0x1fba95(0xb7)]({},_0x2829a6),{'email':_0x5ae60d[_0x1fba95(0xd4)]}),verification_constant_1['VerificationEnum']['ChangeEmail']);return await this['verificationService'][_0x1fba95(0xce)]({'email':_0x5ae60d['email'],'code':_0x5ba0b0[_0x1fba95(0xca)]});}};__decorate([(0x0,common_1[_0x217fce(0xa9)])('third-party/generate'),(0x0,common_1['UseGuards'])((0x0,passport_1[_0x217fce(0xc0)])(_0x217fce(0x90))),(0x0,swagger_1[_0x217fce(0x8f)])(),(0x0,swagger_1[_0x217fce(0x9f)])({'summary':'生成第三方应用认证验证码','description':_0x217fce(0xde)}),(0x0,swagger_1['ApiResponse'])({'status':common_1[_0x217fce(0xb4)]['OK'],'description':'验证码生成成功','schema':{'type':_0x217fce(0xc1),'properties':{'id':{'type':_0x217fce(0xdd),'description':_0x217fce(0xd0)},'code':{'type':_0x217fce(0xdd),'description':_0x217fce(0xbb)},'userId':{'type':_0x217fce(0xdd),'description':_0x217fce(0xb0)},'type':{'type':_0x217fce(0xdd),'description':_0x217fce(0xbe)},'expiresAt':{'type':_0x217fce(0xd6),'format':_0x217fce(0xab),'description':_0x217fce(0x9a)},'used':{'type':'number','description':_0x217fce(0xb2)}}}}),(0x0,swagger_1[_0x217fce(0xa1)])({'status':common_1[_0x217fce(0xb4)][_0x217fce(0xaa)],'description':_0x217fce(0x98)}),__param(0x0,(0x0,common_1['Req'])()),__metadata(_0x217fce(0xae),Function),__metadata(_0x217fce(0xdf),[Object]),__metadata(_0x217fce(0xad),Promise)],VerificationController[_0x217fce(0xc7)],_0x217fce(0xd5),null),__decorate([(0x0,common_1[_0x217fce(0xa9)])(_0x217fce(0xb3)),(0x0,swagger_1[_0x217fce(0x9f)])({'summary':_0x217fce(0x93),'description':_0x217fce(0xe5)}),(0x0,swagger_1[_0x217fce(0xd1)])({'type':verifyCode_dto_1[_0x217fce(0xe2)]}),(0x0,swagger_1[_0x217fce(0xa1)])({'status':common_1[_0x217fce(0xb4)]['OK'],'description':_0x217fce(0xcf),'schema':{'type':_0x217fce(0xc1),'properties':{'success':{'type':_0x217fce(0xa5),'description':_0x217fce(0x95)},'message':{'type':_0x217fce(0xd6),'description':_0x217fce(0x8d)}}}}),(0x0,swagger_1['ApiResponse'])({'status':common_1[_0x217fce(0xb4)][_0x217fce(0xbc)],'description':_0x217fce(0xb1),'schema':{'type':_0x217fce(0xc1),'properties':{'message':{'type':_0x217fce(0xd6),'description':'错误信息'},'error':{'type':_0x217fce(0xd6),'description':'错误类型'},'statusCode':{'type':_0x217fce(0xdd),'description':_0x217fce(0xac)}}}}),__param(0x0,(0x0,common_1[_0x217fce(0x96)])()),__metadata('design:type',Function),__metadata(_0x217fce(0xdf),[verifyCode_dto_1[_0x217fce(0xe2)]]),__metadata(_0x217fce(0xad),Promise)],VerificationController['prototype'],_0x217fce(0x97),null),__decorate([(0x0,common_1[_0x217fce(0xa9)])(_0x217fce(0x9e)),(0x0,swagger_1['ApiOperation'])({'summary':_0x217fce(0xe7),'description':_0x217fce(0xe1)}),(0x0,swagger_1[_0x217fce(0xa1)])({'status':common_1[_0x217fce(0xb4)]['OK'],'description':_0x217fce(0xa8),'type':Boolean}),(0x0,swagger_1['ApiResponse'])({'status':common_1[_0x217fce(0xb4)][_0x217fce(0xbc)],'description':_0x217fce(0x9d)}),__param(0x0,(0x0,common_1['Body'])()),__metadata(_0x217fce(0xae),Function),__metadata(_0x217fce(0xdf),[Object]),__metadata(_0x217fce(0xad),Promise)],VerificationController[_0x217fce(0xc7)],_0x217fce(0xc3),null),__decorate([(0x0,common_1['Post'])(_0x217fce(0xc5)),(0x0,swagger_1['ApiOperation'])({'summary':_0x217fce(0x8a),'description':_0x217fce(0xdb)}),(0x0,swagger_1[_0x217fce(0xa1)])({'status':common_1[_0x217fce(0xb4)]['OK'],'description':_0x217fce(0xa8),'type':Boolean}),(0x0,swagger_1[_0x217fce(0xa1)])({'status':common_1[_0x217fce(0xb4)][_0x217fce(0xbc)],'description':'发送失败，可能是因为发送太频繁或参数错误'}),(0x0,common_1[_0x217fce(0xd2)])((0x0,passport_1['AuthGuard'])(_0x217fce(0x90))),(0x0,swagger_1[_0x217fce(0x8f)])(),__param(0x0,(0x0,common_1[_0x217fce(0x96)])()),__param(0x1,(0x0,common_1[_0x217fce(0xda)])()),__metadata('design:type',Function),__metadata('design:paramtypes',[Object,Object]),__metadata(_0x217fce(0xad),Promise)],VerificationController[_0x217fce(0xc7)],'sendEmailCode',null),VerificationController=__decorate([(0x0,swagger_1[_0x217fce(0xc4)])(_0x217fce(0xbb)),(0x0,common_1[_0x217fce(0x89)])('verification'),__metadata(_0x217fce(0xdf),[verification_service_1['VerificationService'],user_service_1['UserService'],globalConfig_service_1[_0x217fce(0xb6)]])],VerificationController),exports[_0x217fce(0x8c)]=VerificationController;