'use strict';const _0x2e0c7c=_0x947c;(function(_0x30e569,_0x5e4355){const _0x310f15=_0x947c,_0x239ed8=_0x30e569();while(!![]){try{const _0x50cee5=-parseInt(_0x310f15(0x136))/0x1*(parseInt(_0x310f15(0x140))/0x2)+parseInt(_0x310f15(0x113))/0x3*(-parseInt(_0x310f15(0x167))/0x4)+parseInt(_0x310f15(0x120))/0x5*(parseInt(_0x310f15(0x10a))/0x6)+-parseInt(_0x310f15(0x158))/0x7*(parseInt(_0x310f15(0x126))/0x8)+parseInt(_0x310f15(0x130))/0x9+-parseInt(_0x310f15(0x11c))/0xa*(parseInt(_0x310f15(0x14b))/0xb)+parseInt(_0x310f15(0x118))/0xc*(parseInt(_0x310f15(0x16c))/0xd);if(_0x50cee5===_0x5e4355)break;else _0x239ed8['push'](_0x239ed8['shift']());}catch(_0x22b8c0){_0x239ed8['push'](_0x239ed8['shift']());}}}(_0x155f,0xe840d));var __decorate=this&&this[_0x2e0c7c(0x12e)]||function(_0x1b3fc0,_0x356d52,_0x102fe2,_0x55bb2a){const _0x489a2d=_0x2e0c7c;var _0x563c5e=arguments[_0x489a2d(0x112)],_0x3bef37=_0x563c5e<0x3?_0x356d52:_0x55bb2a===null?_0x55bb2a=Object[_0x489a2d(0x110)](_0x356d52,_0x102fe2):_0x55bb2a,_0x5ed02e;if(typeof Reflect==='object'&&typeof Reflect[_0x489a2d(0x12c)]===_0x489a2d(0x169))_0x3bef37=Reflect['decorate'](_0x1b3fc0,_0x356d52,_0x102fe2,_0x55bb2a);else{for(var _0x4bc7d2=_0x1b3fc0[_0x489a2d(0x112)]-0x1;_0x4bc7d2>=0x0;_0x4bc7d2--)if(_0x5ed02e=_0x1b3fc0[_0x4bc7d2])_0x3bef37=(_0x563c5e<0x3?_0x5ed02e(_0x3bef37):_0x563c5e>0x3?_0x5ed02e(_0x356d52,_0x102fe2,_0x3bef37):_0x5ed02e(_0x356d52,_0x102fe2))||_0x3bef37;}return _0x563c5e>0x3&&_0x3bef37&&Object[_0x489a2d(0x163)](_0x356d52,_0x102fe2,_0x3bef37),_0x3bef37;},__metadata=this&&this[_0x2e0c7c(0x138)]||function(_0x1bdcbc,_0x551c5b){const _0x6bb467=_0x2e0c7c;if(typeof Reflect===_0x6bb467(0x12a)&&typeof Reflect['metadata']===_0x6bb467(0x169))return Reflect[_0x6bb467(0x123)](_0x1bdcbc,_0x551c5b);},__param=this&&this['__param']||function(_0x3d1716,_0x1567ac){return function(_0x414f0d,_0x1d00cd){_0x1567ac(_0x414f0d,_0x1d00cd,_0x3d1716);};};Object[_0x2e0c7c(0x163)](exports,_0x2e0c7c(0x161),{'value':!![]}),exports['VerificationController']=void 0x0;function _0x947c(_0x440441,_0x5bd3ee){const _0x155f86=_0x155f();return _0x947c=function(_0x947c36,_0xb46750){_0x947c36=_0x947c36-0x10a;let _0x1a265e=_0x155f86[_0x947c36];return _0x1a265e;},_0x947c(_0x440441,_0x5bd3ee);}const common_1=require(_0x2e0c7c(0x13a)),swagger_1=require(_0x2e0c7c(0x12b)),verification_service_1=require('./verification.service'),verification_constant_1=require(_0x2e0c7c(0x11d)),passport_1=require(_0x2e0c7c(0x129)),user_service_1=require('../user/user.service'),verifyCode_dto_1=require('./dto/verifyCode.dto'),globalConfig_service_1=require(_0x2e0c7c(0x168)),common_2=require(_0x2e0c7c(0x13a));function _0x155f(){const _0x1517ac=['createVerification','发送邮箱验证码（换绑邮箱），验证码30分钟内有效。同一邮箱1分钟内只能发送一次。','722868ipVhkm','验证码','third-party/generate','验证码验证成功','VerifyCodeDto','thirdPartyAuthExpir','验证用户提供的第三方应用认证码是否有效','HttpException','ApiResponse','验证码ID','verification','8587568Gmeeog','Registration','发送失败，可能是因为发送太频繁或参数错误','jwt','不支持的验证码类型','date-time','design:paramtypes','发送短信验证码（注册或重置密码），验证码5分钟内有效。同一手机号1分钟内只能发送一次。','design:returntype','发送短信验证码','验证码类型','userService','code','3257870fQmGVH','getUserById','number','状态码','verificationService','design:type','sendPhoneCode','boolean','third-party/verify','__esModule','UseGuards','defineProperty','ApiBearerAuth','用户ID','验证码无效或已过期','9244TmpFuW','../globalConfig/globalConfig.service','function','验证码发送成功','Body','13xBsOFI','VerificationController','AuthGuard','HttpStatus','30VCwbkh','BAD_REQUEST','string','生成第三方应用认证验证码','JWT认证失败','Controller','getOwnPropertyDescriptor','assign','length','1671MPUsRI','prototype','user','email','ApiBody','40952472YMRHZC','ApiTags','send-email','验证第三方应用认证码','10zZwTTW','../../common/constants/verification.constant','sendSmsCode','生成一个用于第三方应用认证的验证码，需要JWT认证。验证码默认1分钟后过期。','38735xdJdls','UNAUTHORIZED','ChangeEmail','metadata','过期时间','Post','8blZhSW','GlobalConfigService','getConfigs','@nestjs/passport','object','@nestjs/swagger','decorate','Req','__decorate','ApiOperation','10057455qvObbN','UserService','错误类型','verifyThirdPartyCode','ThirdPartyAuth','sendEmailCode','3hDagms','PasswordReset','__metadata','generateThirdPartyCode','@nestjs/common','是否已使用，0未使用，1已使用','VerificationEnum','验证码生成成功'];_0x155f=function(){return _0x1517ac;};return _0x155f();}let VerificationController=class VerificationController{constructor(_0x5c86bb,_0x21c19b,_0x43cf65){const _0xa486a2=_0x2e0c7c;this['verificationService']=_0x5c86bb,this[_0xa486a2(0x156)]=_0x21c19b,this['globalConfigService']=_0x43cf65;}async[_0x2e0c7c(0x139)](_0x23dbc4){const _0x20d60d=_0x2e0c7c,_0x1b836f=_0x23dbc4[_0x20d60d(0x115)]['id'],_0x1ba2dd=await this[_0x20d60d(0x156)][_0x20d60d(0x159)](_0x1b836f),_0xf4c21a=await this['globalConfigService'][_0x20d60d(0x128)]([_0x20d60d(0x145)]),_0x3abd4e=_0xf4c21a['thirdPartyAuthExpir']?Number(_0xf4c21a[_0x20d60d(0x145)]):0x3c;return await this[_0x20d60d(0x15c)]['createVerification'](_0x1ba2dd,verification_constant_1['VerificationEnum'][_0x20d60d(0x134)],_0x3abd4e);}async[_0x2e0c7c(0x133)](_0x2dbce9){const _0x22e559=_0x2e0c7c,_0x9a1337={'id':_0x2dbce9['id'],'code':Number(_0x2dbce9[_0x22e559(0x157)])};return await this[_0x22e559(0x15c)]['verifyCode'](_0x9a1337,verification_constant_1[_0x22e559(0x13c)][_0x22e559(0x134)]);}async[_0x2e0c7c(0x11e)](_0xd6f7c5){const _0x27dda3=_0x2e0c7c,{phone:_0x5bb703,type:_0x2b3e9a}=_0xd6f7c5;if(_0x2b3e9a!==verification_constant_1[_0x27dda3(0x13c)][_0x27dda3(0x14c)]&&_0x2b3e9a!==verification_constant_1[_0x27dda3(0x13c)][_0x27dda3(0x137)])throw new common_2[(_0x27dda3(0x147))](_0x27dda3(0x14f),common_1[_0x27dda3(0x16f)][_0x27dda3(0x10b)]);const _0x17c19c={'id':0x0,'email':'','phone':_0x5bb703},_0x4be637=await this[_0x27dda3(0x15c)][_0x27dda3(0x13e)](_0x17c19c,_0x2b3e9a);return await this['verificationService'][_0x27dda3(0x15e)]({'phone':_0x5bb703,'code':_0x4be637[_0x27dda3(0x157)]});}async[_0x2e0c7c(0x135)](_0x5436c4,_0x3ce7a1){const _0x49db38=_0x2e0c7c,_0x46731e=_0x3ce7a1[_0x49db38(0x115)]['id'],_0x607c6d=await this[_0x49db38(0x156)]['getUserById'](_0x46731e),_0x1c22f5=await this[_0x49db38(0x15c)]['createVerification'](Object['assign'](Object[_0x49db38(0x111)]({},_0x607c6d),{'email':_0x5436c4[_0x49db38(0x116)]}),verification_constant_1[_0x49db38(0x13c)][_0x49db38(0x122)]);return await this['verificationService'][_0x49db38(0x135)]({'email':_0x5436c4[_0x49db38(0x116)],'code':_0x1c22f5[_0x49db38(0x157)]});}};__decorate([(0x0,common_1['Post'])(_0x2e0c7c(0x142)),(0x0,common_1[_0x2e0c7c(0x162)])((0x0,passport_1[_0x2e0c7c(0x16e)])(_0x2e0c7c(0x14e))),(0x0,swagger_1[_0x2e0c7c(0x164)])(),(0x0,swagger_1[_0x2e0c7c(0x12f)])({'summary':_0x2e0c7c(0x10d),'description':_0x2e0c7c(0x11f)}),(0x0,swagger_1['ApiResponse'])({'status':common_1[_0x2e0c7c(0x16f)]['OK'],'description':_0x2e0c7c(0x13d),'schema':{'type':'object','properties':{'id':{'type':_0x2e0c7c(0x15a),'description':_0x2e0c7c(0x149)},'code':{'type':'number','description':_0x2e0c7c(0x141)},'userId':{'type':_0x2e0c7c(0x15a),'description':_0x2e0c7c(0x165)},'type':{'type':_0x2e0c7c(0x15a),'description':_0x2e0c7c(0x155)},'expiresAt':{'type':_0x2e0c7c(0x10c),'format':_0x2e0c7c(0x150),'description':_0x2e0c7c(0x124)},'used':{'type':_0x2e0c7c(0x15a),'description':_0x2e0c7c(0x13b)}}}}),(0x0,swagger_1[_0x2e0c7c(0x148)])({'status':common_1[_0x2e0c7c(0x16f)][_0x2e0c7c(0x121)],'description':_0x2e0c7c(0x10e)}),__param(0x0,(0x0,common_1[_0x2e0c7c(0x12d)])()),__metadata(_0x2e0c7c(0x15d),Function),__metadata(_0x2e0c7c(0x151),[Object]),__metadata(_0x2e0c7c(0x153),Promise)],VerificationController['prototype'],_0x2e0c7c(0x139),null),__decorate([(0x0,common_1[_0x2e0c7c(0x125)])(_0x2e0c7c(0x160)),(0x0,swagger_1['ApiOperation'])({'summary':_0x2e0c7c(0x11b),'description':_0x2e0c7c(0x146)}),(0x0,swagger_1[_0x2e0c7c(0x117)])({'type':verifyCode_dto_1[_0x2e0c7c(0x144)]}),(0x0,swagger_1[_0x2e0c7c(0x148)])({'status':common_1['HttpStatus']['OK'],'description':_0x2e0c7c(0x143),'schema':{'type':_0x2e0c7c(0x12a),'properties':{'success':{'type':_0x2e0c7c(0x15f),'description':'验证是否成功'},'message':{'type':_0x2e0c7c(0x10c),'description':'验证结果消息'}}}}),(0x0,swagger_1[_0x2e0c7c(0x148)])({'status':common_1['HttpStatus'][_0x2e0c7c(0x10b)],'description':_0x2e0c7c(0x166),'schema':{'type':_0x2e0c7c(0x12a),'properties':{'message':{'type':_0x2e0c7c(0x10c),'description':'错误信息'},'error':{'type':_0x2e0c7c(0x10c),'description':_0x2e0c7c(0x132)},'statusCode':{'type':_0x2e0c7c(0x15a),'description':_0x2e0c7c(0x15b)}}}}),__param(0x0,(0x0,common_1[_0x2e0c7c(0x16b)])()),__metadata(_0x2e0c7c(0x15d),Function),__metadata(_0x2e0c7c(0x151),[verifyCode_dto_1[_0x2e0c7c(0x144)]]),__metadata(_0x2e0c7c(0x153),Promise)],VerificationController[_0x2e0c7c(0x114)],_0x2e0c7c(0x133),null),__decorate([(0x0,common_1['Post'])('send-sms'),(0x0,swagger_1[_0x2e0c7c(0x12f)])({'summary':_0x2e0c7c(0x154),'description':_0x2e0c7c(0x152)}),(0x0,swagger_1[_0x2e0c7c(0x148)])({'status':common_1[_0x2e0c7c(0x16f)]['OK'],'description':_0x2e0c7c(0x16a),'type':Boolean}),(0x0,swagger_1[_0x2e0c7c(0x148)])({'status':common_1[_0x2e0c7c(0x16f)][_0x2e0c7c(0x10b)],'description':'发送失败，可能是因为发送太频繁或参数错误'}),__param(0x0,(0x0,common_1[_0x2e0c7c(0x16b)])()),__metadata('design:type',Function),__metadata(_0x2e0c7c(0x151),[Object]),__metadata(_0x2e0c7c(0x153),Promise)],VerificationController['prototype'],_0x2e0c7c(0x11e),null),__decorate([(0x0,common_1[_0x2e0c7c(0x125)])(_0x2e0c7c(0x11a)),(0x0,swagger_1[_0x2e0c7c(0x12f)])({'summary':'发送邮箱验证码','description':_0x2e0c7c(0x13f)}),(0x0,swagger_1[_0x2e0c7c(0x148)])({'status':common_1[_0x2e0c7c(0x16f)]['OK'],'description':_0x2e0c7c(0x16a),'type':Boolean}),(0x0,swagger_1['ApiResponse'])({'status':common_1[_0x2e0c7c(0x16f)][_0x2e0c7c(0x10b)],'description':_0x2e0c7c(0x14d)}),(0x0,common_1[_0x2e0c7c(0x162)])((0x0,passport_1[_0x2e0c7c(0x16e)])(_0x2e0c7c(0x14e))),(0x0,swagger_1[_0x2e0c7c(0x164)])(),__param(0x0,(0x0,common_1['Body'])()),__param(0x1,(0x0,common_1['Req'])()),__metadata('design:type',Function),__metadata(_0x2e0c7c(0x151),[Object,Object]),__metadata(_0x2e0c7c(0x153),Promise)],VerificationController[_0x2e0c7c(0x114)],_0x2e0c7c(0x135),null),VerificationController=__decorate([(0x0,swagger_1[_0x2e0c7c(0x119)])('验证码'),(0x0,common_1[_0x2e0c7c(0x10f)])(_0x2e0c7c(0x14a)),__metadata(_0x2e0c7c(0x151),[verification_service_1['VerificationService'],user_service_1[_0x2e0c7c(0x131)],globalConfig_service_1[_0x2e0c7c(0x127)]])],VerificationController),exports[_0x2e0c7c(0x16d)]=VerificationController;