'use strict';const _0x52f92a=_0x23c0;(function(_0x16794d,_0x2284bd){const _0x11af62=_0x23c0,_0x106eae=_0x16794d();while(!![]){try{const _0x4c18f9=-parseInt(_0x11af62(0xe1))/0x1+parseInt(_0x11af62(0xbf))/0x2+-parseInt(_0x11af62(0xa4))/0x3*(-parseInt(_0x11af62(0xc8))/0x4)+parseInt(_0x11af62(0xc7))/0x5+-parseInt(_0x11af62(0x9e))/0x6+parseInt(_0x11af62(0xd2))/0x7+parseInt(_0x11af62(0xa8))/0x8*(-parseInt(_0x11af62(0xd3))/0x9);if(_0x4c18f9===_0x2284bd)break;else _0x106eae['push'](_0x106eae['shift']());}catch(_0x52acc5){_0x106eae['push'](_0x106eae['shift']());}}}(_0x5689,0x9b9f6));function _0x23c0(_0x141eea,_0x399baf){const _0x568932=_0x5689();return _0x23c0=function(_0x23c00e,_0x284aed){_0x23c00e=_0x23c00e-0x94;let _0x21b4eb=_0x568932[_0x23c00e];return _0x21b4eb;},_0x23c0(_0x141eea,_0x399baf);}function _0x5689(){const _0x14f1c3=['生成一个用于第三方应用认证的验证码，需要JWT认证。验证码默认1分钟后过期。','错误信息','ApiOperation','@nestjs/passport','user','AuthGuard','Post','assign','object','__esModule','BAD_REQUEST','generateThirdPartyCode','__decorate','HttpException','验证码生成成功','2445816jWfCtY','验证码','UseGuards','verifyThirdPartyCode','metadata','defineProperty','@nestjs/common','ApiBearerAuth','2933060ailZZe','4124GlFLqR','./verification.service','third-party/verify','__param','验证码类型','ApiTags','getUserById','verificationService','../globalConfig/globalConfig.service','../user/user.service','553315gunlEI','163062NalYDq','design:returntype','number','GlobalConfigService','sendSmsCode','thirdPartyAuthExpir','JWT认证失败','发送失败，可能是因为发送太频繁或参数错误','globalConfigService','jwt','VerificationEnum','发送邮箱验证码（换绑邮箱），验证码30分钟内有效。同一邮箱1分钟内只能发送一次。','decorate','design:paramtypes','536792ozluKX','prototype','sendPhoneCode','send-sms','验证码验证成功','VerificationController','send-email','createVerification','verifyCode','function','用户ID','发送短信验证码（注册或重置密码），验证码5分钟内有效。同一手机号1分钟内只能发送一次。','boolean','UserService','Body','是否已使用，0未使用，1已使用','ApiResponse','ThirdPartyAuth','状态码','HttpStatus','email','过期时间','验证结果消息','验证用户提供的第三方应用认证码是否有效','VerifyCodeDto','验证第三方应用认证码','length','1347084GsuupS','Controller','生成第三方应用认证验证码','验证码ID','验证码发送成功','发送短信验证码','1527DnbAWN','UNAUTHORIZED','design:type','code','448fsShal','Req','sendEmailCode','userService','@nestjs/swagger','verification','string','验证码无效或已过期'];_0x5689=function(){return _0x14f1c3;};return _0x5689();}var __decorate=this&&this[_0x52f92a(0xbc)]||function(_0x791953,_0x5ed927,_0x537c53,_0x4b6ad0){const _0x513984=_0x52f92a;var _0x2f3940=arguments['length'],_0x333e97=_0x2f3940<0x3?_0x5ed927:_0x4b6ad0===null?_0x4b6ad0=Object['getOwnPropertyDescriptor'](_0x5ed927,_0x537c53):_0x4b6ad0,_0x21222b;if(typeof Reflect===_0x513984(0xb8)&&typeof Reflect[_0x513984(0xdf)]===_0x513984(0xea))_0x333e97=Reflect[_0x513984(0xdf)](_0x791953,_0x5ed927,_0x537c53,_0x4b6ad0);else{for(var _0x3eae06=_0x791953[_0x513984(0x9d)]-0x1;_0x3eae06>=0x0;_0x3eae06--)if(_0x21222b=_0x791953[_0x3eae06])_0x333e97=(_0x2f3940<0x3?_0x21222b(_0x333e97):_0x2f3940>0x3?_0x21222b(_0x5ed927,_0x537c53,_0x333e97):_0x21222b(_0x5ed927,_0x537c53))||_0x333e97;}return _0x2f3940>0x3&&_0x333e97&&Object[_0x513984(0xc4)](_0x5ed927,_0x537c53,_0x333e97),_0x333e97;},__metadata=this&&this['__metadata']||function(_0x86c1bb,_0x376c6c){const _0x4fcba4=_0x52f92a;if(typeof Reflect===_0x4fcba4(0xb8)&&typeof Reflect[_0x4fcba4(0xc3)]===_0x4fcba4(0xea))return Reflect['metadata'](_0x86c1bb,_0x376c6c);},__param=this&&this[_0x52f92a(0xcb)]||function(_0x122953,_0x47ccf6){return function(_0x37cf1a,_0x16ee05){_0x47ccf6(_0x37cf1a,_0x16ee05,_0x122953);};};Object[_0x52f92a(0xc4)](exports,_0x52f92a(0xb9),{'value':!![]}),exports[_0x52f92a(0xe6)]=void 0x0;const common_1=require(_0x52f92a(0xc5)),swagger_1=require(_0x52f92a(0xac)),verification_service_1=require(_0x52f92a(0xc9)),verification_constant_1=require('../../common/constants/verification.constant'),passport_1=require(_0x52f92a(0xb3)),user_service_1=require(_0x52f92a(0xd1)),verifyCode_dto_1=require('./dto/verifyCode.dto'),globalConfig_service_1=require(_0x52f92a(0xd0)),common_2=require(_0x52f92a(0xc5));let VerificationController=class VerificationController{constructor(_0x2ed85f,_0x488f3a,_0x2340ab){const _0x369bc0=_0x52f92a;this[_0x369bc0(0xcf)]=_0x2ed85f,this[_0x369bc0(0xab)]=_0x488f3a,this[_0x369bc0(0xdb)]=_0x2340ab;}async[_0x52f92a(0xbb)](_0x4c8047){const _0x1745cd=_0x52f92a,_0x4a7b60=_0x4c8047['user']['id'],_0x5a9d40=await this[_0x1745cd(0xab)][_0x1745cd(0xce)](_0x4a7b60),_0x1c718e=await this['globalConfigService']['getConfigs'](['thirdPartyAuthExpir']),_0x2253cb=_0x1c718e['thirdPartyAuthExpir']?Number(_0x1c718e[_0x1745cd(0xd8)]):0x3c;return await this['verificationService'][_0x1745cd(0xe8)](_0x5a9d40,verification_constant_1[_0x1745cd(0xdd)]['ThirdPartyAuth'],_0x2253cb);}async[_0x52f92a(0xc2)](_0x44ba08){const _0x1d28a0=_0x52f92a,_0x219fe4={'id':_0x44ba08['id'],'code':Number(_0x44ba08[_0x1d28a0(0xa7)])};return await this[_0x1d28a0(0xcf)][_0x1d28a0(0xe9)](_0x219fe4,verification_constant_1[_0x1d28a0(0xdd)][_0x1d28a0(0x94)]);}async[_0x52f92a(0xd7)](_0x58cbe2){const _0x24770d=_0x52f92a,{phone:_0x4f9458,type:_0x32ff0a}=_0x58cbe2;if(_0x32ff0a!==verification_constant_1['VerificationEnum']['Registration']&&_0x32ff0a!==verification_constant_1['VerificationEnum']['PasswordReset'])throw new common_2[(_0x24770d(0xbd))]('不支持的验证码类型',common_1[_0x24770d(0x96)][_0x24770d(0xba)]);const _0x4dbd25={'id':0x0,'email':'','phone':_0x4f9458},_0xc5daff=await this['verificationService'][_0x24770d(0xe8)](_0x4dbd25,_0x32ff0a);return await this[_0x24770d(0xcf)][_0x24770d(0xe3)]({'phone':_0x4f9458,'code':_0xc5daff[_0x24770d(0xa7)]});}async['sendEmailCode'](_0x2f7ff1,_0x5267a5){const _0x240dd9=_0x52f92a,_0x4502ae=_0x5267a5[_0x240dd9(0xb4)]['id'],_0x5ea438=await this[_0x240dd9(0xab)][_0x240dd9(0xce)](_0x4502ae),_0xd8dc82=await this['verificationService'][_0x240dd9(0xe8)](Object[_0x240dd9(0xb7)](Object[_0x240dd9(0xb7)]({},_0x5ea438),{'email':_0x2f7ff1['email']}),verification_constant_1[_0x240dd9(0xdd)]['ChangeEmail']);return await this[_0x240dd9(0xcf)][_0x240dd9(0xaa)]({'email':_0x2f7ff1[_0x240dd9(0x97)],'code':_0xd8dc82[_0x240dd9(0xa7)]});}};__decorate([(0x0,common_1['Post'])('third-party/generate'),(0x0,common_1[_0x52f92a(0xc1)])((0x0,passport_1['AuthGuard'])(_0x52f92a(0xdc))),(0x0,swagger_1[_0x52f92a(0xc6)])(),(0x0,swagger_1['ApiOperation'])({'summary':_0x52f92a(0xa0),'description':_0x52f92a(0xb0)}),(0x0,swagger_1[_0x52f92a(0xf1)])({'status':common_1[_0x52f92a(0x96)]['OK'],'description':_0x52f92a(0xbe),'schema':{'type':_0x52f92a(0xb8),'properties':{'id':{'type':_0x52f92a(0xd5),'description':_0x52f92a(0xa1)},'code':{'type':'number','description':_0x52f92a(0xc0)},'userId':{'type':_0x52f92a(0xd5),'description':_0x52f92a(0xeb)},'type':{'type':'number','description':_0x52f92a(0xcc)},'expiresAt':{'type':_0x52f92a(0xae),'format':'date-time','description':_0x52f92a(0x98)},'used':{'type':_0x52f92a(0xd5),'description':_0x52f92a(0xf0)}}}}),(0x0,swagger_1[_0x52f92a(0xf1)])({'status':common_1['HttpStatus'][_0x52f92a(0xa5)],'description':_0x52f92a(0xd9)}),__param(0x0,(0x0,common_1[_0x52f92a(0xa9)])()),__metadata(_0x52f92a(0xa6),Function),__metadata('design:paramtypes',[Object]),__metadata(_0x52f92a(0xd4),Promise)],VerificationController['prototype'],'generateThirdPartyCode',null),__decorate([(0x0,common_1[_0x52f92a(0xb6)])(_0x52f92a(0xca)),(0x0,swagger_1[_0x52f92a(0xb2)])({'summary':_0x52f92a(0x9c),'description':_0x52f92a(0x9a)}),(0x0,swagger_1['ApiBody'])({'type':verifyCode_dto_1[_0x52f92a(0x9b)]}),(0x0,swagger_1['ApiResponse'])({'status':common_1['HttpStatus']['OK'],'description':_0x52f92a(0xe5),'schema':{'type':_0x52f92a(0xb8),'properties':{'success':{'type':_0x52f92a(0xed),'description':'验证是否成功'},'message':{'type':'string','description':_0x52f92a(0x99)}}}}),(0x0,swagger_1[_0x52f92a(0xf1)])({'status':common_1[_0x52f92a(0x96)]['BAD_REQUEST'],'description':_0x52f92a(0xaf),'schema':{'type':_0x52f92a(0xb8),'properties':{'message':{'type':_0x52f92a(0xae),'description':_0x52f92a(0xb1)},'error':{'type':'string','description':'错误类型'},'statusCode':{'type':_0x52f92a(0xd5),'description':_0x52f92a(0x95)}}}}),__param(0x0,(0x0,common_1[_0x52f92a(0xef)])()),__metadata(_0x52f92a(0xa6),Function),__metadata(_0x52f92a(0xe0),[verifyCode_dto_1[_0x52f92a(0x9b)]]),__metadata(_0x52f92a(0xd4),Promise)],VerificationController[_0x52f92a(0xe2)],_0x52f92a(0xc2),null),__decorate([(0x0,common_1[_0x52f92a(0xb6)])(_0x52f92a(0xe4)),(0x0,swagger_1[_0x52f92a(0xb2)])({'summary':_0x52f92a(0xa3),'description':_0x52f92a(0xec)}),(0x0,swagger_1[_0x52f92a(0xf1)])({'status':common_1[_0x52f92a(0x96)]['OK'],'description':_0x52f92a(0xa2),'type':Boolean}),(0x0,swagger_1[_0x52f92a(0xf1)])({'status':common_1[_0x52f92a(0x96)][_0x52f92a(0xba)],'description':_0x52f92a(0xda)}),__param(0x0,(0x0,common_1[_0x52f92a(0xef)])()),__metadata(_0x52f92a(0xa6),Function),__metadata(_0x52f92a(0xe0),[Object]),__metadata(_0x52f92a(0xd4),Promise)],VerificationController[_0x52f92a(0xe2)],_0x52f92a(0xd7),null),__decorate([(0x0,common_1[_0x52f92a(0xb6)])(_0x52f92a(0xe7)),(0x0,swagger_1[_0x52f92a(0xb2)])({'summary':'发送邮箱验证码','description':_0x52f92a(0xde)}),(0x0,swagger_1[_0x52f92a(0xf1)])({'status':common_1[_0x52f92a(0x96)]['OK'],'description':'验证码发送成功','type':Boolean}),(0x0,swagger_1['ApiResponse'])({'status':common_1[_0x52f92a(0x96)][_0x52f92a(0xba)],'description':_0x52f92a(0xda)}),(0x0,common_1[_0x52f92a(0xc1)])((0x0,passport_1[_0x52f92a(0xb5)])(_0x52f92a(0xdc))),(0x0,swagger_1[_0x52f92a(0xc6)])(),__param(0x0,(0x0,common_1['Body'])()),__param(0x1,(0x0,common_1[_0x52f92a(0xa9)])()),__metadata(_0x52f92a(0xa6),Function),__metadata(_0x52f92a(0xe0),[Object,Object]),__metadata('design:returntype',Promise)],VerificationController[_0x52f92a(0xe2)],_0x52f92a(0xaa),null),VerificationController=__decorate([(0x0,swagger_1[_0x52f92a(0xcd)])(_0x52f92a(0xc0)),(0x0,common_1[_0x52f92a(0x9f)])(_0x52f92a(0xad)),__metadata(_0x52f92a(0xe0),[verification_service_1['VerificationService'],user_service_1[_0x52f92a(0xee)],globalConfig_service_1[_0x52f92a(0xd6)]])],VerificationController),exports[_0x52f92a(0xe6)]=VerificationController;