'use strict';const _0x16936e=_0x2b24;function _0x2b24(_0x3f063d,_0x3943c3){const _0x4b620b=_0x4b62();return _0x2b24=function(_0x2b246d,_0x406843){_0x2b246d=_0x2b246d-0x157;let _0x538bb2=_0x4b620b[_0x2b246d];return _0x538bb2;},_0x2b24(_0x3f063d,_0x3943c3);}(function(_0x552f33,_0x1cc59d){const _0x5313e1=_0x2b24,_0x2c881e=_0x552f33();while(!![]){try{const _0x24d1ca=-parseInt(_0x5313e1(0x157))/0x1*(parseInt(_0x5313e1(0x1b2))/0x2)+-parseInt(_0x5313e1(0x17f))/0x3*(parseInt(_0x5313e1(0x1a9))/0x4)+parseInt(_0x5313e1(0x181))/0x5*(-parseInt(_0x5313e1(0x184))/0x6)+-parseInt(_0x5313e1(0x179))/0x7*(-parseInt(_0x5313e1(0x176))/0x8)+parseInt(_0x5313e1(0x188))/0x9*(-parseInt(_0x5313e1(0x1b5))/0xa)+parseInt(_0x5313e1(0x167))/0xb*(-parseInt(_0x5313e1(0x186))/0xc)+-parseInt(_0x5313e1(0x1a7))/0xd*(-parseInt(_0x5313e1(0x1b4))/0xe);if(_0x24d1ca===_0x1cc59d)break;else _0x2c881e['push'](_0x2c881e['shift']());}catch(_0x2abffb){_0x2c881e['push'](_0x2c881e['shift']());}}}(_0x4b62,0xf2f6e));var __decorate=this&&this[_0x16936e(0x160)]||function(_0x2ae327,_0x2577b2,_0x2aeda7,_0x758c6){const _0x417f56=_0x16936e;var _0x216bcf=arguments[_0x417f56(0x174)],_0x27e3df=_0x216bcf<0x3?_0x2577b2:_0x758c6===null?_0x758c6=Object[_0x417f56(0x194)](_0x2577b2,_0x2aeda7):_0x758c6,_0x35975a;if(typeof Reflect==='object'&&typeof Reflect[_0x417f56(0x1b3)]===_0x417f56(0x17d))_0x27e3df=Reflect[_0x417f56(0x1b3)](_0x2ae327,_0x2577b2,_0x2aeda7,_0x758c6);else{for(var _0x3018c0=_0x2ae327[_0x417f56(0x174)]-0x1;_0x3018c0>=0x0;_0x3018c0--)if(_0x35975a=_0x2ae327[_0x3018c0])_0x27e3df=(_0x216bcf<0x3?_0x35975a(_0x27e3df):_0x216bcf>0x3?_0x35975a(_0x2577b2,_0x2aeda7,_0x27e3df):_0x35975a(_0x2577b2,_0x2aeda7))||_0x27e3df;}return _0x216bcf>0x3&&_0x27e3df&&Object[_0x417f56(0x19b)](_0x2577b2,_0x2aeda7,_0x27e3df),_0x27e3df;},__metadata=this&&this[_0x16936e(0x158)]||function(_0x180c72,_0x3a6e42){const _0x1fd90c=_0x16936e;if(typeof Reflect===_0x1fd90c(0x18a)&&typeof Reflect[_0x1fd90c(0x16d)]===_0x1fd90c(0x17d))return Reflect['metadata'](_0x180c72,_0x3a6e42);},__param=this&&this[_0x16936e(0x17c)]||function(_0x25fded,_0x16b5bd){return function(_0x31d887,_0x43919a){_0x16b5bd(_0x31d887,_0x43919a,_0x25fded);};};Object[_0x16936e(0x19b)](exports,'__esModule',{'value':!![]}),exports[_0x16936e(0x168)]=void 0x0;const common_1=require(_0x16936e(0x18e)),swagger_1=require(_0x16936e(0x17a)),verification_service_1=require(_0x16936e(0x15f)),verification_constant_1=require('../../common/constants/verification.constant'),passport_1=require(_0x16936e(0x187)),user_service_1=require(_0x16936e(0x19e)),verifyCode_dto_1=require(_0x16936e(0x19a)),globalConfig_service_1=require('../globalConfig/globalConfig.service'),common_2=require(_0x16936e(0x18e));function _0x4b62(){const _0x443141=['验证码无效或已过期','ApiTags','prototype','是否已使用，0未使用，1已使用','7LJREuH','__metadata','UserService','Req','ThirdPartyAuth','HttpStatus','user','jwt','./verification.service','__decorate','getConfigs','sendEmailCode','JWT认证失败','third-party/verify','Body','generateThirdPartyCode','121SWQeKd','VerificationController','GlobalConfigService','code','Post','验证用户提供的第三方应用认证码是否有效','metadata','生成第三方应用认证验证码','ApiOperation','ApiBearerAuth','验证码发送成功','发送短信验证码','sendSmsCode','length','AuthGuard','568952XzVXMe','PasswordReset','number','28ppLTjE','@nestjs/swagger','验证第三方应用认证码','__param','function','verificationService','104721Ysnlps','createVerification','405HDElCR','用户ID','userService','117042wwVfgW','sendPhoneCode','1994796nDstAn','@nestjs/passport','9HYfeAx','验证是否成功','object','VerificationEnum','UNAUTHORIZED','VerifyCodeDto','@nestjs/common','verifyCode','design:returntype','BAD_REQUEST','ChangeEmail','getUserById','getOwnPropertyDescriptor','UseGuards','错误信息','boolean','ApiResponse','send-sms','./dto/verifyCode.dto','defineProperty','string','design:paramtypes','../user/user.service','thirdPartyAuthExpir','send-email','date-time','过期时间','globalConfigService','错误类型','Controller','ApiBody','52EKFKRd','验证码ID','100EXmiiy','verifyThirdPartyCode','third-party/generate','验证结果消息','发送邮箱验证码（换绑邮箱），验证码30分钟内有效。同一邮箱1分钟内只能发送一次。','email','生成一个用于第三方应用认证的验证码，需要JWT认证。验证码默认1分钟后过期。','design:type','验证码','240988KRxItN','decorate','24089716jqftDk','10473070CeUgMV'];_0x4b62=function(){return _0x443141;};return _0x4b62();}let VerificationController=class VerificationController{constructor(_0x451919,_0x3f5ff9,_0x40a824){const _0x4a38ba=_0x16936e;this[_0x4a38ba(0x17e)]=_0x451919,this['userService']=_0x3f5ff9,this[_0x4a38ba(0x1a3)]=_0x40a824;}async[_0x16936e(0x166)](_0x1251a5){const _0x5a0076=_0x16936e,_0x2b459f=_0x1251a5[_0x5a0076(0x15d)]['id'],_0x3dda0f=await this[_0x5a0076(0x183)][_0x5a0076(0x193)](_0x2b459f),_0x1e3461=await this['globalConfigService'][_0x5a0076(0x161)](['thirdPartyAuthExpir']),_0x5d0fe1=_0x1e3461[_0x5a0076(0x19f)]?Number(_0x1e3461[_0x5a0076(0x19f)]):0x3c;return await this['verificationService'][_0x5a0076(0x180)](_0x3dda0f,verification_constant_1[_0x5a0076(0x18b)][_0x5a0076(0x15b)],_0x5d0fe1);}async[_0x16936e(0x1aa)](_0x32fae6){const _0x30da0f=_0x16936e,_0x9db45e={'id':_0x32fae6['id'],'code':Number(_0x32fae6[_0x30da0f(0x16a)])};return await this[_0x30da0f(0x17e)][_0x30da0f(0x18f)](_0x9db45e,verification_constant_1['VerificationEnum'][_0x30da0f(0x15b)]);}async['sendSmsCode'](_0x59b3cb){const _0x51bfec=_0x16936e,{phone:_0x55a6d1,type:_0x5778f7}=_0x59b3cb;if(_0x5778f7!==verification_constant_1[_0x51bfec(0x18b)]['Registration']&&_0x5778f7!==verification_constant_1[_0x51bfec(0x18b)][_0x51bfec(0x177)])throw new common_2['HttpException']('不支持的验证码类型',common_1[_0x51bfec(0x15c)]['BAD_REQUEST']);const _0x5130ec={'id':0x0,'email':'','phone':_0x55a6d1},_0x3968e3=await this[_0x51bfec(0x17e)][_0x51bfec(0x180)](_0x5130ec,_0x5778f7);return await this[_0x51bfec(0x17e)][_0x51bfec(0x185)]({'phone':_0x55a6d1,'code':_0x3968e3['code']});}async[_0x16936e(0x162)](_0x10c78d,_0x160d56){const _0x7cb585=_0x16936e,_0x2fdb92=_0x160d56[_0x7cb585(0x15d)]['id'],_0xefa435=await this[_0x7cb585(0x183)]['getUserById'](_0x2fdb92),_0x2b35ce=await this[_0x7cb585(0x17e)]['createVerification'](Object['assign'](Object['assign']({},_0xefa435),{'email':_0x10c78d['email']}),verification_constant_1[_0x7cb585(0x18b)][_0x7cb585(0x192)]);return await this[_0x7cb585(0x17e)][_0x7cb585(0x162)]({'email':_0x10c78d[_0x7cb585(0x1ae)],'code':_0x2b35ce[_0x7cb585(0x16a)]});}};__decorate([(0x0,common_1['Post'])(_0x16936e(0x1ab)),(0x0,common_1[_0x16936e(0x195)])((0x0,passport_1[_0x16936e(0x175)])('jwt')),(0x0,swagger_1[_0x16936e(0x170)])(),(0x0,swagger_1['ApiOperation'])({'summary':_0x16936e(0x16e),'description':_0x16936e(0x1af)}),(0x0,swagger_1[_0x16936e(0x198)])({'status':common_1['HttpStatus']['OK'],'description':'验证码生成成功','schema':{'type':_0x16936e(0x18a),'properties':{'id':{'type':_0x16936e(0x178),'description':_0x16936e(0x1a8)},'code':{'type':'number','description':_0x16936e(0x1b1)},'userId':{'type':_0x16936e(0x178),'description':_0x16936e(0x182)},'type':{'type':'number','description':'验证码类型'},'expiresAt':{'type':'string','format':_0x16936e(0x1a1),'description':_0x16936e(0x1a2)},'used':{'type':_0x16936e(0x178),'description':_0x16936e(0x1b9)}}}}),(0x0,swagger_1['ApiResponse'])({'status':common_1['HttpStatus'][_0x16936e(0x18c)],'description':_0x16936e(0x163)}),__param(0x0,(0x0,common_1[_0x16936e(0x15a)])()),__metadata('design:type',Function),__metadata(_0x16936e(0x19d),[Object]),__metadata(_0x16936e(0x190),Promise)],VerificationController[_0x16936e(0x1b8)],'generateThirdPartyCode',null),__decorate([(0x0,common_1[_0x16936e(0x16b)])(_0x16936e(0x164)),(0x0,swagger_1[_0x16936e(0x16f)])({'summary':_0x16936e(0x17b),'description':_0x16936e(0x16c)}),(0x0,swagger_1[_0x16936e(0x1a6)])({'type':verifyCode_dto_1[_0x16936e(0x18d)]}),(0x0,swagger_1[_0x16936e(0x198)])({'status':common_1['HttpStatus']['OK'],'description':'验证码验证成功','schema':{'type':_0x16936e(0x18a),'properties':{'success':{'type':_0x16936e(0x197),'description':_0x16936e(0x189)},'message':{'type':_0x16936e(0x19c),'description':_0x16936e(0x1ac)}}}}),(0x0,swagger_1[_0x16936e(0x198)])({'status':common_1[_0x16936e(0x15c)][_0x16936e(0x191)],'description':_0x16936e(0x1b6),'schema':{'type':'object','properties':{'message':{'type':_0x16936e(0x19c),'description':_0x16936e(0x196)},'error':{'type':_0x16936e(0x19c),'description':_0x16936e(0x1a4)},'statusCode':{'type':_0x16936e(0x178),'description':'状态码'}}}}),__param(0x0,(0x0,common_1[_0x16936e(0x165)])()),__metadata('design:type',Function),__metadata('design:paramtypes',[verifyCode_dto_1[_0x16936e(0x18d)]]),__metadata(_0x16936e(0x190),Promise)],VerificationController['prototype'],'verifyThirdPartyCode',null),__decorate([(0x0,common_1['Post'])(_0x16936e(0x199)),(0x0,swagger_1[_0x16936e(0x16f)])({'summary':_0x16936e(0x172),'description':'发送短信验证码（注册或重置密码），验证码5分钟内有效。同一手机号1分钟内只能发送一次。'}),(0x0,swagger_1['ApiResponse'])({'status':common_1[_0x16936e(0x15c)]['OK'],'description':_0x16936e(0x171),'type':Boolean}),(0x0,swagger_1[_0x16936e(0x198)])({'status':common_1[_0x16936e(0x15c)][_0x16936e(0x191)],'description':'发送失败，可能是因为发送太频繁或参数错误'}),__param(0x0,(0x0,common_1[_0x16936e(0x165)])()),__metadata(_0x16936e(0x1b0),Function),__metadata('design:paramtypes',[Object]),__metadata(_0x16936e(0x190),Promise)],VerificationController[_0x16936e(0x1b8)],_0x16936e(0x173),null),__decorate([(0x0,common_1[_0x16936e(0x16b)])(_0x16936e(0x1a0)),(0x0,swagger_1['ApiOperation'])({'summary':'发送邮箱验证码','description':_0x16936e(0x1ad)}),(0x0,swagger_1['ApiResponse'])({'status':common_1[_0x16936e(0x15c)]['OK'],'description':_0x16936e(0x171),'type':Boolean}),(0x0,swagger_1[_0x16936e(0x198)])({'status':common_1[_0x16936e(0x15c)][_0x16936e(0x191)],'description':'发送失败，可能是因为发送太频繁或参数错误'}),(0x0,common_1[_0x16936e(0x195)])((0x0,passport_1['AuthGuard'])(_0x16936e(0x15e))),(0x0,swagger_1[_0x16936e(0x170)])(),__param(0x0,(0x0,common_1[_0x16936e(0x165)])()),__param(0x1,(0x0,common_1[_0x16936e(0x15a)])()),__metadata(_0x16936e(0x1b0),Function),__metadata(_0x16936e(0x19d),[Object,Object]),__metadata(_0x16936e(0x190),Promise)],VerificationController['prototype'],'sendEmailCode',null),VerificationController=__decorate([(0x0,swagger_1[_0x16936e(0x1b7)])('验证码'),(0x0,common_1[_0x16936e(0x1a5)])('verification'),__metadata(_0x16936e(0x19d),[verification_service_1['VerificationService'],user_service_1[_0x16936e(0x159)],globalConfig_service_1[_0x16936e(0x169)]])],VerificationController),exports[_0x16936e(0x168)]=VerificationController;