'use strict';const _0x3d0294=_0x5b0a;(function(_0x539188,_0x433513){const _0x4be390=_0x5b0a,_0x2385af=_0x539188();while(!![]){try{const _0x1b5f10=-parseInt(_0x4be390(0xad))/0x1+parseInt(_0x4be390(0xe4))/0x2+parseInt(_0x4be390(0xf3))/0x3+-parseInt(_0x4be390(0xaf))/0x4*(parseInt(_0x4be390(0xfe))/0x5)+-parseInt(_0x4be390(0xbf))/0x6+parseInt(_0x4be390(0xb0))/0x7*(parseInt(_0x4be390(0xf2))/0x8)+-parseInt(_0x4be390(0xfa))/0x9*(parseInt(_0x4be390(0xca))/0xa);if(_0x1b5f10===_0x433513)break;else _0x2385af['push'](_0x2385af['shift']());}catch(_0x53fe54){_0x2385af['push'](_0x2385af['shift']());}}}(_0x2a9d,0xd1082));var __decorate=this&&this['__decorate']||function(_0x3b8864,_0x4e2dbe,_0x9a048,_0x414084){const _0x1f6125=_0x5b0a;var _0x19bba3=arguments['length'],_0x3ac696=_0x19bba3<0x3?_0x4e2dbe:_0x414084===null?_0x414084=Object['getOwnPropertyDescriptor'](_0x4e2dbe,_0x9a048):_0x414084,_0x45cc76;if(typeof Reflect==='object'&&typeof Reflect[_0x1f6125(0xa8)]==='function')_0x3ac696=Reflect[_0x1f6125(0xa8)](_0x3b8864,_0x4e2dbe,_0x9a048,_0x414084);else{for(var _0x1df42f=_0x3b8864[_0x1f6125(0xf6)]-0x1;_0x1df42f>=0x0;_0x1df42f--)if(_0x45cc76=_0x3b8864[_0x1df42f])_0x3ac696=(_0x19bba3<0x3?_0x45cc76(_0x3ac696):_0x19bba3>0x3?_0x45cc76(_0x4e2dbe,_0x9a048,_0x3ac696):_0x45cc76(_0x4e2dbe,_0x9a048))||_0x3ac696;}return _0x19bba3>0x3&&_0x3ac696&&Object[_0x1f6125(0xc4)](_0x4e2dbe,_0x9a048,_0x3ac696),_0x3ac696;},__metadata=this&&this[_0x3d0294(0xfc)]||function(_0x4a52bf,_0x1d66ea){const _0x2805a8=_0x3d0294;if(typeof Reflect==='object'&&typeof Reflect[_0x2805a8(0xd6)]==='function')return Reflect['metadata'](_0x4a52bf,_0x1d66ea);},__param=this&&this['__param']||function(_0x32a5e6,_0x291258){return function(_0x540365,_0x9be186){_0x291258(_0x540365,_0x9be186,_0x32a5e6);};};function _0x5b0a(_0xaeff2,_0x1aa6db){const _0x2a9d9a=_0x2a9d();return _0x5b0a=function(_0x5b0a6b,_0x593bd3){_0x5b0a6b=_0x5b0a6b-0xa6;let _0x1a49b2=_0x2a9d9a[_0x5b0a6b];return _0x1a49b2;},_0x5b0a(_0xaeff2,_0x1aa6db);}Object[_0x3d0294(0xc4)](exports,'__esModule',{'value':!![]}),exports[_0x3d0294(0xdd)]=void 0x0;const common_1=require('@nestjs/common'),swagger_1=require('@nestjs/swagger'),verification_service_1=require(_0x3d0294(0xe2)),verification_constant_1=require('../../common/constants/verification.constant'),passport_1=require(_0x3d0294(0xf7)),user_service_1=require(_0x3d0294(0xdb)),verifyCode_dto_1=require(_0x3d0294(0xc3)),globalConfig_service_1=require(_0x3d0294(0xac)),common_2=require('@nestjs/common');let VerificationController=class VerificationController{constructor(_0x2f6ba3,_0x2d1b54,_0x48ffea){const _0x525cf9=_0x3d0294;this[_0x525cf9(0xbd)]=_0x2f6ba3,this[_0x525cf9(0xce)]=_0x2d1b54,this[_0x525cf9(0xd2)]=_0x48ffea;}async[_0x3d0294(0xe0)](_0x228ba6){const _0xfcebbe=_0x3d0294,_0x33d8fc=_0x228ba6['user']['id'],_0x532716=await this[_0xfcebbe(0xce)][_0xfcebbe(0xec)](_0x33d8fc),_0x969d3b=await this[_0xfcebbe(0xd2)]['getConfigs']([_0xfcebbe(0xe7)]),_0x50de91=_0x969d3b['thirdPartyAuthExpir']?Number(_0x969d3b[_0xfcebbe(0xe7)]):0x3c;return await this[_0xfcebbe(0xbd)][_0xfcebbe(0xdc)](_0x532716,verification_constant_1[_0xfcebbe(0xc5)][_0xfcebbe(0xee)],_0x50de91);}async['verifyThirdPartyCode'](_0x14d1be){const _0x1b2d42=_0x3d0294,_0x321d1a={'id':_0x14d1be['id'],'code':Number(_0x14d1be[_0x1b2d42(0xae)])};return await this[_0x1b2d42(0xbd)][_0x1b2d42(0xd1)](_0x321d1a,verification_constant_1[_0x1b2d42(0xc5)]['ThirdPartyAuth']);}async[_0x3d0294(0xe5)](_0xc68da0){const _0x431dd7=_0x3d0294,{phone:_0x209809,type:_0x5bf8fd}=_0xc68da0;if(_0x5bf8fd!==verification_constant_1[_0x431dd7(0xc5)][_0x431dd7(0xf0)]&&_0x5bf8fd!==verification_constant_1[_0x431dd7(0xc5)][_0x431dd7(0xcb)])throw new common_2[(_0x431dd7(0xc0))](_0x431dd7(0xab),common_1[_0x431dd7(0xb3)][_0x431dd7(0xf9)]);const _0x51f9d1={'id':0x0,'email':'','phone':_0x209809},_0x3c6e4f=await this['verificationService'][_0x431dd7(0xdc)](_0x51f9d1,_0x5bf8fd);return await this[_0x431dd7(0xbd)][_0x431dd7(0xb9)]({'phone':_0x209809,'code':_0x3c6e4f['code']});}async[_0x3d0294(0xe9)](_0x4e72c9,_0x18df36){const _0x1d86a9=_0x3d0294,_0x28ec12=_0x18df36[_0x1d86a9(0xbe)]['id'],_0x5685e3=await this[_0x1d86a9(0xce)][_0x1d86a9(0xec)](_0x28ec12),_0x16ac69=await this[_0x1d86a9(0xbd)][_0x1d86a9(0xdc)](Object[_0x1d86a9(0xd9)](Object[_0x1d86a9(0xd9)]({},_0x5685e3),{'email':_0x4e72c9['email']}),verification_constant_1[_0x1d86a9(0xc5)][_0x1d86a9(0xb8)]);return await this[_0x1d86a9(0xbd)][_0x1d86a9(0xe9)]({'email':_0x4e72c9[_0x1d86a9(0xa7)],'code':_0x16ac69[_0x1d86a9(0xae)]});}};function _0x2a9d(){const _0x3acde7=['sendPhoneCode','生成第三方应用认证验证码','send-sms','Req','verificationService','user','17100zehqiO','HttpException','design:paramtypes','prototype','./dto/verifyCode.dto','defineProperty','VerificationEnum','JWT认证失败','验证码','number','UserService','37300PqtgNe','PasswordReset','Post','发送失败，可能是因为发送太频繁或参数错误','userService','UseGuards','string','verifyCode','globalConfigService','验证用户提供的第三方应用认证码是否有效','Body','date-time','metadata','验证码无效或已过期','verification','assign','ApiOperation','../user/user.service','createVerification','VerificationController','验证码类型','verifyThirdPartyCode','generateThirdPartyCode','发送邮箱验证码（换绑邮箱），验证码30分钟内有效。同一邮箱1分钟内只能发送一次。','./verification.service','过期时间','3201606oFGVUO','sendSmsCode','状态码','thirdPartyAuthExpir','third-party/generate','sendEmailCode','错误类型','send-email','getUserById','ApiTags','ThirdPartyAuth','ApiResponse','Registration','ApiBearerAuth','3164024EEggaH','4582401CkncZv','design:returntype','jwt','length','@nestjs/passport','发送邮箱验证码','BAD_REQUEST','3627HNFFWd','发送短信验证码（注册或重置密码），验证码5分钟内有效。同一手机号1分钟内只能发送一次。','__metadata','third-party/verify','281075nlVcad','用户ID','email','decorate','design:type','object','不支持的验证码类型','../globalConfig/globalConfig.service','936679tnHHAL','code','16cDTYtG','7NVZEbX','是否已使用，0未使用，1已使用','VerifyCodeDto','HttpStatus','boolean','VerificationService','验证码生成成功','验证码发送成功','ChangeEmail'];_0x2a9d=function(){return _0x3acde7;};return _0x2a9d();}__decorate([(0x0,common_1['Post'])(_0x3d0294(0xe8)),(0x0,common_1['UseGuards'])((0x0,passport_1['AuthGuard'])(_0x3d0294(0xf5))),(0x0,swagger_1[_0x3d0294(0xf1)])(),(0x0,swagger_1[_0x3d0294(0xda)])({'summary':_0x3d0294(0xba),'description':'生成一个用于第三方应用认证的验证码，需要JWT认证。验证码默认1分钟后过期。'}),(0x0,swagger_1[_0x3d0294(0xef)])({'status':common_1['HttpStatus']['OK'],'description':_0x3d0294(0xb6),'schema':{'type':_0x3d0294(0xaa),'properties':{'id':{'type':'number','description':'验证码ID'},'code':{'type':_0x3d0294(0xc8),'description':'验证码'},'userId':{'type':_0x3d0294(0xc8),'description':_0x3d0294(0xa6)},'type':{'type':'number','description':_0x3d0294(0xde)},'expiresAt':{'type':_0x3d0294(0xd0),'format':_0x3d0294(0xd5),'description':_0x3d0294(0xe3)},'used':{'type':'number','description':_0x3d0294(0xb1)}}}}),(0x0,swagger_1[_0x3d0294(0xef)])({'status':common_1[_0x3d0294(0xb3)]['UNAUTHORIZED'],'description':_0x3d0294(0xc6)}),__param(0x0,(0x0,common_1[_0x3d0294(0xbc)])()),__metadata('design:type',Function),__metadata('design:paramtypes',[Object]),__metadata(_0x3d0294(0xf4),Promise)],VerificationController[_0x3d0294(0xc2)],'generateThirdPartyCode',null),__decorate([(0x0,common_1['Post'])(_0x3d0294(0xfd)),(0x0,swagger_1[_0x3d0294(0xda)])({'summary':'验证第三方应用认证码','description':_0x3d0294(0xd3)}),(0x0,swagger_1['ApiBody'])({'type':verifyCode_dto_1['VerifyCodeDto']}),(0x0,swagger_1[_0x3d0294(0xef)])({'status':common_1[_0x3d0294(0xb3)]['OK'],'description':'验证码验证成功','schema':{'type':_0x3d0294(0xaa),'properties':{'success':{'type':_0x3d0294(0xb4),'description':'验证是否成功'},'message':{'type':'string','description':'验证结果消息'}}}}),(0x0,swagger_1[_0x3d0294(0xef)])({'status':common_1[_0x3d0294(0xb3)]['BAD_REQUEST'],'description':_0x3d0294(0xd7),'schema':{'type':_0x3d0294(0xaa),'properties':{'message':{'type':_0x3d0294(0xd0),'description':'错误信息'},'error':{'type':_0x3d0294(0xd0),'description':_0x3d0294(0xea)},'statusCode':{'type':_0x3d0294(0xc8),'description':_0x3d0294(0xe6)}}}}),__param(0x0,(0x0,common_1['Body'])()),__metadata(_0x3d0294(0xa9),Function),__metadata('design:paramtypes',[verifyCode_dto_1[_0x3d0294(0xb2)]]),__metadata('design:returntype',Promise)],VerificationController[_0x3d0294(0xc2)],_0x3d0294(0xdf),null),__decorate([(0x0,common_1[_0x3d0294(0xcc)])(_0x3d0294(0xbb)),(0x0,swagger_1[_0x3d0294(0xda)])({'summary':'发送短信验证码','description':_0x3d0294(0xfb)}),(0x0,swagger_1[_0x3d0294(0xef)])({'status':common_1[_0x3d0294(0xb3)]['OK'],'description':_0x3d0294(0xb7),'type':Boolean}),(0x0,swagger_1[_0x3d0294(0xef)])({'status':common_1['HttpStatus'][_0x3d0294(0xf9)],'description':_0x3d0294(0xcd)}),__param(0x0,(0x0,common_1[_0x3d0294(0xd4)])()),__metadata(_0x3d0294(0xa9),Function),__metadata('design:paramtypes',[Object]),__metadata(_0x3d0294(0xf4),Promise)],VerificationController[_0x3d0294(0xc2)],'sendSmsCode',null),__decorate([(0x0,common_1[_0x3d0294(0xcc)])(_0x3d0294(0xeb)),(0x0,swagger_1[_0x3d0294(0xda)])({'summary':_0x3d0294(0xf8),'description':_0x3d0294(0xe1)}),(0x0,swagger_1['ApiResponse'])({'status':common_1[_0x3d0294(0xb3)]['OK'],'description':_0x3d0294(0xb7),'type':Boolean}),(0x0,swagger_1[_0x3d0294(0xef)])({'status':common_1[_0x3d0294(0xb3)][_0x3d0294(0xf9)],'description':'发送失败，可能是因为发送太频繁或参数错误'}),(0x0,common_1[_0x3d0294(0xcf)])((0x0,passport_1['AuthGuard'])(_0x3d0294(0xf5))),(0x0,swagger_1[_0x3d0294(0xf1)])(),__param(0x0,(0x0,common_1['Body'])()),__param(0x1,(0x0,common_1[_0x3d0294(0xbc)])()),__metadata(_0x3d0294(0xa9),Function),__metadata(_0x3d0294(0xc1),[Object,Object]),__metadata(_0x3d0294(0xf4),Promise)],VerificationController['prototype'],_0x3d0294(0xe9),null),VerificationController=__decorate([(0x0,swagger_1[_0x3d0294(0xed)])(_0x3d0294(0xc7)),(0x0,common_1['Controller'])(_0x3d0294(0xd8)),__metadata(_0x3d0294(0xc1),[verification_service_1[_0x3d0294(0xb5)],user_service_1[_0x3d0294(0xc9)],globalConfig_service_1['GlobalConfigService']])],VerificationController),exports[_0x3d0294(0xdd)]=VerificationController;