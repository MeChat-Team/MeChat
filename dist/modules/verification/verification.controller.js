'use strict';const _0x2e7815=_0x5a4d;function _0x3f1a(){const _0x468073=['UserService','VerifyCodeDto','send-sms','generateThirdPartyCode','49288mITkeP','发送邮箱验证码','不支持的验证码类型','getOwnPropertyDescriptor','verificationService','string','ApiBearerAuth','code','design:returntype','验证码发送成功','验证码类型','验证码生成成功','发送失败，可能是因为发送太频繁或参数错误','189XtJpNK','getUserById','decorate','Req','getConfigs','send-email','__metadata','是否已使用，0未使用，1已使用','thirdPartyAuthExpir','@nestjs/common','验证用户提供的第三方应用认证码是否有效','验证码','验证码ID','./verification.service','ThirdPartyAuth','111djaweq','HttpStatus','sendPhoneCode','@nestjs/passport','错误信息','状态码','Registration','154220FdpoyE','28inSkju','user','验证第三方应用认证码','BAD_REQUEST','__decorate','sendEmailCode','验证码无效或已过期','JWT认证失败','length','userService','GlobalConfigService','design:type','306jnXPDe','../globalConfig/globalConfig.service','18426KHwRZo','globalConfigService','boolean','sendSmsCode','生成一个用于第三方应用认证的验证码，需要JWT认证。验证码默认1分钟后过期。','Post','number','2869104CAjEoU','verifyThirdPartyCode','date-time','5838932rXRRoY','__esModule','prototype','UNAUTHORIZED','ChangeEmail','Controller','metadata','VerificationEnum','jwt','用户ID','email','ApiTags','third-party/verify','过期时间','defineProperty','@nestjs/swagger','270185TwLFBC','createVerification','AuthGuard','../../common/constants/verification.constant','verifyCode','验证码验证成功','生成第三方应用认证验证码','object','ApiResponse','ApiOperation','assign','错误类型','发送短信验证码（注册或重置密码），验证码5分钟内有效。同一手机号1分钟内只能发送一次。','./dto/verifyCode.dto','PasswordReset','UseGuards','64727iEjuCI','发送短信验证码','function','../user/user.service','design:paramtypes'];_0x3f1a=function(){return _0x468073;};return _0x3f1a();}(function(_0x259fca,_0x3a8e6f){const _0x5047c5=_0x5a4d,_0x9f117d=_0x259fca();while(!![]){try{const _0x10eaeb=parseInt(_0x5047c5(0xf6))/0x1+parseInt(_0x5047c5(0xcc))/0x2*(-parseInt(_0x5047c5(0xb6))/0x3)+parseInt(_0x5047c5(0xbe))/0x4*(parseInt(_0x5047c5(0xe6))/0x5)+parseInt(_0x5047c5(0xd3))/0x6+-parseInt(_0x5047c5(0xa7))/0x7*(parseInt(_0x5047c5(0x9a))/0x8)+-parseInt(_0x5047c5(0xca))/0x9*(parseInt(_0x5047c5(0xbd))/0xa)+parseInt(_0x5047c5(0xd6))/0xb;if(_0x10eaeb===_0x3a8e6f)break;else _0x9f117d['push'](_0x9f117d['shift']());}catch(_0x10eb84){_0x9f117d['push'](_0x9f117d['shift']());}}}(_0x3f1a,0x66a36));var __decorate=this&&this[_0x2e7815(0xc2)]||function(_0x7be22b,_0xda4c2c,_0x4e7910,_0x3251bc){const _0x22f8b1=_0x2e7815;var _0x3d6500=arguments[_0x22f8b1(0xc6)],_0x2623a4=_0x3d6500<0x3?_0xda4c2c:_0x3251bc===null?_0x3251bc=Object[_0x22f8b1(0x9d)](_0xda4c2c,_0x4e7910):_0x3251bc,_0x481c73;if(typeof Reflect==='object'&&typeof Reflect[_0x22f8b1(0xa9)]==='function')_0x2623a4=Reflect['decorate'](_0x7be22b,_0xda4c2c,_0x4e7910,_0x3251bc);else{for(var _0x3450e7=_0x7be22b[_0x22f8b1(0xc6)]-0x1;_0x3450e7>=0x0;_0x3450e7--)if(_0x481c73=_0x7be22b[_0x3450e7])_0x2623a4=(_0x3d6500<0x3?_0x481c73(_0x2623a4):_0x3d6500>0x3?_0x481c73(_0xda4c2c,_0x4e7910,_0x2623a4):_0x481c73(_0xda4c2c,_0x4e7910))||_0x2623a4;}return _0x3d6500>0x3&&_0x2623a4&&Object[_0x22f8b1(0xe4)](_0xda4c2c,_0x4e7910,_0x2623a4),_0x2623a4;},__metadata=this&&this[_0x2e7815(0xad)]||function(_0x18f1b1,_0x10220b){const _0x183f12=_0x2e7815;if(typeof Reflect===_0x183f12(0xed)&&typeof Reflect[_0x183f12(0xdc)]===_0x183f12(0xf8))return Reflect[_0x183f12(0xdc)](_0x18f1b1,_0x10220b);},__param=this&&this['__param']||function(_0x4f8a74,_0x36cbd8){return function(_0x219875,_0x59bce5){_0x36cbd8(_0x219875,_0x59bce5,_0x4f8a74);};};Object[_0x2e7815(0xe4)](exports,_0x2e7815(0xd7),{'value':!![]}),exports['VerificationController']=void 0x0;const common_1=require('@nestjs/common'),swagger_1=require(_0x2e7815(0xe5)),verification_service_1=require(_0x2e7815(0xb4)),verification_constant_1=require(_0x2e7815(0xe9)),passport_1=require(_0x2e7815(0xb9)),user_service_1=require(_0x2e7815(0xf9)),verifyCode_dto_1=require(_0x2e7815(0xf3)),globalConfig_service_1=require(_0x2e7815(0xcb)),common_2=require(_0x2e7815(0xb0));let VerificationController=class VerificationController{constructor(_0x148534,_0x4c402b,_0x1d6d78){const _0x175a40=_0x2e7815;this[_0x175a40(0x9e)]=_0x148534,this[_0x175a40(0xc7)]=_0x4c402b,this[_0x175a40(0xcd)]=_0x1d6d78;}async[_0x2e7815(0xfe)](_0x42cdb1){const _0x2a1d70=_0x2e7815,_0xc5a0d7=_0x42cdb1[_0x2a1d70(0xbf)]['id'],_0x2e9a9d=await this[_0x2a1d70(0xc7)]['getUserById'](_0xc5a0d7),_0x3b4ed9=await this[_0x2a1d70(0xcd)][_0x2a1d70(0xab)]([_0x2a1d70(0xaf)]),_0x21eaf4=_0x3b4ed9[_0x2a1d70(0xaf)]?Number(_0x3b4ed9[_0x2a1d70(0xaf)]):0x3c;return await this[_0x2a1d70(0x9e)][_0x2a1d70(0xe7)](_0x2e9a9d,verification_constant_1['VerificationEnum'][_0x2a1d70(0xb5)],_0x21eaf4);}async[_0x2e7815(0xd4)](_0x4514f6){const _0xf52927=_0x2e7815,_0x5bd997={'id':_0x4514f6['id'],'code':Number(_0x4514f6[_0xf52927(0xa1)])};return await this[_0xf52927(0x9e)][_0xf52927(0xea)](_0x5bd997,verification_constant_1[_0xf52927(0xdd)][_0xf52927(0xb5)]);}async[_0x2e7815(0xcf)](_0x4c5770){const _0x3d5292=_0x2e7815,{phone:_0x194108,type:_0x3199b4}=_0x4c5770;if(_0x3199b4!==verification_constant_1['VerificationEnum'][_0x3d5292(0xbc)]&&_0x3199b4!==verification_constant_1['VerificationEnum'][_0x3d5292(0xf4)])throw new common_2['HttpException'](_0x3d5292(0x9c),common_1['HttpStatus'][_0x3d5292(0xc1)]);const _0x12e9b1={'id':0x0,'email':'','phone':_0x194108},_0x22cf1a=await this[_0x3d5292(0x9e)]['createVerification'](_0x12e9b1,_0x3199b4);return await this[_0x3d5292(0x9e)][_0x3d5292(0xb8)]({'phone':_0x194108,'code':_0x22cf1a[_0x3d5292(0xa1)]});}async[_0x2e7815(0xc3)](_0x5c74d2,_0x194311){const _0x57254f=_0x2e7815,_0x5bae05=_0x194311['user']['id'],_0x163e1d=await this[_0x57254f(0xc7)][_0x57254f(0xa8)](_0x5bae05),_0x487834=await this[_0x57254f(0x9e)][_0x57254f(0xe7)](Object[_0x57254f(0xf0)](Object['assign']({},_0x163e1d),{'email':_0x5c74d2[_0x57254f(0xe0)]}),verification_constant_1[_0x57254f(0xdd)][_0x57254f(0xda)]);return await this[_0x57254f(0x9e)][_0x57254f(0xc3)]({'email':_0x5c74d2[_0x57254f(0xe0)],'code':_0x487834[_0x57254f(0xa1)]});}};function _0x5a4d(_0x14fae6,_0x1d15dd){const _0x3f1ab7=_0x3f1a();return _0x5a4d=function(_0x5a4da7,_0x1c7645){_0x5a4da7=_0x5a4da7-0x9a;let _0x2005fe=_0x3f1ab7[_0x5a4da7];return _0x2005fe;},_0x5a4d(_0x14fae6,_0x1d15dd);}__decorate([(0x0,common_1[_0x2e7815(0xd1)])('third-party/generate'),(0x0,common_1['UseGuards'])((0x0,passport_1[_0x2e7815(0xe8)])(_0x2e7815(0xde))),(0x0,swagger_1[_0x2e7815(0xa0)])(),(0x0,swagger_1[_0x2e7815(0xef)])({'summary':_0x2e7815(0xec),'description':_0x2e7815(0xd0)}),(0x0,swagger_1[_0x2e7815(0xee)])({'status':common_1[_0x2e7815(0xb7)]['OK'],'description':_0x2e7815(0xa5),'schema':{'type':'object','properties':{'id':{'type':_0x2e7815(0xd2),'description':_0x2e7815(0xb3)},'code':{'type':_0x2e7815(0xd2),'description':'验证码'},'userId':{'type':_0x2e7815(0xd2),'description':_0x2e7815(0xdf)},'type':{'type':'number','description':_0x2e7815(0xa4)},'expiresAt':{'type':_0x2e7815(0x9f),'format':_0x2e7815(0xd5),'description':_0x2e7815(0xe3)},'used':{'type':_0x2e7815(0xd2),'description':_0x2e7815(0xae)}}}}),(0x0,swagger_1[_0x2e7815(0xee)])({'status':common_1['HttpStatus'][_0x2e7815(0xd9)],'description':_0x2e7815(0xc5)}),__param(0x0,(0x0,common_1[_0x2e7815(0xaa)])()),__metadata(_0x2e7815(0xc9),Function),__metadata('design:paramtypes',[Object]),__metadata(_0x2e7815(0xa2),Promise)],VerificationController[_0x2e7815(0xd8)],'generateThirdPartyCode',null),__decorate([(0x0,common_1[_0x2e7815(0xd1)])(_0x2e7815(0xe2)),(0x0,swagger_1['ApiOperation'])({'summary':_0x2e7815(0xc0),'description':_0x2e7815(0xb1)}),(0x0,swagger_1['ApiBody'])({'type':verifyCode_dto_1[_0x2e7815(0xfc)]}),(0x0,swagger_1[_0x2e7815(0xee)])({'status':common_1[_0x2e7815(0xb7)]['OK'],'description':_0x2e7815(0xeb),'schema':{'type':_0x2e7815(0xed),'properties':{'success':{'type':_0x2e7815(0xce),'description':'验证是否成功'},'message':{'type':_0x2e7815(0x9f),'description':'验证结果消息'}}}}),(0x0,swagger_1['ApiResponse'])({'status':common_1[_0x2e7815(0xb7)][_0x2e7815(0xc1)],'description':_0x2e7815(0xc4),'schema':{'type':'object','properties':{'message':{'type':'string','description':_0x2e7815(0xba)},'error':{'type':_0x2e7815(0x9f),'description':_0x2e7815(0xf1)},'statusCode':{'type':'number','description':_0x2e7815(0xbb)}}}}),__param(0x0,(0x0,common_1['Body'])()),__metadata('design:type',Function),__metadata(_0x2e7815(0xfa),[verifyCode_dto_1[_0x2e7815(0xfc)]]),__metadata(_0x2e7815(0xa2),Promise)],VerificationController[_0x2e7815(0xd8)],_0x2e7815(0xd4),null),__decorate([(0x0,common_1[_0x2e7815(0xd1)])(_0x2e7815(0xfd)),(0x0,swagger_1['ApiOperation'])({'summary':_0x2e7815(0xf7),'description':_0x2e7815(0xf2)}),(0x0,swagger_1[_0x2e7815(0xee)])({'status':common_1['HttpStatus']['OK'],'description':'验证码发送成功','type':Boolean}),(0x0,swagger_1['ApiResponse'])({'status':common_1[_0x2e7815(0xb7)][_0x2e7815(0xc1)],'description':'发送失败，可能是因为发送太频繁或参数错误'}),__param(0x0,(0x0,common_1['Body'])()),__metadata(_0x2e7815(0xc9),Function),__metadata(_0x2e7815(0xfa),[Object]),__metadata('design:returntype',Promise)],VerificationController['prototype'],'sendSmsCode',null),__decorate([(0x0,common_1['Post'])(_0x2e7815(0xac)),(0x0,swagger_1[_0x2e7815(0xef)])({'summary':_0x2e7815(0x9b),'description':'发送邮箱验证码（换绑邮箱），验证码30分钟内有效。同一邮箱1分钟内只能发送一次。'}),(0x0,swagger_1[_0x2e7815(0xee)])({'status':common_1[_0x2e7815(0xb7)]['OK'],'description':_0x2e7815(0xa3),'type':Boolean}),(0x0,swagger_1[_0x2e7815(0xee)])({'status':common_1[_0x2e7815(0xb7)][_0x2e7815(0xc1)],'description':_0x2e7815(0xa6)}),(0x0,common_1[_0x2e7815(0xf5)])((0x0,passport_1[_0x2e7815(0xe8)])('jwt')),(0x0,swagger_1[_0x2e7815(0xa0)])(),__param(0x0,(0x0,common_1['Body'])()),__param(0x1,(0x0,common_1['Req'])()),__metadata(_0x2e7815(0xc9),Function),__metadata(_0x2e7815(0xfa),[Object,Object]),__metadata(_0x2e7815(0xa2),Promise)],VerificationController[_0x2e7815(0xd8)],_0x2e7815(0xc3),null),VerificationController=__decorate([(0x0,swagger_1[_0x2e7815(0xe1)])(_0x2e7815(0xb2)),(0x0,common_1[_0x2e7815(0xdb)])('verification'),__metadata(_0x2e7815(0xfa),[verification_service_1['VerificationService'],user_service_1[_0x2e7815(0xfb)],globalConfig_service_1[_0x2e7815(0xc8)]])],VerificationController),exports['VerificationController']=VerificationController;