'use strict';const _0x2bb44e=_0x1673;(function(_0x5702af,_0x4252d8){const _0xe4d81a=_0x1673,_0x541b20=_0x5702af();while(!![]){try{const _0x359d0d=-parseInt(_0xe4d81a(0xca))/0x1*(-parseInt(_0xe4d81a(0x99))/0x2)+-parseInt(_0xe4d81a(0xd5))/0x3*(-parseInt(_0xe4d81a(0x9b))/0x4)+-parseInt(_0xe4d81a(0xc8))/0x5+parseInt(_0xe4d81a(0x87))/0x6+-parseInt(_0xe4d81a(0xd6))/0x7+parseInt(_0xe4d81a(0xd4))/0x8+parseInt(_0xe4d81a(0xa5))/0x9*(-parseInt(_0xe4d81a(0x88))/0xa);if(_0x359d0d===_0x4252d8)break;else _0x541b20['push'](_0x541b20['shift']());}catch(_0x4b4678){_0x541b20['push'](_0x541b20['shift']());}}}(_0x3d89,0x1b1fa));var __decorate=this&&this[_0x2bb44e(0x7c)]||function(_0x5de32c,_0x2c87fc,_0x2d2218,_0x2155b4){const _0x5a7529=_0x2bb44e;var _0xd75e60=arguments[_0x5a7529(0x7e)],_0x2ded88=_0xd75e60<0x3?_0x2c87fc:_0x2155b4===null?_0x2155b4=Object['getOwnPropertyDescriptor'](_0x2c87fc,_0x2d2218):_0x2155b4,_0xbc138;if(typeof Reflect==='object'&&typeof Reflect['decorate']===_0x5a7529(0x93))_0x2ded88=Reflect['decorate'](_0x5de32c,_0x2c87fc,_0x2d2218,_0x2155b4);else{for(var _0x1639b7=_0x5de32c['length']-0x1;_0x1639b7>=0x0;_0x1639b7--)if(_0xbc138=_0x5de32c[_0x1639b7])_0x2ded88=(_0xd75e60<0x3?_0xbc138(_0x2ded88):_0xd75e60>0x3?_0xbc138(_0x2c87fc,_0x2d2218,_0x2ded88):_0xbc138(_0x2c87fc,_0x2d2218))||_0x2ded88;}return _0xd75e60>0x3&&_0x2ded88&&Object[_0x5a7529(0xab)](_0x2c87fc,_0x2d2218,_0x2ded88),_0x2ded88;},__metadata=this&&this[_0x2bb44e(0xad)]||function(_0x3efb2a,_0x2bc2cc){const _0x478af3=_0x2bb44e;if(typeof Reflect===_0x478af3(0x85)&&typeof Reflect[_0x478af3(0xbf)]==='function')return Reflect[_0x478af3(0xbf)](_0x3efb2a,_0x2bc2cc);},__param=this&&this[_0x2bb44e(0xa7)]||function(_0x48638f,_0x142ff7){return function(_0x1955ba,_0x3e09f4){_0x142ff7(_0x1955ba,_0x3e09f4,_0x48638f);};};Object['defineProperty'](exports,_0x2bb44e(0xb9),{'value':!![]}),exports['VerificationController']=void 0x0;const common_1=require(_0x2bb44e(0xb8)),swagger_1=require('@nestjs/swagger'),verification_service_1=require(_0x2bb44e(0x95)),verification_constant_1=require('../../common/constants/verification.constant'),passport_1=require('@nestjs/passport'),user_service_1=require('../user/user.service'),verifyCode_dto_1=require(_0x2bb44e(0x9f)),globalConfig_service_1=require(_0x2bb44e(0xa1)),common_2=require(_0x2bb44e(0xb8));function _0x1673(_0x21b571,_0x42a3a5){const _0x3d8902=_0x3d89();return _0x1673=function(_0x167358,_0x4467ef){_0x167358=_0x167358-0x7b;let _0x179586=_0x3d8902[_0x167358];return _0x179586;},_0x1673(_0x21b571,_0x42a3a5);}function _0x3d89(){const _0x31b97c=['发送邮箱验证码（换绑邮箱），验证码30分钟内有效。同一邮箱1分钟内只能发送一次。','验证码生成成功','thirdPartyAuthExpir','getConfigs','BAD_REQUEST','VerificationController','getUserById','function','AuthGuard','./verification.service','Req','sendEmailCode','design:type','2098qpMJBr','design:returntype','900CMcwdr','ApiOperation','boolean','verification','./dto/verifyCode.dto','验证码类型','../globalConfig/globalConfig.service','code','用户ID','Controller','9JdqpaJ','verificationService','__param','UseGuards','验证第三方应用认证码','是否已使用，0未使用，1已使用','defineProperty','发送短信验证码','__metadata','prototype','ThirdPartyAuth','状态码','HttpStatus','userService','验证是否成功','design:paramtypes','ApiTags','验证码ID','sendSmsCode','@nestjs/common','__esModule','Body','createVerification','string','验证用户提供的第三方应用认证码是否有效','Registration','metadata','验证码无效或已过期','验证码发送成功','jwt','verifyCode','ApiResponse','send-sms','globalConfigService','生成一个用于第三方应用认证的验证码，需要JWT认证。验证码默认1分钟后过期。','993000QjqwxV','VerifyCodeDto','163cDjeAb','ChangeEmail','generateThirdPartyCode','user','verifyThirdPartyCode','验证码验证成功','发送失败，可能是因为发送太频繁或参数错误','VerificationEnum','发送邮箱验证码','third-party/verify','326656YLpDMo','561XhsPLb','563220nKqZHA','email','Post','__decorate','number','length','assign','ApiBearerAuth','HttpException','UNAUTHORIZED','发送短信验证码（注册或重置密码），验证码5分钟内有效。同一手机号1分钟内只能发送一次。','date-time','object','PasswordReset','1179882pMCWSF','603830wLRjsQ','JWT认证失败','错误类型','不支持的验证码类型'];_0x3d89=function(){return _0x31b97c;};return _0x3d89();}let VerificationController=class VerificationController{constructor(_0x5a3fcf,_0x23f55d,_0x38ae43){const _0x529c3d=_0x2bb44e;this['verificationService']=_0x5a3fcf,this[_0x529c3d(0xb2)]=_0x23f55d,this[_0x529c3d(0xc6)]=_0x38ae43;}async['generateThirdPartyCode'](_0x36ac54){const _0x1c3923=_0x2bb44e,_0x529f39=_0x36ac54['user']['id'],_0x34c967=await this['userService'][_0x1c3923(0x92)](_0x529f39),_0x4aae45=await this['globalConfigService'][_0x1c3923(0x8f)]([_0x1c3923(0x8e)]),_0x4987c9=_0x4aae45[_0x1c3923(0x8e)]?Number(_0x4aae45[_0x1c3923(0x8e)]):0x3c;return await this[_0x1c3923(0xa6)]['createVerification'](_0x34c967,verification_constant_1[_0x1c3923(0xd1)][_0x1c3923(0xaf)],_0x4987c9);}async[_0x2bb44e(0xce)](_0x3a5de3){const _0x55f915=_0x2bb44e,_0x2909c9={'id':_0x3a5de3['id'],'code':Number(_0x3a5de3[_0x55f915(0xa2)])};return await this[_0x55f915(0xa6)][_0x55f915(0xc3)](_0x2909c9,verification_constant_1[_0x55f915(0xd1)][_0x55f915(0xaf)]);}async[_0x2bb44e(0xb7)](_0x5272c2){const _0x25b32e=_0x2bb44e,{phone:_0x500c65,type:_0x539aa2}=_0x5272c2;if(_0x539aa2!==verification_constant_1['VerificationEnum'][_0x25b32e(0xbe)]&&_0x539aa2!==verification_constant_1[_0x25b32e(0xd1)][_0x25b32e(0x86)])throw new common_2[(_0x25b32e(0x81))](_0x25b32e(0x8b),common_1[_0x25b32e(0xb1)]['BAD_REQUEST']);const _0xce4571={'id':0x0,'email':'','phone':_0x500c65},_0xc4c572=await this[_0x25b32e(0xa6)][_0x25b32e(0xbb)](_0xce4571,_0x539aa2);return await this['verificationService']['sendPhoneCode']({'phone':_0x500c65,'code':_0xc4c572[_0x25b32e(0xa2)]});}async['sendEmailCode'](_0x92ad6a,_0x3c4d56){const _0x332949=_0x2bb44e,_0x2f17aa=_0x3c4d56[_0x332949(0xcd)]['id'],_0x101da5=await this['userService'][_0x332949(0x92)](_0x2f17aa),_0x92691d=await this[_0x332949(0xa6)][_0x332949(0xbb)](Object[_0x332949(0x7f)](Object['assign']({},_0x101da5),{'email':_0x92ad6a['email']}),verification_constant_1[_0x332949(0xd1)][_0x332949(0xcb)]);return await this[_0x332949(0xa6)][_0x332949(0x97)]({'email':_0x92ad6a[_0x332949(0xd7)],'code':_0x92691d[_0x332949(0xa2)]});}};__decorate([(0x0,common_1[_0x2bb44e(0x7b)])('third-party/generate'),(0x0,common_1[_0x2bb44e(0xa8)])((0x0,passport_1[_0x2bb44e(0x94)])('jwt')),(0x0,swagger_1[_0x2bb44e(0x80)])(),(0x0,swagger_1[_0x2bb44e(0x9c)])({'summary':'生成第三方应用认证验证码','description':_0x2bb44e(0xc7)}),(0x0,swagger_1[_0x2bb44e(0xc4)])({'status':common_1[_0x2bb44e(0xb1)]['OK'],'description':_0x2bb44e(0x8d),'schema':{'type':'object','properties':{'id':{'type':'number','description':_0x2bb44e(0xb6)},'code':{'type':'number','description':'验证码'},'userId':{'type':'number','description':_0x2bb44e(0xa3)},'type':{'type':_0x2bb44e(0x7d),'description':_0x2bb44e(0xa0)},'expiresAt':{'type':_0x2bb44e(0xbc),'format':_0x2bb44e(0x84),'description':'过期时间'},'used':{'type':_0x2bb44e(0x7d),'description':_0x2bb44e(0xaa)}}}}),(0x0,swagger_1['ApiResponse'])({'status':common_1[_0x2bb44e(0xb1)][_0x2bb44e(0x82)],'description':_0x2bb44e(0x89)}),__param(0x0,(0x0,common_1[_0x2bb44e(0x96)])()),__metadata(_0x2bb44e(0x98),Function),__metadata(_0x2bb44e(0xb4),[Object]),__metadata(_0x2bb44e(0x9a),Promise)],VerificationController[_0x2bb44e(0xae)],_0x2bb44e(0xcc),null),__decorate([(0x0,common_1['Post'])(_0x2bb44e(0xd3)),(0x0,swagger_1[_0x2bb44e(0x9c)])({'summary':_0x2bb44e(0xa9),'description':_0x2bb44e(0xbd)}),(0x0,swagger_1['ApiBody'])({'type':verifyCode_dto_1[_0x2bb44e(0xc9)]}),(0x0,swagger_1['ApiResponse'])({'status':common_1[_0x2bb44e(0xb1)]['OK'],'description':_0x2bb44e(0xcf),'schema':{'type':_0x2bb44e(0x85),'properties':{'success':{'type':_0x2bb44e(0x9d),'description':_0x2bb44e(0xb3)},'message':{'type':_0x2bb44e(0xbc),'description':'验证结果消息'}}}}),(0x0,swagger_1[_0x2bb44e(0xc4)])({'status':common_1[_0x2bb44e(0xb1)][_0x2bb44e(0x90)],'description':_0x2bb44e(0xc0),'schema':{'type':'object','properties':{'message':{'type':_0x2bb44e(0xbc),'description':'错误信息'},'error':{'type':'string','description':_0x2bb44e(0x8a)},'statusCode':{'type':_0x2bb44e(0x7d),'description':_0x2bb44e(0xb0)}}}}),__param(0x0,(0x0,common_1[_0x2bb44e(0xba)])()),__metadata(_0x2bb44e(0x98),Function),__metadata(_0x2bb44e(0xb4),[verifyCode_dto_1[_0x2bb44e(0xc9)]]),__metadata(_0x2bb44e(0x9a),Promise)],VerificationController[_0x2bb44e(0xae)],_0x2bb44e(0xce),null),__decorate([(0x0,common_1['Post'])(_0x2bb44e(0xc5)),(0x0,swagger_1['ApiOperation'])({'summary':_0x2bb44e(0xac),'description':_0x2bb44e(0x83)}),(0x0,swagger_1[_0x2bb44e(0xc4)])({'status':common_1[_0x2bb44e(0xb1)]['OK'],'description':_0x2bb44e(0xc1),'type':Boolean}),(0x0,swagger_1[_0x2bb44e(0xc4)])({'status':common_1[_0x2bb44e(0xb1)][_0x2bb44e(0x90)],'description':_0x2bb44e(0xd0)}),__param(0x0,(0x0,common_1['Body'])()),__metadata('design:type',Function),__metadata(_0x2bb44e(0xb4),[Object]),__metadata('design:returntype',Promise)],VerificationController[_0x2bb44e(0xae)],_0x2bb44e(0xb7),null),__decorate([(0x0,common_1[_0x2bb44e(0x7b)])('send-email'),(0x0,swagger_1[_0x2bb44e(0x9c)])({'summary':_0x2bb44e(0xd2),'description':_0x2bb44e(0x8c)}),(0x0,swagger_1['ApiResponse'])({'status':common_1[_0x2bb44e(0xb1)]['OK'],'description':_0x2bb44e(0xc1),'type':Boolean}),(0x0,swagger_1[_0x2bb44e(0xc4)])({'status':common_1[_0x2bb44e(0xb1)][_0x2bb44e(0x90)],'description':_0x2bb44e(0xd0)}),(0x0,common_1['UseGuards'])((0x0,passport_1['AuthGuard'])(_0x2bb44e(0xc2))),(0x0,swagger_1[_0x2bb44e(0x80)])(),__param(0x0,(0x0,common_1[_0x2bb44e(0xba)])()),__param(0x1,(0x0,common_1['Req'])()),__metadata('design:type',Function),__metadata('design:paramtypes',[Object,Object]),__metadata('design:returntype',Promise)],VerificationController[_0x2bb44e(0xae)],_0x2bb44e(0x97),null),VerificationController=__decorate([(0x0,swagger_1[_0x2bb44e(0xb5)])('验证码'),(0x0,common_1[_0x2bb44e(0xa4)])(_0x2bb44e(0x9e)),__metadata(_0x2bb44e(0xb4),[verification_service_1['VerificationService'],user_service_1['UserService'],globalConfig_service_1['GlobalConfigService']])],VerificationController),exports[_0x2bb44e(0x91)]=VerificationController;