'use strict';function _0x48ab(){const _0x3643e6=['string','397025EclSpE','验证是否成功','function','__param','错误信息','number','状态码','验证用户提供的第三方应用认证码是否有效','thirdPartyAuthExpir','22VLnpNc','sendEmailCode','HttpException','用户ID','Post','boolean','verifyCode','user','4381846ZUVBFy','发送邮箱验证码（换绑邮箱），验证码30分钟内有效。同一邮箱1分钟内只能发送一次。','@nestjs/swagger','错误类型','object','UNAUTHORIZED','../../common/constants/verification.constant','defineProperty','6209684YfYyNo','verificationService','发送短信验证码（注册或重置密码），验证码5分钟内有效。同一手机号1分钟内只能发送一次。','createVerification','__esModule','Body','../user/user.service','Registration','__metadata','@nestjs/common','@nestjs/passport','16hGDags','assign','Controller','验证码','VerificationController','GlobalConfigService','../globalConfig/globalConfig.service','JWT认证失败','VerifyCodeDto','third-party/verify','UserService','prototype','生成第三方应用认证验证码','生成一个用于第三方应用认证的验证码，需要JWT认证。验证码默认1分钟后过期。','metadata','98473nZVYWm','36294300rlvOdJ','VerificationEnum','date-time','验证码生成成功','验证码验证成功','3866961oQCweM','ApiTags','__decorate','design:paramtypes','BAD_REQUEST','email','design:type','./verification.service','发送失败，可能是因为发送太频繁或参数错误','verifyThirdPartyCode','过期时间','getUserById','1251882eJkANh','Req','design:returntype','length','验证码无效或已过期','getOwnPropertyDescriptor','third-party/generate','code','send-sms','sendPhoneCode','ThirdPartyAuth','AuthGuard','userService','generateThirdPartyCode','HttpStatus','ApiResponse','VerificationService','ApiBody','ApiBearerAuth','globalConfigService','sendSmsCode','UseGuards','验证码发送成功','ApiOperation','decorate','jwt'];_0x48ab=function(){return _0x3643e6;};return _0x48ab();}const _0x2eba97=_0x431a;(function(_0x4dd808,_0x53447e){const _0x3fef8e=_0x431a,_0x150590=_0x4dd808();while(!![]){try{const _0x11fa14=parseInt(_0x3fef8e(0x1d9))/0x1*(parseInt(_0x3fef8e(0x1af))/0x2)+-parseInt(_0x3fef8e(0x1df))/0x3+-parseInt(_0x3fef8e(0x1bf))/0x4+parseInt(_0x3fef8e(0x206))/0x5+-parseInt(_0x3fef8e(0x1eb))/0x6+parseInt(_0x3fef8e(0x1b7))/0x7*(-parseInt(_0x3fef8e(0x1ca))/0x8)+parseInt(_0x3fef8e(0x1da))/0x9;if(_0x11fa14===_0x53447e)break;else _0x150590['push'](_0x150590['shift']());}catch(_0x36fd71){_0x150590['push'](_0x150590['shift']());}}}(_0x48ab,0xda171));function _0x431a(_0x2f049a,_0x563301){const _0x48abc3=_0x48ab();return _0x431a=function(_0x431a43,_0xad43bd){_0x431a43=_0x431a43-0x1ad;let _0x56447c=_0x48abc3[_0x431a43];return _0x56447c;},_0x431a(_0x2f049a,_0x563301);}var __decorate=this&&this[_0x2eba97(0x1e1)]||function(_0x280aa1,_0x35fbc3,_0x22b3d1,_0x44ff97){const _0x28b925=_0x2eba97;var _0xe83f21=arguments['length'],_0x1b3367=_0xe83f21<0x3?_0x35fbc3:_0x44ff97===null?_0x44ff97=Object[_0x28b925(0x1f0)](_0x35fbc3,_0x22b3d1):_0x44ff97,_0x3644df;if(typeof Reflect===_0x28b925(0x1bb)&&typeof Reflect[_0x28b925(0x203)]===_0x28b925(0x208))_0x1b3367=Reflect[_0x28b925(0x203)](_0x280aa1,_0x35fbc3,_0x22b3d1,_0x44ff97);else{for(var _0x3313d4=_0x280aa1[_0x28b925(0x1ee)]-0x1;_0x3313d4>=0x0;_0x3313d4--)if(_0x3644df=_0x280aa1[_0x3313d4])_0x1b3367=(_0xe83f21<0x3?_0x3644df(_0x1b3367):_0xe83f21>0x3?_0x3644df(_0x35fbc3,_0x22b3d1,_0x1b3367):_0x3644df(_0x35fbc3,_0x22b3d1))||_0x1b3367;}return _0xe83f21>0x3&&_0x1b3367&&Object[_0x28b925(0x1be)](_0x35fbc3,_0x22b3d1,_0x1b3367),_0x1b3367;},__metadata=this&&this[_0x2eba97(0x1c7)]||function(_0x8accdb,_0x441168){const _0x232986=_0x2eba97;if(typeof Reflect===_0x232986(0x1bb)&&typeof Reflect[_0x232986(0x1d8)]==='function')return Reflect[_0x232986(0x1d8)](_0x8accdb,_0x441168);},__param=this&&this[_0x2eba97(0x209)]||function(_0xa1ea6a,_0xae1eeb){return function(_0x3bb0bd,_0x853843){_0xae1eeb(_0x3bb0bd,_0x853843,_0xa1ea6a);};};Object['defineProperty'](exports,_0x2eba97(0x1c3),{'value':!![]}),exports[_0x2eba97(0x1ce)]=void 0x0;const common_1=require(_0x2eba97(0x1c8)),swagger_1=require(_0x2eba97(0x1b9)),verification_service_1=require(_0x2eba97(0x1e6)),verification_constant_1=require(_0x2eba97(0x1bd)),passport_1=require(_0x2eba97(0x1c9)),user_service_1=require(_0x2eba97(0x1c5)),verifyCode_dto_1=require('./dto/verifyCode.dto'),globalConfig_service_1=require(_0x2eba97(0x1d0)),common_2=require('@nestjs/common');let VerificationController=class VerificationController{constructor(_0x142e80,_0x770885,_0x3468f8){const _0x34fdfd=_0x2eba97;this[_0x34fdfd(0x1c0)]=_0x142e80,this[_0x34fdfd(0x1f7)]=_0x770885,this[_0x34fdfd(0x1fe)]=_0x3468f8;}async[_0x2eba97(0x1f8)](_0x28be9f){const _0x2903fc=_0x2eba97,_0x30347f=_0x28be9f[_0x2903fc(0x1b6)]['id'],_0x45242d=await this['userService'][_0x2903fc(0x1ea)](_0x30347f),_0x26b109=await this[_0x2903fc(0x1fe)]['getConfigs']([_0x2903fc(0x1ae)]),_0x195f75=_0x26b109[_0x2903fc(0x1ae)]?Number(_0x26b109[_0x2903fc(0x1ae)]):0x3c;return await this[_0x2903fc(0x1c0)][_0x2903fc(0x1c2)](_0x45242d,verification_constant_1[_0x2903fc(0x1db)]['ThirdPartyAuth'],_0x195f75);}async[_0x2eba97(0x1e8)](_0x5903ae){const _0x27129a=_0x2eba97,_0x159001={'id':_0x5903ae['id'],'code':Number(_0x5903ae['code'])};return await this['verificationService'][_0x27129a(0x1b5)](_0x159001,verification_constant_1['VerificationEnum'][_0x27129a(0x1f5)]);}async[_0x2eba97(0x1ff)](_0x2f9a3d){const _0xa5ee90=_0x2eba97,{phone:_0x13413f,type:_0x18bb3c}=_0x2f9a3d;if(_0x18bb3c!==verification_constant_1[_0xa5ee90(0x1db)][_0xa5ee90(0x1c6)]&&_0x18bb3c!==verification_constant_1[_0xa5ee90(0x1db)]['PasswordReset'])throw new common_2[(_0xa5ee90(0x1b1))]('不支持的验证码类型',common_1[_0xa5ee90(0x1f9)][_0xa5ee90(0x1e3)]);const _0x14b1d8={'id':0x0,'email':'','phone':_0x13413f},_0x36d9c4=await this[_0xa5ee90(0x1c0)]['createVerification'](_0x14b1d8,_0x18bb3c);return await this[_0xa5ee90(0x1c0)][_0xa5ee90(0x1f4)]({'phone':_0x13413f,'code':_0x36d9c4[_0xa5ee90(0x1f2)]});}async[_0x2eba97(0x1b0)](_0x11dc5a,_0x50ff29){const _0x5e72d9=_0x2eba97,_0x25e8e6=_0x50ff29['user']['id'],_0x2ff183=await this[_0x5e72d9(0x1f7)]['getUserById'](_0x25e8e6),_0x4d5473=await this[_0x5e72d9(0x1c0)][_0x5e72d9(0x1c2)](Object[_0x5e72d9(0x1cb)](Object[_0x5e72d9(0x1cb)]({},_0x2ff183),{'email':_0x11dc5a[_0x5e72d9(0x1e4)]}),verification_constant_1[_0x5e72d9(0x1db)]['ChangeEmail']);return await this[_0x5e72d9(0x1c0)][_0x5e72d9(0x1b0)]({'email':_0x11dc5a[_0x5e72d9(0x1e4)],'code':_0x4d5473['code']});}};__decorate([(0x0,common_1[_0x2eba97(0x1b3)])(_0x2eba97(0x1f1)),(0x0,common_1[_0x2eba97(0x200)])((0x0,passport_1[_0x2eba97(0x1f6)])(_0x2eba97(0x204))),(0x0,swagger_1['ApiBearerAuth'])(),(0x0,swagger_1[_0x2eba97(0x202)])({'summary':_0x2eba97(0x1d6),'description':_0x2eba97(0x1d7)}),(0x0,swagger_1[_0x2eba97(0x1fa)])({'status':common_1[_0x2eba97(0x1f9)]['OK'],'description':_0x2eba97(0x1dd),'schema':{'type':'object','properties':{'id':{'type':_0x2eba97(0x20b),'description':'验证码ID'},'code':{'type':_0x2eba97(0x20b),'description':_0x2eba97(0x1cd)},'userId':{'type':'number','description':_0x2eba97(0x1b2)},'type':{'type':_0x2eba97(0x20b),'description':'验证码类型'},'expiresAt':{'type':_0x2eba97(0x205),'format':_0x2eba97(0x1dc),'description':_0x2eba97(0x1e9)},'used':{'type':_0x2eba97(0x20b),'description':'是否已使用，0未使用，1已使用'}}}}),(0x0,swagger_1['ApiResponse'])({'status':common_1[_0x2eba97(0x1f9)][_0x2eba97(0x1bc)],'description':_0x2eba97(0x1d1)}),__param(0x0,(0x0,common_1['Req'])()),__metadata(_0x2eba97(0x1e5),Function),__metadata(_0x2eba97(0x1e2),[Object]),__metadata(_0x2eba97(0x1ed),Promise)],VerificationController[_0x2eba97(0x1d5)],_0x2eba97(0x1f8),null),__decorate([(0x0,common_1[_0x2eba97(0x1b3)])(_0x2eba97(0x1d3)),(0x0,swagger_1[_0x2eba97(0x202)])({'summary':'验证第三方应用认证码','description':_0x2eba97(0x1ad)}),(0x0,swagger_1[_0x2eba97(0x1fc)])({'type':verifyCode_dto_1[_0x2eba97(0x1d2)]}),(0x0,swagger_1['ApiResponse'])({'status':common_1[_0x2eba97(0x1f9)]['OK'],'description':_0x2eba97(0x1de),'schema':{'type':_0x2eba97(0x1bb),'properties':{'success':{'type':_0x2eba97(0x1b4),'description':_0x2eba97(0x207)},'message':{'type':_0x2eba97(0x205),'description':'验证结果消息'}}}}),(0x0,swagger_1[_0x2eba97(0x1fa)])({'status':common_1[_0x2eba97(0x1f9)][_0x2eba97(0x1e3)],'description':_0x2eba97(0x1ef),'schema':{'type':_0x2eba97(0x1bb),'properties':{'message':{'type':_0x2eba97(0x205),'description':_0x2eba97(0x20a)},'error':{'type':'string','description':_0x2eba97(0x1ba)},'statusCode':{'type':_0x2eba97(0x20b),'description':_0x2eba97(0x20c)}}}}),__param(0x0,(0x0,common_1[_0x2eba97(0x1c4)])()),__metadata(_0x2eba97(0x1e5),Function),__metadata('design:paramtypes',[verifyCode_dto_1[_0x2eba97(0x1d2)]]),__metadata(_0x2eba97(0x1ed),Promise)],VerificationController[_0x2eba97(0x1d5)],_0x2eba97(0x1e8),null),__decorate([(0x0,common_1[_0x2eba97(0x1b3)])(_0x2eba97(0x1f3)),(0x0,swagger_1[_0x2eba97(0x202)])({'summary':'发送短信验证码','description':_0x2eba97(0x1c1)}),(0x0,swagger_1['ApiResponse'])({'status':common_1['HttpStatus']['OK'],'description':_0x2eba97(0x201),'type':Boolean}),(0x0,swagger_1[_0x2eba97(0x1fa)])({'status':common_1[_0x2eba97(0x1f9)][_0x2eba97(0x1e3)],'description':'发送失败，可能是因为发送太频繁或参数错误'}),__param(0x0,(0x0,common_1[_0x2eba97(0x1c4)])()),__metadata(_0x2eba97(0x1e5),Function),__metadata('design:paramtypes',[Object]),__metadata(_0x2eba97(0x1ed),Promise)],VerificationController[_0x2eba97(0x1d5)],_0x2eba97(0x1ff),null),__decorate([(0x0,common_1[_0x2eba97(0x1b3)])('send-email'),(0x0,swagger_1['ApiOperation'])({'summary':'发送邮箱验证码','description':_0x2eba97(0x1b8)}),(0x0,swagger_1[_0x2eba97(0x1fa)])({'status':common_1[_0x2eba97(0x1f9)]['OK'],'description':_0x2eba97(0x201),'type':Boolean}),(0x0,swagger_1[_0x2eba97(0x1fa)])({'status':common_1['HttpStatus'][_0x2eba97(0x1e3)],'description':_0x2eba97(0x1e7)}),(0x0,common_1[_0x2eba97(0x200)])((0x0,passport_1[_0x2eba97(0x1f6)])(_0x2eba97(0x204))),(0x0,swagger_1[_0x2eba97(0x1fd)])(),__param(0x0,(0x0,common_1[_0x2eba97(0x1c4)])()),__param(0x1,(0x0,common_1[_0x2eba97(0x1ec)])()),__metadata(_0x2eba97(0x1e5),Function),__metadata(_0x2eba97(0x1e2),[Object,Object]),__metadata('design:returntype',Promise)],VerificationController[_0x2eba97(0x1d5)],_0x2eba97(0x1b0),null),VerificationController=__decorate([(0x0,swagger_1[_0x2eba97(0x1e0)])(_0x2eba97(0x1cd)),(0x0,common_1[_0x2eba97(0x1cc)])('verification'),__metadata(_0x2eba97(0x1e2),[verification_service_1[_0x2eba97(0x1fb)],user_service_1[_0x2eba97(0x1d4)],globalConfig_service_1[_0x2eba97(0x1cf)]])],VerificationController),exports['VerificationController']=VerificationController;