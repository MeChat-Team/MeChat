'use strict';const _0x3b8c77=_0x4b66;(function(_0x36165c,_0x418032){const _0x40b326=_0x4b66,_0xe7b7a2=_0x36165c();while(!![]){try{const _0x2a7494=parseInt(_0x40b326(0x1c3))/0x1*(parseInt(_0x40b326(0x1e6))/0x2)+-parseInt(_0x40b326(0x1e7))/0x3+parseInt(_0x40b326(0x1fa))/0x4*(parseInt(_0x40b326(0x1ed))/0x5)+-parseInt(_0x40b326(0x1ea))/0x6+-parseInt(_0x40b326(0x1ba))/0x7+parseInt(_0x40b326(0x1dd))/0x8*(parseInt(_0x40b326(0x1d4))/0x9)+-parseInt(_0x40b326(0x1b9))/0xa;if(_0x2a7494===_0x418032)break;else _0xe7b7a2['push'](_0xe7b7a2['shift']());}catch(_0x10fbfc){_0xe7b7a2['push'](_0xe7b7a2['shift']());}}}(_0x4854,0x9ae31));var __decorate=this&&this[_0x3b8c77(0x1eb)]||function(_0x1f7c5b,_0x507587,_0x37e252,_0x1fee64){const _0x2717f3=_0x3b8c77;var _0x237e9c=arguments[_0x2717f3(0x1d7)],_0x246f74=_0x237e9c<0x3?_0x507587:_0x1fee64===null?_0x1fee64=Object[_0x2717f3(0x1f4)](_0x507587,_0x37e252):_0x1fee64,_0x466c8d;if(typeof Reflect==='object'&&typeof Reflect[_0x2717f3(0x1b6)]===_0x2717f3(0x1d5))_0x246f74=Reflect[_0x2717f3(0x1b6)](_0x1f7c5b,_0x507587,_0x37e252,_0x1fee64);else{for(var _0x3c7af0=_0x1f7c5b[_0x2717f3(0x1d7)]-0x1;_0x3c7af0>=0x0;_0x3c7af0--)if(_0x466c8d=_0x1f7c5b[_0x3c7af0])_0x246f74=(_0x237e9c<0x3?_0x466c8d(_0x246f74):_0x237e9c>0x3?_0x466c8d(_0x507587,_0x37e252,_0x246f74):_0x466c8d(_0x507587,_0x37e252))||_0x246f74;}return _0x237e9c>0x3&&_0x246f74&&Object[_0x2717f3(0x205)](_0x507587,_0x37e252,_0x246f74),_0x246f74;},__metadata=this&&this[_0x3b8c77(0x20a)]||function(_0x5966ea,_0x5481b1){const _0x1a8540=_0x3b8c77;if(typeof Reflect===_0x1a8540(0x1de)&&typeof Reflect[_0x1a8540(0x1cc)]===_0x1a8540(0x1d5))return Reflect[_0x1a8540(0x1cc)](_0x5966ea,_0x5481b1);},__param=this&&this['__param']||function(_0x5cf253,_0x40388b){return function(_0x16bb9e,_0x46c642){_0x40388b(_0x16bb9e,_0x46c642,_0x5cf253);};};Object[_0x3b8c77(0x205)](exports,'__esModule',{'value':!![]}),exports[_0x3b8c77(0x201)]=void 0x0;function _0x4854(){const _0x3eca29=['生成第三方应用认证验证码','验证码无效或已过期','ApiTags','decorate','验证第三方应用认证码','verificationService','3649150mBVjRK','6876058OvHIOe','验证码验证成功','是否已使用，0未使用，1已使用','verifyThirdPartyCode','UNAUTHORIZED','发送短信验证码','getConfigs','发送邮箱验证码','verifyCode','766995ZgEgya','ApiOperation','number','third-party/generate','验证结果消息','用户ID','send-email','Req','AuthGuard','metadata','prototype','过期时间','thirdPartyAuthExpir','send-sms','@nestjs/passport','验证码发送成功','GlobalConfigService','9QyAbeE','function','sendSmsCode','length','date-time','UseGuards','string','jwt','design:paramtypes','9714512GPisJe','object','Controller','code','HttpStatus','VerificationEnum','验证用户提供的第三方应用认证码是否有效','JWT认证失败','ApiResponse','2iauIWQ','8445xVwASa','ApiBearerAuth','发送短信验证码（注册或重置密码），验证码5分钟内有效。同一手机号1分钟内只能发送一次。','5837334nFfgPd','__decorate','email','5tgtbUf','Body','VerifyCodeDto','发送失败，可能是因为发送太频繁或参数错误','VerificationService','boolean','../user/user.service','getOwnPropertyDescriptor','BAD_REQUEST','不支持的验证码类型','Post','验证码生成成功','createVerification','3904084aXpRjJ','userService','verification','状态码','./verification.service','getUserById','globalConfigService','VerificationController','design:type','design:returntype','PasswordReset','defineProperty','../globalConfig/globalConfig.service','sendEmailCode','错误类型','ThirdPartyAuth','__metadata','@nestjs/swagger','@nestjs/common'];_0x4854=function(){return _0x3eca29;};return _0x4854();}const common_1=require(_0x3b8c77(0x20c)),swagger_1=require(_0x3b8c77(0x20b)),verification_service_1=require(_0x3b8c77(0x1fe)),verification_constant_1=require('../../common/constants/verification.constant'),passport_1=require(_0x3b8c77(0x1d1)),user_service_1=require(_0x3b8c77(0x1f3)),verifyCode_dto_1=require('./dto/verifyCode.dto'),globalConfig_service_1=require(_0x3b8c77(0x206)),common_2=require(_0x3b8c77(0x20c));function _0x4b66(_0x36d724,_0x4df2c0){const _0x485414=_0x4854();return _0x4b66=function(_0x4b6669,_0x57a827){_0x4b6669=_0x4b6669-0x1b5;let _0x3e0e7d=_0x485414[_0x4b6669];return _0x3e0e7d;},_0x4b66(_0x36d724,_0x4df2c0);}let VerificationController=class VerificationController{constructor(_0x43db01,_0x20b4f2,_0xf8b00a){const _0x88e154=_0x3b8c77;this[_0x88e154(0x1b8)]=_0x43db01,this[_0x88e154(0x1fb)]=_0x20b4f2,this[_0x88e154(0x200)]=_0xf8b00a;}async['generateThirdPartyCode'](_0x4c79c8){const _0x110613=_0x3b8c77,_0x1a5e61=_0x4c79c8['user']['id'],_0x26441c=await this[_0x110613(0x1fb)][_0x110613(0x1ff)](_0x1a5e61),_0x11b2aa=await this[_0x110613(0x200)][_0x110613(0x1c0)](['thirdPartyAuthExpir']),_0x16a0ef=_0x11b2aa[_0x110613(0x1cf)]?Number(_0x11b2aa[_0x110613(0x1cf)]):0x3c;return await this[_0x110613(0x1b8)][_0x110613(0x1f9)](_0x26441c,verification_constant_1[_0x110613(0x1e2)][_0x110613(0x209)],_0x16a0ef);}async[_0x3b8c77(0x1bd)](_0x1be640){const _0x348a13=_0x3b8c77,_0xfdaa84={'id':_0x1be640['id'],'code':Number(_0x1be640[_0x348a13(0x1e0)])};return await this['verificationService'][_0x348a13(0x1c2)](_0xfdaa84,verification_constant_1['VerificationEnum']['ThirdPartyAuth']);}async[_0x3b8c77(0x1d6)](_0x154516){const _0x58a0c2=_0x3b8c77,{phone:_0x19acca,type:_0x3f8d44}=_0x154516;if(_0x3f8d44!==verification_constant_1[_0x58a0c2(0x1e2)]['Registration']&&_0x3f8d44!==verification_constant_1['VerificationEnum'][_0x58a0c2(0x204)])throw new common_2['HttpException'](_0x58a0c2(0x1f6),common_1[_0x58a0c2(0x1e1)][_0x58a0c2(0x1f5)]);const _0x13eb24={'id':0x0,'email':'','phone':_0x19acca},_0x1106c8=await this[_0x58a0c2(0x1b8)]['createVerification'](_0x13eb24,_0x3f8d44);return await this[_0x58a0c2(0x1b8)]['sendPhoneCode']({'phone':_0x19acca,'code':_0x1106c8['code']});}async['sendEmailCode'](_0x42d7b2,_0xaa5f7e){const _0x52ea88=_0x3b8c77,_0x3c3e19=_0xaa5f7e['user']['id'],_0x4813ca=await this[_0x52ea88(0x1fb)]['getUserById'](_0x3c3e19),_0x1e9305=await this['verificationService'][_0x52ea88(0x1f9)](Object['assign'](Object['assign']({},_0x4813ca),{'email':_0x42d7b2[_0x52ea88(0x1ec)]}),verification_constant_1['VerificationEnum']['ChangeEmail']);return await this['verificationService'][_0x52ea88(0x207)]({'email':_0x42d7b2[_0x52ea88(0x1ec)],'code':_0x1e9305[_0x52ea88(0x1e0)]});}};__decorate([(0x0,common_1[_0x3b8c77(0x1f7)])(_0x3b8c77(0x1c6)),(0x0,common_1['UseGuards'])((0x0,passport_1[_0x3b8c77(0x1cb)])(_0x3b8c77(0x1db))),(0x0,swagger_1[_0x3b8c77(0x1e8)])(),(0x0,swagger_1[_0x3b8c77(0x1c4)])({'summary':_0x3b8c77(0x20d),'description':'生成一个用于第三方应用认证的验证码，需要JWT认证。验证码默认1分钟后过期。'}),(0x0,swagger_1[_0x3b8c77(0x1e5)])({'status':common_1['HttpStatus']['OK'],'description':_0x3b8c77(0x1f8),'schema':{'type':_0x3b8c77(0x1de),'properties':{'id':{'type':'number','description':'验证码ID'},'code':{'type':_0x3b8c77(0x1c5),'description':'验证码'},'userId':{'type':_0x3b8c77(0x1c5),'description':_0x3b8c77(0x1c8)},'type':{'type':_0x3b8c77(0x1c5),'description':'验证码类型'},'expiresAt':{'type':_0x3b8c77(0x1da),'format':_0x3b8c77(0x1d8),'description':_0x3b8c77(0x1ce)},'used':{'type':'number','description':_0x3b8c77(0x1bc)}}}}),(0x0,swagger_1[_0x3b8c77(0x1e5)])({'status':common_1[_0x3b8c77(0x1e1)][_0x3b8c77(0x1be)],'description':_0x3b8c77(0x1e4)}),__param(0x0,(0x0,common_1[_0x3b8c77(0x1ca)])()),__metadata(_0x3b8c77(0x202),Function),__metadata('design:paramtypes',[Object]),__metadata(_0x3b8c77(0x203),Promise)],VerificationController[_0x3b8c77(0x1cd)],'generateThirdPartyCode',null),__decorate([(0x0,common_1[_0x3b8c77(0x1f7)])('third-party/verify'),(0x0,swagger_1[_0x3b8c77(0x1c4)])({'summary':_0x3b8c77(0x1b7),'description':_0x3b8c77(0x1e3)}),(0x0,swagger_1['ApiBody'])({'type':verifyCode_dto_1[_0x3b8c77(0x1ef)]}),(0x0,swagger_1[_0x3b8c77(0x1e5)])({'status':common_1['HttpStatus']['OK'],'description':_0x3b8c77(0x1bb),'schema':{'type':_0x3b8c77(0x1de),'properties':{'success':{'type':_0x3b8c77(0x1f2),'description':'验证是否成功'},'message':{'type':_0x3b8c77(0x1da),'description':_0x3b8c77(0x1c7)}}}}),(0x0,swagger_1['ApiResponse'])({'status':common_1[_0x3b8c77(0x1e1)][_0x3b8c77(0x1f5)],'description':_0x3b8c77(0x20e),'schema':{'type':_0x3b8c77(0x1de),'properties':{'message':{'type':_0x3b8c77(0x1da),'description':'错误信息'},'error':{'type':'string','description':_0x3b8c77(0x208)},'statusCode':{'type':'number','description':_0x3b8c77(0x1fd)}}}}),__param(0x0,(0x0,common_1[_0x3b8c77(0x1ee)])()),__metadata(_0x3b8c77(0x202),Function),__metadata(_0x3b8c77(0x1dc),[verifyCode_dto_1['VerifyCodeDto']]),__metadata(_0x3b8c77(0x203),Promise)],VerificationController[_0x3b8c77(0x1cd)],_0x3b8c77(0x1bd),null),__decorate([(0x0,common_1[_0x3b8c77(0x1f7)])(_0x3b8c77(0x1d0)),(0x0,swagger_1[_0x3b8c77(0x1c4)])({'summary':_0x3b8c77(0x1bf),'description':_0x3b8c77(0x1e9)}),(0x0,swagger_1[_0x3b8c77(0x1e5)])({'status':common_1[_0x3b8c77(0x1e1)]['OK'],'description':_0x3b8c77(0x1d2),'type':Boolean}),(0x0,swagger_1[_0x3b8c77(0x1e5)])({'status':common_1[_0x3b8c77(0x1e1)][_0x3b8c77(0x1f5)],'description':_0x3b8c77(0x1f0)}),__param(0x0,(0x0,common_1['Body'])()),__metadata('design:type',Function),__metadata('design:paramtypes',[Object]),__metadata(_0x3b8c77(0x203),Promise)],VerificationController[_0x3b8c77(0x1cd)],_0x3b8c77(0x1d6),null),__decorate([(0x0,common_1[_0x3b8c77(0x1f7)])(_0x3b8c77(0x1c9)),(0x0,swagger_1['ApiOperation'])({'summary':_0x3b8c77(0x1c1),'description':'发送邮箱验证码（换绑邮箱），验证码30分钟内有效。同一邮箱1分钟内只能发送一次。'}),(0x0,swagger_1[_0x3b8c77(0x1e5)])({'status':common_1[_0x3b8c77(0x1e1)]['OK'],'description':_0x3b8c77(0x1d2),'type':Boolean}),(0x0,swagger_1[_0x3b8c77(0x1e5)])({'status':common_1['HttpStatus']['BAD_REQUEST'],'description':_0x3b8c77(0x1f0)}),(0x0,common_1[_0x3b8c77(0x1d9)])((0x0,passport_1[_0x3b8c77(0x1cb)])(_0x3b8c77(0x1db))),(0x0,swagger_1['ApiBearerAuth'])(),__param(0x0,(0x0,common_1[_0x3b8c77(0x1ee)])()),__param(0x1,(0x0,common_1[_0x3b8c77(0x1ca)])()),__metadata(_0x3b8c77(0x202),Function),__metadata(_0x3b8c77(0x1dc),[Object,Object]),__metadata(_0x3b8c77(0x203),Promise)],VerificationController[_0x3b8c77(0x1cd)],_0x3b8c77(0x207),null),VerificationController=__decorate([(0x0,swagger_1[_0x3b8c77(0x1b5)])('验证码'),(0x0,common_1[_0x3b8c77(0x1df)])(_0x3b8c77(0x1fc)),__metadata('design:paramtypes',[verification_service_1[_0x3b8c77(0x1f1)],user_service_1['UserService'],globalConfig_service_1[_0x3b8c77(0x1d3)]])],VerificationController),exports[_0x3b8c77(0x201)]=VerificationController;