'use strict';const _0x221ed3=_0x4eaf;(function(_0x159a38,_0x3ba6b2){const _0x47ee4f=_0x4eaf,_0x59eb3d=_0x159a38();while(!![]){try{const _0x16b9c0=-parseInt(_0x47ee4f(0x203))/0x1*(-parseInt(_0x47ee4f(0x213))/0x2)+parseInt(_0x47ee4f(0x1d2))/0x3+parseInt(_0x47ee4f(0x1cc))/0x4*(-parseInt(_0x47ee4f(0x1e3))/0x5)+parseInt(_0x47ee4f(0x20c))/0x6*(parseInt(_0x47ee4f(0x1df))/0x7)+-parseInt(_0x47ee4f(0x1ea))/0x8+parseInt(_0x47ee4f(0x220))/0x9*(-parseInt(_0x47ee4f(0x1e1))/0xa)+-parseInt(_0x47ee4f(0x1db))/0xb*(-parseInt(_0x47ee4f(0x20e))/0xc);if(_0x16b9c0===_0x3ba6b2)break;else _0x59eb3d['push'](_0x59eb3d['shift']());}catch(_0xd319f2){_0x59eb3d['push'](_0x59eb3d['shift']());}}}(_0x5a43,0x702c0));var __decorate=this&&this[_0x221ed3(0x1f1)]||function(_0x51f96f,_0x1dcc28,_0x1bedb2,_0x5c75c9){const _0x51bbbd=_0x221ed3;var _0x1a96b1=arguments[_0x51bbbd(0x1e7)],_0x28e940=_0x1a96b1<0x3?_0x1dcc28:_0x5c75c9===null?_0x5c75c9=Object[_0x51bbbd(0x21d)](_0x1dcc28,_0x1bedb2):_0x5c75c9,_0x3ee3a4;if(typeof Reflect===_0x51bbbd(0x1e9)&&typeof Reflect[_0x51bbbd(0x1d1)]===_0x51bbbd(0x215))_0x28e940=Reflect[_0x51bbbd(0x1d1)](_0x51f96f,_0x1dcc28,_0x1bedb2,_0x5c75c9);else{for(var _0x4659db=_0x51f96f[_0x51bbbd(0x1e7)]-0x1;_0x4659db>=0x0;_0x4659db--)if(_0x3ee3a4=_0x51f96f[_0x4659db])_0x28e940=(_0x1a96b1<0x3?_0x3ee3a4(_0x28e940):_0x1a96b1>0x3?_0x3ee3a4(_0x1dcc28,_0x1bedb2,_0x28e940):_0x3ee3a4(_0x1dcc28,_0x1bedb2))||_0x28e940;}return _0x1a96b1>0x3&&_0x28e940&&Object[_0x51bbbd(0x205)](_0x1dcc28,_0x1bedb2,_0x28e940),_0x28e940;},__metadata=this&&this[_0x221ed3(0x214)]||function(_0x44c678,_0x51cbfa){const _0x30b215=_0x221ed3;if(typeof Reflect==='object'&&typeof Reflect[_0x30b215(0x1f3)]===_0x30b215(0x215))return Reflect['metadata'](_0x44c678,_0x51cbfa);},__param=this&&this['__param']||function(_0x5aa7e7,_0x52204e){return function(_0x13b643,_0x16bbb7){_0x52204e(_0x13b643,_0x16bbb7,_0x5aa7e7);};};Object[_0x221ed3(0x205)](exports,_0x221ed3(0x201),{'value':!![]}),exports['VerificationController']=void 0x0;function _0x5a43(){const _0x693b83=['Post','@nestjs/swagger','prototype','BAD_REQUEST','PasswordReset','Body','发送短信验证码','4460LgKHnb','userService','sendEmailCode','错误类型','UseGuards','decorate','335226UcYbyJ','Req','./verification.service','用户ID','thirdPartyAuthExpir','verificationService','send-email','third-party/verify','sendPhoneCode','4330403kXItOm','email','验证码生成成功','string','91RtygNf','生成一个用于第三方应用认证的验证码，需要JWT认证。验证码默认1分钟后过期。','370JrxcRF','verifyThirdPartyCode','1775lwkGji','验证码无效或已过期','HttpStatus','./dto/verifyCode.dto','length','ApiBody','object','221408BJZVZJ','发送短信验证码（注册或重置密码），验证码5分钟内有效。同一手机号1分钟内只能发送一次。','VerificationController','design:returntype','是否已使用，0未使用，1已使用','VerificationEnum','ApiTags','__decorate','VerifyCodeDto','metadata','../user/user.service','sendSmsCode','验证码ID','boolean','@nestjs/common','验证结果消息','验证用户提供的第三方应用认证码是否有效','number','../globalConfig/globalConfig.service','ApiOperation','验证码发送成功','design:type','createVerification','__esModule','globalConfigService','19997TVzYyM','不支持的验证码类型','defineProperty','getUserById','验证码验证成功','code','AuthGuard','jwt','JWT认证失败','149502HWYRPn','verification','12UTxJft','assign','generateThirdPartyCode','Registration','verifyCode','14EAUhnW','__metadata','function','发送邮箱验证码','design:paramtypes','Controller','send-sms','生成第三方应用认证验证码','user','ApiResponse','getOwnPropertyDescriptor','GlobalConfigService','getConfigs','21006WlQajE','验证码','ThirdPartyAuth'];_0x5a43=function(){return _0x693b83;};return _0x5a43();}const common_1=require(_0x221ed3(0x1f8)),swagger_1=require(_0x221ed3(0x224)),verification_service_1=require(_0x221ed3(0x1d4)),verification_constant_1=require('../../common/constants/verification.constant'),passport_1=require('@nestjs/passport'),user_service_1=require(_0x221ed3(0x1f4)),verifyCode_dto_1=require(_0x221ed3(0x1e6)),globalConfig_service_1=require(_0x221ed3(0x1fc)),common_2=require(_0x221ed3(0x1f8));let VerificationController=class VerificationController{constructor(_0x5880c7,_0x242706,_0x37110d){const _0x28a2ff=_0x221ed3;this[_0x28a2ff(0x1d7)]=_0x5880c7,this[_0x28a2ff(0x1cd)]=_0x242706,this[_0x28a2ff(0x202)]=_0x37110d;}async[_0x221ed3(0x210)](_0x50e194){const _0x1cf8b3=_0x221ed3,_0x18b065=_0x50e194[_0x1cf8b3(0x21b)]['id'],_0x2b4c0a=await this['userService']['getUserById'](_0x18b065),_0x46fa47=await this[_0x1cf8b3(0x202)][_0x1cf8b3(0x21f)](['thirdPartyAuthExpir']),_0x316498=_0x46fa47['thirdPartyAuthExpir']?Number(_0x46fa47[_0x1cf8b3(0x1d6)]):0x3c;return await this[_0x1cf8b3(0x1d7)][_0x1cf8b3(0x200)](_0x2b4c0a,verification_constant_1[_0x1cf8b3(0x1ef)][_0x1cf8b3(0x222)],_0x316498);}async[_0x221ed3(0x1e2)](_0x2ecdcc){const _0x225b67=_0x221ed3,_0x2eab44={'id':_0x2ecdcc['id'],'code':Number(_0x2ecdcc[_0x225b67(0x208)])};return await this[_0x225b67(0x1d7)][_0x225b67(0x212)](_0x2eab44,verification_constant_1['VerificationEnum'][_0x225b67(0x222)]);}async['sendSmsCode'](_0x5eebb7){const _0x57f9ae=_0x221ed3,{phone:_0x2d559e,type:_0x18412e}=_0x5eebb7;if(_0x18412e!==verification_constant_1['VerificationEnum'][_0x57f9ae(0x211)]&&_0x18412e!==verification_constant_1[_0x57f9ae(0x1ef)][_0x57f9ae(0x227)])throw new common_2['HttpException'](_0x57f9ae(0x204),common_1[_0x57f9ae(0x1e5)][_0x57f9ae(0x226)]);const _0x1834f5={'id':0x0,'email':'','phone':_0x2d559e},_0xad9d43=await this['verificationService'][_0x57f9ae(0x200)](_0x1834f5,_0x18412e);return await this[_0x57f9ae(0x1d7)][_0x57f9ae(0x1da)]({'phone':_0x2d559e,'code':_0xad9d43[_0x57f9ae(0x208)]});}async[_0x221ed3(0x1ce)](_0x449dde,_0x85b492){const _0x127220=_0x221ed3,_0x2b4820=_0x85b492[_0x127220(0x21b)]['id'],_0x18774f=await this[_0x127220(0x1cd)][_0x127220(0x206)](_0x2b4820),_0x38fecb=await this['verificationService']['createVerification'](Object[_0x127220(0x20f)](Object[_0x127220(0x20f)]({},_0x18774f),{'email':_0x449dde[_0x127220(0x1dc)]}),verification_constant_1[_0x127220(0x1ef)]['ChangeEmail']);return await this[_0x127220(0x1d7)][_0x127220(0x1ce)]({'email':_0x449dde[_0x127220(0x1dc)],'code':_0x38fecb[_0x127220(0x208)]});}};function _0x4eaf(_0x44ac3d,_0x537a53){const _0x5a43c1=_0x5a43();return _0x4eaf=function(_0x4eaf36,_0x321a1c){_0x4eaf36=_0x4eaf36-0x1cc;let _0x5b9e74=_0x5a43c1[_0x4eaf36];return _0x5b9e74;},_0x4eaf(_0x44ac3d,_0x537a53);}__decorate([(0x0,common_1['Post'])('third-party/generate'),(0x0,common_1[_0x221ed3(0x1d0)])((0x0,passport_1[_0x221ed3(0x209)])(_0x221ed3(0x20a))),(0x0,swagger_1['ApiBearerAuth'])(),(0x0,swagger_1[_0x221ed3(0x1fd)])({'summary':_0x221ed3(0x21a),'description':_0x221ed3(0x1e0)}),(0x0,swagger_1[_0x221ed3(0x21c)])({'status':common_1[_0x221ed3(0x1e5)]['OK'],'description':_0x221ed3(0x1dd),'schema':{'type':_0x221ed3(0x1e9),'properties':{'id':{'type':_0x221ed3(0x1fb),'description':_0x221ed3(0x1f6)},'code':{'type':_0x221ed3(0x1fb),'description':_0x221ed3(0x221)},'userId':{'type':_0x221ed3(0x1fb),'description':_0x221ed3(0x1d5)},'type':{'type':_0x221ed3(0x1fb),'description':'验证码类型'},'expiresAt':{'type':'string','format':'date-time','description':'过期时间'},'used':{'type':_0x221ed3(0x1fb),'description':_0x221ed3(0x1ee)}}}}),(0x0,swagger_1[_0x221ed3(0x21c)])({'status':common_1[_0x221ed3(0x1e5)]['UNAUTHORIZED'],'description':_0x221ed3(0x20b)}),__param(0x0,(0x0,common_1[_0x221ed3(0x1d3)])()),__metadata(_0x221ed3(0x1ff),Function),__metadata(_0x221ed3(0x217),[Object]),__metadata('design:returntype',Promise)],VerificationController[_0x221ed3(0x225)],_0x221ed3(0x210),null),__decorate([(0x0,common_1[_0x221ed3(0x223)])(_0x221ed3(0x1d9)),(0x0,swagger_1[_0x221ed3(0x1fd)])({'summary':'验证第三方应用认证码','description':_0x221ed3(0x1fa)}),(0x0,swagger_1[_0x221ed3(0x1e8)])({'type':verifyCode_dto_1[_0x221ed3(0x1f2)]}),(0x0,swagger_1['ApiResponse'])({'status':common_1['HttpStatus']['OK'],'description':_0x221ed3(0x207),'schema':{'type':'object','properties':{'success':{'type':_0x221ed3(0x1f7),'description':'验证是否成功'},'message':{'type':'string','description':_0x221ed3(0x1f9)}}}}),(0x0,swagger_1['ApiResponse'])({'status':common_1[_0x221ed3(0x1e5)][_0x221ed3(0x226)],'description':_0x221ed3(0x1e4),'schema':{'type':_0x221ed3(0x1e9),'properties':{'message':{'type':_0x221ed3(0x1de),'description':'错误信息'},'error':{'type':'string','description':_0x221ed3(0x1cf)},'statusCode':{'type':_0x221ed3(0x1fb),'description':'状态码'}}}}),__param(0x0,(0x0,common_1[_0x221ed3(0x228)])()),__metadata(_0x221ed3(0x1ff),Function),__metadata(_0x221ed3(0x217),[verifyCode_dto_1[_0x221ed3(0x1f2)]]),__metadata(_0x221ed3(0x1ed),Promise)],VerificationController[_0x221ed3(0x225)],'verifyThirdPartyCode',null),__decorate([(0x0,common_1['Post'])(_0x221ed3(0x219)),(0x0,swagger_1[_0x221ed3(0x1fd)])({'summary':_0x221ed3(0x229),'description':_0x221ed3(0x1eb)}),(0x0,swagger_1[_0x221ed3(0x21c)])({'status':common_1[_0x221ed3(0x1e5)]['OK'],'description':_0x221ed3(0x1fe),'type':Boolean}),(0x0,swagger_1[_0x221ed3(0x21c)])({'status':common_1[_0x221ed3(0x1e5)][_0x221ed3(0x226)],'description':'发送失败，可能是因为发送太频繁或参数错误'}),__param(0x0,(0x0,common_1[_0x221ed3(0x228)])()),__metadata(_0x221ed3(0x1ff),Function),__metadata(_0x221ed3(0x217),[Object]),__metadata(_0x221ed3(0x1ed),Promise)],VerificationController[_0x221ed3(0x225)],_0x221ed3(0x1f5),null),__decorate([(0x0,common_1[_0x221ed3(0x223)])(_0x221ed3(0x1d8)),(0x0,swagger_1['ApiOperation'])({'summary':_0x221ed3(0x216),'description':'发送邮箱验证码（换绑邮箱），验证码30分钟内有效。同一邮箱1分钟内只能发送一次。'}),(0x0,swagger_1[_0x221ed3(0x21c)])({'status':common_1[_0x221ed3(0x1e5)]['OK'],'description':_0x221ed3(0x1fe),'type':Boolean}),(0x0,swagger_1[_0x221ed3(0x21c)])({'status':common_1['HttpStatus']['BAD_REQUEST'],'description':'发送失败，可能是因为发送太频繁或参数错误'}),(0x0,common_1['UseGuards'])((0x0,passport_1[_0x221ed3(0x209)])(_0x221ed3(0x20a))),(0x0,swagger_1['ApiBearerAuth'])(),__param(0x0,(0x0,common_1[_0x221ed3(0x228)])()),__param(0x1,(0x0,common_1[_0x221ed3(0x1d3)])()),__metadata(_0x221ed3(0x1ff),Function),__metadata(_0x221ed3(0x217),[Object,Object]),__metadata(_0x221ed3(0x1ed),Promise)],VerificationController[_0x221ed3(0x225)],_0x221ed3(0x1ce),null),VerificationController=__decorate([(0x0,swagger_1[_0x221ed3(0x1f0)])(_0x221ed3(0x221)),(0x0,common_1[_0x221ed3(0x218)])(_0x221ed3(0x20d)),__metadata('design:paramtypes',[verification_service_1['VerificationService'],user_service_1['UserService'],globalConfig_service_1[_0x221ed3(0x21e)]])],VerificationController),exports[_0x221ed3(0x1ec)]=VerificationController;