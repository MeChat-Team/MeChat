'use strict';const _0x6e3eb0=_0x5ab1;(function(_0x4b2e75,_0x4661cb){const _0x4d8f5c=_0x5ab1,_0x462d0d=_0x4b2e75();while(!![]){try{const _0x29ca23=parseInt(_0x4d8f5c(0x265))/0x1+-parseInt(_0x4d8f5c(0x24e))/0x2*(-parseInt(_0x4d8f5c(0x1ed))/0x3)+-parseInt(_0x4d8f5c(0x20c))/0x4+-parseInt(_0x4d8f5c(0x24f))/0x5+parseInt(_0x4d8f5c(0x1fb))/0x6+parseInt(_0x4d8f5c(0x20f))/0x7*(parseInt(_0x4d8f5c(0x206))/0x8)+-parseInt(_0x4d8f5c(0x260))/0x9*(parseInt(_0x4d8f5c(0x1f7))/0xa);if(_0x29ca23===_0x4661cb)break;else _0x462d0d['push'](_0x462d0d['shift']());}catch(_0x5475a9){_0x462d0d['push'](_0x462d0d['shift']());}}}(_0x5e41,0x2ed68));var __decorate=this&&this[_0x6e3eb0(0x20b)]||function(_0x4180f4,_0x558a23,_0x107cb4,_0x482ee9){const _0x822ede=_0x6e3eb0;var _0x43dd75=arguments[_0x822ede(0x237)],_0x262908=_0x43dd75<0x3?_0x558a23:_0x482ee9===null?_0x482ee9=Object['getOwnPropertyDescriptor'](_0x558a23,_0x107cb4):_0x482ee9,_0x458dc9;if(typeof Reflect===_0x822ede(0x25f)&&typeof Reflect['decorate']===_0x822ede(0x26a))_0x262908=Reflect[_0x822ede(0x23c)](_0x4180f4,_0x558a23,_0x107cb4,_0x482ee9);else{for(var _0x374f2e=_0x4180f4['length']-0x1;_0x374f2e>=0x0;_0x374f2e--)if(_0x458dc9=_0x4180f4[_0x374f2e])_0x262908=(_0x43dd75<0x3?_0x458dc9(_0x262908):_0x43dd75>0x3?_0x458dc9(_0x558a23,_0x107cb4,_0x262908):_0x458dc9(_0x558a23,_0x107cb4))||_0x262908;}return _0x43dd75>0x3&&_0x262908&&Object[_0x822ede(0x257)](_0x558a23,_0x107cb4,_0x262908),_0x262908;},__metadata=this&&this[_0x6e3eb0(0x256)]||function(_0x4ce701,_0x49a9d5){const _0x4c6d9b=_0x6e3eb0;if(typeof Reflect==='object'&&typeof Reflect[_0x4c6d9b(0x209)]===_0x4c6d9b(0x26a))return Reflect[_0x4c6d9b(0x209)](_0x4ce701,_0x49a9d5);},__param=this&&this[_0x6e3eb0(0x1f9)]||function(_0x430ad6,_0x3f4d68){return function(_0x324c02,_0x1c79df){_0x3f4d68(_0x324c02,_0x1c79df,_0x430ad6);};};Object[_0x6e3eb0(0x257)](exports,'__esModule',{'value':!![]}),exports[_0x6e3eb0(0x254)]=void 0x0;function _0x5ab1(_0x18211e,_0x27da67){const _0x5e4113=_0x5e41();return _0x5ab1=function(_0x5ab118,_0x29bcb3){_0x5ab118=_0x5ab118-0x1e8;let _0x579bc2=_0x5e4113[_0x5ab118];return _0x579bc2;},_0x5ab1(_0x18211e,_0x27da67);}const balance_constant_1=require(_0x6e3eb0(0x224)),utils_1=require(_0x6e3eb0(0x261)),common_1=require('@nestjs/common'),typeorm_1=require(_0x6e3eb0(0x229)),exceljs_1=require('exceljs'),typeorm_2=require(_0x6e3eb0(0x211)),chatGroup_entity_1=require('../chatGroup/chatGroup.entity'),user_entity_1=require(_0x6e3eb0(0x244)),chatLog_entity_1=require('./chatLog.entity'),models_service_1=require(_0x6e3eb0(0x205));function _0x5e41(){const _0x337256=['super','你操作的图片不存在、请检查！','?imageView2/1/w/','isGroup','prompt','MoreThan','username','user','用户名','\x20模型\x20','log','687IMcVyk','type','userId','application/vnd.openxmlformats-officedocument.spreadsheetml.sheet','modelsService','forEach','model','Like','Repository','count','5650tEfhsb','你删除的对话记录不存在、请检查！','__param','InjectRepository','1931202rWFieI','dall-e-3','userEntity','gpt-4-gizmo','affected','answer','提问问题','thumbImg','chatHistory','saveChatLog','../models/models.service','407688ZuxZxj','findAndCount','extend','metadata','ali','__decorate','958072IYkQnj','createdAt','getCurrentModelKeyInfo','21aQTZUi','HttpException','typeorm','chatlog','用户邮箱','@aiweb.com','fileInfo','用户ID:\x20','提问时间','UserEntity','addRow','ChatGroupEntity','deleteChatLog','setHeader','/q/55','findOne','Not','formatDate','删除对话记录成功！','querAllDrawLog\x20Json\x20parse\x20error','avatar','../../common/constants/balance.constant','addWorksheet','update','DALL-E2','回答答案','@nestjs/typeorm','checkModelLimits','byAppId','querAllDrawLog','ceil','ChatType','PAINT','write','find','findOneChatLog','startsWith','updateChatLog','\x20一小时内调用\x20','role','length','email','includes','assistant','midjourney','decorate','default','Logger','userInfo','Content-Disposition','parse','delByGroupId','tencent','../user/user.entity','你推荐的图片不存在、请检查！','paintCount','查询数据库出错\x20-\x20用户ID:\x20','deleteChatsAfterId','MoreThanOrEqual','maskEmail','模型\x20','error','\x20的使用次数限制为\x20','2108tRbMFR','1367885RHuFLT','chatLogEntity','?x-oss-process=image/resize,w_',',\x20模型:\x20','当前页面已经没有东西可以删除了！','ChatLogService','assign','__metadata','defineProperty','图片成功！','gpts','querAllChatLog','recDrawImg','stable-diffusion',',\x20错误信息:\x20','reverse','object','2169NZlFHx','../../common/utils','HttpStatus','chatGroupEntity','exportExcel','124992pBfnqq','attachment;\x20filename=','NORMAL_CHAT','components','BAD_REQUEST','function','map','DESC'];_0x5e41=function(){return _0x337256;};return _0x5e41();}let ChatLogService=class ChatLogService{constructor(_0x6a2b7e,_0x5438e2,_0x2d4a43,_0x9da74e){const _0x155eea=_0x6e3eb0;this[_0x155eea(0x250)]=_0x6a2b7e,this[_0x155eea(0x1fd)]=_0x5438e2,this['chatGroupEntity']=_0x2d4a43,this[_0x155eea(0x1f1)]=_0x9da74e;}async[_0x6e3eb0(0x204)](_0x51e23f){const _0x14f0c5=_0x6e3eb0,_0x36920d=await this[_0x14f0c5(0x250)]['save'](_0x51e23f);return _0x36920d;}async[_0x6e3eb0(0x234)](_0x45bb83,_0x5a136c){const _0x133ad2=_0x6e3eb0;return await this[_0x133ad2(0x250)]['update']({'id':_0x45bb83},_0x5a136c);}async[_0x6e3eb0(0x232)](_0x27bf98){const _0x14f94a=_0x6e3eb0;return await this[_0x14f94a(0x250)]['findOne']({'where':{'id':_0x27bf98}});}async['querDrawLog'](_0x3ed59f,_0x4c4a3f){const _0x3f9995=_0x6e3eb0,{id:_0x5a7e84}=_0x3ed59f[_0x3f9995(0x1e9)],{model:_0x4cc97b}=_0x4c4a3f,_0x3ea4dc={'userId':_0x5a7e84,'type':balance_constant_1[_0x3f9995(0x22e)][_0x3f9995(0x22f)]};_0x4cc97b&&(_0x3ea4dc[_0x3f9995(0x1f3)]=_0x4cc97b,_0x4cc97b===_0x3f9995(0x227)&&(_0x3ea4dc['model']=(0x0,typeorm_2['In'])([_0x3f9995(0x227),_0x3f9995(0x1fc)])));const _0x2258c9=await this[_0x3f9995(0x250)][_0x3f9995(0x231)]({'where':_0x3ea4dc,'order':{'id':_0x3f9995(0x26c)},'select':['id',_0x3f9995(0x200),_0x3f9995(0x271),_0x3f9995(0x1f3),_0x3f9995(0x1ee),_0x3f9995(0x215)]});return _0x2258c9[_0x3f9995(0x1f2)](_0x254d55=>{const _0x50ae3b=_0x3f9995;if(_0x254d55[_0x50ae3b(0x1ee)]===_0x50ae3b(0x246)){const _0x46f043=_0x254d55[_0x50ae3b(0x1f3)]==='mj'?0x136:0xa0,_0x3e7341=_0x254d55[_0x50ae3b(0x200)][_0x50ae3b(0x239)]('cos')?'tencent':_0x50ae3b(0x20a),_0x262659=_0x3e7341===_0x50ae3b(0x243)?_0x50ae3b(0x26f)+_0x46f043+_0x50ae3b(0x21d):_0x50ae3b(0x251)+_0x46f043;_0x254d55[_0x50ae3b(0x202)]=_0x254d55[_0x50ae3b(0x200)]+_0x262659;try{_0x254d55[_0x50ae3b(0x215)]=_0x254d55['fileInfo']?JSON[_0x50ae3b(0x241)](_0x254d55[_0x50ae3b(0x215)]):null;}catch(_0x2ae843){_0x254d55[_0x50ae3b(0x215)]={};}}}),_0x2258c9;}async[_0x6e3eb0(0x22c)](_0xe43e8e){const _0x29d3cb=_0x6e3eb0,{page:page=0x1,size:size=0x14,rec:_0x13d251,userId:_0x4adb77,model:_0x2c79e5}=_0xe43e8e,_0x479c07={'type':0x2,'prompt':(0x0,typeorm_2[_0x29d3cb(0x21f)])(''),'answer':(0x0,typeorm_2[_0x29d3cb(0x21f)])(''),'fileInfo':(0x0,typeorm_2[_0x29d3cb(0x21f)])('')};_0x13d251&&Object[_0x29d3cb(0x255)](_0x479c07,{'rec':_0x13d251}),_0x4adb77&&Object[_0x29d3cb(0x255)](_0x479c07,{'userId':_0x4adb77});_0x2c79e5?_0x479c07[_0x29d3cb(0x1f3)]=_0x2c79e5:_0x479c07[_0x29d3cb(0x1f3)]=(0x0,typeorm_2['In'])([_0x29d3cb(0x23b),_0x29d3cb(0x1fc),_0x29d3cb(0x25c)]);const [_0x22bb83,_0x3a8938]=await this['chatLogEntity']['findAndCount']({'order':{'id':'DESC'},'skip':(page-0x1)*size,'take':size,'where':_0x479c07}),_0x1248c7=_0x22bb83[_0x29d3cb(0x26b)](_0x1e74a8=>_0x1e74a8[_0x29d3cb(0x1ef)])['filter'](_0x57401a=>_0x57401a<0x186a0),_0x56f434=await this[_0x29d3cb(0x1fd)][_0x29d3cb(0x231)]({'where':{'id':(0x0,typeorm_2['In'])(_0x1248c7)},'select':['id',_0x29d3cb(0x1e8),_0x29d3cb(0x223),_0x29d3cb(0x238)]});return _0x22bb83[_0x29d3cb(0x1f2)](_0x589450=>{const _0x27c47e=_0x29d3cb;_0x589450[_0x27c47e(0x23f)]=_0x56f434[_0x27c47e(0x231)](_0x54208d=>_0x54208d['id']===_0x589450[_0x27c47e(0x1ef)]);}),_0x22bb83[_0x29d3cb(0x1f2)](_0x3d8fa3=>{const _0x3f0682=_0x29d3cb;var _0x22f4cb;const _0x4ebb94=_0x3d8fa3[_0x3f0682(0x1f3)]===_0x3f0682(0x23b)?0x136:0xa0,_0x36a065=_0x3d8fa3[_0x3f0682(0x200)][_0x3f0682(0x239)]('cos')?_0x3f0682(0x243):_0x3f0682(0x20a),_0x5b9a1b=_0x36a065==='tencent'?_0x3f0682(0x26f)+_0x4ebb94+'/q/55':_0x3f0682(0x251)+_0x4ebb94;_0x3d8fa3[_0x3f0682(0x202)]=_0x3d8fa3['answer']+_0x5b9a1b;try{const _0x5773c4=_0x3d8fa3[_0x3f0682(0x208)]?JSON[_0x3f0682(0x241)](_0x3d8fa3[_0x3f0682(0x208)]):null;_0x5773c4&&(_0x5773c4?_0x3d8fa3[_0x3f0682(0x270)]=((_0x22f4cb=_0x5773c4===null||_0x5773c4===void 0x0?void 0x0:_0x5773c4[_0x3f0682(0x268)][0x0])===null||_0x22f4cb===void 0x0?void 0x0:_0x22f4cb[_0x3f0682(0x268)][_0x3f0682(0x237)])===0x5:_0x3d8fa3[_0x3f0682(0x270)]=![]);}catch(_0x324939){console[_0x3f0682(0x1ec)](_0x3f0682(0x222),_0x324939);}}),{'rows':_0x22bb83,'count':_0x3a8938};}async['findOneDrawLog'](_0x121ce7){const _0x10bad5=_0x6e3eb0,{id:_0x43e35a}=_0x121ce7,_0x28bead=await this[_0x10bad5(0x250)][_0x10bad5(0x21e)]({'where':{'id':_0x43e35a}});return _0x28bead;}async[_0x6e3eb0(0x25b)](_0x2042e8){const _0x586bb2=_0x6e3eb0,{id:_0x165bf4}=_0x2042e8,_0x1adc87=await this[_0x586bb2(0x250)][_0x586bb2(0x21e)]({'where':{'id':_0x165bf4,'type':balance_constant_1[_0x586bb2(0x22e)][_0x586bb2(0x22f)]}});if(!_0x1adc87)throw new common_1[(_0x586bb2(0x210))](_0x586bb2(0x245),common_1[_0x586bb2(0x262)]['BAD_REQUEST']);const _0x3a8904=_0x1adc87['rec']===0x1?0x0:0x1,_0x3ffb75=await this[_0x586bb2(0x250)]['update']({'id':_0x165bf4},{'rec':_0x3a8904});if(_0x3ffb75['affected']>0x0)return(_0x3a8904?'推荐':'取消推荐')+_0x586bb2(0x258);throw new common_1[(_0x586bb2(0x210))](_0x586bb2(0x26e),common_1['HttpStatus'][_0x586bb2(0x269)]);}async[_0x6e3eb0(0x264)](_0x3a5cc8,_0x5c46e5){const _0x5311d3=_0x6e3eb0,_0x3b14c2={'type':balance_constant_1[_0x5311d3(0x22e)][_0x5311d3(0x267)]},{page:page=0x1,size:size=0x1e,prompt:_0x151bb3,email:_0x43da84}=_0x3a5cc8;_0x151bb3&&Object[_0x5311d3(0x255)](_0x3b14c2,{'prompt':(0x0,typeorm_2[_0x5311d3(0x1f4)])('%'+_0x151bb3+'%')});if(_0x43da84){const _0x5cbab9=await this['userEntity'][_0x5311d3(0x21e)]({'where':{'email':_0x43da84}});(_0x5cbab9===null||_0x5cbab9===void 0x0?void 0x0:_0x5cbab9['id'])&&Object[_0x5311d3(0x255)](_0x3b14c2,{'userId':_0x5cbab9['id']});}const [_0x2ddb3f,_0xd4d59f]=await this[_0x5311d3(0x250)][_0x5311d3(0x207)]({'order':{'id':_0x5311d3(0x26c)},'skip':(page-0x1)*size,'take':size,'where':_0x3b14c2}),_0x11fee8=_0x2ddb3f[_0x5311d3(0x26b)](_0x256a26=>_0x256a26['userId']),_0x35ee3b=await this[_0x5311d3(0x1fd)][_0x5311d3(0x231)]({'where':{'id':(0x0,typeorm_2['In'])(_0x11fee8)}}),_0x16e976=_0x2ddb3f['map'](_0x125f4e=>{const _0x4da1d0=_0x5311d3,_0x2502ad=_0x35ee3b[_0x4da1d0(0x231)](_0x1fce12=>_0x1fce12['id']===_0x125f4e[_0x4da1d0(0x1ef)]);return{'username':_0x2502ad?_0x2502ad[_0x4da1d0(0x1e8)]:'','email':_0x2502ad?_0x2502ad[_0x4da1d0(0x238)]:'','prompt':_0x125f4e['prompt'],'answer':_0x125f4e[_0x4da1d0(0x200)],'createdAt':(0x0,utils_1[_0x4da1d0(0x220)])(_0x125f4e[_0x4da1d0(0x20d)])};}),_0x47336d=new exceljs_1[(_0x5311d3(0x23d))]['Workbook'](),_0x3cc40e=_0x47336d[_0x5311d3(0x225)](_0x5311d3(0x212));_0x3cc40e['columns']=[{'header':_0x5311d3(0x1ea),'key':_0x5311d3(0x1e8),'width':0x14},{'header':_0x5311d3(0x213),'key':_0x5311d3(0x238),'width':0x14},{'header':_0x5311d3(0x217),'key':_0x5311d3(0x20d),'width':0x14},{'header':_0x5311d3(0x201),'key':'prompt','width':0x50},{'header':_0x5311d3(0x228),'key':_0x5311d3(0x200),'width':0x96}],_0x16e976[_0x5311d3(0x1f2)](_0x40ee87=>_0x3cc40e[_0x5311d3(0x219)](_0x40ee87)),_0x5c46e5[_0x5311d3(0x21c)]('Content-Type',_0x5311d3(0x1f0)),_0x5c46e5[_0x5311d3(0x21c)](_0x5311d3(0x240),_0x5311d3(0x266)+'chat.xlsx'),await _0x47336d['xlsx'][_0x5311d3(0x230)](_0x5c46e5),_0x5c46e5['end']();}async[_0x6e3eb0(0x25a)](_0x261613,_0x12b471){const _0x5a153a=_0x6e3eb0,{page:page=0x1,size:size=0x14,userId:_0x53cc2e,prompt:_0x288795}=_0x261613,_0x37c290={'type':balance_constant_1[_0x5a153a(0x22e)]['NORMAL_CHAT'],'prompt':(0x0,typeorm_2['Not'])('')};_0x53cc2e&&Object[_0x5a153a(0x255)](_0x37c290,{'userId':_0x53cc2e}),_0x288795&&Object[_0x5a153a(0x255)](_0x37c290,{'prompt':(0x0,typeorm_2[_0x5a153a(0x1f4)])('%'+_0x288795+'%')});const [_0x39f333,_0xa76361]=await this[_0x5a153a(0x250)]['findAndCount']({'order':{'id':_0x5a153a(0x26c)},'skip':(page-0x1)*size,'take':size,'where':_0x37c290}),_0x4f3c81=_0x39f333[_0x5a153a(0x26b)](_0x34111c=>_0x34111c[_0x5a153a(0x1ef)]),_0x49bc22=await this['userEntity'][_0x5a153a(0x231)]({'where':{'id':(0x0,typeorm_2['In'])(_0x4f3c81)},'select':['id',_0x5a153a(0x1e8),_0x5a153a(0x238)]});return _0x39f333[_0x5a153a(0x1f2)](_0x3310f2=>{const _0x26bd74=_0x5a153a,{username:_0x42ad3c,email:_0x23fcf3}=_0x49bc22[_0x26bd74(0x231)](_0x40e026=>_0x40e026['id']===_0x3310f2[_0x26bd74(0x1ef)])||{};_0x3310f2[_0x26bd74(0x1e8)]=_0x42ad3c,_0x3310f2[_0x26bd74(0x238)]=_0x23fcf3;}),_0x12b471[_0x5a153a(0x1e9)][_0x5a153a(0x236)]!==_0x5a153a(0x26d)&&_0x39f333[_0x5a153a(0x1f2)](_0x14778e=>_0x14778e['email']=(0x0,utils_1[_0x5a153a(0x24a)])(_0x14778e[_0x5a153a(0x238)])),_0x39f333['forEach'](_0x814679=>{const _0x26ebdf=_0x5a153a;!_0x814679['email']&&(_0x814679[_0x26ebdf(0x238)]=(_0x814679===null||_0x814679===void 0x0?void 0x0:_0x814679[_0x26ebdf(0x1ef)])+_0x26ebdf(0x214)),!_0x814679[_0x26ebdf(0x1e8)]&&(_0x814679[_0x26ebdf(0x1e8)]='游客'+(_0x814679===null||_0x814679===void 0x0?void 0x0:_0x814679[_0x26ebdf(0x1ef)]));}),{'rows':_0x39f333,'count':_0xa76361};}async['chatList'](_0x3afdd2,_0x5ece70){const _0x318528=_0x6e3eb0,{id:_0x14cfe2}=_0x3afdd2[_0x318528(0x1e9)],{groupId:_0x20da71}=_0x5ece70,_0x2232df={'userId':_0x14cfe2,'isDelete':![]};_0x20da71&&Object[_0x318528(0x255)](_0x2232df,{'groupId':_0x20da71});if(_0x20da71){const _0x57e64a=await this[_0x318528(0x263)]['count']({'where':{'isDelete':![]}});if(_0x57e64a===0x0)return[];}const _0x4bcf07=await this[_0x318528(0x250)]['find']({'where':_0x2232df});return _0x4bcf07[_0x318528(0x26b)](_0x50368f=>{const _0xcb7720=_0x318528,{prompt:_0x5dd26d,role:_0x317e85,answer:_0x2baad1,createdAt:_0x4b8ff4,model:_0x1807b9,modelName:_0x2f271e,type:_0x5ed9ed,status:_0x59df1f,action:_0x5abf77,drawId:_0x57c3cf,id:_0x22b356,fileInfo:_0x2d14ee,ttsUrl:_0x18844f,videoUrl:_0x232408,audioUrl:_0x4dea2d,customId:_0x2cb72a,pluginParam:_0x485976,modelAvatar:_0x817534,taskData:_0x32c524,promptReference:_0x5809c2}=_0x50368f;return{'chatId':_0x22b356,'dateTime':(0x0,utils_1['formatDate'])(_0x4b8ff4),'text':_0x317e85==='user'?_0x5dd26d:_0x2baad1,'modelType':_0x5ed9ed,'status':_0x59df1f,'action':_0x5abf77,'drawId':_0x57c3cf,'customId':_0x2cb72a,'inversion':_0x317e85===_0xcb7720(0x1e9),'error':![],'fileInfo':_0x2d14ee,'ttsUrl':_0x18844f,'videoUrl':_0x232408,'audioUrl':_0x4dea2d,'model':_0x1807b9,'modelName':_0x2f271e,'pluginParam':_0x485976,'modelAvatar':_0x817534,'taskData':_0x32c524,'promptReference':_0x5809c2};});}async[_0x6e3eb0(0x203)](_0x23ab1f,_0x17a5dd){const _0x5b337a=_0x6e3eb0;if(_0x17a5dd===0x0)return[];const _0x4156e0={'isDelete':![],'groupId':_0x23ab1f},_0xcf984c=await this['chatLogEntity']['find']({'where':_0x4156e0,'order':{'createdAt':_0x5b337a(0x26c)},'take':_0x17a5dd*0x2}),_0x45e230=_0xcf984c[_0x5b337a(0x26b)](_0x544b73=>{const _0x1cca09=_0x5b337a,{role:_0x41da0f,prompt:_0x43c808,answer:_0x5c714a,fileInfo:_0x136fc2}=_0x544b73,_0x2cc19f={'role':_0x41da0f,'text':_0x41da0f===_0x1cca09(0x1e9)?_0x43c808:_0x5c714a,'fileInfo':_0x136fc2};return _0x2cc19f;})[_0x5b337a(0x25e)]();return _0x45e230;}async[_0x6e3eb0(0x21b)](_0x5be317,_0x58407c){const _0x5b8e52=_0x6e3eb0,{id:_0x885239}=_0x5be317[_0x5b8e52(0x1e9)],{id:_0x5a1f78}=_0x58407c,_0x13aff5=await this[_0x5b8e52(0x250)]['findOne']({'where':{'id':_0x5a1f78,'userId':_0x885239}});if(!_0x13aff5)throw new common_1['HttpException']('你删除的对话记录不存在、请检查！',common_1[_0x5b8e52(0x262)][_0x5b8e52(0x269)]);const _0x3f383f=await this[_0x5b8e52(0x250)][_0x5b8e52(0x226)]({'id':_0x5a1f78},{'isDelete':!![]});if(_0x3f383f[_0x5b8e52(0x1ff)]>0x0)return _0x5b8e52(0x221);else throw new common_1['HttpException'](_0x5b8e52(0x1f8),common_1[_0x5b8e52(0x262)][_0x5b8e52(0x269)]);}async[_0x6e3eb0(0x242)](_0x111b05,_0x2546b9){const _0x2c6caf=_0x6e3eb0,{groupId:_0x44823e}=_0x2546b9,{id:_0x2cae88}=_0x111b05[_0x2c6caf(0x1e9)],_0x4cbc92=await this[_0x2c6caf(0x263)]['findOne']({'where':{'id':_0x44823e,'userId':_0x2cae88}});if(!_0x4cbc92)throw new common_1[(_0x2c6caf(0x210))]('你删除的对话记录不存在、请检查！',common_1[_0x2c6caf(0x262)]['BAD_REQUEST']);const _0x453863=await this[_0x2c6caf(0x250)][_0x2c6caf(0x226)]({'groupId':_0x44823e},{'isDelete':!![]});if(_0x453863['affected']>0x0)return _0x2c6caf(0x221);if(_0x453863[_0x2c6caf(0x1ff)]===0x0)throw new common_1[(_0x2c6caf(0x210))](_0x2c6caf(0x253),common_1[_0x2c6caf(0x262)]['BAD_REQUEST']);}async[_0x6e3eb0(0x248)](_0x25e9c9,_0x2f2ac0){const _0x8af578=_0x6e3eb0,{id:_0xf231cc}=_0x2f2ac0,{id:_0x46d8f6}=_0x25e9c9['user'],_0x4c29a1=await this['chatLogEntity'][_0x8af578(0x21e)]({'where':{'id':_0xf231cc,'userId':_0x46d8f6}});if(!_0x4c29a1)throw new common_1[(_0x8af578(0x210))](_0x8af578(0x1f8),common_1[_0x8af578(0x262)][_0x8af578(0x269)]);const {groupId:_0x508d5c}=_0x4c29a1,_0x637784=await this[_0x8af578(0x250)][_0x8af578(0x226)]({'groupId':_0x508d5c,'id':(0x0,typeorm_2[_0x8af578(0x249)])(_0xf231cc)},{'isDelete':!![]});if(_0x637784[_0x8af578(0x1ff)]>0x0)return'删除对话记录成功！';else throw new common_1['HttpException']('当前页面已经没有东西可以删除了！',common_1['HttpStatus'][_0x8af578(0x269)]);}async[_0x6e3eb0(0x22b)](_0x5d93ad,_0x381e5c){const _0x38340a=_0x6e3eb0,{id:_0x1d6945}=_0x5d93ad['user'],{appId:_0x4fa724,page:page=0x1,size:size=0xa}=_0x381e5c,[_0x17c2fd,_0x58f48f]=await this[_0x38340a(0x250)][_0x38340a(0x207)]({'where':{'userId':_0x1d6945,'appId':_0x4fa724,'role':_0x38340a(0x23a)},'order':{'id':_0x38340a(0x26c)},'take':size,'skip':(page-0x1)*size});return{'rows':_0x17c2fd,'count':_0x58f48f};}async[_0x6e3eb0(0x22a)](_0x3560c2,_0x42e052){const _0x5df888=_0x6e3eb0,_0x41b8c7=0xe10*0x3e8,_0xbdfa64=new Date(Date['now']()-_0x41b8c7);try{const _0x2acb43=await this[_0x5df888(0x250)][_0x5df888(0x1f6)]({'where':{'userId':_0x3560c2['id'],'model':_0x42e052,'createdAt':(0x0,typeorm_2[_0x5df888(0x272)])(_0xbdfa64)}}),_0x338d79=Math[_0x5df888(0x22d)](_0x2acb43/0x2);common_1[_0x5df888(0x23e)][_0x5df888(0x1ec)](_0x5df888(0x216)+_0x3560c2['id']+_0x5df888(0x235)+_0x42e052+_0x5df888(0x1eb)+(_0x338d79+0x1)+'\x20次','ChatLogService');let _0x43164c;_0x42e052[_0x5df888(0x233)](_0x5df888(0x1fe))?_0x43164c=await this['modelsService'][_0x5df888(0x20e)](_0x5df888(0x259)):_0x43164c=await this[_0x5df888(0x1f1)][_0x5df888(0x20e)](_0x42e052);const _0x4fe94e=Number(_0x43164c['modelLimits']);common_1[_0x5df888(0x23e)][_0x5df888(0x1ec)](_0x5df888(0x24b)+_0x42e052+_0x5df888(0x24d)+_0x4fe94e,_0x5df888(0x254));if(_0x338d79>_0x4fe94e)return!![];return![];}catch(_0xa94aab){common_1['Logger'][_0x5df888(0x24c)](_0x5df888(0x247)+_0x3560c2['id']+_0x5df888(0x252)+_0x42e052+_0x5df888(0x25d)+_0xa94aab['message'],_0xa94aab['stack'],_0x5df888(0x254));}}};ChatLogService=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,typeorm_1[_0x6e3eb0(0x1fa)])(chatLog_entity_1['ChatLogEntity'])),__param(0x1,(0x0,typeorm_1['InjectRepository'])(user_entity_1[_0x6e3eb0(0x218)])),__param(0x2,(0x0,typeorm_1[_0x6e3eb0(0x1fa)])(chatGroup_entity_1[_0x6e3eb0(0x21a)])),__metadata('design:paramtypes',[typeorm_2[_0x6e3eb0(0x1f5)],typeorm_2[_0x6e3eb0(0x1f5)],typeorm_2['Repository'],models_service_1['ModelsService']])],ChatLogService),exports[_0x6e3eb0(0x254)]=ChatLogService;