'use strict';const _0x47677c=_0x4749;(function(_0x7f79d1,_0x4667e8){const _0x3ef8cb=_0x4749,_0x4b3a3d=_0x7f79d1();while(!![]){try{const _0xa09341=-parseInt(_0x3ef8cb(0x195))/0x1*(parseInt(_0x3ef8cb(0x16f))/0x2)+-parseInt(_0x3ef8cb(0x19d))/0x3+parseInt(_0x3ef8cb(0x1e2))/0x4+-parseInt(_0x3ef8cb(0x1b3))/0x5+-parseInt(_0x3ef8cb(0x1d7))/0x6+-parseInt(_0x3ef8cb(0x1b0))/0x7*(-parseInt(_0x3ef8cb(0x178))/0x8)+parseInt(_0x3ef8cb(0x194))/0x9;if(_0xa09341===_0x4667e8)break;else _0x4b3a3d['push'](_0x4b3a3d['shift']());}catch(_0x1b2333){_0x4b3a3d['push'](_0x4b3a3d['shift']());}}}(_0x4159,0x8409c));function _0x4159(){const _0x42f631=['startsWith','email','2644860wHPTWo','stack','Workbook','rec','exportExcel','ChatType','stable-diffusion','BAD_REQUEST','length','avatar','gpts','username','affected','Content-Disposition','checkModelLimits','@nestjs/common','xlsx','role','now','3312281QQWQGL','map','userEntity','1978230shJacR','update','paintCount','用户名','../chatGroup/chatGroup.entity','type','find','DALL-E2','\x20的使用次数限制为\x20','deleteChatsAfterId','chatLogEntity','recDrawImg','model','DESC','chatGroupEntity','getCurrentModelKeyInfo','提问时间','HttpException','findOneDrawLog','__metadata','saveChatLog','chat.xlsx','assign','extend','user','ali','formatDate','message','PAINT','你操作的图片不存在、请检查！','MoreThanOrEqual','attachment;\x20filename=','isGroup',',\x20模型:\x20','findOneChatLog','assistant','838308mrIkHz','fileInfo','../user/user.entity','?imageView2/1/w/','byAppId','count','answer','userId','Repository','error','filter','4167208PmnnWY','modelsService','chatlog','Logger','__esModule','parse','./chatLog.entity','findOne','MoreThan','object','deleteChatLog','userInfo','\x20模型\x20','getOwnPropertyDescriptor','save','forEach','maskEmail','UserEntity','modelLimits','../../common/constants/balance.constant','components','thumbImg','write','function','32842wfBteS','ModelsService','log','midjourney','?x-oss-process=image/resize,w_','findAndCount','ChatLogService','includes','ChatGroupEntity','8ZDautt','reverse','prompt','/q/55','\x20一小时内调用\x20','当前页面已经没有东西可以删除了！','取消推荐','dall-e-3','../models/models.service','gpt-4-gizmo','回答答案','tencent','删除对话记录成功！','metadata','default','Not','querAllDrawLog\x20Json\x20parse\x20error','exceljs','chatHistory','decorate','HttpStatus','delByGroupId','setHeader','cos','你删除的对话记录不存在、请检查！','InjectRepository','用户ID:\x20','addWorksheet','11227104tGmJBM','49syvzwS','design:paramtypes','Injectable','用户邮箱','Like','createdAt'];_0x4159=function(){return _0x42f631;};return _0x4159();}var __decorate=this&&this['__decorate']||function(_0x127dcb,_0x18fb6a,_0x1dd3f8,_0x242480){const _0x325871=_0x4749;var _0x1d24aa=arguments['length'],_0x2ff9be=_0x1d24aa<0x3?_0x18fb6a:_0x242480===null?_0x242480=Object[_0x325871(0x164)](_0x18fb6a,_0x1dd3f8):_0x242480,_0x1515f6;if(typeof Reflect==='object'&&typeof Reflect[_0x325871(0x18b)]===_0x325871(0x16e))_0x2ff9be=Reflect[_0x325871(0x18b)](_0x127dcb,_0x18fb6a,_0x1dd3f8,_0x242480);else{for(var _0xc3b2fb=_0x127dcb['length']-0x1;_0xc3b2fb>=0x0;_0xc3b2fb--)if(_0x1515f6=_0x127dcb[_0xc3b2fb])_0x2ff9be=(_0x1d24aa<0x3?_0x1515f6(_0x2ff9be):_0x1d24aa>0x3?_0x1515f6(_0x18fb6a,_0x1dd3f8,_0x2ff9be):_0x1515f6(_0x18fb6a,_0x1dd3f8))||_0x2ff9be;}return _0x1d24aa>0x3&&_0x2ff9be&&Object['defineProperty'](_0x18fb6a,_0x1dd3f8,_0x2ff9be),_0x2ff9be;},__metadata=this&&this[_0x47677c(0x1c6)]||function(_0x2d0524,_0x1a31dd){const _0x2b6a68=_0x47677c;if(typeof Reflect===_0x2b6a68(0x160)&&typeof Reflect[_0x2b6a68(0x185)]==='function')return Reflect[_0x2b6a68(0x185)](_0x2d0524,_0x1a31dd);},__param=this&&this['__param']||function(_0x5c10a4,_0x3a617a){return function(_0x35b663,_0x31ecff){_0x3a617a(_0x35b663,_0x31ecff,_0x5c10a4);};};Object['defineProperty'](exports,_0x47677c(0x1e6),{'value':!![]}),exports['ChatLogService']=void 0x0;function _0x4749(_0x2369a4,_0x5a2994){const _0x41596b=_0x4159();return _0x4749=function(_0x4749b5,_0x4b32e8){_0x4749b5=_0x4749b5-0x15d;let _0x17bb80=_0x41596b[_0x4749b5];return _0x17bb80;},_0x4749(_0x2369a4,_0x5a2994);}const balance_constant_1=require(_0x47677c(0x16a)),utils_1=require('../../common/utils'),common_1=require(_0x47677c(0x1ac)),typeorm_1=require('@nestjs/typeorm'),exceljs_1=require(_0x47677c(0x189)),typeorm_2=require('typeorm'),chatGroup_entity_1=require(_0x47677c(0x1b7)),user_entity_1=require(_0x47677c(0x1d9)),chatLog_entity_1=require(_0x47677c(0x15d)),models_service_1=require(_0x47677c(0x180));let ChatLogService=class ChatLogService{constructor(_0x517a31,_0x4ce912,_0x2709a5,_0x92e6ee){const _0xa71b99=_0x47677c;this['chatLogEntity']=_0x517a31,this[_0xa71b99(0x1b2)]=_0x4ce912,this[_0xa71b99(0x1c1)]=_0x2709a5,this['modelsService']=_0x92e6ee;}async[_0x47677c(0x1c7)](_0x26f38a){const _0x17927d=_0x47677c,_0x51ec6b=await this['chatLogEntity'][_0x17927d(0x165)](_0x26f38a);return _0x51ec6b;}async['updateChatLog'](_0x4b3b73,_0x489f06){const _0x4bbfda=_0x47677c;return await this[_0x4bbfda(0x1bd)][_0x4bbfda(0x1b4)]({'id':_0x4b3b73},_0x489f06);}async[_0x47677c(0x1d5)](_0xbddb7f){const _0x3cadbd=_0x47677c;return await this['chatLogEntity'][_0x3cadbd(0x15e)]({'where':{'id':_0xbddb7f}});}async['querDrawLog'](_0x51967e,_0x1a3613){const _0x150f68=_0x47677c,{id:_0x43fdc3}=_0x51967e['user'],{model:_0x5700de}=_0x1a3613,_0x17573f={'userId':_0x43fdc3,'type':balance_constant_1[_0x150f68(0x1a2)]['PAINT']};_0x5700de&&(_0x17573f[_0x150f68(0x1bf)]=_0x5700de,_0x5700de===_0x150f68(0x1ba)&&(_0x17573f[_0x150f68(0x1bf)]=(0x0,typeorm_2['In'])([_0x150f68(0x1ba),'dall-e-3'])));const _0x11111e=await this[_0x150f68(0x1bd)]['find']({'where':_0x17573f,'order':{'id':_0x150f68(0x1c0)},'select':['id',_0x150f68(0x1dd),_0x150f68(0x17a),_0x150f68(0x1bf),_0x150f68(0x1b8),_0x150f68(0x1d8)]});return _0x11111e[_0x150f68(0x166)](_0x51ac68=>{const _0x4e1a5a=_0x150f68;if(_0x51ac68[_0x4e1a5a(0x1b8)]===_0x4e1a5a(0x1b5)){const _0x4453bf=_0x51ac68[_0x4e1a5a(0x1bf)]==='mj'?0x136:0xa0,_0x44889e=_0x51ac68['answer']['includes'](_0x4e1a5a(0x18f))?'tencent':_0x4e1a5a(0x1cc),_0x4446e9=_0x44889e===_0x4e1a5a(0x183)?_0x4e1a5a(0x1da)+_0x4453bf+_0x4e1a5a(0x17b):_0x4e1a5a(0x173)+_0x4453bf;_0x51ac68[_0x4e1a5a(0x16c)]=_0x51ac68[_0x4e1a5a(0x1dd)]+_0x4446e9;try{_0x51ac68['fileInfo']=_0x51ac68['fileInfo']?JSON[_0x4e1a5a(0x1e7)](_0x51ac68[_0x4e1a5a(0x1d8)]):null;}catch(_0x209481){_0x51ac68['fileInfo']={};}}}),_0x11111e;}async['querAllDrawLog'](_0xf0f580){const _0x2cb7f7=_0x47677c,{page:page=0x1,size:size=0x14,rec:_0x162e9b,userId:_0x33568e,model:_0x574c35}=_0xf0f580,_0x3f92d6={'type':0x2,'prompt':(0x0,typeorm_2[_0x2cb7f7(0x187)])(''),'answer':(0x0,typeorm_2[_0x2cb7f7(0x187)])(''),'fileInfo':(0x0,typeorm_2['Not'])('')};_0x162e9b&&Object[_0x2cb7f7(0x1c9)](_0x3f92d6,{'rec':_0x162e9b}),_0x33568e&&Object['assign'](_0x3f92d6,{'userId':_0x33568e});_0x574c35?_0x3f92d6[_0x2cb7f7(0x1bf)]=_0x574c35:_0x3f92d6[_0x2cb7f7(0x1bf)]=(0x0,typeorm_2['In'])([_0x2cb7f7(0x172),_0x2cb7f7(0x17f),_0x2cb7f7(0x1a3)]);const [_0x49c139,_0x1aff63]=await this[_0x2cb7f7(0x1bd)][_0x2cb7f7(0x174)]({'order':{'id':_0x2cb7f7(0x1c0)},'skip':(page-0x1)*size,'take':size,'where':_0x3f92d6}),_0x38427f=_0x49c139[_0x2cb7f7(0x1b1)](_0x21e268=>_0x21e268[_0x2cb7f7(0x1de)])[_0x2cb7f7(0x1e1)](_0x1dccf4=>_0x1dccf4<0x186a0),_0x772df4=await this[_0x2cb7f7(0x1b2)][_0x2cb7f7(0x1b9)]({'where':{'id':(0x0,typeorm_2['In'])(_0x38427f)},'select':['id',_0x2cb7f7(0x1a8),_0x2cb7f7(0x1a6),'email']});return _0x49c139[_0x2cb7f7(0x166)](_0x1bc458=>{const _0xee124d=_0x2cb7f7;_0x1bc458[_0xee124d(0x162)]=_0x772df4[_0xee124d(0x1b9)](_0x4fefe5=>_0x4fefe5['id']===_0x1bc458[_0xee124d(0x1de)]);}),_0x49c139[_0x2cb7f7(0x166)](_0x2944cd=>{const _0xf9e302=_0x2cb7f7;var _0x547fc0;const _0x4d6f0f=_0x2944cd[_0xf9e302(0x1bf)]===_0xf9e302(0x172)?0x136:0xa0,_0x1245ac=_0x2944cd[_0xf9e302(0x1dd)][_0xf9e302(0x176)](_0xf9e302(0x18f))?_0xf9e302(0x183):_0xf9e302(0x1cc),_0x3a5eb3=_0x1245ac===_0xf9e302(0x183)?_0xf9e302(0x1da)+_0x4d6f0f+_0xf9e302(0x17b):_0xf9e302(0x173)+_0x4d6f0f;_0x2944cd[_0xf9e302(0x16c)]=_0x2944cd[_0xf9e302(0x1dd)]+_0x3a5eb3;try{const _0x308a1f=_0x2944cd['extend']?JSON[_0xf9e302(0x1e7)](_0x2944cd[_0xf9e302(0x1ca)]):null;_0x308a1f&&(_0x308a1f?_0x2944cd[_0xf9e302(0x1d3)]=((_0x547fc0=_0x308a1f===null||_0x308a1f===void 0x0?void 0x0:_0x308a1f['components'][0x0])===null||_0x547fc0===void 0x0?void 0x0:_0x547fc0[_0xf9e302(0x16b)][_0xf9e302(0x1a5)])===0x5:_0x2944cd[_0xf9e302(0x1d3)]=![]);}catch(_0x2b2c93){console['log'](_0xf9e302(0x188),_0x2b2c93);}}),{'rows':_0x49c139,'count':_0x1aff63};}async[_0x47677c(0x1c5)](_0x4984a3){const _0x35fd75=_0x47677c,{id:_0x5ad9e4}=_0x4984a3,_0x519c6f=await this[_0x35fd75(0x1bd)]['findOne']({'where':{'id':_0x5ad9e4}});return _0x519c6f;}async[_0x47677c(0x1be)](_0x471f38){const _0x302642=_0x47677c,{id:_0xa72cfe}=_0x471f38,_0x3cbbc5=await this['chatLogEntity'][_0x302642(0x15e)]({'where':{'id':_0xa72cfe,'type':balance_constant_1['ChatType'][_0x302642(0x1cf)]}});if(!_0x3cbbc5)throw new common_1[(_0x302642(0x1c4))]('你推荐的图片不存在、请检查！',common_1[_0x302642(0x18c)][_0x302642(0x1a4)]);const _0x92cc9d=_0x3cbbc5[_0x302642(0x1a0)]===0x1?0x0:0x1,_0x22ef22=await this[_0x302642(0x1bd)][_0x302642(0x1b4)]({'id':_0xa72cfe},{'rec':_0x92cc9d});if(_0x22ef22[_0x302642(0x1a9)]>0x0)return(_0x92cc9d?'推荐':_0x302642(0x17e))+'图片成功！';throw new common_1[(_0x302642(0x1c4))](_0x302642(0x1d0),common_1[_0x302642(0x18c)][_0x302642(0x1a4)]);}async[_0x47677c(0x1a1)](_0x306fd5,_0x3f3d18){const _0x4bae22=_0x47677c,_0x2eb8c7={'type':balance_constant_1[_0x4bae22(0x1a2)]['NORMAL_CHAT']},{page:page=0x1,size:size=0x1e,prompt:_0x4a96d2,email:_0x58c7e7}=_0x306fd5;_0x4a96d2&&Object[_0x4bae22(0x1c9)](_0x2eb8c7,{'prompt':(0x0,typeorm_2['Like'])('%'+_0x4a96d2+'%')});if(_0x58c7e7){const _0x5cf092=await this[_0x4bae22(0x1b2)]['findOne']({'where':{'email':_0x58c7e7}});(_0x5cf092===null||_0x5cf092===void 0x0?void 0x0:_0x5cf092['id'])&&Object['assign'](_0x2eb8c7,{'userId':_0x5cf092['id']});}const [_0xf2361d,_0x234162]=await this['chatLogEntity'][_0x4bae22(0x174)]({'order':{'id':_0x4bae22(0x1c0)},'skip':(page-0x1)*size,'take':size,'where':_0x2eb8c7}),_0x4499af=_0xf2361d['map'](_0x544fcd=>_0x544fcd[_0x4bae22(0x1de)]),_0x1a8937=await this[_0x4bae22(0x1b2)]['find']({'where':{'id':(0x0,typeorm_2['In'])(_0x4499af)}}),_0x4bd6fc=_0xf2361d[_0x4bae22(0x1b1)](_0x20fa54=>{const _0x165384=_0x4bae22,_0x5cec43=_0x1a8937[_0x165384(0x1b9)](_0x400539=>_0x400539['id']===_0x20fa54['userId']);return{'username':_0x5cec43?_0x5cec43[_0x165384(0x1a8)]:'','email':_0x5cec43?_0x5cec43[_0x165384(0x19c)]:'','prompt':_0x20fa54['prompt'],'answer':_0x20fa54[_0x165384(0x1dd)],'createdAt':(0x0,utils_1[_0x165384(0x1cd)])(_0x20fa54[_0x165384(0x19a)])};}),_0x2c43c7=new exceljs_1[(_0x4bae22(0x186))][(_0x4bae22(0x19f))](),_0x512137=_0x2c43c7[_0x4bae22(0x193)](_0x4bae22(0x1e4));_0x512137['columns']=[{'header':_0x4bae22(0x1b6),'key':_0x4bae22(0x1a8),'width':0x14},{'header':_0x4bae22(0x198),'key':_0x4bae22(0x19c),'width':0x14},{'header':_0x4bae22(0x1c3),'key':_0x4bae22(0x19a),'width':0x14},{'header':'提问问题','key':_0x4bae22(0x17a),'width':0x50},{'header':_0x4bae22(0x182),'key':_0x4bae22(0x1dd),'width':0x96}],_0x4bd6fc[_0x4bae22(0x166)](_0x34c7e3=>_0x512137['addRow'](_0x34c7e3)),_0x3f3d18[_0x4bae22(0x18e)]('Content-Type','application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'),_0x3f3d18[_0x4bae22(0x18e)](_0x4bae22(0x1aa),_0x4bae22(0x1d2)+_0x4bae22(0x1c8)),await _0x2c43c7[_0x4bae22(0x1ad)][_0x4bae22(0x16d)](_0x3f3d18),_0x3f3d18['end']();}async['querAllChatLog'](_0x5f2da0,_0x410d91){const _0x1279f9=_0x47677c,{page:page=0x1,size:size=0x14,userId:_0xa3d2ea,prompt:_0x3c516b}=_0x5f2da0,_0x5e0f55={'type':balance_constant_1['ChatType']['NORMAL_CHAT'],'prompt':(0x0,typeorm_2[_0x1279f9(0x187)])('')};_0xa3d2ea&&Object[_0x1279f9(0x1c9)](_0x5e0f55,{'userId':_0xa3d2ea}),_0x3c516b&&Object[_0x1279f9(0x1c9)](_0x5e0f55,{'prompt':(0x0,typeorm_2[_0x1279f9(0x199)])('%'+_0x3c516b+'%')});const [_0x33b64f,_0x46c86c]=await this[_0x1279f9(0x1bd)][_0x1279f9(0x174)]({'order':{'id':_0x1279f9(0x1c0)},'skip':(page-0x1)*size,'take':size,'where':_0x5e0f55}),_0x1f8e3a=_0x33b64f['map'](_0xe5a473=>_0xe5a473[_0x1279f9(0x1de)]),_0x63e055=await this[_0x1279f9(0x1b2)][_0x1279f9(0x1b9)]({'where':{'id':(0x0,typeorm_2['In'])(_0x1f8e3a)},'select':['id',_0x1279f9(0x1a8),_0x1279f9(0x19c)]});return _0x33b64f[_0x1279f9(0x166)](_0x3375ab=>{const _0x285c2e=_0x1279f9,{username:_0x365cff,email:_0x3eef67}=_0x63e055[_0x285c2e(0x1b9)](_0x42d0bb=>_0x42d0bb['id']===_0x3375ab['userId'])||{};_0x3375ab[_0x285c2e(0x1a8)]=_0x365cff,_0x3375ab[_0x285c2e(0x19c)]=_0x3eef67;}),_0x410d91[_0x1279f9(0x1cb)][_0x1279f9(0x1ae)]!=='super'&&_0x33b64f[_0x1279f9(0x166)](_0x209020=>_0x209020[_0x1279f9(0x19c)]=(0x0,utils_1[_0x1279f9(0x167)])(_0x209020[_0x1279f9(0x19c)])),_0x33b64f[_0x1279f9(0x166)](_0x15a77b=>{const _0x57df4c=_0x1279f9;!_0x15a77b[_0x57df4c(0x19c)]&&(_0x15a77b['email']=(_0x15a77b===null||_0x15a77b===void 0x0?void 0x0:_0x15a77b[_0x57df4c(0x1de)])+'@aiweb.com'),!_0x15a77b['username']&&(_0x15a77b['username']='游客'+(_0x15a77b===null||_0x15a77b===void 0x0?void 0x0:_0x15a77b['userId']));}),{'rows':_0x33b64f,'count':_0x46c86c};}async['chatList'](_0x1e20ff,_0xc3257){const _0x4e7d7d=_0x47677c,{id:_0x8b73c0}=_0x1e20ff['user'],{groupId:_0x59db95}=_0xc3257,_0x168d47={'userId':_0x8b73c0,'isDelete':![]};_0x59db95&&Object[_0x4e7d7d(0x1c9)](_0x168d47,{'groupId':_0x59db95});if(_0x59db95){const _0x18312a=await this[_0x4e7d7d(0x1c1)][_0x4e7d7d(0x1dc)]({'where':{'isDelete':![]}});if(_0x18312a===0x0)return[];}const _0xe8efb1=await this[_0x4e7d7d(0x1bd)][_0x4e7d7d(0x1b9)]({'where':_0x168d47});return _0xe8efb1[_0x4e7d7d(0x1b1)](_0xf209ca=>{const _0x111e9c=_0x4e7d7d,{prompt:_0xdda680,role:_0x204de3,answer:_0x2d58c9,createdAt:_0x19dd4c,model:_0x308253,modelName:_0xefb636,type:_0x38bf66,status:_0x5bf7ff,action:_0x4d47cc,drawId:_0x39693c,id:_0x259ed4,fileInfo:_0x1fddf7,ttsUrl:_0x4420c2,videoUrl:_0x2fddc4,audioUrl:_0xe45bd0,customId:_0x47835d,pluginParam:_0x73d30a,modelAvatar:_0x500ff0,taskData:_0xa63d7c,promptReference:_0x2b606d}=_0xf209ca;return{'chatId':_0x259ed4,'dateTime':(0x0,utils_1[_0x111e9c(0x1cd)])(_0x19dd4c),'text':_0x204de3===_0x111e9c(0x1cb)?_0xdda680:_0x2d58c9,'modelType':_0x38bf66,'status':_0x5bf7ff,'action':_0x4d47cc,'drawId':_0x39693c,'customId':_0x47835d,'inversion':_0x204de3===_0x111e9c(0x1cb),'error':![],'fileInfo':_0x1fddf7,'ttsUrl':_0x4420c2,'videoUrl':_0x2fddc4,'audioUrl':_0xe45bd0,'model':_0x308253,'modelName':_0xefb636,'pluginParam':_0x73d30a,'modelAvatar':_0x500ff0,'taskData':_0xa63d7c,'promptReference':_0x2b606d};});}async[_0x47677c(0x18a)](_0x5e0e1d,_0x4d0fbd){const _0x7ccc8e=_0x47677c;if(_0x4d0fbd===0x0)return[];const _0x526927={'isDelete':![],'groupId':_0x5e0e1d},_0x14417b=await this['chatLogEntity'][_0x7ccc8e(0x1b9)]({'where':_0x526927,'order':{'createdAt':_0x7ccc8e(0x1c0)},'take':_0x4d0fbd*0x2}),_0x3f8310=_0x14417b[_0x7ccc8e(0x1b1)](_0x1f0f99=>{const {role:_0x1f240b,prompt:_0x251ac6,answer:_0x25a5d4,fileInfo:_0x4ee1da}=_0x1f0f99,_0x2881aa={'role':_0x1f240b,'text':_0x1f240b==='user'?_0x251ac6:_0x25a5d4,'fileInfo':_0x4ee1da};return _0x2881aa;})[_0x7ccc8e(0x179)]();return _0x3f8310;}async[_0x47677c(0x161)](_0x10cd0e,_0x3d6ab7){const _0x2ef75c=_0x47677c,{id:_0x422d1d}=_0x10cd0e[_0x2ef75c(0x1cb)],{id:_0x50acf0}=_0x3d6ab7,_0x26dc29=await this[_0x2ef75c(0x1bd)][_0x2ef75c(0x15e)]({'where':{'id':_0x50acf0,'userId':_0x422d1d}});if(!_0x26dc29)throw new common_1[(_0x2ef75c(0x1c4))](_0x2ef75c(0x190),common_1[_0x2ef75c(0x18c)][_0x2ef75c(0x1a4)]);const _0x18f85f=await this['chatLogEntity'][_0x2ef75c(0x1b4)]({'id':_0x50acf0},{'isDelete':!![]});if(_0x18f85f[_0x2ef75c(0x1a9)]>0x0)return _0x2ef75c(0x184);else throw new common_1[(_0x2ef75c(0x1c4))]('你删除的对话记录不存在、请检查！',common_1[_0x2ef75c(0x18c)][_0x2ef75c(0x1a4)]);}async[_0x47677c(0x18d)](_0x39cd1d,_0x574e32){const _0x220da8=_0x47677c,{groupId:_0x122838}=_0x574e32,{id:_0x3ae5c0}=_0x39cd1d['user'],_0x352745=await this['chatGroupEntity'][_0x220da8(0x15e)]({'where':{'id':_0x122838,'userId':_0x3ae5c0}});if(!_0x352745)throw new common_1['HttpException'](_0x220da8(0x190),common_1[_0x220da8(0x18c)][_0x220da8(0x1a4)]);const _0x484fcf=await this[_0x220da8(0x1bd)][_0x220da8(0x1b4)]({'groupId':_0x122838},{'isDelete':!![]});if(_0x484fcf[_0x220da8(0x1a9)]>0x0)return _0x220da8(0x184);if(_0x484fcf[_0x220da8(0x1a9)]===0x0)throw new common_1['HttpException'](_0x220da8(0x17d),common_1[_0x220da8(0x18c)][_0x220da8(0x1a4)]);}async[_0x47677c(0x1bc)](_0x194c50,_0x189699){const _0x414b76=_0x47677c,{id:_0x73d14b}=_0x189699,{id:_0x24b162}=_0x194c50[_0x414b76(0x1cb)],_0xf6ac73=await this[_0x414b76(0x1bd)][_0x414b76(0x15e)]({'where':{'id':_0x73d14b,'userId':_0x24b162}});if(!_0xf6ac73)throw new common_1['HttpException'](_0x414b76(0x190),common_1['HttpStatus']['BAD_REQUEST']);const {groupId:_0x25d5b7}=_0xf6ac73,_0x1b8e0d=await this['chatLogEntity']['update']({'groupId':_0x25d5b7,'id':(0x0,typeorm_2[_0x414b76(0x1d1)])(_0x73d14b)},{'isDelete':!![]});if(_0x1b8e0d[_0x414b76(0x1a9)]>0x0)return _0x414b76(0x184);else throw new common_1['HttpException'](_0x414b76(0x17d),common_1[_0x414b76(0x18c)][_0x414b76(0x1a4)]);}async[_0x47677c(0x1db)](_0x143ade,_0x9f1181){const _0xecd10c=_0x47677c,{id:_0x2503ea}=_0x143ade[_0xecd10c(0x1cb)],{appId:_0x4c85c3,page:page=0x1,size:size=0xa}=_0x9f1181,[_0x2d8188,_0x22d8aa]=await this['chatLogEntity']['findAndCount']({'where':{'userId':_0x2503ea,'appId':_0x4c85c3,'role':_0xecd10c(0x1d6)},'order':{'id':'DESC'},'take':size,'skip':(page-0x1)*size});return{'rows':_0x2d8188,'count':_0x22d8aa};}async[_0x47677c(0x1ab)](_0x5b8e64,_0x360afb){const _0x10d8aa=_0x47677c,_0x276570=0xe10*0x3e8,_0x5e8f96=new Date(Date[_0x10d8aa(0x1af)]()-_0x276570);try{const _0x3a9f78=await this['chatLogEntity'][_0x10d8aa(0x1dc)]({'where':{'userId':_0x5b8e64['id'],'model':_0x360afb,'createdAt':(0x0,typeorm_2[_0x10d8aa(0x15f)])(_0x5e8f96)}}),_0x1c5f1a=Math['ceil'](_0x3a9f78/0x2);common_1['Logger'][_0x10d8aa(0x171)](_0x10d8aa(0x192)+_0x5b8e64['id']+_0x10d8aa(0x17c)+_0x360afb+_0x10d8aa(0x163)+(_0x1c5f1a+0x1)+'\x20次',_0x10d8aa(0x175));let _0x351464;_0x360afb[_0x10d8aa(0x19b)](_0x10d8aa(0x181))?_0x351464=await this[_0x10d8aa(0x1e3)][_0x10d8aa(0x1c2)](_0x10d8aa(0x1a7)):_0x351464=await this[_0x10d8aa(0x1e3)][_0x10d8aa(0x1c2)](_0x360afb);const _0x12189b=Number(_0x351464[_0x10d8aa(0x169)]);common_1['Logger'][_0x10d8aa(0x171)]('模型\x20'+_0x360afb+_0x10d8aa(0x1bb)+_0x12189b,_0x10d8aa(0x175));if(_0x1c5f1a>_0x12189b)return!![];return![];}catch(_0x162429){common_1[_0x10d8aa(0x1e5)][_0x10d8aa(0x1e0)]('查询数据库出错\x20-\x20用户ID:\x20'+_0x5b8e64['id']+_0x10d8aa(0x1d4)+_0x360afb+',\x20错误信息:\x20'+_0x162429[_0x10d8aa(0x1ce)],_0x162429[_0x10d8aa(0x19e)],_0x10d8aa(0x175));}}};ChatLogService=__decorate([(0x0,common_1[_0x47677c(0x197)])(),__param(0x0,(0x0,typeorm_1[_0x47677c(0x191)])(chatLog_entity_1['ChatLogEntity'])),__param(0x1,(0x0,typeorm_1[_0x47677c(0x191)])(user_entity_1[_0x47677c(0x168)])),__param(0x2,(0x0,typeorm_1['InjectRepository'])(chatGroup_entity_1[_0x47677c(0x177)])),__metadata(_0x47677c(0x196),[typeorm_2[_0x47677c(0x1df)],typeorm_2['Repository'],typeorm_2['Repository'],models_service_1[_0x47677c(0x170)]])],ChatLogService),exports['ChatLogService']=ChatLogService;