'use strict';const _0x4459d3=_0x44b7;function _0x213a(){const _0x4dd0c7=['Workbook','../models/models.service','createdAt','@nestjs/typeorm','2gMFcrI','208yZryiV','filter','stack','fileInfo','BAD_REQUEST','1697822LTBfgC','function','exceljs','findOneChatLog','isGroup','PAINT','Injectable','checkModelLimits','application/vnd.openxmlformats-officedocument.spreadsheetml.sheet','xlsx','10JQSSFq','chatHistory','parse','用户ID:\x20','end','./chatLog.entity','tencent','Repository','352440FNugwa','Logger','MoreThan','find','190ljYFBq','ChatType','paintCount','取消推荐','defineProperty','email','querAllChatLog','ali','你推荐的图片不存在、请检查！','length','modelLimits','delByGroupId','count','user','13785gyKqgj','ChatLogService','getOwnPropertyDescriptor','\x20一小时内调用\x20','Like','当前页面已经没有东西可以删除了！','byAppId','startsWith','findOne','extend','getCurrentModelKeyInfo','modelsService','HttpException','log','now','save','querAllDrawLog','提问时间','columns','addRow','default','querDrawLog','attachment;\x20filename=','includes','用户名','/q/55','chatGroupEntity','?imageView2/1/w/','HttpStatus','querAllDrawLog\x20Json\x20parse\x20error','saveChatLog','components','回答答案','InjectRepository','maskEmail','write','1317264gJqXxk','forEach','thumbImg','answer','gpts','reverse','chatLogEntity','NORMAL_CHAT','?x-oss-process=image/resize,w_','design:paramtypes','MoreThanOrEqual','rec','__param','218849SSrNkG','userId','删除对话记录成功！','../../common/utils','object','decorate','DESC','提问问题','model','super','findAndCount','affected','metadata','56526BpkxOp','ChatGroupEntity','userEntity',',\x20模型:\x20','cos','addWorksheet','role','ceil','Content-Disposition','你删除的对话记录不存在、请检查！','Content-Type','userInfo','formatDate','Not','setHeader','prompt','username','../chatGroup/chatGroup.entity','用户邮箱',',\x20错误信息:\x20','__decorate','assign','map','typeorm','update','2902339GMrcGs','__metadata','__esModule','recDrawImg','midjourney'];_0x213a=function(){return _0x4dd0c7;};return _0x213a();}(function(_0x4071ea,_0x444ef1){const _0x48aaae=_0x44b7,_0x258224=_0x4071ea();while(!![]){try{const _0x40a3dc=-parseInt(_0x48aaae(0x97))/0x1*(parseInt(_0x48aaae(0xc6))/0x2)+parseInt(_0x48aaae(0xf0))/0x3*(parseInt(_0x48aaae(0xc7))/0x4)+parseInt(_0x48aaae(0xe2))/0x5*(parseInt(_0x48aaae(0xa4))/0x6)+-parseInt(_0x48aaae(0xcc))/0x7+-parseInt(_0x48aaae(0x114))/0x8+-parseInt(_0x48aaae(0xde))/0x9*(-parseInt(_0x48aaae(0xd6))/0xa)+parseInt(_0x48aaae(0xbd))/0xb;if(_0x40a3dc===_0x444ef1)break;else _0x258224['push'](_0x258224['shift']());}catch(_0x13a702){_0x258224['push'](_0x258224['shift']());}}}(_0x213a,0x42de6));function _0x44b7(_0x410e90,_0x251873){const _0x213a1b=_0x213a();return _0x44b7=function(_0x44b7c,_0x1a2281){_0x44b7c=_0x44b7c-0x92;let _0x2d5cbf=_0x213a1b[_0x44b7c];return _0x2d5cbf;},_0x44b7(_0x410e90,_0x251873);}var __decorate=this&&this[_0x4459d3(0xb8)]||function(_0x26ef84,_0x29bf4d,_0x2e0674,_0x22fb55){const _0x15b1d2=_0x4459d3;var _0x5a613d=arguments[_0x15b1d2(0xeb)],_0x870cdf=_0x5a613d<0x3?_0x29bf4d:_0x22fb55===null?_0x22fb55=Object[_0x15b1d2(0xf2)](_0x29bf4d,_0x2e0674):_0x22fb55,_0x5688b6;if(typeof Reflect===_0x15b1d2(0x9b)&&typeof Reflect['decorate']===_0x15b1d2(0xcd))_0x870cdf=Reflect[_0x15b1d2(0x9c)](_0x26ef84,_0x29bf4d,_0x2e0674,_0x22fb55);else{for(var _0x47839c=_0x26ef84[_0x15b1d2(0xeb)]-0x1;_0x47839c>=0x0;_0x47839c--)if(_0x5688b6=_0x26ef84[_0x47839c])_0x870cdf=(_0x5a613d<0x3?_0x5688b6(_0x870cdf):_0x5a613d>0x3?_0x5688b6(_0x29bf4d,_0x2e0674,_0x870cdf):_0x5688b6(_0x29bf4d,_0x2e0674))||_0x870cdf;}return _0x5a613d>0x3&&_0x870cdf&&Object[_0x15b1d2(0xe6)](_0x29bf4d,_0x2e0674,_0x870cdf),_0x870cdf;},__metadata=this&&this[_0x4459d3(0xbe)]||function(_0xa1f7e4,_0x350260){const _0x5b757a=_0x4459d3;if(typeof Reflect===_0x5b757a(0x9b)&&typeof Reflect[_0x5b757a(0xa3)]===_0x5b757a(0xcd))return Reflect[_0x5b757a(0xa3)](_0xa1f7e4,_0x350260);},__param=this&&this[_0x4459d3(0x96)]||function(_0x4e262e,_0x36a2a2){return function(_0x363291,_0x182f87){_0x36a2a2(_0x363291,_0x182f87,_0x4e262e);};};Object['defineProperty'](exports,_0x4459d3(0xbf),{'value':!![]}),exports[_0x4459d3(0xf1)]=void 0x0;const balance_constant_1=require('../../common/constants/balance.constant'),utils_1=require(_0x4459d3(0x9a)),common_1=require('@nestjs/common'),typeorm_1=require(_0x4459d3(0xc5)),exceljs_1=require(_0x4459d3(0xce)),typeorm_2=require(_0x4459d3(0xbb)),chatGroup_entity_1=require(_0x4459d3(0xb5)),user_entity_1=require('../user/user.entity'),chatLog_entity_1=require(_0x4459d3(0xdb)),models_service_1=require(_0x4459d3(0xc3));let ChatLogService=class ChatLogService{constructor(_0x2f8bd3,_0x3d2407,_0x2f5961,_0x191e7e){const _0x95a49=_0x4459d3;this[_0x95a49(0x11a)]=_0x2f8bd3,this['userEntity']=_0x3d2407,this[_0x95a49(0x10a)]=_0x2f5961,this[_0x95a49(0xfb)]=_0x191e7e;}async[_0x4459d3(0x10e)](_0x3db85c){const _0xa7c2d4=_0x4459d3,_0x58b961=await this[_0xa7c2d4(0x11a)][_0xa7c2d4(0xff)](_0x3db85c);return _0x58b961;}async['updateChatLog'](_0x243e8e,_0x7ffc34){const _0x158871=_0x4459d3;return await this[_0x158871(0x11a)][_0x158871(0xbc)]({'id':_0x243e8e},_0x7ffc34);}async[_0x4459d3(0xcf)](_0x18624b){const _0xd21fe4=_0x4459d3;return await this[_0xd21fe4(0x11a)][_0xd21fe4(0xf8)]({'where':{'id':_0x18624b}});}async[_0x4459d3(0x105)](_0x1f6eff,_0x554d54){const _0x5759e0=_0x4459d3,{id:_0x49630a}=_0x1f6eff[_0x5759e0(0xef)],{model:_0x5e948}=_0x554d54,_0x5ab662={'userId':_0x49630a,'type':balance_constant_1['ChatType'][_0x5759e0(0xd1)]};_0x5e948&&(_0x5ab662['model']=_0x5e948,_0x5e948==='DALL-E2'&&(_0x5ab662[_0x5759e0(0x9f)]=(0x0,typeorm_2['In'])(['DALL-E2','dall-e-3'])));const _0x1fa6bc=await this[_0x5759e0(0x11a)]['find']({'where':_0x5ab662,'order':{'id':'DESC'},'select':['id','answer',_0x5759e0(0xb3),_0x5759e0(0x9f),'type',_0x5759e0(0xca)]});return _0x1fa6bc['forEach'](_0x82f8fc=>{const _0x16d340=_0x5759e0;if(_0x82f8fc['type']===_0x16d340(0xe4)){const _0x18ef70=_0x82f8fc['model']==='mj'?0x136:0xa0,_0x216d03=_0x82f8fc['answer'][_0x16d340(0x107)]('cos')?_0x16d340(0xdc):_0x16d340(0xe9),_0x9405c7=_0x216d03===_0x16d340(0xdc)?_0x16d340(0x10b)+_0x18ef70+_0x16d340(0x109):_0x16d340(0x92)+_0x18ef70;_0x82f8fc[_0x16d340(0x116)]=_0x82f8fc['answer']+_0x9405c7;try{_0x82f8fc[_0x16d340(0xca)]=_0x82f8fc[_0x16d340(0xca)]?JSON[_0x16d340(0xd8)](_0x82f8fc[_0x16d340(0xca)]):null;}catch(_0xb48d49){_0x82f8fc[_0x16d340(0xca)]={};}}}),_0x1fa6bc;}async[_0x4459d3(0x100)](_0x280498){const _0x4dba13=_0x4459d3,{page:page=0x1,size:size=0x14,rec:_0x36f237,userId:_0x1cf9e8,model:_0x7fb815}=_0x280498,_0x1f092d={'type':0x2,'prompt':(0x0,typeorm_2['Not'])(''),'answer':(0x0,typeorm_2[_0x4dba13(0xb1)])(''),'fileInfo':(0x0,typeorm_2[_0x4dba13(0xb1)])('')};_0x36f237&&Object[_0x4dba13(0xb9)](_0x1f092d,{'rec':_0x36f237}),_0x1cf9e8&&Object[_0x4dba13(0xb9)](_0x1f092d,{'userId':_0x1cf9e8});_0x7fb815?_0x1f092d[_0x4dba13(0x9f)]=_0x7fb815:_0x1f092d[_0x4dba13(0x9f)]=(0x0,typeorm_2['In'])([_0x4dba13(0xc1),'dall-e-3','stable-diffusion']);const [_0x418ef8,_0x1aad26]=await this[_0x4dba13(0x11a)][_0x4dba13(0xa1)]({'order':{'id':'DESC'},'skip':(page-0x1)*size,'take':size,'where':_0x1f092d}),_0x53996c=_0x418ef8[_0x4dba13(0xba)](_0x18568a=>_0x18568a[_0x4dba13(0x98)])[_0x4dba13(0xc8)](_0x42ff4f=>_0x42ff4f<0x186a0),_0x4fbdaf=await this[_0x4dba13(0xa6)][_0x4dba13(0xe1)]({'where':{'id':(0x0,typeorm_2['In'])(_0x53996c)},'select':['id',_0x4dba13(0xb4),'avatar',_0x4dba13(0xe7)]});return _0x418ef8[_0x4dba13(0x115)](_0x3e01fe=>{const _0x3f69ea=_0x4dba13;_0x3e01fe[_0x3f69ea(0xaf)]=_0x4fbdaf[_0x3f69ea(0xe1)](_0x21983d=>_0x21983d['id']===_0x3e01fe[_0x3f69ea(0x98)]);}),_0x418ef8['forEach'](_0x1595ee=>{const _0x4de146=_0x4dba13;var _0x55b484;const _0x49bccf=_0x1595ee[_0x4de146(0x9f)]===_0x4de146(0xc1)?0x136:0xa0,_0x55789e=_0x1595ee['answer']['includes'](_0x4de146(0xa8))?'tencent':_0x4de146(0xe9),_0x526496=_0x55789e===_0x4de146(0xdc)?_0x4de146(0x10b)+_0x49bccf+_0x4de146(0x109):_0x4de146(0x92)+_0x49bccf;_0x1595ee[_0x4de146(0x116)]=_0x1595ee['answer']+_0x526496;try{const _0x38a33c=_0x1595ee['extend']?JSON[_0x4de146(0xd8)](_0x1595ee[_0x4de146(0xf9)]):null;_0x38a33c&&(_0x38a33c?_0x1595ee[_0x4de146(0xd0)]=((_0x55b484=_0x38a33c===null||_0x38a33c===void 0x0?void 0x0:_0x38a33c[_0x4de146(0x10f)][0x0])===null||_0x55b484===void 0x0?void 0x0:_0x55b484[_0x4de146(0x10f)][_0x4de146(0xeb)])===0x5:_0x1595ee[_0x4de146(0xd0)]=![]);}catch(_0x480997){console['log'](_0x4de146(0x10d),_0x480997);}}),{'rows':_0x418ef8,'count':_0x1aad26};}async['findOneDrawLog'](_0x5e66e1){const _0x4b84a1=_0x4459d3,{id:_0x2aae03}=_0x5e66e1,_0x2511ee=await this[_0x4b84a1(0x11a)][_0x4b84a1(0xf8)]({'where':{'id':_0x2aae03}});return _0x2511ee;}async[_0x4459d3(0xc0)](_0x697595){const _0x2f461b=_0x4459d3,{id:_0x125ec9}=_0x697595,_0x1a796e=await this[_0x2f461b(0x11a)][_0x2f461b(0xf8)]({'where':{'id':_0x125ec9,'type':balance_constant_1[_0x2f461b(0xe3)]['PAINT']}});if(!_0x1a796e)throw new common_1[(_0x2f461b(0xfc))](_0x2f461b(0xea),common_1[_0x2f461b(0x10c)][_0x2f461b(0xcb)]);const _0x1c37bd=_0x1a796e[_0x2f461b(0x95)]===0x1?0x0:0x1,_0xcb25b4=await this['chatLogEntity'][_0x2f461b(0xbc)]({'id':_0x125ec9},{'rec':_0x1c37bd});if(_0xcb25b4[_0x2f461b(0xa2)]>0x0)return(_0x1c37bd?'推荐':_0x2f461b(0xe5))+'图片成功！';throw new common_1['HttpException']('你操作的图片不存在、请检查！',common_1['HttpStatus']['BAD_REQUEST']);}async['exportExcel'](_0x4d26f8,_0x507e4c){const _0x43570e=_0x4459d3,_0x1f4994={'type':balance_constant_1[_0x43570e(0xe3)]['NORMAL_CHAT']},{page:page=0x1,size:size=0x1e,prompt:_0x8d45e5,email:_0x1d859a}=_0x4d26f8;_0x8d45e5&&Object['assign'](_0x1f4994,{'prompt':(0x0,typeorm_2[_0x43570e(0xf4)])('%'+_0x8d45e5+'%')});if(_0x1d859a){const _0x44db65=await this[_0x43570e(0xa6)][_0x43570e(0xf8)]({'where':{'email':_0x1d859a}});(_0x44db65===null||_0x44db65===void 0x0?void 0x0:_0x44db65['id'])&&Object['assign'](_0x1f4994,{'userId':_0x44db65['id']});}const [_0x245644,_0x2018f2]=await this[_0x43570e(0x11a)][_0x43570e(0xa1)]({'order':{'id':_0x43570e(0x9d)},'skip':(page-0x1)*size,'take':size,'where':_0x1f4994}),_0x491cba=_0x245644[_0x43570e(0xba)](_0x2988f6=>_0x2988f6[_0x43570e(0x98)]),_0x2f5fc2=await this['userEntity'][_0x43570e(0xe1)]({'where':{'id':(0x0,typeorm_2['In'])(_0x491cba)}}),_0x40ca2e=_0x245644[_0x43570e(0xba)](_0x4b7f84=>{const _0x54e132=_0x43570e,_0x3fc878=_0x2f5fc2[_0x54e132(0xe1)](_0x418e64=>_0x418e64['id']===_0x4b7f84['userId']);return{'username':_0x3fc878?_0x3fc878[_0x54e132(0xb4)]:'','email':_0x3fc878?_0x3fc878['email']:'','prompt':_0x4b7f84['prompt'],'answer':_0x4b7f84[_0x54e132(0x117)],'createdAt':(0x0,utils_1[_0x54e132(0xb0)])(_0x4b7f84[_0x54e132(0xc4)])};}),_0x32bc44=new exceljs_1[(_0x43570e(0x104))][(_0x43570e(0xc2))](),_0x3cd270=_0x32bc44[_0x43570e(0xa9)]('chatlog');_0x3cd270[_0x43570e(0x102)]=[{'header':_0x43570e(0x108),'key':_0x43570e(0xb4),'width':0x14},{'header':_0x43570e(0xb6),'key':'email','width':0x14},{'header':_0x43570e(0x101),'key':_0x43570e(0xc4),'width':0x14},{'header':_0x43570e(0x9e),'key':_0x43570e(0xb3),'width':0x50},{'header':_0x43570e(0x110),'key':_0x43570e(0x117),'width':0x96}],_0x40ca2e[_0x43570e(0x115)](_0x29fbcf=>_0x3cd270[_0x43570e(0x103)](_0x29fbcf)),_0x507e4c[_0x43570e(0xb2)](_0x43570e(0xae),_0x43570e(0xd4)),_0x507e4c[_0x43570e(0xb2)](_0x43570e(0xac),_0x43570e(0x106)+'chat.xlsx'),await _0x32bc44[_0x43570e(0xd5)][_0x43570e(0x113)](_0x507e4c),_0x507e4c[_0x43570e(0xda)]();}async[_0x4459d3(0xe8)](_0x2e4556,_0x1a4b86){const _0x59781a=_0x4459d3,{page:page=0x1,size:size=0x14,userId:_0x442a29,prompt:_0x5b4713}=_0x2e4556,_0x213712={'type':balance_constant_1['ChatType'][_0x59781a(0x11b)],'prompt':(0x0,typeorm_2['Not'])('')};_0x442a29&&Object[_0x59781a(0xb9)](_0x213712,{'userId':_0x442a29}),_0x5b4713&&Object[_0x59781a(0xb9)](_0x213712,{'prompt':(0x0,typeorm_2[_0x59781a(0xf4)])('%'+_0x5b4713+'%')});const [_0x2c87a3,_0x483544]=await this[_0x59781a(0x11a)][_0x59781a(0xa1)]({'order':{'id':_0x59781a(0x9d)},'skip':(page-0x1)*size,'take':size,'where':_0x213712}),_0x4aa46d=_0x2c87a3[_0x59781a(0xba)](_0x22846b=>_0x22846b[_0x59781a(0x98)]),_0x186b38=await this[_0x59781a(0xa6)][_0x59781a(0xe1)]({'where':{'id':(0x0,typeorm_2['In'])(_0x4aa46d)},'select':['id',_0x59781a(0xb4),'email']});return _0x2c87a3[_0x59781a(0x115)](_0x494327=>{const _0x18de0b=_0x59781a,{username:_0xf83a05,email:_0x5a26f2}=_0x186b38[_0x18de0b(0xe1)](_0xb1c680=>_0xb1c680['id']===_0x494327[_0x18de0b(0x98)])||{};_0x494327[_0x18de0b(0xb4)]=_0xf83a05,_0x494327[_0x18de0b(0xe7)]=_0x5a26f2;}),_0x1a4b86[_0x59781a(0xef)][_0x59781a(0xaa)]!==_0x59781a(0xa0)&&_0x2c87a3[_0x59781a(0x115)](_0x7ad3f9=>_0x7ad3f9[_0x59781a(0xe7)]=(0x0,utils_1[_0x59781a(0x112)])(_0x7ad3f9[_0x59781a(0xe7)])),_0x2c87a3[_0x59781a(0x115)](_0x2ed438=>{const _0x3fee19=_0x59781a;!_0x2ed438[_0x3fee19(0xe7)]&&(_0x2ed438['email']=(_0x2ed438===null||_0x2ed438===void 0x0?void 0x0:_0x2ed438[_0x3fee19(0x98)])+'@aiweb.com'),!_0x2ed438[_0x3fee19(0xb4)]&&(_0x2ed438[_0x3fee19(0xb4)]='游客'+(_0x2ed438===null||_0x2ed438===void 0x0?void 0x0:_0x2ed438[_0x3fee19(0x98)]));}),{'rows':_0x2c87a3,'count':_0x483544};}async['chatList'](_0x27cc54,_0x487930){const _0xbb1705=_0x4459d3,{id:_0x25c958}=_0x27cc54[_0xbb1705(0xef)],{groupId:_0x36b084}=_0x487930,_0x15d0d0={'userId':_0x25c958,'isDelete':![]};_0x36b084&&Object[_0xbb1705(0xb9)](_0x15d0d0,{'groupId':_0x36b084});if(_0x36b084){const _0x19fa2a=await this['chatGroupEntity'][_0xbb1705(0xee)]({'where':{'isDelete':![]}});if(_0x19fa2a===0x0)return[];}const _0x472eb3=await this[_0xbb1705(0x11a)][_0xbb1705(0xe1)]({'where':_0x15d0d0});return _0x472eb3[_0xbb1705(0xba)](_0x589a5e=>{const _0x16dec8=_0xbb1705,{prompt:_0x2cdae8,role:_0x467b75,answer:_0x210b4a,createdAt:_0xc1e4c8,model:_0x14ba30,modelName:_0x36f1d0,type:_0x42a7eb,status:_0x41083a,action:_0x296f24,drawId:_0x5e4735,id:_0x5bdb30,fileInfo:_0x5c0b48,ttsUrl:_0x30ae6e,videoUrl:_0x2306ae,audioUrl:_0x5f10ac,customId:_0x58a3ae,pluginParam:_0x290803,modelAvatar:_0xe4834b,taskData:_0x4e59d3,promptReference:_0x4b7830}=_0x589a5e;return{'chatId':_0x5bdb30,'dateTime':(0x0,utils_1[_0x16dec8(0xb0)])(_0xc1e4c8),'text':_0x467b75==='user'?_0x2cdae8:_0x210b4a,'modelType':_0x42a7eb,'status':_0x41083a,'action':_0x296f24,'drawId':_0x5e4735,'customId':_0x58a3ae,'inversion':_0x467b75==='user','error':![],'fileInfo':_0x5c0b48,'ttsUrl':_0x30ae6e,'videoUrl':_0x2306ae,'audioUrl':_0x5f10ac,'model':_0x14ba30,'modelName':_0x36f1d0,'pluginParam':_0x290803,'modelAvatar':_0xe4834b,'taskData':_0x4e59d3,'promptReference':_0x4b7830};});}async[_0x4459d3(0xd7)](_0x58bac5,_0x3cb199){const _0x1c3290=_0x4459d3;if(_0x3cb199===0x0)return[];const _0x3ea319={'isDelete':![],'groupId':_0x58bac5},_0x5ebf60=await this[_0x1c3290(0x11a)][_0x1c3290(0xe1)]({'where':_0x3ea319,'order':{'createdAt':_0x1c3290(0x9d)},'take':_0x3cb199*0x2}),_0x11b611=_0x5ebf60['map'](_0x367f2e=>{const {role:_0x42a205,prompt:_0x2b5076,answer:_0x41114f,fileInfo:_0x5eee8e}=_0x367f2e,_0x562502={'role':_0x42a205,'text':_0x42a205==='user'?_0x2b5076:_0x41114f,'fileInfo':_0x5eee8e};return _0x562502;})[_0x1c3290(0x119)]();return _0x11b611;}async['deleteChatLog'](_0x3526cc,_0x1ff49a){const _0x5c580e=_0x4459d3,{id:_0x144f3e}=_0x3526cc[_0x5c580e(0xef)],{id:_0x4e71fc}=_0x1ff49a,_0x34f293=await this[_0x5c580e(0x11a)][_0x5c580e(0xf8)]({'where':{'id':_0x4e71fc,'userId':_0x144f3e}});if(!_0x34f293)throw new common_1[(_0x5c580e(0xfc))](_0x5c580e(0xad),common_1['HttpStatus'][_0x5c580e(0xcb)]);const _0x257a31=await this['chatLogEntity'][_0x5c580e(0xbc)]({'id':_0x4e71fc},{'isDelete':!![]});if(_0x257a31[_0x5c580e(0xa2)]>0x0)return _0x5c580e(0x99);else throw new common_1[(_0x5c580e(0xfc))](_0x5c580e(0xad),common_1[_0x5c580e(0x10c)]['BAD_REQUEST']);}async[_0x4459d3(0xed)](_0x4542cc,_0x345c2a){const _0x535bf0=_0x4459d3,{groupId:_0x34b060}=_0x345c2a,{id:_0x198ec8}=_0x4542cc[_0x535bf0(0xef)],_0x3c598b=await this[_0x535bf0(0x10a)][_0x535bf0(0xf8)]({'where':{'id':_0x34b060,'userId':_0x198ec8}});if(!_0x3c598b)throw new common_1[(_0x535bf0(0xfc))](_0x535bf0(0xad),common_1[_0x535bf0(0x10c)][_0x535bf0(0xcb)]);const _0x43bc8a=await this[_0x535bf0(0x11a)][_0x535bf0(0xbc)]({'groupId':_0x34b060},{'isDelete':!![]});if(_0x43bc8a[_0x535bf0(0xa2)]>0x0)return _0x535bf0(0x99);if(_0x43bc8a[_0x535bf0(0xa2)]===0x0)throw new common_1[(_0x535bf0(0xfc))](_0x535bf0(0xf5),common_1[_0x535bf0(0x10c)]['BAD_REQUEST']);}async['deleteChatsAfterId'](_0x321da0,_0x11f91d){const _0x3d4e0d=_0x4459d3,{id:_0x2245c6}=_0x11f91d,{id:_0x3fb376}=_0x321da0[_0x3d4e0d(0xef)],_0x47a052=await this[_0x3d4e0d(0x11a)][_0x3d4e0d(0xf8)]({'where':{'id':_0x2245c6,'userId':_0x3fb376}});if(!_0x47a052)throw new common_1[(_0x3d4e0d(0xfc))](_0x3d4e0d(0xad),common_1[_0x3d4e0d(0x10c)][_0x3d4e0d(0xcb)]);const {groupId:_0x244454}=_0x47a052,_0x4bc908=await this[_0x3d4e0d(0x11a)][_0x3d4e0d(0xbc)]({'groupId':_0x244454,'id':(0x0,typeorm_2[_0x3d4e0d(0x94)])(_0x2245c6)},{'isDelete':!![]});if(_0x4bc908[_0x3d4e0d(0xa2)]>0x0)return _0x3d4e0d(0x99);else throw new common_1['HttpException']('当前页面已经没有东西可以删除了！',common_1[_0x3d4e0d(0x10c)][_0x3d4e0d(0xcb)]);}async[_0x4459d3(0xf6)](_0x3eaebc,_0x16c415){const _0x39a1f9=_0x4459d3,{id:_0x44d1de}=_0x3eaebc[_0x39a1f9(0xef)],{appId:_0x59bd7a,page:page=0x1,size:size=0xa}=_0x16c415,[_0x4c722f,_0x27e68c]=await this[_0x39a1f9(0x11a)][_0x39a1f9(0xa1)]({'where':{'userId':_0x44d1de,'appId':_0x59bd7a,'role':'assistant'},'order':{'id':'DESC'},'take':size,'skip':(page-0x1)*size});return{'rows':_0x4c722f,'count':_0x27e68c};}async[_0x4459d3(0xd3)](_0x33fd7f,_0x22cac5){const _0x34034c=_0x4459d3,_0xc040ca=0xe10*0x3e8,_0x18a6f2=new Date(Date[_0x34034c(0xfe)]()-_0xc040ca);try{const _0x25548d=await this[_0x34034c(0x11a)][_0x34034c(0xee)]({'where':{'userId':_0x33fd7f['id'],'model':_0x22cac5,'createdAt':(0x0,typeorm_2[_0x34034c(0xe0)])(_0x18a6f2)}}),_0x3b7764=Math[_0x34034c(0xab)](_0x25548d/0x2);common_1['Logger'][_0x34034c(0xfd)](_0x34034c(0xd9)+_0x33fd7f['id']+_0x34034c(0xf3)+_0x22cac5+'\x20模型\x20'+(_0x3b7764+0x1)+'\x20次',_0x34034c(0xf1));let _0x5a6d7e;_0x22cac5[_0x34034c(0xf7)]('gpt-4-gizmo')?_0x5a6d7e=await this[_0x34034c(0xfb)][_0x34034c(0xfa)](_0x34034c(0x118)):_0x5a6d7e=await this[_0x34034c(0xfb)]['getCurrentModelKeyInfo'](_0x22cac5);const _0x4fcf28=Number(_0x5a6d7e[_0x34034c(0xec)]);common_1['Logger'][_0x34034c(0xfd)]('模型\x20'+_0x22cac5+'\x20的使用次数限制为\x20'+_0x4fcf28,_0x34034c(0xf1));if(_0x3b7764>_0x4fcf28)return!![];return![];}catch(_0x1e0104){common_1[_0x34034c(0xdf)]['error']('查询数据库出错\x20-\x20用户ID:\x20'+_0x33fd7f['id']+_0x34034c(0xa7)+_0x22cac5+_0x34034c(0xb7)+_0x1e0104['message'],_0x1e0104[_0x34034c(0xc9)],_0x34034c(0xf1));}}};ChatLogService=__decorate([(0x0,common_1[_0x4459d3(0xd2)])(),__param(0x0,(0x0,typeorm_1[_0x4459d3(0x111)])(chatLog_entity_1['ChatLogEntity'])),__param(0x1,(0x0,typeorm_1['InjectRepository'])(user_entity_1['UserEntity'])),__param(0x2,(0x0,typeorm_1[_0x4459d3(0x111)])(chatGroup_entity_1[_0x4459d3(0xa5)])),__metadata(_0x4459d3(0x93),[typeorm_2[_0x4459d3(0xdd)],typeorm_2['Repository'],typeorm_2[_0x4459d3(0xdd)],models_service_1['ModelsService']])],ChatLogService),exports['ChatLogService']=ChatLogService;