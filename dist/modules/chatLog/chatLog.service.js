'use strict';function _0x5ae1(_0x3241d9,_0x101172){const _0x34b30d=_0x34b3();return _0x5ae1=function(_0x5ae172,_0x2f660c){_0x5ae172=_0x5ae172-0x91;let _0x593d69=_0x34b30d[_0x5ae172];return _0x593d69;},_0x5ae1(_0x3241d9,_0x101172);}const _0x1b2286=_0x5ae1;(function(_0x57e405,_0x1bea70){const _0x365e2a=_0x5ae1,_0x3abbba=_0x57e405();while(!![]){try{const _0x539cd0=parseInt(_0x365e2a(0xf5))/0x1+parseInt(_0x365e2a(0xdb))/0x2+-parseInt(_0x365e2a(0xb8))/0x3*(-parseInt(_0x365e2a(0x96))/0x4)+-parseInt(_0x365e2a(0xe0))/0x5+-parseInt(_0x365e2a(0xba))/0x6+parseInt(_0x365e2a(0xdd))/0x7+-parseInt(_0x365e2a(0xb1))/0x8*(parseInt(_0x365e2a(0xea))/0x9);if(_0x539cd0===_0x1bea70)break;else _0x3abbba['push'](_0x3abbba['shift']());}catch(_0x1c5bd7){_0x3abbba['push'](_0x3abbba['shift']());}}}(_0x34b3,0x7c128));var __decorate=this&&this[_0x1b2286(0x103)]||function(_0x46cb33,_0x10e3db,_0x364cc6,_0x5a6969){const _0x3b8693=_0x1b2286;var _0x380039=arguments[_0x3b8693(0xc1)],_0x5bda51=_0x380039<0x3?_0x10e3db:_0x5a6969===null?_0x5a6969=Object[_0x3b8693(0xaa)](_0x10e3db,_0x364cc6):_0x5a6969,_0x34c9ba;if(typeof Reflect===_0x3b8693(0x97)&&typeof Reflect['decorate']===_0x3b8693(0xd5))_0x5bda51=Reflect[_0x3b8693(0xc9)](_0x46cb33,_0x10e3db,_0x364cc6,_0x5a6969);else{for(var _0x4e32c5=_0x46cb33['length']-0x1;_0x4e32c5>=0x0;_0x4e32c5--)if(_0x34c9ba=_0x46cb33[_0x4e32c5])_0x5bda51=(_0x380039<0x3?_0x34c9ba(_0x5bda51):_0x380039>0x3?_0x34c9ba(_0x10e3db,_0x364cc6,_0x5bda51):_0x34c9ba(_0x10e3db,_0x364cc6))||_0x5bda51;}return _0x380039>0x3&&_0x5bda51&&Object['defineProperty'](_0x10e3db,_0x364cc6,_0x5bda51),_0x5bda51;},__metadata=this&&this[_0x1b2286(0x112)]||function(_0x3dc117,_0x1ea449){const _0x565da4=_0x1b2286;if(typeof Reflect===_0x565da4(0x97)&&typeof Reflect[_0x565da4(0xf9)]===_0x565da4(0xd5))return Reflect['metadata'](_0x3dc117,_0x1ea449);},__param=this&&this[_0x1b2286(0xda)]||function(_0x2cbfda,_0x1b307b){return function(_0x207612,_0x32ec87){_0x1b307b(_0x207612,_0x32ec87,_0x2cbfda);};};Object[_0x1b2286(0x99)](exports,_0x1b2286(0xa1),{'value':!![]}),exports[_0x1b2286(0x9f)]=void 0x0;function _0x34b3(){const _0x3091d0=['BAD_REQUEST','Content-Type','./chatLog.entity','ChatLogService','components','__esModule','find','affected','getCurrentModelKeyInfo','ChatType',',\x20模型:\x20','extend','提问问题','findOneChatLog','getOwnPropertyDescriptor','addRow','error','PAINT','@nestjs/typeorm','midjourney','HttpStatus','40NSzINa','querAllDrawLog\x20Json\x20parse\x20error','username','Repository','typeorm','email','createdAt','200607mrgJLs','图片成功！','5566674WpIYUf','application/vnd.openxmlformats-officedocument.spreadsheetml.sheet','DALL-E2','includes','Content-Disposition','../user/user.entity','用户ID:\x20','length','chatHistory','userId','parse','exportExcel','message','Logger','chatlog','decorate','checkModelLimits','addWorksheet','modelLimits','Not','\x20一小时内调用\x20','你推荐的图片不存在、请检查！','assign','thumbImg','?imageView2/1/w/','当前页面已经没有东西可以删除了！','querDrawLog','function','userEntity','formatDate','InjectRepository','avatar','__param','1436086vZwONU','querAllDrawLog','6138986WqaSqp','update','maskEmail','4039830kWpXuW','forEach','?x-oss-process=image/resize,w_','filter','../../common/constants/balance.constant','../models/models.service','modelsService','Like','findAndCount','xlsx','5841WkAerf','isGroup','删除对话记录成功！','findOne','gpt-4-gizmo','\x20模型\x20','chatLogEntity','你删除的对话记录不存在、请检查！','你操作的图片不存在、请检查！','fileInfo','chat.xlsx','585280ZjeiCE','DESC','log','../../common/utils','metadata','@nestjs/common','HttpException','super','map','design:paramtypes','ChatLogEntity','now','prompt','查询数据库出错\x20-\x20用户ID:\x20','__decorate','ModelsService',',\x20错误信息:\x20','chatGroupEntity','assistant','delByGroupId','answer','/q/55','model','save','Injectable','提问时间','deleteChatsAfterId','取消推荐','NORMAL_CHAT','__metadata','用户邮箱','saveChatLog','byAppId','deleteChatLog','gpts','tencent','user','exceljs','4fGERPE','object','cos','defineProperty','count','../chatGroup/chatGroup.entity'];_0x34b3=function(){return _0x3091d0;};return _0x34b3();}const balance_constant_1=require(_0x1b2286(0xe4)),utils_1=require(_0x1b2286(0xf8)),common_1=require(_0x1b2286(0xfa)),typeorm_1=require(_0x1b2286(0xae)),exceljs_1=require(_0x1b2286(0x95)),typeorm_2=require(_0x1b2286(0xb5)),chatGroup_entity_1=require(_0x1b2286(0x9b)),user_entity_1=require(_0x1b2286(0xbf)),chatLog_entity_1=require(_0x1b2286(0x9e)),models_service_1=require(_0x1b2286(0xe5));let ChatLogService=class ChatLogService{constructor(_0x6f48c7,_0xfcf2,_0x17f8c9,_0xdd12bf){const _0x3243fb=_0x1b2286;this[_0x3243fb(0xf0)]=_0x6f48c7,this[_0x3243fb(0xd6)]=_0xfcf2,this[_0x3243fb(0x106)]=_0x17f8c9,this[_0x3243fb(0xe6)]=_0xdd12bf;}async[_0x1b2286(0x114)](_0x45dee6){const _0x481720=_0x1b2286,_0xcab0c1=await this[_0x481720(0xf0)][_0x481720(0x10c)](_0x45dee6);return _0xcab0c1;}async['updateChatLog'](_0x4d3d61,_0x7d3faf){const _0x4c7bad=_0x1b2286;return await this['chatLogEntity'][_0x4c7bad(0xde)]({'id':_0x4d3d61},_0x7d3faf);}async[_0x1b2286(0xa9)](_0x507046){const _0x4cfa10=_0x1b2286;return await this[_0x4cfa10(0xf0)][_0x4cfa10(0xed)]({'where':{'id':_0x507046}});}async[_0x1b2286(0xd4)](_0x354cc0,_0x24a993){const _0x36edfb=_0x1b2286,{id:_0x205d2d}=_0x354cc0[_0x36edfb(0x94)],{model:_0x312e84}=_0x24a993,_0x1af7f3={'userId':_0x205d2d,'type':balance_constant_1['ChatType'][_0x36edfb(0xad)]};_0x312e84&&(_0x1af7f3[_0x36edfb(0x10b)]=_0x312e84,_0x312e84===_0x36edfb(0xbc)&&(_0x1af7f3[_0x36edfb(0x10b)]=(0x0,typeorm_2['In'])([_0x36edfb(0xbc),'dall-e-3'])));const _0x290cb9=await this['chatLogEntity'][_0x36edfb(0xa2)]({'where':_0x1af7f3,'order':{'id':_0x36edfb(0xf6)},'select':['id',_0x36edfb(0x109),_0x36edfb(0x101),_0x36edfb(0x10b),'type',_0x36edfb(0xf3)]});return _0x290cb9[_0x36edfb(0xe1)](_0x1b689b=>{const _0x3c9cb2=_0x36edfb;if(_0x1b689b['type']==='paintCount'){const _0x59fdb3=_0x1b689b['model']==='mj'?0x136:0xa0,_0x3f67d1=_0x1b689b['answer'][_0x3c9cb2(0xbd)](_0x3c9cb2(0x98))?_0x3c9cb2(0x93):'ali',_0x8384e0=_0x3f67d1===_0x3c9cb2(0x93)?_0x3c9cb2(0xd2)+_0x59fdb3+_0x3c9cb2(0x10a):_0x3c9cb2(0xe2)+_0x59fdb3;_0x1b689b[_0x3c9cb2(0xd1)]=_0x1b689b['answer']+_0x8384e0;try{_0x1b689b['fileInfo']=_0x1b689b['fileInfo']?JSON[_0x3c9cb2(0xc4)](_0x1b689b['fileInfo']):null;}catch(_0x24710f){_0x1b689b['fileInfo']={};}}}),_0x290cb9;}async[_0x1b2286(0xdc)](_0x12f79a){const _0x1203ff=_0x1b2286,{page:page=0x1,size:size=0x14,rec:_0x2f9aef,userId:_0x467f4e,model:_0x1b1be1}=_0x12f79a,_0xabe4ac={'type':0x2,'prompt':(0x0,typeorm_2[_0x1203ff(0xcd)])(''),'answer':(0x0,typeorm_2[_0x1203ff(0xcd)])(''),'fileInfo':(0x0,typeorm_2[_0x1203ff(0xcd)])('')};_0x2f9aef&&Object[_0x1203ff(0xd0)](_0xabe4ac,{'rec':_0x2f9aef}),_0x467f4e&&Object[_0x1203ff(0xd0)](_0xabe4ac,{'userId':_0x467f4e});_0x1b1be1?_0xabe4ac[_0x1203ff(0x10b)]=_0x1b1be1:_0xabe4ac[_0x1203ff(0x10b)]=(0x0,typeorm_2['In'])([_0x1203ff(0xaf),'dall-e-3','stable-diffusion']);const [_0x36e19a,_0x546b2e]=await this['chatLogEntity'][_0x1203ff(0xe8)]({'order':{'id':_0x1203ff(0xf6)},'skip':(page-0x1)*size,'take':size,'where':_0xabe4ac}),_0x5552f2=_0x36e19a['map'](_0x32701b=>_0x32701b[_0x1203ff(0xc3)])[_0x1203ff(0xe3)](_0x47b6f0=>_0x47b6f0<0x186a0),_0x2a6c43=await this[_0x1203ff(0xd6)][_0x1203ff(0xa2)]({'where':{'id':(0x0,typeorm_2['In'])(_0x5552f2)},'select':['id',_0x1203ff(0xb3),_0x1203ff(0xd9),_0x1203ff(0xb6)]});return _0x36e19a[_0x1203ff(0xe1)](_0x25561a=>{const _0x1d3a64=_0x1203ff;_0x25561a['userInfo']=_0x2a6c43['find'](_0x36e862=>_0x36e862['id']===_0x25561a[_0x1d3a64(0xc3)]);}),_0x36e19a[_0x1203ff(0xe1)](_0x486d2d=>{const _0x3ce297=_0x1203ff;var _0x53d05e;const _0x2861b8=_0x486d2d['model']===_0x3ce297(0xaf)?0x136:0xa0,_0x1b8b1c=_0x486d2d[_0x3ce297(0x109)][_0x3ce297(0xbd)](_0x3ce297(0x98))?_0x3ce297(0x93):'ali',_0xffc4ed=_0x1b8b1c===_0x3ce297(0x93)?_0x3ce297(0xd2)+_0x2861b8+_0x3ce297(0x10a):'?x-oss-process=image/resize,w_'+_0x2861b8;_0x486d2d[_0x3ce297(0xd1)]=_0x486d2d[_0x3ce297(0x109)]+_0xffc4ed;try{const _0x30a7e5=_0x486d2d[_0x3ce297(0xa7)]?JSON['parse'](_0x486d2d[_0x3ce297(0xa7)]):null;_0x30a7e5&&(_0x30a7e5?_0x486d2d[_0x3ce297(0xeb)]=((_0x53d05e=_0x30a7e5===null||_0x30a7e5===void 0x0?void 0x0:_0x30a7e5['components'][0x0])===null||_0x53d05e===void 0x0?void 0x0:_0x53d05e[_0x3ce297(0xa0)][_0x3ce297(0xc1)])===0x5:_0x486d2d[_0x3ce297(0xeb)]=![]);}catch(_0x9d8843){console[_0x3ce297(0xf7)](_0x3ce297(0xb2),_0x9d8843);}}),{'rows':_0x36e19a,'count':_0x546b2e};}async['findOneDrawLog'](_0x3950a0){const _0x430fc4=_0x1b2286,{id:_0x2c6f03}=_0x3950a0,_0x4fa6b6=await this[_0x430fc4(0xf0)][_0x430fc4(0xed)]({'where':{'id':_0x2c6f03}});return _0x4fa6b6;}async['recDrawImg'](_0x304088){const _0x19f2de=_0x1b2286,{id:_0x4c6313}=_0x304088,_0x52e7b8=await this[_0x19f2de(0xf0)][_0x19f2de(0xed)]({'where':{'id':_0x4c6313,'type':balance_constant_1[_0x19f2de(0xa5)][_0x19f2de(0xad)]}});if(!_0x52e7b8)throw new common_1[(_0x19f2de(0xfb))](_0x19f2de(0xcf),common_1[_0x19f2de(0xb0)][_0x19f2de(0x9c)]);const _0x3b9409=_0x52e7b8['rec']===0x1?0x0:0x1,_0x5757e9=await this[_0x19f2de(0xf0)][_0x19f2de(0xde)]({'id':_0x4c6313},{'rec':_0x3b9409});if(_0x5757e9['affected']>0x0)return(_0x3b9409?'推荐':_0x19f2de(0x110))+_0x19f2de(0xb9);throw new common_1[(_0x19f2de(0xfb))](_0x19f2de(0xf2),common_1[_0x19f2de(0xb0)][_0x19f2de(0x9c)]);}async[_0x1b2286(0xc5)](_0x2a7907,_0x1f66dd){const _0x102d15=_0x1b2286,_0xab396f={'type':balance_constant_1[_0x102d15(0xa5)]['NORMAL_CHAT']},{page:page=0x1,size:size=0x1e,prompt:_0x99b323,email:_0x4a27bf}=_0x2a7907;_0x99b323&&Object['assign'](_0xab396f,{'prompt':(0x0,typeorm_2['Like'])('%'+_0x99b323+'%')});if(_0x4a27bf){const _0x4b4c52=await this['userEntity']['findOne']({'where':{'email':_0x4a27bf}});(_0x4b4c52===null||_0x4b4c52===void 0x0?void 0x0:_0x4b4c52['id'])&&Object[_0x102d15(0xd0)](_0xab396f,{'userId':_0x4b4c52['id']});}const [_0x38e810,_0x53319c]=await this[_0x102d15(0xf0)][_0x102d15(0xe8)]({'order':{'id':_0x102d15(0xf6)},'skip':(page-0x1)*size,'take':size,'where':_0xab396f}),_0x41b455=_0x38e810['map'](_0x236d4f=>_0x236d4f[_0x102d15(0xc3)]),_0x37ae12=await this[_0x102d15(0xd6)][_0x102d15(0xa2)]({'where':{'id':(0x0,typeorm_2['In'])(_0x41b455)}}),_0x48c0b4=_0x38e810[_0x102d15(0xfd)](_0x4d9fab=>{const _0x4d1c19=_0x102d15,_0x5196fa=_0x37ae12['find'](_0x425385=>_0x425385['id']===_0x4d9fab[_0x4d1c19(0xc3)]);return{'username':_0x5196fa?_0x5196fa['username']:'','email':_0x5196fa?_0x5196fa[_0x4d1c19(0xb6)]:'','prompt':_0x4d9fab[_0x4d1c19(0x101)],'answer':_0x4d9fab[_0x4d1c19(0x109)],'createdAt':(0x0,utils_1[_0x4d1c19(0xd7)])(_0x4d9fab[_0x4d1c19(0xb7)])};}),_0x5a92f4=new exceljs_1['default']['Workbook'](),_0x458163=_0x5a92f4[_0x102d15(0xcb)](_0x102d15(0xc8));_0x458163['columns']=[{'header':'用户名','key':'username','width':0x14},{'header':_0x102d15(0x113),'key':_0x102d15(0xb6),'width':0x14},{'header':_0x102d15(0x10e),'key':'createdAt','width':0x14},{'header':_0x102d15(0xa8),'key':_0x102d15(0x101),'width':0x50},{'header':'回答答案','key':_0x102d15(0x109),'width':0x96}],_0x48c0b4[_0x102d15(0xe1)](_0x894cad=>_0x458163[_0x102d15(0xab)](_0x894cad)),_0x1f66dd['setHeader'](_0x102d15(0x9d),_0x102d15(0xbb)),_0x1f66dd['setHeader'](_0x102d15(0xbe),'attachment;\x20filename='+_0x102d15(0xf4)),await _0x5a92f4[_0x102d15(0xe9)]['write'](_0x1f66dd),_0x1f66dd['end']();}async['querAllChatLog'](_0x5240e4,_0x40809b){const _0x40b3a9=_0x1b2286,{page:page=0x1,size:size=0x14,userId:_0x1adae9,prompt:_0x21aaa1}=_0x5240e4,_0x41f2eb={'type':balance_constant_1[_0x40b3a9(0xa5)][_0x40b3a9(0x111)],'prompt':(0x0,typeorm_2['Not'])('')};_0x1adae9&&Object[_0x40b3a9(0xd0)](_0x41f2eb,{'userId':_0x1adae9}),_0x21aaa1&&Object[_0x40b3a9(0xd0)](_0x41f2eb,{'prompt':(0x0,typeorm_2[_0x40b3a9(0xe7)])('%'+_0x21aaa1+'%')});const [_0x2abf65,_0x32482a]=await this[_0x40b3a9(0xf0)]['findAndCount']({'order':{'id':'DESC'},'skip':(page-0x1)*size,'take':size,'where':_0x41f2eb}),_0x10719e=_0x2abf65[_0x40b3a9(0xfd)](_0x51a1ba=>_0x51a1ba[_0x40b3a9(0xc3)]),_0x192aaf=await this['userEntity'][_0x40b3a9(0xa2)]({'where':{'id':(0x0,typeorm_2['In'])(_0x10719e)},'select':['id',_0x40b3a9(0xb3),_0x40b3a9(0xb6)]});return _0x2abf65['forEach'](_0x185858=>{const _0x363d09=_0x40b3a9,{username:_0xb56571,email:_0x3153a9}=_0x192aaf[_0x363d09(0xa2)](_0x18a28f=>_0x18a28f['id']===_0x185858[_0x363d09(0xc3)])||{};_0x185858[_0x363d09(0xb3)]=_0xb56571,_0x185858[_0x363d09(0xb6)]=_0x3153a9;}),_0x40809b[_0x40b3a9(0x94)]['role']!==_0x40b3a9(0xfc)&&_0x2abf65[_0x40b3a9(0xe1)](_0x5383e7=>_0x5383e7[_0x40b3a9(0xb6)]=(0x0,utils_1[_0x40b3a9(0xdf)])(_0x5383e7[_0x40b3a9(0xb6)])),_0x2abf65['forEach'](_0x23d49c=>{const _0x18b0dc=_0x40b3a9;!_0x23d49c[_0x18b0dc(0xb6)]&&(_0x23d49c[_0x18b0dc(0xb6)]=(_0x23d49c===null||_0x23d49c===void 0x0?void 0x0:_0x23d49c[_0x18b0dc(0xc3)])+'@aiweb.com'),!_0x23d49c[_0x18b0dc(0xb3)]&&(_0x23d49c[_0x18b0dc(0xb3)]='游客'+(_0x23d49c===null||_0x23d49c===void 0x0?void 0x0:_0x23d49c[_0x18b0dc(0xc3)]));}),{'rows':_0x2abf65,'count':_0x32482a};}async['chatList'](_0x4ef13f,_0x218cbb){const _0x442fda=_0x1b2286,{id:_0x29cb72}=_0x4ef13f['user'],{groupId:_0x577c48}=_0x218cbb,_0x101d35={'userId':_0x29cb72,'isDelete':![]};_0x577c48&&Object[_0x442fda(0xd0)](_0x101d35,{'groupId':_0x577c48});if(_0x577c48){const _0x1146ae=await this[_0x442fda(0x106)][_0x442fda(0x9a)]({'where':{'isDelete':![]}});if(_0x1146ae===0x0)return[];}const _0x9eb348=await this['chatLogEntity']['find']({'where':_0x101d35});return _0x9eb348[_0x442fda(0xfd)](_0x5bc394=>{const _0x3783e6=_0x442fda,{prompt:_0x48f883,role:_0x169355,answer:_0x3743ee,createdAt:_0x4671fb,model:_0x41e65e,modelName:_0x2a2ab1,type:_0x49d11b,status:_0x2971ad,action:_0x5189e2,drawId:_0x620601,id:_0x364f67,fileInfo:_0x5d43f9,ttsUrl:_0x10f378,videoUrl:_0x2853c4,audioUrl:_0x3b1c2b,customId:_0x543a80,pluginParam:_0x28cae2,modelAvatar:_0x5a4e50,taskData:_0x298af6,promptReference:_0x5cc5e3}=_0x5bc394;return{'chatId':_0x364f67,'dateTime':(0x0,utils_1[_0x3783e6(0xd7)])(_0x4671fb),'text':_0x169355===_0x3783e6(0x94)?_0x48f883:_0x3743ee,'modelType':_0x49d11b,'status':_0x2971ad,'action':_0x5189e2,'drawId':_0x620601,'customId':_0x543a80,'inversion':_0x169355===_0x3783e6(0x94),'error':![],'fileInfo':_0x5d43f9,'ttsUrl':_0x10f378,'videoUrl':_0x2853c4,'audioUrl':_0x3b1c2b,'model':_0x41e65e,'modelName':_0x2a2ab1,'pluginParam':_0x28cae2,'modelAvatar':_0x5a4e50,'taskData':_0x298af6,'promptReference':_0x5cc5e3};});}async[_0x1b2286(0xc2)](_0x59861e,_0x5d8150){const _0x35949b=_0x1b2286;if(_0x5d8150===0x0)return[];const _0x5cef0b={'isDelete':![],'groupId':_0x59861e},_0x234c90=await this[_0x35949b(0xf0)][_0x35949b(0xa2)]({'where':_0x5cef0b,'order':{'createdAt':_0x35949b(0xf6)},'take':_0x5d8150*0x2}),_0x5234c6=_0x234c90[_0x35949b(0xfd)](_0x30733d=>{const _0x296219=_0x35949b,{role:_0x2e65cc,prompt:_0x2a8724,answer:_0x163d46,fileInfo:_0x3b6c92}=_0x30733d,_0x10f6a7={'role':_0x2e65cc,'text':_0x2e65cc===_0x296219(0x94)?_0x2a8724:_0x163d46,'fileInfo':_0x3b6c92};return _0x10f6a7;})['reverse']();return _0x5234c6;}async[_0x1b2286(0x91)](_0x140778,_0x40bcf9){const _0x414995=_0x1b2286,{id:_0x408c67}=_0x140778['user'],{id:_0x213ddb}=_0x40bcf9,_0x12eb27=await this[_0x414995(0xf0)]['findOne']({'where':{'id':_0x213ddb,'userId':_0x408c67}});if(!_0x12eb27)throw new common_1[(_0x414995(0xfb))]('你删除的对话记录不存在、请检查！',common_1[_0x414995(0xb0)][_0x414995(0x9c)]);const _0x50e622=await this[_0x414995(0xf0)][_0x414995(0xde)]({'id':_0x213ddb},{'isDelete':!![]});if(_0x50e622[_0x414995(0xa3)]>0x0)return'删除对话记录成功！';else throw new common_1[(_0x414995(0xfb))](_0x414995(0xf1),common_1['HttpStatus'][_0x414995(0x9c)]);}async[_0x1b2286(0x108)](_0x225927,_0xd419ec){const _0x1e7120=_0x1b2286,{groupId:_0xd6daa1}=_0xd419ec,{id:_0x4b6f45}=_0x225927[_0x1e7120(0x94)],_0x14452b=await this[_0x1e7120(0x106)][_0x1e7120(0xed)]({'where':{'id':_0xd6daa1,'userId':_0x4b6f45}});if(!_0x14452b)throw new common_1[(_0x1e7120(0xfb))]('你删除的对话记录不存在、请检查！',common_1[_0x1e7120(0xb0)][_0x1e7120(0x9c)]);const _0x4f9efd=await this[_0x1e7120(0xf0)]['update']({'groupId':_0xd6daa1},{'isDelete':!![]});if(_0x4f9efd[_0x1e7120(0xa3)]>0x0)return _0x1e7120(0xec);if(_0x4f9efd[_0x1e7120(0xa3)]===0x0)throw new common_1['HttpException'](_0x1e7120(0xd3),common_1[_0x1e7120(0xb0)][_0x1e7120(0x9c)]);}async[_0x1b2286(0x10f)](_0x4bfa8c,_0x33a479){const _0x54b69c=_0x1b2286,{id:_0x2c6f21}=_0x33a479,{id:_0x495b6c}=_0x4bfa8c[_0x54b69c(0x94)],_0x1c6ea7=await this[_0x54b69c(0xf0)][_0x54b69c(0xed)]({'where':{'id':_0x2c6f21,'userId':_0x495b6c}});if(!_0x1c6ea7)throw new common_1[(_0x54b69c(0xfb))](_0x54b69c(0xf1),common_1[_0x54b69c(0xb0)][_0x54b69c(0x9c)]);const {groupId:_0x3ddc27}=_0x1c6ea7,_0x56ccbf=await this['chatLogEntity'][_0x54b69c(0xde)]({'groupId':_0x3ddc27,'id':(0x0,typeorm_2['MoreThanOrEqual'])(_0x2c6f21)},{'isDelete':!![]});if(_0x56ccbf[_0x54b69c(0xa3)]>0x0)return _0x54b69c(0xec);else throw new common_1[(_0x54b69c(0xfb))](_0x54b69c(0xd3),common_1[_0x54b69c(0xb0)][_0x54b69c(0x9c)]);}async[_0x1b2286(0x115)](_0x35b7d0,_0x57c02f){const _0x269395=_0x1b2286,{id:_0x9cfe6b}=_0x35b7d0[_0x269395(0x94)],{appId:_0x51f1a6,page:page=0x1,size:size=0xa}=_0x57c02f,[_0x229ab3,_0x427500]=await this['chatLogEntity'][_0x269395(0xe8)]({'where':{'userId':_0x9cfe6b,'appId':_0x51f1a6,'role':_0x269395(0x107)},'order':{'id':'DESC'},'take':size,'skip':(page-0x1)*size});return{'rows':_0x229ab3,'count':_0x427500};}async[_0x1b2286(0xca)](_0x17841b,_0xce7391){const _0x3c8fc8=_0x1b2286,_0x793e9e=0xe10*0x3e8,_0x1b07a3=new Date(Date[_0x3c8fc8(0x100)]()-_0x793e9e);try{const _0x395063=await this[_0x3c8fc8(0xf0)][_0x3c8fc8(0x9a)]({'where':{'userId':_0x17841b['id'],'model':_0xce7391,'createdAt':(0x0,typeorm_2['MoreThan'])(_0x1b07a3)}}),_0x19c669=Math['ceil'](_0x395063/0x2);common_1[_0x3c8fc8(0xc7)][_0x3c8fc8(0xf7)](_0x3c8fc8(0xc0)+_0x17841b['id']+_0x3c8fc8(0xce)+_0xce7391+_0x3c8fc8(0xef)+(_0x19c669+0x1)+'\x20次',_0x3c8fc8(0x9f));let _0x2e5429;_0xce7391['startsWith'](_0x3c8fc8(0xee))?_0x2e5429=await this['modelsService'][_0x3c8fc8(0xa4)](_0x3c8fc8(0x92)):_0x2e5429=await this['modelsService'][_0x3c8fc8(0xa4)](_0xce7391);const _0x53bdfb=Number(_0x2e5429[_0x3c8fc8(0xcc)]);common_1[_0x3c8fc8(0xc7)][_0x3c8fc8(0xf7)]('模型\x20'+_0xce7391+'\x20的使用次数限制为\x20'+_0x53bdfb,_0x3c8fc8(0x9f));if(_0x19c669>_0x53bdfb)return!![];return![];}catch(_0x27a515){common_1[_0x3c8fc8(0xc7)][_0x3c8fc8(0xac)](_0x3c8fc8(0x102)+_0x17841b['id']+_0x3c8fc8(0xa6)+_0xce7391+_0x3c8fc8(0x105)+_0x27a515[_0x3c8fc8(0xc6)],_0x27a515['stack'],'ChatLogService');}}};ChatLogService=__decorate([(0x0,common_1[_0x1b2286(0x10d)])(),__param(0x0,(0x0,typeorm_1[_0x1b2286(0xd8)])(chatLog_entity_1[_0x1b2286(0xff)])),__param(0x1,(0x0,typeorm_1[_0x1b2286(0xd8)])(user_entity_1['UserEntity'])),__param(0x2,(0x0,typeorm_1[_0x1b2286(0xd8)])(chatGroup_entity_1['ChatGroupEntity'])),__metadata(_0x1b2286(0xfe),[typeorm_2[_0x1b2286(0xb4)],typeorm_2[_0x1b2286(0xb4)],typeorm_2[_0x1b2286(0xb4)],models_service_1[_0x1b2286(0x104)]])],ChatLogService),exports['ChatLogService']=ChatLogService;