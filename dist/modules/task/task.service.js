'use strict';const _0x55d9c5=_0x534a;function _0x3ca9(){const _0x4b1094=['Injectable','2266579qkMLAl','defineProperty','2640828FSejFZ','15118AtlgYX','prototype','TaskService','Cron','30aSBLyd','update','CronExpression','../userBalance/userBalance.entity','design:paramtypes','Automatically\x20refresh\x20WeChat\x20access\x20every\x20hour\x20Token','Logger','391576txYqYQ','metadata','959589GstOnj','getOwnPropertyDescriptor','__esModule','length','../models/models.service','24ZJGuPq','@nestjs/common','Repository','function','typeorm','./../globalConfig/globalConfig.service','GlobalConfigService','globalConfigService','then','InjectRepository','object','userBalanceEntity','handleCron','__metadata','find','debug','checkUserMemerExpire','141NfivOT','@nestjs/schedule','EVERY_HOUR','design:returntype','1853588RRDQUD','LessThanOrEqual','8383850oIhTfy','EVERY_5_MINUTES','getWechatAccessToken','modelsService','design:type','__decorate','ModelsService','decorate','__param','UserBalanceEntity'];_0x3ca9=function(){return _0x4b1094;};return _0x3ca9();}(function(_0x3b4376,_0x2d713b){const _0x22cf69=_0x534a,_0x467cf2=_0x3b4376();while(!![]){try{const _0x1f968e=parseInt(_0x22cf69(0x9b))/0x1+-parseInt(_0x22cf69(0x74))/0x2*(-parseInt(_0x22cf69(0x97))/0x3)+-parseInt(_0x22cf69(0x7f))/0x4*(parseInt(_0x22cf69(0x78))/0x5)+-parseInt(_0x22cf69(0x73))/0x6+-parseInt(_0x22cf69(0x71))/0x7*(parseInt(_0x22cf69(0x86))/0x8)+-parseInt(_0x22cf69(0x81))/0x9+parseInt(_0x22cf69(0x9d))/0xa;if(_0x1f968e===_0x2d713b)break;else _0x467cf2['push'](_0x467cf2['shift']());}catch(_0x2c5ca8){_0x467cf2['push'](_0x467cf2['shift']());}}}(_0x3ca9,0xe5ea4));var __decorate=this&&this[_0x55d9c5(0xa2)]||function(_0x397afa,_0x2a602f,_0x796eda,_0x1475ac){const _0x40fa61=_0x55d9c5;var _0x9e408=arguments['length'],_0x38d0e8=_0x9e408<0x3?_0x2a602f:_0x1475ac===null?_0x1475ac=Object[_0x40fa61(0x82)](_0x2a602f,_0x796eda):_0x1475ac,_0x4dc3cf;if(typeof Reflect===_0x40fa61(0x90)&&typeof Reflect[_0x40fa61(0x6d)]===_0x40fa61(0x89))_0x38d0e8=Reflect[_0x40fa61(0x6d)](_0x397afa,_0x2a602f,_0x796eda,_0x1475ac);else{for(var _0x34faac=_0x397afa[_0x40fa61(0x84)]-0x1;_0x34faac>=0x0;_0x34faac--)if(_0x4dc3cf=_0x397afa[_0x34faac])_0x38d0e8=(_0x9e408<0x3?_0x4dc3cf(_0x38d0e8):_0x9e408>0x3?_0x4dc3cf(_0x2a602f,_0x796eda,_0x38d0e8):_0x4dc3cf(_0x2a602f,_0x796eda))||_0x38d0e8;}return _0x9e408>0x3&&_0x38d0e8&&Object[_0x40fa61(0x72)](_0x2a602f,_0x796eda,_0x38d0e8),_0x38d0e8;},__metadata=this&&this[_0x55d9c5(0x93)]||function(_0x443fcf,_0x9a0a0d){const _0x395861=_0x55d9c5;if(typeof Reflect==='object'&&typeof Reflect[_0x395861(0x80)]===_0x395861(0x89))return Reflect[_0x395861(0x80)](_0x443fcf,_0x9a0a0d);},__param=this&&this[_0x55d9c5(0x6e)]||function(_0x3abb4c,_0x54098b){return function(_0xfe7235,_0x1b6765){_0x54098b(_0xfe7235,_0x1b6765,_0x3abb4c);};};function _0x534a(_0x5c8a66,_0x3f68f6){const _0x3ca94a=_0x3ca9();return _0x534a=function(_0x534abf,_0x5cc810){_0x534abf=_0x534abf-0x6d;let _0x444c46=_0x3ca94a[_0x534abf];return _0x444c46;},_0x534a(_0x5c8a66,_0x3f68f6);}Object[_0x55d9c5(0x72)](exports,_0x55d9c5(0x83),{'value':!![]}),exports[_0x55d9c5(0x76)]=void 0x0;const globalConfig_service_1=require(_0x55d9c5(0x8b)),common_1=require(_0x55d9c5(0x87)),schedule_1=require(_0x55d9c5(0x98)),userBalance_entity_1=require(_0x55d9c5(0x7b)),typeorm_1=require('@nestjs/typeorm'),typeorm_2=require(_0x55d9c5(0x8a)),models_service_1=require(_0x55d9c5(0x85));let TaskService=class TaskService{constructor(_0xbe275b,_0x5ba932,_0x49a692){const _0x193008=_0x55d9c5;this['userBalanceEntity']=_0xbe275b,this['globalConfigService']=_0x5ba932,this[_0x193008(0xa0)]=_0x49a692;}['handleCron'](){const _0x16990f=_0x55d9c5;common_1[_0x16990f(0x7e)][_0x16990f(0x95)](_0x16990f(0x7d),_0x16990f(0x76)),this[_0x16990f(0x8d)][_0x16990f(0x9f)]();}async[_0x55d9c5(0x96)](){const _0x198175=_0x55d9c5,_0x3729bd=await this[_0x198175(0x91)][_0x198175(0x94)]({'where':{'expirationTime':(0x0,typeorm_2[_0x198175(0x9c)])(new Date())}});if(!_0x3729bd||!_0x3729bd['length'])return;_0x3729bd['forEach'](_0x186838=>{const _0x437720=_0x198175;this['userBalanceEntity'][_0x437720(0x79)]({'id':_0x186838['id']},{'expirationTime':null,'packageId':0x0,'memberModel3Count':0x0,'memberModel4Count':0x0,'memberDrawMjCount':0x0})[_0x437720(0x8e)](_0x4392ed=>{const _0x32cf3e=_0x437720;common_1[_0x32cf3e(0x7e)]['debug'](_0x186838['id']+'会员已到期、清空所有余额并移除会员身份！',_0x32cf3e(0x76));});});}};__decorate([(0x0,schedule_1[_0x55d9c5(0x77)])(schedule_1[_0x55d9c5(0x7a)][_0x55d9c5(0x99)]),__metadata('design:type',Function),__metadata('design:paramtypes',[]),__metadata(_0x55d9c5(0x9a),void 0x0)],TaskService[_0x55d9c5(0x75)],_0x55d9c5(0x92),null),__decorate([(0x0,schedule_1[_0x55d9c5(0x77)])(schedule_1[_0x55d9c5(0x7a)][_0x55d9c5(0x9e)]),__metadata(_0x55d9c5(0xa1),Function),__metadata(_0x55d9c5(0x7c),[]),__metadata(_0x55d9c5(0x9a),Promise)],TaskService['prototype'],'checkUserMemerExpire',null),TaskService=__decorate([(0x0,common_1[_0x55d9c5(0x70)])(),__param(0x0,(0x0,typeorm_1[_0x55d9c5(0x8f)])(userBalance_entity_1[_0x55d9c5(0x6f)])),__metadata(_0x55d9c5(0x7c),[typeorm_2[_0x55d9c5(0x88)],globalConfig_service_1[_0x55d9c5(0x8c)],models_service_1[_0x55d9c5(0xa3)]])],TaskService),exports[_0x55d9c5(0x76)]=TaskService;