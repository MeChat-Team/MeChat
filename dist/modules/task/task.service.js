'use strict';const _0x310c08=_0x56e4;(function(_0x2aa1a3,_0x3a12f5){const _0x19388c=_0x56e4,_0xbcc82c=_0x2aa1a3();while(!![]){try{const _0x234d4e=-parseInt(_0x19388c(0xd8))/0x1*(-parseInt(_0x19388c(0xb5))/0x2)+parseInt(_0x19388c(0xc5))/0x3*(parseInt(_0x19388c(0xac))/0x4)+parseInt(_0x19388c(0xbf))/0x5*(-parseInt(_0x19388c(0xbe))/0x6)+-parseInt(_0x19388c(0xb7))/0x7+parseInt(_0x19388c(0xa8))/0x8+-parseInt(_0x19388c(0xa9))/0x9+parseInt(_0x19388c(0xd6))/0xa;if(_0x234d4e===_0x3a12f5)break;else _0xbcc82c['push'](_0xbcc82c['shift']());}catch(_0x50783d){_0xbcc82c['push'](_0xbcc82c['shift']());}}}(_0x4fa1,0xb5ea9));var __decorate=this&&this[_0x310c08(0xb3)]||function(_0x5aa912,_0x9329d1,_0x26ac6f,_0xb8dc4d){const _0x153ecc=_0x310c08;var _0x3bbda8=arguments['length'],_0x238dba=_0x3bbda8<0x3?_0x9329d1:_0xb8dc4d===null?_0xb8dc4d=Object[_0x153ecc(0xc0)](_0x9329d1,_0x26ac6f):_0xb8dc4d,_0x268753;if(typeof Reflect==='object'&&typeof Reflect[_0x153ecc(0xd0)]==='function')_0x238dba=Reflect['decorate'](_0x5aa912,_0x9329d1,_0x26ac6f,_0xb8dc4d);else{for(var _0x3349f1=_0x5aa912[_0x153ecc(0xc7)]-0x1;_0x3349f1>=0x0;_0x3349f1--)if(_0x268753=_0x5aa912[_0x3349f1])_0x238dba=(_0x3bbda8<0x3?_0x268753(_0x238dba):_0x3bbda8>0x3?_0x268753(_0x9329d1,_0x26ac6f,_0x238dba):_0x268753(_0x9329d1,_0x26ac6f))||_0x238dba;}return _0x3bbda8>0x3&&_0x238dba&&Object[_0x153ecc(0xcc)](_0x9329d1,_0x26ac6f,_0x238dba),_0x238dba;},__metadata=this&&this['__metadata']||function(_0x26748e,_0x209842){const _0x227171=_0x310c08;if(typeof Reflect==='object'&&typeof Reflect[_0x227171(0xb9)]===_0x227171(0xc1))return Reflect[_0x227171(0xb9)](_0x26748e,_0x209842);},__param=this&&this[_0x310c08(0xb1)]||function(_0x43bed3,_0x2c2632){return function(_0x29e99a,_0x26c49d){_0x2c2632(_0x29e99a,_0x26c49d,_0x43bed3);};};function _0x56e4(_0x26ed42,_0x1565cb){const _0x4fa158=_0x4fa1();return _0x56e4=function(_0x56e462,_0x3f2873){_0x56e462=_0x56e462-0xa7;let _0x44889c=_0x4fa158[_0x56e462];return _0x44889c;},_0x56e4(_0x26ed42,_0x1565cb);}Object[_0x310c08(0xcc)](exports,_0x310c08(0xc4),{'value':!![]}),exports[_0x310c08(0xcb)]=void 0x0;function _0x4fa1(){const _0xbeae60=['Cron','__decorate','design:returntype','2571146dYiwhT','LessThanOrEqual','5908994JSWSlQ','../models/models.service','metadata','forEach','Injectable','UserBalanceEntity','globalConfigService','2823762uIaqRH','10TCsyZn','getOwnPropertyDescriptor','function','design:type','Logger','__esModule','21bhyCVq','ModelsService','length','Repository','then','modelsService','TaskService','defineProperty','find','design:paramtypes','Automatically\x20refresh\x20WeChat\x20access\x20every\x20hour\x20Token','decorate','InjectRepository','update','getWechatAccessToken','typeorm','handleCron','1933530LUMQvx','../userBalance/userBalance.entity','1HAsWBg','prototype','2510048hUWlam','1223955utFydj','@nestjs/schedule','debug','499336OJlYfW','EVERY_HOUR','@nestjs/common','CronExpression','checkUserMemerExpire','__param'];_0x4fa1=function(){return _0xbeae60;};return _0x4fa1();}const globalConfig_service_1=require('./../globalConfig/globalConfig.service'),common_1=require(_0x310c08(0xae)),schedule_1=require(_0x310c08(0xaa)),userBalance_entity_1=require(_0x310c08(0xd7)),typeorm_1=require('@nestjs/typeorm'),typeorm_2=require(_0x310c08(0xd4)),models_service_1=require(_0x310c08(0xb8));let TaskService=class TaskService{constructor(_0x3342d5,_0x40d561,_0xaa5545){const _0x4866c7=_0x310c08;this['userBalanceEntity']=_0x3342d5,this[_0x4866c7(0xbd)]=_0x40d561,this[_0x4866c7(0xca)]=_0xaa5545;}['handleCron'](){const _0x5661fc=_0x310c08;common_1['Logger'][_0x5661fc(0xab)](_0x5661fc(0xcf),'TaskService'),this[_0x5661fc(0xbd)][_0x5661fc(0xd3)]();}async['checkUserMemerExpire'](){const _0x438198=_0x310c08,_0x5148df=await this['userBalanceEntity'][_0x438198(0xcd)]({'where':{'expirationTime':(0x0,typeorm_2[_0x438198(0xb6)])(new Date())}});if(!_0x5148df||!_0x5148df[_0x438198(0xc7)])return;_0x5148df[_0x438198(0xba)](_0x254e15=>{const _0x5925fb=_0x438198;this['userBalanceEntity'][_0x5925fb(0xd2)]({'id':_0x254e15['id']},{'expirationTime':null,'packageId':0x0,'memberModel3Count':0x0,'memberModel4Count':0x0,'memberDrawMjCount':0x0})[_0x5925fb(0xc9)](_0x3361a7=>{const _0x3389ab=_0x5925fb;common_1[_0x3389ab(0xc3)][_0x3389ab(0xab)](_0x254e15['id']+'会员已到期、清空所有余额并移除会员身份！',_0x3389ab(0xcb));});});}};__decorate([(0x0,schedule_1['Cron'])(schedule_1[_0x310c08(0xaf)][_0x310c08(0xad)]),__metadata(_0x310c08(0xc2),Function),__metadata(_0x310c08(0xce),[]),__metadata(_0x310c08(0xb4),void 0x0)],TaskService[_0x310c08(0xa7)],_0x310c08(0xd5),null),__decorate([(0x0,schedule_1[_0x310c08(0xb2)])(schedule_1[_0x310c08(0xaf)]['EVERY_5_MINUTES']),__metadata(_0x310c08(0xc2),Function),__metadata(_0x310c08(0xce),[]),__metadata(_0x310c08(0xb4),Promise)],TaskService[_0x310c08(0xa7)],_0x310c08(0xb0),null),TaskService=__decorate([(0x0,common_1[_0x310c08(0xbb)])(),__param(0x0,(0x0,typeorm_1[_0x310c08(0xd1)])(userBalance_entity_1[_0x310c08(0xbc)])),__metadata(_0x310c08(0xce),[typeorm_2[_0x310c08(0xc8)],globalConfig_service_1['GlobalConfigService'],models_service_1[_0x310c08(0xc6)]])],TaskService),exports[_0x310c08(0xcb)]=TaskService;