'use strict';function _0x5e7d(){const _0x1d524b=['prototype','getOwnPropertyDescriptor','2140995BOveSs','@nestjs/schedule','../userBalance/userBalance.entity','CronExpression','36877104mrMMYR','UserBalanceEntity','Injectable','351LDlUbB','EVERY_HOUR','globalConfigService','debug','./../globalConfig/globalConfig.service','@nestjs/common','Logger','object','checkUserMemerExpire','__esModule','userBalanceEntity','__metadata','303511mPMqnZ','38673dOsgca','EVERY_5_MINUTES','length','40632fpCdqm','../models/models.service','GlobalConfigService','Repository','forEach','decorate','2223806riSSNe','metadata','defineProperty','design:type','function','modelsService','then','Automatically\x20refresh\x20WeChat\x20access\x20every\x20hour\x20Token','LessThanOrEqual','TaskService','7WpNHtY','1710XSMZOu','5916776lHQUqn','design:returntype','handleCron','__decorate','18lSqSKw','Cron','__param','@nestjs/typeorm'];_0x5e7d=function(){return _0x1d524b;};return _0x5e7d();}const _0x5f4027=_0x2bc5;(function(_0x1b55fd,_0x566c7f){const _0x314772=_0x2bc5,_0x28622b=_0x1b55fd();while(!![]){try{const _0x78aa48=parseInt(_0x314772(0x221))/0x1+-parseInt(_0x314772(0x1f8))/0x2+parseInt(_0x314772(0x215))/0x3*(parseInt(_0x314772(0x1f2))/0x4)+-parseInt(_0x314772(0x20e))/0x5*(parseInt(_0x314772(0x208))/0x6)+-parseInt(_0x314772(0x202))/0x7*(parseInt(_0x314772(0x204))/0x8)+-parseInt(_0x314772(0x1ef))/0x9*(parseInt(_0x314772(0x203))/0xa)+parseInt(_0x314772(0x212))/0xb;if(_0x78aa48===_0x566c7f)break;else _0x28622b['push'](_0x28622b['shift']());}catch(_0x341145){_0x28622b['push'](_0x28622b['shift']());}}}(_0x5e7d,0xedb09));var __decorate=this&&this[_0x5f4027(0x207)]||function(_0x3409ec,_0x3239d4,_0x227d84,_0x5b4cc7){const _0x1da14b=_0x5f4027;var _0x3f5153=arguments['length'],_0x493f3d=_0x3f5153<0x3?_0x3239d4:_0x5b4cc7===null?_0x5b4cc7=Object[_0x1da14b(0x20d)](_0x3239d4,_0x227d84):_0x5b4cc7,_0x8bd7c0;if(typeof Reflect===_0x1da14b(0x21c)&&typeof Reflect['decorate']===_0x1da14b(0x1fc))_0x493f3d=Reflect[_0x1da14b(0x1f7)](_0x3409ec,_0x3239d4,_0x227d84,_0x5b4cc7);else{for(var _0x1c4a7f=_0x3409ec['length']-0x1;_0x1c4a7f>=0x0;_0x1c4a7f--)if(_0x8bd7c0=_0x3409ec[_0x1c4a7f])_0x493f3d=(_0x3f5153<0x3?_0x8bd7c0(_0x493f3d):_0x3f5153>0x3?_0x8bd7c0(_0x3239d4,_0x227d84,_0x493f3d):_0x8bd7c0(_0x3239d4,_0x227d84))||_0x493f3d;}return _0x3f5153>0x3&&_0x493f3d&&Object['defineProperty'](_0x3239d4,_0x227d84,_0x493f3d),_0x493f3d;},__metadata=this&&this[_0x5f4027(0x220)]||function(_0x38c7bd,_0x4e0218){const _0x2e2156=_0x5f4027;if(typeof Reflect===_0x2e2156(0x21c)&&typeof Reflect[_0x2e2156(0x1f9)]===_0x2e2156(0x1fc))return Reflect[_0x2e2156(0x1f9)](_0x38c7bd,_0x4e0218);},__param=this&&this[_0x5f4027(0x20a)]||function(_0x12bf46,_0x32d27b){return function(_0x217282,_0x5a6d83){_0x32d27b(_0x217282,_0x5a6d83,_0x12bf46);};};Object[_0x5f4027(0x1fa)](exports,_0x5f4027(0x21e),{'value':!![]}),exports[_0x5f4027(0x201)]=void 0x0;const globalConfig_service_1=require(_0x5f4027(0x219)),common_1=require(_0x5f4027(0x21a)),schedule_1=require(_0x5f4027(0x20f)),userBalance_entity_1=require(_0x5f4027(0x210)),typeorm_1=require(_0x5f4027(0x20b)),typeorm_2=require('typeorm'),models_service_1=require(_0x5f4027(0x1f3));function _0x2bc5(_0x4559bd,_0x1cec28){const _0x5e7d9c=_0x5e7d();return _0x2bc5=function(_0x2bc573,_0x40df71){_0x2bc573=_0x2bc573-0x1ef;let _0x1710c8=_0x5e7d9c[_0x2bc573];return _0x1710c8;},_0x2bc5(_0x4559bd,_0x1cec28);}let TaskService=class TaskService{constructor(_0x42d9cd,_0x40856a,_0x2b4d34){const _0x145b82=_0x5f4027;this[_0x145b82(0x21f)]=_0x42d9cd,this[_0x145b82(0x217)]=_0x40856a,this[_0x145b82(0x1fd)]=_0x2b4d34;}[_0x5f4027(0x206)](){const _0x5ccb20=_0x5f4027;common_1[_0x5ccb20(0x21b)][_0x5ccb20(0x218)](_0x5ccb20(0x1ff),_0x5ccb20(0x201)),this[_0x5ccb20(0x217)]['getWechatAccessToken']();}async['checkUserMemerExpire'](){const _0x59c74b=_0x5f4027,_0x4210d5=await this['userBalanceEntity']['find']({'where':{'expirationTime':(0x0,typeorm_2[_0x59c74b(0x200)])(new Date())}});if(!_0x4210d5||!_0x4210d5[_0x59c74b(0x1f1)])return;_0x4210d5[_0x59c74b(0x1f6)](_0x3cc45d=>{const _0x240e01=_0x59c74b;this[_0x240e01(0x21f)]['update']({'id':_0x3cc45d['id']},{'expirationTime':null,'packageId':0x0,'memberModel3Count':0x0,'memberModel4Count':0x0,'memberDrawMjCount':0x0})[_0x240e01(0x1fe)](_0x4e1909=>{const _0x5ba4bc=_0x240e01;common_1[_0x5ba4bc(0x21b)][_0x5ba4bc(0x218)](_0x3cc45d['id']+'会员已到期、清空所有余额并移除会员身份！','TaskService');});});}};__decorate([(0x0,schedule_1[_0x5f4027(0x209)])(schedule_1[_0x5f4027(0x211)][_0x5f4027(0x216)]),__metadata('design:type',Function),__metadata('design:paramtypes',[]),__metadata('design:returntype',void 0x0)],TaskService[_0x5f4027(0x20c)],_0x5f4027(0x206),null),__decorate([(0x0,schedule_1['Cron'])(schedule_1[_0x5f4027(0x211)][_0x5f4027(0x1f0)]),__metadata(_0x5f4027(0x1fb),Function),__metadata('design:paramtypes',[]),__metadata(_0x5f4027(0x205),Promise)],TaskService[_0x5f4027(0x20c)],_0x5f4027(0x21d),null),TaskService=__decorate([(0x0,common_1[_0x5f4027(0x214)])(),__param(0x0,(0x0,typeorm_1['InjectRepository'])(userBalance_entity_1[_0x5f4027(0x213)])),__metadata('design:paramtypes',[typeorm_2[_0x5f4027(0x1f5)],globalConfig_service_1[_0x5f4027(0x1f4)],models_service_1['ModelsService']])],TaskService),exports[_0x5f4027(0x201)]=TaskService;