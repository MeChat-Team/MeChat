'use strict';const _0xb9372=_0x51d0;(function(_0x4c79b4,_0x44775b){const _0x148288=_0x51d0,_0x3bb6b6=_0x4c79b4();while(!![]){try{const _0x3bee50=parseInt(_0x148288(0xcb))/0x1*(parseInt(_0x148288(0xff))/0x2)+parseInt(_0x148288(0xc0))/0x3*(-parseInt(_0x148288(0x100))/0x4)+parseInt(_0x148288(0xcc))/0x5*(-parseInt(_0x148288(0x104))/0x6)+-parseInt(_0x148288(0xd1))/0x7*(-parseInt(_0x148288(0xd0))/0x8)+parseInt(_0x148288(0xcf))/0x9+parseInt(_0x148288(0xee))/0xa*(-parseInt(_0x148288(0xdf))/0xb)+parseInt(_0x148288(0xea))/0xc*(parseInt(_0x148288(0xd3))/0xd);if(_0x3bee50===_0x44775b)break;else _0x3bb6b6['push'](_0x3bb6b6['shift']());}catch(_0x26bd0c){_0x3bb6b6['push'](_0x3bb6b6['shift']());}}}(_0x5ce7,0xeb97f));var __decorate=this&&this['__decorate']||function(_0x25128e,_0x50e16b,_0x33f049,_0x32433b){const _0x2e2875=_0x51d0;var _0x2465be=arguments[_0x2e2875(0x106)],_0x55b458=_0x2465be<0x3?_0x50e16b:_0x32433b===null?_0x32433b=Object['getOwnPropertyDescriptor'](_0x50e16b,_0x33f049):_0x32433b,_0x40b8ee;if(typeof Reflect===_0x2e2875(0xc1)&&typeof Reflect[_0x2e2875(0x102)]===_0x2e2875(0xde))_0x55b458=Reflect[_0x2e2875(0x102)](_0x25128e,_0x50e16b,_0x33f049,_0x32433b);else{for(var _0x4d1a9b=_0x25128e[_0x2e2875(0x106)]-0x1;_0x4d1a9b>=0x0;_0x4d1a9b--)if(_0x40b8ee=_0x25128e[_0x4d1a9b])_0x55b458=(_0x2465be<0x3?_0x40b8ee(_0x55b458):_0x2465be>0x3?_0x40b8ee(_0x50e16b,_0x33f049,_0x55b458):_0x40b8ee(_0x50e16b,_0x33f049))||_0x55b458;}return _0x2465be>0x3&&_0x55b458&&Object['defineProperty'](_0x50e16b,_0x33f049,_0x55b458),_0x55b458;},__metadata=this&&this[_0xb9372(0xc9)]||function(_0x184798,_0x1d896d){const _0x317a7f=_0xb9372;if(typeof Reflect===_0x317a7f(0xc1)&&typeof Reflect['metadata']===_0x317a7f(0xde))return Reflect[_0x317a7f(0xc6)](_0x184798,_0x1d896d);},OpenAIDrawService_1;Object['defineProperty'](exports,_0xb9372(0xc2),{'value':!![]}),exports['OpenAIDrawService']=void 0x0;function _0x5ce7(){const _0x263740=['name','124240AudBzK','openAIChatService','绘制图片失败，请稍后试试吧！','您的请求已被系统拒绝。您的提示可能存在一些非法的文本。','uploadService','design:paramtypes','OpenAIChatService','error','上传图片过程中出现错误:\x20','Logger','根据提示词{','当前请求已过载、请稍等会儿再试试吧！','log','revised_prompt','../upload/upload.service','answer','1024x1024','68MHfNty','4uVNASR','status','decorate','globalConfigService','30MqmDIO','data','length','getDate','POST','图片上传成功，URL:\x20','stringify','includes','\x20绘制成功','./openaiChat.service','size','3726513fAeWdS','object','__esModule','你是一个绘画提示词生成工具，请根据用户的要求，结合上下文，用一段文字，描述用户需要的绘画需求，不用包含任何礼貌性的寒暄,只需要场景的描述,可以适当联想','getConfigs','UploadService','metadata','getMonth','response','__metadata','Injectable','2420EepAec','494465uWyGFF','ChatLogService','@nestjs/common','7997715JMGYSt','8UJuSQM','641326ygwRne','uploadFileFromUrl','33260110ttpaqF','Bearer\x20','text','logger','已开启连续绘画模式','绘制图片失败，此次绘画被拒绝了！','GlobalConfigService','当前模型key已被封禁、已冻结当前调用Key、尝试重新对话试试吧！','getFullYear','chatLogService','padStart','function','814pTfhHR','DrawService','},\x20模拟AI绘画机器人的语气，用中文回复，告诉用户已经画好了','images/dalle/','fileInfo','调用chatFree失败：','参考上文，结合我的需求，给出绘画描述。我的需求是：','chatFree','message','dalleDraw','url','12mYLvlL','/v1/images/generations','application/json'];_0x5ce7=function(){return _0x263740;};return _0x5ce7();}const common_1=require(_0xb9372(0xce)),axios_1=require('axios'),chatLog_service_1=require('../chatLog/chatLog.service'),globalConfig_service_1=require('../globalConfig/globalConfig.service'),upload_service_1=require(_0xb9372(0xfc)),openaiChat_service_1=require(_0xb9372(0xbe));function _0x51d0(_0x2cbaec,_0x54308c){const _0x5ce7af=_0x5ce7();return _0x51d0=function(_0x51d08c,_0x9f4e40){_0x51d08c=_0x51d08c-0xba;let _0x57eee5=_0x5ce7af[_0x51d08c];return _0x57eee5;},_0x51d0(_0x2cbaec,_0x54308c);}let OpenAIDrawService=OpenAIDrawService_1=class OpenAIDrawService{constructor(_0x1191cb,_0x459fee,_0x4bc25f,_0x56d2e2){const _0x46fc45=_0xb9372;this[_0x46fc45(0xf2)]=_0x1191cb,this[_0x46fc45(0x103)]=_0x459fee,this['chatLogService']=_0x4bc25f,this['openAIChatService']=_0x56d2e2,this[_0x46fc45(0xd6)]=new common_1['Logger'](OpenAIDrawService_1[_0x46fc45(0xed)]);}async[_0xb9372(0xe8)](_0x50fc21,_0x32ab79){const _0x1d5e19=_0xb9372;var _0x1ce877,_0x1a1522,_0x319610,_0x5e7af8;common_1[_0x1d5e19(0xf7)][_0x1d5e19(0xfa)]('开始提交\x20Dalle\x20绘图任务\x20',_0x1d5e19(0xe0));const {apiKey:_0x26222a,model:_0x40cd42,proxyUrl:_0x64da3,prompt:_0x454fb8,extraParam:_0x3600d1,timeout:_0x40fdab,onSuccess:_0x44a9b5,onFailure:_0x21b7f1,groupId:_0x2e7515}=_0x50fc21,_0x1722f7=await this['globalConfigService'][_0x1d5e19(0xc4)](['isDalleChat']);let _0x4975cf;if(_0x1722f7==='1')try{common_1[_0x1d5e19(0xf7)][_0x1d5e19(0xfa)](_0x1d5e19(0xd7),'DalleDraw');const {messagesHistory:_0x3cdf8a}=await _0x32ab79(_0x1d5e19(0xe5)+_0x454fb8,{'groupId':_0x2e7515,'systemMessage':_0x1d5e19(0xc3),'maxModelTokens':0x1f40,'maxRounds':0x5,'fileInfo':''},this[_0x1d5e19(0xdc)]);_0x4975cf=await this['openAIChatService'][_0x1d5e19(0xe6)](_0x454fb8,undefined,_0x3cdf8a);}catch(_0x41d7ef){console[_0x1d5e19(0xf5)](_0x1d5e19(0xe4),_0x41d7ef),_0x4975cf=_0x454fb8;}else _0x4975cf=_0x454fb8;const _0x31f48a=(_0x3600d1===null||_0x3600d1===void 0x0?void 0x0:_0x3600d1[_0x1d5e19(0xbf)])||_0x1d5e19(0xfe);let _0x44fa83={'answer':'','fileInfo':'','status':0x2};try{const _0x7bcba6={'method':_0x1d5e19(0x108),'url':_0x64da3+_0x1d5e19(0xeb),'timeout':_0x40fdab,'headers':{'Content-Type':_0x1d5e19(0xec),'Authorization':_0x1d5e19(0xd4)+_0x26222a},'data':{'model':_0x40cd42,'prompt':_0x4975cf,'size':_0x31f48a}},_0x54ecb4=await(0x0,axios_1['default'])(_0x7bcba6),_0x100070=_0x54ecb4[_0x1d5e19(0x105)]['data'][0x0][_0x1d5e19(0xe9)];try{common_1[_0x1d5e19(0xf7)][_0x1d5e19(0xfa)]('------>\x20开始上传图片！！！',_0x1d5e19(0xe0));const _0x116ba4=new Date(),_0xdc38fe=_0x116ba4[_0x1d5e19(0xdb)](),_0xc24ab3=String(_0x116ba4[_0x1d5e19(0xc7)]()+0x1)[_0x1d5e19(0xdd)](0x2,'0'),_0x107428=String(_0x116ba4[_0x1d5e19(0x107)]())['padStart'](0x2,'0'),_0x2cf739=''+_0xdc38fe+_0xc24ab3+'/'+_0x107428;_0x44fa83['fileInfo']=await this[_0x1d5e19(0xf2)][_0x1d5e19(0xd2)]({'url':_0x100070,'dir':_0x1d5e19(0xe2)+_0x2cf739}),common_1[_0x1d5e19(0xf7)]['log'](_0x1d5e19(0xba)+_0x44fa83[_0x1d5e19(0xe3)],'DrawService');}catch(_0x294dd7){common_1[_0x1d5e19(0xf7)]['error'](_0x1d5e19(0xf6)+_0x294dd7,_0x1d5e19(0xe0));}let _0x34d713;try{_0x34d713=await this[_0x1d5e19(0xef)][_0x1d5e19(0xe6)](_0x1d5e19(0xf8)+_0x54ecb4[_0x1d5e19(0x105)][_0x1d5e19(0x105)][0x0][_0x1d5e19(0xfb)]+_0x1d5e19(0xe1));}catch(_0x4eb493){_0x34d713=_0x454fb8+_0x1d5e19(0xbd),common_1['Logger'][_0x1d5e19(0xf5)]('翻译失败:\x20',_0x4eb493);}_0x44fa83[_0x1d5e19(0xfd)]=_0x34d713,_0x44fa83[_0x1d5e19(0x101)]=0x3,_0x44a9b5(_0x44fa83);return;}catch(_0x1647dc){_0x44fa83[_0x1d5e19(0x101)]=0x5,_0x21b7f1(_0x44fa83);const _0xac107=((_0x1ce877=_0x1647dc===null||_0x1647dc===void 0x0?void 0x0:_0x1647dc[_0x1d5e19(0xc8)])===null||_0x1ce877===void 0x0?void 0x0:_0x1ce877[_0x1d5e19(0x101)])||0x1f4;console[_0x1d5e19(0xfa)]('draw\x20error:\x20',JSON[_0x1d5e19(0xbb)](_0x1647dc),_0xac107);const _0x33f6ca=(_0x5e7af8=(_0x319610=(_0x1a1522=_0x1647dc===null||_0x1647dc===void 0x0?void 0x0:_0x1647dc['response'])===null||_0x1a1522===void 0x0?void 0x0:_0x1a1522[_0x1d5e19(0x105)])===null||_0x319610===void 0x0?void 0x0:_0x319610[_0x1d5e19(0xf5)])===null||_0x5e7af8===void 0x0?void 0x0:_0x5e7af8[_0x1d5e19(0xe7)];if(_0xac107===0x1ad)return _0x44fa83[_0x1d5e19(0xd5)]=_0x1d5e19(0xf9),_0x44fa83;if(_0xac107===0x190&&_0x33f6ca[_0x1d5e19(0xbc)]('This\x20request\x20has\x20been\x20blocked\x20by\x20our\x20content\x20filters'))return _0x44fa83[_0x1d5e19(0xd5)]=_0x1d5e19(0xf1),_0x44fa83;if(_0xac107===0x190&&_0x33f6ca['includes']('Billing\x20hard\x20limit\x20has\x20been\x20reached'))return _0x44fa83[_0x1d5e19(0xd5)]=_0x1d5e19(0xda),_0x44fa83;if(_0xac107===0x1f4)return _0x44fa83[_0x1d5e19(0xd5)]='绘制图片失败，请检查你的提示词是否有非法描述！',_0x44fa83;if(_0xac107===0x191)return _0x44fa83[_0x1d5e19(0xd5)]=_0x1d5e19(0xd8),_0x44fa83;return _0x44fa83[_0x1d5e19(0xd5)]=_0x1d5e19(0xf0),_0x44fa83;}}};OpenAIDrawService=OpenAIDrawService_1=__decorate([(0x0,common_1[_0xb9372(0xca)])(),__metadata(_0xb9372(0xf3),[upload_service_1[_0xb9372(0xc5)],globalConfig_service_1[_0xb9372(0xd9)],chatLog_service_1[_0xb9372(0xcd)],openaiChat_service_1[_0xb9372(0xf4)]])],OpenAIDrawService),exports['OpenAIDrawService']=OpenAIDrawService;