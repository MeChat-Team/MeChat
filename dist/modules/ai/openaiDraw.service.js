'use strict';const _0x4b701a=_0x2c40;(function(_0x3579db,_0x11e203){const _0x430c85=_0x2c40,_0x3a87a1=_0x3579db();while(!![]){try{const _0x15b7d0=parseInt(_0x430c85(0x212))/0x1*(-parseInt(_0x430c85(0x23b))/0x2)+parseInt(_0x430c85(0x21b))/0x3+parseInt(_0x430c85(0x1fe))/0x4*(parseInt(_0x430c85(0x21a))/0x5)+parseInt(_0x430c85(0x211))/0x6+-parseInt(_0x430c85(0x23d))/0x7*(parseInt(_0x430c85(0x1f2))/0x8)+parseInt(_0x430c85(0x205))/0x9*(-parseInt(_0x430c85(0x23c))/0xa)+parseInt(_0x430c85(0x1fa))/0xb*(parseInt(_0x430c85(0x220))/0xc);if(_0x15b7d0===_0x11e203)break;else _0x3a87a1['push'](_0x3a87a1['shift']());}catch(_0x3215b0){_0x3a87a1['push'](_0x3a87a1['shift']());}}}(_0x506a,0x72d97));function _0x2c40(_0x22eb05,_0x11f6bb){const _0x506aac=_0x506a();return _0x2c40=function(_0x2c406d,_0x368119){_0x2c406d=_0x2c406d-0x1f2;let _0x481b15=_0x506aac[_0x2c406d];return _0x481b15;},_0x2c40(_0x22eb05,_0x11f6bb);}function _0x506a(){const _0x42bb7e=['__esModule','defineProperty','绘制图片失败，请检查你的提示词是否有非法描述！','chatFree','30646SwQzCj','4221160dIaciN','1891162ihGayr','------>\x20开始上传图片！！！','GlobalConfigService','length','绘制图片失败，请稍后试试吧！','../chatLog/chatLog.service','POST','response','\x20绘制成功','16yFwzHY','绘制图片失败，此次绘画被拒绝了！','../globalConfig/globalConfig.service','design:paramtypes','},\x20模拟AI绘画机器人的语气，用中文回复，告诉用户已经画好了','图片上传成功，URL:\x20','revised_prompt','fileInfo','227315wlyYZn','draw\x20error:\x20','text','isDalleChat','44YYaVku','getFullYear','Logger','globalConfigService','default','axios','../upload/upload.service','9udbLbp','decorate','getDate','answer','error','function','chatLogService','ChatLogService','size','参考上文，结合我的需求，给出绘画描述。我的需求是：','url','OpenAIDrawService','5536296YVyAlp','29guOSMt','uploadFileFromUrl','This\x20request\x20has\x20been\x20blocked\x20by\x20our\x20content\x20filters','根据提示词{','metadata','你是一个绘画提示词生成工具，请根据用户的要求，结合上下文，用一段文字，描述用户需要的绘画需求，不用包含任何礼貌性的寒暄,只需要场景的描述,可以适当联想','调用chatFree失败：','openAIChatService','344200Vayhvp','529851cctBCV','name','getConfigs','Billing\x20hard\x20limit\x20has\x20been\x20reached','当前模型key已被封禁、已冻结当前调用Key、尝试重新对话试试吧！','12WQJLgz','已开启连续绘画模式','getOwnPropertyDescriptor','UploadService','Bearer\x20','./openaiChat.service','images/dalle/','您的请求已被系统拒绝。您的提示可能存在一些非法的文本。','log','__metadata','DrawService','status','padStart','message','logger','data','/v1/images/generations','当前请求已过载、请稍等会儿再试试吧！','object','getMonth','includes','uploadService','application/json'];_0x506a=function(){return _0x42bb7e;};return _0x506a();}var __decorate=this&&this['__decorate']||function(_0x2a8f1a,_0x40f7e7,_0x214d97,_0x235f0a){const _0x391e54=_0x2c40;var _0x620ce6=arguments[_0x391e54(0x240)],_0x3101c3=_0x620ce6<0x3?_0x40f7e7:_0x235f0a===null?_0x235f0a=Object[_0x391e54(0x222)](_0x40f7e7,_0x214d97):_0x235f0a,_0x33627f;if(typeof Reflect==='object'&&typeof Reflect[_0x391e54(0x206)]===_0x391e54(0x20a))_0x3101c3=Reflect['decorate'](_0x2a8f1a,_0x40f7e7,_0x214d97,_0x235f0a);else{for(var _0x6de751=_0x2a8f1a[_0x391e54(0x240)]-0x1;_0x6de751>=0x0;_0x6de751--)if(_0x33627f=_0x2a8f1a[_0x6de751])_0x3101c3=(_0x620ce6<0x3?_0x33627f(_0x3101c3):_0x620ce6>0x3?_0x33627f(_0x40f7e7,_0x214d97,_0x3101c3):_0x33627f(_0x40f7e7,_0x214d97))||_0x3101c3;}return _0x620ce6>0x3&&_0x3101c3&&Object[_0x391e54(0x238)](_0x40f7e7,_0x214d97,_0x3101c3),_0x3101c3;},__metadata=this&&this[_0x4b701a(0x229)]||function(_0x2d34bd,_0x2703ae){const _0x1137a6=_0x4b701a;if(typeof Reflect===_0x1137a6(0x232)&&typeof Reflect[_0x1137a6(0x216)]===_0x1137a6(0x20a))return Reflect['metadata'](_0x2d34bd,_0x2703ae);},OpenAIDrawService_1;Object[_0x4b701a(0x238)](exports,_0x4b701a(0x237),{'value':!![]}),exports[_0x4b701a(0x210)]=void 0x0;const common_1=require('@nestjs/common'),axios_1=require(_0x4b701a(0x203)),chatLog_service_1=require(_0x4b701a(0x242)),globalConfig_service_1=require(_0x4b701a(0x1f4)),upload_service_1=require(_0x4b701a(0x204)),openaiChat_service_1=require(_0x4b701a(0x225));let OpenAIDrawService=OpenAIDrawService_1=class OpenAIDrawService{constructor(_0x3e79e8,_0x3848d3,_0x78ea9d,_0x425de3){const _0xd0f5c2=_0x4b701a;this[_0xd0f5c2(0x235)]=_0x3e79e8,this[_0xd0f5c2(0x201)]=_0x3848d3,this[_0xd0f5c2(0x20b)]=_0x78ea9d,this[_0xd0f5c2(0x219)]=_0x425de3,this[_0xd0f5c2(0x22e)]=new common_1['Logger'](OpenAIDrawService_1[_0xd0f5c2(0x21c)]);}async['dalleDraw'](_0x48f9ae,_0x5d5b4e){const _0x27201e=_0x4b701a;var _0x22ced3,_0x1fd869,_0x35475b,_0x1a38b5;common_1[_0x27201e(0x200)][_0x27201e(0x228)]('开始提交\x20Dalle\x20绘图任务\x20','DrawService');const {apiKey:_0x2b1519,model:_0x2b8bfe,proxyUrl:_0x1acbf0,prompt:_0x46bbc7,extraParam:_0x399d59,timeout:_0x4c0257,onSuccess:_0x120482,onFailure:_0x4e632c,groupId:_0x5c7364}=_0x48f9ae,_0x298ae7=await this['globalConfigService'][_0x27201e(0x21d)]([_0x27201e(0x1fd)]);let _0x4adf29;if(_0x298ae7==='1')try{common_1['Logger'][_0x27201e(0x228)](_0x27201e(0x221),'DalleDraw');const {messagesHistory:_0x496c25}=await _0x5d5b4e(_0x27201e(0x20e)+_0x46bbc7,{'groupId':_0x5c7364,'systemMessage':_0x27201e(0x217),'maxModelTokens':0x1f40,'maxRounds':0x5,'fileInfo':''},this[_0x27201e(0x20b)]);_0x4adf29=await this[_0x27201e(0x219)][_0x27201e(0x23a)](_0x46bbc7,undefined,_0x496c25);}catch(_0x38e0a5){console[_0x27201e(0x209)](_0x27201e(0x218),_0x38e0a5),_0x4adf29=_0x46bbc7;}else _0x4adf29=_0x46bbc7;const _0x4e731b=(_0x399d59===null||_0x399d59===void 0x0?void 0x0:_0x399d59[_0x27201e(0x20d)])||'1024x1024';let _0x44486c={'answer':'','fileInfo':'','status':0x2};try{const _0x2748a6={'method':_0x27201e(0x243),'url':_0x1acbf0+_0x27201e(0x230),'timeout':_0x4c0257,'headers':{'Content-Type':_0x27201e(0x236),'Authorization':_0x27201e(0x224)+_0x2b1519},'data':{'model':_0x2b8bfe,'prompt':_0x4adf29,'size':_0x4e731b}},_0x320587=await(0x0,axios_1[_0x27201e(0x202)])(_0x2748a6),_0x6f9f51=_0x320587[_0x27201e(0x22f)][_0x27201e(0x22f)][0x0][_0x27201e(0x20f)];try{common_1[_0x27201e(0x200)]['log'](_0x27201e(0x23e),_0x27201e(0x22a));const _0x38102d=new Date(),_0x41e498=_0x38102d[_0x27201e(0x1ff)](),_0x1aa951=String(_0x38102d[_0x27201e(0x233)]()+0x1)['padStart'](0x2,'0'),_0x239672=String(_0x38102d[_0x27201e(0x207)]())[_0x27201e(0x22c)](0x2,'0'),_0xfd1bf3=''+_0x41e498+_0x1aa951+'/'+_0x239672;_0x44486c[_0x27201e(0x1f9)]=await this[_0x27201e(0x235)][_0x27201e(0x213)]({'url':_0x6f9f51,'dir':_0x27201e(0x226)+_0xfd1bf3}),common_1['Logger'][_0x27201e(0x228)](_0x27201e(0x1f7)+_0x44486c[_0x27201e(0x1f9)],_0x27201e(0x22a));}catch(_0x4138ce){common_1[_0x27201e(0x200)][_0x27201e(0x209)]('上传图片过程中出现错误:\x20'+_0x4138ce,_0x27201e(0x22a));}let _0x4c5b40;try{_0x4c5b40=await this[_0x27201e(0x219)][_0x27201e(0x23a)](_0x27201e(0x215)+_0x320587[_0x27201e(0x22f)]['data'][0x0][_0x27201e(0x1f8)]+_0x27201e(0x1f6));}catch(_0x3bf186){_0x4c5b40=_0x46bbc7+_0x27201e(0x245),common_1[_0x27201e(0x200)][_0x27201e(0x209)]('翻译失败:\x20',_0x3bf186);}_0x44486c[_0x27201e(0x208)]=_0x4c5b40,_0x44486c[_0x27201e(0x22b)]=0x3,_0x120482(_0x44486c);return;}catch(_0x386ec1){_0x44486c[_0x27201e(0x22b)]=0x5,_0x4e632c(_0x44486c);const _0x2b4cd0=((_0x22ced3=_0x386ec1===null||_0x386ec1===void 0x0?void 0x0:_0x386ec1['response'])===null||_0x22ced3===void 0x0?void 0x0:_0x22ced3[_0x27201e(0x22b)])||0x1f4;console[_0x27201e(0x228)](_0x27201e(0x1fb),JSON['stringify'](_0x386ec1),_0x2b4cd0);const _0x5c84d2=(_0x1a38b5=(_0x35475b=(_0x1fd869=_0x386ec1===null||_0x386ec1===void 0x0?void 0x0:_0x386ec1[_0x27201e(0x244)])===null||_0x1fd869===void 0x0?void 0x0:_0x1fd869['data'])===null||_0x35475b===void 0x0?void 0x0:_0x35475b[_0x27201e(0x209)])===null||_0x1a38b5===void 0x0?void 0x0:_0x1a38b5[_0x27201e(0x22d)];if(_0x2b4cd0===0x1ad)return _0x44486c['text']=_0x27201e(0x231),_0x44486c;if(_0x2b4cd0===0x190&&_0x5c84d2[_0x27201e(0x234)](_0x27201e(0x214)))return _0x44486c[_0x27201e(0x1fc)]=_0x27201e(0x227),_0x44486c;if(_0x2b4cd0===0x190&&_0x5c84d2[_0x27201e(0x234)](_0x27201e(0x21e)))return _0x44486c['text']=_0x27201e(0x21f),_0x44486c;if(_0x2b4cd0===0x1f4)return _0x44486c[_0x27201e(0x1fc)]=_0x27201e(0x239),_0x44486c;if(_0x2b4cd0===0x191)return _0x44486c[_0x27201e(0x1fc)]=_0x27201e(0x1f3),_0x44486c;return _0x44486c[_0x27201e(0x1fc)]=_0x27201e(0x241),_0x44486c;}}};OpenAIDrawService=OpenAIDrawService_1=__decorate([(0x0,common_1['Injectable'])(),__metadata(_0x4b701a(0x1f5),[upload_service_1[_0x4b701a(0x223)],globalConfig_service_1[_0x4b701a(0x23f)],chatLog_service_1[_0x4b701a(0x20c)],openaiChat_service_1['OpenAIChatService']])],OpenAIDrawService),exports[_0x4b701a(0x210)]=OpenAIDrawService;