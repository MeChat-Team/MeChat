'use strict';function _0x2856(){const _0x5a36a9=['你是一个绘画提示词生成工具，请根据用户的要求，结合上下文，用一段文字，描述用户需要的绘画需求，不用包含任何礼貌性的寒暄,只需要场景的描述,可以适当联想','application/json','732934rChbAu','ChatLogService','__esModule','@nestjs/common','参考上文，结合我的需求，给出绘画描述。我的需求是：','getMonth','4727790WoSPuL','Logger','response','------>\x20开始上传图片！！！','翻译失败:\x20','当前请求已过载、请稍等会儿再试试吧！','调用chatFree失败：','revised_prompt','This\x20request\x20has\x20been\x20blocked\x20by\x20our\x20content\x20filters','Billing\x20hard\x20limit\x20has\x20been\x20reached','765484gUulpc','uploadFileFromUrl','padStart','\x20绘制成功','data','defineProperty','chatLogService','getDate','isDalleChat','logger','1348422olALjp','getConfigs','__decorate','1024x1024','metadata','您的请求已被系统拒绝。您的提示可能存在一些非法的文本。','uploadService','getFullYear','图片上传成功，URL:\x20','170920foNYOq','../chatLog/chatLog.service','function','globalConfigService','url','DalleDraw','/v1/images/generations','object','draw\x20error:\x20','56xxgZQr','design:paramtypes','DrawService','getOwnPropertyDescriptor','name','OpenAIDrawService','../upload/upload.service','openAIChatService','log','绘制图片失败，请稍后试试吧！','includes','GlobalConfigService','fileInfo','开始提交\x20Dalle\x20绘图任务\x20','text','stringify','1811847bHYFFz','已开启连续绘画模式','decorate','answer','error','status','1083936jssypg','dalleDraw','./openaiChat.service','length','axios','chatFree','__metadata','Injectable','UploadService','../globalConfig/globalConfig.service'];_0x2856=function(){return _0x5a36a9;};return _0x2856();}const _0x1f7f35=_0x1995;(function(_0x2ff963,_0x27e9da){const _0x26cf9a=_0x1995,_0x47090a=_0x2ff963();while(!![]){try{const _0x2c0ffe=parseInt(_0x26cf9a(0x18f))/0x1+-parseInt(_0x26cf9a(0x1cd))/0x2+-parseInt(_0x26cf9a(0x1bb))/0x3+-parseInt(_0x26cf9a(0x1c1))/0x4+parseInt(_0x26cf9a(0x1d3))/0x5+parseInt(_0x26cf9a(0x199))/0x6+-parseInt(_0x26cf9a(0x1ab))/0x7*(parseInt(_0x26cf9a(0x1a2))/0x8);if(_0x2c0ffe===_0x27e9da)break;else _0x47090a['push'](_0x47090a['shift']());}catch(_0x3a217e){_0x47090a['push'](_0x47090a['shift']());}}}(_0x2856,0x7fcc3));var __decorate=this&&this[_0x1f7f35(0x19b)]||function(_0x237050,_0x447888,_0x5a371a,_0x415980){const _0x36b34b=_0x1f7f35;var _0x3a774f=arguments[_0x36b34b(0x1c4)],_0x5ee26c=_0x3a774f<0x3?_0x447888:_0x415980===null?_0x415980=Object[_0x36b34b(0x1ae)](_0x447888,_0x5a371a):_0x415980,_0xc65430;if(typeof Reflect===_0x36b34b(0x1a9)&&typeof Reflect[_0x36b34b(0x1bd)]===_0x36b34b(0x1a4))_0x5ee26c=Reflect['decorate'](_0x237050,_0x447888,_0x5a371a,_0x415980);else{for(var _0x3d9be1=_0x237050[_0x36b34b(0x1c4)]-0x1;_0x3d9be1>=0x0;_0x3d9be1--)if(_0xc65430=_0x237050[_0x3d9be1])_0x5ee26c=(_0x3a774f<0x3?_0xc65430(_0x5ee26c):_0x3a774f>0x3?_0xc65430(_0x447888,_0x5a371a,_0x5ee26c):_0xc65430(_0x447888,_0x5a371a))||_0x5ee26c;}return _0x3a774f>0x3&&_0x5ee26c&&Object[_0x36b34b(0x194)](_0x447888,_0x5a371a,_0x5ee26c),_0x5ee26c;},__metadata=this&&this[_0x1f7f35(0x1c7)]||function(_0x18dc3c,_0x2492e4){const _0x472e59=_0x1f7f35;if(typeof Reflect===_0x472e59(0x1a9)&&typeof Reflect[_0x472e59(0x19d)]==='function')return Reflect[_0x472e59(0x19d)](_0x18dc3c,_0x2492e4);},OpenAIDrawService_1;Object[_0x1f7f35(0x194)](exports,_0x1f7f35(0x1cf),{'value':!![]}),exports[_0x1f7f35(0x1b0)]=void 0x0;function _0x1995(_0x5d3bff,_0x162e66){const _0x28560a=_0x2856();return _0x1995=function(_0x199509,_0x4c5450){_0x199509=_0x199509-0x189;let _0x2a3dfc=_0x28560a[_0x199509];return _0x2a3dfc;},_0x1995(_0x5d3bff,_0x162e66);}const common_1=require(_0x1f7f35(0x1d0)),axios_1=require(_0x1f7f35(0x1c5)),chatLog_service_1=require(_0x1f7f35(0x1a3)),globalConfig_service_1=require(_0x1f7f35(0x1ca)),upload_service_1=require(_0x1f7f35(0x1b1)),openaiChat_service_1=require(_0x1f7f35(0x1c3));let OpenAIDrawService=OpenAIDrawService_1=class OpenAIDrawService{constructor(_0xa0cf71,_0xc69b91,_0x330ac9,_0x5f0e46){const _0x145cfe=_0x1f7f35;this[_0x145cfe(0x19f)]=_0xa0cf71,this[_0x145cfe(0x1a5)]=_0xc69b91,this[_0x145cfe(0x195)]=_0x330ac9,this[_0x145cfe(0x1b2)]=_0x5f0e46,this[_0x145cfe(0x198)]=new common_1[(_0x145cfe(0x1d4))](OpenAIDrawService_1[_0x145cfe(0x1af)]);}async[_0x1f7f35(0x1c2)](_0x458c21,_0x637783){const _0x1f0863=_0x1f7f35;var _0x580b49,_0x44060f,_0x44103f,_0x28b985;common_1[_0x1f0863(0x1d4)][_0x1f0863(0x1b3)](_0x1f0863(0x1b8),_0x1f0863(0x1ad));const {apiKey:_0x2830a0,model:_0x509372,proxyUrl:_0x15dbc9,prompt:_0x3f4268,extraParam:_0x410756,timeout:_0x5aa485,onSuccess:_0x3c76cf,onFailure:_0x2d7467,groupId:_0x441bca}=_0x458c21,_0x341489=await this[_0x1f0863(0x1a5)][_0x1f0863(0x19a)]([_0x1f0863(0x197)]);let _0x3b1afe;if(_0x341489==='1')try{common_1[_0x1f0863(0x1d4)]['log'](_0x1f0863(0x1bc),_0x1f0863(0x1a7));const {messagesHistory:_0x8aa7c2}=await _0x637783(_0x1f0863(0x1d1)+_0x3f4268,{'groupId':_0x441bca,'systemMessage':_0x1f0863(0x1cb),'maxModelTokens':0x1f40,'maxRounds':0x5,'fileInfo':''},this[_0x1f0863(0x195)]);_0x3b1afe=await this[_0x1f0863(0x1b2)][_0x1f0863(0x1c6)](_0x3f4268,undefined,_0x8aa7c2);}catch(_0x499e88){console[_0x1f0863(0x1bf)](_0x1f0863(0x18b),_0x499e88),_0x3b1afe=_0x3f4268;}else _0x3b1afe=_0x3f4268;const _0x4c8ee3=(_0x410756===null||_0x410756===void 0x0?void 0x0:_0x410756['size'])||_0x1f0863(0x19c);let _0x3769f3={'answer':'','fileInfo':'','status':0x2};try{const _0x5ecbbc={'method':'POST','url':_0x15dbc9+_0x1f0863(0x1a8),'timeout':_0x5aa485,'headers':{'Content-Type':_0x1f0863(0x1cc),'Authorization':'Bearer\x20'+_0x2830a0},'data':{'model':_0x509372,'prompt':_0x3b1afe,'size':_0x4c8ee3}},_0x1d24ae=await(0x0,axios_1['default'])(_0x5ecbbc),_0x463676=_0x1d24ae[_0x1f0863(0x193)][_0x1f0863(0x193)][0x0][_0x1f0863(0x1a6)];try{common_1['Logger'][_0x1f0863(0x1b3)](_0x1f0863(0x1d6),_0x1f0863(0x1ad));const _0x5f31ad=new Date(),_0x118ede=_0x5f31ad[_0x1f0863(0x1a0)](),_0x30173c=String(_0x5f31ad[_0x1f0863(0x1d2)]()+0x1)[_0x1f0863(0x191)](0x2,'0'),_0x58314c=String(_0x5f31ad[_0x1f0863(0x196)]())[_0x1f0863(0x191)](0x2,'0'),_0x4bf844=''+_0x118ede+_0x30173c+'/'+_0x58314c;_0x3769f3[_0x1f0863(0x1b7)]=await this['uploadService'][_0x1f0863(0x190)]({'url':_0x463676,'dir':'images/dalle/'+_0x4bf844}),common_1[_0x1f0863(0x1d4)][_0x1f0863(0x1b3)](_0x1f0863(0x1a1)+_0x3769f3[_0x1f0863(0x1b7)],'DrawService');}catch(_0x563fd4){common_1['Logger']['error']('上传图片过程中出现错误:\x20'+_0x563fd4,_0x1f0863(0x1ad));}let _0x404b0e;try{_0x404b0e=await this['openAIChatService'][_0x1f0863(0x1c6)]('根据提示词{'+_0x1d24ae[_0x1f0863(0x193)]['data'][0x0][_0x1f0863(0x18c)]+'},\x20模拟AI绘画机器人的语气，用中文回复，告诉用户已经画好了');}catch(_0x2d5bae){_0x404b0e=_0x3f4268+_0x1f0863(0x192),common_1[_0x1f0863(0x1d4)][_0x1f0863(0x1bf)](_0x1f0863(0x189),_0x2d5bae);}_0x3769f3[_0x1f0863(0x1be)]=_0x404b0e,_0x3769f3[_0x1f0863(0x1c0)]=0x3,_0x3c76cf(_0x3769f3);return;}catch(_0x47833f){_0x3769f3[_0x1f0863(0x1c0)]=0x5,_0x2d7467(_0x3769f3);const _0x4600f0=((_0x580b49=_0x47833f===null||_0x47833f===void 0x0?void 0x0:_0x47833f[_0x1f0863(0x1d5)])===null||_0x580b49===void 0x0?void 0x0:_0x580b49[_0x1f0863(0x1c0)])||0x1f4;console['log'](_0x1f0863(0x1aa),JSON[_0x1f0863(0x1ba)](_0x47833f),_0x4600f0);const _0x5114f7=(_0x28b985=(_0x44103f=(_0x44060f=_0x47833f===null||_0x47833f===void 0x0?void 0x0:_0x47833f[_0x1f0863(0x1d5)])===null||_0x44060f===void 0x0?void 0x0:_0x44060f[_0x1f0863(0x193)])===null||_0x44103f===void 0x0?void 0x0:_0x44103f[_0x1f0863(0x1bf)])===null||_0x28b985===void 0x0?void 0x0:_0x28b985['message'];if(_0x4600f0===0x1ad)return _0x3769f3[_0x1f0863(0x1b9)]=_0x1f0863(0x18a),_0x3769f3;if(_0x4600f0===0x190&&_0x5114f7[_0x1f0863(0x1b5)](_0x1f0863(0x18d)))return _0x3769f3[_0x1f0863(0x1b9)]=_0x1f0863(0x19e),_0x3769f3;if(_0x4600f0===0x190&&_0x5114f7['includes'](_0x1f0863(0x18e)))return _0x3769f3['text']='当前模型key已被封禁、已冻结当前调用Key、尝试重新对话试试吧！',_0x3769f3;if(_0x4600f0===0x1f4)return _0x3769f3['text']='绘制图片失败，请检查你的提示词是否有非法描述！',_0x3769f3;if(_0x4600f0===0x191)return _0x3769f3[_0x1f0863(0x1b9)]='绘制图片失败，此次绘画被拒绝了！',_0x3769f3;return _0x3769f3[_0x1f0863(0x1b9)]=_0x1f0863(0x1b4),_0x3769f3;}}};OpenAIDrawService=OpenAIDrawService_1=__decorate([(0x0,common_1[_0x1f7f35(0x1c8)])(),__metadata(_0x1f7f35(0x1ac),[upload_service_1[_0x1f7f35(0x1c9)],globalConfig_service_1[_0x1f7f35(0x1b6)],chatLog_service_1[_0x1f7f35(0x1ce)],openaiChat_service_1['OpenAIChatService']])],OpenAIDrawService),exports[_0x1f7f35(0x1b0)]=OpenAIDrawService;