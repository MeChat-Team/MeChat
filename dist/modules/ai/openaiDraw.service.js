'use strict';const _0x3910a1=_0x336a;(function(_0x2361df,_0x2ecc94){const _0x5832e9=_0x336a,_0x5f3f0a=_0x2361df();while(!![]){try{const _0xba4c52=-parseInt(_0x5832e9(0x17d))/0x1*(-parseInt(_0x5832e9(0x15d))/0x2)+parseInt(_0x5832e9(0x151))/0x3+parseInt(_0x5832e9(0x154))/0x4+parseInt(_0x5832e9(0x12f))/0x5*(-parseInt(_0x5832e9(0x13f))/0x6)+parseInt(_0x5832e9(0x13d))/0x7*(parseInt(_0x5832e9(0x144))/0x8)+-parseInt(_0x5832e9(0x167))/0x9+parseInt(_0x5832e9(0x164))/0xa*(-parseInt(_0x5832e9(0x150))/0xb);if(_0xba4c52===_0x2ecc94)break;else _0x5f3f0a['push'](_0x5f3f0a['shift']());}catch(_0x4c501e){_0x5f3f0a['push'](_0x5f3f0a['shift']());}}}(_0x272d,0xdfadc));function _0x336a(_0x3d878a,_0x57b970){const _0x272d10=_0x272d();return _0x336a=function(_0x336aa3,_0x569ad2){_0x336aa3=_0x336aa3-0x12f;let _0x407225=_0x272d10[_0x336aa3];return _0x407225;},_0x336a(_0x3d878a,_0x57b970);}var __decorate=this&&this['__decorate']||function(_0x4e1bd9,_0x5479eb,_0x3ddafd,_0x25d3ea){const _0x3bc77c=_0x336a;var _0x15ddd1=arguments[_0x3bc77c(0x131)],_0x59a911=_0x15ddd1<0x3?_0x5479eb:_0x25d3ea===null?_0x25d3ea=Object['getOwnPropertyDescriptor'](_0x5479eb,_0x3ddafd):_0x25d3ea,_0x11ceb1;if(typeof Reflect==='object'&&typeof Reflect[_0x3bc77c(0x152)]===_0x3bc77c(0x177))_0x59a911=Reflect[_0x3bc77c(0x152)](_0x4e1bd9,_0x5479eb,_0x3ddafd,_0x25d3ea);else{for(var _0x3222af=_0x4e1bd9[_0x3bc77c(0x131)]-0x1;_0x3222af>=0x0;_0x3222af--)if(_0x11ceb1=_0x4e1bd9[_0x3222af])_0x59a911=(_0x15ddd1<0x3?_0x11ceb1(_0x59a911):_0x15ddd1>0x3?_0x11ceb1(_0x5479eb,_0x3ddafd,_0x59a911):_0x11ceb1(_0x5479eb,_0x3ddafd))||_0x59a911;}return _0x15ddd1>0x3&&_0x59a911&&Object[_0x3bc77c(0x175)](_0x5479eb,_0x3ddafd,_0x59a911),_0x59a911;},__metadata=this&&this['__metadata']||function(_0x3e73f6,_0xa535ff){const _0x4711d0=_0x336a;if(typeof Reflect===_0x4711d0(0x133)&&typeof Reflect[_0x4711d0(0x17b)]==='function')return Reflect[_0x4711d0(0x17b)](_0x3e73f6,_0xa535ff);},OpenAIDrawService_1;function _0x272d(){const _0x5acd35=['default','./openaiChat.service','311633iGiTXC','answer','5100RQbWNj','参考上文，结合我的需求，给出绘画描述。我的需求是：','开始提交\x20Dalle\x20绘图任务\x20','padStart','response','8XfhJMl','已开启连续绘画模式','size','图片上传成功，URL:\x20','OpenAIChatService','includes','log','Bearer\x20','翻译失败:\x20','Logger','__esModule','POST','11NuNyAk','1196856TNnbAm','decorate','design:paramtypes','2956368ZEbmyd','DalleDraw','uploadService','draw\x20error:\x20','},\x20模拟AI绘画机器人的语气，用中文回复，告诉用户已经画好了','DrawService','application/json','绘制图片失败，请检查你的提示词是否有非法描述！','dalleDraw','2PAUTpB','getMonth','当前模型key已被封禁、已冻结当前调用Key、尝试重新对话试试吧！','绘制图片失败，此次绘画被拒绝了！','../upload/upload.service','chatLogService','error','3824290AJGwIb','openAIChatService','您的请求已被系统拒绝。您的提示可能存在一些非法的文本。','10839816qLsjRv','@nestjs/common','chatFree','GlobalConfigService','getDate','data','上传图片过程中出现错误:\x20','logger','isDalleChat','name','images/dalle/','url','stringify','../globalConfig/globalConfig.service','defineProperty','UploadService','function','OpenAIDrawService','status','globalConfigService','metadata','Billing\x20hard\x20limit\x20has\x20been\x20reached','1448828XKeLMl','绘制图片失败，请稍后试试吧！','755havNnB','ChatLogService','length','你是一个绘画提示词生成工具，请根据用户的要求，结合上下文，用一段文字，描述用户需要的绘画需求，不用包含任何礼貌性的寒暄,只需要场景的描述,可以适当联想','object','/v1/images/generations','message','Injectable','\x20绘制成功','text','调用chatFree失败：','revised_prompt'];_0x272d=function(){return _0x5acd35;};return _0x272d();}Object[_0x3910a1(0x175)](exports,_0x3910a1(0x14e),{'value':!![]}),exports[_0x3910a1(0x178)]=void 0x0;const common_1=require(_0x3910a1(0x168)),axios_1=require('axios'),chatLog_service_1=require('../chatLog/chatLog.service'),globalConfig_service_1=require(_0x3910a1(0x174)),upload_service_1=require(_0x3910a1(0x161)),openaiChat_service_1=require(_0x3910a1(0x13c));let OpenAIDrawService=OpenAIDrawService_1=class OpenAIDrawService{constructor(_0x2f798b,_0x18acc0,_0x546fb6,_0x1ff9c0){const _0x31ed35=_0x3910a1;this[_0x31ed35(0x156)]=_0x2f798b,this[_0x31ed35(0x17a)]=_0x18acc0,this[_0x31ed35(0x162)]=_0x546fb6,this[_0x31ed35(0x165)]=_0x1ff9c0,this[_0x31ed35(0x16e)]=new common_1[(_0x31ed35(0x14d))](OpenAIDrawService_1[_0x31ed35(0x170)]);}async[_0x3910a1(0x15c)](_0x56f89f,_0x281fdf){const _0xb9148a=_0x3910a1;var _0x348a06,_0x7d2d8d,_0x48d63a,_0x417dc8;common_1[_0xb9148a(0x14d)][_0xb9148a(0x14a)](_0xb9148a(0x141),_0xb9148a(0x159));const {apiKey:_0x2fd72a,model:_0x27e5c1,proxyUrl:_0x32c77d,prompt:_0x292e51,extraParam:_0x32911c,timeout:_0x3907bc,onSuccess:_0x90ea42,onFailure:_0x4f7ba8,groupId:_0x561937}=_0x56f89f,_0x3a9f14=await this['globalConfigService']['getConfigs']([_0xb9148a(0x16f)]);let _0xf84cdf;if(_0x3a9f14==='1')try{common_1['Logger'][_0xb9148a(0x14a)](_0xb9148a(0x145),_0xb9148a(0x155));const {messagesHistory:_0x3165a5}=await _0x281fdf(_0xb9148a(0x140)+_0x292e51,{'groupId':_0x561937,'systemMessage':_0xb9148a(0x132),'maxModelTokens':0x1f40,'maxRounds':0x5,'fileInfo':''},this['chatLogService']);_0xf84cdf=await this[_0xb9148a(0x165)][_0xb9148a(0x169)](_0x292e51,undefined,_0x3165a5);}catch(_0x1dd16f){console[_0xb9148a(0x163)](_0xb9148a(0x139),_0x1dd16f),_0xf84cdf=_0x292e51;}else _0xf84cdf=_0x292e51;const _0x489df9=(_0x32911c===null||_0x32911c===void 0x0?void 0x0:_0x32911c[_0xb9148a(0x146)])||'1024x1024';let _0x3c86da={'answer':'','fileInfo':'','status':0x2};try{const _0xaccc5d={'method':_0xb9148a(0x14f),'url':_0x32c77d+_0xb9148a(0x134),'timeout':_0x3907bc,'headers':{'Content-Type':_0xb9148a(0x15a),'Authorization':_0xb9148a(0x14b)+_0x2fd72a},'data':{'model':_0x27e5c1,'prompt':_0xf84cdf,'size':_0x489df9}},_0x361026=await(0x0,axios_1[_0xb9148a(0x13b)])(_0xaccc5d),_0x491b23=_0x361026[_0xb9148a(0x16c)][_0xb9148a(0x16c)][0x0][_0xb9148a(0x172)];try{common_1[_0xb9148a(0x14d)][_0xb9148a(0x14a)]('------>\x20开始上传图片！！！','DrawService');const _0x18827e=new Date(),_0x22b734=_0x18827e['getFullYear'](),_0x2085ee=String(_0x18827e[_0xb9148a(0x15e)]()+0x1)[_0xb9148a(0x142)](0x2,'0'),_0x2d8bea=String(_0x18827e[_0xb9148a(0x16b)]())[_0xb9148a(0x142)](0x2,'0'),_0x5d6d4a=''+_0x22b734+_0x2085ee+'/'+_0x2d8bea;_0x3c86da['fileInfo']=await this[_0xb9148a(0x156)]['uploadFileFromUrl']({'url':_0x491b23,'dir':_0xb9148a(0x171)+_0x5d6d4a}),common_1['Logger'][_0xb9148a(0x14a)](_0xb9148a(0x147)+_0x3c86da['fileInfo'],_0xb9148a(0x159));}catch(_0x380226){common_1['Logger']['error'](_0xb9148a(0x16d)+_0x380226,'DrawService');}let _0x45c4b3;try{_0x45c4b3=await this[_0xb9148a(0x165)][_0xb9148a(0x169)]('根据提示词{'+_0x361026[_0xb9148a(0x16c)][_0xb9148a(0x16c)][0x0][_0xb9148a(0x13a)]+_0xb9148a(0x158));}catch(_0x5ab4b3){_0x45c4b3=_0x292e51+_0xb9148a(0x137),common_1['Logger']['error'](_0xb9148a(0x14c),_0x5ab4b3);}_0x3c86da[_0xb9148a(0x13e)]=_0x45c4b3,_0x3c86da[_0xb9148a(0x179)]=0x3,_0x90ea42(_0x3c86da);return;}catch(_0x211573){_0x3c86da['status']=0x5,_0x4f7ba8(_0x3c86da);const _0x483487=((_0x348a06=_0x211573===null||_0x211573===void 0x0?void 0x0:_0x211573[_0xb9148a(0x143)])===null||_0x348a06===void 0x0?void 0x0:_0x348a06[_0xb9148a(0x179)])||0x1f4;console[_0xb9148a(0x14a)](_0xb9148a(0x157),JSON[_0xb9148a(0x173)](_0x211573),_0x483487);const _0x5254ea=(_0x417dc8=(_0x48d63a=(_0x7d2d8d=_0x211573===null||_0x211573===void 0x0?void 0x0:_0x211573['response'])===null||_0x7d2d8d===void 0x0?void 0x0:_0x7d2d8d[_0xb9148a(0x16c)])===null||_0x48d63a===void 0x0?void 0x0:_0x48d63a[_0xb9148a(0x163)])===null||_0x417dc8===void 0x0?void 0x0:_0x417dc8[_0xb9148a(0x135)];if(_0x483487===0x1ad)return _0x3c86da['text']='当前请求已过载、请稍等会儿再试试吧！',_0x3c86da;if(_0x483487===0x190&&_0x5254ea[_0xb9148a(0x149)]('This\x20request\x20has\x20been\x20blocked\x20by\x20our\x20content\x20filters'))return _0x3c86da['text']=_0xb9148a(0x166),_0x3c86da;if(_0x483487===0x190&&_0x5254ea['includes'](_0xb9148a(0x17c)))return _0x3c86da['text']=_0xb9148a(0x15f),_0x3c86da;if(_0x483487===0x1f4)return _0x3c86da[_0xb9148a(0x138)]=_0xb9148a(0x15b),_0x3c86da;if(_0x483487===0x191)return _0x3c86da[_0xb9148a(0x138)]=_0xb9148a(0x160),_0x3c86da;return _0x3c86da['text']=_0xb9148a(0x17e),_0x3c86da;}}};OpenAIDrawService=OpenAIDrawService_1=__decorate([(0x0,common_1[_0x3910a1(0x136)])(),__metadata(_0x3910a1(0x153),[upload_service_1[_0x3910a1(0x176)],globalConfig_service_1[_0x3910a1(0x16a)],chatLog_service_1[_0x3910a1(0x130)],openaiChat_service_1[_0x3910a1(0x148)]])],OpenAIDrawService),exports['OpenAIDrawService']=OpenAIDrawService;