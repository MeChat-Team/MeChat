'use strict';function _0x3c0a(_0x490f95,_0x21e0f9){const _0x348b5f=_0x348b();return _0x3c0a=function(_0x3c0a49,_0x1a136e){_0x3c0a49=_0x3c0a49-0xa9;let _0x14735b=_0x348b5f[_0x3c0a49];return _0x14735b;},_0x3c0a(_0x490f95,_0x21e0f9);}const _0x34a699=_0x3c0a;(function(_0x109678,_0x228d44){const _0x3d0918=_0x3c0a,_0x3c99e8=_0x109678();while(!![]){try{const _0x3b6c21=parseInt(_0x3d0918(0xba))/0x1+parseInt(_0x3d0918(0xe7))/0x2*(parseInt(_0x3d0918(0xc5))/0x3)+parseInt(_0x3d0918(0xbb))/0x4*(-parseInt(_0x3d0918(0xaa))/0x5)+-parseInt(_0x3d0918(0xed))/0x6+parseInt(_0x3d0918(0xdb))/0x7*(parseInt(_0x3d0918(0xd9))/0x8)+parseInt(_0x3d0918(0xd0))/0x9*(-parseInt(_0x3d0918(0xeb))/0xa)+-parseInt(_0x3d0918(0xcf))/0xb;if(_0x3b6c21===_0x228d44)break;else _0x3c99e8['push'](_0x3c99e8['shift']());}catch(_0x3c72c8){_0x3c99e8['push'](_0x3c99e8['shift']());}}}(_0x348b,0x543ca));var __decorate=this&&this[_0x34a699(0xf8)]||function(_0x1f265b,_0x53aa2c,_0x570fc7,_0x47e10b){const _0x57815d=_0x34a699;var _0x516196=arguments['length'],_0x2e35c8=_0x516196<0x3?_0x53aa2c:_0x47e10b===null?_0x47e10b=Object[_0x57815d(0xce)](_0x53aa2c,_0x570fc7):_0x47e10b,_0xe27c79;if(typeof Reflect===_0x57815d(0xd7)&&typeof Reflect['decorate']===_0x57815d(0xec))_0x2e35c8=Reflect['decorate'](_0x1f265b,_0x53aa2c,_0x570fc7,_0x47e10b);else{for(var _0xbadb5=_0x1f265b['length']-0x1;_0xbadb5>=0x0;_0xbadb5--)if(_0xe27c79=_0x1f265b[_0xbadb5])_0x2e35c8=(_0x516196<0x3?_0xe27c79(_0x2e35c8):_0x516196>0x3?_0xe27c79(_0x53aa2c,_0x570fc7,_0x2e35c8):_0xe27c79(_0x53aa2c,_0x570fc7))||_0x2e35c8;}return _0x516196>0x3&&_0x2e35c8&&Object[_0x57815d(0xe9)](_0x53aa2c,_0x570fc7,_0x2e35c8),_0x2e35c8;},__metadata=this&&this[_0x34a699(0xf2)]||function(_0x51cf75,_0x5beb1c){const _0x5c4b4d=_0x34a699;if(typeof Reflect===_0x5c4b4d(0xd7)&&typeof Reflect[_0x5c4b4d(0xcd)]===_0x5c4b4d(0xec))return Reflect['metadata'](_0x51cf75,_0x5beb1c);},OpenAIDrawService_1;Object['defineProperty'](exports,_0x34a699(0xa9),{'value':!![]}),exports['OpenAIDrawService']=void 0x0;const common_1=require('@nestjs/common'),axios_1=require(_0x34a699(0xe0)),chatLog_service_1=require(_0x34a699(0xbc)),globalConfig_service_1=require(_0x34a699(0xfa)),upload_service_1=require('../upload/upload.service'),openaiChat_service_1=require(_0x34a699(0xd4));let OpenAIDrawService=OpenAIDrawService_1=class OpenAIDrawService{constructor(_0x18e9e3,_0x380497,_0x565dc7,_0x21f872){const _0x57d826=_0x34a699;this['uploadService']=_0x18e9e3,this[_0x57d826(0xc3)]=_0x380497,this['chatLogService']=_0x565dc7,this[_0x57d826(0xf7)]=_0x21f872,this[_0x57d826(0xb5)]=new common_1[(_0x57d826(0xc2))](OpenAIDrawService_1[_0x57d826(0xb8)]);}async[_0x34a699(0xee)](_0x28f2f2,_0x1e7a08){const _0x1ffc9e=_0x34a699;var _0x581dba,_0x6db11b,_0x57070d,_0x39a34a;common_1[_0x1ffc9e(0xc2)]['log'](_0x1ffc9e(0xf0),_0x1ffc9e(0xac));const {apiKey:_0x98f121,model:_0x52ec2f,proxyUrl:_0x14e31b,prompt:_0x362f7f,extraParam:_0x219094,timeout:_0x59195c,onSuccess:_0x5abc9f,onFailure:_0x46384f,groupId:_0xb69455}=_0x28f2f2,_0x3bb706=await this['globalConfigService'][_0x1ffc9e(0xe4)]([_0x1ffc9e(0xdd)]);let _0x2b68ab;if(_0x3bb706==='1')try{common_1[_0x1ffc9e(0xc2)][_0x1ffc9e(0xd3)]('已开启连续绘画模式',_0x1ffc9e(0xb1));const {messagesHistory:_0x459474}=await _0x1e7a08(_0x1ffc9e(0xc4)+_0x362f7f,{'groupId':_0xb69455,'systemMessage':'你是一个绘画提示词生成工具，请根据用户的要求，结合上下文，用一段文字，描述用户需要的绘画需求，不用包含任何礼貌性的寒暄,只需要场景的描述,可以适当联想','maxModelTokens':0x1f40,'maxRounds':0x5,'fileInfo':''},this[_0x1ffc9e(0xcc)]);_0x2b68ab=await this[_0x1ffc9e(0xf7)][_0x1ffc9e(0xf3)](_0x362f7f,undefined,_0x459474);}catch(_0xe8efc9){console[_0x1ffc9e(0xb0)](_0x1ffc9e(0xe6),_0xe8efc9),_0x2b68ab=_0x362f7f;}else _0x2b68ab=_0x362f7f;const _0x537ac1=(_0x219094===null||_0x219094===void 0x0?void 0x0:_0x219094[_0x1ffc9e(0xd5)])||_0x1ffc9e(0xb4);let _0x1fea3f={'answer':'','fileInfo':'','status':0x2};try{const _0x3a7f6c={'method':_0x1ffc9e(0xf4),'url':_0x14e31b+_0x1ffc9e(0xbd),'timeout':_0x59195c,'headers':{'Content-Type':'application/json','Authorization':_0x1ffc9e(0xc8)+_0x98f121},'data':{'model':_0x52ec2f,'prompt':_0x2b68ab,'size':_0x537ac1}},_0x325d2d=await(0x0,axios_1[_0x1ffc9e(0xc6)])(_0x3a7f6c),_0x247b37=_0x325d2d['data'][_0x1ffc9e(0xb6)][0x0][_0x1ffc9e(0xb2)];try{common_1['Logger']['log'](_0x1ffc9e(0xf5),_0x1ffc9e(0xac));const _0x56cea7=new Date(),_0x3dc986=_0x56cea7[_0x1ffc9e(0xf9)](),_0x50f70a=String(_0x56cea7[_0x1ffc9e(0xde)]()+0x1)[_0x1ffc9e(0xc1)](0x2,'0'),_0x20a029=String(_0x56cea7['getDate']())['padStart'](0x2,'0'),_0x8d4405=''+_0x3dc986+_0x50f70a+'/'+_0x20a029;_0x1fea3f[_0x1ffc9e(0xd8)]=await this[_0x1ffc9e(0xe2)][_0x1ffc9e(0xbf)]({'url':_0x247b37,'dir':_0x1ffc9e(0xef)+_0x8d4405}),common_1['Logger'][_0x1ffc9e(0xd3)](_0x1ffc9e(0xe5)+_0x1fea3f[_0x1ffc9e(0xd8)],_0x1ffc9e(0xac));}catch(_0x1a2302){common_1[_0x1ffc9e(0xc2)][_0x1ffc9e(0xb0)](_0x1ffc9e(0xc9)+_0x1a2302,_0x1ffc9e(0xac));}let _0x57e0aa;try{_0x57e0aa=await this['openAIChatService']['chatFree'](_0x1ffc9e(0xd1)+_0x325d2d[_0x1ffc9e(0xb6)][_0x1ffc9e(0xb6)][0x0][_0x1ffc9e(0xbe)]+'},\x20模拟AI绘画机器人的语气，用中文回复，告诉用户已经画好了');}catch(_0x5a2b67){_0x57e0aa=_0x362f7f+_0x1ffc9e(0xea),common_1['Logger'][_0x1ffc9e(0xb0)](_0x1ffc9e(0xd6),_0x5a2b67);}_0x1fea3f[_0x1ffc9e(0xab)]=_0x57e0aa,_0x1fea3f[_0x1ffc9e(0xb7)]=0x3,_0x5abc9f(_0x1fea3f);return;}catch(_0x3ca4e5){_0x1fea3f[_0x1ffc9e(0xb7)]=0x5,_0x46384f(_0x1fea3f);const _0xb65f6=((_0x581dba=_0x3ca4e5===null||_0x3ca4e5===void 0x0?void 0x0:_0x3ca4e5[_0x1ffc9e(0xae)])===null||_0x581dba===void 0x0?void 0x0:_0x581dba[_0x1ffc9e(0xb7)])||0x1f4;console['log'](_0x1ffc9e(0xcb),JSON[_0x1ffc9e(0xe8)](_0x3ca4e5),_0xb65f6);const _0x11340f=(_0x39a34a=(_0x57070d=(_0x6db11b=_0x3ca4e5===null||_0x3ca4e5===void 0x0?void 0x0:_0x3ca4e5['response'])===null||_0x6db11b===void 0x0?void 0x0:_0x6db11b[_0x1ffc9e(0xb6)])===null||_0x57070d===void 0x0?void 0x0:_0x57070d[_0x1ffc9e(0xb0)])===null||_0x39a34a===void 0x0?void 0x0:_0x39a34a[_0x1ffc9e(0xe3)];if(_0xb65f6===0x1ad)return _0x1fea3f[_0x1ffc9e(0xda)]=_0x1ffc9e(0xc0),_0x1fea3f;if(_0xb65f6===0x190&&_0x11340f[_0x1ffc9e(0xb9)]('This\x20request\x20has\x20been\x20blocked\x20by\x20our\x20content\x20filters'))return _0x1fea3f['text']=_0x1ffc9e(0xca),_0x1fea3f;if(_0xb65f6===0x190&&_0x11340f['includes'](_0x1ffc9e(0xdc)))return _0x1fea3f['text']=_0x1ffc9e(0xf1),_0x1fea3f;if(_0xb65f6===0x1f4)return _0x1fea3f['text']=_0x1ffc9e(0xad),_0x1fea3f;if(_0xb65f6===0x191)return _0x1fea3f[_0x1ffc9e(0xda)]=_0x1ffc9e(0xdf),_0x1fea3f;return _0x1fea3f['text']='绘制图片失败，请稍后试试吧！',_0x1fea3f;}}};OpenAIDrawService=OpenAIDrawService_1=__decorate([(0x0,common_1['Injectable'])(),__metadata(_0x34a699(0xc7),[upload_service_1[_0x34a699(0xf6)],globalConfig_service_1[_0x34a699(0xd2)],chatLog_service_1[_0x34a699(0xe1)],openaiChat_service_1[_0x34a699(0xb3)]])],OpenAIDrawService),exports[_0x34a699(0xaf)]=OpenAIDrawService;function _0x348b(){const _0x176ed9=['DrawService','绘制图片失败，请检查你的提示词是否有非法描述！','response','OpenAIDrawService','error','DalleDraw','url','OpenAIChatService','1024x1024','logger','data','status','name','includes','563694Oivztl','64576ggVWEv','../chatLog/chatLog.service','/v1/images/generations','revised_prompt','uploadFileFromUrl','当前请求已过载、请稍等会儿再试试吧！','padStart','Logger','globalConfigService','参考上文，结合我的需求，给出绘画描述。我的需求是：','3DXZQmO','default','design:paramtypes','Bearer\x20','上传图片过程中出现错误:\x20','您的请求已被系统拒绝。您的提示可能存在一些非法的文本。','draw\x20error:\x20','chatLogService','metadata','getOwnPropertyDescriptor','5305817PDjzft','99geGrXz','根据提示词{','GlobalConfigService','log','./openaiChat.service','size','翻译失败:\x20','object','fileInfo','382064fFDRzY','text','91SaYGRI','Billing\x20hard\x20limit\x20has\x20been\x20reached','isDalleChat','getMonth','绘制图片失败，此次绘画被拒绝了！','axios','ChatLogService','uploadService','message','getConfigs','图片上传成功，URL:\x20','调用chatFree失败：','968298RZntTX','stringify','defineProperty','\x20绘制成功','340240KfVDxP','function','1930536mhgBVh','dalleDraw','images/dalle/','开始提交\x20Dalle\x20绘图任务\x20','当前模型key已被封禁、已冻结当前调用Key、尝试重新对话试试吧！','__metadata','chatFree','POST','------>\x20开始上传图片！！！','UploadService','openAIChatService','__decorate','getFullYear','../globalConfig/globalConfig.service','__esModule','45pWMCoV','answer'];_0x348b=function(){return _0x176ed9;};return _0x348b();}