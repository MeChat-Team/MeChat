'use strict';const _0x2ba9ae=_0x676c;(function(_0x801949,_0x1b18f7){const _0x1aab6f=_0x676c,_0x194fe1=_0x801949();while(!![]){try{const _0x1e81c0=parseInt(_0x1aab6f(0x11b))/0x1+-parseInt(_0x1aab6f(0x133))/0x2*(-parseInt(_0x1aab6f(0xf3))/0x3)+-parseInt(_0x1aab6f(0x10d))/0x4*(parseInt(_0x1aab6f(0x10e))/0x5)+-parseInt(_0x1aab6f(0x12a))/0x6+parseInt(_0x1aab6f(0x106))/0x7+-parseInt(_0x1aab6f(0xfd))/0x8*(-parseInt(_0x1aab6f(0xf4))/0x9)+parseInt(_0x1aab6f(0x129))/0xa;if(_0x1e81c0===_0x1b18f7)break;else _0x194fe1['push'](_0x194fe1['shift']());}catch(_0x1b780e){_0x194fe1['push'](_0x194fe1['shift']());}}}(_0x111f,0xf298c));var __decorate=this&&this['__decorate']||function(_0x4cb9e6,_0x57dafb,_0x25c75f,_0x5aef90){const _0x466e3b=_0x676c;var _0x59d9e0=arguments[_0x466e3b(0x11f)],_0x2c960e=_0x59d9e0<0x3?_0x57dafb:_0x5aef90===null?_0x5aef90=Object[_0x466e3b(0x110)](_0x57dafb,_0x25c75f):_0x5aef90,_0x19a975;if(typeof Reflect===_0x466e3b(0x114)&&typeof Reflect['decorate']==='function')_0x2c960e=Reflect['decorate'](_0x4cb9e6,_0x57dafb,_0x25c75f,_0x5aef90);else{for(var _0x2d6068=_0x4cb9e6[_0x466e3b(0x11f)]-0x1;_0x2d6068>=0x0;_0x2d6068--)if(_0x19a975=_0x4cb9e6[_0x2d6068])_0x2c960e=(_0x59d9e0<0x3?_0x19a975(_0x2c960e):_0x59d9e0>0x3?_0x19a975(_0x57dafb,_0x25c75f,_0x2c960e):_0x19a975(_0x57dafb,_0x25c75f))||_0x2c960e;}return _0x59d9e0>0x3&&_0x2c960e&&Object[_0x466e3b(0x107)](_0x57dafb,_0x25c75f,_0x2c960e),_0x2c960e;},__metadata=this&&this[_0x2ba9ae(0x119)]||function(_0x4a8e52,_0x331913){const _0xcd6bb5=_0x2ba9ae;if(typeof Reflect==='object'&&typeof Reflect[_0xcd6bb5(0xfe)]===_0xcd6bb5(0x111))return Reflect[_0xcd6bb5(0xfe)](_0x4a8e52,_0x331913);},OpenAIDrawService_1;Object[_0x2ba9ae(0x107)](exports,_0x2ba9ae(0x116),{'value':!![]}),exports[_0x2ba9ae(0x101)]=void 0x0;const common_1=require('@nestjs/common'),axios_1=require(_0x2ba9ae(0xf0)),chatLog_service_1=require('../chatLog/chatLog.service'),globalConfig_service_1=require('../globalConfig/globalConfig.service'),upload_service_1=require(_0x2ba9ae(0xef)),openaiChat_service_1=require(_0x2ba9ae(0x123));function _0x111f(){const _0x3b4c96=['参考上文，结合我的需求，给出绘画描述。我的需求是：','Injectable','chatLogService','../upload/upload.service','axios','绘制图片失败，此次绘画被拒绝了！','revised_prompt','2793DzZZvo','9OglCZd','chatFree','你是一个绘画提示词生成工具，请根据用户的要求，结合上下文，用一段文字，描述用户需要的绘画需求，不用包含任何礼貌性的寒暄,只需要场景的描述,可以适当联想','getFullYear','message','padStart','draw\x20error:\x20','DalleDraw','UploadService','5382984DKfISH','metadata','调用chatFree失败：','当前请求已过载、请稍等会儿再试试吧！','OpenAIDrawService','\x20绘制成功','根据提示词{','size','ChatLogService','279503qdouFk','defineProperty','design:paramtypes','text','Bearer\x20','Billing\x20hard\x20limit\x20has\x20been\x20reached','/v1/images/generations','1644KQFFAy','1010mxzVxV','stringify','getOwnPropertyDescriptor','function','answer','logger','object','application/json','__esModule','绘制图片失败，请稍后试试吧！','uploadFileFromUrl','__metadata','GlobalConfigService','852196ktTyUN','------>\x20开始上传图片！！！','includes','openAIChatService','length','DrawService','log','Logger','./openaiChat.service','},\x20模拟AI绘画机器人的语气，用中文回复，告诉用户已经画好了','fileInfo','绘制图片失败，请检查你的提示词是否有非法描述！','getMonth','status','6088980gjgEYd','7862382faVbEM','globalConfigService','翻译失败:\x20','error','data','已开启连续绘画模式','您的请求已被系统拒绝。您的提示可能存在一些非法的文本。','getConfigs','uploadService','458dJekyF','上传图片过程中出现错误:\x20','开始提交\x20Dalle\x20绘图任务\x20','url','图片上传成功，URL:\x20','response','getDate'];_0x111f=function(){return _0x3b4c96;};return _0x111f();}function _0x676c(_0x5db2ff,_0x1635c9){const _0x111f31=_0x111f();return _0x676c=function(_0x676c7c,_0x32f084){_0x676c7c=_0x676c7c-0xe7;let _0x262429=_0x111f31[_0x676c7c];return _0x262429;},_0x676c(_0x5db2ff,_0x1635c9);}let OpenAIDrawService=OpenAIDrawService_1=class OpenAIDrawService{constructor(_0x5d661b,_0x39bc46,_0x37498c,_0x48bce6){const _0x452258=_0x2ba9ae;this[_0x452258(0x132)]=_0x5d661b,this[_0x452258(0x12b)]=_0x39bc46,this[_0x452258(0xee)]=_0x37498c,this[_0x452258(0x11e)]=_0x48bce6,this[_0x452258(0x113)]=new common_1[(_0x452258(0x122))](OpenAIDrawService_1['name']);}async['dalleDraw'](_0x1841bc,_0x2c16e2){const _0x334a4f=_0x2ba9ae;var _0xbaa05c,_0x523a0b,_0x5473ac,_0x5c56a4;common_1[_0x334a4f(0x122)]['log'](_0x334a4f(0xe7),_0x334a4f(0x120));const {apiKey:_0x250504,model:_0x224fb7,proxyUrl:_0x38a811,prompt:_0x4d4e0b,extraParam:_0x1e2a9e,timeout:_0x1a5b2f,onSuccess:_0x3d2046,onFailure:_0x4b84f8,groupId:_0x47e163}=_0x1841bc,_0x580804=await this[_0x334a4f(0x12b)][_0x334a4f(0x131)](['isDalleChat']);let _0x1c0446;if(_0x580804==='1')try{common_1[_0x334a4f(0x122)][_0x334a4f(0x121)](_0x334a4f(0x12f),_0x334a4f(0xfb));const {messagesHistory:_0x42d54c}=await _0x2c16e2(_0x334a4f(0xec)+_0x4d4e0b,{'groupId':_0x47e163,'systemMessage':_0x334a4f(0xf6),'maxModelTokens':0x1f40,'maxRounds':0x5,'fileInfo':''},this[_0x334a4f(0xee)]);_0x1c0446=await this[_0x334a4f(0x11e)][_0x334a4f(0xf5)](_0x4d4e0b,undefined,_0x42d54c);}catch(_0x457c50){console[_0x334a4f(0x12d)](_0x334a4f(0xff),_0x457c50),_0x1c0446=_0x4d4e0b;}else _0x1c0446=_0x4d4e0b;const _0x2d08fb=(_0x1e2a9e===null||_0x1e2a9e===void 0x0?void 0x0:_0x1e2a9e[_0x334a4f(0x104)])||'1024x1024';let _0x153b36={'answer':'','fileInfo':'','status':0x2};try{const _0x2af59d={'method':'POST','url':_0x38a811+_0x334a4f(0x10c),'timeout':_0x1a5b2f,'headers':{'Content-Type':_0x334a4f(0x115),'Authorization':_0x334a4f(0x10a)+_0x250504},'data':{'model':_0x224fb7,'prompt':_0x1c0446,'size':_0x2d08fb}},_0x5743d8=await(0x0,axios_1['default'])(_0x2af59d),_0x12c5a3=_0x5743d8[_0x334a4f(0x12e)]['data'][0x0][_0x334a4f(0xe8)];try{common_1['Logger'][_0x334a4f(0x121)](_0x334a4f(0x11c),_0x334a4f(0x120));const _0x1d80ee=new Date(),_0x3247f1=_0x1d80ee[_0x334a4f(0xf7)](),_0x26539d=String(_0x1d80ee[_0x334a4f(0x127)]()+0x1)[_0x334a4f(0xf9)](0x2,'0'),_0x497064=String(_0x1d80ee[_0x334a4f(0xeb)]())[_0x334a4f(0xf9)](0x2,'0'),_0x147f84=''+_0x3247f1+_0x26539d+'/'+_0x497064;_0x153b36[_0x334a4f(0x125)]=await this[_0x334a4f(0x132)][_0x334a4f(0x118)]({'url':_0x12c5a3,'dir':'images/dalle/'+_0x147f84}),common_1['Logger'][_0x334a4f(0x121)](_0x334a4f(0xe9)+_0x153b36[_0x334a4f(0x125)],_0x334a4f(0x120));}catch(_0x4b9e7d){common_1['Logger']['error'](_0x334a4f(0x134)+_0x4b9e7d,_0x334a4f(0x120));}let _0x1d6cea;try{_0x1d6cea=await this['openAIChatService']['chatFree'](_0x334a4f(0x103)+_0x5743d8['data'][_0x334a4f(0x12e)][0x0][_0x334a4f(0xf2)]+_0x334a4f(0x124));}catch(_0x9380a5){_0x1d6cea=_0x4d4e0b+_0x334a4f(0x102),common_1[_0x334a4f(0x122)][_0x334a4f(0x12d)](_0x334a4f(0x12c),_0x9380a5);}_0x153b36[_0x334a4f(0x112)]=_0x1d6cea,_0x153b36[_0x334a4f(0x128)]=0x3,_0x3d2046(_0x153b36);return;}catch(_0x762de5){_0x153b36[_0x334a4f(0x128)]=0x5,_0x4b84f8(_0x153b36);const _0x4ccbdc=((_0xbaa05c=_0x762de5===null||_0x762de5===void 0x0?void 0x0:_0x762de5[_0x334a4f(0xea)])===null||_0xbaa05c===void 0x0?void 0x0:_0xbaa05c[_0x334a4f(0x128)])||0x1f4;console[_0x334a4f(0x121)](_0x334a4f(0xfa),JSON[_0x334a4f(0x10f)](_0x762de5),_0x4ccbdc);const _0x23cdec=(_0x5c56a4=(_0x5473ac=(_0x523a0b=_0x762de5===null||_0x762de5===void 0x0?void 0x0:_0x762de5[_0x334a4f(0xea)])===null||_0x523a0b===void 0x0?void 0x0:_0x523a0b[_0x334a4f(0x12e)])===null||_0x5473ac===void 0x0?void 0x0:_0x5473ac['error'])===null||_0x5c56a4===void 0x0?void 0x0:_0x5c56a4[_0x334a4f(0xf8)];if(_0x4ccbdc===0x1ad)return _0x153b36[_0x334a4f(0x109)]=_0x334a4f(0x100),_0x153b36;if(_0x4ccbdc===0x190&&_0x23cdec[_0x334a4f(0x11d)]('This\x20request\x20has\x20been\x20blocked\x20by\x20our\x20content\x20filters'))return _0x153b36[_0x334a4f(0x109)]=_0x334a4f(0x130),_0x153b36;if(_0x4ccbdc===0x190&&_0x23cdec[_0x334a4f(0x11d)](_0x334a4f(0x10b)))return _0x153b36[_0x334a4f(0x109)]='当前模型key已被封禁、已冻结当前调用Key、尝试重新对话试试吧！',_0x153b36;if(_0x4ccbdc===0x1f4)return _0x153b36[_0x334a4f(0x109)]=_0x334a4f(0x126),_0x153b36;if(_0x4ccbdc===0x191)return _0x153b36[_0x334a4f(0x109)]=_0x334a4f(0xf1),_0x153b36;return _0x153b36[_0x334a4f(0x109)]=_0x334a4f(0x117),_0x153b36;}}};OpenAIDrawService=OpenAIDrawService_1=__decorate([(0x0,common_1[_0x2ba9ae(0xed)])(),__metadata(_0x2ba9ae(0x108),[upload_service_1[_0x2ba9ae(0xfc)],globalConfig_service_1[_0x2ba9ae(0x11a)],chatLog_service_1[_0x2ba9ae(0x105)],openaiChat_service_1['OpenAIChatService']])],OpenAIDrawService),exports[_0x2ba9ae(0x101)]=OpenAIDrawService;