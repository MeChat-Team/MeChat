'use strict';const _0x2b2b5a=_0x59a4;(function(_0x3b9929,_0x2bbc05){const _0x56d955=_0x59a4,_0x1b1288=_0x3b9929();while(!![]){try{const _0x390ada=-parseInt(_0x56d955(0x16a))/0x1*(parseInt(_0x56d955(0x151))/0x2)+parseInt(_0x56d955(0x160))/0x3+-parseInt(_0x56d955(0x15b))/0x4*(parseInt(_0x56d955(0x164))/0x5)+-parseInt(_0x56d955(0x158))/0x6+parseInt(_0x56d955(0x13f))/0x7+-parseInt(_0x56d955(0x145))/0x8*(-parseInt(_0x56d955(0x15d))/0x9)+parseInt(_0x56d955(0x13a))/0xa;if(_0x390ada===_0x2bbc05)break;else _0x1b1288['push'](_0x1b1288['shift']());}catch(_0x34151a){_0x1b1288['push'](_0x1b1288['shift']());}}}(_0x4568,0x3801e));function _0x59a4(_0x2703b6,_0x3037a7){const _0x4568ab=_0x4568();return _0x59a4=function(_0x59a414,_0x326b7b){_0x59a414=_0x59a414-0x136;let _0x2b5f30=_0x4568ab[_0x59a414];return _0x2b5f30;},_0x59a4(_0x2703b6,_0x3037a7);}var __decorate=this&&this[_0x2b2b5a(0x147)]||function(_0x25c409,_0x12cf26,_0x6d9d8c,_0x429074){const _0x2392ee=_0x2b2b5a;var _0x21d886=arguments[_0x2392ee(0x169)],_0x468960=_0x21d886<0x3?_0x12cf26:_0x429074===null?_0x429074=Object['getOwnPropertyDescriptor'](_0x12cf26,_0x6d9d8c):_0x429074,_0x1b7ce3;if(typeof Reflect===_0x2392ee(0x15c)&&typeof Reflect['decorate']==='function')_0x468960=Reflect['decorate'](_0x25c409,_0x12cf26,_0x6d9d8c,_0x429074);else{for(var _0x3508fd=_0x25c409[_0x2392ee(0x169)]-0x1;_0x3508fd>=0x0;_0x3508fd--)if(_0x1b7ce3=_0x25c409[_0x3508fd])_0x468960=(_0x21d886<0x3?_0x1b7ce3(_0x468960):_0x21d886>0x3?_0x1b7ce3(_0x12cf26,_0x6d9d8c,_0x468960):_0x1b7ce3(_0x12cf26,_0x6d9d8c))||_0x468960;}return _0x21d886>0x3&&_0x468960&&Object[_0x2392ee(0x17e)](_0x12cf26,_0x6d9d8c,_0x468960),_0x468960;},__metadata=this&&this[_0x2b2b5a(0x140)]||function(_0x387b9c,_0x315128){const _0x5de333=_0x2b2b5a;if(typeof Reflect===_0x5de333(0x15c)&&typeof Reflect['metadata']===_0x5de333(0x166))return Reflect['metadata'](_0x387b9c,_0x315128);},OpenAIDrawService_1;Object['defineProperty'](exports,_0x2b2b5a(0x14d),{'value':!![]}),exports[_0x2b2b5a(0x13c)]=void 0x0;const common_1=require(_0x2b2b5a(0x168)),axios_1=require(_0x2b2b5a(0x14e)),chatLog_service_1=require(_0x2b2b5a(0x174)),globalConfig_service_1=require(_0x2b2b5a(0x15a)),upload_service_1=require('../upload/upload.service'),openaiChat_service_1=require('./openaiChat.service');let OpenAIDrawService=OpenAIDrawService_1=class OpenAIDrawService{constructor(_0x2fba0c,_0x43b999,_0x3397fb,_0x247cc0){const _0x642069=_0x2b2b5a;this[_0x642069(0x175)]=_0x2fba0c,this[_0x642069(0x150)]=_0x43b999,this[_0x642069(0x13b)]=_0x3397fb,this[_0x642069(0x139)]=_0x247cc0,this['logger']=new common_1['Logger'](OpenAIDrawService_1['name']);}async[_0x2b2b5a(0x149)](_0x3a0213,_0x3edb07){const _0x3ba3c8=_0x2b2b5a;var _0x559187,_0x5f30b9,_0x2ff564,_0x1c55d1;common_1['Logger']['log'](_0x3ba3c8(0x138),_0x3ba3c8(0x180));const {apiKey:_0x468feb,model:_0x1aabd9,proxyUrl:_0x313e1e,prompt:_0x2a31e8,extraParam:_0xfe41e3,timeout:_0x212b31,onSuccess:_0x1f4b61,onFailure:_0x2f34e8,groupId:_0x21b56b}=_0x3a0213,_0x48c604=await this['globalConfigService']['getConfigs']([_0x3ba3c8(0x137)]);let _0x40e51a;if(_0x48c604==='1')try{common_1['Logger'][_0x3ba3c8(0x16d)](_0x3ba3c8(0x154),_0x3ba3c8(0x163));const {messagesHistory:_0x2d94f5}=await _0x3edb07(_0x3ba3c8(0x172)+_0x2a31e8,{'groupId':_0x21b56b,'systemMessage':'你是一个绘画提示词生成工具，请根据用户的要求，结合上下文，用一段文字，描述用户需要的绘画需求，不用包含任何礼貌性的寒暄,只需要场景的描述,可以适当联想','maxModelTokens':0x1f40,'maxRounds':0x5,'fileInfo':''},this[_0x3ba3c8(0x13b)]);_0x40e51a=await this[_0x3ba3c8(0x139)][_0x3ba3c8(0x177)](_0x2a31e8,undefined,_0x2d94f5);}catch(_0x577d6f){console[_0x3ba3c8(0x153)](_0x3ba3c8(0x13d),_0x577d6f),_0x40e51a=_0x2a31e8;}else _0x40e51a=_0x2a31e8;const _0x2f26d4=(_0xfe41e3===null||_0xfe41e3===void 0x0?void 0x0:_0xfe41e3[_0x3ba3c8(0x156)])||_0x3ba3c8(0x148);let _0x1b5889={'answer':'','fileInfo':'','status':0x2};try{const _0x1b099d={'method':'POST','url':_0x313e1e+_0x3ba3c8(0x161),'timeout':_0x212b31,'headers':{'Content-Type':_0x3ba3c8(0x170),'Authorization':_0x3ba3c8(0x157)+_0x468feb},'data':{'model':_0x1aabd9,'prompt':_0x40e51a,'size':_0x2f26d4}},_0x5d041e=await(0x0,axios_1[_0x3ba3c8(0x16f)])(_0x1b099d),_0x124b39=_0x5d041e[_0x3ba3c8(0x144)][_0x3ba3c8(0x144)][0x0]['url'];try{common_1['Logger'][_0x3ba3c8(0x16d)](_0x3ba3c8(0x171),_0x3ba3c8(0x180));const _0x4a1502=new Date(),_0x14eafb=_0x4a1502[_0x3ba3c8(0x17f)](),_0x49dedd=String(_0x4a1502[_0x3ba3c8(0x14f)]()+0x1)[_0x3ba3c8(0x16b)](0x2,'0'),_0x3fc701=String(_0x4a1502[_0x3ba3c8(0x15f)]())[_0x3ba3c8(0x16b)](0x2,'0'),_0x3c2c57=''+_0x14eafb+_0x49dedd+'/'+_0x3fc701;_0x1b5889[_0x3ba3c8(0x162)]=await this[_0x3ba3c8(0x175)][_0x3ba3c8(0x14c)]({'url':_0x124b39,'dir':_0x3ba3c8(0x15e)+_0x3c2c57}),common_1[_0x3ba3c8(0x167)][_0x3ba3c8(0x16d)](_0x3ba3c8(0x141)+_0x1b5889[_0x3ba3c8(0x162)],'DrawService');}catch(_0x240a77){common_1['Logger']['error'](_0x3ba3c8(0x17c)+_0x240a77,'DrawService');}let _0x1d2468;try{_0x1d2468=await this[_0x3ba3c8(0x139)][_0x3ba3c8(0x177)]('根据提示词{'+_0x5d041e[_0x3ba3c8(0x144)]['data'][0x0][_0x3ba3c8(0x155)]+_0x3ba3c8(0x152));}catch(_0x1a08f3){_0x1d2468=_0x2a31e8+_0x3ba3c8(0x176),common_1[_0x3ba3c8(0x167)][_0x3ba3c8(0x153)](_0x3ba3c8(0x14b),_0x1a08f3);}_0x1b5889[_0x3ba3c8(0x17d)]=_0x1d2468,_0x1b5889[_0x3ba3c8(0x16e)]=0x3,_0x1f4b61(_0x1b5889);return;}catch(_0x8e90e1){_0x1b5889['status']=0x5,_0x2f34e8(_0x1b5889);const _0x16bf6f=((_0x559187=_0x8e90e1===null||_0x8e90e1===void 0x0?void 0x0:_0x8e90e1[_0x3ba3c8(0x16c)])===null||_0x559187===void 0x0?void 0x0:_0x559187[_0x3ba3c8(0x16e)])||0x1f4;console[_0x3ba3c8(0x16d)]('draw\x20error:\x20',JSON[_0x3ba3c8(0x173)](_0x8e90e1),_0x16bf6f);const _0x26b4fe=(_0x1c55d1=(_0x2ff564=(_0x5f30b9=_0x8e90e1===null||_0x8e90e1===void 0x0?void 0x0:_0x8e90e1[_0x3ba3c8(0x16c)])===null||_0x5f30b9===void 0x0?void 0x0:_0x5f30b9['data'])===null||_0x2ff564===void 0x0?void 0x0:_0x2ff564[_0x3ba3c8(0x153)])===null||_0x1c55d1===void 0x0?void 0x0:_0x1c55d1[_0x3ba3c8(0x17a)];if(_0x16bf6f===0x1ad)return _0x1b5889[_0x3ba3c8(0x181)]='当前请求已过载、请稍等会儿再试试吧！',_0x1b5889;if(_0x16bf6f===0x190&&_0x26b4fe['includes'](_0x3ba3c8(0x136)))return _0x1b5889[_0x3ba3c8(0x181)]='您的请求已被系统拒绝。您的提示可能存在一些非法的文本。',_0x1b5889;if(_0x16bf6f===0x190&&_0x26b4fe[_0x3ba3c8(0x14a)](_0x3ba3c8(0x165)))return _0x1b5889[_0x3ba3c8(0x181)]=_0x3ba3c8(0x178),_0x1b5889;if(_0x16bf6f===0x1f4)return _0x1b5889[_0x3ba3c8(0x181)]='绘制图片失败，请检查你的提示词是否有非法描述！',_0x1b5889;if(_0x16bf6f===0x191)return _0x1b5889['text']=_0x3ba3c8(0x13e),_0x1b5889;return _0x1b5889[_0x3ba3c8(0x181)]=_0x3ba3c8(0x17b),_0x1b5889;}}};function _0x4568(){const _0x5e1970=['------>\x20开始上传图片！！！','参考上文，结合我的需求，给出绘画描述。我的需求是：','stringify','../chatLog/chatLog.service','uploadService','\x20绘制成功','chatFree','当前模型key已被封禁、已冻结当前调用Key、尝试重新对话试试吧！','Injectable','message','绘制图片失败，请稍后试试吧！','上传图片过程中出现错误:\x20','answer','defineProperty','getFullYear','DrawService','text','This\x20request\x20has\x20been\x20blocked\x20by\x20our\x20content\x20filters','isDalleChat','开始提交\x20Dalle\x20绘图任务\x20','openAIChatService','333500wuwbaY','chatLogService','OpenAIDrawService','调用chatFree失败：','绘制图片失败，此次绘画被拒绝了！','1956136mvamUa','__metadata','图片上传成功，URL:\x20','OpenAIChatService','UploadService','data','293240CibTas','design:paramtypes','__decorate','1024x1024','dalleDraw','includes','翻译失败:\x20','uploadFileFromUrl','__esModule','axios','getMonth','globalConfigService','4LjtzEs','},\x20模拟AI绘画机器人的语气，用中文回复，告诉用户已经画好了','error','已开启连续绘画模式','revised_prompt','size','Bearer\x20','1600674RZEEIN','ChatLogService','../globalConfig/globalConfig.service','20TKHRJZ','object','36TIXAIW','images/dalle/','getDate','526782mTsRnT','/v1/images/generations','fileInfo','DalleDraw','20845yRvIdB','Billing\x20hard\x20limit\x20has\x20been\x20reached','function','Logger','@nestjs/common','length','58991dUUria','padStart','response','log','status','default','application/json'];_0x4568=function(){return _0x5e1970;};return _0x4568();}OpenAIDrawService=OpenAIDrawService_1=__decorate([(0x0,common_1[_0x2b2b5a(0x179)])(),__metadata(_0x2b2b5a(0x146),[upload_service_1[_0x2b2b5a(0x143)],globalConfig_service_1['GlobalConfigService'],chatLog_service_1[_0x2b2b5a(0x159)],openaiChat_service_1[_0x2b2b5a(0x142)]])],OpenAIDrawService),exports[_0x2b2b5a(0x13c)]=OpenAIDrawService;