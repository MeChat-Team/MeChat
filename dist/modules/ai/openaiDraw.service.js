'use strict';const _0x3447b3=_0x2ff9;(function(_0x501fae,_0x57c3ba){const _0x2a5111=_0x2ff9,_0x43bada=_0x501fae();while(!![]){try{const _0x271dc1=-parseInt(_0x2a5111(0xfc))/0x1*(-parseInt(_0x2a5111(0x10c))/0x2)+parseInt(_0x2a5111(0xe5))/0x3+parseInt(_0x2a5111(0xcf))/0x4+parseInt(_0x2a5111(0xc3))/0x5*(-parseInt(_0x2a5111(0x102))/0x6)+parseInt(_0x2a5111(0xc5))/0x7*(parseInt(_0x2a5111(0xe4))/0x8)+parseInt(_0x2a5111(0xf2))/0x9*(-parseInt(_0x2a5111(0xe3))/0xa)+-parseInt(_0x2a5111(0xd0))/0xb;if(_0x271dc1===_0x57c3ba)break;else _0x43bada['push'](_0x43bada['shift']());}catch(_0x279f58){_0x43bada['push'](_0x43bada['shift']());}}}(_0x1608,0x38bb0));function _0x1608(){const _0x41aa72=['includes','response','uploadService','817192oVXkNM','7483641tKQcCa','images/dalle/','Injectable','decorate','开始提交\x20Dalle\x20绘图任务\x20','globalConfigService','../chatLog/chatLog.service','uploadFileFromUrl','ChatLogService','size','chatFree','GlobalConfigService','DalleDraw','1024x1024','../upload/upload.service','已开启连续绘画模式','__metadata','当前请求已过载、请稍等会儿再试试吧！','Bearer\x20','12290LtBXnm','6016etohyL','1392567WJeNLi','defineProperty','length','@nestjs/common','object','url','data','log','openAIChatService','------>\x20开始上传图片！！！','text','stringify','上传图片过程中出现错误:\x20','441oqrDkP','Logger','绘制图片失败，此次绘画被拒绝了！','DrawService','绘制图片失败，请稍后试试吧！','isDalleChat','metadata','getMonth','Billing\x20hard\x20limit\x20has\x20been\x20reached','根据提示词{','114043KKSNIE','application/json','design:paramtypes','chatLogService','status','__esModule','209406ljTkRf','axios','调用chatFree失败：','error','绘制图片失败，请检查你的提示词是否有非法描述！','翻译失败:\x20','dalleDraw','OpenAIDrawService','/v1/images/generations','draw\x20error:\x20','2fovWkA','图片上传成功，URL:\x20','getOwnPropertyDescriptor','10jgGRTc','当前模型key已被封禁、已冻结当前调用Key、尝试重新对话试试吧！','2422UfvSeu','message','answer','logger','参考上文，结合我的需求，给出绘画描述。我的需求是：','getConfigs','fileInfo'];_0x1608=function(){return _0x41aa72;};return _0x1608();}var __decorate=this&&this['__decorate']||function(_0x3f2962,_0x310dcf,_0x3c5ce1,_0x423c3b){const _0x273cda=_0x2ff9;var _0x48b5f4=arguments[_0x273cda(0xe7)],_0x2113bd=_0x48b5f4<0x3?_0x310dcf:_0x423c3b===null?_0x423c3b=Object[_0x273cda(0xc2)](_0x310dcf,_0x3c5ce1):_0x423c3b,_0x19e3ed;if(typeof Reflect==='object'&&typeof Reflect[_0x273cda(0xd3)]==='function')_0x2113bd=Reflect[_0x273cda(0xd3)](_0x3f2962,_0x310dcf,_0x3c5ce1,_0x423c3b);else{for(var _0x102b6b=_0x3f2962['length']-0x1;_0x102b6b>=0x0;_0x102b6b--)if(_0x19e3ed=_0x3f2962[_0x102b6b])_0x2113bd=(_0x48b5f4<0x3?_0x19e3ed(_0x2113bd):_0x48b5f4>0x3?_0x19e3ed(_0x310dcf,_0x3c5ce1,_0x2113bd):_0x19e3ed(_0x310dcf,_0x3c5ce1))||_0x2113bd;}return _0x48b5f4>0x3&&_0x2113bd&&Object[_0x273cda(0xe6)](_0x310dcf,_0x3c5ce1,_0x2113bd),_0x2113bd;},__metadata=this&&this[_0x3447b3(0xe0)]||function(_0xfb1744,_0x1031f1){const _0x5fa4e2=_0x3447b3;if(typeof Reflect===_0x5fa4e2(0xe9)&&typeof Reflect[_0x5fa4e2(0xf8)]==='function')return Reflect['metadata'](_0xfb1744,_0x1031f1);},OpenAIDrawService_1;Object[_0x3447b3(0xe6)](exports,_0x3447b3(0x101),{'value':!![]}),exports['OpenAIDrawService']=void 0x0;const common_1=require(_0x3447b3(0xe8)),axios_1=require(_0x3447b3(0x103)),chatLog_service_1=require(_0x3447b3(0xd6)),globalConfig_service_1=require('../globalConfig/globalConfig.service'),upload_service_1=require(_0x3447b3(0xde)),openaiChat_service_1=require('./openaiChat.service');function _0x2ff9(_0x3bc099,_0x5e0445){const _0x16088a=_0x1608();return _0x2ff9=function(_0x2ff940,_0x44f960){_0x2ff940=_0x2ff940-0xc1;let _0x4569c5=_0x16088a[_0x2ff940];return _0x4569c5;},_0x2ff9(_0x3bc099,_0x5e0445);}let OpenAIDrawService=OpenAIDrawService_1=class OpenAIDrawService{constructor(_0x394f3c,_0x157a07,_0x385dfd,_0x4cee5d){const _0x253ed2=_0x3447b3;this[_0x253ed2(0xce)]=_0x394f3c,this[_0x253ed2(0xd5)]=_0x157a07,this[_0x253ed2(0xff)]=_0x385dfd,this[_0x253ed2(0xed)]=_0x4cee5d,this[_0x253ed2(0xc8)]=new common_1[(_0x253ed2(0xf3))](OpenAIDrawService_1['name']);}async[_0x3447b3(0x108)](_0x21411f,_0x34d710){const _0x4d0d00=_0x3447b3;var _0x47f471,_0x18b4dd,_0x4fa9bd,_0xabd2f2;common_1[_0x4d0d00(0xf3)][_0x4d0d00(0xec)](_0x4d0d00(0xd4),_0x4d0d00(0xf5));const {apiKey:_0x40a20a,model:_0x366325,proxyUrl:_0x404c0a,prompt:_0x50b192,extraParam:_0x59cd12,timeout:_0x4e2c1a,onSuccess:_0x4d3d54,onFailure:_0x3994d3,groupId:_0x3d83a6}=_0x21411f,_0x17374e=await this[_0x4d0d00(0xd5)][_0x4d0d00(0xca)]([_0x4d0d00(0xf7)]);let _0x205d0c;if(_0x17374e==='1')try{common_1['Logger'][_0x4d0d00(0xec)](_0x4d0d00(0xdf),_0x4d0d00(0xdc));const {messagesHistory:_0x5e0da2}=await _0x34d710(_0x4d0d00(0xc9)+_0x50b192,{'groupId':_0x3d83a6,'systemMessage':'你是一个绘画提示词生成工具，请根据用户的要求，结合上下文，用一段文字，描述用户需要的绘画需求，不用包含任何礼貌性的寒暄,只需要场景的描述,可以适当联想','maxModelTokens':0x1f40,'maxRounds':0x5,'fileInfo':''},this[_0x4d0d00(0xff)]);_0x205d0c=await this[_0x4d0d00(0xed)][_0x4d0d00(0xda)](_0x50b192,undefined,_0x5e0da2);}catch(_0x23e464){console[_0x4d0d00(0x105)](_0x4d0d00(0x104),_0x23e464),_0x205d0c=_0x50b192;}else _0x205d0c=_0x50b192;const _0x134675=(_0x59cd12===null||_0x59cd12===void 0x0?void 0x0:_0x59cd12[_0x4d0d00(0xd9)])||_0x4d0d00(0xdd);let _0x283d5a={'answer':'','fileInfo':'','status':0x2};try{const _0x4dc799={'method':'POST','url':_0x404c0a+_0x4d0d00(0x10a),'timeout':_0x4e2c1a,'headers':{'Content-Type':_0x4d0d00(0xfd),'Authorization':_0x4d0d00(0xe2)+_0x40a20a},'data':{'model':_0x366325,'prompt':_0x205d0c,'size':_0x134675}},_0x59618d=await(0x0,axios_1['default'])(_0x4dc799),_0x137a42=_0x59618d['data']['data'][0x0][_0x4d0d00(0xea)];try{common_1['Logger']['log'](_0x4d0d00(0xee),_0x4d0d00(0xf5));const _0x7d7c36=new Date(),_0x2dcc99=_0x7d7c36['getFullYear'](),_0x3b9566=String(_0x7d7c36[_0x4d0d00(0xf9)]()+0x1)['padStart'](0x2,'0'),_0x3ae514=String(_0x7d7c36['getDate']())['padStart'](0x2,'0'),_0x5eb612=''+_0x2dcc99+_0x3b9566+'/'+_0x3ae514;_0x283d5a[_0x4d0d00(0xcb)]=await this[_0x4d0d00(0xce)][_0x4d0d00(0xd7)]({'url':_0x137a42,'dir':_0x4d0d00(0xd1)+_0x5eb612}),common_1[_0x4d0d00(0xf3)][_0x4d0d00(0xec)](_0x4d0d00(0xc1)+_0x283d5a['fileInfo'],_0x4d0d00(0xf5));}catch(_0x221b5f){common_1['Logger'][_0x4d0d00(0x105)](_0x4d0d00(0xf1)+_0x221b5f,_0x4d0d00(0xf5));}let _0x365825;try{_0x365825=await this[_0x4d0d00(0xed)][_0x4d0d00(0xda)](_0x4d0d00(0xfb)+_0x59618d['data']['data'][0x0]['revised_prompt']+'},\x20模拟AI绘画机器人的语气，用中文回复，告诉用户已经画好了');}catch(_0x34795a){_0x365825=_0x50b192+'\x20绘制成功',common_1[_0x4d0d00(0xf3)][_0x4d0d00(0x105)](_0x4d0d00(0x107),_0x34795a);}_0x283d5a[_0x4d0d00(0xc7)]=_0x365825,_0x283d5a[_0x4d0d00(0x100)]=0x3,_0x4d3d54(_0x283d5a);return;}catch(_0x495411){_0x283d5a[_0x4d0d00(0x100)]=0x5,_0x3994d3(_0x283d5a);const _0x31f66f=((_0x47f471=_0x495411===null||_0x495411===void 0x0?void 0x0:_0x495411[_0x4d0d00(0xcd)])===null||_0x47f471===void 0x0?void 0x0:_0x47f471[_0x4d0d00(0x100)])||0x1f4;console[_0x4d0d00(0xec)](_0x4d0d00(0x10b),JSON[_0x4d0d00(0xf0)](_0x495411),_0x31f66f);const _0x497b6b=(_0xabd2f2=(_0x4fa9bd=(_0x18b4dd=_0x495411===null||_0x495411===void 0x0?void 0x0:_0x495411[_0x4d0d00(0xcd)])===null||_0x18b4dd===void 0x0?void 0x0:_0x18b4dd[_0x4d0d00(0xeb)])===null||_0x4fa9bd===void 0x0?void 0x0:_0x4fa9bd[_0x4d0d00(0x105)])===null||_0xabd2f2===void 0x0?void 0x0:_0xabd2f2[_0x4d0d00(0xc6)];if(_0x31f66f===0x1ad)return _0x283d5a[_0x4d0d00(0xef)]=_0x4d0d00(0xe1),_0x283d5a;if(_0x31f66f===0x190&&_0x497b6b[_0x4d0d00(0xcc)]('This\x20request\x20has\x20been\x20blocked\x20by\x20our\x20content\x20filters'))return _0x283d5a['text']='您的请求已被系统拒绝。您的提示可能存在一些非法的文本。',_0x283d5a;if(_0x31f66f===0x190&&_0x497b6b[_0x4d0d00(0xcc)](_0x4d0d00(0xfa)))return _0x283d5a[_0x4d0d00(0xef)]=_0x4d0d00(0xc4),_0x283d5a;if(_0x31f66f===0x1f4)return _0x283d5a['text']=_0x4d0d00(0x106),_0x283d5a;if(_0x31f66f===0x191)return _0x283d5a[_0x4d0d00(0xef)]=_0x4d0d00(0xf4),_0x283d5a;return _0x283d5a['text']=_0x4d0d00(0xf6),_0x283d5a;}}};OpenAIDrawService=OpenAIDrawService_1=__decorate([(0x0,common_1[_0x3447b3(0xd2)])(),__metadata(_0x3447b3(0xfe),[upload_service_1['UploadService'],globalConfig_service_1[_0x3447b3(0xdb)],chatLog_service_1[_0x3447b3(0xd8)],openaiChat_service_1['OpenAIChatService']])],OpenAIDrawService),exports[_0x3447b3(0x109)]=OpenAIDrawService;