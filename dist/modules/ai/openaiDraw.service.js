'use strict';const _0x29ec76=_0xdcf8;(function(_0x4ca7dc,_0x27e243){const _0x30d9cd=_0xdcf8,_0x4c7b72=_0x4ca7dc();while(!![]){try{const _0x5db902=parseInt(_0x30d9cd(0x90))/0x1+parseInt(_0x30d9cd(0x95))/0x2*(parseInt(_0x30d9cd(0xba))/0x3)+-parseInt(_0x30d9cd(0xb7))/0x4*(parseInt(_0x30d9cd(0xcc))/0x5)+-parseInt(_0x30d9cd(0x9a))/0x6*(-parseInt(_0x30d9cd(0xa8))/0x7)+-parseInt(_0x30d9cd(0xc3))/0x8*(parseInt(_0x30d9cd(0xa7))/0x9)+-parseInt(_0x30d9cd(0xa6))/0xa*(parseInt(_0x30d9cd(0x85))/0xb)+parseInt(_0x30d9cd(0xc0))/0xc*(parseInt(_0x30d9cd(0xc8))/0xd);if(_0x5db902===_0x27e243)break;else _0x4c7b72['push'](_0x4c7b72['shift']());}catch(_0x2c0da7){_0x4c7b72['push'](_0x4c7b72['shift']());}}}(_0x5974,0x1c2d3));var __decorate=this&&this[_0x29ec76(0xa4)]||function(_0x2f257b,_0x3d8f56,_0x4a086f,_0x5d0b1a){const _0x548ee8=_0x29ec76;var _0x1736a7=arguments['length'],_0x706bf3=_0x1736a7<0x3?_0x3d8f56:_0x5d0b1a===null?_0x5d0b1a=Object[_0x548ee8(0xaa)](_0x3d8f56,_0x4a086f):_0x5d0b1a,_0x5472e6;if(typeof Reflect===_0x548ee8(0xb3)&&typeof Reflect[_0x548ee8(0xb5)]===_0x548ee8(0xb1))_0x706bf3=Reflect[_0x548ee8(0xb5)](_0x2f257b,_0x3d8f56,_0x4a086f,_0x5d0b1a);else{for(var _0xd55e87=_0x2f257b[_0x548ee8(0x99)]-0x1;_0xd55e87>=0x0;_0xd55e87--)if(_0x5472e6=_0x2f257b[_0xd55e87])_0x706bf3=(_0x1736a7<0x3?_0x5472e6(_0x706bf3):_0x1736a7>0x3?_0x5472e6(_0x3d8f56,_0x4a086f,_0x706bf3):_0x5472e6(_0x3d8f56,_0x4a086f))||_0x706bf3;}return _0x1736a7>0x3&&_0x706bf3&&Object['defineProperty'](_0x3d8f56,_0x4a086f,_0x706bf3),_0x706bf3;},__metadata=this&&this[_0x29ec76(0x87)]||function(_0x1a967b,_0x3c0ec5){const _0xcf612a=_0x29ec76;if(typeof Reflect===_0xcf612a(0xb3)&&typeof Reflect['metadata']===_0xcf612a(0xb1))return Reflect[_0xcf612a(0x8d)](_0x1a967b,_0x3c0ec5);},OpenAIDrawService_1;function _0xdcf8(_0x546faa,_0xc4e447){const _0x597450=_0x5974();return _0xdcf8=function(_0xdcf8e8,_0x60493e){_0xdcf8e8=_0xdcf8e8-0x82;let _0x439824=_0x597450[_0xdcf8e8];return _0x439824;},_0xdcf8(_0x546faa,_0xc4e447);}Object[_0x29ec76(0xbf)](exports,_0x29ec76(0x8c),{'value':!![]}),exports[_0x29ec76(0xb0)]=void 0x0;const common_1=require(_0x29ec76(0x97)),axios_1=require(_0x29ec76(0xce)),chatLog_service_1=require('../chatLog/chatLog.service'),globalConfig_service_1=require('../globalConfig/globalConfig.service'),upload_service_1=require(_0x29ec76(0x8a)),openaiChat_service_1=require(_0x29ec76(0xac));function _0x5974(){const _0x4124da=['根据提示词{','length','78dYqWpZ','GlobalConfigService','翻译失败:\x20','globalConfigService','data','status','Billing\x20hard\x20limit\x20has\x20been\x20reached','你是一个绘画提示词生成工具，请根据用户的要求，结合上下文，用一段文字，描述用户需要的绘画需求，不用包含任何礼貌性的寒暄,只需要场景的描述,可以适当联想','revised_prompt','response','__decorate','参考上文，结合我的需求，给出绘画描述。我的需求是：','40360wYiHdY','21078HhqRNM','99211OYLdaq','name','getOwnPropertyDescriptor','1024x1024','./openaiChat.service','logger','Injectable','includes','OpenAIDrawService','function','------>\x20开始上传图片！！！','object','stringify','decorate','uploadFileFromUrl','4hvefsa','OpenAIChatService','\x20绘制成功','6APDEqD','fileInfo','/v1/images/generations','getFullYear','当前请求已过载、请稍等会儿再试试吧！','defineProperty','655404eKXzxw','padStart','当前模型key已被封禁、已冻结当前调用Key、尝试重新对话试试吧！','416KzFnNa','images/dalle/','isDalleChat','},\x20模拟AI绘画机器人的语气，用中文回复，告诉用户已经画好了','Logger','52Rtsxsg','error','application/json','text','1126205HOBqip','uploadService','axios','log','调用chatFree失败：','This\x20request\x20has\x20been\x20blocked\x20by\x20our\x20content\x20filters','绘制图片失败，请稍后试试吧！','绘制图片失败，此次绘画被拒绝了！','default','407RmhaiY','draw\x20error:\x20','__metadata','图片上传成功，URL:\x20','chatFree','../upload/upload.service','openAIChatService','__esModule','metadata','开始提交\x20Dalle\x20绘图任务\x20','DrawService','76761qEzuBg','绘制图片失败，请检查你的提示词是否有非法描述！','getDate','getMonth','chatLogService','132290cpvzVM','UploadService','@nestjs/common'];_0x5974=function(){return _0x4124da;};return _0x5974();}let OpenAIDrawService=OpenAIDrawService_1=class OpenAIDrawService{constructor(_0x48e7b7,_0x9ddec8,_0x25b04c,_0x10bf12){const _0x30af67=_0x29ec76;this[_0x30af67(0xcd)]=_0x48e7b7,this['globalConfigService']=_0x9ddec8,this['chatLogService']=_0x25b04c,this[_0x30af67(0x8b)]=_0x10bf12,this[_0x30af67(0xad)]=new common_1[(_0x30af67(0xc7))](OpenAIDrawService_1[_0x30af67(0xa9)]);}async['dalleDraw'](_0x1f047f,_0x40894e){const _0x1a7f8f=_0x29ec76;var _0x16d28a,_0x5b57fe,_0x397cce,_0x25b31b;common_1[_0x1a7f8f(0xc7)][_0x1a7f8f(0xcf)](_0x1a7f8f(0x8e),'DrawService');const {apiKey:_0x4c750b,model:_0x3ee496,proxyUrl:_0x131bb9,prompt:_0x466a9f,extraParam:_0x53f14f,timeout:_0x1e6a04,onSuccess:_0x5d6061,onFailure:_0xd686,groupId:_0x14cd79}=_0x1f047f,_0x4e84fe=await this[_0x1a7f8f(0x9d)]['getConfigs']([_0x1a7f8f(0xc5)]);let _0x45a7db;if(_0x4e84fe==='1')try{common_1[_0x1a7f8f(0xc7)][_0x1a7f8f(0xcf)]('已开启连续绘画模式','DalleDraw');const {messagesHistory:_0x45c61e}=await _0x40894e(_0x1a7f8f(0xa5)+_0x466a9f,{'groupId':_0x14cd79,'systemMessage':_0x1a7f8f(0xa1),'maxModelTokens':0x1f40,'maxRounds':0x5,'fileInfo':''},this[_0x1a7f8f(0x94)]);_0x45a7db=await this[_0x1a7f8f(0x8b)][_0x1a7f8f(0x89)](_0x466a9f,undefined,_0x45c61e);}catch(_0xd6c19f){console[_0x1a7f8f(0xc9)](_0x1a7f8f(0xd0),_0xd6c19f),_0x45a7db=_0x466a9f;}else _0x45a7db=_0x466a9f;const _0x502313=(_0x53f14f===null||_0x53f14f===void 0x0?void 0x0:_0x53f14f['size'])||_0x1a7f8f(0xab);let _0x428973={'answer':'','fileInfo':'','status':0x2};try{const _0x2faf5f={'method':'POST','url':_0x131bb9+_0x1a7f8f(0xbc),'timeout':_0x1e6a04,'headers':{'Content-Type':_0x1a7f8f(0xca),'Authorization':'Bearer\x20'+_0x4c750b},'data':{'model':_0x3ee496,'prompt':_0x45a7db,'size':_0x502313}},_0x1ba758=await(0x0,axios_1[_0x1a7f8f(0x84)])(_0x2faf5f),_0x163c6a=_0x1ba758[_0x1a7f8f(0x9e)]['data'][0x0]['url'];try{common_1['Logger'][_0x1a7f8f(0xcf)](_0x1a7f8f(0xb2),'DrawService');const _0x518f15=new Date(),_0x510b7a=_0x518f15[_0x1a7f8f(0xbd)](),_0xa7eff9=String(_0x518f15[_0x1a7f8f(0x93)]()+0x1)[_0x1a7f8f(0xc1)](0x2,'0'),_0x52e5fd=String(_0x518f15[_0x1a7f8f(0x92)]())[_0x1a7f8f(0xc1)](0x2,'0'),_0x3b8c5a=''+_0x510b7a+_0xa7eff9+'/'+_0x52e5fd;_0x428973[_0x1a7f8f(0xbb)]=await this['uploadService'][_0x1a7f8f(0xb6)]({'url':_0x163c6a,'dir':_0x1a7f8f(0xc4)+_0x3b8c5a}),common_1[_0x1a7f8f(0xc7)][_0x1a7f8f(0xcf)](_0x1a7f8f(0x88)+_0x428973[_0x1a7f8f(0xbb)],'DrawService');}catch(_0x3a3fa7){common_1[_0x1a7f8f(0xc7)][_0x1a7f8f(0xc9)]('上传图片过程中出现错误:\x20'+_0x3a3fa7,_0x1a7f8f(0x8f));}let _0x448040;try{_0x448040=await this[_0x1a7f8f(0x8b)][_0x1a7f8f(0x89)](_0x1a7f8f(0x98)+_0x1ba758['data'][_0x1a7f8f(0x9e)][0x0][_0x1a7f8f(0xa2)]+_0x1a7f8f(0xc6));}catch(_0x40d3be){_0x448040=_0x466a9f+_0x1a7f8f(0xb9),common_1[_0x1a7f8f(0xc7)][_0x1a7f8f(0xc9)](_0x1a7f8f(0x9c),_0x40d3be);}_0x428973['answer']=_0x448040,_0x428973[_0x1a7f8f(0x9f)]=0x3,_0x5d6061(_0x428973);return;}catch(_0x1cb968){_0x428973[_0x1a7f8f(0x9f)]=0x5,_0xd686(_0x428973);const _0x479938=((_0x16d28a=_0x1cb968===null||_0x1cb968===void 0x0?void 0x0:_0x1cb968[_0x1a7f8f(0xa3)])===null||_0x16d28a===void 0x0?void 0x0:_0x16d28a[_0x1a7f8f(0x9f)])||0x1f4;console[_0x1a7f8f(0xcf)](_0x1a7f8f(0x86),JSON[_0x1a7f8f(0xb4)](_0x1cb968),_0x479938);const _0x3e52e7=(_0x25b31b=(_0x397cce=(_0x5b57fe=_0x1cb968===null||_0x1cb968===void 0x0?void 0x0:_0x1cb968[_0x1a7f8f(0xa3)])===null||_0x5b57fe===void 0x0?void 0x0:_0x5b57fe[_0x1a7f8f(0x9e)])===null||_0x397cce===void 0x0?void 0x0:_0x397cce[_0x1a7f8f(0xc9)])===null||_0x25b31b===void 0x0?void 0x0:_0x25b31b['message'];if(_0x479938===0x1ad)return _0x428973[_0x1a7f8f(0xcb)]=_0x1a7f8f(0xbe),_0x428973;if(_0x479938===0x190&&_0x3e52e7[_0x1a7f8f(0xaf)](_0x1a7f8f(0xd1)))return _0x428973['text']='您的请求已被系统拒绝。您的提示可能存在一些非法的文本。',_0x428973;if(_0x479938===0x190&&_0x3e52e7[_0x1a7f8f(0xaf)](_0x1a7f8f(0xa0)))return _0x428973[_0x1a7f8f(0xcb)]=_0x1a7f8f(0xc2),_0x428973;if(_0x479938===0x1f4)return _0x428973['text']=_0x1a7f8f(0x91),_0x428973;if(_0x479938===0x191)return _0x428973[_0x1a7f8f(0xcb)]=_0x1a7f8f(0x83),_0x428973;return _0x428973[_0x1a7f8f(0xcb)]=_0x1a7f8f(0x82),_0x428973;}}};OpenAIDrawService=OpenAIDrawService_1=__decorate([(0x0,common_1[_0x29ec76(0xae)])(),__metadata('design:paramtypes',[upload_service_1[_0x29ec76(0x96)],globalConfig_service_1[_0x29ec76(0x9b)],chatLog_service_1['ChatLogService'],openaiChat_service_1[_0x29ec76(0xb8)]])],OpenAIDrawService),exports[_0x29ec76(0xb0)]=OpenAIDrawService;