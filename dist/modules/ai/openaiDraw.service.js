'use strict';const _0x56a6db=_0x44ac;(function(_0x33a8d4,_0x594ae4){const _0x5bd727=_0x44ac,_0x102d4a=_0x33a8d4();while(!![]){try{const _0x27fe5e=-parseInt(_0x5bd727(0x154))/0x1+-parseInt(_0x5bd727(0x133))/0x2*(-parseInt(_0x5bd727(0x151))/0x3)+parseInt(_0x5bd727(0x14e))/0x4*(parseInt(_0x5bd727(0x157))/0x5)+-parseInt(_0x5bd727(0x125))/0x6*(-parseInt(_0x5bd727(0x14c))/0x7)+-parseInt(_0x5bd727(0x165))/0x8+-parseInt(_0x5bd727(0x13e))/0x9*(-parseInt(_0x5bd727(0x152))/0xa)+parseInt(_0x5bd727(0x15b))/0xb*(-parseInt(_0x5bd727(0x13a))/0xc);if(_0x27fe5e===_0x594ae4)break;else _0x102d4a['push'](_0x102d4a['shift']());}catch(_0x3ef895){_0x102d4a['push'](_0x102d4a['shift']());}}}(_0x5a5c,0x4a4ff));function _0x44ac(_0x4799b2,_0x26b27c){const _0x5a5c2f=_0x5a5c();return _0x44ac=function(_0x44acb8,_0x1438ea){_0x44acb8=_0x44acb8-0x122;let _0x456f47=_0x5a5c2f[_0x44acb8];return _0x456f47;},_0x44ac(_0x4799b2,_0x26b27c);}function _0x5a5c(){const _0x29d75e=['DalleDraw','design:paramtypes','status','__metadata','../globalConfig/globalConfig.service','您的请求已被系统拒绝。您的提示可能存在一些非法的文本。','当前请求已过载、请稍等会儿再试试吧！','Logger','../upload/upload.service','UploadService','globalConfigService','/v1/images/generations','226891XYDCud','message','499164AWblna','DrawService','dalleDraw','573mjmEkq','750lRWsZr','data','16812isvcWd','stringify','上传图片过程中出现错误:\x20','20pNEOyZ','根据提示词{','OpenAIChatService','text','11wCaLOY','你是一个绘画提示词生成工具，请根据用户的要求，结合上下文，用一段文字，描述用户需要的绘画需求，不用包含任何礼貌性的寒暄,只需要场景的描述,可以适当联想','绘制图片失败，请稍后试试吧！','response','------>\x20开始上传图片！！！','chatFree','调用chatFree失败：','object','metadata','answer','3944616OUTvWI','chatLogService','This\x20request\x20has\x20been\x20blocked\x20by\x20our\x20content\x20filters','length','padStart','},\x20模拟AI绘画机器人的语气，用中文回复，告诉用户已经画好了','application/json','1024x1024','78gqJAQJ','../chatLog/chatLog.service','openAIChatService','./openaiChat.service','fileInfo','uploadFileFromUrl','Bearer\x20','__decorate','function','uploadService','log','OpenAIDrawService','开始提交\x20Dalle\x20绘图任务\x20','当前模型key已被封禁、已冻结当前调用Key、尝试重新对话试试吧！','4468huyVhA','图片上传成功，URL:\x20','error','getFullYear','\x20绘制成功','参考上文，结合我的需求，给出绘画描述。我的需求是：','已开启连续绘画模式','12581160eAIezs','绘制图片失败，请检查你的提示词是否有非法描述！','__esModule','decorate','61857AKdjBk','翻译失败:\x20'];_0x5a5c=function(){return _0x29d75e;};return _0x5a5c();}var __decorate=this&&this[_0x56a6db(0x12c)]||function(_0x51b934,_0x550b6d,_0x547bc8,_0x3910ca){const _0x2ce432=_0x56a6db;var _0x426202=arguments[_0x2ce432(0x168)],_0x1bd289=_0x426202<0x3?_0x550b6d:_0x3910ca===null?_0x3910ca=Object['getOwnPropertyDescriptor'](_0x550b6d,_0x547bc8):_0x3910ca,_0x53f227;if(typeof Reflect===_0x2ce432(0x162)&&typeof Reflect[_0x2ce432(0x13d)]===_0x2ce432(0x12d))_0x1bd289=Reflect[_0x2ce432(0x13d)](_0x51b934,_0x550b6d,_0x547bc8,_0x3910ca);else{for(var _0xd30a59=_0x51b934[_0x2ce432(0x168)]-0x1;_0xd30a59>=0x0;_0xd30a59--)if(_0x53f227=_0x51b934[_0xd30a59])_0x1bd289=(_0x426202<0x3?_0x53f227(_0x1bd289):_0x426202>0x3?_0x53f227(_0x550b6d,_0x547bc8,_0x1bd289):_0x53f227(_0x550b6d,_0x547bc8))||_0x1bd289;}return _0x426202>0x3&&_0x1bd289&&Object['defineProperty'](_0x550b6d,_0x547bc8,_0x1bd289),_0x1bd289;},__metadata=this&&this[_0x56a6db(0x143)]||function(_0xc042f4,_0x25cd84){const _0x3c5875=_0x56a6db;if(typeof Reflect==='object'&&typeof Reflect['metadata']===_0x3c5875(0x12d))return Reflect[_0x3c5875(0x163)](_0xc042f4,_0x25cd84);},OpenAIDrawService_1;Object['defineProperty'](exports,_0x56a6db(0x13c),{'value':!![]}),exports['OpenAIDrawService']=void 0x0;const common_1=require('@nestjs/common'),axios_1=require('axios'),chatLog_service_1=require(_0x56a6db(0x126)),globalConfig_service_1=require(_0x56a6db(0x144)),upload_service_1=require(_0x56a6db(0x148)),openaiChat_service_1=require(_0x56a6db(0x128));let OpenAIDrawService=OpenAIDrawService_1=class OpenAIDrawService{constructor(_0x4532d0,_0x5c375a,_0x2fa999,_0xeea04d){const _0x907e91=_0x56a6db;this[_0x907e91(0x12e)]=_0x4532d0,this[_0x907e91(0x14a)]=_0x5c375a,this[_0x907e91(0x166)]=_0x2fa999,this[_0x907e91(0x127)]=_0xeea04d,this['logger']=new common_1[(_0x907e91(0x147))](OpenAIDrawService_1['name']);}async[_0x56a6db(0x150)](_0x5ce557,_0x10c53a){const _0x2f16ca=_0x56a6db;var _0x45578a,_0x2f5771,_0x7846e8,_0x3cc2c6;common_1[_0x2f16ca(0x147)][_0x2f16ca(0x12f)](_0x2f16ca(0x131),_0x2f16ca(0x14f));const {apiKey:_0x458e1d,model:_0x2383cf,proxyUrl:_0x313d49,prompt:_0x12775b,extraParam:_0x250419,timeout:_0x22eb0d,onSuccess:_0x340dca,onFailure:_0x1f3974,groupId:_0x4ae1f4}=_0x5ce557,_0x53a018=await this[_0x2f16ca(0x14a)]['getConfigs'](['isDalleChat']);let _0x510658;if(_0x53a018==='1')try{common_1['Logger'][_0x2f16ca(0x12f)](_0x2f16ca(0x139),_0x2f16ca(0x140));const {messagesHistory:_0x4cde06}=await _0x10c53a(_0x2f16ca(0x138)+_0x12775b,{'groupId':_0x4ae1f4,'systemMessage':_0x2f16ca(0x15c),'maxModelTokens':0x1f40,'maxRounds':0x5,'fileInfo':''},this[_0x2f16ca(0x166)]);_0x510658=await this[_0x2f16ca(0x127)][_0x2f16ca(0x160)](_0x12775b,undefined,_0x4cde06);}catch(_0x58c48f){console[_0x2f16ca(0x135)](_0x2f16ca(0x161),_0x58c48f),_0x510658=_0x12775b;}else _0x510658=_0x12775b;const _0x2357dc=(_0x250419===null||_0x250419===void 0x0?void 0x0:_0x250419['size'])||_0x2f16ca(0x124);let _0x5b64f6={'answer':'','fileInfo':'','status':0x2};try{const _0x1c674a={'method':'POST','url':_0x313d49+_0x2f16ca(0x14b),'timeout':_0x22eb0d,'headers':{'Content-Type':_0x2f16ca(0x123),'Authorization':_0x2f16ca(0x12b)+_0x458e1d},'data':{'model':_0x2383cf,'prompt':_0x510658,'size':_0x2357dc}},_0x1a5832=await(0x0,axios_1['default'])(_0x1c674a),_0x9727d4=_0x1a5832['data'][_0x2f16ca(0x153)][0x0]['url'];try{common_1[_0x2f16ca(0x147)][_0x2f16ca(0x12f)](_0x2f16ca(0x15f),_0x2f16ca(0x14f));const _0x57eb8a=new Date(),_0x1af12e=_0x57eb8a[_0x2f16ca(0x136)](),_0x30997c=String(_0x57eb8a['getMonth']()+0x1)[_0x2f16ca(0x169)](0x2,'0'),_0x482ea8=String(_0x57eb8a['getDate']())['padStart'](0x2,'0'),_0x45d398=''+_0x1af12e+_0x30997c+'/'+_0x482ea8;_0x5b64f6['fileInfo']=await this[_0x2f16ca(0x12e)][_0x2f16ca(0x12a)]({'url':_0x9727d4,'dir':'images/dalle/'+_0x45d398}),common_1[_0x2f16ca(0x147)][_0x2f16ca(0x12f)](_0x2f16ca(0x134)+_0x5b64f6[_0x2f16ca(0x129)],_0x2f16ca(0x14f));}catch(_0x169d19){common_1[_0x2f16ca(0x147)][_0x2f16ca(0x135)](_0x2f16ca(0x156)+_0x169d19,_0x2f16ca(0x14f));}let _0x36c631;try{_0x36c631=await this[_0x2f16ca(0x127)][_0x2f16ca(0x160)](_0x2f16ca(0x158)+_0x1a5832[_0x2f16ca(0x153)]['data'][0x0]['revised_prompt']+_0x2f16ca(0x122));}catch(_0x47641d){_0x36c631=_0x12775b+_0x2f16ca(0x137),common_1[_0x2f16ca(0x147)]['error'](_0x2f16ca(0x13f),_0x47641d);}_0x5b64f6[_0x2f16ca(0x164)]=_0x36c631,_0x5b64f6[_0x2f16ca(0x142)]=0x3,_0x340dca(_0x5b64f6);return;}catch(_0x544021){_0x5b64f6[_0x2f16ca(0x142)]=0x5,_0x1f3974(_0x5b64f6);const _0x37db3d=((_0x45578a=_0x544021===null||_0x544021===void 0x0?void 0x0:_0x544021[_0x2f16ca(0x15e)])===null||_0x45578a===void 0x0?void 0x0:_0x45578a['status'])||0x1f4;console['log']('draw\x20error:\x20',JSON[_0x2f16ca(0x155)](_0x544021),_0x37db3d);const _0x3088c5=(_0x3cc2c6=(_0x7846e8=(_0x2f5771=_0x544021===null||_0x544021===void 0x0?void 0x0:_0x544021[_0x2f16ca(0x15e)])===null||_0x2f5771===void 0x0?void 0x0:_0x2f5771['data'])===null||_0x7846e8===void 0x0?void 0x0:_0x7846e8[_0x2f16ca(0x135)])===null||_0x3cc2c6===void 0x0?void 0x0:_0x3cc2c6[_0x2f16ca(0x14d)];if(_0x37db3d===0x1ad)return _0x5b64f6[_0x2f16ca(0x15a)]=_0x2f16ca(0x146),_0x5b64f6;if(_0x37db3d===0x190&&_0x3088c5['includes'](_0x2f16ca(0x167)))return _0x5b64f6[_0x2f16ca(0x15a)]=_0x2f16ca(0x145),_0x5b64f6;if(_0x37db3d===0x190&&_0x3088c5['includes']('Billing\x20hard\x20limit\x20has\x20been\x20reached'))return _0x5b64f6[_0x2f16ca(0x15a)]=_0x2f16ca(0x132),_0x5b64f6;if(_0x37db3d===0x1f4)return _0x5b64f6[_0x2f16ca(0x15a)]=_0x2f16ca(0x13b),_0x5b64f6;if(_0x37db3d===0x191)return _0x5b64f6[_0x2f16ca(0x15a)]='绘制图片失败，此次绘画被拒绝了！',_0x5b64f6;return _0x5b64f6[_0x2f16ca(0x15a)]=_0x2f16ca(0x15d),_0x5b64f6;}}};OpenAIDrawService=OpenAIDrawService_1=__decorate([(0x0,common_1['Injectable'])(),__metadata(_0x56a6db(0x141),[upload_service_1[_0x56a6db(0x149)],globalConfig_service_1['GlobalConfigService'],chatLog_service_1['ChatLogService'],openaiChat_service_1[_0x56a6db(0x159)]])],OpenAIDrawService),exports[_0x56a6db(0x130)]=OpenAIDrawService;