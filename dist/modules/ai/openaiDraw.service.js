'use strict';const _0xb3cb0=_0x5422;function _0x38b7(){const _0x4b8d9f=['function','50HRfmyN','@nestjs/common','绘制图片失败，请检查你的提示词是否有非法描述！','getDate','Injectable','Logger','error','翻译失败:\x20','data','fileInfo','GlobalConfigService','response','上传图片过程中出现错误:\x20','Bearer\x20','images/dalle/','status','613574VCdoJB','globalConfigService','./openaiChat.service','text','},\x20模拟AI绘画机器人的语气，用中文回复，告诉用户已经画好了','当前请求已过载、请稍等会儿再试试吧！','OpenAIChatService','参考上文，结合我的需求，给出绘画描述。我的需求是：','/v1/images/generations','default','POST','3879TcLbLW','axios','answer','1694454hYiRru','__metadata','图片上传成功，URL:\x20','1962EjjqPR','当前模型key已被封禁、已冻结当前调用Key、尝试重新对话试试吧！','开始提交\x20Dalle\x20绘图任务\x20','__esModule','245144wduOra','14539cHqwcx','isDalleChat','uploadService','size','20090642rTmpLw','../chatLog/chatLog.service','\x20绘制成功','stringify','12984pxvhyj','__decorate','application/json','2Iwlckl','../globalConfig/globalConfig.service','15705990KQJkUU','DrawService','openAIChatService','metadata','draw\x20error:\x20','decorate','dalleDraw','您的请求已被系统拒绝。您的提示可能存在一些非法的文本。','../upload/upload.service','url','OpenAIDrawService','design:paramtypes','getOwnPropertyDescriptor','chatLogService','log','This\x20request\x20has\x20been\x20blocked\x20by\x20our\x20content\x20filters','getMonth','getFullYear','1024x1024','Billing\x20hard\x20limit\x20has\x20been\x20reached','length','根据提示词{','绘制图片失败，请稍后试试吧！','uploadFileFromUrl','getConfigs','padStart','object','defineProperty','chatFree'];_0x38b7=function(){return _0x4b8d9f;};return _0x38b7();}(function(_0x352360,_0x22e71a){const _0x2296d7=_0x5422,_0x4f5d6e=_0x352360();while(!![]){try{const _0x194c53=-parseInt(_0x2296d7(0xa2))/0x1+-parseInt(_0x2296d7(0x72))/0x2*(-parseInt(_0x2296d7(0xb0))/0x3)+parseInt(_0x2296d7(0xb7))/0x4*(parseInt(_0x2296d7(0x92))/0x5)+parseInt(_0x2296d7(0xb3))/0x6*(parseInt(_0x2296d7(0xb8))/0x7)+-parseInt(_0x2296d7(0xc0))/0x8*(parseInt(_0x2296d7(0xad))/0x9)+-parseInt(_0x2296d7(0x74))/0xa+parseInt(_0x2296d7(0xbc))/0xb;if(_0x194c53===_0x22e71a)break;else _0x4f5d6e['push'](_0x4f5d6e['shift']());}catch(_0x346f8f){_0x4f5d6e['push'](_0x4f5d6e['shift']());}}}(_0x38b7,0xc3369));var __decorate=this&&this[_0xb3cb0(0xc1)]||function(_0x276ba3,_0xdae396,_0x4d70f4,_0x2b48b6){const _0x268bd4=_0xb3cb0;var _0x30af85=arguments[_0x268bd4(0x88)],_0x398430=_0x30af85<0x3?_0xdae396:_0x2b48b6===null?_0x2b48b6=Object[_0x268bd4(0x80)](_0xdae396,_0x4d70f4):_0x2b48b6,_0x4e62a3;if(typeof Reflect===_0x268bd4(0x8e)&&typeof Reflect[_0x268bd4(0x79)]===_0x268bd4(0x91))_0x398430=Reflect[_0x268bd4(0x79)](_0x276ba3,_0xdae396,_0x4d70f4,_0x2b48b6);else{for(var _0x1c1271=_0x276ba3[_0x268bd4(0x88)]-0x1;_0x1c1271>=0x0;_0x1c1271--)if(_0x4e62a3=_0x276ba3[_0x1c1271])_0x398430=(_0x30af85<0x3?_0x4e62a3(_0x398430):_0x30af85>0x3?_0x4e62a3(_0xdae396,_0x4d70f4,_0x398430):_0x4e62a3(_0xdae396,_0x4d70f4))||_0x398430;}return _0x30af85>0x3&&_0x398430&&Object[_0x268bd4(0x8f)](_0xdae396,_0x4d70f4,_0x398430),_0x398430;},__metadata=this&&this[_0xb3cb0(0xb1)]||function(_0x5c8cc9,_0x2e9dfc){const _0x493b4f=_0xb3cb0;if(typeof Reflect===_0x493b4f(0x8e)&&typeof Reflect[_0x493b4f(0x77)]===_0x493b4f(0x91))return Reflect[_0x493b4f(0x77)](_0x5c8cc9,_0x2e9dfc);},OpenAIDrawService_1;function _0x5422(_0x4096be,_0x2c611e){const _0x38b776=_0x38b7();return _0x5422=function(_0x54224d,_0x4a5d67){_0x54224d=_0x54224d-0x71;let _0x999b43=_0x38b776[_0x54224d];return _0x999b43;},_0x5422(_0x4096be,_0x2c611e);}Object[_0xb3cb0(0x8f)](exports,_0xb3cb0(0xb6),{'value':!![]}),exports['OpenAIDrawService']=void 0x0;const common_1=require(_0xb3cb0(0x93)),axios_1=require(_0xb3cb0(0xae)),chatLog_service_1=require(_0xb3cb0(0xbd)),globalConfig_service_1=require(_0xb3cb0(0x73)),upload_service_1=require(_0xb3cb0(0x7c)),openaiChat_service_1=require(_0xb3cb0(0xa4));let OpenAIDrawService=OpenAIDrawService_1=class OpenAIDrawService{constructor(_0x1a2592,_0xac9676,_0x2b845e,_0x20416c){const _0x1dabe3=_0xb3cb0;this[_0x1dabe3(0xba)]=_0x1a2592,this[_0x1dabe3(0xa3)]=_0xac9676,this[_0x1dabe3(0x81)]=_0x2b845e,this[_0x1dabe3(0x76)]=_0x20416c,this['logger']=new common_1[(_0x1dabe3(0x97))](OpenAIDrawService_1['name']);}async[_0xb3cb0(0x7a)](_0x2d1226,_0x34534d){const _0x253b91=_0xb3cb0;var _0x363f47,_0x17b706,_0x2da2f0,_0x39bcd5;common_1['Logger'][_0x253b91(0x82)](_0x253b91(0xb5),'DrawService');const {apiKey:_0x604623,model:_0x5c0595,proxyUrl:_0x506117,prompt:_0x24543f,extraParam:_0x3b1ce0,timeout:_0x5808b3,onSuccess:_0x89ba23,onFailure:_0x2877a5,groupId:_0x150697}=_0x2d1226,_0x4ad3fe=await this['globalConfigService'][_0x253b91(0x8c)]([_0x253b91(0xb9)]);let _0x363845;if(_0x4ad3fe==='1')try{common_1['Logger'][_0x253b91(0x82)]('已开启连续绘画模式','DalleDraw');const {messagesHistory:_0x70e5fe}=await _0x34534d(_0x253b91(0xa9)+_0x24543f,{'groupId':_0x150697,'systemMessage':'你是一个绘画提示词生成工具，请根据用户的要求，结合上下文，用一段文字，描述用户需要的绘画需求，不用包含任何礼貌性的寒暄,只需要场景的描述,可以适当联想','maxModelTokens':0x1f40,'maxRounds':0x5,'fileInfo':''},this[_0x253b91(0x81)]);_0x363845=await this[_0x253b91(0x76)][_0x253b91(0x90)](_0x24543f,undefined,_0x70e5fe);}catch(_0xdb2fda){console['error']('调用chatFree失败：',_0xdb2fda),_0x363845=_0x24543f;}else _0x363845=_0x24543f;const _0x4b4b29=(_0x3b1ce0===null||_0x3b1ce0===void 0x0?void 0x0:_0x3b1ce0[_0x253b91(0xbb)])||_0x253b91(0x86);let _0x52b085={'answer':'','fileInfo':'','status':0x2};try{const _0x1b2591={'method':_0x253b91(0xac),'url':_0x506117+_0x253b91(0xaa),'timeout':_0x5808b3,'headers':{'Content-Type':_0x253b91(0x71),'Authorization':_0x253b91(0x9f)+_0x604623},'data':{'model':_0x5c0595,'prompt':_0x363845,'size':_0x4b4b29}},_0xb13d3a=await(0x0,axios_1[_0x253b91(0xab)])(_0x1b2591),_0x4cd746=_0xb13d3a[_0x253b91(0x9a)][_0x253b91(0x9a)][0x0][_0x253b91(0x7d)];try{common_1['Logger']['log']('------>\x20开始上传图片！！！',_0x253b91(0x75));const _0x309868=new Date(),_0x5495e5=_0x309868[_0x253b91(0x85)](),_0x49edab=String(_0x309868[_0x253b91(0x84)]()+0x1)[_0x253b91(0x8d)](0x2,'0'),_0x285e99=String(_0x309868[_0x253b91(0x95)]())[_0x253b91(0x8d)](0x2,'0'),_0x5bc27c=''+_0x5495e5+_0x49edab+'/'+_0x285e99;_0x52b085[_0x253b91(0x9b)]=await this[_0x253b91(0xba)][_0x253b91(0x8b)]({'url':_0x4cd746,'dir':_0x253b91(0xa0)+_0x5bc27c}),common_1['Logger']['log'](_0x253b91(0xb2)+_0x52b085[_0x253b91(0x9b)],_0x253b91(0x75));}catch(_0x3a6034){common_1['Logger']['error'](_0x253b91(0x9e)+_0x3a6034,_0x253b91(0x75));}let _0x5f5500;try{_0x5f5500=await this[_0x253b91(0x76)]['chatFree'](_0x253b91(0x89)+_0xb13d3a['data'][_0x253b91(0x9a)][0x0]['revised_prompt']+_0x253b91(0xa6));}catch(_0x112e00){_0x5f5500=_0x24543f+_0x253b91(0xbe),common_1[_0x253b91(0x97)][_0x253b91(0x98)](_0x253b91(0x99),_0x112e00);}_0x52b085[_0x253b91(0xaf)]=_0x5f5500,_0x52b085[_0x253b91(0xa1)]=0x3,_0x89ba23(_0x52b085);return;}catch(_0x16ce8e){_0x52b085['status']=0x5,_0x2877a5(_0x52b085);const _0x1f6899=((_0x363f47=_0x16ce8e===null||_0x16ce8e===void 0x0?void 0x0:_0x16ce8e[_0x253b91(0x9d)])===null||_0x363f47===void 0x0?void 0x0:_0x363f47['status'])||0x1f4;console['log'](_0x253b91(0x78),JSON[_0x253b91(0xbf)](_0x16ce8e),_0x1f6899);const _0x290b6a=(_0x39bcd5=(_0x2da2f0=(_0x17b706=_0x16ce8e===null||_0x16ce8e===void 0x0?void 0x0:_0x16ce8e[_0x253b91(0x9d)])===null||_0x17b706===void 0x0?void 0x0:_0x17b706[_0x253b91(0x9a)])===null||_0x2da2f0===void 0x0?void 0x0:_0x2da2f0[_0x253b91(0x98)])===null||_0x39bcd5===void 0x0?void 0x0:_0x39bcd5['message'];if(_0x1f6899===0x1ad)return _0x52b085[_0x253b91(0xa5)]=_0x253b91(0xa7),_0x52b085;if(_0x1f6899===0x190&&_0x290b6a['includes'](_0x253b91(0x83)))return _0x52b085[_0x253b91(0xa5)]=_0x253b91(0x7b),_0x52b085;if(_0x1f6899===0x190&&_0x290b6a['includes'](_0x253b91(0x87)))return _0x52b085[_0x253b91(0xa5)]=_0x253b91(0xb4),_0x52b085;if(_0x1f6899===0x1f4)return _0x52b085[_0x253b91(0xa5)]=_0x253b91(0x94),_0x52b085;if(_0x1f6899===0x191)return _0x52b085['text']='绘制图片失败，此次绘画被拒绝了！',_0x52b085;return _0x52b085[_0x253b91(0xa5)]=_0x253b91(0x8a),_0x52b085;}}};OpenAIDrawService=OpenAIDrawService_1=__decorate([(0x0,common_1[_0xb3cb0(0x96)])(),__metadata(_0xb3cb0(0x7f),[upload_service_1['UploadService'],globalConfig_service_1[_0xb3cb0(0x9c)],chatLog_service_1['ChatLogService'],openaiChat_service_1[_0xb3cb0(0xa8)]])],OpenAIDrawService),exports[_0xb3cb0(0x7e)]=OpenAIDrawService;