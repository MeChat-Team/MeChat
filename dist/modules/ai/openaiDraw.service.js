'use strict';const _0x6cb4a8=_0x4984;(function(_0x4f134f,_0x427b1a){const _0x257338=_0x4984,_0x3e05e1=_0x4f134f();while(!![]){try{const _0x263492=parseInt(_0x257338(0x153))/0x1+-parseInt(_0x257338(0x15c))/0x2+parseInt(_0x257338(0x159))/0x3+parseInt(_0x257338(0x129))/0x4*(parseInt(_0x257338(0x12c))/0x5)+-parseInt(_0x257338(0x149))/0x6*(-parseInt(_0x257338(0x15e))/0x7)+-parseInt(_0x257338(0x157))/0x8+-parseInt(_0x257338(0x11c))/0x9*(-parseInt(_0x257338(0x11f))/0xa);if(_0x263492===_0x427b1a)break;else _0x3e05e1['push'](_0x3e05e1['shift']());}catch(_0x3ea117){_0x3e05e1['push'](_0x3e05e1['shift']());}}}(_0x32bb,0x87f66));function _0x4984(_0x5ddfde,_0x4805e4){const _0x32bbd6=_0x32bb();return _0x4984=function(_0x498495,_0x1bbc76){_0x498495=_0x498495-0x113;let _0x3cdf99=_0x32bbd6[_0x498495];return _0x3cdf99;},_0x4984(_0x5ddfde,_0x4805e4);}var __decorate=this&&this[_0x6cb4a8(0x121)]||function(_0x595aaa,_0x362b20,_0x2700a8,_0x4d2662){const _0x3d86c0=_0x6cb4a8;var _0xc9f8b1=arguments[_0x3d86c0(0x122)],_0x110351=_0xc9f8b1<0x3?_0x362b20:_0x4d2662===null?_0x4d2662=Object['getOwnPropertyDescriptor'](_0x362b20,_0x2700a8):_0x4d2662,_0x744e69;if(typeof Reflect===_0x3d86c0(0x154)&&typeof Reflect[_0x3d86c0(0x14d)]==='function')_0x110351=Reflect[_0x3d86c0(0x14d)](_0x595aaa,_0x362b20,_0x2700a8,_0x4d2662);else{for(var _0x758860=_0x595aaa[_0x3d86c0(0x122)]-0x1;_0x758860>=0x0;_0x758860--)if(_0x744e69=_0x595aaa[_0x758860])_0x110351=(_0xc9f8b1<0x3?_0x744e69(_0x110351):_0xc9f8b1>0x3?_0x744e69(_0x362b20,_0x2700a8,_0x110351):_0x744e69(_0x362b20,_0x2700a8))||_0x110351;}return _0xc9f8b1>0x3&&_0x110351&&Object['defineProperty'](_0x362b20,_0x2700a8,_0x110351),_0x110351;},__metadata=this&&this[_0x6cb4a8(0x150)]||function(_0x35d1c8,_0x577466){const _0x162755=_0x6cb4a8;if(typeof Reflect===_0x162755(0x154)&&typeof Reflect[_0x162755(0x15d)]===_0x162755(0x14f))return Reflect['metadata'](_0x35d1c8,_0x577466);},OpenAIDrawService_1;Object[_0x6cb4a8(0x139)](exports,'__esModule',{'value':!![]}),exports['OpenAIDrawService']=void 0x0;const common_1=require('@nestjs/common'),axios_1=require('axios'),chatLog_service_1=require(_0x6cb4a8(0x156)),globalConfig_service_1=require(_0x6cb4a8(0x12a)),upload_service_1=require('../upload/upload.service'),openaiChat_service_1=require('./openaiChat.service');let OpenAIDrawService=OpenAIDrawService_1=class OpenAIDrawService{constructor(_0x37b862,_0x2f3cd8,_0x565ec7,_0x46c956){const _0x5567fd=_0x6cb4a8;this['uploadService']=_0x37b862,this['globalConfigService']=_0x2f3cd8,this[_0x5567fd(0x124)]=_0x565ec7,this[_0x5567fd(0x155)]=_0x46c956,this[_0x5567fd(0x158)]=new common_1[(_0x5567fd(0x148))](OpenAIDrawService_1[_0x5567fd(0x128)]);}async[_0x6cb4a8(0x136)](_0x1b343e,_0x5476e0){const _0x5e2ae4=_0x6cb4a8;var _0x43baae,_0x249366,_0x4395b9,_0x20569e;common_1[_0x5e2ae4(0x148)][_0x5e2ae4(0x12b)](_0x5e2ae4(0x11b),_0x5e2ae4(0x115));const {apiKey:_0xf9b102,model:_0x4f3a2f,proxyUrl:_0x5eaa4c,prompt:_0x272cd6,extraParam:_0xaee8bf,timeout:_0x37102a,onSuccess:_0x1fdc80,onFailure:_0x15983c,groupId:_0x350511}=_0x1b343e,_0x54c365=await this[_0x5e2ae4(0x142)][_0x5e2ae4(0x11e)]([_0x5e2ae4(0x144)]);let _0x3ad762;if(_0x54c365==='1')try{common_1[_0x5e2ae4(0x148)][_0x5e2ae4(0x12b)](_0x5e2ae4(0x145),_0x5e2ae4(0x140));const {messagesHistory:_0x23c421}=await _0x5476e0(_0x5e2ae4(0x141)+_0x272cd6,{'groupId':_0x350511,'systemMessage':_0x5e2ae4(0x151),'maxModelTokens':0x1f40,'maxRounds':0x5,'fileInfo':''},this['chatLogService']);_0x3ad762=await this['openAIChatService'][_0x5e2ae4(0x131)](_0x272cd6,undefined,_0x23c421);}catch(_0x498bfb){console[_0x5e2ae4(0x13d)](_0x5e2ae4(0x13f),_0x498bfb),_0x3ad762=_0x272cd6;}else _0x3ad762=_0x272cd6;const _0x4dc74f=(_0xaee8bf===null||_0xaee8bf===void 0x0?void 0x0:_0xaee8bf['size'])||'1024x1024';let _0x5363da={'answer':'','fileInfo':'','status':0x2};try{const _0x536e46={'method':_0x5e2ae4(0x152),'url':_0x5eaa4c+'/v1/images/generations','timeout':_0x37102a,'headers':{'Content-Type':_0x5e2ae4(0x138),'Authorization':_0x5e2ae4(0x119)+_0xf9b102},'data':{'model':_0x4f3a2f,'prompt':_0x3ad762,'size':_0x4dc74f}},_0x4c0b10=await(0x0,axios_1['default'])(_0x536e46),_0x2c778e=_0x4c0b10[_0x5e2ae4(0x137)]['data'][0x0][_0x5e2ae4(0x133)];try{common_1['Logger'][_0x5e2ae4(0x12b)](_0x5e2ae4(0x116),_0x5e2ae4(0x115));const _0x14bae6=new Date(),_0x302d38=_0x14bae6[_0x5e2ae4(0x127)](),_0x4f2d0e=String(_0x14bae6[_0x5e2ae4(0x11a)]()+0x1)['padStart'](0x2,'0'),_0xcead00=String(_0x14bae6[_0x5e2ae4(0x130)]())[_0x5e2ae4(0x15f)](0x2,'0'),_0x90c7f1=''+_0x302d38+_0x4f2d0e+'/'+_0xcead00;_0x5363da['fileInfo']=await this[_0x5e2ae4(0x123)][_0x5e2ae4(0x126)]({'url':_0x2c778e,'dir':'images/dalle/'+_0x90c7f1}),common_1[_0x5e2ae4(0x148)][_0x5e2ae4(0x12b)](_0x5e2ae4(0x134)+_0x5363da['fileInfo'],_0x5e2ae4(0x115));}catch(_0x2dd1ff){common_1[_0x5e2ae4(0x148)][_0x5e2ae4(0x13d)](_0x5e2ae4(0x13a)+_0x2dd1ff,_0x5e2ae4(0x115));}let _0x3d7a06;try{_0x3d7a06=await this['openAIChatService'][_0x5e2ae4(0x131)](_0x5e2ae4(0x14e)+_0x4c0b10[_0x5e2ae4(0x137)][_0x5e2ae4(0x137)][0x0][_0x5e2ae4(0x117)]+_0x5e2ae4(0x14a));}catch(_0x59c375){_0x3d7a06=_0x272cd6+_0x5e2ae4(0x147),common_1[_0x5e2ae4(0x148)][_0x5e2ae4(0x13d)](_0x5e2ae4(0x143),_0x59c375);}_0x5363da['answer']=_0x3d7a06,_0x5363da['status']=0x3,_0x1fdc80(_0x5363da);return;}catch(_0x1867de){_0x5363da[_0x5e2ae4(0x113)]=0x5,_0x15983c(_0x5363da);const _0x4b5a83=((_0x43baae=_0x1867de===null||_0x1867de===void 0x0?void 0x0:_0x1867de[_0x5e2ae4(0x146)])===null||_0x43baae===void 0x0?void 0x0:_0x43baae['status'])||0x1f4;console['log'](_0x5e2ae4(0x13b),JSON[_0x5e2ae4(0x135)](_0x1867de),_0x4b5a83);const _0x1d78d2=(_0x20569e=(_0x4395b9=(_0x249366=_0x1867de===null||_0x1867de===void 0x0?void 0x0:_0x1867de[_0x5e2ae4(0x146)])===null||_0x249366===void 0x0?void 0x0:_0x249366[_0x5e2ae4(0x137)])===null||_0x4395b9===void 0x0?void 0x0:_0x4395b9[_0x5e2ae4(0x13d)])===null||_0x20569e===void 0x0?void 0x0:_0x20569e['message'];if(_0x4b5a83===0x1ad)return _0x5363da[_0x5e2ae4(0x14b)]=_0x5e2ae4(0x14c),_0x5363da;if(_0x4b5a83===0x190&&_0x1d78d2[_0x5e2ae4(0x13e)](_0x5e2ae4(0x114)))return _0x5363da[_0x5e2ae4(0x14b)]='您的请求已被系统拒绝。您的提示可能存在一些非法的文本。',_0x5363da;if(_0x4b5a83===0x190&&_0x1d78d2['includes'](_0x5e2ae4(0x12f)))return _0x5363da[_0x5e2ae4(0x14b)]=_0x5e2ae4(0x13c),_0x5363da;if(_0x4b5a83===0x1f4)return _0x5363da[_0x5e2ae4(0x14b)]=_0x5e2ae4(0x120),_0x5363da;if(_0x4b5a83===0x191)return _0x5363da[_0x5e2ae4(0x14b)]=_0x5e2ae4(0x11d),_0x5363da;return _0x5363da[_0x5e2ae4(0x14b)]=_0x5e2ae4(0x12e),_0x5363da;}}};OpenAIDrawService=OpenAIDrawService_1=__decorate([(0x0,common_1[_0x6cb4a8(0x125)])(),__metadata(_0x6cb4a8(0x118),[upload_service_1[_0x6cb4a8(0x132)],globalConfig_service_1[_0x6cb4a8(0x12d)],chatLog_service_1['ChatLogService'],openaiChat_service_1[_0x6cb4a8(0x15b)]])],OpenAIDrawService),exports[_0x6cb4a8(0x15a)]=OpenAIDrawService;function _0x32bb(){const _0x575a3b=['openAIChatService','../chatLog/chatLog.service','6607432ZChoxu','logger','825144vowPiO','OpenAIDrawService','OpenAIChatService','875556MeLoeh','metadata','6380570rMyfCY','padStart','status','This\x20request\x20has\x20been\x20blocked\x20by\x20our\x20content\x20filters','DrawService','------>\x20开始上传图片！！！','revised_prompt','design:paramtypes','Bearer\x20','getMonth','开始提交\x20Dalle\x20绘图任务\x20','136170LILdMO','绘制图片失败，此次绘画被拒绝了！','getConfigs','20eSOVoP','绘制图片失败，请检查你的提示词是否有非法描述！','__decorate','length','uploadService','chatLogService','Injectable','uploadFileFromUrl','getFullYear','name','340580pAmuui','../globalConfig/globalConfig.service','log','20VdyClQ','GlobalConfigService','绘制图片失败，请稍后试试吧！','Billing\x20hard\x20limit\x20has\x20been\x20reached','getDate','chatFree','UploadService','url','图片上传成功，URL:\x20','stringify','dalleDraw','data','application/json','defineProperty','上传图片过程中出现错误:\x20','draw\x20error:\x20','当前模型key已被封禁、已冻结当前调用Key、尝试重新对话试试吧！','error','includes','调用chatFree失败：','DalleDraw','参考上文，结合我的需求，给出绘画描述。我的需求是：','globalConfigService','翻译失败:\x20','isDalleChat','已开启连续绘画模式','response','\x20绘制成功','Logger','6vMDsfF','},\x20模拟AI绘画机器人的语气，用中文回复，告诉用户已经画好了','text','当前请求已过载、请稍等会儿再试试吧！','decorate','根据提示词{','function','__metadata','你是一个绘画提示词生成工具，请根据用户的要求，结合上下文，用一段文字，描述用户需要的绘画需求，不用包含任何礼貌性的寒暄,只需要场景的描述,可以适当联想','POST','263211qYCNPB','object'];_0x32bb=function(){return _0x575a3b;};return _0x32bb();}