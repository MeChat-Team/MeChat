'use strict';const _0x36644f=_0x29e7;(function(_0x529fd7,_0x53a860){const _0x1bc314=_0x29e7,_0x4118c1=_0x529fd7();while(!![]){try{const _0x8b486b=-parseInt(_0x1bc314(0xdc))/0x1+-parseInt(_0x1bc314(0xd0))/0x2*(parseInt(_0x1bc314(0xd9))/0x3)+-parseInt(_0x1bc314(0xcf))/0x4*(parseInt(_0x1bc314(0xf0))/0x5)+-parseInt(_0x1bc314(0xca))/0x6+parseInt(_0x1bc314(0xb8))/0x7+parseInt(_0x1bc314(0xc4))/0x8*(-parseInt(_0x1bc314(0xeb))/0x9)+parseInt(_0x1bc314(0xcd))/0xa*(parseInt(_0x1bc314(0xfa))/0xb);if(_0x8b486b===_0x53a860)break;else _0x4118c1['push'](_0x4118c1['shift']());}catch(_0x647460){_0x4118c1['push'](_0x4118c1['shift']());}}}(_0x53bd,0x1ee37));function _0x29e7(_0x4a243d,_0x245d27){const _0x53bd13=_0x53bd();return _0x29e7=function(_0x29e7c4,_0x478bbb){_0x29e7c4=_0x29e7c4-0xb5;let _0x726287=_0x53bd13[_0x29e7c4];return _0x726287;},_0x29e7(_0x4a243d,_0x245d27);}var __decorate=this&&this[_0x36644f(0xfe)]||function(_0x478468,_0x1ae0ed,_0x2760db,_0x37008b){const _0x4c92e8=_0x36644f;var _0x95b6e=arguments[_0x4c92e8(0x101)],_0x4f2b05=_0x95b6e<0x3?_0x1ae0ed:_0x37008b===null?_0x37008b=Object[_0x4c92e8(0xde)](_0x1ae0ed,_0x2760db):_0x37008b,_0x32b79d;if(typeof Reflect===_0x4c92e8(0xe7)&&typeof Reflect[_0x4c92e8(0xe5)]===_0x4c92e8(0xfd))_0x4f2b05=Reflect[_0x4c92e8(0xe5)](_0x478468,_0x1ae0ed,_0x2760db,_0x37008b);else{for(var _0x351941=_0x478468[_0x4c92e8(0x101)]-0x1;_0x351941>=0x0;_0x351941--)if(_0x32b79d=_0x478468[_0x351941])_0x4f2b05=(_0x95b6e<0x3?_0x32b79d(_0x4f2b05):_0x95b6e>0x3?_0x32b79d(_0x1ae0ed,_0x2760db,_0x4f2b05):_0x32b79d(_0x1ae0ed,_0x2760db))||_0x4f2b05;}return _0x95b6e>0x3&&_0x4f2b05&&Object[_0x4c92e8(0xd2)](_0x1ae0ed,_0x2760db,_0x4f2b05),_0x4f2b05;},__metadata=this&&this[_0x36644f(0xc5)]||function(_0x2f2b73,_0xb7fcf3){const _0x3ced95=_0x36644f;if(typeof Reflect===_0x3ced95(0xe7)&&typeof Reflect[_0x3ced95(0xb5)]===_0x3ced95(0xfd))return Reflect[_0x3ced95(0xb5)](_0x2f2b73,_0xb7fcf3);},OpenAIDrawService_1;Object[_0x36644f(0xd2)](exports,_0x36644f(0xfb),{'value':!![]}),exports['OpenAIDrawService']=void 0x0;const common_1=require(_0x36644f(0xc6)),axios_1=require(_0x36644f(0xd6)),chatLog_service_1=require(_0x36644f(0xce)),globalConfig_service_1=require(_0x36644f(0xda)),upload_service_1=require(_0x36644f(0xe9)),openaiChat_service_1=require(_0x36644f(0xd1));let OpenAIDrawService=OpenAIDrawService_1=class OpenAIDrawService{constructor(_0x483b04,_0x1f62c5,_0x531b3e,_0x3c88bd){const _0x369551=_0x36644f;this[_0x369551(0xb7)]=_0x483b04,this['globalConfigService']=_0x1f62c5,this[_0x369551(0xbc)]=_0x531b3e,this['openAIChatService']=_0x3c88bd,this['logger']=new common_1['Logger'](OpenAIDrawService_1[_0x369551(0xf8)]);}async['dalleDraw'](_0xbfaa78,_0x4477f8){const _0x1ea6b4=_0x36644f;var _0x2203c6,_0x276d49,_0x138670,_0x4646b0;common_1[_0x1ea6b4(0xe8)][_0x1ea6b4(0xf5)](_0x1ea6b4(0xcc),_0x1ea6b4(0xdb));const {apiKey:_0x4e44c2,model:_0x4faadb,proxyUrl:_0x4c6e17,prompt:_0x26d588,extraParam:_0x132c58,timeout:_0x3c1961,onSuccess:_0x2b8633,onFailure:_0x1f0061,groupId:_0x214598}=_0xbfaa78,_0x41560e=await this[_0x1ea6b4(0xe6)][_0x1ea6b4(0xc8)](['isDalleChat']);let _0x32a085;if(_0x41560e==='1')try{common_1[_0x1ea6b4(0xe8)][_0x1ea6b4(0xf5)]('已开启连续绘画模式',_0x1ea6b4(0xea));const {messagesHistory:_0x462946}=await _0x4477f8('参考上文，结合我的需求，给出绘画描述。我的需求是：'+_0x26d588,{'groupId':_0x214598,'systemMessage':_0x1ea6b4(0xfc),'maxModelTokens':0x1f40,'maxRounds':0x5,'fileInfo':''},this['chatLogService']);_0x32a085=await this['openAIChatService']['chatFree'](_0x26d588,undefined,_0x462946);}catch(_0x1a28d7){console['error'](_0x1ea6b4(0xf1),_0x1a28d7),_0x32a085=_0x26d588;}else _0x32a085=_0x26d588;const _0x2fee03=(_0x132c58===null||_0x132c58===void 0x0?void 0x0:_0x132c58['size'])||'1024x1024';let _0x42d196={'answer':'','fileInfo':'','status':0x2};try{const _0x23e5e0={'method':'POST','url':_0x4c6e17+_0x1ea6b4(0xc2),'timeout':_0x3c1961,'headers':{'Content-Type':_0x1ea6b4(0xff),'Authorization':_0x1ea6b4(0xc9)+_0x4e44c2},'data':{'model':_0x4faadb,'prompt':_0x32a085,'size':_0x2fee03}},_0x26f807=await(0x0,axios_1[_0x1ea6b4(0xc3)])(_0x23e5e0),_0x3af379=_0x26f807[_0x1ea6b4(0xf9)]['data'][0x0][_0x1ea6b4(0xb6)];try{common_1[_0x1ea6b4(0xe8)][_0x1ea6b4(0xf5)](_0x1ea6b4(0xba),_0x1ea6b4(0xdb));const _0x58a3c8=new Date(),_0x4eb360=_0x58a3c8[_0x1ea6b4(0xd3)](),_0x370b4b=String(_0x58a3c8['getMonth']()+0x1)[_0x1ea6b4(0xcb)](0x2,'0'),_0x3bb8c9=String(_0x58a3c8[_0x1ea6b4(0xf6)]())[_0x1ea6b4(0xcb)](0x2,'0'),_0x55c033=''+_0x4eb360+_0x370b4b+'/'+_0x3bb8c9;_0x42d196[_0x1ea6b4(0xe1)]=await this[_0x1ea6b4(0xb7)][_0x1ea6b4(0xd5)]({'url':_0x3af379,'dir':_0x1ea6b4(0xed)+_0x55c033}),common_1[_0x1ea6b4(0xe8)][_0x1ea6b4(0xf5)](_0x1ea6b4(0xd4)+_0x42d196['fileInfo'],'DrawService');}catch(_0x4f08d6){common_1[_0x1ea6b4(0xe8)][_0x1ea6b4(0xf3)](_0x1ea6b4(0xbd)+_0x4f08d6,_0x1ea6b4(0xdb));}let _0x3a4f39;try{_0x3a4f39=await this[_0x1ea6b4(0xb9)][_0x1ea6b4(0xe0)]('根据提示词{'+_0x26f807[_0x1ea6b4(0xf9)][_0x1ea6b4(0xf9)][0x0][_0x1ea6b4(0xdd)]+_0x1ea6b4(0xf7));}catch(_0x5cc22e){_0x3a4f39=_0x26d588+_0x1ea6b4(0xc1),common_1[_0x1ea6b4(0xe8)]['error'](_0x1ea6b4(0xbb),_0x5cc22e);}_0x42d196[_0x1ea6b4(0xee)]=_0x3a4f39,_0x42d196[_0x1ea6b4(0xd8)]=0x3,_0x2b8633(_0x42d196);return;}catch(_0x2341fa){_0x42d196[_0x1ea6b4(0xd8)]=0x5,_0x1f0061(_0x42d196);const _0x4557c7=((_0x2203c6=_0x2341fa===null||_0x2341fa===void 0x0?void 0x0:_0x2341fa[_0x1ea6b4(0xc7)])===null||_0x2203c6===void 0x0?void 0x0:_0x2203c6[_0x1ea6b4(0xd8)])||0x1f4;console[_0x1ea6b4(0xf5)]('draw\x20error:\x20',JSON[_0x1ea6b4(0xe4)](_0x2341fa),_0x4557c7);const _0xb292a2=(_0x4646b0=(_0x138670=(_0x276d49=_0x2341fa===null||_0x2341fa===void 0x0?void 0x0:_0x2341fa['response'])===null||_0x276d49===void 0x0?void 0x0:_0x276d49[_0x1ea6b4(0xf9)])===null||_0x138670===void 0x0?void 0x0:_0x138670[_0x1ea6b4(0xf3)])===null||_0x4646b0===void 0x0?void 0x0:_0x4646b0[_0x1ea6b4(0xe2)];if(_0x4557c7===0x1ad)return _0x42d196[_0x1ea6b4(0xc0)]=_0x1ea6b4(0xbf),_0x42d196;if(_0x4557c7===0x190&&_0xb292a2['includes']('This\x20request\x20has\x20been\x20blocked\x20by\x20our\x20content\x20filters'))return _0x42d196['text']=_0x1ea6b4(0xef),_0x42d196;if(_0x4557c7===0x190&&_0xb292a2[_0x1ea6b4(0xec)](_0x1ea6b4(0xf2)))return _0x42d196[_0x1ea6b4(0xc0)]='当前模型key已被封禁、已冻结当前调用Key、尝试重新对话试试吧！',_0x42d196;if(_0x4557c7===0x1f4)return _0x42d196[_0x1ea6b4(0xc0)]=_0x1ea6b4(0xd7),_0x42d196;if(_0x4557c7===0x191)return _0x42d196[_0x1ea6b4(0xc0)]=_0x1ea6b4(0x100),_0x42d196;return _0x42d196['text']='绘制图片失败，请稍后试试吧！',_0x42d196;}}};OpenAIDrawService=OpenAIDrawService_1=__decorate([(0x0,common_1['Injectable'])(),__metadata(_0x36644f(0xe3),[upload_service_1[_0x36644f(0xbe)],globalConfig_service_1['GlobalConfigService'],chatLog_service_1['ChatLogService'],openaiChat_service_1[_0x36644f(0xdf)]])],OpenAIDrawService),exports[_0x36644f(0xf4)]=OpenAIDrawService;function _0x53bd(){const _0x5bae1b=['includes','images/dalle/','answer','您的请求已被系统拒绝。您的提示可能存在一些非法的文本。','40awWxnc','调用chatFree失败：','Billing\x20hard\x20limit\x20has\x20been\x20reached','error','OpenAIDrawService','log','getDate','},\x20模拟AI绘画机器人的语气，用中文回复，告诉用户已经画好了','name','data','981541FYFxuE','__esModule','你是一个绘画提示词生成工具，请根据用户的要求，结合上下文，用一段文字，描述用户需要的绘画需求，不用包含任何礼貌性的寒暄,只需要场景的描述,可以适当联想','function','__decorate','application/json','绘制图片失败，此次绘画被拒绝了！','length','metadata','url','uploadService','849905FgeQFm','openAIChatService','------>\x20开始上传图片！！！','翻译失败:\x20','chatLogService','上传图片过程中出现错误:\x20','UploadService','当前请求已过载、请稍等会儿再试试吧！','text','\x20绘制成功','/v1/images/generations','default','285704KsXFJs','__metadata','@nestjs/common','response','getConfigs','Bearer\x20','187812QTUFNx','padStart','开始提交\x20Dalle\x20绘图任务\x20','40PgXRUO','../chatLog/chatLog.service','46784oFJInQ','2LbIUwb','./openaiChat.service','defineProperty','getFullYear','图片上传成功，URL:\x20','uploadFileFromUrl','axios','绘制图片失败，请检查你的提示词是否有非法描述！','status','274902UanJGo','../globalConfig/globalConfig.service','DrawService','28177Jqhzxd','revised_prompt','getOwnPropertyDescriptor','OpenAIChatService','chatFree','fileInfo','message','design:paramtypes','stringify','decorate','globalConfigService','object','Logger','../upload/upload.service','DalleDraw','27eVByjf'];_0x53bd=function(){return _0x5bae1b;};return _0x53bd();}