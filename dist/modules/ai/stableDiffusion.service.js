'use strict';const _0x1021e8=_0x52d5;function _0xc516(){const _0x1dca8a=['\x20绘制成功','decorate','__metadata','@nestjs/common','getConfigs','330sjvahY','583194vPkQXI','logger','function','error','No\x20choices\x20returned.','data','answer','globalConfigService','getOwnPropertyDescriptor','GlobalConfigService','sdxl','上传文件失败:\x20','1064448rTJTBO','UploadService','uploadService','design:paramtypes','object','padStart','49338MEJrbM','user','defineProperty','log','StableDiffusionService','application/json','metadata','getDate','choices','Logger','POST','21hRpWxg','fileInfo','axios','localStorageStatus','51315xxFGpO','17xOQKJR','53218sXPLfF','3677075hwUMOV','没有找到链接','40bDpqby','../upload/upload.service','getMonth','message','length','398056YCHaCi','__esModule','name','uploadFileFromUrl','No\x20link\x20found.','/v1/chat/completions','content','API响应接收'];_0xc516=function(){return _0x1dca8a;};return _0xc516();}(function(_0x3f99ec,_0x4a5be8){const _0x836ca3=_0x52d5,_0x4ca3c9=_0x3f99ec();while(!![]){try{const _0xd7f305=parseInt(_0x836ca3(0x1d2))/0x1*(parseInt(_0x836ca3(0x1d3))/0x2)+-parseInt(_0x836ca3(0x1bc))/0x3+parseInt(_0x836ca3(0x1a2))/0x4+parseInt(_0x836ca3(0x1d4))/0x5+parseInt(_0x836ca3(0x1b0))/0x6*(-parseInt(_0x836ca3(0x1cd))/0x7)+parseInt(_0x836ca3(0x19d))/0x8*(-parseInt(_0x836ca3(0x1c2))/0x9)+parseInt(_0x836ca3(0x1af))/0xa*(-parseInt(_0x836ca3(0x1d1))/0xb);if(_0xd7f305===_0x4a5be8)break;else _0x4ca3c9['push'](_0x4ca3c9['shift']());}catch(_0x123f1e){_0x4ca3c9['push'](_0x4ca3c9['shift']());}}}(_0xc516,0x702fa));var __decorate=this&&this['__decorate']||function(_0x2df2d4,_0x57f2a0,_0x59915d,_0x1d53b5){const _0x4a52c5=_0x52d5;var _0x148f11=arguments[_0x4a52c5(0x1a1)],_0xb942d2=_0x148f11<0x3?_0x57f2a0:_0x1d53b5===null?_0x1d53b5=Object[_0x4a52c5(0x1b8)](_0x57f2a0,_0x59915d):_0x1d53b5,_0x4cb2b3;if(typeof Reflect===_0x4a52c5(0x1c0)&&typeof Reflect[_0x4a52c5(0x1ab)]===_0x4a52c5(0x1b2))_0xb942d2=Reflect['decorate'](_0x2df2d4,_0x57f2a0,_0x59915d,_0x1d53b5);else{for(var _0x29fd0b=_0x2df2d4[_0x4a52c5(0x1a1)]-0x1;_0x29fd0b>=0x0;_0x29fd0b--)if(_0x4cb2b3=_0x2df2d4[_0x29fd0b])_0xb942d2=(_0x148f11<0x3?_0x4cb2b3(_0xb942d2):_0x148f11>0x3?_0x4cb2b3(_0x57f2a0,_0x59915d,_0xb942d2):_0x4cb2b3(_0x57f2a0,_0x59915d))||_0xb942d2;}return _0x148f11>0x3&&_0xb942d2&&Object[_0x4a52c5(0x1c4)](_0x57f2a0,_0x59915d,_0xb942d2),_0xb942d2;},__metadata=this&&this[_0x1021e8(0x1ac)]||function(_0xef0f80,_0x53d076){const _0x5e6e2d=_0x1021e8;if(typeof Reflect===_0x5e6e2d(0x1c0)&&typeof Reflect[_0x5e6e2d(0x1c8)]===_0x5e6e2d(0x1b2))return Reflect[_0x5e6e2d(0x1c8)](_0xef0f80,_0x53d076);},StableDiffusionService_1;Object[_0x1021e8(0x1c4)](exports,_0x1021e8(0x1a3),{'value':!![]}),exports['StableDiffusionService']=void 0x0;function _0x52d5(_0x365899,_0xadf188){const _0xc51659=_0xc516();return _0x52d5=function(_0x52d585,_0x194538){_0x52d585=_0x52d585-0x19d;let _0x272042=_0xc51659[_0x52d585];return _0x272042;},_0x52d5(_0x365899,_0xadf188);}const common_1=require(_0x1021e8(0x1ad)),axios_1=require(_0x1021e8(0x1cf)),globalConfig_service_1=require('../globalConfig/globalConfig.service'),upload_service_1=require(_0x1021e8(0x19e));let StableDiffusionService=StableDiffusionService_1=class StableDiffusionService{constructor(_0x14d93a,_0x2724f3){const _0x468e57=_0x1021e8;this[_0x468e57(0x1be)]=_0x14d93a,this[_0x468e57(0x1b7)]=_0x2724f3,this[_0x468e57(0x1b1)]=new common_1[(_0x468e57(0x1cb))](StableDiffusionService_1[_0x468e57(0x1a4)]);}async[_0x1021e8(0x1ba)](_0x43e19a){const _0x24facf=_0x1021e8,{onSuccess:_0x24163e,onFailure:_0x1835aa,apiKey:_0x2db358,model:_0xc6d070,proxyUrl:_0x56e912,modelName:_0x557cce,timeout:_0x5debdc,chatId:_0x444b6d,prompt:_0x449fe7}=_0x43e19a;let _0x188b70={'answer':'','model':_0xc6d070,'modelName':_0x557cce,'chatId':_0x444b6d,'fileInfo':'','status':0x2};console[_0x24facf(0x1c5)]('开始处理',{'model':_0xc6d070,'modelName':_0x557cce,'prompt':_0x449fe7});const _0x294e5a={'method':_0x24facf(0x1cc),'url':_0x56e912+_0x24facf(0x1a7),'timeout':_0x5debdc,'headers':{'Content-Type':_0x24facf(0x1c7),'Authorization':'Bearer\x20'+_0x2db358},'data':{'model':_0xc6d070,'messages':[{'role':_0x24facf(0x1c3),'content':_0x449fe7}]}};try{const _0xe051b2=await(0x0,axios_1['default'])(_0x294e5a);console[_0x24facf(0x1c5)](_0x24facf(0x1a9),_0xe051b2['data']);if(_0xe051b2['data'][_0x24facf(0x1ca)]&&_0xe051b2[_0x24facf(0x1b5)][_0x24facf(0x1ca)][_0x24facf(0x1a1)]>0x0){const _0x3a2658=_0xe051b2[_0x24facf(0x1b5)]['choices'][0x0],_0x17974c=_0x3a2658[_0x24facf(0x1a0)][_0x24facf(0x1a8)];console[_0x24facf(0x1c5)]('处理内容',_0x17974c);const _0x25a1c7=/\]\((https?:\/\/[^\)]+)\)/,_0x8eddc1=_0x17974c['match'](_0x25a1c7);if(_0x8eddc1&&_0x8eddc1[0x1]){_0x188b70[_0x24facf(0x1ce)]=_0x8eddc1[0x1];try{const _0x532192=await this[_0x24facf(0x1b7)][_0x24facf(0x1ae)]([_0x24facf(0x1d0)]);if(Number(_0x532192)){const _0x119efe=new Date(),_0xf0847b=_0x119efe['getFullYear'](),_0x44e2fc=String(_0x119efe[_0x24facf(0x19f)]()+0x1)['padStart'](0x2,'0'),_0x3d750b=String(_0x119efe[_0x24facf(0x1c9)]())[_0x24facf(0x1c1)](0x2,'0'),_0x1ba53c=''+_0xf0847b+_0x44e2fc+'/'+_0x3d750b;_0x188b70[_0x24facf(0x1ce)]=await this[_0x24facf(0x1be)][_0x24facf(0x1a5)]({'url':_0x188b70[_0x24facf(0x1ce)],'dir':'images/stable-diffusion/'+_0x1ba53c});}}catch(_0x28deca){common_1[_0x24facf(0x1cb)][_0x24facf(0x1b3)](_0x24facf(0x1bb)+_0x28deca[_0x24facf(0x1a0)],_0x24facf(0x1c6));}console[_0x24facf(0x1c5)]('找到链接',_0x8eddc1[0x1]);}else console[_0x24facf(0x1c5)](_0x24facf(0x1d5));_0x188b70[_0x24facf(0x1b6)]=_0x449fe7+_0x24facf(0x1aa);if(_0x188b70[_0x24facf(0x1ce)]){_0x24163e(_0x188b70);return;}else _0x1835aa(_0x24facf(0x1a6));}else _0x1835aa(_0x24facf(0x1b4));}catch(_0x127a66){common_1[_0x24facf(0x1cb)][_0x24facf(0x1b3)]('服务器错误，请求失败：',_0x127a66);}}};StableDiffusionService=StableDiffusionService_1=__decorate([(0x0,common_1['Injectable'])(),__metadata(_0x1021e8(0x1bf),[upload_service_1[_0x1021e8(0x1bd)],globalConfig_service_1[_0x1021e8(0x1b9)]])],StableDiffusionService),exports['StableDiffusionService']=StableDiffusionService;