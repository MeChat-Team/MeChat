'use strict';const _0x115e70=_0x4a52;(function(_0x2f5046,_0x2559f3){const _0x3f09ad=_0x4a52,_0x44d335=_0x2f5046();while(!![]){try{const _0x15f7fc=-parseInt(_0x3f09ad(0x200))/0x1*(parseInt(_0x3f09ad(0x1eb))/0x2)+-parseInt(_0x3f09ad(0x20e))/0x3*(parseInt(_0x3f09ad(0x1ff))/0x4)+parseInt(_0x3f09ad(0x1ea))/0x5*(parseInt(_0x3f09ad(0x207))/0x6)+-parseInt(_0x3f09ad(0x21a))/0x7+parseInt(_0x3f09ad(0x206))/0x8*(-parseInt(_0x3f09ad(0x21d))/0x9)+-parseInt(_0x3f09ad(0x212))/0xa*(-parseInt(_0x3f09ad(0x21f))/0xb)+parseInt(_0x3f09ad(0x216))/0xc*(parseInt(_0x3f09ad(0x1e8))/0xd);if(_0x15f7fc===_0x2559f3)break;else _0x44d335['push'](_0x44d335['shift']());}catch(_0x8bebe9){_0x44d335['push'](_0x44d335['shift']());}}}(_0x5cb1,0x965ba));var __decorate=this&&this[_0x115e70(0x1f6)]||function(_0x501541,_0x1be378,_0x5b7b21,_0x146030){const _0x4f8a07=_0x115e70;var _0x4fb71d=arguments[_0x4f8a07(0x1fa)],_0x460d2b=_0x4fb71d<0x3?_0x1be378:_0x146030===null?_0x146030=Object[_0x4f8a07(0x1f1)](_0x1be378,_0x5b7b21):_0x146030,_0x32b406;if(typeof Reflect===_0x4f8a07(0x201)&&typeof Reflect[_0x4f8a07(0x20b)]===_0x4f8a07(0x1f2))_0x460d2b=Reflect[_0x4f8a07(0x20b)](_0x501541,_0x1be378,_0x5b7b21,_0x146030);else{for(var _0x2044de=_0x501541[_0x4f8a07(0x1fa)]-0x1;_0x2044de>=0x0;_0x2044de--)if(_0x32b406=_0x501541[_0x2044de])_0x460d2b=(_0x4fb71d<0x3?_0x32b406(_0x460d2b):_0x4fb71d>0x3?_0x32b406(_0x1be378,_0x5b7b21,_0x460d2b):_0x32b406(_0x1be378,_0x5b7b21))||_0x460d2b;}return _0x4fb71d>0x3&&_0x460d2b&&Object[_0x4f8a07(0x1e9)](_0x1be378,_0x5b7b21,_0x460d2b),_0x460d2b;},__metadata=this&&this[_0x115e70(0x1ed)]||function(_0x212126,_0x5f38fd){const _0x46b32a=_0x115e70;if(typeof Reflect===_0x46b32a(0x201)&&typeof Reflect[_0x46b32a(0x1f3)]===_0x46b32a(0x1f2))return Reflect[_0x46b32a(0x1f3)](_0x212126,_0x5f38fd);},StableDiffusionService_1;Object[_0x115e70(0x1e9)](exports,_0x115e70(0x215),{'value':!![]}),exports[_0x115e70(0x1ec)]=void 0x0;function _0x5cb1(){const _0x522244=['../upload/upload.service','/v1/chat/completions','images/stable-diffusion/','1507670kOjTGK','开始处理','localStorageStatus','__esModule','3804tvMRCb','没有找到链接','globalConfigService','getMonth','3611797FHmwkz','match','getDate','9MOQhip','choices','22UGnvpp','message','application/json','data','../globalConfig/globalConfig.service','POST','No\x20choices\x20returned.','33449yaLEll','defineProperty','4569010yYjCxR','2jkbxiY','StableDiffusionService','__metadata','\x20绘制成功','error','user','getOwnPropertyDescriptor','function','metadata','getFullYear','fileInfo','__decorate','服务器错误，请求失败：','uploadService','处理内容','length','content','padStart','getConfigs','@nestjs/common','380RAJWGT','147632EnUAPf','object','log','上传文件失败:\x20','Logger','design:paramtypes','2150504mzWmFJ','6bWvtru','sdxl','Injectable','找到链接','decorate','Bearer\x20','No\x20link\x20found.','15243nCeKRm'];_0x5cb1=function(){return _0x522244;};return _0x5cb1();}const common_1=require(_0x115e70(0x1fe)),axios_1=require('axios'),globalConfig_service_1=require(_0x115e70(0x1e5)),upload_service_1=require(_0x115e70(0x20f));function _0x4a52(_0x52f271,_0x4015bb){const _0x5cb1cb=_0x5cb1();return _0x4a52=function(_0x4a52ca,_0x505830){_0x4a52ca=_0x4a52ca-0x1e5;let _0x2b050f=_0x5cb1cb[_0x4a52ca];return _0x2b050f;},_0x4a52(_0x52f271,_0x4015bb);}let StableDiffusionService=StableDiffusionService_1=class StableDiffusionService{constructor(_0x3f374e,_0x56a5af){const _0x25ccb6=_0x115e70;this[_0x25ccb6(0x1f8)]=_0x3f374e,this[_0x25ccb6(0x218)]=_0x56a5af,this['logger']=new common_1[(_0x25ccb6(0x204))](StableDiffusionService_1['name']);}async[_0x115e70(0x208)](_0x58fdc5){const _0x3a1ff9=_0x115e70,{onSuccess:_0xf896a1,onFailure:_0xfa16f3,apiKey:_0x58a476,model:_0xc35819,proxyUrl:_0x2409d5,modelName:_0x509d3c,timeout:_0x5edcd2,chatId:_0x1bedc6,prompt:_0x34dd41}=_0x58fdc5;let _0xdb341a={'answer':'','model':_0xc35819,'modelName':_0x509d3c,'chatId':_0x1bedc6,'fileInfo':'','status':0x2};console[_0x3a1ff9(0x202)](_0x3a1ff9(0x213),{'model':_0xc35819,'modelName':_0x509d3c,'prompt':_0x34dd41});const _0x33551f={'method':_0x3a1ff9(0x1e6),'url':_0x2409d5+_0x3a1ff9(0x210),'timeout':_0x5edcd2,'headers':{'Content-Type':_0x3a1ff9(0x221),'Authorization':_0x3a1ff9(0x20c)+_0x58a476},'data':{'model':_0xc35819,'messages':[{'role':_0x3a1ff9(0x1f0),'content':_0x34dd41}]}};try{const _0x536474=await(0x0,axios_1['default'])(_0x33551f);console[_0x3a1ff9(0x202)]('API响应接收',_0x536474[_0x3a1ff9(0x222)]);if(_0x536474[_0x3a1ff9(0x222)][_0x3a1ff9(0x21e)]&&_0x536474[_0x3a1ff9(0x222)][_0x3a1ff9(0x21e)]['length']>0x0){const _0x888ade=_0x536474[_0x3a1ff9(0x222)]['choices'][0x0],_0x4c3c4d=_0x888ade[_0x3a1ff9(0x220)][_0x3a1ff9(0x1fb)];console['log'](_0x3a1ff9(0x1f9),_0x4c3c4d);const _0x2463a8=/\]\((https?:\/\/[^\)]+)\)/,_0x1e4249=_0x4c3c4d[_0x3a1ff9(0x21b)](_0x2463a8);if(_0x1e4249&&_0x1e4249[0x1]){_0xdb341a[_0x3a1ff9(0x1f5)]=_0x1e4249[0x1];try{const _0x2a132c=await this[_0x3a1ff9(0x218)][_0x3a1ff9(0x1fd)]([_0x3a1ff9(0x214)]);if(Number(_0x2a132c)){const _0x3ea6c1=new Date(),_0x588153=_0x3ea6c1[_0x3a1ff9(0x1f4)](),_0x2c8f41=String(_0x3ea6c1[_0x3a1ff9(0x219)]()+0x1)[_0x3a1ff9(0x1fc)](0x2,'0'),_0x2d6497=String(_0x3ea6c1[_0x3a1ff9(0x21c)]())[_0x3a1ff9(0x1fc)](0x2,'0'),_0xc161e=''+_0x588153+_0x2c8f41+'/'+_0x2d6497;_0xdb341a[_0x3a1ff9(0x1f5)]=await this[_0x3a1ff9(0x1f8)]['uploadFileFromUrl']({'url':_0xdb341a[_0x3a1ff9(0x1f5)],'dir':_0x3a1ff9(0x211)+_0xc161e});}}catch(_0x46e366){common_1[_0x3a1ff9(0x204)][_0x3a1ff9(0x1ef)](_0x3a1ff9(0x203)+_0x46e366['message'],_0x3a1ff9(0x1ec));}console[_0x3a1ff9(0x202)](_0x3a1ff9(0x20a),_0x1e4249[0x1]);}else console[_0x3a1ff9(0x202)](_0x3a1ff9(0x217));_0xdb341a['answer']=_0x34dd41+_0x3a1ff9(0x1ee);if(_0xdb341a['fileInfo']){_0xf896a1(_0xdb341a);return;}else _0xfa16f3(_0x3a1ff9(0x20d));}else _0xfa16f3(_0x3a1ff9(0x1e7));}catch(_0x12cf5b){common_1[_0x3a1ff9(0x204)][_0x3a1ff9(0x1ef)](_0x3a1ff9(0x1f7),_0x12cf5b);}}};StableDiffusionService=StableDiffusionService_1=__decorate([(0x0,common_1[_0x115e70(0x209)])(),__metadata(_0x115e70(0x205),[upload_service_1['UploadService'],globalConfig_service_1['GlobalConfigService']])],StableDiffusionService),exports[_0x115e70(0x1ec)]=StableDiffusionService;