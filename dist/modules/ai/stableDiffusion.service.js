'use strict';const _0x16998c=_0x4b67;function _0x13c6(){const _0x25dc38=['../globalConfig/globalConfig.service','8xBeAhU','../upload/upload.service','处理内容','/v1/chat/completions','服务器错误，请求失败：','application/json','Bearer\x20','10253610iqjgGh','localStorageStatus','getOwnPropertyDescriptor','上传文件失败:\x20','7159690LTevqQ','images/stable-diffusion/','2xiHImP','getFullYear','match','No\x20choices\x20returned.','254366Bxhnhv','fileInfo','开始处理','\x20绘制成功','answer','function','message','Logger','content','API响应接收','globalConfigService','1331917tDXESm','@nestjs/common','padStart','No\x20link\x20found.','metadata','__esModule','Injectable','object','uploadService','StableDiffusionService','logger','user','没有找到链接','UploadService','error','27269077iQbcfu','getDate','data','length','log','5493290pUUdrI','choices','default','177BQNPvx','18HBBleD','uploadFileFromUrl','90820ZteGps','找到链接','defineProperty','GlobalConfigService'];_0x13c6=function(){return _0x25dc38;};return _0x13c6();}(function(_0x5ef31a,_0x1b820c){const _0x14789f=_0x4b67,_0xf921fb=_0x5ef31a();while(!![]){try{const _0x44b9ba=parseInt(_0x14789f(0x98))/0x1*(parseInt(_0x14789f(0x89))/0x2)+parseInt(_0x14789f(0x74))/0x3*(-parseInt(_0x14789f(0x77))/0x4)+-parseInt(_0x14789f(0x71))/0x5+parseInt(_0x14789f(0x75))/0x6*(-parseInt(_0x14789f(0x8d))/0x7)+-parseInt(_0x14789f(0x7c))/0x8*(parseInt(_0x14789f(0x83))/0x9)+parseInt(_0x14789f(0x87))/0xa+parseInt(_0x14789f(0xa7))/0xb;if(_0x44b9ba===_0x1b820c)break;else _0xf921fb['push'](_0xf921fb['shift']());}catch(_0x12ecfc){_0xf921fb['push'](_0xf921fb['shift']());}}}(_0x13c6,0xcd290));var __decorate=this&&this['__decorate']||function(_0x4bceaa,_0xc58ac2,_0x3fb35d,_0x17833a){const _0x4f6929=_0x4b67;var _0x53a965=arguments[_0x4f6929(0x6f)],_0x587d93=_0x53a965<0x3?_0xc58ac2:_0x17833a===null?_0x17833a=Object[_0x4f6929(0x85)](_0xc58ac2,_0x3fb35d):_0x17833a,_0x192ed7;if(typeof Reflect==='object'&&typeof Reflect['decorate']===_0x4f6929(0x92))_0x587d93=Reflect['decorate'](_0x4bceaa,_0xc58ac2,_0x3fb35d,_0x17833a);else{for(var _0x9ad678=_0x4bceaa[_0x4f6929(0x6f)]-0x1;_0x9ad678>=0x0;_0x9ad678--)if(_0x192ed7=_0x4bceaa[_0x9ad678])_0x587d93=(_0x53a965<0x3?_0x192ed7(_0x587d93):_0x53a965>0x3?_0x192ed7(_0xc58ac2,_0x3fb35d,_0x587d93):_0x192ed7(_0xc58ac2,_0x3fb35d))||_0x587d93;}return _0x53a965>0x3&&_0x587d93&&Object[_0x4f6929(0x79)](_0xc58ac2,_0x3fb35d,_0x587d93),_0x587d93;},__metadata=this&&this['__metadata']||function(_0x4eb147,_0x925fe0){const _0x1718a3=_0x4b67;if(typeof Reflect===_0x1718a3(0x9f)&&typeof Reflect[_0x1718a3(0x9c)]===_0x1718a3(0x92))return Reflect['metadata'](_0x4eb147,_0x925fe0);},StableDiffusionService_1;Object[_0x16998c(0x79)](exports,_0x16998c(0x9d),{'value':!![]}),exports[_0x16998c(0xa1)]=void 0x0;function _0x4b67(_0x5885ea,_0xd592de){const _0x13c63b=_0x13c6();return _0x4b67=function(_0x4b6780,_0x3f1d1e){_0x4b6780=_0x4b6780-0x6d;let _0x1c8c95=_0x13c63b[_0x4b6780];return _0x1c8c95;},_0x4b67(_0x5885ea,_0xd592de);}const common_1=require(_0x16998c(0x99)),axios_1=require('axios'),globalConfig_service_1=require(_0x16998c(0x7b)),upload_service_1=require(_0x16998c(0x7d));let StableDiffusionService=StableDiffusionService_1=class StableDiffusionService{constructor(_0x568032,_0xb40e7c){const _0x1a369a=_0x16998c;this[_0x1a369a(0xa0)]=_0x568032,this['globalConfigService']=_0xb40e7c,this[_0x1a369a(0xa2)]=new common_1[(_0x1a369a(0x94))](StableDiffusionService_1['name']);}async['sdxl'](_0x584b25){const _0x3e9721=_0x16998c,{onSuccess:_0x717d58,onFailure:_0x403223,apiKey:_0x3e5460,model:_0x227e9e,proxyUrl:_0x1c2a96,modelName:_0x418e5c,timeout:_0x2318ec,chatId:_0x51842b,prompt:_0x19b2e1}=_0x584b25;let _0x285f9e={'answer':'','model':_0x227e9e,'modelName':_0x418e5c,'chatId':_0x51842b,'fileInfo':'','status':0x2};console[_0x3e9721(0x70)](_0x3e9721(0x8f),{'model':_0x227e9e,'modelName':_0x418e5c,'prompt':_0x19b2e1});const _0xff365d={'method':'POST','url':_0x1c2a96+_0x3e9721(0x7f),'timeout':_0x2318ec,'headers':{'Content-Type':_0x3e9721(0x81),'Authorization':_0x3e9721(0x82)+_0x3e5460},'data':{'model':_0x227e9e,'messages':[{'role':_0x3e9721(0xa3),'content':_0x19b2e1}]}};try{const _0x20f3ec=await(0x0,axios_1[_0x3e9721(0x73)])(_0xff365d);console[_0x3e9721(0x70)](_0x3e9721(0x96),_0x20f3ec['data']);if(_0x20f3ec[_0x3e9721(0x6e)][_0x3e9721(0x72)]&&_0x20f3ec[_0x3e9721(0x6e)]['choices'][_0x3e9721(0x6f)]>0x0){const _0x27560a=_0x20f3ec[_0x3e9721(0x6e)][_0x3e9721(0x72)][0x0],_0x1a385d=_0x27560a[_0x3e9721(0x93)][_0x3e9721(0x95)];console['log'](_0x3e9721(0x7e),_0x1a385d);const _0x21e320=/\]\((https?:\/\/[^\)]+)\)/,_0x4665ea=_0x1a385d[_0x3e9721(0x8b)](_0x21e320);if(_0x4665ea&&_0x4665ea[0x1]){_0x285f9e[_0x3e9721(0x8e)]=_0x4665ea[0x1];try{const _0x313937=await this[_0x3e9721(0x97)]['getConfigs']([_0x3e9721(0x84)]);if(Number(_0x313937)){const _0x356304=new Date(),_0x13e333=_0x356304[_0x3e9721(0x8a)](),_0x1a331d=String(_0x356304['getMonth']()+0x1)['padStart'](0x2,'0'),_0x390237=String(_0x356304[_0x3e9721(0x6d)]())[_0x3e9721(0x9a)](0x2,'0'),_0x3160d7=''+_0x13e333+_0x1a331d+'/'+_0x390237;_0x285f9e[_0x3e9721(0x8e)]=await this[_0x3e9721(0xa0)][_0x3e9721(0x76)]({'url':_0x285f9e['fileInfo'],'dir':_0x3e9721(0x88)+_0x3160d7});}}catch(_0xba8c36){common_1[_0x3e9721(0x94)][_0x3e9721(0xa6)](_0x3e9721(0x86)+_0xba8c36['message'],_0x3e9721(0xa1));}console[_0x3e9721(0x70)](_0x3e9721(0x78),_0x4665ea[0x1]);}else console['log'](_0x3e9721(0xa4));_0x285f9e[_0x3e9721(0x91)]=_0x19b2e1+_0x3e9721(0x90);if(_0x285f9e['fileInfo']){_0x717d58(_0x285f9e);return;}else _0x403223(_0x3e9721(0x9b));}else _0x403223(_0x3e9721(0x8c));}catch(_0x296d82){common_1[_0x3e9721(0x94)][_0x3e9721(0xa6)](_0x3e9721(0x80),_0x296d82);}}};StableDiffusionService=StableDiffusionService_1=__decorate([(0x0,common_1[_0x16998c(0x9e)])(),__metadata('design:paramtypes',[upload_service_1[_0x16998c(0xa5)],globalConfig_service_1[_0x16998c(0x7a)]])],StableDiffusionService),exports[_0x16998c(0xa1)]=StableDiffusionService;