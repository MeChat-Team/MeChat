'use strict';const _0x23d272=_0x19df;(function(_0x2c5550,_0x556d15){const _0x4ea520=_0x19df,_0x129596=_0x2c5550();while(!![]){try{const _0x3f5a98=parseInt(_0x4ea520(0x1e4))/0x1+-parseInt(_0x4ea520(0x1b7))/0x2+parseInt(_0x4ea520(0x1d9))/0x3*(parseInt(_0x4ea520(0x1c3))/0x4)+-parseInt(_0x4ea520(0x1af))/0x5+parseInt(_0x4ea520(0x1c8))/0x6*(-parseInt(_0x4ea520(0x1cd))/0x7)+parseInt(_0x4ea520(0x1ad))/0x8*(-parseInt(_0x4ea520(0x1e7))/0x9)+-parseInt(_0x4ea520(0x1d2))/0xa*(-parseInt(_0x4ea520(0x1c7))/0xb);if(_0x3f5a98===_0x556d15)break;else _0x129596['push'](_0x129596['shift']());}catch(_0x5dffcf){_0x129596['push'](_0x129596['shift']());}}}(_0x2d00,0xa85fc));function _0x19df(_0x136690,_0x4def84){const _0x2d00b1=_0x2d00();return _0x19df=function(_0x19df64,_0x3a5c86){_0x19df64=_0x19df64-0x1ac;let _0x8f7630=_0x2d00b1[_0x19df64];return _0x8f7630;},_0x19df(_0x136690,_0x4def84);}function _0x2d00(){const _0x443797=['开始处理','2588440LbZcDR','Logger','1834555sMarrG','user','没有找到链接','UploadService','match','length','getFullYear','padStart','236566wpoQsF','images/stable-diffusion/','\x20绘制成功','../globalConfig/globalConfig.service','error','content','getConfigs','__metadata','No\x20link\x20found.','localStorageStatus','metadata','fileInfo','1363732owwCMC','No\x20choices\x20returned.','function','__decorate','1036607engJjr','6907002pjzJJu','Bearer\x20','POST','globalConfigService','__esModule','7WvyTMG','@nestjs/common','logger','Injectable','uploadService','190ibZHJY','StableDiffusionService','找到链接','name','getOwnPropertyDescriptor','上传文件失败:\x20','uploadFileFromUrl','3uQxdfa','answer','data','object','design:paramtypes','log','../upload/upload.service','choices','decorate','处理内容','/v1/chat/completions','518140RDbikj','API响应接收','defineProperty','9MBHgiE','default'];_0x2d00=function(){return _0x443797;};return _0x2d00();}var __decorate=this&&this[_0x23d272(0x1c6)]||function(_0x2b59da,_0xe48dd,_0x520a99,_0x1a540f){const _0x2a2e16=_0x23d272;var _0x159ab=arguments['length'],_0x160556=_0x159ab<0x3?_0xe48dd:_0x1a540f===null?_0x1a540f=Object[_0x2a2e16(0x1d6)](_0xe48dd,_0x520a99):_0x1a540f,_0x470c13;if(typeof Reflect===_0x2a2e16(0x1dc)&&typeof Reflect[_0x2a2e16(0x1e1)]===_0x2a2e16(0x1c5))_0x160556=Reflect[_0x2a2e16(0x1e1)](_0x2b59da,_0xe48dd,_0x520a99,_0x1a540f);else{for(var _0x2c1b0f=_0x2b59da[_0x2a2e16(0x1b4)]-0x1;_0x2c1b0f>=0x0;_0x2c1b0f--)if(_0x470c13=_0x2b59da[_0x2c1b0f])_0x160556=(_0x159ab<0x3?_0x470c13(_0x160556):_0x159ab>0x3?_0x470c13(_0xe48dd,_0x520a99,_0x160556):_0x470c13(_0xe48dd,_0x520a99))||_0x160556;}return _0x159ab>0x3&&_0x160556&&Object[_0x2a2e16(0x1e6)](_0xe48dd,_0x520a99,_0x160556),_0x160556;},__metadata=this&&this[_0x23d272(0x1be)]||function(_0x50aecc,_0x4c007c){const _0x505e27=_0x23d272;if(typeof Reflect===_0x505e27(0x1dc)&&typeof Reflect[_0x505e27(0x1c1)]===_0x505e27(0x1c5))return Reflect[_0x505e27(0x1c1)](_0x50aecc,_0x4c007c);},StableDiffusionService_1;Object[_0x23d272(0x1e6)](exports,_0x23d272(0x1cc),{'value':!![]}),exports[_0x23d272(0x1d3)]=void 0x0;const common_1=require(_0x23d272(0x1ce)),axios_1=require('axios'),globalConfig_service_1=require(_0x23d272(0x1ba)),upload_service_1=require(_0x23d272(0x1df));let StableDiffusionService=StableDiffusionService_1=class StableDiffusionService{constructor(_0x32ab20,_0x2e976e){const _0x216dec=_0x23d272;this[_0x216dec(0x1d1)]=_0x32ab20,this[_0x216dec(0x1cb)]=_0x2e976e,this[_0x216dec(0x1cf)]=new common_1[(_0x216dec(0x1ae))](StableDiffusionService_1[_0x216dec(0x1d5)]);}async['sdxl'](_0x5add4c){const _0x16effc=_0x23d272,{onSuccess:_0x59781d,onFailure:_0x4a9bac,apiKey:_0x19dc33,model:_0x497d1b,proxyUrl:_0x5bc61a,modelName:_0x19b87f,timeout:_0x47d500,chatId:_0x2b38d2,prompt:_0x56550f}=_0x5add4c;let _0x37afc1={'answer':'','model':_0x497d1b,'modelName':_0x19b87f,'chatId':_0x2b38d2,'fileInfo':'','status':0x2};console[_0x16effc(0x1de)](_0x16effc(0x1ac),{'model':_0x497d1b,'modelName':_0x19b87f,'prompt':_0x56550f});const _0x143c5a={'method':_0x16effc(0x1ca),'url':_0x5bc61a+_0x16effc(0x1e3),'timeout':_0x47d500,'headers':{'Content-Type':'application/json','Authorization':_0x16effc(0x1c9)+_0x19dc33},'data':{'model':_0x497d1b,'messages':[{'role':_0x16effc(0x1b0),'content':_0x56550f}]}};try{const _0x47f1cb=await(0x0,axios_1[_0x16effc(0x1e8)])(_0x143c5a);console['log'](_0x16effc(0x1e5),_0x47f1cb[_0x16effc(0x1db)]);if(_0x47f1cb['data']['choices']&&_0x47f1cb[_0x16effc(0x1db)]['choices'][_0x16effc(0x1b4)]>0x0){const _0x499683=_0x47f1cb[_0x16effc(0x1db)][_0x16effc(0x1e0)][0x0],_0x199b92=_0x499683['message'][_0x16effc(0x1bc)];console[_0x16effc(0x1de)](_0x16effc(0x1e2),_0x199b92);const _0x1cebc7=/\]\((https?:\/\/[^\)]+)\)/,_0x103438=_0x199b92[_0x16effc(0x1b3)](_0x1cebc7);if(_0x103438&&_0x103438[0x1]){_0x37afc1[_0x16effc(0x1c2)]=_0x103438[0x1];try{const _0xbf8727=await this[_0x16effc(0x1cb)][_0x16effc(0x1bd)]([_0x16effc(0x1c0)]);if(Number(_0xbf8727)){const _0x2d2021=new Date(),_0x54f078=_0x2d2021[_0x16effc(0x1b5)](),_0x4965b1=String(_0x2d2021['getMonth']()+0x1)[_0x16effc(0x1b6)](0x2,'0'),_0x3625d3=String(_0x2d2021['getDate']())['padStart'](0x2,'0'),_0x164d72=''+_0x54f078+_0x4965b1+'/'+_0x3625d3;_0x37afc1[_0x16effc(0x1c2)]=await this[_0x16effc(0x1d1)][_0x16effc(0x1d8)]({'url':_0x37afc1[_0x16effc(0x1c2)],'dir':_0x16effc(0x1b8)+_0x164d72});}}catch(_0x2d5c70){common_1['Logger'][_0x16effc(0x1bb)](_0x16effc(0x1d7)+_0x2d5c70['message'],_0x16effc(0x1d3));}console['log'](_0x16effc(0x1d4),_0x103438[0x1]);}else console[_0x16effc(0x1de)](_0x16effc(0x1b1));_0x37afc1[_0x16effc(0x1da)]=_0x56550f+_0x16effc(0x1b9);if(_0x37afc1[_0x16effc(0x1c2)]){_0x59781d(_0x37afc1);return;}else _0x4a9bac(_0x16effc(0x1bf));}else _0x4a9bac(_0x16effc(0x1c4));}catch(_0x3288d7){common_1['Logger']['error']('服务器错误，请求失败：',_0x3288d7);}}};StableDiffusionService=StableDiffusionService_1=__decorate([(0x0,common_1[_0x23d272(0x1d0)])(),__metadata(_0x23d272(0x1dd),[upload_service_1[_0x23d272(0x1b2)],globalConfig_service_1['GlobalConfigService']])],StableDiffusionService),exports[_0x23d272(0x1d3)]=StableDiffusionService;