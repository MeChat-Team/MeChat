'use strict';function _0x43e9(){const _0x192bcc=['getOwnPropertyDescriptor','上传文件失败:\x20','choices','defineProperty','找到链接','487376qIfTiG','sdxl','Bearer\x20','650NGTKbZ','getDate','API响应接收','function','localStorageStatus','服务器错误，请求失败：','StableDiffusionService','\x20绘制成功','error','answer','75483oIlyGs','user','object','match','getConfigs','metadata','@nestjs/common','../upload/upload.service','globalConfigService','/v1/chat/completions','处理内容','log','design:paramtypes','axios','decorate','开始处理','uploadService','logger','message','没有找到链接','Logger','application/json','padStart','default','16jSARYT','fileInfo','1694910CcyYcN','getFullYear','3apOsCr','UploadService','uploadFileFromUrl','__decorate','1415735knhDZi','435360OmHXDZ','155754sqMpJq','445288uTxuCd','data','__esModule','length'];_0x43e9=function(){return _0x192bcc;};return _0x43e9();}const _0x1b4977=_0x414f;(function(_0x4baa2b,_0x8f1dfc){const _0x2b8253=_0x414f,_0x11a20a=_0x4baa2b();while(!![]){try{const _0x2a8fc9=parseInt(_0x2b8253(0x1c4))/0x1+-parseInt(_0x2b8253(0x1c6))/0x2*(-parseInt(_0x2b8253(0x1bf))/0x3)+-parseInt(_0x2b8253(0x196))/0x4+-parseInt(_0x2b8253(0x1c3))/0x5+-parseInt(_0x2b8253(0x1c5))/0x6+-parseInt(_0x2b8253(0x1bd))/0x7*(parseInt(_0x2b8253(0x1bb))/0x8)+parseInt(_0x2b8253(0x1a3))/0x9*(parseInt(_0x2b8253(0x199))/0xa);if(_0x2a8fc9===_0x8f1dfc)break;else _0x11a20a['push'](_0x11a20a['shift']());}catch(_0x3207b2){_0x11a20a['push'](_0x11a20a['shift']());}}}(_0x43e9,0x464cd));var __decorate=this&&this[_0x1b4977(0x1c2)]||function(_0x4b0362,_0x42cbab,_0x405f28,_0x234cdd){const _0xfb2024=_0x1b4977;var _0x487f93=arguments[_0xfb2024(0x1c9)],_0x3a772e=_0x487f93<0x3?_0x42cbab:_0x234cdd===null?_0x234cdd=Object[_0xfb2024(0x1ca)](_0x42cbab,_0x405f28):_0x234cdd,_0x1a6940;if(typeof Reflect==='object'&&typeof Reflect['decorate']==='function')_0x3a772e=Reflect[_0xfb2024(0x1b1)](_0x4b0362,_0x42cbab,_0x405f28,_0x234cdd);else{for(var _0x5d9793=_0x4b0362[_0xfb2024(0x1c9)]-0x1;_0x5d9793>=0x0;_0x5d9793--)if(_0x1a6940=_0x4b0362[_0x5d9793])_0x3a772e=(_0x487f93<0x3?_0x1a6940(_0x3a772e):_0x487f93>0x3?_0x1a6940(_0x42cbab,_0x405f28,_0x3a772e):_0x1a6940(_0x42cbab,_0x405f28))||_0x3a772e;}return _0x487f93>0x3&&_0x3a772e&&Object[_0xfb2024(0x1cd)](_0x42cbab,_0x405f28,_0x3a772e),_0x3a772e;},__metadata=this&&this['__metadata']||function(_0x26a42b,_0x151f10){const _0x420700=_0x1b4977;if(typeof Reflect===_0x420700(0x1a5)&&typeof Reflect[_0x420700(0x1a8)]===_0x420700(0x19c))return Reflect[_0x420700(0x1a8)](_0x26a42b,_0x151f10);},StableDiffusionService_1;Object[_0x1b4977(0x1cd)](exports,_0x1b4977(0x1c8),{'value':!![]}),exports[_0x1b4977(0x19f)]=void 0x0;function _0x414f(_0x3b8ded,_0x241bde){const _0x43e953=_0x43e9();return _0x414f=function(_0x414fff,_0xf24070){_0x414fff=_0x414fff-0x195;let _0x39a441=_0x43e953[_0x414fff];return _0x39a441;},_0x414f(_0x3b8ded,_0x241bde);}const common_1=require(_0x1b4977(0x1a9)),axios_1=require(_0x1b4977(0x1b0)),globalConfig_service_1=require('../globalConfig/globalConfig.service'),upload_service_1=require(_0x1b4977(0x1aa));let StableDiffusionService=StableDiffusionService_1=class StableDiffusionService{constructor(_0x411b9e,_0x2a9e29){const _0x30471f=_0x1b4977;this[_0x30471f(0x1b3)]=_0x411b9e,this[_0x30471f(0x1ab)]=_0x2a9e29,this[_0x30471f(0x1b4)]=new common_1[(_0x30471f(0x1b7))](StableDiffusionService_1['name']);}async[_0x1b4977(0x197)](_0x3496d8){const _0x17b4d0=_0x1b4977,{onSuccess:_0x368059,onFailure:_0x2c0efe,apiKey:_0x266f65,model:_0x369a2b,proxyUrl:_0xeb24fe,modelName:_0x24d377,timeout:_0x1d20f5,chatId:_0x2d9810,prompt:_0x283819}=_0x3496d8;let _0x2ec0b6={'answer':'','model':_0x369a2b,'modelName':_0x24d377,'chatId':_0x2d9810,'fileInfo':'','status':0x2};console[_0x17b4d0(0x1ae)](_0x17b4d0(0x1b2),{'model':_0x369a2b,'modelName':_0x24d377,'prompt':_0x283819});const _0x2e658a={'method':'POST','url':_0xeb24fe+_0x17b4d0(0x1ac),'timeout':_0x1d20f5,'headers':{'Content-Type':_0x17b4d0(0x1b8),'Authorization':_0x17b4d0(0x198)+_0x266f65},'data':{'model':_0x369a2b,'messages':[{'role':_0x17b4d0(0x1a4),'content':_0x283819}]}};try{const _0x420ad6=await(0x0,axios_1[_0x17b4d0(0x1ba)])(_0x2e658a);console[_0x17b4d0(0x1ae)](_0x17b4d0(0x19b),_0x420ad6[_0x17b4d0(0x1c7)]);if(_0x420ad6[_0x17b4d0(0x1c7)][_0x17b4d0(0x1cc)]&&_0x420ad6[_0x17b4d0(0x1c7)]['choices'][_0x17b4d0(0x1c9)]>0x0){const _0x2af6e3=_0x420ad6[_0x17b4d0(0x1c7)][_0x17b4d0(0x1cc)][0x0],_0x5350f6=_0x2af6e3[_0x17b4d0(0x1b5)]['content'];console[_0x17b4d0(0x1ae)](_0x17b4d0(0x1ad),_0x5350f6);const _0x1cbe7f=/\]\((https?:\/\/[^\)]+)\)/,_0x2d4500=_0x5350f6[_0x17b4d0(0x1a6)](_0x1cbe7f);if(_0x2d4500&&_0x2d4500[0x1]){_0x2ec0b6[_0x17b4d0(0x1bc)]=_0x2d4500[0x1];try{const _0x54360c=await this[_0x17b4d0(0x1ab)][_0x17b4d0(0x1a7)]([_0x17b4d0(0x19d)]);if(Number(_0x54360c)){const _0x4910d3=new Date(),_0x1ef948=_0x4910d3[_0x17b4d0(0x1be)](),_0x4c1d45=String(_0x4910d3['getMonth']()+0x1)[_0x17b4d0(0x1b9)](0x2,'0'),_0x5d1cb4=String(_0x4910d3[_0x17b4d0(0x19a)]())[_0x17b4d0(0x1b9)](0x2,'0'),_0x4c28f4=''+_0x1ef948+_0x4c1d45+'/'+_0x5d1cb4;_0x2ec0b6[_0x17b4d0(0x1bc)]=await this[_0x17b4d0(0x1b3)][_0x17b4d0(0x1c1)]({'url':_0x2ec0b6[_0x17b4d0(0x1bc)],'dir':'images/stable-diffusion/'+_0x4c28f4});}}catch(_0x446af8){common_1[_0x17b4d0(0x1b7)][_0x17b4d0(0x1a1)](_0x17b4d0(0x1cb)+_0x446af8[_0x17b4d0(0x1b5)],_0x17b4d0(0x19f));}console[_0x17b4d0(0x1ae)](_0x17b4d0(0x195),_0x2d4500[0x1]);}else console[_0x17b4d0(0x1ae)](_0x17b4d0(0x1b6));_0x2ec0b6[_0x17b4d0(0x1a2)]=_0x283819+_0x17b4d0(0x1a0);if(_0x2ec0b6[_0x17b4d0(0x1bc)]){_0x368059(_0x2ec0b6);return;}else _0x2c0efe('No\x20link\x20found.');}else _0x2c0efe('No\x20choices\x20returned.');}catch(_0x5f3179){common_1[_0x17b4d0(0x1b7)][_0x17b4d0(0x1a1)](_0x17b4d0(0x19e),_0x5f3179);}}};StableDiffusionService=StableDiffusionService_1=__decorate([(0x0,common_1['Injectable'])(),__metadata(_0x1b4977(0x1af),[upload_service_1[_0x1b4977(0x1c0)],globalConfig_service_1['GlobalConfigService']])],StableDiffusionService),exports[_0x1b4977(0x19f)]=StableDiffusionService;