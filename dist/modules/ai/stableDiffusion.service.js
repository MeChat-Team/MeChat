'use strict';function _0x1f21(_0x45de1e,_0xe2a036){const _0x5340cb=_0x5340();return _0x1f21=function(_0x1f2140,_0x3e4366){_0x1f2140=_0x1f2140-0x14d;let _0x5d0cb6=_0x5340cb[_0x1f2140];return _0x5d0cb6;},_0x1f21(_0x45de1e,_0xe2a036);}function _0x5340(){const _0x17f502=['Logger','object','default','GlobalConfigService','answer','服务器错误，请求失败：','没有找到链接','No\x20choices\x20returned.','globalConfigService','sdxl','getConfigs','images/stable-diffusion/','error','metadata','decorate','match','getDate','153704wfJVFL','getMonth','getFullYear','242716JHhpbH','padStart','3070OcSGXT','185kVzmpZ','data','__metadata','1460866mBYUNk','191496PeAFBm','getOwnPropertyDescriptor','8719632vvhSvs','user','22lWqgvA','处理内容','3169390NTUtVH','/v1/chat/completions','fileInfo','开始处理','StableDiffusionService','上传文件失败:\x20','POST','axios','content','defineProperty','\x20绘制成功','3IcFtyS','API响应接收','8RIevPN','uploadService','message','design:paramtypes','../globalConfig/globalConfig.service','找到链接','@nestjs/common','log','__esModule','length','UploadService','choices'];_0x5340=function(){return _0x17f502;};return _0x5340();}const _0x159a6e=_0x1f21;(function(_0x5857ae,_0x19522e){const _0x4a5a12=_0x1f21,_0x1c9a39=_0x5857ae();while(!![]){try{const _0x2ac312=-parseInt(_0x4a5a12(0x16a))/0x1+parseInt(_0x4a5a12(0x173))/0x2+parseInt(_0x4a5a12(0x185))/0x3*(-parseInt(_0x4a5a12(0x16d))/0x4)+-parseInt(_0x4a5a12(0x170))/0x5*(parseInt(_0x4a5a12(0x174))/0x6)+-parseInt(_0x4a5a12(0x17a))/0x7*(-parseInt(_0x4a5a12(0x14d))/0x8)+parseInt(_0x4a5a12(0x176))/0x9+-parseInt(_0x4a5a12(0x16f))/0xa*(parseInt(_0x4a5a12(0x178))/0xb);if(_0x2ac312===_0x19522e)break;else _0x1c9a39['push'](_0x1c9a39['shift']());}catch(_0x3e9054){_0x1c9a39['push'](_0x1c9a39['shift']());}}}(_0x5340,0xb89c2));var __decorate=this&&this['__decorate']||function(_0x2eaf8e,_0x4f7ba6,_0x2e59db,_0x5364be){const _0x31b103=_0x1f21;var _0x5becb7=arguments['length'],_0x117020=_0x5becb7<0x3?_0x4f7ba6:_0x5364be===null?_0x5364be=Object[_0x31b103(0x175)](_0x4f7ba6,_0x2e59db):_0x5364be,_0x2d7d18;if(typeof Reflect==='object'&&typeof Reflect[_0x31b103(0x167)]==='function')_0x117020=Reflect[_0x31b103(0x167)](_0x2eaf8e,_0x4f7ba6,_0x2e59db,_0x5364be);else{for(var _0x5cd5bb=_0x2eaf8e[_0x31b103(0x156)]-0x1;_0x5cd5bb>=0x0;_0x5cd5bb--)if(_0x2d7d18=_0x2eaf8e[_0x5cd5bb])_0x117020=(_0x5becb7<0x3?_0x2d7d18(_0x117020):_0x5becb7>0x3?_0x2d7d18(_0x4f7ba6,_0x2e59db,_0x117020):_0x2d7d18(_0x4f7ba6,_0x2e59db))||_0x117020;}return _0x5becb7>0x3&&_0x117020&&Object[_0x31b103(0x183)](_0x4f7ba6,_0x2e59db,_0x117020),_0x117020;},__metadata=this&&this[_0x159a6e(0x172)]||function(_0x2cbc2d,_0x1cd19c){const _0x28ea74=_0x159a6e;if(typeof Reflect===_0x28ea74(0x15a)&&typeof Reflect[_0x28ea74(0x166)]==='function')return Reflect[_0x28ea74(0x166)](_0x2cbc2d,_0x1cd19c);},StableDiffusionService_1;Object[_0x159a6e(0x183)](exports,_0x159a6e(0x155),{'value':!![]}),exports[_0x159a6e(0x17e)]=void 0x0;const common_1=require(_0x159a6e(0x153)),axios_1=require(_0x159a6e(0x181)),globalConfig_service_1=require(_0x159a6e(0x151)),upload_service_1=require('../upload/upload.service');let StableDiffusionService=StableDiffusionService_1=class StableDiffusionService{constructor(_0x14978f,_0x50416f){const _0x1f2059=_0x159a6e;this[_0x1f2059(0x14e)]=_0x14978f,this['globalConfigService']=_0x50416f,this['logger']=new common_1['Logger'](StableDiffusionService_1['name']);}async[_0x159a6e(0x162)](_0x32d0d1){const _0x1ada33=_0x159a6e,{onSuccess:_0x3a13b9,onFailure:_0x2359b9,apiKey:_0xf8e35,model:_0x40b31f,proxyUrl:_0x2dfd43,modelName:_0x3a14c0,timeout:_0x36c8a5,chatId:_0x59e03e,prompt:_0x58a7d1}=_0x32d0d1;let _0x289351={'answer':'','model':_0x40b31f,'modelName':_0x3a14c0,'chatId':_0x59e03e,'fileInfo':'','status':0x2};console[_0x1ada33(0x154)](_0x1ada33(0x17d),{'model':_0x40b31f,'modelName':_0x3a14c0,'prompt':_0x58a7d1});const _0x28e19e={'method':_0x1ada33(0x180),'url':_0x2dfd43+_0x1ada33(0x17b),'timeout':_0x36c8a5,'headers':{'Content-Type':'application/json','Authorization':'Bearer\x20'+_0xf8e35},'data':{'model':_0x40b31f,'messages':[{'role':_0x1ada33(0x177),'content':_0x58a7d1}]}};try{const _0x8481ed=await(0x0,axios_1[_0x1ada33(0x15b)])(_0x28e19e);console[_0x1ada33(0x154)](_0x1ada33(0x186),_0x8481ed['data']);if(_0x8481ed[_0x1ada33(0x171)]['choices']&&_0x8481ed[_0x1ada33(0x171)][_0x1ada33(0x158)][_0x1ada33(0x156)]>0x0){const _0x4317d0=_0x8481ed[_0x1ada33(0x171)]['choices'][0x0],_0x4c8b63=_0x4317d0[_0x1ada33(0x14f)][_0x1ada33(0x182)];console[_0x1ada33(0x154)](_0x1ada33(0x179),_0x4c8b63);const _0x1b2581=/\]\((https?:\/\/[^\)]+)\)/,_0x5033b3=_0x4c8b63[_0x1ada33(0x168)](_0x1b2581);if(_0x5033b3&&_0x5033b3[0x1]){_0x289351[_0x1ada33(0x17c)]=_0x5033b3[0x1];try{const _0x512027=await this[_0x1ada33(0x161)][_0x1ada33(0x163)](['localStorageStatus']);if(Number(_0x512027)){const _0x322613=new Date(),_0x58578f=_0x322613[_0x1ada33(0x16c)](),_0x5caf6f=String(_0x322613[_0x1ada33(0x16b)]()+0x1)[_0x1ada33(0x16e)](0x2,'0'),_0x1dfe03=String(_0x322613[_0x1ada33(0x169)]())[_0x1ada33(0x16e)](0x2,'0'),_0x2bbef8=''+_0x58578f+_0x5caf6f+'/'+_0x1dfe03;_0x289351[_0x1ada33(0x17c)]=await this[_0x1ada33(0x14e)]['uploadFileFromUrl']({'url':_0x289351['fileInfo'],'dir':_0x1ada33(0x164)+_0x2bbef8});}}catch(_0x2fc509){common_1[_0x1ada33(0x159)][_0x1ada33(0x165)](_0x1ada33(0x17f)+_0x2fc509['message'],_0x1ada33(0x17e));}console[_0x1ada33(0x154)](_0x1ada33(0x152),_0x5033b3[0x1]);}else console[_0x1ada33(0x154)](_0x1ada33(0x15f));_0x289351[_0x1ada33(0x15d)]=_0x58a7d1+_0x1ada33(0x184);if(_0x289351[_0x1ada33(0x17c)]){_0x3a13b9(_0x289351);return;}else _0x2359b9('No\x20link\x20found.');}else _0x2359b9(_0x1ada33(0x160));}catch(_0x664bf0){common_1[_0x1ada33(0x159)]['error'](_0x1ada33(0x15e),_0x664bf0);}}};StableDiffusionService=StableDiffusionService_1=__decorate([(0x0,common_1['Injectable'])(),__metadata(_0x159a6e(0x150),[upload_service_1[_0x159a6e(0x157)],globalConfig_service_1[_0x159a6e(0x15c)]])],StableDiffusionService),exports[_0x159a6e(0x17e)]=StableDiffusionService;