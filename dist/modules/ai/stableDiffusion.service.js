'use strict';const _0x521142=_0x4304;function _0x4304(_0x58c2ac,_0x24d7f1){const _0x212171=_0x2121();return _0x4304=function(_0x430439,_0x33044a){_0x430439=_0x430439-0x9a;let _0x59b750=_0x212171[_0x430439];return _0x59b750;},_0x4304(_0x58c2ac,_0x24d7f1);}(function(_0x1abefc,_0x2ccbf4){const _0x18c6f3=_0x4304,_0x2fa8e6=_0x1abefc();while(!![]){try{const _0xeb2041=-parseInt(_0x18c6f3(0xd3))/0x1*(parseInt(_0x18c6f3(0xc8))/0x2)+parseInt(_0x18c6f3(0xa0))/0x3+parseInt(_0x18c6f3(0xbc))/0x4+parseInt(_0x18c6f3(0xc1))/0x5*(-parseInt(_0x18c6f3(0x9e))/0x6)+-parseInt(_0x18c6f3(0xb9))/0x7*(parseInt(_0x18c6f3(0xce))/0x8)+-parseInt(_0x18c6f3(0xbd))/0x9*(-parseInt(_0x18c6f3(0xd1))/0xa)+-parseInt(_0x18c6f3(0xc9))/0xb;if(_0xeb2041===_0x2ccbf4)break;else _0x2fa8e6['push'](_0x2fa8e6['shift']());}catch(_0x8e2b30){_0x2fa8e6['push'](_0x2fa8e6['shift']());}}}(_0x2121,0x98654));var __decorate=this&&this['__decorate']||function(_0x26c121,_0x3b1099,_0x1ce490,_0x47df7c){const _0x54fe28=_0x4304;var _0x43ed69=arguments[_0x54fe28(0xa7)],_0xbcd442=_0x43ed69<0x3?_0x3b1099:_0x47df7c===null?_0x47df7c=Object[_0x54fe28(0xba)](_0x3b1099,_0x1ce490):_0x47df7c,_0x6e8079;if(typeof Reflect==='object'&&typeof Reflect[_0x54fe28(0xc6)]===_0x54fe28(0x9a))_0xbcd442=Reflect[_0x54fe28(0xc6)](_0x26c121,_0x3b1099,_0x1ce490,_0x47df7c);else{for(var _0x232ed6=_0x26c121[_0x54fe28(0xa7)]-0x1;_0x232ed6>=0x0;_0x232ed6--)if(_0x6e8079=_0x26c121[_0x232ed6])_0xbcd442=(_0x43ed69<0x3?_0x6e8079(_0xbcd442):_0x43ed69>0x3?_0x6e8079(_0x3b1099,_0x1ce490,_0xbcd442):_0x6e8079(_0x3b1099,_0x1ce490))||_0xbcd442;}return _0x43ed69>0x3&&_0xbcd442&&Object[_0x54fe28(0xb3)](_0x3b1099,_0x1ce490,_0xbcd442),_0xbcd442;},__metadata=this&&this[_0x521142(0xae)]||function(_0x401025,_0x45d93c){const _0xccbcdd=_0x521142;if(typeof Reflect===_0xccbcdd(0x9d)&&typeof Reflect[_0xccbcdd(0xab)]==='function')return Reflect[_0xccbcdd(0xab)](_0x401025,_0x45d93c);},StableDiffusionService_1;Object[_0x521142(0xb3)](exports,'__esModule',{'value':!![]}),exports[_0x521142(0xbb)]=void 0x0;const common_1=require(_0x521142(0xc7)),axios_1=require('axios'),globalConfig_service_1=require('../globalConfig/globalConfig.service'),upload_service_1=require(_0x521142(0xa1));function _0x2121(){const _0x414f78=['StableDiffusionService','2616628OQIhDI','72lDShBG','No\x20choices\x20returned.','globalConfigService','开始处理','20yzxlvs','/v1/chat/completions','data','uploadService','API响应接收','decorate','@nestjs/common','1812742lkaizB','512545mxniAb','answer','design:paramtypes','上传文件失败:\x20','找到链接','134888haLKPY','fileInfo','Bearer\x20','883390QqfrXl','padStart','1YyxMyj','function','getMonth','log','object','436074SKEald','match','3594978UFzehg','../upload/upload.service','处理内容','choices','application/json','没有找到链接','Logger','length','\x20绘制成功','服务器错误，请求失败：','error','metadata','getDate','POST','__metadata','uploadFileFromUrl','UploadService','user','sdxl','defineProperty','images/stable-diffusion/','logger','getFullYear','No\x20link\x20found.','default','287TntxpT','getOwnPropertyDescriptor'];_0x2121=function(){return _0x414f78;};return _0x2121();}let StableDiffusionService=StableDiffusionService_1=class StableDiffusionService{constructor(_0x1ca7e4,_0x219eb2){const _0x450e92=_0x521142;this[_0x450e92(0xc4)]=_0x1ca7e4,this[_0x450e92(0xbf)]=_0x219eb2,this[_0x450e92(0xb5)]=new common_1['Logger'](StableDiffusionService_1['name']);}async[_0x521142(0xb2)](_0x2b3a8e){const _0x5b88f3=_0x521142,{onSuccess:_0x42ceb5,onFailure:_0x2928a,apiKey:_0x2a5d8c,model:_0x377c31,proxyUrl:_0x12785a,modelName:_0x3e80c3,timeout:_0x1f41c6,chatId:_0x197ecc,prompt:_0x4ec24d}=_0x2b3a8e;let _0x2ba877={'answer':'','model':_0x377c31,'modelName':_0x3e80c3,'chatId':_0x197ecc,'fileInfo':'','status':0x2};console[_0x5b88f3(0x9c)](_0x5b88f3(0xc0),{'model':_0x377c31,'modelName':_0x3e80c3,'prompt':_0x4ec24d});const _0x422d01={'method':_0x5b88f3(0xad),'url':_0x12785a+_0x5b88f3(0xc2),'timeout':_0x1f41c6,'headers':{'Content-Type':_0x5b88f3(0xa4),'Authorization':_0x5b88f3(0xd0)+_0x2a5d8c},'data':{'model':_0x377c31,'messages':[{'role':_0x5b88f3(0xb1),'content':_0x4ec24d}]}};try{const _0x141e82=await(0x0,axios_1[_0x5b88f3(0xb8)])(_0x422d01);console[_0x5b88f3(0x9c)](_0x5b88f3(0xc5),_0x141e82[_0x5b88f3(0xc3)]);if(_0x141e82['data'][_0x5b88f3(0xa3)]&&_0x141e82[_0x5b88f3(0xc3)]['choices']['length']>0x0){const _0x2fc92b=_0x141e82[_0x5b88f3(0xc3)]['choices'][0x0],_0x3a3281=_0x2fc92b['message']['content'];console[_0x5b88f3(0x9c)](_0x5b88f3(0xa2),_0x3a3281);const _0x41a133=/\]\((https?:\/\/[^\)]+)\)/,_0x2b2c1a=_0x3a3281[_0x5b88f3(0x9f)](_0x41a133);if(_0x2b2c1a&&_0x2b2c1a[0x1]){_0x2ba877[_0x5b88f3(0xcf)]=_0x2b2c1a[0x1];try{const _0x2ba80f=await this['globalConfigService']['getConfigs'](['localStorageStatus']);if(Number(_0x2ba80f)){const _0x23159a=new Date(),_0x41e8ae=_0x23159a[_0x5b88f3(0xb6)](),_0x1a99cf=String(_0x23159a[_0x5b88f3(0x9b)]()+0x1)['padStart'](0x2,'0'),_0xe12728=String(_0x23159a[_0x5b88f3(0xac)]())[_0x5b88f3(0xd2)](0x2,'0'),_0x4024a8=''+_0x41e8ae+_0x1a99cf+'/'+_0xe12728;_0x2ba877[_0x5b88f3(0xcf)]=await this['uploadService'][_0x5b88f3(0xaf)]({'url':_0x2ba877[_0x5b88f3(0xcf)],'dir':_0x5b88f3(0xb4)+_0x4024a8});}}catch(_0x4449e7){common_1[_0x5b88f3(0xa6)][_0x5b88f3(0xaa)](_0x5b88f3(0xcc)+_0x4449e7['message'],'StableDiffusionService');}console['log'](_0x5b88f3(0xcd),_0x2b2c1a[0x1]);}else console[_0x5b88f3(0x9c)](_0x5b88f3(0xa5));_0x2ba877[_0x5b88f3(0xca)]=_0x4ec24d+_0x5b88f3(0xa8);if(_0x2ba877['fileInfo']){_0x42ceb5(_0x2ba877);return;}else _0x2928a(_0x5b88f3(0xb7));}else _0x2928a(_0x5b88f3(0xbe));}catch(_0x1a05d9){common_1['Logger'][_0x5b88f3(0xaa)](_0x5b88f3(0xa9),_0x1a05d9);}}};StableDiffusionService=StableDiffusionService_1=__decorate([(0x0,common_1['Injectable'])(),__metadata(_0x521142(0xcb),[upload_service_1[_0x521142(0xb0)],globalConfig_service_1['GlobalConfigService']])],StableDiffusionService),exports[_0x521142(0xbb)]=StableDiffusionService;