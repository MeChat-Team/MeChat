'use strict';const _0xaece1f=_0x2f5f;(function(_0x16ab4d,_0x251a12){const _0x99cede=_0x2f5f,_0x3bd028=_0x16ab4d();while(!![]){try{const _0x838244=-parseInt(_0x99cede(0x170))/0x1+-parseInt(_0x99cede(0x15b))/0x2*(-parseInt(_0x99cede(0x165))/0x3)+-parseInt(_0x99cede(0x163))/0x4*(parseInt(_0x99cede(0x17b))/0x5)+parseInt(_0x99cede(0x17e))/0x6*(-parseInt(_0x99cede(0x17a))/0x7)+-parseInt(_0x99cede(0x18a))/0x8+-parseInt(_0x99cede(0x184))/0x9+parseInt(_0x99cede(0x178))/0xa;if(_0x838244===_0x251a12)break;else _0x3bd028['push'](_0x3bd028['shift']());}catch(_0x1a68e4){_0x3bd028['push'](_0x3bd028['shift']());}}}(_0x3a09,0x6e22b));function _0x2f5f(_0x4e3366,_0x17bd82){const _0x3a0938=_0x3a09();return _0x2f5f=function(_0x2f5fe2,_0x234b6c){_0x2f5fe2=_0x2f5fe2-0x15b;let _0x201e88=_0x3a0938[_0x2f5fe2];return _0x201e88;},_0x2f5f(_0x4e3366,_0x17bd82);}function _0x3a09(){const _0x2d098b=['StableDiffusionService','axios','metadata','106724NotLYq','defineProperty','219HolRzY','object','choices','Logger','logger','服务器错误，请求失败：','design:paramtypes','处理内容','log','default','user','130794OMpfgG','没有找到链接','上传文件失败:\x20','__esModule','API响应接收','../globalConfig/globalConfig.service','padStart','POST','23186230RaxQmU','getOwnPropertyDescriptor','32431HAaWHG','145dpbsAg','length','content','708SzZSKw','data','error','function','/v1/chat/completions','globalConfigService','6719436OkfEtA','getConfigs','answer','__metadata','@nestjs/common','match','3224200ICXtiH','UploadService','开始处理','fileInfo','\x20绘制成功','20092ZVDJjt','Injectable','getMonth','decorate','getDate'];_0x3a09=function(){return _0x2d098b;};return _0x3a09();}var __decorate=this&&this['__decorate']||function(_0x1b4281,_0x1d9259,_0x27c49c,_0x4f525e){const _0x59b65=_0x2f5f;var _0x4761b2=arguments[_0x59b65(0x17c)],_0x660af8=_0x4761b2<0x3?_0x1d9259:_0x4f525e===null?_0x4f525e=Object[_0x59b65(0x179)](_0x1d9259,_0x27c49c):_0x4f525e,_0x5f722c;if(typeof Reflect===_0x59b65(0x166)&&typeof Reflect[_0x59b65(0x15e)]===_0x59b65(0x181))_0x660af8=Reflect['decorate'](_0x1b4281,_0x1d9259,_0x27c49c,_0x4f525e);else{for(var _0x16b5c9=_0x1b4281[_0x59b65(0x17c)]-0x1;_0x16b5c9>=0x0;_0x16b5c9--)if(_0x5f722c=_0x1b4281[_0x16b5c9])_0x660af8=(_0x4761b2<0x3?_0x5f722c(_0x660af8):_0x4761b2>0x3?_0x5f722c(_0x1d9259,_0x27c49c,_0x660af8):_0x5f722c(_0x1d9259,_0x27c49c))||_0x660af8;}return _0x4761b2>0x3&&_0x660af8&&Object[_0x59b65(0x164)](_0x1d9259,_0x27c49c,_0x660af8),_0x660af8;},__metadata=this&&this[_0xaece1f(0x187)]||function(_0x3ef0a2,_0x19138b){const _0x21285c=_0xaece1f;if(typeof Reflect===_0x21285c(0x166)&&typeof Reflect[_0x21285c(0x162)]==='function')return Reflect[_0x21285c(0x162)](_0x3ef0a2,_0x19138b);},StableDiffusionService_1;Object[_0xaece1f(0x164)](exports,_0xaece1f(0x173),{'value':!![]}),exports[_0xaece1f(0x160)]=void 0x0;const common_1=require(_0xaece1f(0x188)),axios_1=require(_0xaece1f(0x161)),globalConfig_service_1=require(_0xaece1f(0x175)),upload_service_1=require('../upload/upload.service');let StableDiffusionService=StableDiffusionService_1=class StableDiffusionService{constructor(_0x281da9,_0x246671){const _0x6c04e3=_0xaece1f;this['uploadService']=_0x281da9,this[_0x6c04e3(0x183)]=_0x246671,this[_0x6c04e3(0x169)]=new common_1[(_0x6c04e3(0x168))](StableDiffusionService_1['name']);}async['sdxl'](_0x47110a){const _0x38e385=_0xaece1f,{onSuccess:_0x152694,onFailure:_0x14069b,apiKey:_0x43a699,model:_0x2c50d0,proxyUrl:_0x51f693,modelName:_0x44eab4,timeout:_0x3708b6,chatId:_0x229f47,prompt:_0x3f8864}=_0x47110a;let _0x48c19b={'answer':'','model':_0x2c50d0,'modelName':_0x44eab4,'chatId':_0x229f47,'fileInfo':'','status':0x2};console['log'](_0x38e385(0x18c),{'model':_0x2c50d0,'modelName':_0x44eab4,'prompt':_0x3f8864});const _0x56a3b1={'method':_0x38e385(0x177),'url':_0x51f693+_0x38e385(0x182),'timeout':_0x3708b6,'headers':{'Content-Type':'application/json','Authorization':'Bearer\x20'+_0x43a699},'data':{'model':_0x2c50d0,'messages':[{'role':_0x38e385(0x16f),'content':_0x3f8864}]}};try{const _0x4cf3da=await(0x0,axios_1[_0x38e385(0x16e)])(_0x56a3b1);console[_0x38e385(0x16d)](_0x38e385(0x174),_0x4cf3da['data']);if(_0x4cf3da[_0x38e385(0x17f)]['choices']&&_0x4cf3da['data'][_0x38e385(0x167)]['length']>0x0){const _0x5070b4=_0x4cf3da[_0x38e385(0x17f)][_0x38e385(0x167)][0x0],_0x189e11=_0x5070b4['message'][_0x38e385(0x17d)];console[_0x38e385(0x16d)](_0x38e385(0x16c),_0x189e11);const _0x1e734d=/\]\((https?:\/\/[^\)]+)\)/,_0x57414a=_0x189e11[_0x38e385(0x189)](_0x1e734d);if(_0x57414a&&_0x57414a[0x1]){_0x48c19b['fileInfo']=_0x57414a[0x1];try{const _0x3baaf8=await this[_0x38e385(0x183)][_0x38e385(0x185)](['localStorageStatus']);if(Number(_0x3baaf8)){const _0x1c5631=new Date(),_0x1d5a3d=_0x1c5631['getFullYear'](),_0xc92256=String(_0x1c5631[_0x38e385(0x15d)]()+0x1)[_0x38e385(0x176)](0x2,'0'),_0x5d9870=String(_0x1c5631[_0x38e385(0x15f)]())[_0x38e385(0x176)](0x2,'0'),_0x2f6b2e=''+_0x1d5a3d+_0xc92256+'/'+_0x5d9870;_0x48c19b[_0x38e385(0x18d)]=await this['uploadService']['uploadFileFromUrl']({'url':_0x48c19b[_0x38e385(0x18d)],'dir':'images/stable-diffusion/'+_0x2f6b2e});}}catch(_0x41bcbb){common_1[_0x38e385(0x168)][_0x38e385(0x180)](_0x38e385(0x172)+_0x41bcbb['message'],_0x38e385(0x160));}console[_0x38e385(0x16d)]('找到链接',_0x57414a[0x1]);}else console[_0x38e385(0x16d)](_0x38e385(0x171));_0x48c19b[_0x38e385(0x186)]=_0x3f8864+_0x38e385(0x18e);if(_0x48c19b[_0x38e385(0x18d)]){_0x152694(_0x48c19b);return;}else _0x14069b('No\x20link\x20found.');}else _0x14069b('No\x20choices\x20returned.');}catch(_0x782a2b){common_1['Logger'][_0x38e385(0x180)](_0x38e385(0x16a),_0x782a2b);}}};StableDiffusionService=StableDiffusionService_1=__decorate([(0x0,common_1[_0xaece1f(0x15c)])(),__metadata(_0xaece1f(0x16b),[upload_service_1[_0xaece1f(0x18b)],globalConfig_service_1['GlobalConfigService']])],StableDiffusionService),exports[_0xaece1f(0x160)]=StableDiffusionService;