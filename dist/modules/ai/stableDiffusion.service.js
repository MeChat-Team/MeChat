'use strict';const _0x43d9c4=_0xc877;function _0xc877(_0x542fe4,_0xd841bf){const _0x5ae4ba=_0x5ae4();return _0xc877=function(_0xc877d7,_0x40f40a){_0xc877d7=_0xc877d7-0x1db;let _0x4ac051=_0x5ae4ba[_0xc877d7];return _0x4ac051;},_0xc877(_0x542fe4,_0xd841bf);}(function(_0x1ffb68,_0x561e9c){const _0x3473fa=_0xc877,_0x22b670=_0x1ffb68();while(!![]){try{const _0x20d8c0=-parseInt(_0x3473fa(0x1de))/0x1*(-parseInt(_0x3473fa(0x20b))/0x2)+parseInt(_0x3473fa(0x1e2))/0x3*(parseInt(_0x3473fa(0x1fc))/0x4)+-parseInt(_0x3473fa(0x211))/0x5+parseInt(_0x3473fa(0x1eb))/0x6*(-parseInt(_0x3473fa(0x1fe))/0x7)+parseInt(_0x3473fa(0x1dc))/0x8*(parseInt(_0x3473fa(0x1f0))/0x9)+-parseInt(_0x3473fa(0x215))/0xa*(-parseInt(_0x3473fa(0x20d))/0xb)+parseInt(_0x3473fa(0x1dd))/0xc*(-parseInt(_0x3473fa(0x214))/0xd);if(_0x20d8c0===_0x561e9c)break;else _0x22b670['push'](_0x22b670['shift']());}catch(_0xe3afd4){_0x22b670['push'](_0x22b670['shift']());}}}(_0x5ae4,0x845be));var __decorate=this&&this[_0x43d9c4(0x1e9)]||function(_0x22ac24,_0x40e23d,_0x331174,_0x8d9e28){const _0x5ebad8=_0x43d9c4;var _0x850c09=arguments[_0x5ebad8(0x1f8)],_0x3486cf=_0x850c09<0x3?_0x40e23d:_0x8d9e28===null?_0x8d9e28=Object[_0x5ebad8(0x1fd)](_0x40e23d,_0x331174):_0x8d9e28,_0x4035d5;if(typeof Reflect==='object'&&typeof Reflect[_0x5ebad8(0x1f3)]===_0x5ebad8(0x1ee))_0x3486cf=Reflect[_0x5ebad8(0x1f3)](_0x22ac24,_0x40e23d,_0x331174,_0x8d9e28);else{for(var _0x15c5eb=_0x22ac24[_0x5ebad8(0x1f8)]-0x1;_0x15c5eb>=0x0;_0x15c5eb--)if(_0x4035d5=_0x22ac24[_0x15c5eb])_0x3486cf=(_0x850c09<0x3?_0x4035d5(_0x3486cf):_0x850c09>0x3?_0x4035d5(_0x40e23d,_0x331174,_0x3486cf):_0x4035d5(_0x40e23d,_0x331174))||_0x3486cf;}return _0x850c09>0x3&&_0x3486cf&&Object[_0x5ebad8(0x1f4)](_0x40e23d,_0x331174,_0x3486cf),_0x3486cf;},__metadata=this&&this['__metadata']||function(_0xf6ab4e,_0x4ce11d){const _0x30c217=_0x43d9c4;if(typeof Reflect===_0x30c217(0x210)&&typeof Reflect['metadata']===_0x30c217(0x1ee))return Reflect['metadata'](_0xf6ab4e,_0x4ce11d);},StableDiffusionService_1;Object[_0x43d9c4(0x1f4)](exports,_0x43d9c4(0x205),{'value':!![]}),exports['StableDiffusionService']=void 0x0;const common_1=require(_0x43d9c4(0x1f1)),axios_1=require(_0x43d9c4(0x204)),globalConfig_service_1=require(_0x43d9c4(0x213)),upload_service_1=require(_0x43d9c4(0x208));let StableDiffusionService=StableDiffusionService_1=class StableDiffusionService{constructor(_0x2d2b6e,_0x3a469b){const _0x58b19a=_0x43d9c4;this[_0x58b19a(0x1ed)]=_0x2d2b6e,this[_0x58b19a(0x1ff)]=_0x3a469b,this['logger']=new common_1[(_0x58b19a(0x1df))](StableDiffusionService_1[_0x58b19a(0x1e1)]);}async[_0x43d9c4(0x20f)](_0x2d0c31){const _0x3d3af2=_0x43d9c4,{onSuccess:_0x2710b8,onFailure:_0x592dfc,apiKey:_0x4065a5,model:_0x596547,proxyUrl:_0x147f3c,modelName:_0x235114,timeout:_0x28eac4,chatId:_0x56a9cc,prompt:_0x3cca0d}=_0x2d0c31;let _0x2f4594={'answer':'','model':_0x596547,'modelName':_0x235114,'chatId':_0x56a9cc,'fileInfo':'','status':0x2};console[_0x3d3af2(0x1f6)](_0x3d3af2(0x206),{'model':_0x596547,'modelName':_0x235114,'prompt':_0x3cca0d});const _0x3374d5={'method':_0x3d3af2(0x1e3),'url':_0x147f3c+'/v1/chat/completions','timeout':_0x28eac4,'headers':{'Content-Type':_0x3d3af2(0x20a),'Authorization':'Bearer\x20'+_0x4065a5},'data':{'model':_0x596547,'messages':[{'role':_0x3d3af2(0x200),'content':_0x3cca0d}]}};try{const _0xbf11ab=await(0x0,axios_1[_0x3d3af2(0x1e4)])(_0x3374d5);console[_0x3d3af2(0x1f6)](_0x3d3af2(0x1fb),_0xbf11ab[_0x3d3af2(0x1e5)]);if(_0xbf11ab['data']['choices']&&_0xbf11ab[_0x3d3af2(0x1e5)][_0x3d3af2(0x203)]['length']>0x0){const _0x32f21d=_0xbf11ab[_0x3d3af2(0x1e5)][_0x3d3af2(0x203)][0x0],_0x1c63f2=_0x32f21d[_0x3d3af2(0x1fa)][_0x3d3af2(0x20c)];console[_0x3d3af2(0x1f6)](_0x3d3af2(0x1e7),_0x1c63f2);const _0xec6053=/\]\((https?:\/\/[^\)]+)\)/,_0xad6390=_0x1c63f2[_0x3d3af2(0x1ea)](_0xec6053);if(_0xad6390&&_0xad6390[0x1]){_0x2f4594[_0x3d3af2(0x207)]=_0xad6390[0x1];try{const _0x51c05f=await this['globalConfigService'][_0x3d3af2(0x202)]([_0x3d3af2(0x209)]);if(Number(_0x51c05f)){const _0x513597=new Date(),_0x11c030=_0x513597[_0x3d3af2(0x1db)](),_0x117308=String(_0x513597[_0x3d3af2(0x212)]()+0x1)[_0x3d3af2(0x1e8)](0x2,'0'),_0x16c536=String(_0x513597[_0x3d3af2(0x216)]())[_0x3d3af2(0x1e8)](0x2,'0'),_0xc41958=''+_0x11c030+_0x117308+'/'+_0x16c536;_0x2f4594['fileInfo']=await this[_0x3d3af2(0x1ed)][_0x3d3af2(0x1ef)]({'url':_0x2f4594['fileInfo'],'dir':_0x3d3af2(0x1f7)+_0xc41958});}}catch(_0x8ab4a1){common_1[_0x3d3af2(0x1df)]['error']('上传文件失败:\x20'+_0x8ab4a1[_0x3d3af2(0x1fa)],_0x3d3af2(0x1f9));}console[_0x3d3af2(0x1f6)](_0x3d3af2(0x1f2),_0xad6390[0x1]);}else console[_0x3d3af2(0x1f6)](_0x3d3af2(0x1ec));_0x2f4594['answer']=_0x3cca0d+_0x3d3af2(0x20e);if(_0x2f4594[_0x3d3af2(0x207)]){_0x2710b8(_0x2f4594);return;}else _0x592dfc('No\x20link\x20found.');}else _0x592dfc('No\x20choices\x20returned.');}catch(_0x4bc883){common_1[_0x3d3af2(0x1df)][_0x3d3af2(0x1e0)](_0x3d3af2(0x1f5),_0x4bc883);}}};function _0x5ae4(){const _0x50cd81=['getMonth','../globalConfig/globalConfig.service','122707dbcLsm','10QrodDI','getDate','getFullYear','1384SFlPXD','1236YwzOyP','2LieRUv','Logger','error','name','648ijlkMs','POST','default','data','UploadService','处理内容','padStart','__decorate','match','6aGWmdy','没有找到链接','uploadService','function','uploadFileFromUrl','55287vULlUT','@nestjs/common','找到链接','decorate','defineProperty','服务器错误，请求失败：','log','images/stable-diffusion/','length','StableDiffusionService','message','API响应接收','10732ZgZaWH','getOwnPropertyDescriptor','2897167hfEwwH','globalConfigService','user','design:paramtypes','getConfigs','choices','axios','__esModule','开始处理','fileInfo','../upload/upload.service','localStorageStatus','application/json','470914ouEyBK','content','6539588tcgOUb','\x20绘制成功','sdxl','object','3897245TwjGUn'];_0x5ae4=function(){return _0x50cd81;};return _0x5ae4();}StableDiffusionService=StableDiffusionService_1=__decorate([(0x0,common_1['Injectable'])(),__metadata(_0x43d9c4(0x201),[upload_service_1[_0x43d9c4(0x1e6)],globalConfig_service_1['GlobalConfigService']])],StableDiffusionService),exports[_0x43d9c4(0x1f9)]=StableDiffusionService;