'use strict';const _0x16e540=_0x2c62;(function(_0x48aa76,_0x529e13){const _0x3183ad=_0x2c62,_0x567b18=_0x48aa76();while(!![]){try{const _0x5b14c1=parseInt(_0x3183ad(0x1e1))/0x1*(parseInt(_0x3183ad(0x1de))/0x2)+parseInt(_0x3183ad(0x1f8))/0x3*(-parseInt(_0x3183ad(0x1dc))/0x4)+-parseInt(_0x3183ad(0x1f6))/0x5+parseInt(_0x3183ad(0x1ec))/0x6*(parseInt(_0x3183ad(0x1f1))/0x7)+parseInt(_0x3183ad(0x1f9))/0x8*(parseInt(_0x3183ad(0x1ee))/0x9)+-parseInt(_0x3183ad(0x1d7))/0xa+parseInt(_0x3183ad(0x1fb))/0xb*(parseInt(_0x3183ad(0x1e9))/0xc);if(_0x5b14c1===_0x529e13)break;else _0x567b18['push'](_0x567b18['shift']());}catch(_0x4102b8){_0x567b18['push'](_0x567b18['shift']());}}}(_0x1dd7,0x438ab));function _0x2c62(_0x130dab,_0x527905){const _0x1dd7b2=_0x1dd7();return _0x2c62=function(_0x2c6202,_0x35f751){_0x2c6202=_0x2c6202-0x1c4;let _0xaec577=_0x1dd7b2[_0x2c6202];return _0xaec577;},_0x2c62(_0x130dab,_0x527905);}var __decorate=this&&this[_0x16e540(0x1e2)]||function(_0x2ba95d,_0x200db8,_0x421e63,_0x3f1f3c){const _0x5591e5=_0x16e540;var _0x48a331=arguments['length'],_0x199661=_0x48a331<0x3?_0x200db8:_0x3f1f3c===null?_0x3f1f3c=Object[_0x5591e5(0x1c7)](_0x200db8,_0x421e63):_0x3f1f3c,_0x248150;if(typeof Reflect==='object'&&typeof Reflect[_0x5591e5(0x1f7)]==='function')_0x199661=Reflect['decorate'](_0x2ba95d,_0x200db8,_0x421e63,_0x3f1f3c);else{for(var _0x791541=_0x2ba95d[_0x5591e5(0x1fe)]-0x1;_0x791541>=0x0;_0x791541--)if(_0x248150=_0x2ba95d[_0x791541])_0x199661=(_0x48a331<0x3?_0x248150(_0x199661):_0x48a331>0x3?_0x248150(_0x200db8,_0x421e63,_0x199661):_0x248150(_0x200db8,_0x421e63))||_0x199661;}return _0x48a331>0x3&&_0x199661&&Object['defineProperty'](_0x200db8,_0x421e63,_0x199661),_0x199661;},__metadata=this&&this[_0x16e540(0x1c8)]||function(_0x2b3937,_0x31f2fe){const _0xb91467=_0x16e540;if(typeof Reflect===_0xb91467(0x1c9)&&typeof Reflect['metadata']===_0xb91467(0x1d2))return Reflect[_0xb91467(0x1ca)](_0x2b3937,_0x31f2fe);},StableDiffusionService_1;Object[_0x16e540(0x1c6)](exports,_0x16e540(0x1e5),{'value':!![]}),exports[_0x16e540(0x1fa)]=void 0x0;const common_1=require(_0x16e540(0x1c5)),axios_1=require(_0x16e540(0x203)),globalConfig_service_1=require('../globalConfig/globalConfig.service'),upload_service_1=require(_0x16e540(0x1f3));let StableDiffusionService=StableDiffusionService_1=class StableDiffusionService{constructor(_0xace2d7,_0x4671d7){const _0x57f1e4=_0x16e540;this[_0x57f1e4(0x1f4)]=_0xace2d7,this[_0x57f1e4(0x1d0)]=_0x4671d7,this[_0x57f1e4(0x1e3)]=new common_1['Logger'](StableDiffusionService_1[_0x57f1e4(0x1f0)]);}async[_0x16e540(0x1d5)](_0xf90660){const _0x4df8f2=_0x16e540,{onSuccess:_0x164822,onFailure:_0x14cb37,apiKey:_0x1b7b10,model:_0x3e7b5d,proxyUrl:_0x47c02a,modelName:_0x52dda8,timeout:_0x5d23c9,chatId:_0x7a1369,prompt:_0x3afa9e}=_0xf90660;let _0x267bbb={'answer':'','model':_0x3e7b5d,'modelName':_0x52dda8,'chatId':_0x7a1369,'fileInfo':'','status':0x2};console[_0x4df8f2(0x1df)](_0x4df8f2(0x1cf),{'model':_0x3e7b5d,'modelName':_0x52dda8,'prompt':_0x3afa9e});const _0x2fdd2a={'method':_0x4df8f2(0x202),'url':_0x47c02a+'/v1/chat/completions','timeout':_0x5d23c9,'headers':{'Content-Type':'application/json','Authorization':_0x4df8f2(0x1e7)+_0x1b7b10},'data':{'model':_0x3e7b5d,'messages':[{'role':_0x4df8f2(0x1ed),'content':_0x3afa9e}]}};try{const _0x2c410d=await(0x0,axios_1[_0x4df8f2(0x1e4)])(_0x2fdd2a);console[_0x4df8f2(0x1df)](_0x4df8f2(0x1f5),_0x2c410d[_0x4df8f2(0x1ff)]);if(_0x2c410d[_0x4df8f2(0x1ff)][_0x4df8f2(0x1c4)]&&_0x2c410d['data'][_0x4df8f2(0x1c4)][_0x4df8f2(0x1fe)]>0x0){const _0x2984e9=_0x2c410d[_0x4df8f2(0x1ff)]['choices'][0x0],_0x56525e=_0x2984e9[_0x4df8f2(0x1d3)][_0x4df8f2(0x200)];console[_0x4df8f2(0x1df)](_0x4df8f2(0x1cc),_0x56525e);const _0x5abeae=/\]\((https?:\/\/[^\)]+)\)/,_0x3642e6=_0x56525e[_0x4df8f2(0x1ea)](_0x5abeae);if(_0x3642e6&&_0x3642e6[0x1]){_0x267bbb[_0x4df8f2(0x1d9)]=_0x3642e6[0x1];try{const _0xc649a9=await this[_0x4df8f2(0x1d0)][_0x4df8f2(0x1eb)]([_0x4df8f2(0x201)]);if(Number(_0xc649a9)){const _0x3e832c=new Date(),_0xa76635=_0x3e832c['getFullYear'](),_0x438caa=String(_0x3e832c['getMonth']()+0x1)[_0x4df8f2(0x1dd)](0x2,'0'),_0x2c6380=String(_0x3e832c[_0x4df8f2(0x1cd)]())[_0x4df8f2(0x1dd)](0x2,'0'),_0x31eb22=''+_0xa76635+_0x438caa+'/'+_0x2c6380;_0x267bbb[_0x4df8f2(0x1d9)]=await this[_0x4df8f2(0x1f4)][_0x4df8f2(0x1d8)]({'url':_0x267bbb[_0x4df8f2(0x1d9)],'dir':_0x4df8f2(0x1ce)+_0x31eb22});}}catch(_0x1e8b43){common_1[_0x4df8f2(0x1e6)][_0x4df8f2(0x1cb)](_0x4df8f2(0x1ef)+_0x1e8b43[_0x4df8f2(0x1d3)],_0x4df8f2(0x1fa));}console[_0x4df8f2(0x1df)](_0x4df8f2(0x1d1),_0x3642e6[0x1]);}else console[_0x4df8f2(0x1df)](_0x4df8f2(0x1db));_0x267bbb[_0x4df8f2(0x1da)]=_0x3afa9e+_0x4df8f2(0x1e0);if(_0x267bbb['fileInfo']){_0x164822(_0x267bbb);return;}else _0x14cb37('No\x20link\x20found.');}else _0x14cb37(_0x4df8f2(0x1d6));}catch(_0x576d1e){common_1[_0x4df8f2(0x1e6)][_0x4df8f2(0x1cb)](_0x4df8f2(0x1f2),_0x576d1e);}}};function _0x1dd7(){const _0x1c67a0=['__metadata','object','metadata','error','处理内容','getDate','images/stable-diffusion/','开始处理','globalConfigService','找到链接','function','message','design:paramtypes','sdxl','No\x20choices\x20returned.','79100QqwWOf','uploadFileFromUrl','fileInfo','answer','没有找到链接','4OvMuJk','padStart','10420sNuLyg','log','\x20绘制成功','13uolFVk','__decorate','logger','default','__esModule','Logger','Bearer\x20','UploadService','2601636BYBsLE','match','getConfigs','6qJZVMh','user','486fjTzeh','上传文件失败:\x20','name','121723AQyNBg','服务器错误，请求失败：','../upload/upload.service','uploadService','API响应接收','96680GsErvO','decorate','359223XJWoBc','18032CeEveq','StableDiffusionService','11vnlJWN','GlobalConfigService','Injectable','length','data','content','localStorageStatus','POST','axios','choices','@nestjs/common','defineProperty','getOwnPropertyDescriptor'];_0x1dd7=function(){return _0x1c67a0;};return _0x1dd7();}StableDiffusionService=StableDiffusionService_1=__decorate([(0x0,common_1[_0x16e540(0x1fd)])(),__metadata(_0x16e540(0x1d4),[upload_service_1[_0x16e540(0x1e8)],globalConfig_service_1[_0x16e540(0x1fc)]])],StableDiffusionService),exports['StableDiffusionService']=StableDiffusionService;