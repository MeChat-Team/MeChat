'use strict';function _0x3478(_0x5dbc8c,_0x4bd880){const _0x29825e=_0x2982();return _0x3478=function(_0x34789e,_0x5f41e2){_0x34789e=_0x34789e-0x141;let _0xcd849c=_0x29825e[_0x34789e];return _0xcd849c;},_0x3478(_0x5dbc8c,_0x4bd880);}const _0x9dc67a=_0x3478;(function(_0xcf1e15,_0x3f78b8){const _0x240dea=_0x3478,_0x81d9a3=_0xcf1e15();while(!![]){try{const _0x40074f=parseInt(_0x240dea(0x146))/0x1*(parseInt(_0x240dea(0x172))/0x2)+-parseInt(_0x240dea(0x158))/0x3+parseInt(_0x240dea(0x155))/0x4*(-parseInt(_0x240dea(0x156))/0x5)+-parseInt(_0x240dea(0x14b))/0x6+parseInt(_0x240dea(0x166))/0x7*(-parseInt(_0x240dea(0x145))/0x8)+-parseInt(_0x240dea(0x169))/0x9+parseInt(_0x240dea(0x152))/0xa;if(_0x40074f===_0x3f78b8)break;else _0x81d9a3['push'](_0x81d9a3['shift']());}catch(_0x2fe44a){_0x81d9a3['push'](_0x81d9a3['shift']());}}}(_0x2982,0xdd5f5));var __decorate=this&&this[_0x9dc67a(0x16a)]||function(_0x97cb89,_0x149577,_0x156efc,_0x4996ff){const _0x3d3b33=_0x9dc67a;var _0x33e7a1=arguments[_0x3d3b33(0x174)],_0x315302=_0x33e7a1<0x3?_0x149577:_0x4996ff===null?_0x4996ff=Object[_0x3d3b33(0x149)](_0x149577,_0x156efc):_0x4996ff,_0x30e8a1;if(typeof Reflect===_0x3d3b33(0x14d)&&typeof Reflect[_0x3d3b33(0x159)]===_0x3d3b33(0x176))_0x315302=Reflect[_0x3d3b33(0x159)](_0x97cb89,_0x149577,_0x156efc,_0x4996ff);else{for(var _0x11ef33=_0x97cb89[_0x3d3b33(0x174)]-0x1;_0x11ef33>=0x0;_0x11ef33--)if(_0x30e8a1=_0x97cb89[_0x11ef33])_0x315302=(_0x33e7a1<0x3?_0x30e8a1(_0x315302):_0x33e7a1>0x3?_0x30e8a1(_0x149577,_0x156efc,_0x315302):_0x30e8a1(_0x149577,_0x156efc))||_0x315302;}return _0x33e7a1>0x3&&_0x315302&&Object['defineProperty'](_0x149577,_0x156efc,_0x315302),_0x315302;},__metadata=this&&this['__metadata']||function(_0x434d87,_0x633c3b){const _0x50011f=_0x9dc67a;if(typeof Reflect===_0x50011f(0x14d)&&typeof Reflect[_0x50011f(0x144)]===_0x50011f(0x176))return Reflect[_0x50011f(0x144)](_0x434d87,_0x633c3b);},StableDiffusionService_1;Object[_0x9dc67a(0x15a)](exports,_0x9dc67a(0x165),{'value':!![]}),exports[_0x9dc67a(0x162)]=void 0x0;const common_1=require(_0x9dc67a(0x15c)),axios_1=require(_0x9dc67a(0x177)),globalConfig_service_1=require('../globalConfig/globalConfig.service'),upload_service_1=require(_0x9dc67a(0x150));let StableDiffusionService=StableDiffusionService_1=class StableDiffusionService{constructor(_0x16192b,_0xfe03c){const _0xfebd4e=_0x9dc67a;this[_0xfebd4e(0x153)]=_0x16192b,this[_0xfebd4e(0x142)]=_0xfe03c,this[_0xfebd4e(0x154)]=new common_1[(_0xfebd4e(0x170))](StableDiffusionService_1['name']);}async[_0x9dc67a(0x171)](_0x4237f3){const _0x315ba9=_0x9dc67a,{onSuccess:_0x2cce79,onFailure:_0x5a3664,apiKey:_0x2a1e8a,model:_0x30ad24,proxyUrl:_0x147fd7,modelName:_0x323740,timeout:_0x48cde9,chatId:_0x4c60b4,prompt:_0x55447c}=_0x4237f3;let _0x284bd3={'answer':'','model':_0x30ad24,'modelName':_0x323740,'chatId':_0x4c60b4,'fileInfo':'','status':0x2};console[_0x315ba9(0x15f)]('开始处理',{'model':_0x30ad24,'modelName':_0x323740,'prompt':_0x55447c});const _0x4a7539={'method':_0x315ba9(0x151),'url':_0x147fd7+_0x315ba9(0x14c),'timeout':_0x48cde9,'headers':{'Content-Type':_0x315ba9(0x16f),'Authorization':_0x315ba9(0x141)+_0x2a1e8a},'data':{'model':_0x30ad24,'messages':[{'role':'user','content':_0x55447c}]}};try{const _0x28bc16=await(0x0,axios_1['default'])(_0x4a7539);console[_0x315ba9(0x15f)](_0x315ba9(0x147),_0x28bc16[_0x315ba9(0x148)]);if(_0x28bc16[_0x315ba9(0x148)][_0x315ba9(0x15b)]&&_0x28bc16[_0x315ba9(0x148)][_0x315ba9(0x15b)][_0x315ba9(0x174)]>0x0){const _0x52e0cc=_0x28bc16[_0x315ba9(0x148)]['choices'][0x0],_0x14bddd=_0x52e0cc['message']['content'];console[_0x315ba9(0x15f)](_0x315ba9(0x167),_0x14bddd);const _0x49394f=/\]\((https?:\/\/[^\)]+)\)/,_0x5a4229=_0x14bddd['match'](_0x49394f);if(_0x5a4229&&_0x5a4229[0x1]){_0x284bd3[_0x315ba9(0x14a)]=_0x5a4229[0x1];try{const _0x46afdd=await this['globalConfigService'][_0x315ba9(0x15e)](['localStorageStatus']);if(Number(_0x46afdd)){const _0x282df2=new Date(),_0x58f2d0=_0x282df2[_0x315ba9(0x164)](),_0x1fbe2b=String(_0x282df2[_0x315ba9(0x15d)]()+0x1)[_0x315ba9(0x16b)](0x2,'0'),_0x23441d=String(_0x282df2[_0x315ba9(0x163)]())[_0x315ba9(0x16b)](0x2,'0'),_0x413c8a=''+_0x58f2d0+_0x1fbe2b+'/'+_0x23441d;_0x284bd3['fileInfo']=await this['uploadService'][_0x315ba9(0x16c)]({'url':_0x284bd3[_0x315ba9(0x14a)],'dir':'images/stable-diffusion/'+_0x413c8a});}}catch(_0x12f6ce){common_1[_0x315ba9(0x170)][_0x315ba9(0x14f)](_0x315ba9(0x16d)+_0x12f6ce[_0x315ba9(0x168)],_0x315ba9(0x162));}console[_0x315ba9(0x15f)](_0x315ba9(0x16e),_0x5a4229[0x1]);}else console[_0x315ba9(0x15f)](_0x315ba9(0x160));_0x284bd3['answer']=_0x55447c+_0x315ba9(0x173);if(_0x284bd3['fileInfo']){_0x2cce79(_0x284bd3);return;}else _0x5a3664(_0x315ba9(0x178));}else _0x5a3664(_0x315ba9(0x143));}catch(_0x3e6583){common_1[_0x315ba9(0x170)]['error'](_0x315ba9(0x14e),_0x3e6583);}}};function _0x2982(){const _0x5e9e9e=['axios','No\x20link\x20found.','Bearer\x20','globalConfigService','No\x20choices\x20returned.','metadata','8QKTGjV','5bNSEpo','API响应接收','data','getOwnPropertyDescriptor','fileInfo','10244730kHMabW','/v1/chat/completions','object','服务器错误，请求失败：','error','../upload/upload.service','POST','46099380yFrdPK','uploadService','logger','1289436RCToXq','5IkmKiw','design:paramtypes','1315221bEYRhx','decorate','defineProperty','choices','@nestjs/common','getMonth','getConfigs','log','没有找到链接','Injectable','StableDiffusionService','getDate','getFullYear','__esModule','8623601vAgflV','处理内容','message','8373897OJuvvD','__decorate','padStart','uploadFileFromUrl','上传文件失败:\x20','找到链接','application/json','Logger','sdxl','370960ANmjlX','\x20绘制成功','length','UploadService','function'];_0x2982=function(){return _0x5e9e9e;};return _0x2982();}StableDiffusionService=StableDiffusionService_1=__decorate([(0x0,common_1[_0x9dc67a(0x161)])(),__metadata(_0x9dc67a(0x157),[upload_service_1[_0x9dc67a(0x175)],globalConfig_service_1['GlobalConfigService']])],StableDiffusionService),exports[_0x9dc67a(0x162)]=StableDiffusionService;