'use strict';const _0x28809c=_0x4df5;(function(_0x1fac0f,_0x58f888){const _0x9f70e5=_0x4df5,_0x2da179=_0x1fac0f();while(!![]){try{const _0x383511=parseInt(_0x9f70e5(0xbf))/0x1*(-parseInt(_0x9f70e5(0xc6))/0x2)+parseInt(_0x9f70e5(0xc4))/0x3*(-parseInt(_0x9f70e5(0x9d))/0x4)+-parseInt(_0x9f70e5(0xd1))/0x5*(-parseInt(_0x9f70e5(0xcb))/0x6)+-parseInt(_0x9f70e5(0xbd))/0x7+parseInt(_0x9f70e5(0x9e))/0x8*(parseInt(_0x9f70e5(0xc3))/0x9)+parseInt(_0x9f70e5(0xcf))/0xa*(parseInt(_0x9f70e5(0xb6))/0xb)+-parseInt(_0x9f70e5(0xb3))/0xc*(-parseInt(_0x9f70e5(0xc8))/0xd);if(_0x383511===_0x58f888)break;else _0x2da179['push'](_0x2da179['shift']());}catch(_0x747c2c){_0x2da179['push'](_0x2da179['shift']());}}}(_0x2f5c,0x244b2));function _0x4df5(_0x1e8bb8,_0x255a0e){const _0x2f5cc6=_0x2f5c();return _0x4df5=function(_0x4df52c,_0x114354){_0x4df52c=_0x4df52c-0x98;let _0x286f22=_0x2f5cc6[_0x4df52c];return _0x286f22;},_0x4df5(_0x1e8bb8,_0x255a0e);}var __decorate=this&&this[_0x28809c(0x98)]||function(_0x5ec000,_0x248ab6,_0x40858e,_0x399aa7){const _0x16c38a=_0x28809c;var _0x26e241=arguments['length'],_0xad8fca=_0x26e241<0x3?_0x248ab6:_0x399aa7===null?_0x399aa7=Object['getOwnPropertyDescriptor'](_0x248ab6,_0x40858e):_0x399aa7,_0x2d5126;if(typeof Reflect==='object'&&typeof Reflect['decorate']===_0x16c38a(0xc7))_0xad8fca=Reflect['decorate'](_0x5ec000,_0x248ab6,_0x40858e,_0x399aa7);else{for(var _0x534857=_0x5ec000['length']-0x1;_0x534857>=0x0;_0x534857--)if(_0x2d5126=_0x5ec000[_0x534857])_0xad8fca=(_0x26e241<0x3?_0x2d5126(_0xad8fca):_0x26e241>0x3?_0x2d5126(_0x248ab6,_0x40858e,_0xad8fca):_0x2d5126(_0x248ab6,_0x40858e))||_0xad8fca;}return _0x26e241>0x3&&_0xad8fca&&Object[_0x16c38a(0xba)](_0x248ab6,_0x40858e,_0xad8fca),_0xad8fca;},__metadata=this&&this[_0x28809c(0xc0)]||function(_0x39bc81,_0xc949b1){const _0x507a1e=_0x28809c;if(typeof Reflect===_0x507a1e(0xd0)&&typeof Reflect['metadata']==='function')return Reflect['metadata'](_0x39bc81,_0xc949b1);},StableDiffusionService_1;Object[_0x28809c(0xba)](exports,'__esModule',{'value':!![]}),exports[_0x28809c(0xa4)]=void 0x0;function _0x2f5c(){const _0x267c3b=['object','15Zhiipl','application/json','__decorate','找到链接','Bearer\x20','data','padStart','4UAjcVp','136064PXvYPS','UploadService','default','log','sdxl','../globalConfig/globalConfig.service','StableDiffusionService','uploadService','POST','fileInfo','match','content','getConfigs','message','@nestjs/common','没有找到链接','globalConfigService','design:paramtypes','GlobalConfigService','开始处理','\x20绘制成功','1620876DxAsBB','axios','images/stable-diffusion/','814YTRsCQ','logger','API响应接收','answer','defineProperty','getFullYear','服务器错误，请求失败：','857815DybMyr','No\x20choices\x20returned.','40731wmynbR','__metadata','choices','error','36gfJnWJ','476832MJJzxh','../upload/upload.service','6UaAHgS','function','13MnKNAs','user','Logger','372426ZdlMDb','Injectable','getDate','length','22030RIpKgT'];_0x2f5c=function(){return _0x267c3b;};return _0x2f5c();}const common_1=require(_0x28809c(0xac)),axios_1=require(_0x28809c(0xb4)),globalConfig_service_1=require(_0x28809c(0xa3)),upload_service_1=require(_0x28809c(0xc5));let StableDiffusionService=StableDiffusionService_1=class StableDiffusionService{constructor(_0x522c33,_0x4de049){const _0x9467b=_0x28809c;this[_0x9467b(0xa5)]=_0x522c33,this[_0x9467b(0xae)]=_0x4de049,this[_0x9467b(0xb7)]=new common_1[(_0x9467b(0xca))](StableDiffusionService_1['name']);}async[_0x28809c(0xa2)](_0x437452){const _0x16e091=_0x28809c,{onSuccess:_0x33fae8,onFailure:_0x4b5649,apiKey:_0x35217c,model:_0x3a42b5,proxyUrl:_0x146432,modelName:_0x3d08d3,timeout:_0x69199,chatId:_0x2c531c,prompt:_0x4723ec}=_0x437452;let _0x185635={'answer':'','model':_0x3a42b5,'modelName':_0x3d08d3,'chatId':_0x2c531c,'fileInfo':'','status':0x2};console[_0x16e091(0xa1)](_0x16e091(0xb1),{'model':_0x3a42b5,'modelName':_0x3d08d3,'prompt':_0x4723ec});const _0x2627f0={'method':_0x16e091(0xa6),'url':_0x146432+'/v1/chat/completions','timeout':_0x69199,'headers':{'Content-Type':_0x16e091(0xd2),'Authorization':_0x16e091(0x9a)+_0x35217c},'data':{'model':_0x3a42b5,'messages':[{'role':_0x16e091(0xc9),'content':_0x4723ec}]}};try{const _0x1724d0=await(0x0,axios_1[_0x16e091(0xa0)])(_0x2627f0);console[_0x16e091(0xa1)](_0x16e091(0xb8),_0x1724d0[_0x16e091(0x9b)]);if(_0x1724d0[_0x16e091(0x9b)][_0x16e091(0xc1)]&&_0x1724d0['data']['choices'][_0x16e091(0xce)]>0x0){const _0x3a72f0=_0x1724d0[_0x16e091(0x9b)][_0x16e091(0xc1)][0x0],_0x352124=_0x3a72f0[_0x16e091(0xab)][_0x16e091(0xa9)];console[_0x16e091(0xa1)]('处理内容',_0x352124);const _0xfb4379=/\]\((https?:\/\/[^\)]+)\)/,_0x1a7ea4=_0x352124[_0x16e091(0xa8)](_0xfb4379);if(_0x1a7ea4&&_0x1a7ea4[0x1]){_0x185635[_0x16e091(0xa7)]=_0x1a7ea4[0x1];try{const _0x32a3a7=await this[_0x16e091(0xae)][_0x16e091(0xaa)](['localStorageStatus']);if(Number(_0x32a3a7)){const _0x224f85=new Date(),_0x13368a=_0x224f85[_0x16e091(0xbb)](),_0x52b70f=String(_0x224f85['getMonth']()+0x1)[_0x16e091(0x9c)](0x2,'0'),_0x3fd3e5=String(_0x224f85[_0x16e091(0xcd)]())[_0x16e091(0x9c)](0x2,'0'),_0x494fca=''+_0x13368a+_0x52b70f+'/'+_0x3fd3e5;_0x185635['fileInfo']=await this[_0x16e091(0xa5)]['uploadFileFromUrl']({'url':_0x185635[_0x16e091(0xa7)],'dir':_0x16e091(0xb5)+_0x494fca});}}catch(_0x12f086){common_1[_0x16e091(0xca)][_0x16e091(0xc2)]('上传文件失败:\x20'+_0x12f086[_0x16e091(0xab)],_0x16e091(0xa4));}console['log'](_0x16e091(0x99),_0x1a7ea4[0x1]);}else console[_0x16e091(0xa1)](_0x16e091(0xad));_0x185635[_0x16e091(0xb9)]=_0x4723ec+_0x16e091(0xb2);if(_0x185635[_0x16e091(0xa7)]){_0x33fae8(_0x185635);return;}else _0x4b5649('No\x20link\x20found.');}else _0x4b5649(_0x16e091(0xbe));}catch(_0x16a0ac){common_1[_0x16e091(0xca)]['error'](_0x16e091(0xbc),_0x16a0ac);}}};StableDiffusionService=StableDiffusionService_1=__decorate([(0x0,common_1[_0x28809c(0xcc)])(),__metadata(_0x28809c(0xaf),[upload_service_1[_0x28809c(0x9f)],globalConfig_service_1[_0x28809c(0xb0)]])],StableDiffusionService),exports[_0x28809c(0xa4)]=StableDiffusionService;