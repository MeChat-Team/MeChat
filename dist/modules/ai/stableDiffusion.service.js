'use strict';function _0xb506(_0x459381,_0x3b9b3c){const _0x5a0472=_0x5a04();return _0xb506=function(_0xb50666,_0x3a0b08){_0xb50666=_0xb50666-0x1dd;let _0x4ba29b=_0x5a0472[_0xb50666];return _0x4ba29b;},_0xb506(_0x459381,_0x3b9b3c);}const _0x1e46b8=_0xb506;(function(_0x1807dd,_0x4ec319){const _0x45a13d=_0xb506,_0x2fe4d4=_0x1807dd();while(!![]){try{const _0x137c04=parseInt(_0x45a13d(0x1de))/0x1+-parseInt(_0x45a13d(0x1df))/0x2*(parseInt(_0x45a13d(0x1e6))/0x3)+parseInt(_0x45a13d(0x1ea))/0x4+-parseInt(_0x45a13d(0x1f4))/0x5+-parseInt(_0x45a13d(0x1e2))/0x6*(parseInt(_0x45a13d(0x214))/0x7)+-parseInt(_0x45a13d(0x217))/0x8+parseInt(_0x45a13d(0x1f7))/0x9;if(_0x137c04===_0x4ec319)break;else _0x2fe4d4['push'](_0x2fe4d4['shift']());}catch(_0x1f7e6f){_0x2fe4d4['push'](_0x2fe4d4['shift']());}}}(_0x5a04,0xb067e));var __decorate=this&&this[_0x1e46b8(0x215)]||function(_0x3858b7,_0x292e09,_0x469aeb,_0x57af07){const _0x1afee8=_0x1e46b8;var _0x48ec7f=arguments['length'],_0x435491=_0x48ec7f<0x3?_0x292e09:_0x57af07===null?_0x57af07=Object[_0x1afee8(0x1f3)](_0x292e09,_0x469aeb):_0x57af07,_0x2309b1;if(typeof Reflect==='object'&&typeof Reflect[_0x1afee8(0x205)]===_0x1afee8(0x1ee))_0x435491=Reflect[_0x1afee8(0x205)](_0x3858b7,_0x292e09,_0x469aeb,_0x57af07);else{for(var _0x2cd594=_0x3858b7['length']-0x1;_0x2cd594>=0x0;_0x2cd594--)if(_0x2309b1=_0x3858b7[_0x2cd594])_0x435491=(_0x48ec7f<0x3?_0x2309b1(_0x435491):_0x48ec7f>0x3?_0x2309b1(_0x292e09,_0x469aeb,_0x435491):_0x2309b1(_0x292e09,_0x469aeb))||_0x435491;}return _0x48ec7f>0x3&&_0x435491&&Object[_0x1afee8(0x1e8)](_0x292e09,_0x469aeb,_0x435491),_0x435491;},__metadata=this&&this[_0x1e46b8(0x211)]||function(_0x10fc5d,_0x2d1fc6){const _0x5c4ee0=_0x1e46b8;if(typeof Reflect===_0x5c4ee0(0x1f6)&&typeof Reflect[_0x5c4ee0(0x200)]==='function')return Reflect[_0x5c4ee0(0x200)](_0x10fc5d,_0x2d1fc6);},StableDiffusionService_1;Object[_0x1e46b8(0x1e8)](exports,_0x1e46b8(0x1f0),{'value':!![]}),exports[_0x1e46b8(0x20d)]=void 0x0;const common_1=require(_0x1e46b8(0x1f8)),axios_1=require(_0x1e46b8(0x1dd)),globalConfig_service_1=require(_0x1e46b8(0x1fb)),upload_service_1=require(_0x1e46b8(0x213));let StableDiffusionService=StableDiffusionService_1=class StableDiffusionService{constructor(_0x5e7c2c,_0x47e878){const _0x1ef586=_0x1e46b8;this[_0x1ef586(0x210)]=_0x5e7c2c,this['globalConfigService']=_0x47e878,this[_0x1ef586(0x20b)]=new common_1[(_0x1ef586(0x207))](StableDiffusionService_1[_0x1ef586(0x20a)]);}async['sdxl'](_0x4c6f3d){const _0x46592c=_0x1e46b8,{onSuccess:_0x2a9abf,onFailure:_0x538ba1,apiKey:_0x442fdc,model:_0x23cc8a,proxyUrl:_0x3217b7,modelName:_0x1e7b10,timeout:_0x38b6f5,chatId:_0x412da6,prompt:_0x3e66c3}=_0x4c6f3d;let _0x3b9c3b={'answer':'','model':_0x23cc8a,'modelName':_0x1e7b10,'chatId':_0x412da6,'fileInfo':'','status':0x2};console['log'](_0x46592c(0x1ff),{'model':_0x23cc8a,'modelName':_0x1e7b10,'prompt':_0x3e66c3});const _0x45b29a={'method':_0x46592c(0x1e7),'url':_0x3217b7+_0x46592c(0x1e1),'timeout':_0x38b6f5,'headers':{'Content-Type':_0x46592c(0x1eb),'Authorization':'Bearer\x20'+_0x442fdc},'data':{'model':_0x23cc8a,'messages':[{'role':_0x46592c(0x1f1),'content':_0x3e66c3}]}};try{const _0x524636=await(0x0,axios_1[_0x46592c(0x20c)])(_0x45b29a);console[_0x46592c(0x206)](_0x46592c(0x1ef),_0x524636[_0x46592c(0x201)]);if(_0x524636[_0x46592c(0x201)][_0x46592c(0x202)]&&_0x524636[_0x46592c(0x201)][_0x46592c(0x202)][_0x46592c(0x1e5)]>0x0){const _0x1aa768=_0x524636[_0x46592c(0x201)][_0x46592c(0x202)][0x0],_0x202e5b=_0x1aa768['message'][_0x46592c(0x1fa)];console[_0x46592c(0x206)](_0x46592c(0x1fd),_0x202e5b);const _0x56ebd4=/\]\((https?:\/\/[^\)]+)\)/,_0x552ac7=_0x202e5b[_0x46592c(0x1e4)](_0x56ebd4);if(_0x552ac7&&_0x552ac7[0x1]){_0x3b9c3b[_0x46592c(0x1e3)]=_0x552ac7[0x1];try{const _0x2a4e7b=await this[_0x46592c(0x1f9)][_0x46592c(0x212)](['localStorageStatus']);if(Number(_0x2a4e7b)){const _0x589dc4=new Date(),_0x10c90f=_0x589dc4[_0x46592c(0x204)](),_0x5aa486=String(_0x589dc4['getMonth']()+0x1)[_0x46592c(0x1e9)](0x2,'0'),_0x214d4b=String(_0x589dc4[_0x46592c(0x1ed)]())[_0x46592c(0x1e9)](0x2,'0'),_0x61cdbb=''+_0x10c90f+_0x5aa486+'/'+_0x214d4b;_0x3b9c3b['fileInfo']=await this['uploadService'][_0x46592c(0x209)]({'url':_0x3b9c3b[_0x46592c(0x1e3)],'dir':_0x46592c(0x1e0)+_0x61cdbb});}}catch(_0x3b1421){common_1[_0x46592c(0x207)]['error'](_0x46592c(0x1f5)+_0x3b1421[_0x46592c(0x203)],_0x46592c(0x20d));}console[_0x46592c(0x206)]('找到链接',_0x552ac7[0x1]);}else console[_0x46592c(0x206)](_0x46592c(0x208));_0x3b9c3b[_0x46592c(0x20e)]=_0x3e66c3+_0x46592c(0x1fc);if(_0x3b9c3b[_0x46592c(0x1e3)]){_0x2a9abf(_0x3b9c3b);return;}else _0x538ba1('No\x20link\x20found.');}else _0x538ba1('No\x20choices\x20returned.');}catch(_0x1c2a7c){common_1[_0x46592c(0x207)][_0x46592c(0x1f2)]('服务器错误，请求失败：',_0x1c2a7c);}}};StableDiffusionService=StableDiffusionService_1=__decorate([(0x0,common_1[_0x1e46b8(0x1ec)])(),__metadata(_0x1e46b8(0x20f),[upload_service_1[_0x1e46b8(0x1fe)],globalConfig_service_1[_0x1e46b8(0x216)]])],StableDiffusionService),exports[_0x1e46b8(0x20d)]=StableDiffusionService;function _0x5a04(){const _0x37cbd2=['__esModule','user','error','getOwnPropertyDescriptor','5351650urTXCe','上传文件失败:\x20','object','31611582LdAnVB','@nestjs/common','globalConfigService','content','../globalConfig/globalConfig.service','\x20绘制成功','处理内容','UploadService','开始处理','metadata','data','choices','message','getFullYear','decorate','log','Logger','没有找到链接','uploadFileFromUrl','name','logger','default','StableDiffusionService','answer','design:paramtypes','uploadService','__metadata','getConfigs','../upload/upload.service','14ONXWrP','__decorate','GlobalConfigService','8621656dhwIRL','axios','1141229CXBACg','314sqbCad','images/stable-diffusion/','/v1/chat/completions','3968472qFpwYS','fileInfo','match','length','20517QvhZIS','POST','defineProperty','padStart','2454060xHrzCd','application/json','Injectable','getDate','function','API响应接收'];_0x5a04=function(){return _0x37cbd2;};return _0x5a04();}