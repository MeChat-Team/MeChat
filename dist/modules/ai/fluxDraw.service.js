'use strict';function _0x5b66(_0x47bb7e,_0x388681){const _0x1f5a07=_0x1f5a();return _0x5b66=function(_0x5b6629,_0x1f5e82){_0x5b6629=_0x5b6629-0x114;let _0x558959=_0x1f5a07[_0x5b6629];return _0x558959;},_0x5b66(_0x47bb7e,_0x388681);}const _0x52299d=_0x5b66;(function(_0x29d7b2,_0xccc295){const _0x4a5605=_0x5b66,_0x4689da=_0x29d7b2();while(!![]){try{const _0x500c83=-parseInt(_0x4a5605(0x154))/0x1+parseInt(_0x4a5605(0x15d))/0x2+-parseInt(_0x4a5605(0x129))/0x3*(-parseInt(_0x4a5605(0x14c))/0x4)+-parseInt(_0x4a5605(0x139))/0x5*(-parseInt(_0x4a5605(0x13f))/0x6)+-parseInt(_0x4a5605(0x157))/0x7*(-parseInt(_0x4a5605(0x135))/0x8)+parseInt(_0x4a5605(0x153))/0x9+parseInt(_0x4a5605(0x13c))/0xa*(-parseInt(_0x4a5605(0x142))/0xb);if(_0x500c83===_0xccc295)break;else _0x4689da['push'](_0x4689da['shift']());}catch(_0x445d66){_0x4689da['push'](_0x4689da['shift']());}}}(_0x1f5a,0x7ae22));var __decorate=this&&this[_0x52299d(0x126)]||function(_0x59f974,_0xfbe522,_0x4e7480,_0x3c611d){const _0x2bf563=_0x52299d;var _0x4bf2de=arguments['length'],_0x244d79=_0x4bf2de<0x3?_0xfbe522:_0x3c611d===null?_0x3c611d=Object[_0x2bf563(0x14a)](_0xfbe522,_0x4e7480):_0x3c611d,_0x5b8789;if(typeof Reflect===_0x2bf563(0x152)&&typeof Reflect[_0x2bf563(0x119)]===_0x2bf563(0x15a))_0x244d79=Reflect[_0x2bf563(0x119)](_0x59f974,_0xfbe522,_0x4e7480,_0x3c611d);else{for(var _0x2d8f03=_0x59f974[_0x2bf563(0x145)]-0x1;_0x2d8f03>=0x0;_0x2d8f03--)if(_0x5b8789=_0x59f974[_0x2d8f03])_0x244d79=(_0x4bf2de<0x3?_0x5b8789(_0x244d79):_0x4bf2de>0x3?_0x5b8789(_0xfbe522,_0x4e7480,_0x244d79):_0x5b8789(_0xfbe522,_0x4e7480))||_0x244d79;}return _0x4bf2de>0x3&&_0x244d79&&Object[_0x2bf563(0x159)](_0xfbe522,_0x4e7480,_0x244d79),_0x244d79;},__metadata=this&&this['__metadata']||function(_0x312092,_0x5c3596){const _0x43ea9e=_0x52299d;if(typeof Reflect===_0x43ea9e(0x152)&&typeof Reflect[_0x43ea9e(0x161)]===_0x43ea9e(0x15a))return Reflect[_0x43ea9e(0x161)](_0x312092,_0x5c3596);},FluxDrawService_1;Object[_0x52299d(0x159)](exports,_0x52299d(0x133),{'value':!![]}),exports[_0x52299d(0x11a)]=void 0x0;const common_1=require(_0x52299d(0x114)),axios_1=require(_0x52299d(0x121)),chatLog_service_1=require('../chatLog/chatLog.service'),globalConfig_service_1=require('../globalConfig/globalConfig.service'),upload_service_1=require(_0x52299d(0x13d)),openaiChat_service_1=require(_0x52299d(0x12b));let FluxDrawService=FluxDrawService_1=class FluxDrawService{constructor(_0x3dd2e5,_0x492597,_0x495c04,_0x422840){const _0x17d445=_0x52299d;this['uploadService']=_0x3dd2e5,this[_0x17d445(0x13e)]=_0x492597,this[_0x17d445(0x141)]=_0x495c04,this[_0x17d445(0x117)]=_0x422840,this['logger']=new common_1[(_0x17d445(0x125))](FluxDrawService_1[_0x17d445(0x137)]);}async[_0x52299d(0x132)](_0x423c6c,_0x55417d){const _0x49123f=_0x52299d;var _0x122e40,_0xb90142,_0x380c65,_0x5bf149;common_1[_0x49123f(0x125)][_0x49123f(0x11d)]('开始提交\x20Flux\x20绘图任务\x20','DrawService');const {apiKey:_0x464d82,model:_0x5eaf9a,proxyUrl:_0x902df8,prompt:_0x32cd1d,extraParam:_0x21fa27,timeout:_0x1cd0a8,onSuccess:_0x1bb51c,onFailure:_0x1b1d61,groupId:_0x59a905}=_0x423c6c,_0x1d03a8=await this[_0x49123f(0x13e)][_0x49123f(0x12d)]([_0x49123f(0x158)]);let _0x58a800;if(_0x1d03a8==='1')try{common_1[_0x49123f(0x125)]['log']('已开启连续绘画模式',_0x49123f(0x115));const {messagesHistory:_0x15fb1b}=await _0x55417d(_0x49123f(0x13b)+_0x32cd1d,{'groupId':_0x59a905,'systemMessage':_0x49123f(0x12f),'maxModelTokens':0x1f40,'maxRounds':0x5,'fileInfo':''},this['chatLogService']);_0x58a800=await this[_0x49123f(0x117)][_0x49123f(0x151)](_0x32cd1d,undefined,_0x15fb1b);}catch(_0x3b4bba){console[_0x49123f(0x136)]('调用chatFree失败：',_0x3b4bba),_0x58a800=_0x32cd1d;}else _0x58a800=_0x32cd1d;const _0x280b1f=(_0x21fa27===null||_0x21fa27===void 0x0?void 0x0:_0x21fa27[_0x49123f(0x144)])||'1024x1024';let _0x43b28d={'answer':'','fileInfo':'','status':0x2};try{const _0x168905={'method':_0x49123f(0x160),'url':_0x902df8+_0x49123f(0x13a),'timeout':_0x1cd0a8,'headers':{'Content-Type':_0x49123f(0x127),'Authorization':_0x49123f(0x134)+_0x464d82},'data':{'model':_0x5eaf9a,'prompt':_0x58a800,'size':_0x280b1f}};common_1[_0x49123f(0x125)][_0x49123f(0x11d)](_0x49123f(0x140)+_0x168905[_0x49123f(0x11b)]+_0x49123f(0x148)+JSON['stringify'](_0x168905[_0x49123f(0x118)])+',\x20headers:\x20'+JSON[_0x49123f(0x12a)](_0x168905[_0x49123f(0x14d)]),'FluxDrawService');const _0x8da3fc=await(0x0,axios_1[_0x49123f(0x11f)])(_0x168905);common_1[_0x49123f(0x125)][_0x49123f(0x155)](_0x49123f(0x15c)+JSON[_0x49123f(0x12a)](_0x8da3fc['data']['data'][0x0])),common_1[_0x49123f(0x125)][_0x49123f(0x155)](_0x49123f(0x15b)+JSON[_0x49123f(0x12a)](_0x8da3fc[_0x49123f(0x149)]));const _0x252cfb=_0x8da3fc[_0x49123f(0x118)][_0x49123f(0x118)][0x0][_0x49123f(0x11b)];try{common_1['Logger'][_0x49123f(0x11d)](_0x49123f(0x124),'DrawService');const _0x59afec=new Date(),_0x15f2ef=_0x59afec['getFullYear'](),_0x43b974=String(_0x59afec[_0x49123f(0x15f)]()+0x1)[_0x49123f(0x138)](0x2,'0'),_0x322092=String(_0x59afec['getDate']())[_0x49123f(0x138)](0x2,'0'),_0x1566e6=''+_0x15f2ef+_0x43b974+'/'+_0x322092;_0x43b28d[_0x49123f(0x147)]=await this['uploadService'][_0x49123f(0x11e)]({'url':_0x252cfb,'dir':_0x49123f(0x146)+_0x1566e6}),common_1[_0x49123f(0x125)][_0x49123f(0x11d)](_0x49123f(0x162)+_0x43b28d[_0x49123f(0x147)],'DrawService');}catch(_0x42ee72){common_1[_0x49123f(0x125)][_0x49123f(0x136)](_0x49123f(0x163)+_0x42ee72,_0x49123f(0x15e));}let _0x3b7f95;try{_0x3b7f95=await this[_0x49123f(0x117)][_0x49123f(0x151)]('根据提示词{'+_0x58a800+_0x49123f(0x143));}catch(_0xc2974f){_0x3b7f95=_0x32cd1d+'\x20绘制成功',common_1[_0x49123f(0x125)][_0x49123f(0x136)](_0x49123f(0x120),_0xc2974f);}_0x43b28d['answer']=_0x3b7f95,_0x43b28d[_0x49123f(0x149)]=0x3,_0x1bb51c(_0x43b28d);return;}catch(_0x565cd0){_0x43b28d['status']=0x5,_0x1b1d61(_0x43b28d);const _0xca8b31=((_0x122e40=_0x565cd0===null||_0x565cd0===void 0x0?void 0x0:_0x565cd0[_0x49123f(0x164)])===null||_0x122e40===void 0x0?void 0x0:_0x122e40[_0x49123f(0x149)])||0x1f4;console[_0x49123f(0x11d)](_0x49123f(0x130),JSON[_0x49123f(0x12a)](_0x565cd0),_0xca8b31);const _0x2a7f28=(_0x5bf149=(_0x380c65=(_0xb90142=_0x565cd0===null||_0x565cd0===void 0x0?void 0x0:_0x565cd0[_0x49123f(0x164)])===null||_0xb90142===void 0x0?void 0x0:_0xb90142[_0x49123f(0x118)])===null||_0x380c65===void 0x0?void 0x0:_0x380c65[_0x49123f(0x136)])===null||_0x5bf149===void 0x0?void 0x0:_0x5bf149[_0x49123f(0x12c)];if(_0xca8b31===0x1ad)return _0x43b28d[_0x49123f(0x128)]='当前请求已过载、请稍等会儿再试试吧！',_0x43b28d;if(_0xca8b31===0x190&&_0x2a7f28['includes'](_0x49123f(0x12e)))return _0x43b28d[_0x49123f(0x128)]=_0x49123f(0x150),_0x43b28d;if(_0xca8b31===0x190&&_0x2a7f28[_0x49123f(0x123)](_0x49123f(0x131)))return _0x43b28d[_0x49123f(0x128)]='当前模型key已被封禁、已冻结当前调用Key、尝试重新对话试试吧！',_0x43b28d;if(_0xca8b31===0x1f4)return _0x43b28d[_0x49123f(0x128)]='绘制图片失败，请检查你的提示词是否有非法描述！',_0x43b28d;if(_0xca8b31===0x191)return _0x43b28d['text']=_0x49123f(0x11c),_0x43b28d;return _0x43b28d[_0x49123f(0x128)]=_0x49123f(0x156),_0x43b28d;}}};function _0x1f5a(){const _0x28a79e=['Billing\x20hard\x20limit\x20has\x20been\x20reached','fluxDraw','__esModule','Bearer\x20','1934536izMuTj','error','name','padStart','5JXDfQR','/v1/images/generations','参考上文，结合我的需求，给出绘画描述。我的需求是：','12363250ubLwoL','../upload/upload.service','globalConfigService','1326018ZOCTZg','正在准备发送请求到\x20','chatLogService','11dLerxL','},\x20模拟AI绘画机器人的语气，用中文回复，告诉用户已经画好了','size','length','images/dalle/','fileInfo','，payload:\x20','status','getOwnPropertyDescriptor','GlobalConfigService','848wrkfID','headers','ChatLogService','Injectable','您的请求已被系统拒绝。您的提示可能存在一些非法的文本。','chatFree','object','6441399gfXdSI','595236uyUoIb','debug','绘制图片失败，请稍后试试吧！','14fAMmsU','isDalleChat','defineProperty','function','请求状态','请求成功','1409326sJkNZf','DrawService','getMonth','POST','metadata','图片上传成功，URL:\x20','上传图片过程中出现错误:\x20','response','@nestjs/common','FluxDraw','OpenAIChatService','openAIChatService','data','decorate','FluxDrawService','url','绘制图片失败，此次绘画被拒绝了！','log','uploadFileFromUrl','default','翻译失败:\x20','axios','design:paramtypes','includes','------>\x20开始上传图片！！！','Logger','__decorate','application/json','text','2970bUeniX','stringify','./openaiChat.service','message','getConfigs','This\x20request\x20has\x20been\x20blocked\x20by\x20our\x20content\x20filters','你是一个绘画提示词生成工具，请根据用户的要求，结合上下文，用一段文字，描述用户需要的绘画需求，不用包含任何礼貌性的寒暄,只需要场景的描述,可以适当联想','draw\x20error:\x20'];_0x1f5a=function(){return _0x28a79e;};return _0x1f5a();}FluxDrawService=FluxDrawService_1=__decorate([(0x0,common_1[_0x52299d(0x14f)])(),__metadata(_0x52299d(0x122),[upload_service_1['UploadService'],globalConfig_service_1[_0x52299d(0x14b)],chatLog_service_1[_0x52299d(0x14e)],openaiChat_service_1[_0x52299d(0x116)]])],FluxDrawService),exports[_0x52299d(0x11a)]=FluxDrawService;