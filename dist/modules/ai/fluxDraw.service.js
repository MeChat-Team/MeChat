'use strict';function _0x4d93(){const _0x1b7316=['uploadService','getDate','参考上文，结合我的需求，给出绘画描述。我的需求是：','uploadFileFromUrl','当前请求已过载、请稍等会儿再试试吧！','4IpfQDK','fluxDraw','chatFree','POST','516639ZEAKjx','288062poSFJa','当前模型key已被封禁、已冻结当前调用Key、尝试重新对话试试吧！','answer','您的请求已被系统拒绝。您的提示可能存在一些非法的文本。','chatLogService','图片上传成功，URL:\x20','images/dalle/','FluxDraw','padStart','text','default','4834085nPsyjc','log','object','7JhLsmI','stringify','function','../globalConfig/globalConfig.service','绘制图片失败，请稍后试试吧！','status','decorate','debug','logger','globalConfigService','DrawService','已开启连续绘画模式','draw\x20error:\x20','请求成功','Bearer\x20','ChatLogService','开始提交\x20Flux\x20绘图任务\x20','8wDLWvE','你是一个绘画提示词生成工具，请根据用户的要求，结合上下文，用一段文字，描述用户需要的绘画需求，不用包含任何礼貌性的寒暄,只需要场景的描述,可以适当联想','绘制图片失败，请检查你的提示词是否有非法描述！','application/json','error',',\x20headers:\x20','design:paramtypes','../upload/upload.service','/v1/images/generations','includes','url','__decorate','This\x20request\x20has\x20been\x20blocked\x20by\x20our\x20content\x20filters','Billing\x20hard\x20limit\x20has\x20been\x20reached','size','__esModule','__metadata','------>\x20开始上传图片！！！','openAIChatService','axios','@nestjs/common','上传图片过程中出现错误:\x20','20410390eLaeRw','getFullYear','defineProperty','getConfigs','8400177teRDzM','翻译失败:\x20','response','\x20绘制成功','2513238UmsOph','Logger','954714yUslKx','metadata','data','name','FluxDrawService','headers','，payload:\x20','length'];_0x4d93=function(){return _0x1b7316;};return _0x4d93();}const _0xae2578=_0x3265;(function(_0x2b4f33,_0x178783){const _0x4b449e=_0x3265,_0x57f505=_0x2b4f33();while(!![]){try{const _0x54d09e=-parseInt(_0x4b449e(0x1b0))/0x1*(-parseInt(_0x4b449e(0x1a2))/0x2)+parseInt(_0x4b449e(0x1a1))/0x3*(parseInt(_0x4b449e(0x19d))/0x4)+parseInt(_0x4b449e(0x1ad))/0x5+-parseInt(_0x4b449e(0x190))/0x6+-parseInt(_0x4b449e(0x18e))/0x7+parseInt(_0x4b449e(0x1c1))/0x8*(parseInt(_0x4b449e(0x18a))/0x9)+-parseInt(_0x4b449e(0x1d7))/0xa;if(_0x54d09e===_0x178783)break;else _0x57f505['push'](_0x57f505['shift']());}catch(_0x3b9b8c){_0x57f505['push'](_0x57f505['shift']());}}}(_0x4d93,0x7f4c0));function _0x3265(_0x39c806,_0x1a1fa2){const _0x4d9330=_0x4d93();return _0x3265=function(_0x32659,_0x28f612){_0x32659=_0x32659-0x189;let _0x542cd9=_0x4d9330[_0x32659];return _0x542cd9;},_0x3265(_0x39c806,_0x1a1fa2);}var __decorate=this&&this[_0xae2578(0x1cc)]||function(_0x2fef63,_0x178a98,_0x4d8c8e,_0x103902){const _0x3fcc31=_0xae2578;var _0x17e892=arguments[_0x3fcc31(0x197)],_0x5a04eb=_0x17e892<0x3?_0x178a98:_0x103902===null?_0x103902=Object['getOwnPropertyDescriptor'](_0x178a98,_0x4d8c8e):_0x103902,_0x329a87;if(typeof Reflect===_0x3fcc31(0x1af)&&typeof Reflect[_0x3fcc31(0x1b6)]==='function')_0x5a04eb=Reflect[_0x3fcc31(0x1b6)](_0x2fef63,_0x178a98,_0x4d8c8e,_0x103902);else{for(var _0x349554=_0x2fef63[_0x3fcc31(0x197)]-0x1;_0x349554>=0x0;_0x349554--)if(_0x329a87=_0x2fef63[_0x349554])_0x5a04eb=(_0x17e892<0x3?_0x329a87(_0x5a04eb):_0x17e892>0x3?_0x329a87(_0x178a98,_0x4d8c8e,_0x5a04eb):_0x329a87(_0x178a98,_0x4d8c8e))||_0x5a04eb;}return _0x17e892>0x3&&_0x5a04eb&&Object[_0x3fcc31(0x1d9)](_0x178a98,_0x4d8c8e,_0x5a04eb),_0x5a04eb;},__metadata=this&&this[_0xae2578(0x1d1)]||function(_0x53b223,_0x370109){const _0x5e1398=_0xae2578;if(typeof Reflect===_0x5e1398(0x1af)&&typeof Reflect[_0x5e1398(0x191)]===_0x5e1398(0x1b2))return Reflect[_0x5e1398(0x191)](_0x53b223,_0x370109);},FluxDrawService_1;Object[_0xae2578(0x1d9)](exports,_0xae2578(0x1d0),{'value':!![]}),exports[_0xae2578(0x194)]=void 0x0;const common_1=require(_0xae2578(0x1d5)),axios_1=require(_0xae2578(0x1d4)),chatLog_service_1=require('../chatLog/chatLog.service'),globalConfig_service_1=require(_0xae2578(0x1b3)),upload_service_1=require(_0xae2578(0x1c8)),openaiChat_service_1=require('./openaiChat.service');let FluxDrawService=FluxDrawService_1=class FluxDrawService{constructor(_0x1c8efd,_0x1c4eb7,_0x25c3ca,_0x362fb8){const _0x157240=_0xae2578;this[_0x157240(0x198)]=_0x1c8efd,this[_0x157240(0x1b9)]=_0x1c4eb7,this[_0x157240(0x1a6)]=_0x25c3ca,this['openAIChatService']=_0x362fb8,this[_0x157240(0x1b8)]=new common_1[(_0x157240(0x18f))](FluxDrawService_1[_0x157240(0x193)]);}async[_0xae2578(0x19e)](_0x24e4b7,_0x44d810){const _0x19c0f2=_0xae2578;var _0x1cc108,_0x187a8b,_0x444444,_0x3bfe82;common_1['Logger'][_0x19c0f2(0x1ae)](_0x19c0f2(0x1c0),'DrawService');const {apiKey:_0x411355,model:_0x1eab19,proxyUrl:_0x1a2caf,prompt:_0x5b8ecb,extraParam:_0x306fca,timeout:_0xb7103e,onSuccess:_0x5b4403,onFailure:_0x5d486b,groupId:_0x29b6dd}=_0x24e4b7,_0x515a43=await this['globalConfigService'][_0x19c0f2(0x189)](['isDalleChat']);let _0x635ddc;if(_0x515a43==='1')try{common_1[_0x19c0f2(0x18f)][_0x19c0f2(0x1ae)](_0x19c0f2(0x1bb),_0x19c0f2(0x1a9));const {messagesHistory:_0x4a6517}=await _0x44d810(_0x19c0f2(0x19a)+_0x5b8ecb,{'groupId':_0x29b6dd,'systemMessage':_0x19c0f2(0x1c2),'maxModelTokens':0x1f40,'maxRounds':0x5,'fileInfo':''},this['chatLogService']);_0x635ddc=await this['openAIChatService'][_0x19c0f2(0x19f)](_0x5b8ecb,undefined,_0x4a6517);}catch(_0x4406d0){console[_0x19c0f2(0x1c5)]('调用chatFree失败：',_0x4406d0),_0x635ddc=_0x5b8ecb;}else _0x635ddc=_0x5b8ecb;const _0x47ccc5=(_0x306fca===null||_0x306fca===void 0x0?void 0x0:_0x306fca[_0x19c0f2(0x1cf)])||'1024x1024';let _0x5bacd9={'answer':'','fileInfo':'','status':0x2};try{const _0x1fc100={'method':_0x19c0f2(0x1a0),'url':_0x1a2caf+_0x19c0f2(0x1c9),'timeout':_0xb7103e,'headers':{'Content-Type':_0x19c0f2(0x1c4),'Authorization':_0x19c0f2(0x1be)+_0x411355},'data':{'model':_0x1eab19,'prompt':_0x635ddc,'size':_0x47ccc5}};common_1[_0x19c0f2(0x18f)][_0x19c0f2(0x1ae)]('正在准备发送请求到\x20'+_0x1fc100['url']+_0x19c0f2(0x196)+JSON['stringify'](_0x1fc100['data'])+_0x19c0f2(0x1c6)+JSON[_0x19c0f2(0x1b1)](_0x1fc100[_0x19c0f2(0x195)]),'FluxDrawService');const _0x43d62a=await(0x0,axios_1[_0x19c0f2(0x1ac)])(_0x1fc100);common_1[_0x19c0f2(0x18f)][_0x19c0f2(0x1b7)](_0x19c0f2(0x1bd)+JSON[_0x19c0f2(0x1b1)](_0x43d62a[_0x19c0f2(0x192)][_0x19c0f2(0x192)][0x0])),common_1['Logger']['debug']('请求状态'+JSON[_0x19c0f2(0x1b1)](_0x43d62a[_0x19c0f2(0x1b5)]));const _0xd25c76=_0x43d62a[_0x19c0f2(0x192)][_0x19c0f2(0x192)][0x0][_0x19c0f2(0x1cb)];try{common_1[_0x19c0f2(0x18f)]['log'](_0x19c0f2(0x1d2),'DrawService');const _0x15ddd1=new Date(),_0x1aac2f=_0x15ddd1[_0x19c0f2(0x1d8)](),_0x2db9c4=String(_0x15ddd1['getMonth']()+0x1)['padStart'](0x2,'0'),_0xc8ea9e=String(_0x15ddd1[_0x19c0f2(0x199)]())[_0x19c0f2(0x1aa)](0x2,'0'),_0x197e52=''+_0x1aac2f+_0x2db9c4+'/'+_0xc8ea9e;_0x5bacd9['fileInfo']=await this[_0x19c0f2(0x198)][_0x19c0f2(0x19b)]({'url':_0xd25c76,'dir':_0x19c0f2(0x1a8)+_0x197e52}),common_1[_0x19c0f2(0x18f)]['log'](_0x19c0f2(0x1a7)+_0x5bacd9['fileInfo'],_0x19c0f2(0x1ba));}catch(_0x18b17d){common_1[_0x19c0f2(0x18f)]['error'](_0x19c0f2(0x1d6)+_0x18b17d,_0x19c0f2(0x1ba));}let _0xfb6f3c;try{_0xfb6f3c=await this[_0x19c0f2(0x1d3)][_0x19c0f2(0x19f)]('根据提示词{'+_0x635ddc+'},\x20模拟AI绘画机器人的语气，用中文回复，告诉用户已经画好了');}catch(_0xe890c0){_0xfb6f3c=_0x5b8ecb+_0x19c0f2(0x18d),common_1[_0x19c0f2(0x18f)][_0x19c0f2(0x1c5)](_0x19c0f2(0x18b),_0xe890c0);}_0x5bacd9[_0x19c0f2(0x1a4)]=_0xfb6f3c,_0x5bacd9[_0x19c0f2(0x1b5)]=0x3,_0x5b4403(_0x5bacd9);return;}catch(_0x4d6585){_0x5bacd9['status']=0x5,_0x5d486b(_0x5bacd9);const _0x2d5571=((_0x1cc108=_0x4d6585===null||_0x4d6585===void 0x0?void 0x0:_0x4d6585[_0x19c0f2(0x18c)])===null||_0x1cc108===void 0x0?void 0x0:_0x1cc108[_0x19c0f2(0x1b5)])||0x1f4;console['log'](_0x19c0f2(0x1bc),JSON[_0x19c0f2(0x1b1)](_0x4d6585),_0x2d5571);const _0x407592=(_0x3bfe82=(_0x444444=(_0x187a8b=_0x4d6585===null||_0x4d6585===void 0x0?void 0x0:_0x4d6585[_0x19c0f2(0x18c)])===null||_0x187a8b===void 0x0?void 0x0:_0x187a8b[_0x19c0f2(0x192)])===null||_0x444444===void 0x0?void 0x0:_0x444444['error'])===null||_0x3bfe82===void 0x0?void 0x0:_0x3bfe82['message'];if(_0x2d5571===0x1ad)return _0x5bacd9[_0x19c0f2(0x1ab)]=_0x19c0f2(0x19c),_0x5bacd9;if(_0x2d5571===0x190&&_0x407592[_0x19c0f2(0x1ca)](_0x19c0f2(0x1cd)))return _0x5bacd9[_0x19c0f2(0x1ab)]=_0x19c0f2(0x1a5),_0x5bacd9;if(_0x2d5571===0x190&&_0x407592[_0x19c0f2(0x1ca)](_0x19c0f2(0x1ce)))return _0x5bacd9[_0x19c0f2(0x1ab)]=_0x19c0f2(0x1a3),_0x5bacd9;if(_0x2d5571===0x1f4)return _0x5bacd9[_0x19c0f2(0x1ab)]=_0x19c0f2(0x1c3),_0x5bacd9;if(_0x2d5571===0x191)return _0x5bacd9[_0x19c0f2(0x1ab)]='绘制图片失败，此次绘画被拒绝了！',_0x5bacd9;return _0x5bacd9[_0x19c0f2(0x1ab)]=_0x19c0f2(0x1b4),_0x5bacd9;}}};FluxDrawService=FluxDrawService_1=__decorate([(0x0,common_1['Injectable'])(),__metadata(_0xae2578(0x1c7),[upload_service_1['UploadService'],globalConfig_service_1['GlobalConfigService'],chatLog_service_1[_0xae2578(0x1bf)],openaiChat_service_1['OpenAIChatService']])],FluxDrawService),exports[_0xae2578(0x194)]=FluxDrawService;