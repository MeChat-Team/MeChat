'use strict';const _0x3fb63d=_0x2653;(function(_0x1bdb7d,_0xb9d6e4){const _0x566d57=_0x2653,_0x54cbac=_0x1bdb7d();while(!![]){try{const _0x3cf337=parseInt(_0x566d57(0xf9))/0x1+-parseInt(_0x566d57(0xe6))/0x2*(-parseInt(_0x566d57(0xfc))/0x3)+-parseInt(_0x566d57(0xff))/0x4*(parseInt(_0x566d57(0xed))/0x5)+parseInt(_0x566d57(0xe3))/0x6*(-parseInt(_0x566d57(0xf5))/0x7)+parseInt(_0x566d57(0xfa))/0x8+parseInt(_0x566d57(0xdf))/0x9+parseInt(_0x566d57(0x100))/0xa*(-parseInt(_0x566d57(0xda))/0xb);if(_0x3cf337===_0xb9d6e4)break;else _0x54cbac['push'](_0x54cbac['shift']());}catch(_0x5d8581){_0x54cbac['push'](_0x54cbac['shift']());}}}(_0x2255,0x8aa0d));function _0x2653(_0x30306f,_0x1cb8b7){const _0x225584=_0x2255();return _0x2653=function(_0x2653a5,_0x53c4c7){_0x2653a5=_0x2653a5-0xb9;let _0xaba18a=_0x225584[_0x2653a5];return _0xaba18a;},_0x2653(_0x30306f,_0x1cb8b7);}function _0x2255(){const _0x3ce1a3=['/v1/images/generations','data','1364PxZBuc','7230NWagZr','绘制图片失败，请检查你的提示词是否有非法描述！','./openaiChat.service','FluxDraw','logger','images/dalle/','ChatLogService','metadata','图片上传成功，URL:\x20','axios','message','\x20绘制成功','headers','@nestjs/common','正在准备发送请求到\x20','DrawService','getFullYear','已开启连续绘画模式','请求状态','__decorate','log','getDate','name','openAIChatService','------>\x20开始上传图片！！！','draw\x20error:\x20','getConfigs','Billing\x20hard\x20limit\x20has\x20been\x20reached','url','status','POST','当前请求已过载、请稍等会儿再试试吧！','GlobalConfigService','chatFree','uploadService','isDalleChat','includes','9119qIDBkJ','application/json','Bearer\x20','绘制图片失败，请稍后试试吧！','design:paramtypes','8791020LGdzgr','请求成功','翻译失败:\x20','function','1343778nJwatK','object','stringify','275668YYMbnY','__metadata','length','decorate','globalConfigService','参考上文，结合我的需求，给出绘画描述。我的需求是：','This\x20request\x20has\x20been\x20blocked\x20by\x20our\x20content\x20filters','2590CpJKrm','Injectable','FluxDrawService','error','调用chatFree失败：','您的请求已被系统拒绝。您的提示可能存在一些非法的文本。','text','response','35XemIFm','根据提示词{','Logger','../globalConfig/globalConfig.service','398346bmrBBp','4297432VyMOhf','chatLogService','12kzRgFg'];_0x2255=function(){return _0x3ce1a3;};return _0x2255();}var __decorate=this&&this[_0x3fb63d(0xc8)]||function(_0x3738b3,_0x192cb2,_0x530436,_0x17ef34){const _0x4dd371=_0x3fb63d;var _0x50eb53=arguments[_0x4dd371(0xe8)],_0x511db8=_0x50eb53<0x3?_0x192cb2:_0x17ef34===null?_0x17ef34=Object['getOwnPropertyDescriptor'](_0x192cb2,_0x530436):_0x17ef34,_0x2edd81;if(typeof Reflect===_0x4dd371(0xe4)&&typeof Reflect[_0x4dd371(0xe9)]===_0x4dd371(0xe2))_0x511db8=Reflect[_0x4dd371(0xe9)](_0x3738b3,_0x192cb2,_0x530436,_0x17ef34);else{for(var _0x406f66=_0x3738b3['length']-0x1;_0x406f66>=0x0;_0x406f66--)if(_0x2edd81=_0x3738b3[_0x406f66])_0x511db8=(_0x50eb53<0x3?_0x2edd81(_0x511db8):_0x50eb53>0x3?_0x2edd81(_0x192cb2,_0x530436,_0x511db8):_0x2edd81(_0x192cb2,_0x530436))||_0x511db8;}return _0x50eb53>0x3&&_0x511db8&&Object['defineProperty'](_0x192cb2,_0x530436,_0x511db8),_0x511db8;},__metadata=this&&this[_0x3fb63d(0xe7)]||function(_0x4ef25e,_0x5085bb){const _0x196c30=_0x3fb63d;if(typeof Reflect==='object'&&typeof Reflect[_0x196c30(0xbc)]===_0x196c30(0xe2))return Reflect[_0x196c30(0xbc)](_0x4ef25e,_0x5085bb);},FluxDrawService_1;Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[_0x3fb63d(0xef)]=void 0x0;const common_1=require(_0x3fb63d(0xc2)),axios_1=require(_0x3fb63d(0xbe)),chatLog_service_1=require('../chatLog/chatLog.service'),globalConfig_service_1=require(_0x3fb63d(0xf8)),upload_service_1=require('../upload/upload.service'),openaiChat_service_1=require(_0x3fb63d(0x102));let FluxDrawService=FluxDrawService_1=class FluxDrawService{constructor(_0x59c142,_0x5c7552,_0x509926,_0x378be0){const _0x376eff=_0x3fb63d;this[_0x376eff(0xd7)]=_0x59c142,this[_0x376eff(0xea)]=_0x5c7552,this[_0x376eff(0xfb)]=_0x509926,this[_0x376eff(0xcc)]=_0x378be0,this[_0x376eff(0xb9)]=new common_1[(_0x376eff(0xf7))](FluxDrawService_1[_0x376eff(0xcb)]);}async['fluxDraw'](_0x25380d,_0x5c11dc){const _0x3f7eed=_0x3fb63d;var _0x421f64,_0x36e78c,_0x2e2c67,_0x47e07d;common_1[_0x3f7eed(0xf7)][_0x3f7eed(0xc9)]('开始提交\x20Flux\x20绘图任务\x20',_0x3f7eed(0xc4));const {apiKey:_0x35e7a9,model:_0xee3419,proxyUrl:_0x4c9814,prompt:_0x413cc8,extraParam:_0x1ca377,timeout:_0x16bf2c,onSuccess:_0x98a0ec,onFailure:_0x18c20e,groupId:_0x4b5f3c}=_0x25380d,_0x36af0c=await this[_0x3f7eed(0xea)][_0x3f7eed(0xcf)]([_0x3f7eed(0xd8)]);let _0x586105;if(_0x36af0c==='1')try{common_1[_0x3f7eed(0xf7)][_0x3f7eed(0xc9)](_0x3f7eed(0xc6),_0x3f7eed(0x103));const {messagesHistory:_0x21bf37}=await _0x5c11dc(_0x3f7eed(0xeb)+_0x413cc8,{'groupId':_0x4b5f3c,'systemMessage':'你是一个绘画提示词生成工具，请根据用户的要求，结合上下文，用一段文字，描述用户需要的绘画需求，不用包含任何礼貌性的寒暄,只需要场景的描述,可以适当联想','maxModelTokens':0x1f40,'maxRounds':0x5,'fileInfo':''},this[_0x3f7eed(0xfb)]);_0x586105=await this['openAIChatService']['chatFree'](_0x413cc8,undefined,_0x21bf37);}catch(_0x3067e3){console['error'](_0x3f7eed(0xf1),_0x3067e3),_0x586105=_0x413cc8;}else _0x586105=_0x413cc8;const _0x470f03=(_0x1ca377===null||_0x1ca377===void 0x0?void 0x0:_0x1ca377['size'])||'1024x1024';let _0x3520a7={'answer':'','fileInfo':'','status':0x2};try{const _0x35dba5={'method':_0x3f7eed(0xd3),'url':_0x4c9814+_0x3f7eed(0xfd),'timeout':_0x16bf2c,'headers':{'Content-Type':_0x3f7eed(0xdb),'Authorization':_0x3f7eed(0xdc)+_0x35e7a9},'data':{'model':_0xee3419,'prompt':_0x586105,'size':_0x470f03}};common_1['Logger'][_0x3f7eed(0xc9)](_0x3f7eed(0xc3)+_0x35dba5[_0x3f7eed(0xd1)]+'，payload:\x20'+JSON[_0x3f7eed(0xe5)](_0x35dba5[_0x3f7eed(0xfe)])+',\x20headers:\x20'+JSON[_0x3f7eed(0xe5)](_0x35dba5[_0x3f7eed(0xc1)]),_0x3f7eed(0xef));const _0x3a4ec5=await(0x0,axios_1['default'])(_0x35dba5);common_1[_0x3f7eed(0xf7)]['debug'](_0x3f7eed(0xe0)+JSON[_0x3f7eed(0xe5)](_0x3a4ec5[_0x3f7eed(0xfe)][_0x3f7eed(0xfe)][0x0])),common_1['Logger']['debug'](_0x3f7eed(0xc7)+JSON['stringify'](_0x3a4ec5[_0x3f7eed(0xd2)]));const _0x420106=_0x3a4ec5[_0x3f7eed(0xfe)][_0x3f7eed(0xfe)][0x0][_0x3f7eed(0xd1)];try{common_1[_0x3f7eed(0xf7)]['log'](_0x3f7eed(0xcd),_0x3f7eed(0xc4));const _0x22a341=new Date(),_0x148129=_0x22a341[_0x3f7eed(0xc5)](),_0x19bc65=String(_0x22a341['getMonth']()+0x1)['padStart'](0x2,'0'),_0x34141d=String(_0x22a341[_0x3f7eed(0xca)]())['padStart'](0x2,'0'),_0x2a90e8=''+_0x148129+_0x19bc65+'/'+_0x34141d;_0x3520a7['fileInfo']=await this[_0x3f7eed(0xd7)]['uploadFileFromUrl']({'url':_0x420106,'dir':_0x3f7eed(0xba)+_0x2a90e8}),common_1[_0x3f7eed(0xf7)][_0x3f7eed(0xc9)](_0x3f7eed(0xbd)+_0x3520a7['fileInfo'],_0x3f7eed(0xc4));}catch(_0x952805){common_1['Logger'][_0x3f7eed(0xf0)]('上传图片过程中出现错误:\x20'+_0x952805,_0x3f7eed(0xc4));}let _0x24423c;try{_0x24423c=await this[_0x3f7eed(0xcc)][_0x3f7eed(0xd6)](_0x3f7eed(0xf6)+_0x586105+'},\x20模拟AI绘画机器人的语气，用中文回复，告诉用户已经画好了');}catch(_0x39efce){_0x24423c=_0x413cc8+_0x3f7eed(0xc0),common_1[_0x3f7eed(0xf7)][_0x3f7eed(0xf0)](_0x3f7eed(0xe1),_0x39efce);}_0x3520a7['answer']=_0x24423c,_0x3520a7['status']=0x3,_0x98a0ec(_0x3520a7);return;}catch(_0x54951f){_0x3520a7[_0x3f7eed(0xd2)]=0x5,_0x18c20e(_0x3520a7);const _0x19fed9=((_0x421f64=_0x54951f===null||_0x54951f===void 0x0?void 0x0:_0x54951f[_0x3f7eed(0xf4)])===null||_0x421f64===void 0x0?void 0x0:_0x421f64[_0x3f7eed(0xd2)])||0x1f4;console[_0x3f7eed(0xc9)](_0x3f7eed(0xce),JSON[_0x3f7eed(0xe5)](_0x54951f),_0x19fed9);const _0x4f18f3=(_0x47e07d=(_0x2e2c67=(_0x36e78c=_0x54951f===null||_0x54951f===void 0x0?void 0x0:_0x54951f[_0x3f7eed(0xf4)])===null||_0x36e78c===void 0x0?void 0x0:_0x36e78c[_0x3f7eed(0xfe)])===null||_0x2e2c67===void 0x0?void 0x0:_0x2e2c67[_0x3f7eed(0xf0)])===null||_0x47e07d===void 0x0?void 0x0:_0x47e07d[_0x3f7eed(0xbf)];if(_0x19fed9===0x1ad)return _0x3520a7['text']=_0x3f7eed(0xd4),_0x3520a7;if(_0x19fed9===0x190&&_0x4f18f3[_0x3f7eed(0xd9)](_0x3f7eed(0xec)))return _0x3520a7[_0x3f7eed(0xf3)]=_0x3f7eed(0xf2),_0x3520a7;if(_0x19fed9===0x190&&_0x4f18f3['includes'](_0x3f7eed(0xd0)))return _0x3520a7[_0x3f7eed(0xf3)]='当前模型key已被封禁、已冻结当前调用Key、尝试重新对话试试吧！',_0x3520a7;if(_0x19fed9===0x1f4)return _0x3520a7[_0x3f7eed(0xf3)]=_0x3f7eed(0x101),_0x3520a7;if(_0x19fed9===0x191)return _0x3520a7[_0x3f7eed(0xf3)]='绘制图片失败，此次绘画被拒绝了！',_0x3520a7;return _0x3520a7[_0x3f7eed(0xf3)]=_0x3f7eed(0xdd),_0x3520a7;}}};FluxDrawService=FluxDrawService_1=__decorate([(0x0,common_1[_0x3fb63d(0xee)])(),__metadata(_0x3fb63d(0xde),[upload_service_1['UploadService'],globalConfig_service_1[_0x3fb63d(0xd5)],chatLog_service_1[_0x3fb63d(0xbb)],openaiChat_service_1['OpenAIChatService']])],FluxDrawService),exports[_0x3fb63d(0xef)]=FluxDrawService;