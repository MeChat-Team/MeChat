'use strict';const _0x49e1d7=_0x52fe;(function(_0x3d02e5,_0x902a50){const _0x5681b8=_0x52fe,_0x40194e=_0x3d02e5();while(!![]){try{const _0x259712=-parseInt(_0x5681b8(0x7f))/0x1+parseInt(_0x5681b8(0xa5))/0x2+-parseInt(_0x5681b8(0xb3))/0x3*(parseInt(_0x5681b8(0x7d))/0x4)+parseInt(_0x5681b8(0x90))/0x5*(parseInt(_0x5681b8(0x96))/0x6)+parseInt(_0x5681b8(0x81))/0x7*(parseInt(_0x5681b8(0x8c))/0x8)+-parseInt(_0x5681b8(0x94))/0x9+parseInt(_0x5681b8(0x9f))/0xa;if(_0x259712===_0x902a50)break;else _0x40194e['push'](_0x40194e['shift']());}catch(_0xd0e799){_0x40194e['push'](_0x40194e['shift']());}}}(_0x2eff,0x42f05));function _0x52fe(_0x2c320e,_0xa0cf8c){const _0x2eff70=_0x2eff();return _0x52fe=function(_0x52fe4b,_0x220c13){_0x52fe4b=_0x52fe4b-0x7a;let _0x5ba4ee=_0x2eff70[_0x52fe4b];return _0x5ba4ee;},_0x52fe(_0x2c320e,_0xa0cf8c);}var __decorate=this&&this[_0x49e1d7(0x7b)]||function(_0x4feca2,_0x5be4bd,_0x596b04,_0x422135){const _0x246742=_0x49e1d7;var _0x2a1fd2=arguments['length'],_0x2c018c=_0x2a1fd2<0x3?_0x5be4bd:_0x422135===null?_0x422135=Object[_0x246742(0xcc)](_0x5be4bd,_0x596b04):_0x422135,_0x42a58d;if(typeof Reflect===_0x246742(0xc6)&&typeof Reflect[_0x246742(0x9d)]===_0x246742(0x8b))_0x2c018c=Reflect[_0x246742(0x9d)](_0x4feca2,_0x5be4bd,_0x596b04,_0x422135);else{for(var _0x363c7e=_0x4feca2['length']-0x1;_0x363c7e>=0x0;_0x363c7e--)if(_0x42a58d=_0x4feca2[_0x363c7e])_0x2c018c=(_0x2a1fd2<0x3?_0x42a58d(_0x2c018c):_0x2a1fd2>0x3?_0x42a58d(_0x5be4bd,_0x596b04,_0x2c018c):_0x42a58d(_0x5be4bd,_0x596b04))||_0x2c018c;}return _0x2a1fd2>0x3&&_0x2c018c&&Object[_0x246742(0xb1)](_0x5be4bd,_0x596b04,_0x2c018c),_0x2c018c;},__metadata=this&&this[_0x49e1d7(0xaf)]||function(_0x3168e2,_0x50d3e5){const _0x382eec=_0x49e1d7;if(typeof Reflect===_0x382eec(0xc6)&&typeof Reflect[_0x382eec(0x7a)]===_0x382eec(0x8b))return Reflect[_0x382eec(0x7a)](_0x3168e2,_0x50d3e5);},FluxDrawService_1;Object['defineProperty'](exports,_0x49e1d7(0x8f),{'value':!![]}),exports[_0x49e1d7(0x91)]=void 0x0;const common_1=require(_0x49e1d7(0x95)),axios_1=require('axios'),chatLog_service_1=require(_0x49e1d7(0xb0)),globalConfig_service_1=require(_0x49e1d7(0xca)),upload_service_1=require('../upload/upload.service'),openaiChat_service_1=require(_0x49e1d7(0xb5));let FluxDrawService=FluxDrawService_1=class FluxDrawService{constructor(_0x4068c5,_0x282866,_0xe4df0c,_0x5e84a0){const _0x9e7068=_0x49e1d7;this[_0x9e7068(0xbe)]=_0x4068c5,this['globalConfigService']=_0x282866,this[_0x9e7068(0x99)]=_0xe4df0c,this[_0x9e7068(0x92)]=_0x5e84a0,this[_0x9e7068(0x88)]=new common_1['Logger'](FluxDrawService_1[_0x9e7068(0xa2)]);}async['fluxDraw'](_0x1d5709,_0x27e8e7){const _0x2f4a98=_0x49e1d7;var _0x3a1246,_0x36f8c4,_0x3ecdd4,_0x4584e3;common_1[_0x2f4a98(0xc3)][_0x2f4a98(0x9b)](_0x2f4a98(0x83),_0x2f4a98(0x82));const {apiKey:_0x432382,model:_0x184832,proxyUrl:_0x4a94e7,prompt:_0x79d73c,extraParam:_0x47e0d2,timeout:_0x10fcdc,onSuccess:_0x3e3483,onFailure:_0x1f622b,groupId:_0x41883a}=_0x1d5709,_0xcfd5d0=await this[_0x2f4a98(0xbb)][_0x2f4a98(0xc0)]([_0x2f4a98(0xa6)]);let _0x258ea1;if(_0xcfd5d0==='1')try{common_1[_0x2f4a98(0xc3)]['log']('已开启连续绘画模式','FluxDraw');const {messagesHistory:_0x4af7d9}=await _0x27e8e7('参考上文，结合我的需求，给出绘画描述。我的需求是：'+_0x79d73c,{'groupId':_0x41883a,'systemMessage':'你是一个绘画提示词生成工具，请根据用户的要求，结合上下文，用一段文字，描述用户需要的绘画需求，不用包含任何礼貌性的寒暄,只需要场景的描述,可以适当联想','maxModelTokens':0x1f40,'maxRounds':0x5,'fileInfo':''},this[_0x2f4a98(0x99)]);_0x258ea1=await this[_0x2f4a98(0x92)]['chatFree'](_0x79d73c,undefined,_0x4af7d9);}catch(_0x75c9be){console[_0x2f4a98(0xbd)](_0x2f4a98(0xb8),_0x75c9be),_0x258ea1=_0x79d73c;}else _0x258ea1=_0x79d73c;const _0x117517=(_0x47e0d2===null||_0x47e0d2===void 0x0?void 0x0:_0x47e0d2['size'])||_0x2f4a98(0xc4);let _0x3a6a8d={'answer':'','fileInfo':'','status':0x2};try{const _0x4f9341={'method':_0x2f4a98(0x86),'url':_0x4a94e7+_0x2f4a98(0xaa),'timeout':_0x10fcdc,'headers':{'Content-Type':_0x2f4a98(0xa1),'Authorization':_0x2f4a98(0xac)+_0x432382},'data':{'model':_0x184832,'prompt':_0x258ea1,'size':_0x117517}};common_1[_0x2f4a98(0xc3)][_0x2f4a98(0x9b)](_0x2f4a98(0x98)+_0x4f9341['url']+'，payload:\x20'+JSON[_0x2f4a98(0xb4)](_0x4f9341[_0x2f4a98(0x80)])+_0x2f4a98(0xb6)+JSON['stringify'](_0x4f9341['headers']),'FluxDrawService');const _0x1fb3bd=await(0x0,axios_1[_0x2f4a98(0xcb)])(_0x4f9341);common_1['Logger'][_0x2f4a98(0xad)]('请求成功'+JSON['stringify'](_0x1fb3bd['data'][_0x2f4a98(0x80)][0x0])),common_1[_0x2f4a98(0xc3)][_0x2f4a98(0xad)](_0x2f4a98(0x7e)+JSON[_0x2f4a98(0xb4)](_0x1fb3bd[_0x2f4a98(0xbc)]));const _0x55d6dc=_0x1fb3bd[_0x2f4a98(0x80)][_0x2f4a98(0x80)][0x0][_0x2f4a98(0xae)];try{common_1['Logger'][_0x2f4a98(0x9b)](_0x2f4a98(0xc1),'DrawService');const _0x1e764a=new Date(),_0xab4cbc=_0x1e764a[_0x2f4a98(0xbf)](),_0x5ddd0c=String(_0x1e764a['getMonth']()+0x1)['padStart'](0x2,'0'),_0x462a54=String(_0x1e764a[_0x2f4a98(0xa8)]())[_0x2f4a98(0x89)](0x2,'0'),_0x4a9c21=''+_0xab4cbc+_0x5ddd0c+'/'+_0x462a54;_0x3a6a8d['fileInfo']=await this['uploadService'][_0x2f4a98(0x8a)]({'url':_0x55d6dc,'dir':'images/dalle/'+_0x4a9c21}),common_1[_0x2f4a98(0xc3)][_0x2f4a98(0x9b)](_0x2f4a98(0xc8)+_0x3a6a8d[_0x2f4a98(0x9c)],_0x2f4a98(0x82));}catch(_0x5b83d4){common_1[_0x2f4a98(0xc3)][_0x2f4a98(0xbd)](_0x2f4a98(0xc5)+_0x5b83d4,_0x2f4a98(0x82));}let _0x1704b4;try{_0x1704b4=await this[_0x2f4a98(0x92)]['chatFree'](_0x2f4a98(0xb9)+_0x258ea1+_0x2f4a98(0xa3));}catch(_0x58a367){_0x1704b4=_0x79d73c+_0x2f4a98(0x8e),common_1[_0x2f4a98(0xc3)]['error'](_0x2f4a98(0xa7),_0x58a367);}_0x3a6a8d[_0x2f4a98(0xba)]=_0x1704b4,_0x3a6a8d[_0x2f4a98(0xbc)]=0x3,_0x3e3483(_0x3a6a8d);return;}catch(_0x29ff0f){_0x3a6a8d[_0x2f4a98(0xbc)]=0x5,_0x1f622b(_0x3a6a8d);const _0xeb76a5=((_0x3a1246=_0x29ff0f===null||_0x29ff0f===void 0x0?void 0x0:_0x29ff0f[_0x2f4a98(0xc2)])===null||_0x3a1246===void 0x0?void 0x0:_0x3a1246[_0x2f4a98(0xbc)])||0x1f4;console['log'](_0x2f4a98(0xc7),JSON[_0x2f4a98(0xb4)](_0x29ff0f),_0xeb76a5);const _0x20f3c4=(_0x4584e3=(_0x3ecdd4=(_0x36f8c4=_0x29ff0f===null||_0x29ff0f===void 0x0?void 0x0:_0x29ff0f[_0x2f4a98(0xc2)])===null||_0x36f8c4===void 0x0?void 0x0:_0x36f8c4['data'])===null||_0x3ecdd4===void 0x0?void 0x0:_0x3ecdd4[_0x2f4a98(0xbd)])===null||_0x4584e3===void 0x0?void 0x0:_0x4584e3[_0x2f4a98(0x93)];if(_0xeb76a5===0x1ad)return _0x3a6a8d[_0x2f4a98(0xa4)]=_0x2f4a98(0xb2),_0x3a6a8d;if(_0xeb76a5===0x190&&_0x20f3c4[_0x2f4a98(0x9a)](_0x2f4a98(0xb7)))return _0x3a6a8d[_0x2f4a98(0xa4)]=_0x2f4a98(0x7c),_0x3a6a8d;if(_0xeb76a5===0x190&&_0x20f3c4['includes'](_0x2f4a98(0xa0)))return _0x3a6a8d[_0x2f4a98(0xa4)]=_0x2f4a98(0xc9),_0x3a6a8d;if(_0xeb76a5===0x1f4)return _0x3a6a8d[_0x2f4a98(0xa4)]=_0x2f4a98(0x84),_0x3a6a8d;if(_0xeb76a5===0x191)return _0x3a6a8d[_0x2f4a98(0xa4)]='绘制图片失败，此次绘画被拒绝了！',_0x3a6a8d;return _0x3a6a8d['text']=_0x2f4a98(0x97),_0x3a6a8d;}}};FluxDrawService=FluxDrawService_1=__decorate([(0x0,common_1[_0x49e1d7(0x85)])(),__metadata(_0x49e1d7(0x8d),[upload_service_1[_0x49e1d7(0x87)],globalConfig_service_1[_0x49e1d7(0xab)],chatLog_service_1[_0x49e1d7(0x9e)],openaiChat_service_1[_0x49e1d7(0xa9)]])],FluxDrawService),exports['FluxDrawService']=FluxDrawService;function _0x2eff(){const _0x10aea3=['/v1/images/generations','GlobalConfigService','Bearer\x20','debug','url','__metadata','../chatLog/chatLog.service','defineProperty','当前请求已过载、请稍等会儿再试试吧！','1659uUkyFv','stringify','./openaiChat.service',',\x20headers:\x20','This\x20request\x20has\x20been\x20blocked\x20by\x20our\x20content\x20filters','调用chatFree失败：','根据提示词{','answer','globalConfigService','status','error','uploadService','getFullYear','getConfigs','------>\x20开始上传图片！！！','response','Logger','1024x1024','上传图片过程中出现错误:\x20','object','draw\x20error:\x20','图片上传成功，URL:\x20','当前模型key已被封禁、已冻结当前调用Key、尝试重新对话试试吧！','../globalConfig/globalConfig.service','default','getOwnPropertyDescriptor','metadata','__decorate','您的请求已被系统拒绝。您的提示可能存在一些非法的文本。','1860HeHSRy','请求状态','184611FaXEFu','data','2421461AFZalq','DrawService','开始提交\x20Flux\x20绘图任务\x20','绘制图片失败，请检查你的提示词是否有非法描述！','Injectable','POST','UploadService','logger','padStart','uploadFileFromUrl','function','8YHfThj','design:paramtypes','\x20绘制成功','__esModule','77530KqWuRZ','FluxDrawService','openAIChatService','message','1181250eHDxyu','@nestjs/common','60XlXWTA','绘制图片失败，请稍后试试吧！','正在准备发送请求到\x20','chatLogService','includes','log','fileInfo','decorate','ChatLogService','1723720wyceKw','Billing\x20hard\x20limit\x20has\x20been\x20reached','application/json','name','},\x20模拟AI绘画机器人的语气，用中文回复，告诉用户已经画好了','text','347664kzmDBe','isDalleChat','翻译失败:\x20','getDate','OpenAIChatService'];_0x2eff=function(){return _0x10aea3;};return _0x2eff();}