'use strict';const _0x4efe3c=_0x123d;(function(_0x190057,_0x33cadc){const _0x24218b=_0x123d,_0xef6ecb=_0x190057();while(!![]){try{const _0x2849d4=-parseInt(_0x24218b(0x1a3))/0x1+-parseInt(_0x24218b(0x160))/0x2+parseInt(_0x24218b(0x164))/0x3*(parseInt(_0x24218b(0x16c))/0x4)+-parseInt(_0x24218b(0x182))/0x5+-parseInt(_0x24218b(0x196))/0x6*(parseInt(_0x24218b(0x1ae))/0x7)+-parseInt(_0x24218b(0x1a1))/0x8*(-parseInt(_0x24218b(0x18e))/0x9)+parseInt(_0x24218b(0x1ab))/0xa;if(_0x2849d4===_0x33cadc)break;else _0xef6ecb['push'](_0xef6ecb['shift']());}catch(_0x243e29){_0xef6ecb['push'](_0xef6ecb['shift']());}}}(_0x1be8,0xbcc90));var __decorate=this&&this['__decorate']||function(_0x15c500,_0x5b9fdd,_0x14e863,_0x21b6ac){const _0x5e9347=_0x123d;var _0x1e650c=arguments[_0x5e9347(0x1a0)],_0xec36bb=_0x1e650c<0x3?_0x5b9fdd:_0x21b6ac===null?_0x21b6ac=Object[_0x5e9347(0x195)](_0x5b9fdd,_0x14e863):_0x21b6ac,_0x3d1935;if(typeof Reflect===_0x5e9347(0x15f)&&typeof Reflect[_0x5e9347(0x166)]===_0x5e9347(0x18b))_0xec36bb=Reflect['decorate'](_0x15c500,_0x5b9fdd,_0x14e863,_0x21b6ac);else{for(var _0x414f91=_0x15c500['length']-0x1;_0x414f91>=0x0;_0x414f91--)if(_0x3d1935=_0x15c500[_0x414f91])_0xec36bb=(_0x1e650c<0x3?_0x3d1935(_0xec36bb):_0x1e650c>0x3?_0x3d1935(_0x5b9fdd,_0x14e863,_0xec36bb):_0x3d1935(_0x5b9fdd,_0x14e863))||_0xec36bb;}return _0x1e650c>0x3&&_0xec36bb&&Object[_0x5e9347(0x186)](_0x5b9fdd,_0x14e863,_0xec36bb),_0xec36bb;},__metadata=this&&this[_0x4efe3c(0x161)]||function(_0x2be952,_0x4d2340){const _0x4b6c74=_0x4efe3c;if(typeof Reflect===_0x4b6c74(0x15f)&&typeof Reflect['metadata']===_0x4b6c74(0x18b))return Reflect[_0x4b6c74(0x17c)](_0x2be952,_0x4d2340);},FluxDrawService_1;function _0x1be8(){const _0x7bb60a=['error','text','globalConfigService','getMonth','uploadFileFromUrl','4rhhQYd','\x20绘制成功','chatLogService','uploadService','data','draw\x20error:\x20','调用chatFree失败：','chatFree','getFullYear','../upload/upload.service','ChatLogService',',\x20headers:\x20','getDate','axios','getConfigs','你是一个绘画提示词生成工具，请根据用户的要求，结合上下文，用一段文字，描述用户需要的绘画需求，不用包含任何礼貌性的寒暄,只需要场景的描述,可以适当联想','metadata','根据提示词{','default','debug','Billing\x20hard\x20limit\x20has\x20been\x20reached','isDalleChat','3978630rpnvnZ','图片上传成功，URL:\x20','images/dalle/','response','defineProperty','stringify','Bearer\x20','logger','绘制图片失败，此次绘画被拒绝了！','function','正在准备发送请求到\x20','已开启连续绘画模式','37413HlIzGB','openAIChatService','status','size','url','FluxDraw','includes','getOwnPropertyDescriptor','1031610rftTSq','绘制图片失败，请检查你的提示词是否有非法描述！','GlobalConfigService','headers','请求成功','answer','------>\x20开始上传图片！！！','OpenAIChatService','您的请求已被系统拒绝。您的提示可能存在一些非法的文本。','Injectable','length','1848kVBTlz','POST','1064027UsOEqH','design:paramtypes','log','DrawService','绘制图片失败，请稍后试试吧！','padStart','开始提交\x20Flux\x20绘图任务\x20','当前模型key已被封禁、已冻结当前调用Key、尝试重新对话试试吧！','20973940NePctf','__esModule','},\x20模拟AI绘画机器人的语气，用中文回复，告诉用户已经画好了','35aUyrtm','fluxDraw','上传图片过程中出现错误:\x20','object','1111796EeTIZq','__metadata','Logger','../chatLog/chatLog.service','2972787GVtGuX','当前请求已过载、请稍等会儿再试试吧！','decorate'];_0x1be8=function(){return _0x7bb60a;};return _0x1be8();}Object['defineProperty'](exports,_0x4efe3c(0x1ac),{'value':!![]}),exports['FluxDrawService']=void 0x0;const common_1=require('@nestjs/common'),axios_1=require(_0x4efe3c(0x179)),chatLog_service_1=require(_0x4efe3c(0x163)),globalConfig_service_1=require('../globalConfig/globalConfig.service'),upload_service_1=require(_0x4efe3c(0x175)),openaiChat_service_1=require('./openaiChat.service');function _0x123d(_0x410236,_0xa86baa){const _0x1be898=_0x1be8();return _0x123d=function(_0x123d01,_0x1289af){_0x123d01=_0x123d01-0x15f;let _0x47b53f=_0x1be898[_0x123d01];return _0x47b53f;},_0x123d(_0x410236,_0xa86baa);}let FluxDrawService=FluxDrawService_1=class FluxDrawService{constructor(_0x5545a3,_0x1bff06,_0x342f96,_0x376b4d){const _0x5adefa=_0x4efe3c;this[_0x5adefa(0x16f)]=_0x5545a3,this[_0x5adefa(0x169)]=_0x1bff06,this[_0x5adefa(0x16e)]=_0x342f96,this['openAIChatService']=_0x376b4d,this[_0x5adefa(0x189)]=new common_1[(_0x5adefa(0x162))](FluxDrawService_1['name']);}async[_0x4efe3c(0x1af)](_0x924743,_0xf8fb2c){const _0x4fd389=_0x4efe3c;var _0x5ece6f,_0x5027c6,_0x5e92da,_0x29d6fb;common_1[_0x4fd389(0x162)]['log'](_0x4fd389(0x1a9),_0x4fd389(0x1a6));const {apiKey:_0x5db5c9,model:_0x49cf8e,proxyUrl:_0x1c13c2,prompt:_0x17309d,extraParam:_0x124ce1,timeout:_0x4756ab,onSuccess:_0x33b672,onFailure:_0x40cfe1,groupId:_0x5f5cb6}=_0x924743,_0x271163=await this[_0x4fd389(0x169)][_0x4fd389(0x17a)]([_0x4fd389(0x181)]);let _0x45f7e1;if(_0x271163==='1')try{common_1[_0x4fd389(0x162)][_0x4fd389(0x1a5)](_0x4fd389(0x18d),_0x4fd389(0x193));const {messagesHistory:_0x2c525c}=await _0xf8fb2c('参考上文，结合我的需求，给出绘画描述。我的需求是：'+_0x17309d,{'groupId':_0x5f5cb6,'systemMessage':_0x4fd389(0x17b),'maxModelTokens':0x1f40,'maxRounds':0x5,'fileInfo':''},this[_0x4fd389(0x16e)]);_0x45f7e1=await this[_0x4fd389(0x18f)][_0x4fd389(0x173)](_0x17309d,undefined,_0x2c525c);}catch(_0x5afae1){console[_0x4fd389(0x167)](_0x4fd389(0x172),_0x5afae1),_0x45f7e1=_0x17309d;}else _0x45f7e1=_0x17309d;const _0xbbc280=(_0x124ce1===null||_0x124ce1===void 0x0?void 0x0:_0x124ce1[_0x4fd389(0x191)])||'1024x1024';let _0x111f40={'answer':'','fileInfo':'','status':0x2};try{const _0xc914a1={'method':_0x4fd389(0x1a2),'url':_0x1c13c2+'/v1/images/generations','timeout':_0x4756ab,'headers':{'Content-Type':'application/json','Authorization':_0x4fd389(0x188)+_0x5db5c9},'data':{'model':_0x49cf8e,'prompt':_0x45f7e1,'size':_0xbbc280}};common_1['Logger'][_0x4fd389(0x1a5)](_0x4fd389(0x18c)+_0xc914a1[_0x4fd389(0x192)]+'，payload:\x20'+JSON['stringify'](_0xc914a1['data'])+_0x4fd389(0x177)+JSON['stringify'](_0xc914a1[_0x4fd389(0x199)]),'FluxDrawService');const _0x231b63=await(0x0,axios_1[_0x4fd389(0x17e)])(_0xc914a1);common_1[_0x4fd389(0x162)][_0x4fd389(0x17f)](_0x4fd389(0x19a)+JSON[_0x4fd389(0x187)](_0x231b63[_0x4fd389(0x170)][_0x4fd389(0x170)][0x0])),common_1[_0x4fd389(0x162)]['debug']('请求状态'+JSON[_0x4fd389(0x187)](_0x231b63['status']));const _0x4fc83c=_0x231b63[_0x4fd389(0x170)][_0x4fd389(0x170)][0x0]['url'];try{common_1[_0x4fd389(0x162)][_0x4fd389(0x1a5)](_0x4fd389(0x19c),'DrawService');const _0x115538=new Date(),_0x1f15b1=_0x115538[_0x4fd389(0x174)](),_0x385deb=String(_0x115538[_0x4fd389(0x16a)]()+0x1)['padStart'](0x2,'0'),_0x5ee42a=String(_0x115538[_0x4fd389(0x178)]())[_0x4fd389(0x1a8)](0x2,'0'),_0x2e4b40=''+_0x1f15b1+_0x385deb+'/'+_0x5ee42a;_0x111f40['fileInfo']=await this[_0x4fd389(0x16f)][_0x4fd389(0x16b)]({'url':_0x4fc83c,'dir':_0x4fd389(0x184)+_0x2e4b40}),common_1[_0x4fd389(0x162)]['log'](_0x4fd389(0x183)+_0x111f40['fileInfo'],'DrawService');}catch(_0x697019){common_1[_0x4fd389(0x162)][_0x4fd389(0x167)](_0x4fd389(0x1b0)+_0x697019,_0x4fd389(0x1a6));}let _0x2a71be;try{_0x2a71be=await this[_0x4fd389(0x18f)][_0x4fd389(0x173)](_0x4fd389(0x17d)+_0x45f7e1+_0x4fd389(0x1ad));}catch(_0x4b7438){_0x2a71be=_0x17309d+_0x4fd389(0x16d),common_1[_0x4fd389(0x162)][_0x4fd389(0x167)]('翻译失败:\x20',_0x4b7438);}_0x111f40[_0x4fd389(0x19b)]=_0x2a71be,_0x111f40[_0x4fd389(0x190)]=0x3,_0x33b672(_0x111f40);return;}catch(_0x49011e){_0x111f40['status']=0x5,_0x40cfe1(_0x111f40);const _0x48a808=((_0x5ece6f=_0x49011e===null||_0x49011e===void 0x0?void 0x0:_0x49011e[_0x4fd389(0x185)])===null||_0x5ece6f===void 0x0?void 0x0:_0x5ece6f[_0x4fd389(0x190)])||0x1f4;console[_0x4fd389(0x1a5)](_0x4fd389(0x171),JSON[_0x4fd389(0x187)](_0x49011e),_0x48a808);const _0x271074=(_0x29d6fb=(_0x5e92da=(_0x5027c6=_0x49011e===null||_0x49011e===void 0x0?void 0x0:_0x49011e[_0x4fd389(0x185)])===null||_0x5027c6===void 0x0?void 0x0:_0x5027c6[_0x4fd389(0x170)])===null||_0x5e92da===void 0x0?void 0x0:_0x5e92da['error'])===null||_0x29d6fb===void 0x0?void 0x0:_0x29d6fb['message'];if(_0x48a808===0x1ad)return _0x111f40[_0x4fd389(0x168)]=_0x4fd389(0x165),_0x111f40;if(_0x48a808===0x190&&_0x271074[_0x4fd389(0x194)]('This\x20request\x20has\x20been\x20blocked\x20by\x20our\x20content\x20filters'))return _0x111f40[_0x4fd389(0x168)]=_0x4fd389(0x19e),_0x111f40;if(_0x48a808===0x190&&_0x271074[_0x4fd389(0x194)](_0x4fd389(0x180)))return _0x111f40[_0x4fd389(0x168)]=_0x4fd389(0x1aa),_0x111f40;if(_0x48a808===0x1f4)return _0x111f40[_0x4fd389(0x168)]=_0x4fd389(0x197),_0x111f40;if(_0x48a808===0x191)return _0x111f40[_0x4fd389(0x168)]=_0x4fd389(0x18a),_0x111f40;return _0x111f40[_0x4fd389(0x168)]=_0x4fd389(0x1a7),_0x111f40;}}};FluxDrawService=FluxDrawService_1=__decorate([(0x0,common_1[_0x4efe3c(0x19f)])(),__metadata(_0x4efe3c(0x1a4),[upload_service_1['UploadService'],globalConfig_service_1[_0x4efe3c(0x198)],chatLog_service_1[_0x4efe3c(0x176)],openaiChat_service_1[_0x4efe3c(0x19d)]])],FluxDrawService),exports['FluxDrawService']=FluxDrawService;