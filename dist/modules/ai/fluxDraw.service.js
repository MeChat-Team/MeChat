'use strict';const _0x1bb083=_0x7753;(function(_0xcad01e,_0x57666f){const _0x339ef7=_0x7753,_0xbdddb8=_0xcad01e();while(!![]){try{const _0x2e1045=parseInt(_0x339ef7(0xe0))/0x1+parseInt(_0x339ef7(0xcb))/0x2*(parseInt(_0x339ef7(0xd2))/0x3)+-parseInt(_0x339ef7(0x10d))/0x4+-parseInt(_0x339ef7(0xe8))/0x5*(parseInt(_0x339ef7(0xee))/0x6)+-parseInt(_0x339ef7(0x117))/0x7+-parseInt(_0x339ef7(0xe7))/0x8*(-parseInt(_0x339ef7(0xde))/0x9)+-parseInt(_0x339ef7(0x10b))/0xa*(-parseInt(_0x339ef7(0xcd))/0xb);if(_0x2e1045===_0x57666f)break;else _0xbdddb8['push'](_0xbdddb8['shift']());}catch(_0x45fbf5){_0xbdddb8['push'](_0xbdddb8['shift']());}}}(_0x2134,0x2c651));var __decorate=this&&this['__decorate']||function(_0x398a73,_0x24894a,_0x5984af,_0x6f424a){const _0x1a5db1=_0x7753;var _0x5340e8=arguments[_0x1a5db1(0x111)],_0x58f67a=_0x5340e8<0x3?_0x24894a:_0x6f424a===null?_0x6f424a=Object[_0x1a5db1(0xfe)](_0x24894a,_0x5984af):_0x6f424a,_0x4d899e;if(typeof Reflect===_0x1a5db1(0xf7)&&typeof Reflect[_0x1a5db1(0xdf)]===_0x1a5db1(0x116))_0x58f67a=Reflect[_0x1a5db1(0xdf)](_0x398a73,_0x24894a,_0x5984af,_0x6f424a);else{for(var _0x51ecff=_0x398a73[_0x1a5db1(0x111)]-0x1;_0x51ecff>=0x0;_0x51ecff--)if(_0x4d899e=_0x398a73[_0x51ecff])_0x58f67a=(_0x5340e8<0x3?_0x4d899e(_0x58f67a):_0x5340e8>0x3?_0x4d899e(_0x24894a,_0x5984af,_0x58f67a):_0x4d899e(_0x24894a,_0x5984af))||_0x58f67a;}return _0x5340e8>0x3&&_0x58f67a&&Object[_0x1a5db1(0xd7)](_0x24894a,_0x5984af,_0x58f67a),_0x58f67a;},__metadata=this&&this[_0x1bb083(0xcc)]||function(_0x2c30be,_0x42f974){const _0x31fae4=_0x1bb083;if(typeof Reflect==='object'&&typeof Reflect[_0x31fae4(0xf3)]===_0x31fae4(0x116))return Reflect[_0x31fae4(0xf3)](_0x2c30be,_0x42f974);},FluxDrawService_1;Object[_0x1bb083(0xd7)](exports,_0x1bb083(0xfa),{'value':!![]}),exports['FluxDrawService']=void 0x0;const common_1=require('@nestjs/common'),axios_1=require(_0x1bb083(0xfd)),chatLog_service_1=require(_0x1bb083(0x105)),globalConfig_service_1=require(_0x1bb083(0xc7)),upload_service_1=require('../upload/upload.service'),openaiChat_service_1=require('./openaiChat.service');let FluxDrawService=FluxDrawService_1=class FluxDrawService{constructor(_0x56f20f,_0x1f1601,_0x2cd2bd,_0x297ac7){const _0x335c7a=_0x1bb083;this[_0x335c7a(0xd3)]=_0x56f20f,this[_0x335c7a(0x106)]=_0x1f1601,this[_0x335c7a(0x113)]=_0x2cd2bd,this[_0x335c7a(0x104)]=_0x297ac7,this[_0x335c7a(0xe1)]=new common_1[(_0x335c7a(0x109))](FluxDrawService_1[_0x335c7a(0xca)]);}async['fluxDraw'](_0x3f4dca,_0x48b931){const _0x2a77a6=_0x1bb083;var _0x1def95,_0x56306a,_0x4c60c6,_0x154364;common_1['Logger']['log']('开始提交\x20Flux\x20绘图任务\x20',_0x2a77a6(0x10a));const {apiKey:_0x75a7e5,model:_0x253fcb,proxyUrl:_0x51155e,prompt:_0x536de0,extraParam:_0x3da67d,timeout:_0x2506fa,onSuccess:_0x20ec12,onFailure:_0x3069bd,groupId:_0x3e63d9}=_0x3f4dca,_0x53fd07=await this['globalConfigService']['getConfigs']([_0x2a77a6(0x108)]);let _0x22cfa6;if(_0x53fd07==='1')try{common_1['Logger'][_0x2a77a6(0x114)](_0x2a77a6(0xdc),_0x2a77a6(0xdd));const {messagesHistory:_0x3e8f59}=await _0x48b931(_0x2a77a6(0xc9)+_0x536de0,{'groupId':_0x3e63d9,'systemMessage':_0x2a77a6(0x10c),'maxModelTokens':0x1f40,'maxRounds':0x5,'fileInfo':''},this[_0x2a77a6(0x113)]);_0x22cfa6=await this[_0x2a77a6(0x104)][_0x2a77a6(0xff)](_0x536de0,undefined,_0x3e8f59);}catch(_0xc63e77){console[_0x2a77a6(0x103)](_0x2a77a6(0xe5),_0xc63e77),_0x22cfa6=_0x536de0;}else _0x22cfa6=_0x536de0;const _0x848acc=(_0x3da67d===null||_0x3da67d===void 0x0?void 0x0:_0x3da67d[_0x2a77a6(0xf0)])||_0x2a77a6(0xe6);let _0x31d1d5={'answer':'','fileInfo':'','status':0x2};try{const _0x3c896f={'method':_0x2a77a6(0xd9),'url':_0x51155e+_0x2a77a6(0x110),'timeout':_0x2506fa,'headers':{'Content-Type':_0x2a77a6(0xed),'Authorization':_0x2a77a6(0xce)+_0x75a7e5},'data':{'model':_0x253fcb,'prompt':_0x22cfa6,'size':_0x848acc}};common_1[_0x2a77a6(0x109)][_0x2a77a6(0x114)](_0x2a77a6(0x10e)+_0x3c896f['url']+'，payload:\x20'+JSON[_0x2a77a6(0xf2)](_0x3c896f[_0x2a77a6(0xf4)])+',\x20headers:\x20'+JSON[_0x2a77a6(0xf2)](_0x3c896f[_0x2a77a6(0xe9)]),_0x2a77a6(0x10f));const _0x7924f=await(0x0,axios_1[_0x2a77a6(0xf8)])(_0x3c896f);common_1[_0x2a77a6(0x109)][_0x2a77a6(0xdb)](_0x2a77a6(0xeb)+JSON[_0x2a77a6(0xf2)](_0x7924f[_0x2a77a6(0xf4)]['data'][0x0])),common_1[_0x2a77a6(0x109)][_0x2a77a6(0xdb)]('请求状态'+JSON[_0x2a77a6(0xf2)](_0x7924f['status']));const _0x152d4c=_0x7924f[_0x2a77a6(0xf4)][_0x2a77a6(0xf4)][0x0][_0x2a77a6(0xd0)];try{common_1[_0x2a77a6(0x109)][_0x2a77a6(0x114)](_0x2a77a6(0xe4),_0x2a77a6(0x10a));const _0x44b67f=new Date(),_0x5ec70a=_0x44b67f['getFullYear'](),_0x35d5d9=String(_0x44b67f['getMonth']()+0x1)[_0x2a77a6(0xd6)](0x2,'0'),_0x5ab874=String(_0x44b67f['getDate']())['padStart'](0x2,'0'),_0x3a537f=''+_0x5ec70a+_0x35d5d9+'/'+_0x5ab874;_0x31d1d5[_0x2a77a6(0x115)]=await this[_0x2a77a6(0xd3)][_0x2a77a6(0xf6)]({'url':_0x152d4c,'dir':_0x2a77a6(0xd1)+_0x3a537f}),common_1[_0x2a77a6(0x109)]['log'](_0x2a77a6(0xfc)+_0x31d1d5['fileInfo'],_0x2a77a6(0x10a));}catch(_0x30c19f){common_1[_0x2a77a6(0x109)][_0x2a77a6(0x103)](_0x2a77a6(0xef)+_0x30c19f,_0x2a77a6(0x10a));}let _0x2fe438;try{_0x2fe438=await this[_0x2a77a6(0x104)][_0x2a77a6(0xff)]('根据提示词{'+_0x22cfa6+_0x2a77a6(0xda));}catch(_0xde084d){_0x2fe438=_0x536de0+_0x2a77a6(0xea),common_1[_0x2a77a6(0x109)]['error'](_0x2a77a6(0x112),_0xde084d);}_0x31d1d5[_0x2a77a6(0x101)]=_0x2fe438,_0x31d1d5[_0x2a77a6(0xf1)]=0x3,_0x20ec12(_0x31d1d5);return;}catch(_0x29664c){_0x31d1d5['status']=0x5,_0x3069bd(_0x31d1d5);const _0x2ae843=((_0x1def95=_0x29664c===null||_0x29664c===void 0x0?void 0x0:_0x29664c[_0x2a77a6(0xc8)])===null||_0x1def95===void 0x0?void 0x0:_0x1def95[_0x2a77a6(0xf1)])||0x1f4;console[_0x2a77a6(0x114)](_0x2a77a6(0xf5),JSON[_0x2a77a6(0xf2)](_0x29664c),_0x2ae843);const _0x19c483=(_0x154364=(_0x4c60c6=(_0x56306a=_0x29664c===null||_0x29664c===void 0x0?void 0x0:_0x29664c['response'])===null||_0x56306a===void 0x0?void 0x0:_0x56306a[_0x2a77a6(0xf4)])===null||_0x4c60c6===void 0x0?void 0x0:_0x4c60c6[_0x2a77a6(0x103)])===null||_0x154364===void 0x0?void 0x0:_0x154364['message'];if(_0x2ae843===0x1ad)return _0x31d1d5[_0x2a77a6(0xe3)]=_0x2a77a6(0x118),_0x31d1d5;if(_0x2ae843===0x190&&_0x19c483['includes'](_0x2a77a6(0x102)))return _0x31d1d5[_0x2a77a6(0xe3)]=_0x2a77a6(0xcf),_0x31d1d5;if(_0x2ae843===0x190&&_0x19c483[_0x2a77a6(0xf9)]('Billing\x20hard\x20limit\x20has\x20been\x20reached'))return _0x31d1d5[_0x2a77a6(0xe3)]=_0x2a77a6(0xec),_0x31d1d5;if(_0x2ae843===0x1f4)return _0x31d1d5[_0x2a77a6(0xe3)]=_0x2a77a6(0xd5),_0x31d1d5;if(_0x2ae843===0x191)return _0x31d1d5['text']='绘制图片失败，此次绘画被拒绝了！',_0x31d1d5;return _0x31d1d5[_0x2a77a6(0xe3)]='绘制图片失败，请稍后试试吧！',_0x31d1d5;}}};FluxDrawService=FluxDrawService_1=__decorate([(0x0,common_1[_0x1bb083(0xfb)])(),__metadata(_0x1bb083(0x107),[upload_service_1[_0x1bb083(0x100)],globalConfig_service_1[_0x1bb083(0xd8)],chatLog_service_1[_0x1bb083(0xe2)],openaiChat_service_1[_0x1bb083(0xd4)]])],FluxDrawService),exports[_0x1bb083(0x10f)]=FluxDrawService;function _0x7753(_0x1b94da,_0x200ce2){const _0x213452=_0x2134();return _0x7753=function(_0x775327,_0x3b83c7){_0x775327=_0x775327-0xc7;let _0x2383d0=_0x213452[_0x775327];return _0x2383d0;},_0x7753(_0x1b94da,_0x200ce2);}function _0x2134(){const _0x38da7c=['getOwnPropertyDescriptor','chatFree','UploadService','answer','This\x20request\x20has\x20been\x20blocked\x20by\x20our\x20content\x20filters','error','openAIChatService','../chatLog/chatLog.service','globalConfigService','design:paramtypes','isDalleChat','Logger','DrawService','1270ILdqcx','你是一个绘画提示词生成工具，请根据用户的要求，结合上下文，用一段文字，描述用户需要的绘画需求，不用包含任何礼貌性的寒暄,只需要场景的描述,可以适当联想','1424944eELAKn','正在准备发送请求到\x20','FluxDrawService','/v1/images/generations','length','翻译失败:\x20','chatLogService','log','fileInfo','function','1565277cxWkvF','当前请求已过载、请稍等会儿再试试吧！','../globalConfig/globalConfig.service','response','参考上文，结合我的需求，给出绘画描述。我的需求是：','name','42566JCEHFg','__metadata','23155chBnyf','Bearer\x20','您的请求已被系统拒绝。您的提示可能存在一些非法的文本。','url','images/dalle/','15bXBYmB','uploadService','OpenAIChatService','绘制图片失败，请检查你的提示词是否有非法描述！','padStart','defineProperty','GlobalConfigService','POST','},\x20模拟AI绘画机器人的语气，用中文回复，告诉用户已经画好了','debug','已开启连续绘画模式','FluxDraw','81261fzLcZJ','decorate','206061ZlUDfL','logger','ChatLogService','text','------>\x20开始上传图片！！！','调用chatFree失败：','1024x1024','184XLPqeC','25790oDPwms','headers','\x20绘制成功','请求成功','当前模型key已被封禁、已冻结当前调用Key、尝试重新对话试试吧！','application/json','30DlZsMj','上传图片过程中出现错误:\x20','size','status','stringify','metadata','data','draw\x20error:\x20','uploadFileFromUrl','object','default','includes','__esModule','Injectable','图片上传成功，URL:\x20','axios'];_0x2134=function(){return _0x38da7c;};return _0x2134();}