'use strict';const _0x351bbb=_0x8160;(function(_0x307286,_0x495908){const _0x6c2fde=_0x8160,_0x4a175d=_0x307286();while(!![]){try{const _0x48e9ad=-parseInt(_0x6c2fde(0xda))/0x1+parseInt(_0x6c2fde(0xf2))/0x2*(parseInt(_0x6c2fde(0xdd))/0x3)+parseInt(_0x6c2fde(0xd6))/0x4+parseInt(_0x6c2fde(0xd7))/0x5+-parseInt(_0x6c2fde(0xbb))/0x6*(parseInt(_0x6c2fde(0xfa))/0x7)+-parseInt(_0x6c2fde(0xdf))/0x8+parseInt(_0x6c2fde(0xf0))/0x9;if(_0x48e9ad===_0x495908)break;else _0x4a175d['push'](_0x4a175d['shift']());}catch(_0x3b65a7){_0x4a175d['push'](_0x4a175d['shift']());}}}(_0x3028,0x95fd4));function _0x3028(){const _0x4fc4ab=['},\x20模拟AI绘画机器人的语气，用中文回复，告诉用户已经画好了','../upload/upload.service','getFullYear','defineProperty','metadata','fluxDraw','@nestjs/common','../chatLog/chatLog.service','------>\x20开始上传图片！！！','当前模型key已被封禁、已冻结当前调用Key、尝试重新对话试试吧！','翻译失败:\x20','Logger',',\x20headers:\x20','1129272dDNmeO','4728105hJUCKD','参考上文，结合我的需求，给出绘画描述。我的需求是：','开始提交\x20Flux\x20绘图任务\x20','125610MJejKy','请求状态','headers','1462287sFgeHT','images/dalle/','7897136jPrVZo','DrawService','FluxDraw','message','length','Injectable','uploadService','chatLogService','status','globalConfigService','log','answer','OpenAIChatService','已开启连续绘画模式','draw\x20error:\x20','object','绘制图片失败，此次绘画被拒绝了！','8516214bnURGQ','上传图片过程中出现错误:\x20','2ybDwYn','你是一个绘画提示词生成工具，请根据用户的要求，结合上下文，用一段文字，描述用户需要的绘画需求，不用包含任何礼貌性的寒暄,只需要场景的描述,可以适当联想','url','POST','application/json','./openaiChat.service','正在准备发送请求到\x20','图片上传成功，URL:\x20','363419yDhogy','includes','当前请求已过载、请稍等会儿再试试吧！','getMonth','name','绘制图片失败，请稍后试试吧！','axios','logger','debug','getDate','error','请求成功','绘制图片失败，请检查你的提示词是否有非法描述！','function','text','decorate','response','108EPneQs','fileInfo','getOwnPropertyDescriptor','FluxDrawService','，payload:\x20','Bearer\x20','stringify','This\x20request\x20has\x20been\x20blocked\x20by\x20our\x20content\x20filters','data','__esModule','padStart','openAIChatService','chatFree','根据提示词{'];_0x3028=function(){return _0x4fc4ab;};return _0x3028();}function _0x8160(_0x4d9700,_0x5dc18d){const _0x3028fe=_0x3028();return _0x8160=function(_0x8160a2,_0x489643){_0x8160a2=_0x8160a2-0xb2;let _0x56e02e=_0x3028fe[_0x8160a2];return _0x56e02e;},_0x8160(_0x4d9700,_0x5dc18d);}var __decorate=this&&this['__decorate']||function(_0x10e23e,_0x5ccdb7,_0x4860c1,_0x223812){const _0x492440=_0x8160;var _0x1226fe=arguments[_0x492440(0xe3)],_0x34726b=_0x1226fe<0x3?_0x5ccdb7:_0x223812===null?_0x223812=Object[_0x492440(0xbd)](_0x5ccdb7,_0x4860c1):_0x223812,_0x28d3b8;if(typeof Reflect===_0x492440(0xee)&&typeof Reflect[_0x492440(0xb9)]===_0x492440(0xb7))_0x34726b=Reflect[_0x492440(0xb9)](_0x10e23e,_0x5ccdb7,_0x4860c1,_0x223812);else{for(var _0x107b43=_0x10e23e[_0x492440(0xe3)]-0x1;_0x107b43>=0x0;_0x107b43--)if(_0x28d3b8=_0x10e23e[_0x107b43])_0x34726b=(_0x1226fe<0x3?_0x28d3b8(_0x34726b):_0x1226fe>0x3?_0x28d3b8(_0x5ccdb7,_0x4860c1,_0x34726b):_0x28d3b8(_0x5ccdb7,_0x4860c1))||_0x34726b;}return _0x1226fe>0x3&&_0x34726b&&Object['defineProperty'](_0x5ccdb7,_0x4860c1,_0x34726b),_0x34726b;},__metadata=this&&this['__metadata']||function(_0x4c8b75,_0x441f8c){const _0x54a5fc=_0x8160;if(typeof Reflect===_0x54a5fc(0xee)&&typeof Reflect[_0x54a5fc(0xcd)]===_0x54a5fc(0xb7))return Reflect[_0x54a5fc(0xcd)](_0x4c8b75,_0x441f8c);},FluxDrawService_1;Object[_0x351bbb(0xcc)](exports,_0x351bbb(0xc4),{'value':!![]}),exports['FluxDrawService']=void 0x0;const common_1=require(_0x351bbb(0xcf)),axios_1=require(_0x351bbb(0x100)),chatLog_service_1=require(_0x351bbb(0xd0)),globalConfig_service_1=require('../globalConfig/globalConfig.service'),upload_service_1=require(_0x351bbb(0xca)),openaiChat_service_1=require(_0x351bbb(0xf7));let FluxDrawService=FluxDrawService_1=class FluxDrawService{constructor(_0x5baf00,_0x229340,_0xa00b73,_0x5b2837){const _0x470323=_0x351bbb;this[_0x470323(0xe5)]=_0x5baf00,this['globalConfigService']=_0x229340,this[_0x470323(0xe6)]=_0xa00b73,this[_0x470323(0xc6)]=_0x5b2837,this[_0x470323(0x101)]=new common_1[(_0x470323(0xd4))](FluxDrawService_1[_0x470323(0xfe)]);}async[_0x351bbb(0xce)](_0x511344,_0x5ed74c){const _0x3963ea=_0x351bbb;var _0x128077,_0x80c359,_0x2587d1,_0x3f33fa;common_1[_0x3963ea(0xd4)]['log'](_0x3963ea(0xd9),_0x3963ea(0xe0));const {apiKey:_0x326e59,model:_0x4d1c89,proxyUrl:_0x19e1b5,prompt:_0x1c1943,extraParam:_0x3de666,timeout:_0x4ec961,onSuccess:_0x16784f,onFailure:_0x2cc1d8,groupId:_0x133d5f}=_0x511344,_0x4426e4=await this[_0x3963ea(0xe8)]['getConfigs'](['isDalleChat']);let _0x2ef70f;if(_0x4426e4==='1')try{common_1['Logger'][_0x3963ea(0xe9)](_0x3963ea(0xec),_0x3963ea(0xe1));const {messagesHistory:_0x49a04f}=await _0x5ed74c(_0x3963ea(0xd8)+_0x1c1943,{'groupId':_0x133d5f,'systemMessage':_0x3963ea(0xf3),'maxModelTokens':0x1f40,'maxRounds':0x5,'fileInfo':''},this['chatLogService']);_0x2ef70f=await this[_0x3963ea(0xc6)][_0x3963ea(0xc7)](_0x1c1943,undefined,_0x49a04f);}catch(_0xf3cdbe){console[_0x3963ea(0xb4)]('调用chatFree失败：',_0xf3cdbe),_0x2ef70f=_0x1c1943;}else _0x2ef70f=_0x1c1943;const _0x4766af=(_0x3de666===null||_0x3de666===void 0x0?void 0x0:_0x3de666['size'])||'1024x1024';let _0x2b25ad={'answer':'','fileInfo':'','status':0x2};try{const _0x59c654={'method':_0x3963ea(0xf5),'url':_0x19e1b5+'/v1/images/generations','timeout':_0x4ec961,'headers':{'Content-Type':_0x3963ea(0xf6),'Authorization':_0x3963ea(0xc0)+_0x326e59},'data':{'model':_0x4d1c89,'prompt':_0x2ef70f,'size':_0x4766af}};common_1[_0x3963ea(0xd4)]['log'](_0x3963ea(0xf8)+_0x59c654['url']+_0x3963ea(0xbf)+JSON[_0x3963ea(0xc1)](_0x59c654[_0x3963ea(0xc3)])+_0x3963ea(0xd5)+JSON[_0x3963ea(0xc1)](_0x59c654[_0x3963ea(0xdc)]),_0x3963ea(0xbe));const _0x2f595f=await(0x0,axios_1['default'])(_0x59c654);common_1[_0x3963ea(0xd4)][_0x3963ea(0xb2)](_0x3963ea(0xb5)+JSON[_0x3963ea(0xc1)](_0x2f595f[_0x3963ea(0xc3)][_0x3963ea(0xc3)][0x0])),common_1[_0x3963ea(0xd4)][_0x3963ea(0xb2)](_0x3963ea(0xdb)+JSON[_0x3963ea(0xc1)](_0x2f595f['status']));const _0x3bbc46=_0x2f595f['data'][_0x3963ea(0xc3)][0x0][_0x3963ea(0xf4)];try{common_1[_0x3963ea(0xd4)][_0x3963ea(0xe9)](_0x3963ea(0xd1),'DrawService');const _0x107010=new Date(),_0x327358=_0x107010[_0x3963ea(0xcb)](),_0x23e7a3=String(_0x107010[_0x3963ea(0xfd)]()+0x1)[_0x3963ea(0xc5)](0x2,'0'),_0x50f2ba=String(_0x107010[_0x3963ea(0xb3)]())['padStart'](0x2,'0'),_0xb263aa=''+_0x327358+_0x23e7a3+'/'+_0x50f2ba;_0x2b25ad['fileInfo']=await this[_0x3963ea(0xe5)]['uploadFileFromUrl']({'url':_0x3bbc46,'dir':_0x3963ea(0xde)+_0xb263aa}),common_1[_0x3963ea(0xd4)][_0x3963ea(0xe9)](_0x3963ea(0xf9)+_0x2b25ad[_0x3963ea(0xbc)],'DrawService');}catch(_0x5b86b6){common_1[_0x3963ea(0xd4)][_0x3963ea(0xb4)](_0x3963ea(0xf1)+_0x5b86b6,_0x3963ea(0xe0));}let _0x2cdf65;try{_0x2cdf65=await this[_0x3963ea(0xc6)]['chatFree'](_0x3963ea(0xc8)+_0x2ef70f+_0x3963ea(0xc9));}catch(_0x179e29){_0x2cdf65=_0x1c1943+'\x20绘制成功',common_1[_0x3963ea(0xd4)][_0x3963ea(0xb4)](_0x3963ea(0xd3),_0x179e29);}_0x2b25ad[_0x3963ea(0xea)]=_0x2cdf65,_0x2b25ad['status']=0x3,_0x16784f(_0x2b25ad);return;}catch(_0x461845){_0x2b25ad[_0x3963ea(0xe7)]=0x5,_0x2cc1d8(_0x2b25ad);const _0x32d2b1=((_0x128077=_0x461845===null||_0x461845===void 0x0?void 0x0:_0x461845[_0x3963ea(0xba)])===null||_0x128077===void 0x0?void 0x0:_0x128077[_0x3963ea(0xe7)])||0x1f4;console[_0x3963ea(0xe9)](_0x3963ea(0xed),JSON[_0x3963ea(0xc1)](_0x461845),_0x32d2b1);const _0x12810b=(_0x3f33fa=(_0x2587d1=(_0x80c359=_0x461845===null||_0x461845===void 0x0?void 0x0:_0x461845[_0x3963ea(0xba)])===null||_0x80c359===void 0x0?void 0x0:_0x80c359[_0x3963ea(0xc3)])===null||_0x2587d1===void 0x0?void 0x0:_0x2587d1[_0x3963ea(0xb4)])===null||_0x3f33fa===void 0x0?void 0x0:_0x3f33fa[_0x3963ea(0xe2)];if(_0x32d2b1===0x1ad)return _0x2b25ad['text']=_0x3963ea(0xfc),_0x2b25ad;if(_0x32d2b1===0x190&&_0x12810b[_0x3963ea(0xfb)](_0x3963ea(0xc2)))return _0x2b25ad[_0x3963ea(0xb8)]='您的请求已被系统拒绝。您的提示可能存在一些非法的文本。',_0x2b25ad;if(_0x32d2b1===0x190&&_0x12810b['includes']('Billing\x20hard\x20limit\x20has\x20been\x20reached'))return _0x2b25ad[_0x3963ea(0xb8)]=_0x3963ea(0xd2),_0x2b25ad;if(_0x32d2b1===0x1f4)return _0x2b25ad['text']=_0x3963ea(0xb6),_0x2b25ad;if(_0x32d2b1===0x191)return _0x2b25ad[_0x3963ea(0xb8)]=_0x3963ea(0xef),_0x2b25ad;return _0x2b25ad['text']=_0x3963ea(0xff),_0x2b25ad;}}};FluxDrawService=FluxDrawService_1=__decorate([(0x0,common_1[_0x351bbb(0xe4)])(),__metadata('design:paramtypes',[upload_service_1['UploadService'],globalConfig_service_1['GlobalConfigService'],chatLog_service_1['ChatLogService'],openaiChat_service_1[_0x351bbb(0xeb)]])],FluxDrawService),exports[_0x351bbb(0xbe)]=FluxDrawService;