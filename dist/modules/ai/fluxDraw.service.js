'use strict';const _0x48cde9=_0x15ac;function _0x5b69(){const _0x44c56e=['defineProperty','answer','globalConfigService','fluxDraw','9081PfEMMi','__metadata','../globalConfig/globalConfig.service','你是一个绘画提示词生成工具，请根据用户的要求，结合上下文，用一段文字，描述用户需要的绘画需求，不用包含任何礼貌性的寒暄,只需要场景的描述,可以适当联想','1021884IfNHxw','error',',\x20headers:\x20','uploadFileFromUrl','length','log','function','ChatLogService','开始提交\x20Flux\x20绘图任务\x20','，payload:\x20','getDate','1197133ZPvbAx','1024x1024','请求状态','getMonth','object','图片上传成功，URL:\x20','getFullYear','绘制图片失败，此次绘画被拒绝了！','url','上传图片过程中出现错误:\x20','./openaiChat.service','调用chatFree失败：','},\x20模拟AI绘画机器人的语气，用中文回复，告诉用户已经画好了','当前请求已过载、请稍等会儿再试试吧！','1AkAPbB','DrawService','response','Logger','POST','decorate','绘制图片失败，请检查你的提示词是否有非法描述！','images/dalle/','application/json','text','getConfigs','debug','FluxDraw','Billing\x20hard\x20limit\x20has\x20been\x20reached','1255100gbclwG','5992pAZAsX','4286232AwNetq','data','翻译失败:\x20','../chatLog/chatLog.service','__decorate','Bearer\x20','isDalleChat','chatLogService','default','GlobalConfigService','\x20绘制成功','padStart','message','../upload/upload.service','UploadService','3325269ehXGcC','design:paramtypes','4333696OOqrGa','__esModule','This\x20request\x20has\x20been\x20blocked\x20by\x20our\x20content\x20filters','FluxDrawService','chatFree','includes','draw\x20error:\x20','当前模型key已被封禁、已冻结当前调用Key、尝试重新对话试试吧！','status','fileInfo','stringify','uploadService','metadata','openAIChatService','参考上文，结合我的需求，给出绘画描述。我的需求是：'];_0x5b69=function(){return _0x44c56e;};return _0x5b69();}(function(_0x5a8df7,_0x36bf72){const _0x3a32b3=_0x15ac,_0x51651f=_0x5a8df7();while(!![]){try{const _0x4aa087=parseInt(_0x3a32b3(0x21b))/0x1*(parseInt(_0x3a32b3(0x202))/0x2)+-parseInt(_0x3a32b3(0x1e9))/0x3+parseInt(_0x3a32b3(0x1eb))/0x4+parseInt(_0x3a32b3(0x229))/0x5+-parseInt(_0x3a32b3(0x22b))/0x6+-parseInt(_0x3a32b3(0x20d))/0x7+parseInt(_0x3a32b3(0x22a))/0x8*(parseInt(_0x3a32b3(0x1fe))/0x9);if(_0x4aa087===_0x36bf72)break;else _0x51651f['push'](_0x51651f['shift']());}catch(_0x3ab723){_0x51651f['push'](_0x51651f['shift']());}}}(_0x5b69,0x94451));var __decorate=this&&this[_0x48cde9(0x22f)]||function(_0x1c94bb,_0x2cd00a,_0x3821d6,_0x10c214){const _0x5073c7=_0x48cde9;var _0x431a23=arguments[_0x5073c7(0x206)],_0x32d356=_0x431a23<0x3?_0x2cd00a:_0x10c214===null?_0x10c214=Object['getOwnPropertyDescriptor'](_0x2cd00a,_0x3821d6):_0x10c214,_0x117ade;if(typeof Reflect===_0x5073c7(0x211)&&typeof Reflect[_0x5073c7(0x220)]===_0x5073c7(0x208))_0x32d356=Reflect['decorate'](_0x1c94bb,_0x2cd00a,_0x3821d6,_0x10c214);else{for(var _0x2ad2f6=_0x1c94bb[_0x5073c7(0x206)]-0x1;_0x2ad2f6>=0x0;_0x2ad2f6--)if(_0x117ade=_0x1c94bb[_0x2ad2f6])_0x32d356=(_0x431a23<0x3?_0x117ade(_0x32d356):_0x431a23>0x3?_0x117ade(_0x2cd00a,_0x3821d6,_0x32d356):_0x117ade(_0x2cd00a,_0x3821d6))||_0x32d356;}return _0x431a23>0x3&&_0x32d356&&Object['defineProperty'](_0x2cd00a,_0x3821d6,_0x32d356),_0x32d356;},__metadata=this&&this[_0x48cde9(0x1ff)]||function(_0x318869,_0x4c20d4){const _0x1ad4d2=_0x48cde9;if(typeof Reflect===_0x1ad4d2(0x211)&&typeof Reflect[_0x1ad4d2(0x1f7)]===_0x1ad4d2(0x208))return Reflect[_0x1ad4d2(0x1f7)](_0x318869,_0x4c20d4);},FluxDrawService_1;Object[_0x48cde9(0x1fa)](exports,_0x48cde9(0x1ec),{'value':!![]}),exports[_0x48cde9(0x1ee)]=void 0x0;const common_1=require('@nestjs/common'),axios_1=require('axios'),chatLog_service_1=require(_0x48cde9(0x22e)),globalConfig_service_1=require(_0x48cde9(0x200)),upload_service_1=require(_0x48cde9(0x1e7)),openaiChat_service_1=require(_0x48cde9(0x217));function _0x15ac(_0x2e4280,_0x50d485){const _0x5b69e6=_0x5b69();return _0x15ac=function(_0x15ac78,_0x3906c2){_0x15ac78=_0x15ac78-0x1e3;let _0x3c9187=_0x5b69e6[_0x15ac78];return _0x3c9187;},_0x15ac(_0x2e4280,_0x50d485);}let FluxDrawService=FluxDrawService_1=class FluxDrawService{constructor(_0x24bf7e,_0x1f7ff2,_0x5e3bf5,_0xdd2086){const _0x1b54c8=_0x48cde9;this['uploadService']=_0x24bf7e,this[_0x1b54c8(0x1fc)]=_0x1f7ff2,this['chatLogService']=_0x5e3bf5,this[_0x1b54c8(0x1f8)]=_0xdd2086,this['logger']=new common_1[(_0x1b54c8(0x21e))](FluxDrawService_1['name']);}async[_0x48cde9(0x1fd)](_0x2b3bb4,_0x115799){const _0x32466e=_0x48cde9;var _0x572ff2,_0x84b8ab,_0x49a2a7,_0x101734;common_1[_0x32466e(0x21e)][_0x32466e(0x207)](_0x32466e(0x20a),_0x32466e(0x21c));const {apiKey:_0xa4a4b0,model:_0x2512ed,proxyUrl:_0x2e0a5e,prompt:_0x3df82f,extraParam:_0x55d7de,timeout:_0x25939a,onSuccess:_0x2b8fa9,onFailure:_0xcf36c9,groupId:_0x52f25d}=_0x2b3bb4,_0x4bb723=await this[_0x32466e(0x1fc)][_0x32466e(0x225)]([_0x32466e(0x231)]);let _0x1a1dfc;if(_0x4bb723==='1')try{common_1[_0x32466e(0x21e)]['log']('已开启连续绘画模式',_0x32466e(0x227));const {messagesHistory:_0x1d0650}=await _0x115799(_0x32466e(0x1f9)+_0x3df82f,{'groupId':_0x52f25d,'systemMessage':_0x32466e(0x201),'maxModelTokens':0x1f40,'maxRounds':0x5,'fileInfo':''},this[_0x32466e(0x232)]);_0x1a1dfc=await this[_0x32466e(0x1f8)][_0x32466e(0x1ef)](_0x3df82f,undefined,_0x1d0650);}catch(_0x2fb400){console[_0x32466e(0x203)](_0x32466e(0x218),_0x2fb400),_0x1a1dfc=_0x3df82f;}else _0x1a1dfc=_0x3df82f;const _0x2b8fa6=(_0x55d7de===null||_0x55d7de===void 0x0?void 0x0:_0x55d7de['size'])||_0x32466e(0x20e);let _0x36642d={'answer':'','fileInfo':'','status':0x2};try{const _0x3e5e9b={'method':_0x32466e(0x21f),'url':_0x2e0a5e+'/v1/images/generations','timeout':_0x25939a,'headers':{'Content-Type':_0x32466e(0x223),'Authorization':_0x32466e(0x230)+_0xa4a4b0},'data':{'model':_0x2512ed,'prompt':_0x1a1dfc,'size':_0x2b8fa6}};common_1['Logger'][_0x32466e(0x207)]('正在准备发送请求到\x20'+_0x3e5e9b['url']+_0x32466e(0x20b)+JSON[_0x32466e(0x1f5)](_0x3e5e9b['data'])+_0x32466e(0x204)+JSON[_0x32466e(0x1f5)](_0x3e5e9b['headers']),'FluxDrawService');const _0x463976=await(0x0,axios_1[_0x32466e(0x233)])(_0x3e5e9b);common_1[_0x32466e(0x21e)][_0x32466e(0x226)]('请求成功'+JSON[_0x32466e(0x1f5)](_0x463976[_0x32466e(0x22c)][_0x32466e(0x22c)][0x0])),common_1[_0x32466e(0x21e)][_0x32466e(0x226)](_0x32466e(0x20f)+JSON['stringify'](_0x463976[_0x32466e(0x1f3)]));const _0x522a91=_0x463976['data'][_0x32466e(0x22c)][0x0][_0x32466e(0x215)];try{common_1[_0x32466e(0x21e)][_0x32466e(0x207)]('------>\x20开始上传图片！！！',_0x32466e(0x21c));const _0xf10017=new Date(),_0x4d24c2=_0xf10017[_0x32466e(0x213)](),_0x320e8f=String(_0xf10017[_0x32466e(0x210)]()+0x1)['padStart'](0x2,'0'),_0x45964=String(_0xf10017[_0x32466e(0x20c)]())[_0x32466e(0x1e5)](0x2,'0'),_0x4c2dd7=''+_0x4d24c2+_0x320e8f+'/'+_0x45964;_0x36642d['fileInfo']=await this[_0x32466e(0x1f6)][_0x32466e(0x205)]({'url':_0x522a91,'dir':_0x32466e(0x222)+_0x4c2dd7}),common_1[_0x32466e(0x21e)][_0x32466e(0x207)](_0x32466e(0x212)+_0x36642d[_0x32466e(0x1f4)],_0x32466e(0x21c));}catch(_0x2e4271){common_1[_0x32466e(0x21e)][_0x32466e(0x203)](_0x32466e(0x216)+_0x2e4271,_0x32466e(0x21c));}let _0xe6355;try{_0xe6355=await this[_0x32466e(0x1f8)][_0x32466e(0x1ef)]('根据提示词{'+_0x1a1dfc+_0x32466e(0x219));}catch(_0x3c9154){_0xe6355=_0x3df82f+_0x32466e(0x1e4),common_1[_0x32466e(0x21e)][_0x32466e(0x203)](_0x32466e(0x22d),_0x3c9154);}_0x36642d[_0x32466e(0x1fb)]=_0xe6355,_0x36642d[_0x32466e(0x1f3)]=0x3,_0x2b8fa9(_0x36642d);return;}catch(_0x5ad316){_0x36642d[_0x32466e(0x1f3)]=0x5,_0xcf36c9(_0x36642d);const _0x3a065c=((_0x572ff2=_0x5ad316===null||_0x5ad316===void 0x0?void 0x0:_0x5ad316[_0x32466e(0x21d)])===null||_0x572ff2===void 0x0?void 0x0:_0x572ff2[_0x32466e(0x1f3)])||0x1f4;console[_0x32466e(0x207)](_0x32466e(0x1f1),JSON[_0x32466e(0x1f5)](_0x5ad316),_0x3a065c);const _0x18dd94=(_0x101734=(_0x49a2a7=(_0x84b8ab=_0x5ad316===null||_0x5ad316===void 0x0?void 0x0:_0x5ad316[_0x32466e(0x21d)])===null||_0x84b8ab===void 0x0?void 0x0:_0x84b8ab[_0x32466e(0x22c)])===null||_0x49a2a7===void 0x0?void 0x0:_0x49a2a7['error'])===null||_0x101734===void 0x0?void 0x0:_0x101734[_0x32466e(0x1e6)];if(_0x3a065c===0x1ad)return _0x36642d[_0x32466e(0x224)]=_0x32466e(0x21a),_0x36642d;if(_0x3a065c===0x190&&_0x18dd94[_0x32466e(0x1f0)](_0x32466e(0x1ed)))return _0x36642d[_0x32466e(0x224)]='您的请求已被系统拒绝。您的提示可能存在一些非法的文本。',_0x36642d;if(_0x3a065c===0x190&&_0x18dd94[_0x32466e(0x1f0)](_0x32466e(0x228)))return _0x36642d[_0x32466e(0x224)]=_0x32466e(0x1f2),_0x36642d;if(_0x3a065c===0x1f4)return _0x36642d[_0x32466e(0x224)]=_0x32466e(0x221),_0x36642d;if(_0x3a065c===0x191)return _0x36642d[_0x32466e(0x224)]=_0x32466e(0x214),_0x36642d;return _0x36642d[_0x32466e(0x224)]='绘制图片失败，请稍后试试吧！',_0x36642d;}}};FluxDrawService=FluxDrawService_1=__decorate([(0x0,common_1['Injectable'])(),__metadata(_0x48cde9(0x1ea),[upload_service_1[_0x48cde9(0x1e8)],globalConfig_service_1[_0x48cde9(0x1e3)],chatLog_service_1[_0x48cde9(0x209)],openaiChat_service_1['OpenAIChatService']])],FluxDrawService),exports['FluxDrawService']=FluxDrawService;