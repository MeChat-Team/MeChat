'use strict';const _0x1f2564=_0x2e5a;function _0xd635(){const _0x2cd80f=[',\x20headers:\x20','debug','isDalleChat','getFullYear','getDate','chatLogService','已开启连续绘画模式','951202tLYwEB','name','，payload:\x20','fileInfo','464owqwku','POST','18560jAHlQy','data','FluxDraw','当前请求已过载、请稍等会儿再试试吧！','984NBnBPe','response','axios','function','images/dalle/','请求状态','Bearer\x20','log','openAIChatService','164840AyCNWc','Injectable','size','answer','ChatLogService','defineProperty','220617Qkjqwr','UploadService','logger','绘制图片失败，此次绘画被拒绝了！','FluxDrawService','../globalConfig/globalConfig.service','绘制图片失败，请稍后试试吧！','stringify','status','Billing\x20hard\x20limit\x20has\x20been\x20reached','DrawService','__esModule','decorate','../upload/upload.service','metadata','url','3bOLrSY','__decorate','globalConfigService','@nestjs/common','Logger','chatFree','error','includes','------>\x20开始上传图片！！！','OpenAIChatService','绘制图片失败，请检查你的提示词是否有非法描述！','调用chatFree失败：','正在准备发送请求到\x20','54eVOeql','翻译失败:\x20','4404VSmueT','您的请求已被系统拒绝。您的提示可能存在一些非法的文本。','上传图片过程中出现错误:\x20','default','开始提交\x20Flux\x20绘图任务\x20','3677268ktiuuv','__metadata','getOwnPropertyDescriptor','text','uploadService','../chatLog/chatLog.service','1024x1024','21044316pyBjTu','根据提示词{','1276wvEgge','object'];_0xd635=function(){return _0x2cd80f;};return _0xd635();}function _0x2e5a(_0x532e8f,_0x3c4792){const _0xd6352a=_0xd635();return _0x2e5a=function(_0x2e5a9c,_0x50f914){_0x2e5a9c=_0x2e5a9c-0x1a5;let _0x11fc93=_0xd6352a[_0x2e5a9c];return _0x11fc93;},_0x2e5a(_0x532e8f,_0x3c4792);}(function(_0x10fe11,_0xaaae53){const _0x548924=_0x2e5a,_0x464022=_0x10fe11();while(!![]){try{const _0x4c5228=-parseInt(_0x548924(0x1c2))/0x1*(parseInt(_0x548924(0x1e8))/0x2)+parseInt(_0x548924(0x1d1))/0x3*(-parseInt(_0x548924(0x1f2))/0x4)+parseInt(_0x548924(0x1ac))/0x5*(-parseInt(_0x548924(0x1cf))/0x6)+-parseInt(_0x548924(0x1d6))/0x7+parseInt(_0x548924(0x1ec))/0x8*(parseInt(_0x548924(0x1b2))/0x9)+-parseInt(_0x548924(0x1ee))/0xa*(-parseInt(_0x548924(0x1df))/0xb)+parseInt(_0x548924(0x1dd))/0xc;if(_0x4c5228===_0xaaae53)break;else _0x464022['push'](_0x464022['shift']());}catch(_0x5d11f1){_0x464022['push'](_0x464022['shift']());}}}(_0xd635,0xbe9e8));var __decorate=this&&this[_0x1f2564(0x1c3)]||function(_0x1b2eac,_0x269369,_0x5e7e85,_0x35dc60){const _0x5df436=_0x1f2564;var _0x34ace8=arguments['length'],_0x1a1705=_0x34ace8<0x3?_0x269369:_0x35dc60===null?_0x35dc60=Object[_0x5df436(0x1d8)](_0x269369,_0x5e7e85):_0x35dc60,_0x4b76ec;if(typeof Reflect===_0x5df436(0x1e0)&&typeof Reflect[_0x5df436(0x1be)]==='function')_0x1a1705=Reflect['decorate'](_0x1b2eac,_0x269369,_0x5e7e85,_0x35dc60);else{for(var _0x514b8f=_0x1b2eac['length']-0x1;_0x514b8f>=0x0;_0x514b8f--)if(_0x4b76ec=_0x1b2eac[_0x514b8f])_0x1a1705=(_0x34ace8<0x3?_0x4b76ec(_0x1a1705):_0x34ace8>0x3?_0x4b76ec(_0x269369,_0x5e7e85,_0x1a1705):_0x4b76ec(_0x269369,_0x5e7e85))||_0x1a1705;}return _0x34ace8>0x3&&_0x1a1705&&Object[_0x5df436(0x1b1)](_0x269369,_0x5e7e85,_0x1a1705),_0x1a1705;},__metadata=this&&this[_0x1f2564(0x1d7)]||function(_0x47d6c5,_0x505838){const _0x55acda=_0x1f2564;if(typeof Reflect===_0x55acda(0x1e0)&&typeof Reflect[_0x55acda(0x1c0)]===_0x55acda(0x1a6))return Reflect[_0x55acda(0x1c0)](_0x47d6c5,_0x505838);},FluxDrawService_1;Object[_0x1f2564(0x1b1)](exports,_0x1f2564(0x1bd),{'value':!![]}),exports[_0x1f2564(0x1b6)]=void 0x0;const common_1=require(_0x1f2564(0x1c5)),axios_1=require(_0x1f2564(0x1a5)),chatLog_service_1=require(_0x1f2564(0x1db)),globalConfig_service_1=require(_0x1f2564(0x1b7)),upload_service_1=require(_0x1f2564(0x1bf)),openaiChat_service_1=require('./openaiChat.service');let FluxDrawService=FluxDrawService_1=class FluxDrawService{constructor(_0x580264,_0x2ca449,_0x5aefa1,_0x2721b7){const _0x641ada=_0x1f2564;this[_0x641ada(0x1da)]=_0x580264,this[_0x641ada(0x1c4)]=_0x2ca449,this[_0x641ada(0x1e6)]=_0x5aefa1,this['openAIChatService']=_0x2721b7,this[_0x641ada(0x1b4)]=new common_1[(_0x641ada(0x1c6))](FluxDrawService_1[_0x641ada(0x1e9)]);}async['fluxDraw'](_0x2ccf1d,_0x95fd99){const _0x180dbb=_0x1f2564;var _0x5389d6,_0xbe1d9a,_0x3bf272,_0x6d3a32;common_1[_0x180dbb(0x1c6)][_0x180dbb(0x1aa)](_0x180dbb(0x1d5),_0x180dbb(0x1bc));const {apiKey:_0xe8834d,model:_0x4674ff,proxyUrl:_0x38f0ed,prompt:_0x204a6b,extraParam:_0x236a04,timeout:_0x55431c,onSuccess:_0x45ffdb,onFailure:_0x1daf7f,groupId:_0x7b3842}=_0x2ccf1d,_0x308e8e=await this[_0x180dbb(0x1c4)]['getConfigs']([_0x180dbb(0x1e3)]);let _0x21b50e;if(_0x308e8e==='1')try{common_1[_0x180dbb(0x1c6)][_0x180dbb(0x1aa)](_0x180dbb(0x1e7),_0x180dbb(0x1f0));const {messagesHistory:_0x358e5b}=await _0x95fd99('参考上文，结合我的需求，给出绘画描述。我的需求是：'+_0x204a6b,{'groupId':_0x7b3842,'systemMessage':'你是一个绘画提示词生成工具，请根据用户的要求，结合上下文，用一段文字，描述用户需要的绘画需求，不用包含任何礼貌性的寒暄,只需要场景的描述,可以适当联想','maxModelTokens':0x1f40,'maxRounds':0x5,'fileInfo':''},this['chatLogService']);_0x21b50e=await this[_0x180dbb(0x1ab)][_0x180dbb(0x1c7)](_0x204a6b,undefined,_0x358e5b);}catch(_0x588e73){console[_0x180dbb(0x1c8)](_0x180dbb(0x1cd),_0x588e73),_0x21b50e=_0x204a6b;}else _0x21b50e=_0x204a6b;const _0x52850=(_0x236a04===null||_0x236a04===void 0x0?void 0x0:_0x236a04[_0x180dbb(0x1ae)])||_0x180dbb(0x1dc);let _0x5105dc={'answer':'','fileInfo':'','status':0x2};try{const _0x3e90a0={'method':_0x180dbb(0x1ed),'url':_0x38f0ed+'/v1/images/generations','timeout':_0x55431c,'headers':{'Content-Type':'application/json','Authorization':_0x180dbb(0x1a9)+_0xe8834d},'data':{'model':_0x4674ff,'prompt':_0x21b50e,'size':_0x52850}};common_1['Logger']['log'](_0x180dbb(0x1ce)+_0x3e90a0[_0x180dbb(0x1c1)]+_0x180dbb(0x1ea)+JSON[_0x180dbb(0x1b9)](_0x3e90a0[_0x180dbb(0x1ef)])+_0x180dbb(0x1e1)+JSON['stringify'](_0x3e90a0['headers']),_0x180dbb(0x1b6));const _0x489b52=await(0x0,axios_1[_0x180dbb(0x1d4)])(_0x3e90a0);common_1[_0x180dbb(0x1c6)][_0x180dbb(0x1e2)]('请求成功'+JSON[_0x180dbb(0x1b9)](_0x489b52['data'][_0x180dbb(0x1ef)][0x0])),common_1[_0x180dbb(0x1c6)]['debug'](_0x180dbb(0x1a8)+JSON[_0x180dbb(0x1b9)](_0x489b52[_0x180dbb(0x1ba)]));const _0x489254=_0x489b52['data'][_0x180dbb(0x1ef)][0x0][_0x180dbb(0x1c1)];try{common_1[_0x180dbb(0x1c6)][_0x180dbb(0x1aa)](_0x180dbb(0x1ca),_0x180dbb(0x1bc));const _0x3fcef8=new Date(),_0x11e526=_0x3fcef8[_0x180dbb(0x1e4)](),_0x168106=String(_0x3fcef8['getMonth']()+0x1)['padStart'](0x2,'0'),_0x542546=String(_0x3fcef8[_0x180dbb(0x1e5)]())['padStart'](0x2,'0'),_0x6b1258=''+_0x11e526+_0x168106+'/'+_0x542546;_0x5105dc[_0x180dbb(0x1eb)]=await this['uploadService']['uploadFileFromUrl']({'url':_0x489254,'dir':_0x180dbb(0x1a7)+_0x6b1258}),common_1[_0x180dbb(0x1c6)][_0x180dbb(0x1aa)]('图片上传成功，URL:\x20'+_0x5105dc[_0x180dbb(0x1eb)],_0x180dbb(0x1bc));}catch(_0x4566db){common_1[_0x180dbb(0x1c6)][_0x180dbb(0x1c8)](_0x180dbb(0x1d3)+_0x4566db,'DrawService');}let _0x3d5277;try{_0x3d5277=await this['openAIChatService'][_0x180dbb(0x1c7)](_0x180dbb(0x1de)+_0x21b50e+'},\x20模拟AI绘画机器人的语气，用中文回复，告诉用户已经画好了');}catch(_0x3ef474){_0x3d5277=_0x204a6b+'\x20绘制成功',common_1[_0x180dbb(0x1c6)]['error'](_0x180dbb(0x1d0),_0x3ef474);}_0x5105dc[_0x180dbb(0x1af)]=_0x3d5277,_0x5105dc[_0x180dbb(0x1ba)]=0x3,_0x45ffdb(_0x5105dc);return;}catch(_0x4a980f){_0x5105dc[_0x180dbb(0x1ba)]=0x5,_0x1daf7f(_0x5105dc);const _0x34d055=((_0x5389d6=_0x4a980f===null||_0x4a980f===void 0x0?void 0x0:_0x4a980f[_0x180dbb(0x1f3)])===null||_0x5389d6===void 0x0?void 0x0:_0x5389d6['status'])||0x1f4;console[_0x180dbb(0x1aa)]('draw\x20error:\x20',JSON['stringify'](_0x4a980f),_0x34d055);const _0xc9a5a9=(_0x6d3a32=(_0x3bf272=(_0xbe1d9a=_0x4a980f===null||_0x4a980f===void 0x0?void 0x0:_0x4a980f[_0x180dbb(0x1f3)])===null||_0xbe1d9a===void 0x0?void 0x0:_0xbe1d9a[_0x180dbb(0x1ef)])===null||_0x3bf272===void 0x0?void 0x0:_0x3bf272[_0x180dbb(0x1c8)])===null||_0x6d3a32===void 0x0?void 0x0:_0x6d3a32['message'];if(_0x34d055===0x1ad)return _0x5105dc['text']=_0x180dbb(0x1f1),_0x5105dc;if(_0x34d055===0x190&&_0xc9a5a9[_0x180dbb(0x1c9)]('This\x20request\x20has\x20been\x20blocked\x20by\x20our\x20content\x20filters'))return _0x5105dc['text']=_0x180dbb(0x1d2),_0x5105dc;if(_0x34d055===0x190&&_0xc9a5a9[_0x180dbb(0x1c9)](_0x180dbb(0x1bb)))return _0x5105dc['text']='当前模型key已被封禁、已冻结当前调用Key、尝试重新对话试试吧！',_0x5105dc;if(_0x34d055===0x1f4)return _0x5105dc[_0x180dbb(0x1d9)]=_0x180dbb(0x1cc),_0x5105dc;if(_0x34d055===0x191)return _0x5105dc[_0x180dbb(0x1d9)]=_0x180dbb(0x1b5),_0x5105dc;return _0x5105dc[_0x180dbb(0x1d9)]=_0x180dbb(0x1b8),_0x5105dc;}}};FluxDrawService=FluxDrawService_1=__decorate([(0x0,common_1[_0x1f2564(0x1ad)])(),__metadata('design:paramtypes',[upload_service_1[_0x1f2564(0x1b3)],globalConfig_service_1['GlobalConfigService'],chatLog_service_1[_0x1f2564(0x1b0)],openaiChat_service_1[_0x1f2564(0x1cb)]])],FluxDrawService),exports['FluxDrawService']=FluxDrawService;