'use strict';const _0xcc2ed1=_0x3cbc;(function(_0x5641f7,_0x109777){const _0x356398=_0x3cbc,_0x11126c=_0x5641f7();while(!![]){try{const _0x3e0d4f=parseInt(_0x356398(0x1c6))/0x1*(-parseInt(_0x356398(0x196))/0x2)+parseInt(_0x356398(0x198))/0x3+-parseInt(_0x356398(0x1a5))/0x4+-parseInt(_0x356398(0x1c4))/0x5+parseInt(_0x356398(0x1c2))/0x6*(parseInt(_0x356398(0x1cf))/0x7)+-parseInt(_0x356398(0x1aa))/0x8+parseInt(_0x356398(0x19f))/0x9;if(_0x3e0d4f===_0x109777)break;else _0x11126c['push'](_0x11126c['shift']());}catch(_0x5433ba){_0x11126c['push'](_0x11126c['shift']());}}}(_0x1404,0xf30ed));var __decorate=this&&this[_0xcc2ed1(0x194)]||function(_0x16985f,_0x180ca4,_0x91d9cd,_0x31c38c){const _0x42fa40=_0xcc2ed1;var _0x4ed854=arguments[_0x42fa40(0x1cb)],_0x50da8d=_0x4ed854<0x3?_0x180ca4:_0x31c38c===null?_0x31c38c=Object[_0x42fa40(0x190)](_0x180ca4,_0x91d9cd):_0x31c38c,_0xdb80ad;if(typeof Reflect===_0x42fa40(0x1ab)&&typeof Reflect[_0x42fa40(0x1ba)]===_0x42fa40(0x1a1))_0x50da8d=Reflect[_0x42fa40(0x1ba)](_0x16985f,_0x180ca4,_0x91d9cd,_0x31c38c);else{for(var _0x2862a1=_0x16985f['length']-0x1;_0x2862a1>=0x0;_0x2862a1--)if(_0xdb80ad=_0x16985f[_0x2862a1])_0x50da8d=(_0x4ed854<0x3?_0xdb80ad(_0x50da8d):_0x4ed854>0x3?_0xdb80ad(_0x180ca4,_0x91d9cd,_0x50da8d):_0xdb80ad(_0x180ca4,_0x91d9cd))||_0x50da8d;}return _0x4ed854>0x3&&_0x50da8d&&Object[_0x42fa40(0x1b0)](_0x180ca4,_0x91d9cd,_0x50da8d),_0x50da8d;},__metadata=this&&this['__metadata']||function(_0x1d4af9,_0x41a5fd){const _0x4ca13b=_0xcc2ed1;if(typeof Reflect==='object'&&typeof Reflect[_0x4ca13b(0x195)]===_0x4ca13b(0x1a1))return Reflect[_0x4ca13b(0x195)](_0x1d4af9,_0x41a5fd);},FluxDrawService_1;Object['defineProperty'](exports,_0xcc2ed1(0x199),{'value':!![]}),exports[_0xcc2ed1(0x1c9)]=void 0x0;function _0x3cbc(_0x508255,_0x157e26){const _0x1404b6=_0x1404();return _0x3cbc=function(_0x3cbc4b,_0xf8ef9b){_0x3cbc4b=_0x3cbc4b-0x18b;let _0x118c0c=_0x1404b6[_0x3cbc4b];return _0x118c0c;},_0x3cbc(_0x508255,_0x157e26);}const common_1=require(_0xcc2ed1(0x1d3)),axios_1=require(_0xcc2ed1(0x1ce)),chatLog_service_1=require('../chatLog/chatLog.service'),globalConfig_service_1=require(_0xcc2ed1(0x192)),upload_service_1=require(_0xcc2ed1(0x1d2)),openaiChat_service_1=require(_0xcc2ed1(0x1bd));let FluxDrawService=FluxDrawService_1=class FluxDrawService{constructor(_0x957b0f,_0x4f2cc6,_0x353dc2,_0x1d3a7a){const _0x10ee2d=_0xcc2ed1;this['uploadService']=_0x957b0f,this['globalConfigService']=_0x4f2cc6,this['chatLogService']=_0x353dc2,this[_0x10ee2d(0x1bf)]=_0x1d3a7a,this[_0x10ee2d(0x1ae)]=new common_1[(_0x10ee2d(0x18b))](FluxDrawService_1[_0x10ee2d(0x18c)]);}async[_0xcc2ed1(0x1c5)](_0x341090,_0x1df755){const _0x2d2d6b=_0xcc2ed1;var _0x38032e,_0x17822d,_0x2d6fc0,_0x3a05b3;common_1[_0x2d2d6b(0x18b)][_0x2d2d6b(0x1db)](_0x2d2d6b(0x1a8),'DrawService');const {apiKey:_0x4c796a,model:_0x1810e7,proxyUrl:_0x2b4407,prompt:_0xaa2029,extraParam:_0x96087a,timeout:_0x23637e,onSuccess:_0x11fb5b,onFailure:_0x44968e,groupId:_0x3eea15}=_0x341090,_0x1b3495=await this[_0x2d2d6b(0x1ad)][_0x2d2d6b(0x1be)]([_0x2d2d6b(0x19c)]);let _0x5c402d;if(_0x1b3495==='1')try{common_1[_0x2d2d6b(0x18b)]['log'](_0x2d2d6b(0x1d8),'FluxDraw');const {messagesHistory:_0x2fce56}=await _0x1df755(_0x2d2d6b(0x19e)+_0xaa2029,{'groupId':_0x3eea15,'systemMessage':_0x2d2d6b(0x1d5),'maxModelTokens':0x1f40,'maxRounds':0x5,'fileInfo':''},this['chatLogService']);_0x5c402d=await this[_0x2d2d6b(0x1bf)][_0x2d2d6b(0x19d)](_0xaa2029,undefined,_0x2fce56);}catch(_0x42dc57){console[_0x2d2d6b(0x1af)]('调用chatFree失败：',_0x42dc57),_0x5c402d=_0xaa2029;}else _0x5c402d=_0xaa2029;const _0x307b03=(_0x96087a===null||_0x96087a===void 0x0?void 0x0:_0x96087a[_0x2d2d6b(0x1ca)])||_0x2d2d6b(0x1bb);let _0x34ac7d={'answer':'','fileInfo':'','status':0x2};try{const _0x8b9649={'method':_0x2d2d6b(0x1d4),'url':_0x2b4407+_0x2d2d6b(0x1cd),'timeout':_0x23637e,'headers':{'Content-Type':_0x2d2d6b(0x1cc),'Authorization':'Bearer\x20'+_0x4c796a},'data':{'model':_0x1810e7,'prompt':_0x5c402d,'size':_0x307b03}};common_1[_0x2d2d6b(0x18b)]['log']('正在准备发送请求到\x20'+_0x8b9649[_0x2d2d6b(0x1d9)]+_0x2d2d6b(0x1c7)+JSON['stringify'](_0x8b9649[_0x2d2d6b(0x1e2)])+_0x2d2d6b(0x1dc)+JSON[_0x2d2d6b(0x1b1)](_0x8b9649[_0x2d2d6b(0x1a6)]),_0x2d2d6b(0x1c9));const _0xdae389=await(0x0,axios_1[_0x2d2d6b(0x1bc)])(_0x8b9649);common_1[_0x2d2d6b(0x18b)][_0x2d2d6b(0x1a3)]('请求成功'+JSON[_0x2d2d6b(0x1b1)](_0xdae389[_0x2d2d6b(0x1e2)][_0x2d2d6b(0x1e2)][0x0])),common_1['Logger']['debug'](_0x2d2d6b(0x1b2)+JSON[_0x2d2d6b(0x1b1)](_0xdae389['status']));const _0x41ac17=_0xdae389[_0x2d2d6b(0x1e2)]['data'][0x0][_0x2d2d6b(0x1d9)];try{common_1[_0x2d2d6b(0x18b)][_0x2d2d6b(0x1db)](_0x2d2d6b(0x191),'DrawService');const _0x547797=new Date(),_0x2ae0e8=_0x547797[_0x2d2d6b(0x1c3)](),_0x55ee3e=String(_0x547797[_0x2d2d6b(0x18e)]()+0x1)[_0x2d2d6b(0x1b6)](0x2,'0'),_0x8c2152=String(_0x547797[_0x2d2d6b(0x1d1)]())[_0x2d2d6b(0x1b6)](0x2,'0'),_0x59df23=''+_0x2ae0e8+_0x55ee3e+'/'+_0x8c2152;_0x34ac7d['fileInfo']=await this[_0x2d2d6b(0x1a4)][_0x2d2d6b(0x1d6)]({'url':_0x41ac17,'dir':_0x2d2d6b(0x193)+_0x59df23}),common_1['Logger'][_0x2d2d6b(0x1db)](_0x2d2d6b(0x1c0)+_0x34ac7d[_0x2d2d6b(0x1a2)],_0x2d2d6b(0x1b9));}catch(_0x174833){common_1[_0x2d2d6b(0x18b)][_0x2d2d6b(0x1af)]('上传图片过程中出现错误:\x20'+_0x174833,_0x2d2d6b(0x1b9));}let _0x39753c;try{_0x39753c=await this[_0x2d2d6b(0x1bf)][_0x2d2d6b(0x19d)](_0x2d2d6b(0x1e1)+_0x5c402d+_0x2d2d6b(0x1a7));}catch(_0x34406b){_0x39753c=_0xaa2029+_0x2d2d6b(0x1c1),common_1[_0x2d2d6b(0x18b)][_0x2d2d6b(0x1af)](_0x2d2d6b(0x1a0),_0x34406b);}_0x34ac7d[_0x2d2d6b(0x1d7)]=_0x39753c,_0x34ac7d[_0x2d2d6b(0x19a)]=0x3,_0x11fb5b(_0x34ac7d);return;}catch(_0x255bf7){_0x34ac7d[_0x2d2d6b(0x19a)]=0x5,_0x44968e(_0x34ac7d);const _0x122f06=((_0x38032e=_0x255bf7===null||_0x255bf7===void 0x0?void 0x0:_0x255bf7[_0x2d2d6b(0x1da)])===null||_0x38032e===void 0x0?void 0x0:_0x38032e['status'])||0x1f4;console[_0x2d2d6b(0x1db)](_0x2d2d6b(0x18f),JSON[_0x2d2d6b(0x1b1)](_0x255bf7),_0x122f06);const _0x177477=(_0x3a05b3=(_0x2d6fc0=(_0x17822d=_0x255bf7===null||_0x255bf7===void 0x0?void 0x0:_0x255bf7[_0x2d2d6b(0x1da)])===null||_0x17822d===void 0x0?void 0x0:_0x17822d['data'])===null||_0x2d6fc0===void 0x0?void 0x0:_0x2d6fc0['error'])===null||_0x3a05b3===void 0x0?void 0x0:_0x3a05b3[_0x2d2d6b(0x1b3)];if(_0x122f06===0x1ad)return _0x34ac7d[_0x2d2d6b(0x1c8)]=_0x2d2d6b(0x1b7),_0x34ac7d;if(_0x122f06===0x190&&_0x177477['includes'](_0x2d2d6b(0x1ac)))return _0x34ac7d['text']=_0x2d2d6b(0x1a9),_0x34ac7d;if(_0x122f06===0x190&&_0x177477[_0x2d2d6b(0x1b5)](_0x2d2d6b(0x1df)))return _0x34ac7d['text']=_0x2d2d6b(0x1b4),_0x34ac7d;if(_0x122f06===0x1f4)return _0x34ac7d[_0x2d2d6b(0x1c8)]=_0x2d2d6b(0x197),_0x34ac7d;if(_0x122f06===0x191)return _0x34ac7d[_0x2d2d6b(0x1c8)]=_0x2d2d6b(0x1dd),_0x34ac7d;return _0x34ac7d['text']=_0x2d2d6b(0x1de),_0x34ac7d;}}};FluxDrawService=FluxDrawService_1=__decorate([(0x0,common_1[_0xcc2ed1(0x1b8)])(),__metadata('design:paramtypes',[upload_service_1[_0xcc2ed1(0x18d)],globalConfig_service_1[_0xcc2ed1(0x19b)],chatLog_service_1[_0xcc2ed1(0x1e0)],openaiChat_service_1[_0xcc2ed1(0x1d0)]])],FluxDrawService),exports[_0xcc2ed1(0x1c9)]=FluxDrawService;function _0x1404(){const _0x1d6e6d=['Injectable','DrawService','decorate','1024x1024','default','./openaiChat.service','getConfigs','openAIChatService','图片上传成功，URL:\x20','\x20绘制成功','2739522QYvyHM','getFullYear','4025660aovVqj','fluxDraw','177533aNIUgn','，payload:\x20','text','FluxDrawService','size','length','application/json','/v1/images/generations','axios','7GZNTLp','OpenAIChatService','getDate','../upload/upload.service','@nestjs/common','POST','你是一个绘画提示词生成工具，请根据用户的要求，结合上下文，用一段文字，描述用户需要的绘画需求，不用包含任何礼貌性的寒暄,只需要场景的描述,可以适当联想','uploadFileFromUrl','answer','已开启连续绘画模式','url','response','log',',\x20headers:\x20','绘制图片失败，此次绘画被拒绝了！','绘制图片失败，请稍后试试吧！','Billing\x20hard\x20limit\x20has\x20been\x20reached','ChatLogService','根据提示词{','data','Logger','name','UploadService','getMonth','draw\x20error:\x20','getOwnPropertyDescriptor','------>\x20开始上传图片！！！','../globalConfig/globalConfig.service','images/dalle/','__decorate','metadata','2yLTEYy','绘制图片失败，请检查你的提示词是否有非法描述！','1860219CIcZRK','__esModule','status','GlobalConfigService','isDalleChat','chatFree','参考上文，结合我的需求，给出绘画描述。我的需求是：','35388657WVqEPX','翻译失败:\x20','function','fileInfo','debug','uploadService','4833284YFFbow','headers','},\x20模拟AI绘画机器人的语气，用中文回复，告诉用户已经画好了','开始提交\x20Flux\x20绘图任务\x20','您的请求已被系统拒绝。您的提示可能存在一些非法的文本。','14577456lTtlrp','object','This\x20request\x20has\x20been\x20blocked\x20by\x20our\x20content\x20filters','globalConfigService','logger','error','defineProperty','stringify','请求状态','message','当前模型key已被封禁、已冻结当前调用Key、尝试重新对话试试吧！','includes','padStart','当前请求已过载、请稍等会儿再试试吧！'];_0x1404=function(){return _0x1d6e6d;};return _0x1404();}