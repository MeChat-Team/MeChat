'use strict';const _0x3fbaf1=_0x3ada;(function(_0x481423,_0xcf59a8){const _0x292661=_0x3ada,_0x1f4ece=_0x481423();while(!![]){try{const _0x314bcc=-parseInt(_0x292661(0x149))/0x1+parseInt(_0x292661(0x116))/0x2+-parseInt(_0x292661(0x118))/0x3+-parseInt(_0x292661(0x143))/0x4*(-parseInt(_0x292661(0x117))/0x5)+-parseInt(_0x292661(0x14f))/0x6*(-parseInt(_0x292661(0x138))/0x7)+-parseInt(_0x292661(0x155))/0x8+-parseInt(_0x292661(0x132))/0x9;if(_0x314bcc===_0xcf59a8)break;else _0x1f4ece['push'](_0x1f4ece['shift']());}catch(_0x1774ad){_0x1f4ece['push'](_0x1f4ece['shift']());}}}(_0x5b4b,0x6a1c6));function _0x3ada(_0x1c11db,_0x583b04){const _0x5b4b19=_0x5b4b();return _0x3ada=function(_0x3ada48,_0x3bafbd){_0x3ada48=_0x3ada48-0x111;let _0x1213f9=_0x5b4b19[_0x3ada48];return _0x1213f9;},_0x3ada(_0x1c11db,_0x583b04);}var __decorate=this&&this[_0x3fbaf1(0x15a)]||function(_0x1ca671,_0x17c0a1,_0x1a4330,_0x530509){const _0x212386=_0x3fbaf1;var _0x60b760=arguments['length'],_0x5bf952=_0x60b760<0x3?_0x17c0a1:_0x530509===null?_0x530509=Object[_0x212386(0x124)](_0x17c0a1,_0x1a4330):_0x530509,_0x17d7cf;if(typeof Reflect===_0x212386(0x14b)&&typeof Reflect[_0x212386(0x127)]===_0x212386(0x141))_0x5bf952=Reflect[_0x212386(0x127)](_0x1ca671,_0x17c0a1,_0x1a4330,_0x530509);else{for(var _0x4367cd=_0x1ca671[_0x212386(0x12b)]-0x1;_0x4367cd>=0x0;_0x4367cd--)if(_0x17d7cf=_0x1ca671[_0x4367cd])_0x5bf952=(_0x60b760<0x3?_0x17d7cf(_0x5bf952):_0x60b760>0x3?_0x17d7cf(_0x17c0a1,_0x1a4330,_0x5bf952):_0x17d7cf(_0x17c0a1,_0x1a4330))||_0x5bf952;}return _0x60b760>0x3&&_0x5bf952&&Object[_0x212386(0x111)](_0x17c0a1,_0x1a4330,_0x5bf952),_0x5bf952;},__metadata=this&&this[_0x3fbaf1(0x11e)]||function(_0x13d66b,_0x49455f){const _0x15e20d=_0x3fbaf1;if(typeof Reflect===_0x15e20d(0x14b)&&typeof Reflect[_0x15e20d(0x137)]==='function')return Reflect['metadata'](_0x13d66b,_0x49455f);},FluxDrawService_1;function _0x5b4b(){const _0x1994d8=['开始提交\x20Flux\x20绘图任务\x20','log','根据提示词{','getOwnPropertyDescriptor','GlobalConfigService','},\x20模拟AI绘画机器人的语气，用中文回复，告诉用户已经画好了','decorate','UploadService','chatFree','正在准备发送请求到\x20','length','globalConfigService','1024x1024','includes','draw\x20error:\x20','../globalConfig/globalConfig.service','name','3985056ByHKjU','application/json','uploadService','debug','绘制图片失败，此次绘画被拒绝了！','metadata','63HnKsIp','error','DrawService','getConfigs','@nestjs/common','参考上文，结合我的需求，给出绘画描述。我的需求是：','getMonth','fluxDraw','response','function','当前模型key已被封禁、已冻结当前调用Key、尝试重新对话试试吧！','4gSylCo','Billing\x20hard\x20limit\x20has\x20been\x20reached','请求状态','chatLogService','default','text','741895kZSUcQ','padStart','object','__esModule','../upload/upload.service','------>\x20开始上传图片！！！','464598LFhyAu','请求成功','你是一个绘画提示词生成工具，请根据用户的要求，结合上下文，用一段文字，描述用户需要的绘画需求，不用包含任何礼貌性的寒暄,只需要场景的描述,可以适当联想','message','getDate','uploadFileFromUrl','915720JzRNDZ','openAIChatService','绘制图片失败，请稍后试试吧！','This\x20request\x20has\x20been\x20blocked\x20by\x20our\x20content\x20filters','../chatLog/chatLog.service','__decorate','./openaiChat.service','data','Bearer\x20','defineProperty','Logger','size','url','调用chatFree失败：','1081746ZLeGrr','2604535MYMNte','74709DLutrV','design:paramtypes','status','已开启连续绘画模式','stringify','isDalleChat','__metadata','FluxDrawService','上传图片过程中出现错误:\x20'];_0x5b4b=function(){return _0x1994d8;};return _0x5b4b();}Object['defineProperty'](exports,_0x3fbaf1(0x14c),{'value':!![]}),exports['FluxDrawService']=void 0x0;const common_1=require(_0x3fbaf1(0x13c)),axios_1=require('axios'),chatLog_service_1=require(_0x3fbaf1(0x159)),globalConfig_service_1=require(_0x3fbaf1(0x130)),upload_service_1=require(_0x3fbaf1(0x14d)),openaiChat_service_1=require(_0x3fbaf1(0x15b));let FluxDrawService=FluxDrawService_1=class FluxDrawService{constructor(_0x5a0ed9,_0x843094,_0x41a297,_0x2668a9){const _0x5ab923=_0x3fbaf1;this[_0x5ab923(0x134)]=_0x5a0ed9,this[_0x5ab923(0x12c)]=_0x843094,this[_0x5ab923(0x146)]=_0x41a297,this[_0x5ab923(0x156)]=_0x2668a9,this['logger']=new common_1[(_0x5ab923(0x112))](FluxDrawService_1[_0x5ab923(0x131)]);}async[_0x3fbaf1(0x13f)](_0x5c431a,_0x25d0b1){const _0x5f5bfa=_0x3fbaf1;var _0x448cf0,_0x3caad6,_0x3f1686,_0x225e9e;common_1[_0x5f5bfa(0x112)][_0x5f5bfa(0x122)](_0x5f5bfa(0x121),_0x5f5bfa(0x13a));const {apiKey:_0xf6366d,model:_0x178173,proxyUrl:_0x11e17d,prompt:_0x580f82,extraParam:_0x1c0888,timeout:_0x21bf97,onSuccess:_0x24db31,onFailure:_0x46da65,groupId:_0x426890}=_0x5c431a,_0x397ee6=await this[_0x5f5bfa(0x12c)][_0x5f5bfa(0x13b)]([_0x5f5bfa(0x11d)]);let _0x409c95;if(_0x397ee6==='1')try{common_1[_0x5f5bfa(0x112)]['log'](_0x5f5bfa(0x11b),'FluxDraw');const {messagesHistory:_0x2b6eef}=await _0x25d0b1(_0x5f5bfa(0x13d)+_0x580f82,{'groupId':_0x426890,'systemMessage':_0x5f5bfa(0x151),'maxModelTokens':0x1f40,'maxRounds':0x5,'fileInfo':''},this[_0x5f5bfa(0x146)]);_0x409c95=await this['openAIChatService'][_0x5f5bfa(0x129)](_0x580f82,undefined,_0x2b6eef);}catch(_0x4003c5){console[_0x5f5bfa(0x139)](_0x5f5bfa(0x115),_0x4003c5),_0x409c95=_0x580f82;}else _0x409c95=_0x580f82;const _0x1c4837=(_0x1c0888===null||_0x1c0888===void 0x0?void 0x0:_0x1c0888[_0x5f5bfa(0x113)])||_0x5f5bfa(0x12d);let _0x3f935e={'answer':'','fileInfo':'','status':0x2};try{const _0x531805={'method':'POST','url':_0x11e17d+'/v1/images/generations','timeout':_0x21bf97,'headers':{'Content-Type':_0x5f5bfa(0x133),'Authorization':_0x5f5bfa(0x15d)+_0xf6366d},'data':{'model':_0x178173,'prompt':_0x409c95,'size':_0x1c4837}};common_1[_0x5f5bfa(0x112)]['log'](_0x5f5bfa(0x12a)+_0x531805['url']+'，payload:\x20'+JSON[_0x5f5bfa(0x11c)](_0x531805[_0x5f5bfa(0x15c)])+',\x20headers:\x20'+JSON['stringify'](_0x531805['headers']),_0x5f5bfa(0x11f));const _0x242bf0=await(0x0,axios_1[_0x5f5bfa(0x147)])(_0x531805);common_1['Logger'][_0x5f5bfa(0x135)](_0x5f5bfa(0x150)+JSON[_0x5f5bfa(0x11c)](_0x242bf0[_0x5f5bfa(0x15c)]['data'][0x0])),common_1['Logger'][_0x5f5bfa(0x135)](_0x5f5bfa(0x145)+JSON[_0x5f5bfa(0x11c)](_0x242bf0['status']));const _0x3608d7=_0x242bf0[_0x5f5bfa(0x15c)][_0x5f5bfa(0x15c)][0x0][_0x5f5bfa(0x114)];try{common_1[_0x5f5bfa(0x112)][_0x5f5bfa(0x122)](_0x5f5bfa(0x14e),_0x5f5bfa(0x13a));const _0x1dbb8b=new Date(),_0x55516a=_0x1dbb8b['getFullYear'](),_0x40d613=String(_0x1dbb8b[_0x5f5bfa(0x13e)]()+0x1)[_0x5f5bfa(0x14a)](0x2,'0'),_0x5963ef=String(_0x1dbb8b[_0x5f5bfa(0x153)]())['padStart'](0x2,'0'),_0x44960d=''+_0x55516a+_0x40d613+'/'+_0x5963ef;_0x3f935e['fileInfo']=await this['uploadService'][_0x5f5bfa(0x154)]({'url':_0x3608d7,'dir':'images/dalle/'+_0x44960d}),common_1[_0x5f5bfa(0x112)]['log']('图片上传成功，URL:\x20'+_0x3f935e['fileInfo'],'DrawService');}catch(_0x31973c){common_1[_0x5f5bfa(0x112)][_0x5f5bfa(0x139)](_0x5f5bfa(0x120)+_0x31973c,_0x5f5bfa(0x13a));}let _0x1267be;try{_0x1267be=await this['openAIChatService']['chatFree'](_0x5f5bfa(0x123)+_0x409c95+_0x5f5bfa(0x126));}catch(_0x1deac4){_0x1267be=_0x580f82+'\x20绘制成功',common_1[_0x5f5bfa(0x112)][_0x5f5bfa(0x139)]('翻译失败:\x20',_0x1deac4);}_0x3f935e['answer']=_0x1267be,_0x3f935e[_0x5f5bfa(0x11a)]=0x3,_0x24db31(_0x3f935e);return;}catch(_0x3a777f){_0x3f935e[_0x5f5bfa(0x11a)]=0x5,_0x46da65(_0x3f935e);const _0x58c986=((_0x448cf0=_0x3a777f===null||_0x3a777f===void 0x0?void 0x0:_0x3a777f[_0x5f5bfa(0x140)])===null||_0x448cf0===void 0x0?void 0x0:_0x448cf0[_0x5f5bfa(0x11a)])||0x1f4;console[_0x5f5bfa(0x122)](_0x5f5bfa(0x12f),JSON[_0x5f5bfa(0x11c)](_0x3a777f),_0x58c986);const _0x32cc54=(_0x225e9e=(_0x3f1686=(_0x3caad6=_0x3a777f===null||_0x3a777f===void 0x0?void 0x0:_0x3a777f[_0x5f5bfa(0x140)])===null||_0x3caad6===void 0x0?void 0x0:_0x3caad6[_0x5f5bfa(0x15c)])===null||_0x3f1686===void 0x0?void 0x0:_0x3f1686[_0x5f5bfa(0x139)])===null||_0x225e9e===void 0x0?void 0x0:_0x225e9e[_0x5f5bfa(0x152)];if(_0x58c986===0x1ad)return _0x3f935e[_0x5f5bfa(0x148)]='当前请求已过载、请稍等会儿再试试吧！',_0x3f935e;if(_0x58c986===0x190&&_0x32cc54[_0x5f5bfa(0x12e)](_0x5f5bfa(0x158)))return _0x3f935e[_0x5f5bfa(0x148)]='您的请求已被系统拒绝。您的提示可能存在一些非法的文本。',_0x3f935e;if(_0x58c986===0x190&&_0x32cc54['includes'](_0x5f5bfa(0x144)))return _0x3f935e['text']=_0x5f5bfa(0x142),_0x3f935e;if(_0x58c986===0x1f4)return _0x3f935e[_0x5f5bfa(0x148)]='绘制图片失败，请检查你的提示词是否有非法描述！',_0x3f935e;if(_0x58c986===0x191)return _0x3f935e['text']=_0x5f5bfa(0x136),_0x3f935e;return _0x3f935e['text']=_0x5f5bfa(0x157),_0x3f935e;}}};FluxDrawService=FluxDrawService_1=__decorate([(0x0,common_1['Injectable'])(),__metadata(_0x3fbaf1(0x119),[upload_service_1[_0x3fbaf1(0x128)],globalConfig_service_1[_0x3fbaf1(0x125)],chatLog_service_1['ChatLogService'],openaiChat_service_1['OpenAIChatService']])],FluxDrawService),exports[_0x3fbaf1(0x11f)]=FluxDrawService;