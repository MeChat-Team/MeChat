'use strict';const _0x5e2c4d=_0x2bac;(function(_0x3b7703,_0x3a7e1c){const _0x13320e=_0x2bac,_0x4ba9e0=_0x3b7703();while(!![]){try{const _0x2fc631=parseInt(_0x13320e(0x15a))/0x1*(-parseInt(_0x13320e(0x146))/0x2)+parseInt(_0x13320e(0x147))/0x3*(parseInt(_0x13320e(0x155))/0x4)+parseInt(_0x13320e(0x13b))/0x5+parseInt(_0x13320e(0x135))/0x6*(-parseInt(_0x13320e(0x164))/0x7)+-parseInt(_0x13320e(0x181))/0x8+-parseInt(_0x13320e(0x159))/0x9*(-parseInt(_0x13320e(0x178))/0xa)+-parseInt(_0x13320e(0x174))/0xb*(parseInt(_0x13320e(0x185))/0xc);if(_0x2fc631===_0x3a7e1c)break;else _0x4ba9e0['push'](_0x4ba9e0['shift']());}catch(_0x33f2ed){_0x4ba9e0['push'](_0x4ba9e0['shift']());}}}(_0x3aec,0x7a70d));var __decorate=this&&this['__decorate']||function(_0x5f409d,_0x5c61b2,_0x304ee2,_0x1f03e9){const _0x24f438=_0x2bac;var _0x451f23=arguments['length'],_0x38a4f0=_0x451f23<0x3?_0x5c61b2:_0x1f03e9===null?_0x1f03e9=Object[_0x24f438(0x179)](_0x5c61b2,_0x304ee2):_0x1f03e9,_0x4a980b;if(typeof Reflect===_0x24f438(0x177)&&typeof Reflect['decorate']===_0x24f438(0x150))_0x38a4f0=Reflect[_0x24f438(0x140)](_0x5f409d,_0x5c61b2,_0x304ee2,_0x1f03e9);else{for(var _0x2f78d3=_0x5f409d['length']-0x1;_0x2f78d3>=0x0;_0x2f78d3--)if(_0x4a980b=_0x5f409d[_0x2f78d3])_0x38a4f0=(_0x451f23<0x3?_0x4a980b(_0x38a4f0):_0x451f23>0x3?_0x4a980b(_0x5c61b2,_0x304ee2,_0x38a4f0):_0x4a980b(_0x5c61b2,_0x304ee2))||_0x38a4f0;}return _0x451f23>0x3&&_0x38a4f0&&Object[_0x24f438(0x138)](_0x5c61b2,_0x304ee2,_0x38a4f0),_0x38a4f0;},__metadata=this&&this[_0x5e2c4d(0x176)]||function(_0x27925f,_0x295b09){const _0x2f92ef=_0x5e2c4d;if(typeof Reflect===_0x2f92ef(0x177)&&typeof Reflect['metadata']===_0x2f92ef(0x150))return Reflect[_0x2f92ef(0x17f)](_0x27925f,_0x295b09);},FluxDrawService_1;Object[_0x5e2c4d(0x138)](exports,_0x5e2c4d(0x13d),{'value':!![]}),exports['FluxDrawService']=void 0x0;function _0x2bac(_0x48a443,_0x2368d5){const _0x3aec9e=_0x3aec();return _0x2bac=function(_0x2bac35,_0x3732b9){_0x2bac35=_0x2bac35-0x134;let _0x57ff1f=_0x3aec9e[_0x2bac35];return _0x57ff1f;},_0x2bac(_0x48a443,_0x2368d5);}const common_1=require('@nestjs/common'),axios_1=require(_0x5e2c4d(0x13f)),chatLog_service_1=require(_0x5e2c4d(0x16e)),globalConfig_service_1=require(_0x5e2c4d(0x137)),upload_service_1=require(_0x5e2c4d(0x17c)),openaiChat_service_1=require(_0x5e2c4d(0x162));let FluxDrawService=FluxDrawService_1=class FluxDrawService{constructor(_0x5c2c4d,_0x1655b9,_0xb4728a,_0x1b5229){const _0xa2afea=_0x5e2c4d;this[_0xa2afea(0x16a)]=_0x5c2c4d,this[_0xa2afea(0x148)]=_0x1655b9,this[_0xa2afea(0x17d)]=_0xb4728a,this[_0xa2afea(0x14f)]=_0x1b5229,this[_0xa2afea(0x139)]=new common_1[(_0xa2afea(0x163))](FluxDrawService_1[_0xa2afea(0x160)]);}async[_0x5e2c4d(0x14d)](_0x29c3be,_0x1ff498){const _0x496dab=_0x5e2c4d;var _0x3a2f4c,_0x626e8a,_0x3afb39,_0x479d41;common_1[_0x496dab(0x163)][_0x496dab(0x145)](_0x496dab(0x156),'DrawService');const {apiKey:_0x59a311,model:_0x51681e,proxyUrl:_0xcd75c,prompt:_0x3cad13,extraParam:_0x424377,timeout:_0x4eeee4,onSuccess:_0x30bd06,onFailure:_0x41f7b3,groupId:_0xddd721}=_0x29c3be,_0x3f74d0=await this[_0x496dab(0x148)][_0x496dab(0x170)]([_0x496dab(0x173)]);let _0x423fab;if(_0x3f74d0==='1')try{common_1['Logger'][_0x496dab(0x145)](_0x496dab(0x184),_0x496dab(0x14c));const {messagesHistory:_0x31c9d6}=await _0x1ff498('参考上文，结合我的需求，给出绘画描述。我的需求是：'+_0x3cad13,{'groupId':_0xddd721,'systemMessage':_0x496dab(0x141),'maxModelTokens':0x1f40,'maxRounds':0x5,'fileInfo':''},this['chatLogService']);_0x423fab=await this[_0x496dab(0x14f)][_0x496dab(0x169)](_0x3cad13,undefined,_0x31c9d6);}catch(_0x1b45ed){console[_0x496dab(0x153)](_0x496dab(0x143),_0x1b45ed),_0x423fab=_0x3cad13;}else _0x423fab=_0x3cad13;const _0x4d4768=(_0x424377===null||_0x424377===void 0x0?void 0x0:_0x424377[_0x496dab(0x183)])||'1024x1024';let _0x512ec7={'answer':'','fileInfo':'','status':0x2};try{const _0x52ed83={'method':_0x496dab(0x15e),'url':_0xcd75c+_0x496dab(0x13a),'timeout':_0x4eeee4,'headers':{'Content-Type':_0x496dab(0x154),'Authorization':_0x496dab(0x168)+_0x59a311},'data':{'model':_0x51681e,'prompt':_0x423fab,'size':_0x4d4768}};common_1[_0x496dab(0x163)]['log'](_0x496dab(0x16f)+_0x52ed83[_0x496dab(0x17a)]+_0x496dab(0x180)+JSON[_0x496dab(0x15c)](_0x52ed83['data'])+_0x496dab(0x16d)+JSON[_0x496dab(0x15c)](_0x52ed83[_0x496dab(0x171)]),'FluxDrawService');const _0x2cc615=await(0x0,axios_1[_0x496dab(0x144)])(_0x52ed83);common_1[_0x496dab(0x163)]['debug'](_0x496dab(0x16c)+JSON[_0x496dab(0x15c)](_0x2cc615[_0x496dab(0x136)][_0x496dab(0x136)][0x0])),common_1['Logger']['debug']('请求状态'+JSON[_0x496dab(0x15c)](_0x2cc615[_0x496dab(0x15f)]));const _0x42fb25=_0x2cc615[_0x496dab(0x136)][_0x496dab(0x136)][0x0][_0x496dab(0x17a)];try{common_1[_0x496dab(0x163)][_0x496dab(0x145)](_0x496dab(0x158),'DrawService');const _0x6b0954=new Date(),_0x41eab0=_0x6b0954[_0x496dab(0x182)](),_0x296eaf=String(_0x6b0954['getMonth']()+0x1)[_0x496dab(0x157)](0x2,'0'),_0x3db283=String(_0x6b0954[_0x496dab(0x165)]())[_0x496dab(0x157)](0x2,'0'),_0x49a9dd=''+_0x41eab0+_0x296eaf+'/'+_0x3db283;_0x512ec7[_0x496dab(0x14a)]=await this[_0x496dab(0x16a)][_0x496dab(0x14b)]({'url':_0x42fb25,'dir':_0x496dab(0x175)+_0x49a9dd}),common_1[_0x496dab(0x163)]['log'](_0x496dab(0x167)+_0x512ec7[_0x496dab(0x14a)],_0x496dab(0x13e));}catch(_0x1d686a){common_1[_0x496dab(0x163)][_0x496dab(0x153)](_0x496dab(0x15d)+_0x1d686a,_0x496dab(0x13e));}let _0x30da3c;try{_0x30da3c=await this[_0x496dab(0x14f)][_0x496dab(0x169)](_0x496dab(0x152)+_0x423fab+_0x496dab(0x142));}catch(_0x3cea13){_0x30da3c=_0x3cad13+_0x496dab(0x161),common_1['Logger']['error'](_0x496dab(0x149),_0x3cea13);}_0x512ec7['answer']=_0x30da3c,_0x512ec7[_0x496dab(0x15f)]=0x3,_0x30bd06(_0x512ec7);return;}catch(_0x121aeb){_0x512ec7['status']=0x5,_0x41f7b3(_0x512ec7);const _0x2254e5=((_0x3a2f4c=_0x121aeb===null||_0x121aeb===void 0x0?void 0x0:_0x121aeb['response'])===null||_0x3a2f4c===void 0x0?void 0x0:_0x3a2f4c[_0x496dab(0x15f)])||0x1f4;console[_0x496dab(0x145)](_0x496dab(0x172),JSON[_0x496dab(0x15c)](_0x121aeb),_0x2254e5);const _0x2fc323=(_0x479d41=(_0x3afb39=(_0x626e8a=_0x121aeb===null||_0x121aeb===void 0x0?void 0x0:_0x121aeb[_0x496dab(0x15b)])===null||_0x626e8a===void 0x0?void 0x0:_0x626e8a['data'])===null||_0x3afb39===void 0x0?void 0x0:_0x3afb39[_0x496dab(0x153)])===null||_0x479d41===void 0x0?void 0x0:_0x479d41[_0x496dab(0x17b)];if(_0x2254e5===0x1ad)return _0x512ec7[_0x496dab(0x166)]=_0x496dab(0x134),_0x512ec7;if(_0x2254e5===0x190&&_0x2fc323['includes']('This\x20request\x20has\x20been\x20blocked\x20by\x20our\x20content\x20filters'))return _0x512ec7[_0x496dab(0x166)]='您的请求已被系统拒绝。您的提示可能存在一些非法的文本。',_0x512ec7;if(_0x2254e5===0x190&&_0x2fc323[_0x496dab(0x13c)]('Billing\x20hard\x20limit\x20has\x20been\x20reached'))return _0x512ec7[_0x496dab(0x166)]=_0x496dab(0x17e),_0x512ec7;if(_0x2254e5===0x1f4)return _0x512ec7[_0x496dab(0x166)]='绘制图片失败，请检查你的提示词是否有非法描述！',_0x512ec7;if(_0x2254e5===0x191)return _0x512ec7[_0x496dab(0x166)]='绘制图片失败，此次绘画被拒绝了！',_0x512ec7;return _0x512ec7['text']='绘制图片失败，请稍后试试吧！',_0x512ec7;}}};FluxDrawService=FluxDrawService_1=__decorate([(0x0,common_1['Injectable'])(),__metadata('design:paramtypes',[upload_service_1[_0x5e2c4d(0x14e)],globalConfig_service_1['GlobalConfigService'],chatLog_service_1['ChatLogService'],openaiChat_service_1[_0x5e2c4d(0x16b)]])],FluxDrawService),exports[_0x5e2c4d(0x151)]=FluxDrawService;function _0x3aec(){const _0x14ae1=['fluxDraw','UploadService','openAIChatService','function','FluxDrawService','根据提示词{','error','application/json','42956XYnEvX','开始提交\x20Flux\x20绘图任务\x20','padStart','------>\x20开始上传图片！！！','549inDpAS','3RlsMuB','response','stringify','上传图片过程中出现错误:\x20','POST','status','name','\x20绘制成功','./openaiChat.service','Logger','5425HzOFzD','getDate','text','图片上传成功，URL:\x20','Bearer\x20','chatFree','uploadService','OpenAIChatService','请求成功',',\x20headers:\x20','../chatLog/chatLog.service','正在准备发送请求到\x20','getConfigs','headers','draw\x20error:\x20','isDalleChat','1672077tTSmZS','images/dalle/','__metadata','object','55790CsmXhV','getOwnPropertyDescriptor','url','message','../upload/upload.service','chatLogService','当前模型key已被封禁、已冻结当前调用Key、尝试重新对话试试吧！','metadata','，payload:\x20','1825600lbalrz','getFullYear','size','已开启连续绘画模式','12xBDmTO','当前请求已过载、请稍等会儿再试试吧！','1194WzXEol','data','../globalConfig/globalConfig.service','defineProperty','logger','/v1/images/generations','2658645OtzlHK','includes','__esModule','DrawService','axios','decorate','你是一个绘画提示词生成工具，请根据用户的要求，结合上下文，用一段文字，描述用户需要的绘画需求，不用包含任何礼貌性的寒暄,只需要场景的描述,可以适当联想','},\x20模拟AI绘画机器人的语气，用中文回复，告诉用户已经画好了','调用chatFree失败：','default','log','499276RhcyEO','255kEOCuO','globalConfigService','翻译失败:\x20','fileInfo','uploadFileFromUrl','FluxDraw'];_0x3aec=function(){return _0x14ae1;};return _0x3aec();}