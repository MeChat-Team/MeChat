'use strict';const _0x5c646f=_0x349b;(function(_0x5baa08,_0xa8190e){const _0x48fead=_0x349b,_0x501f95=_0x5baa08();while(!![]){try{const _0x22488e=-parseInt(_0x48fead(0x1e5))/0x1+parseInt(_0x48fead(0x1b1))/0x2+-parseInt(_0x48fead(0x1fa))/0x3*(-parseInt(_0x48fead(0x1ee))/0x4)+parseInt(_0x48fead(0x1c1))/0x5*(parseInt(_0x48fead(0x202))/0x6)+parseInt(_0x48fead(0x1ca))/0x7+parseInt(_0x48fead(0x1a4))/0x8+-parseInt(_0x48fead(0x1b4))/0x9*(parseInt(_0x48fead(0x19b))/0xa);if(_0x22488e===_0xa8190e)break;else _0x501f95['push'](_0x501f95['shift']());}catch(_0x2cab65){_0x501f95['push'](_0x501f95['shift']());}}}(_0x43e6,0xf2f86));function _0x43e6(){const _0x175e0=['上传音频文件失败:\x20','uploadFileFromUrl','轮询失败，重试次数:\x20','getOwnPropertyDescriptor','progress','globalConfigService','ChatLogService','1405EgXGsF','轮询过程中发生错误:\x20','uploadService','debug','metadata','images/suno-music/','__esModule','任务提交失败','object','2878855feTWiz','title','上传视频文件失败:\x20','上传图片文件失败:\x20','chatLogService','LumaService','Injectable','更新日志失败:\x20','push','音乐任务已完成','Logger','log','taskData格式错误','MUSIC','查询生成结果时发生错误','getConfigs','正在准备发送请求到\x20','getDate','../globalConfig/globalConfig.service','stringify','padStart','__decorate','查询生成结果时发生错误:','任务提交成功,\x20任务ID:\x20','SUCCESS','SunoService','data','256530ZkpOCX','message','audio/suno-music/','localStorageStatus','任务提交结果，状态码:\x20','videoUrl','taskId','音乐生成失败','轮询超时，请稍后再试！','16pEJPIr','解析taskData失败:\x20','function','LYRICS','/task/suno/v1/submit/music','error','audioUrl','filter','default','status',',\x20headers:\x20','音乐生成成功:\x20','402855lbJJGd','isArray',',\x20状态消息:\x20','音频生成成功，等待视频生成...','未能获取结果数据,\x20即将重试','axios','now','Bearer\x20','19506sQxKZV','100%','taskData','@nestjs/common','length','pollSunoMusicResult','7630170fkpOgA','生成失败','video/suno-music/','轮询结果:\x20','音乐生成中...','getFullYear','歌词生成中','get','text','3327872pUDThJ','，payload:\x20','fileInfo','GlobalConfigService','map','answer',',\x20数据:\x20','suno','UploadService','statusText','/task/suno/v1/fetch/','updateChatLog','查询超时，请稍后再试！','2525734HwoKVN','post','decorate','27ERvyyO','音乐已生成','join','defineProperty','/task/suno/v1/submit/lyrics','开始生成音乐'];_0x43e6=function(){return _0x175e0;};return _0x43e6();}var __decorate=this&&this[_0x5c646f(0x1df)]||function(_0x20a8e0,_0x563529,_0x160eff,_0x531a28){const _0xeca2ab=_0x5c646f;var _0x29e7b0=arguments[_0xeca2ab(0x199)],_0x328ab7=_0x29e7b0<0x3?_0x563529:_0x531a28===null?_0x531a28=Object[_0xeca2ab(0x1bd)](_0x563529,_0x160eff):_0x531a28,_0x106168;if(typeof Reflect===_0xeca2ab(0x1c9)&&typeof Reflect[_0xeca2ab(0x1b3)]===_0xeca2ab(0x1f0))_0x328ab7=Reflect['decorate'](_0x20a8e0,_0x563529,_0x160eff,_0x531a28);else{for(var _0x40ffbd=_0x20a8e0['length']-0x1;_0x40ffbd>=0x0;_0x40ffbd--)if(_0x106168=_0x20a8e0[_0x40ffbd])_0x328ab7=(_0x29e7b0<0x3?_0x106168(_0x328ab7):_0x29e7b0>0x3?_0x106168(_0x563529,_0x160eff,_0x328ab7):_0x106168(_0x563529,_0x160eff))||_0x328ab7;}return _0x29e7b0>0x3&&_0x328ab7&&Object[_0xeca2ab(0x1b7)](_0x563529,_0x160eff,_0x328ab7),_0x328ab7;},__metadata=this&&this['__metadata']||function(_0xc0a245,_0x56d177){const _0x2c9052=_0x5c646f;if(typeof Reflect===_0x2c9052(0x1c9)&&typeof Reflect['metadata']===_0x2c9052(0x1f0))return Reflect[_0x2c9052(0x1c5)](_0xc0a245,_0x56d177);};Object[_0x5c646f(0x1b7)](exports,_0x5c646f(0x1c7),{'value':!![]}),exports[_0x5c646f(0x1e3)]=void 0x0;function _0x349b(_0x3fcfa1,_0x17c6dc){const _0x43e6bd=_0x43e6();return _0x349b=function(_0x349be9,_0x3b59f2){_0x349be9=_0x349be9-0x198;let _0x21a68b=_0x43e6bd[_0x349be9];return _0x21a68b;},_0x349b(_0x3fcfa1,_0x17c6dc);}const common_1=require(_0x5c646f(0x198)),axios_1=require(_0x5c646f(0x1ff)),chatLog_service_1=require('../chatLog/chatLog.service'),globalConfig_service_1=require(_0x5c646f(0x1dc)),upload_service_1=require('../upload/upload.service');let SunoService=class SunoService{constructor(_0x2b037a,_0xf8835e,_0x1d74c2){const _0x2d2835=_0x5c646f;this['chatLogService']=_0x2b037a,this['uploadService']=_0xf8835e,this[_0x2d2835(0x1bf)]=_0x1d74c2;}async[_0x5c646f(0x1ab)](_0x46dde4){const _0x188592=_0x5c646f;var _0x4f30e4,_0x12420c,_0x5c6c74;const {apiKey:_0x567346,proxyUrl:_0x8ac562,action:_0x382545,prompt:_0x3f992c,timeout:_0x283e07,assistantLogId:_0x114eb5,taskData:_0xfba9a1,extraParam:_0xd80048}=_0x46dde4;common_1[_0x188592(0x1d4)]['debug']('SunoService:\x20'+JSON[_0x188592(0x1dd)](_0x46dde4),_0x188592(0x1e3));let _0x13b7b3={'text':'','fileInfo':'','taskId':'','taskData':'','status':0x2};common_1[_0x188592(0x1d4)]['log'](_0x188592(0x1b9),_0x188592(0x1e3));let _0x4c5003=null,_0x2ea202='',_0x14c8ab={};const _0xf57135={'Authorization':_0x188592(0x201)+_0x567346};_0x382545===_0x188592(0x1f1)&&(_0x2ea202=_0x8ac562+_0x188592(0x1b8),_0x14c8ab={'prompt':_0x3f992c});if(_0x382545===_0x188592(0x1d7)){_0x2ea202=_0x8ac562+_0x188592(0x1f2);try{_0x14c8ab=JSON['parse'](_0xfba9a1);}catch(_0xb3ac02){common_1[_0x188592(0x1d4)][_0x188592(0x1f3)](_0x188592(0x1ef)+_0xb3ac02[_0x188592(0x1e6)],_0x188592(0x1e3));throw new Error(_0x188592(0x1d6));}}common_1[_0x188592(0x1d4)][_0x188592(0x1d5)](_0x188592(0x1da)+_0x2ea202+_0x188592(0x1a5)+JSON[_0x188592(0x1dd)](_0x14c8ab)+_0x188592(0x1f8)+JSON[_0x188592(0x1dd)](_0xf57135),_0x188592(0x1e3));try{_0x4c5003=await axios_1[_0x188592(0x1f6)][_0x188592(0x1b2)](_0x2ea202,_0x14c8ab,{'headers':_0xf57135}),common_1['Logger'][_0x188592(0x1c4)](_0x188592(0x1e9)+_0x4c5003[_0x188592(0x1f7)]+_0x188592(0x1fc)+_0x4c5003[_0x188592(0x1ad)]+_0x188592(0x1aa)+JSON[_0x188592(0x1dd)](_0x4c5003[_0x188592(0x1e4)]));}catch(_0x17ba2c){common_1[_0x188592(0x1d4)][_0x188592(0x1f3)]('任务提交失败:\x20'+_0x17ba2c[_0x188592(0x1e6)],_0x188592(0x1e3));throw new Error(_0x188592(0x1c8));}if((_0x4f30e4=_0x4c5003===null||_0x4c5003===void 0x0?void 0x0:_0x4c5003[_0x188592(0x1e4)])===null||_0x4f30e4===void 0x0?void 0x0:_0x4f30e4[_0x188592(0x1e4)])_0x13b7b3[_0x188592(0x1eb)]=(_0x12420c=_0x4c5003===null||_0x4c5003===void 0x0?void 0x0:_0x4c5003[_0x188592(0x1e4)])===null||_0x12420c===void 0x0?void 0x0:_0x12420c['data'],common_1[_0x188592(0x1d4)][_0x188592(0x1d5)](_0x188592(0x1e1)+((_0x5c6c74=_0x4c5003===null||_0x4c5003===void 0x0?void 0x0:_0x4c5003[_0x188592(0x1e4)])===null||_0x5c6c74===void 0x0?void 0x0:_0x5c6c74[_0x188592(0x1e4)]),'SunoService');else throw new Error(_0x188592(0x1fe));try{await this['pollSunoMusicResult']({'proxyUrl':_0x8ac562,'apiKey':_0x567346,'taskId':_0x4c5003[_0x188592(0x1e4)][_0x188592(0x1e4)],'timeout':_0x283e07,'prompt':_0x3f992c,'action':_0x382545,'onSuccess':async _0x145b15=>{const _0x1836c3=_0x188592;try{await this[_0x1836c3(0x1ce)]['updateChatLog'](_0x114eb5,{'videoUrl':_0x145b15===null||_0x145b15===void 0x0?void 0x0:_0x145b15[_0x1836c3(0x1ea)],'audioUrl':_0x145b15===null||_0x145b15===void 0x0?void 0x0:_0x145b15[_0x1836c3(0x1f4)],'fileInfo':_0x145b15===null||_0x145b15===void 0x0?void 0x0:_0x145b15[_0x1836c3(0x1a6)],'answer':(_0x145b15===null||_0x145b15===void 0x0?void 0x0:_0x145b15[_0x1836c3(0x1a9)])||_0x3f992c,'progress':_0x1836c3(0x203),'status':0x3,'taskId':_0x145b15===null||_0x145b15===void 0x0?void 0x0:_0x145b15[_0x1836c3(0x1eb)],'taskData':_0x145b15===null||_0x145b15===void 0x0?void 0x0:_0x145b15['taskData']}),common_1['Logger'][_0x1836c3(0x1d5)](_0x1836c3(0x1d3),_0x1836c3(0x1e3));}catch(_0x5c92d0){common_1['Logger'][_0x1836c3(0x1f3)](_0x1836c3(0x1d1)+_0x5c92d0[_0x1836c3(0x1e6)],_0x1836c3(0x1e3));}},'onAudioSuccess':async _0x211e41=>{const _0x4b5b60=_0x188592;try{await this['chatLogService'][_0x4b5b60(0x1af)](_0x114eb5,{'videoUrl':_0x211e41===null||_0x211e41===void 0x0?void 0x0:_0x211e41[_0x4b5b60(0x1ea)],'audioUrl':_0x211e41===null||_0x211e41===void 0x0?void 0x0:_0x211e41[_0x4b5b60(0x1f4)],'fileInfo':_0x211e41===null||_0x211e41===void 0x0?void 0x0:_0x211e41[_0x4b5b60(0x1a6)],'answer':(_0x211e41===null||_0x211e41===void 0x0?void 0x0:_0x211e41[_0x4b5b60(0x1a9)])||_0x3f992c,'progress':_0x211e41===null||_0x211e41===void 0x0?void 0x0:_0x211e41[_0x4b5b60(0x1be)],'status':_0x211e41[_0x4b5b60(0x1f7)],'taskId':_0x211e41===null||_0x211e41===void 0x0?void 0x0:_0x211e41[_0x4b5b60(0x1eb)],'taskData':_0x211e41===null||_0x211e41===void 0x0?void 0x0:_0x211e41[_0x4b5b60(0x204)]}),common_1['Logger']['log'](_0x4b5b60(0x1fd),_0x4b5b60(0x1e3));}catch(_0x4d8962){common_1[_0x4b5b60(0x1d4)][_0x4b5b60(0x1f3)]('更新日志失败:\x20'+_0x4d8962[_0x4b5b60(0x1e6)],_0x4b5b60(0x1e3));}},'onGenerating':async _0x381c74=>{const _0x3317be=_0x188592;try{await this[_0x3317be(0x1ce)][_0x3317be(0x1af)](_0x114eb5,{'videoUrl':_0x381c74===null||_0x381c74===void 0x0?void 0x0:_0x381c74[_0x3317be(0x1ea)],'audioUrl':_0x381c74===null||_0x381c74===void 0x0?void 0x0:_0x381c74[_0x3317be(0x1f4)],'fileInfo':_0x381c74===null||_0x381c74===void 0x0?void 0x0:_0x381c74[_0x3317be(0x1a6)],'answer':(_0x381c74===null||_0x381c74===void 0x0?void 0x0:_0x381c74[_0x3317be(0x1a9)])||_0x3317be(0x19f),'progress':_0x381c74===null||_0x381c74===void 0x0?void 0x0:_0x381c74[_0x3317be(0x1be)],'status':_0x381c74[_0x3317be(0x1f7)]}),common_1[_0x3317be(0x1d4)][_0x3317be(0x1d5)]('音乐生成中...',_0x3317be(0x1e3));}catch(_0x1ae177){common_1[_0x3317be(0x1d4)]['error'](_0x3317be(0x1d1)+_0x1ae177['message'],_0x3317be(0x1e3));}},'onFailure':async _0x3a4b3f=>{const _0x24607a=_0x188592;try{await this['chatLogService'][_0x24607a(0x1af)](_0x114eb5,{'answer':_0x24607a(0x1ec),'status':_0x3a4b3f[_0x24607a(0x1f7)]}),common_1[_0x24607a(0x1d4)][_0x24607a(0x1d5)](_0x24607a(0x19c),_0x24607a(0x1e3));}catch(_0x5e4dfa){common_1[_0x24607a(0x1d4)][_0x24607a(0x1f3)]('更新日志失败:\x20'+_0x5e4dfa[_0x24607a(0x1e6)],_0x24607a(0x1e3));}}});}catch(_0x2f1c26){common_1['Logger']['error'](_0x188592(0x1e0),_0x2f1c26[_0x188592(0x1e6)],'SunoService');throw new Error(_0x188592(0x1d8));}return _0x13b7b3;}async[_0x5c646f(0x19a)](_0x5d8649){const _0x18e359=_0x5c646f,{proxyUrl:_0xfe908f,apiKey:_0x20a2d9,taskId:_0x5922f2,timeout:_0x2d1265,onSuccess:_0x238e19,onAudioSuccess:_0x2616bf,onFailure:_0x483ced,onGenerating:_0x3fa3d7,action:_0x510850}=_0x5d8649;let _0x31660b={'videoUrl':'','audioUrl':'','fileInfo':'','drawId':'','taskData':'','status':0x2,'progress':0x0,'answer':''};const _0x53af1e={'Authorization':_0x18e359(0x201)+_0x20a2d9},_0x431e51=_0xfe908f+_0x18e359(0x1ae)+_0x5922f2,_0x4cd8de=Date[_0x18e359(0x200)](),_0x2a38d6=0x1388;let _0x46eb43=0x0;try{while(Date['now']()-_0x4cd8de<_0x2d1265){await new Promise(_0xcce042=>setTimeout(_0xcce042,_0x2a38d6));try{const _0x18626c=await axios_1['default'][_0x18e359(0x1a2)](_0x431e51,{'headers':_0x53af1e}),_0x5bf74e=_0x18626c['data'][_0x18e359(0x1e4)];common_1[_0x18e359(0x1d4)][_0x18e359(0x1c4)](_0x18e359(0x19e)+JSON[_0x18e359(0x1dd)](_0x5bf74e),_0x18e359(0x1e3));if(_0x510850===_0x18e359(0x1f1)){if(_0x5bf74e[_0x18e359(0x1f7)]==='SUCCESS'){_0x31660b[_0x18e359(0x1eb)]=_0x5bf74e[_0x18e359(0x1e4)]['id'],_0x31660b[_0x18e359(0x204)]=JSON[_0x18e359(0x1dd)](_0x5bf74e['data']),_0x31660b[_0x18e359(0x1a9)]=_0x5bf74e['data'][_0x18e359(0x1a3)],_0x238e19(_0x31660b);return;}_0x31660b[_0x18e359(0x1be)]=_0x5bf74e===null||_0x5bf74e===void 0x0?void 0x0:_0x5bf74e[_0x18e359(0x1be)],_0x31660b[_0x18e359(0x1a9)]=_0x18e359(0x1a1),_0x31660b[_0x18e359(0x1be)]&&_0x3fa3d7(_0x31660b);}if(_0x510850==='MUSIC'){if(_0x5bf74e[_0x18e359(0x1e4)]){const _0x4bb59a=_0x5bf74e[_0x18e359(0x1e4)];_0x31660b[_0x18e359(0x204)]=JSON[_0x18e359(0x1dd)](_0x4bb59a);if(Array[_0x18e359(0x1fb)](_0x4bb59a)){const _0x5517de=_0x4bb59a['map'](_0x4e4341=>_0x4e4341['audio_url'])[_0x18e359(0x1f5)](_0x377639=>_0x377639),_0x1b0c1a=_0x4bb59a[_0x18e359(0x1a8)](_0x268448=>_0x268448['video_url'])[_0x18e359(0x1f5)](_0x15ca43=>_0x15ca43),_0x19e50a=_0x4bb59a[_0x18e359(0x1a8)](_0x290b75=>_0x290b75['image_url'])[_0x18e359(0x1f5)](_0x3b41b8=>_0x3b41b8),_0x2e9305=_0x4bb59a[_0x18e359(0x1a8)](_0x6fa392=>_0x6fa392[_0x18e359(0x1cb)]),_0x255cc5=_0x2e9305[_0x18e359(0x199)]>0x0?_0x2e9305[0x0]:_0x18e359(0x1b5);if(_0x5bf74e['status']===_0x18e359(0x1e2)){let _0x12fd86=[],_0x13a4ff=[],_0x61f206=[];try{const _0x23617b=await this[_0x18e359(0x1bf)][_0x18e359(0x1d9)]([_0x18e359(0x1e8)]);if(Number(_0x23617b)){const _0x2c2faa=new Date(),_0x498ec1=_0x2c2faa[_0x18e359(0x1a0)](),_0x2503d1=String(_0x2c2faa['getMonth']()+0x1)['padStart'](0x2,'0'),_0x2f816c=String(_0x2c2faa[_0x18e359(0x1db)]())[_0x18e359(0x1de)](0x2,'0'),_0x49b229=''+_0x498ec1+_0x2503d1+'/'+_0x2f816c;for(const _0xeb2a97 of _0x5517de){try{const _0x1315c0=await this[_0x18e359(0x1c3)][_0x18e359(0x1bb)]({'url':_0xeb2a97,'dir':_0x18e359(0x1e7)+_0x49b229});_0x12fd86[_0x18e359(0x1d2)](_0x1315c0);}catch(_0x442ccd){common_1[_0x18e359(0x1d4)]['error'](_0x18e359(0x1ba)+_0x442ccd[_0x18e359(0x1e6)],'SunoService'),_0x12fd86[_0x18e359(0x1d2)](_0xeb2a97);}}for(const _0x4562e7 of _0x1b0c1a){try{const _0x2750ce=await this['uploadService'][_0x18e359(0x1bb)]({'url':_0x4562e7,'dir':_0x18e359(0x19d)+_0x49b229});_0x13a4ff['push'](_0x2750ce);}catch(_0x10b79c){common_1['Logger'][_0x18e359(0x1f3)](_0x18e359(0x1cc)+_0x10b79c[_0x18e359(0x1e6)],_0x18e359(0x1e3)),_0x13a4ff['push'](_0x4562e7);}}for(const _0x35a0e1 of _0x19e50a){try{const _0x108fbc=await this[_0x18e359(0x1c3)][_0x18e359(0x1bb)]({'url':_0x35a0e1,'dir':_0x18e359(0x1c6)+_0x49b229});_0x61f206[_0x18e359(0x1d2)](_0x108fbc);}catch(_0x5b02ff){common_1[_0x18e359(0x1d4)]['error'](_0x18e359(0x1cd)+_0x5b02ff[_0x18e359(0x1e6)],_0x18e359(0x1e3)),_0x61f206[_0x18e359(0x1d2)](_0x35a0e1);}}}else _0x12fd86=_0x5517de,_0x13a4ff=_0x1b0c1a,_0x61f206=_0x19e50a;}catch(_0x4acb6e){common_1[_0x18e359(0x1d4)][_0x18e359(0x1f3)]('获取配置失败:\x20'+_0x4acb6e[_0x18e359(0x1e6)],_0x18e359(0x1cf)),_0x12fd86=_0x5517de,_0x13a4ff=_0x1b0c1a,_0x61f206=_0x19e50a;}_0x31660b[_0x18e359(0x1f4)]=_0x12fd86['join'](','),_0x31660b[_0x18e359(0x1ea)]=_0x13a4ff[_0x18e359(0x1b6)](','),_0x31660b['fileInfo']=_0x61f206[_0x18e359(0x1b6)](',');_0x5517de[_0x18e359(0x199)]===0x2?(_0x31660b['status']=0x3,_0x31660b[_0x18e359(0x1a9)]=_0x255cc5):(_0x31660b['status']=0x2,_0x31660b[_0x18e359(0x1be)]=_0x5bf74e===null||_0x5bf74e===void 0x0?void 0x0:_0x5bf74e[_0x18e359(0x1be)],_0x31660b['answer']='当前生成进度\x20'+(_0x5bf74e===null||_0x5bf74e===void 0x0?void 0x0:_0x5bf74e['progress']));common_1[_0x18e359(0x1d4)][_0x18e359(0x1c4)](_0x18e359(0x1f9)+JSON[_0x18e359(0x1dd)](_0x4bb59a),_0x18e359(0x1e3)),_0x238e19(_0x31660b);return;}else _0x31660b[_0x18e359(0x1f4)]=_0x5517de[_0x18e359(0x1b6)](','),_0x31660b[_0x18e359(0x1ea)]=_0x1b0c1a[_0x18e359(0x1b6)](','),_0x31660b[_0x18e359(0x1a6)]=_0x19e50a['join'](','),_0x31660b[_0x18e359(0x1f7)]=0x2,_0x31660b['progress']=_0x5bf74e===null||_0x5bf74e===void 0x0?void 0x0:_0x5bf74e[_0x18e359(0x1be)],_0x31660b['answer']=_0x255cc5,_0x2616bf(_0x31660b);}}!_0x31660b[_0x18e359(0x1f4)]&&_0x31660b[_0x18e359(0x1be)]&&_0x31660b[_0x18e359(0x1f7)]===0x2&&_0x3fa3d7(_0x31660b);}}catch(_0x47e4ea){_0x46eb43++,common_1['Logger']['error'](_0x18e359(0x1bc)+_0x46eb43,_0x18e359(0x1e3));}}common_1[_0x18e359(0x1d4)]['error'](_0x18e359(0x1ed),'SunoService'),_0x31660b[_0x18e359(0x1f7)]=0x4,_0x483ced(_0x31660b);throw new Error(_0x18e359(0x1b0));}catch(_0x336ab4){common_1[_0x18e359(0x1d4)]['error'](_0x18e359(0x1c2)+_0x336ab4,_0x18e359(0x1e3)),_0x31660b[_0x18e359(0x1f7)]=0x5,_0x483ced(_0x31660b);}}};SunoService=__decorate([(0x0,common_1[_0x5c646f(0x1d0)])(),__metadata('design:paramtypes',[chatLog_service_1[_0x5c646f(0x1c0)],upload_service_1[_0x5c646f(0x1ac)],globalConfig_service_1[_0x5c646f(0x1a7)]])],SunoService),exports['SunoService']=SunoService;