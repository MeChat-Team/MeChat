'use strict';const _0x50720c=_0x5f3c;(function(_0x4dc101,_0x4b9209){const _0x35b19c=_0x5f3c,_0x562343=_0x4dc101();while(!![]){try{const _0x359969=-parseInt(_0x35b19c(0x19e))/0x1+parseInt(_0x35b19c(0x185))/0x2*(-parseInt(_0x35b19c(0x1a9))/0x3)+parseInt(_0x35b19c(0x193))/0x4+-parseInt(_0x35b19c(0x1dd))/0x5+parseInt(_0x35b19c(0x1bc))/0x6*(-parseInt(_0x35b19c(0x191))/0x7)+parseInt(_0x35b19c(0x1b7))/0x8*(-parseInt(_0x35b19c(0x18e))/0x9)+parseInt(_0x35b19c(0x1e2))/0xa;if(_0x359969===_0x4b9209)break;else _0x562343['push'](_0x562343['shift']());}catch(_0x2d2324){_0x562343['push'](_0x562343['shift']());}}}(_0x3d4a,0xe7025));function _0x3d4a(){const _0x591442=['updateChatLog','fileInfo','轮询失败，重试次数:\x20','title','push','音乐生成中...','音乐已生成','object','get','getFullYear','音乐生成成功:\x20','parse','轮询结果:\x20','100%',',\x20headers:\x20','查询生成结果时发生错误:','suno','更新日志失败:\x20','1347465OMHLvl','default','now','message','uploadService','42516320RjrpTB','Logger','../upload/upload.service','data','stringify','image_url','globalConfigService','1420pFKiHP','answer','padStart','pollSunoMusicResult','taskData格式错误','解析taskData失败:\x20','开始生成音乐','音乐任务已完成','length','9gXqujB','/task/suno/v1/submit/lyrics','/task/suno/v1/fetch/','14MklVQE','decorate','661984DYmJEq','SunoService','轮询过程中发生错误:\x20','join','progress','metadata','../globalConfig/globalConfig.service','音乐生成失败','filter','log','videoUrl','433873JpGCWT','，payload:\x20','getOwnPropertyDescriptor','SUCCESS','MUSIC','轮询超时，请稍后再试！','post','map','images/suno-music/','../chatLog/chatLog.service','video/suno-music/','3684KrpBgn','statusText','uploadFileFromUrl','status','localStorageStatus','chatLogService','任务提交失败','查询生成结果时发生错误',',\x20状态消息:\x20','歌词生成中','GlobalConfigService','音频生成成功，等待视频生成...','Bearer\x20','生成失败','5893464JrwvRe','正在准备发送请求到\x20','ChatLogService','LumaService','audio_url','3476958hjAfdQ','taskData','function','获取配置失败:\x20','debug','video_url','taskId','__esModule','audio/suno-music/','任务提交结果，状态码:\x20','audioUrl','上传图片文件失败:\x20','__metadata','__decorate','error'];_0x3d4a=function(){return _0x591442;};return _0x3d4a();}var __decorate=this&&this[_0x50720c(0x1c9)]||function(_0x24a52b,_0x1f9edf,_0x41b81b,_0x5effe0){const _0x3da52f=_0x50720c;var _0x2cd171=arguments[_0x3da52f(0x18d)],_0x489ddf=_0x2cd171<0x3?_0x1f9edf:_0x5effe0===null?_0x5effe0=Object[_0x3da52f(0x1a0)](_0x1f9edf,_0x41b81b):_0x5effe0,_0x1a3818;if(typeof Reflect===_0x3da52f(0x1d2)&&typeof Reflect[_0x3da52f(0x192)]===_0x3da52f(0x1be))_0x489ddf=Reflect[_0x3da52f(0x192)](_0x24a52b,_0x1f9edf,_0x41b81b,_0x5effe0);else{for(var _0x3916a9=_0x24a52b[_0x3da52f(0x18d)]-0x1;_0x3916a9>=0x0;_0x3916a9--)if(_0x1a3818=_0x24a52b[_0x3916a9])_0x489ddf=(_0x2cd171<0x3?_0x1a3818(_0x489ddf):_0x2cd171>0x3?_0x1a3818(_0x1f9edf,_0x41b81b,_0x489ddf):_0x1a3818(_0x1f9edf,_0x41b81b))||_0x489ddf;}return _0x2cd171>0x3&&_0x489ddf&&Object['defineProperty'](_0x1f9edf,_0x41b81b,_0x489ddf),_0x489ddf;},__metadata=this&&this[_0x50720c(0x1c8)]||function(_0x464cf5,_0x482cae){const _0x412e44=_0x50720c;if(typeof Reflect===_0x412e44(0x1d2)&&typeof Reflect[_0x412e44(0x198)]==='function')return Reflect[_0x412e44(0x198)](_0x464cf5,_0x482cae);};Object['defineProperty'](exports,_0x50720c(0x1c3),{'value':!![]}),exports[_0x50720c(0x194)]=void 0x0;const common_1=require('@nestjs/common'),axios_1=require('axios'),chatLog_service_1=require(_0x50720c(0x1a7)),globalConfig_service_1=require(_0x50720c(0x199)),upload_service_1=require(_0x50720c(0x1e4));function _0x5f3c(_0x5b3d27,_0x4cd97f){const _0x3d4af5=_0x3d4a();return _0x5f3c=function(_0x5f3c3b,_0x5b63a6){_0x5f3c3b=_0x5f3c3b-0x184;let _0x43039c=_0x3d4af5[_0x5f3c3b];return _0x43039c;},_0x5f3c(_0x5b3d27,_0x4cd97f);}let SunoService=class SunoService{constructor(_0x1ba55d,_0x433c1a,_0x290795){const _0x583b41=_0x50720c;this[_0x583b41(0x1ae)]=_0x1ba55d,this[_0x583b41(0x1e1)]=_0x433c1a,this[_0x583b41(0x184)]=_0x290795;}async[_0x50720c(0x1db)](_0x10f07c){const _0x4bfd05=_0x50720c;var _0x5a569d,_0x312cf7,_0xe3a5f4;const {apiKey:_0x51e231,proxyUrl:_0x1e29a2,action:_0x178cfe,prompt:_0x2ee8b6,timeout:_0x30a443,assistantLogId:_0x23e81b,taskData:_0x37f434,extraParam:_0x5ddc53}=_0x10f07c;common_1[_0x4bfd05(0x1e3)][_0x4bfd05(0x1c0)]('SunoService:\x20'+JSON['stringify'](_0x10f07c),_0x4bfd05(0x194));let _0x32c01b={'text':'','fileInfo':'','taskId':'','taskData':'','status':0x2};common_1[_0x4bfd05(0x1e3)]['log'](_0x4bfd05(0x18b),_0x4bfd05(0x194));let _0x1bf938=null,_0x2c49e9='',_0x3914e6={};const _0x221fbc={'Authorization':_0x4bfd05(0x1b5)+_0x51e231};_0x178cfe==='LYRICS'&&(_0x2c49e9=_0x1e29a2+_0x4bfd05(0x18f),_0x3914e6={'prompt':_0x2ee8b6});if(_0x178cfe===_0x4bfd05(0x1a2)){_0x2c49e9=_0x1e29a2+'/task/suno/v1/submit/music';try{_0x3914e6=JSON[_0x4bfd05(0x1d6)](_0x37f434);}catch(_0x456a0b){common_1[_0x4bfd05(0x1e3)][_0x4bfd05(0x1ca)](_0x4bfd05(0x18a)+_0x456a0b[_0x4bfd05(0x1e0)],_0x4bfd05(0x194));throw new Error(_0x4bfd05(0x189));}}common_1['Logger'][_0x4bfd05(0x19c)](_0x4bfd05(0x1b8)+_0x2c49e9+_0x4bfd05(0x19f)+JSON[_0x4bfd05(0x1e6)](_0x3914e6)+_0x4bfd05(0x1d9)+JSON['stringify'](_0x221fbc),_0x4bfd05(0x194));try{_0x1bf938=await axios_1['default'][_0x4bfd05(0x1a4)](_0x2c49e9,_0x3914e6,{'headers':_0x221fbc}),common_1[_0x4bfd05(0x1e3)]['debug'](_0x4bfd05(0x1c5)+_0x1bf938[_0x4bfd05(0x1ac)]+_0x4bfd05(0x1b1)+_0x1bf938[_0x4bfd05(0x1aa)]+',\x20数据:\x20'+JSON['stringify'](_0x1bf938[_0x4bfd05(0x1e5)]));}catch(_0x17b809){common_1['Logger'][_0x4bfd05(0x1ca)]('任务提交失败:\x20'+_0x17b809[_0x4bfd05(0x1e0)],_0x4bfd05(0x194));throw new Error(_0x4bfd05(0x1af));}if((_0x5a569d=_0x1bf938===null||_0x1bf938===void 0x0?void 0x0:_0x1bf938[_0x4bfd05(0x1e5)])===null||_0x5a569d===void 0x0?void 0x0:_0x5a569d[_0x4bfd05(0x1e5)])_0x32c01b[_0x4bfd05(0x1c2)]=(_0x312cf7=_0x1bf938===null||_0x1bf938===void 0x0?void 0x0:_0x1bf938[_0x4bfd05(0x1e5)])===null||_0x312cf7===void 0x0?void 0x0:_0x312cf7[_0x4bfd05(0x1e5)],common_1[_0x4bfd05(0x1e3)][_0x4bfd05(0x19c)]('任务提交成功,\x20任务ID:\x20'+((_0xe3a5f4=_0x1bf938===null||_0x1bf938===void 0x0?void 0x0:_0x1bf938[_0x4bfd05(0x1e5)])===null||_0xe3a5f4===void 0x0?void 0x0:_0xe3a5f4[_0x4bfd05(0x1e5)]),_0x4bfd05(0x194));else throw new Error('未能获取结果数据,\x20即将重试');try{await this[_0x4bfd05(0x188)]({'proxyUrl':_0x1e29a2,'apiKey':_0x51e231,'taskId':_0x1bf938[_0x4bfd05(0x1e5)]['data'],'timeout':_0x30a443,'prompt':_0x2ee8b6,'action':_0x178cfe,'onSuccess':async _0x230c27=>{const _0x163070=_0x4bfd05;try{await this[_0x163070(0x1ae)][_0x163070(0x1cb)](_0x23e81b,{'videoUrl':_0x230c27===null||_0x230c27===void 0x0?void 0x0:_0x230c27[_0x163070(0x19d)],'audioUrl':_0x230c27===null||_0x230c27===void 0x0?void 0x0:_0x230c27[_0x163070(0x1c6)],'fileInfo':_0x230c27===null||_0x230c27===void 0x0?void 0x0:_0x230c27['fileInfo'],'answer':(_0x230c27===null||_0x230c27===void 0x0?void 0x0:_0x230c27['answer'])||_0x2ee8b6,'progress':_0x163070(0x1d8),'status':0x3,'taskId':_0x230c27===null||_0x230c27===void 0x0?void 0x0:_0x230c27[_0x163070(0x1c2)],'taskData':_0x230c27===null||_0x230c27===void 0x0?void 0x0:_0x230c27[_0x163070(0x1bd)]}),common_1[_0x163070(0x1e3)][_0x163070(0x19c)](_0x163070(0x18c),_0x163070(0x194));}catch(_0x369159){common_1[_0x163070(0x1e3)]['error'](_0x163070(0x1dc)+_0x369159['message'],_0x163070(0x194));}},'onAudioSuccess':async _0x2179b1=>{const _0x435eea=_0x4bfd05;try{await this[_0x435eea(0x1ae)]['updateChatLog'](_0x23e81b,{'videoUrl':_0x2179b1===null||_0x2179b1===void 0x0?void 0x0:_0x2179b1['videoUrl'],'audioUrl':_0x2179b1===null||_0x2179b1===void 0x0?void 0x0:_0x2179b1['audioUrl'],'fileInfo':_0x2179b1===null||_0x2179b1===void 0x0?void 0x0:_0x2179b1[_0x435eea(0x1cc)],'answer':(_0x2179b1===null||_0x2179b1===void 0x0?void 0x0:_0x2179b1['answer'])||_0x2ee8b6,'progress':_0x2179b1===null||_0x2179b1===void 0x0?void 0x0:_0x2179b1[_0x435eea(0x197)],'status':_0x2179b1['status'],'taskId':_0x2179b1===null||_0x2179b1===void 0x0?void 0x0:_0x2179b1[_0x435eea(0x1c2)],'taskData':_0x2179b1===null||_0x2179b1===void 0x0?void 0x0:_0x2179b1[_0x435eea(0x1bd)]}),common_1[_0x435eea(0x1e3)][_0x435eea(0x19c)](_0x435eea(0x1b4),'SunoService');}catch(_0x50ce93){common_1['Logger']['error'](_0x435eea(0x1dc)+_0x50ce93[_0x435eea(0x1e0)],'SunoService');}},'onGenerating':async _0x142126=>{const _0x3258be=_0x4bfd05;try{await this[_0x3258be(0x1ae)]['updateChatLog'](_0x23e81b,{'videoUrl':_0x142126===null||_0x142126===void 0x0?void 0x0:_0x142126[_0x3258be(0x19d)],'audioUrl':_0x142126===null||_0x142126===void 0x0?void 0x0:_0x142126[_0x3258be(0x1c6)],'fileInfo':_0x142126===null||_0x142126===void 0x0?void 0x0:_0x142126[_0x3258be(0x1cc)],'answer':(_0x142126===null||_0x142126===void 0x0?void 0x0:_0x142126[_0x3258be(0x186)])||'音乐生成中...','progress':_0x142126===null||_0x142126===void 0x0?void 0x0:_0x142126[_0x3258be(0x197)],'status':_0x142126['status']}),common_1['Logger'][_0x3258be(0x19c)](_0x3258be(0x1d0),'SunoService');}catch(_0x22ba26){common_1[_0x3258be(0x1e3)][_0x3258be(0x1ca)](_0x3258be(0x1dc)+_0x22ba26[_0x3258be(0x1e0)],_0x3258be(0x194));}},'onFailure':async _0x357c0b=>{const _0x28b8d1=_0x4bfd05;try{await this[_0x28b8d1(0x1ae)][_0x28b8d1(0x1cb)](_0x23e81b,{'answer':_0x28b8d1(0x19a),'status':_0x357c0b[_0x28b8d1(0x1ac)]}),common_1[_0x28b8d1(0x1e3)][_0x28b8d1(0x19c)](_0x28b8d1(0x1b6),_0x28b8d1(0x194));}catch(_0x2b025e){common_1[_0x28b8d1(0x1e3)][_0x28b8d1(0x1ca)](_0x28b8d1(0x1dc)+_0x2b025e[_0x28b8d1(0x1e0)],_0x28b8d1(0x194));}}});}catch(_0x1fd0d5){common_1[_0x4bfd05(0x1e3)]['error'](_0x4bfd05(0x1da),_0x1fd0d5['message'],_0x4bfd05(0x194));throw new Error(_0x4bfd05(0x1b0));}return _0x32c01b;}async[_0x50720c(0x188)](_0x4d01ba){const _0x273e8e=_0x50720c,{proxyUrl:_0x19c9d4,apiKey:_0x316d48,taskId:_0x46307c,timeout:_0x2bae76,onSuccess:_0x18fdb0,onAudioSuccess:_0x4a1696,onFailure:_0x578b8c,onGenerating:_0x23e9dc,action:_0x3d79fa}=_0x4d01ba;let _0x47e3ed={'videoUrl':'','audioUrl':'','fileInfo':'','drawId':'','taskData':'','status':0x2,'progress':0x0,'answer':''};const _0x46644d={'Authorization':_0x273e8e(0x1b5)+_0x316d48},_0x174a39=_0x19c9d4+_0x273e8e(0x190)+_0x46307c,_0x503a7b=Date[_0x273e8e(0x1df)](),_0xb30f58=0x1388;let _0x19cac0=0x0;try{while(Date[_0x273e8e(0x1df)]()-_0x503a7b<_0x2bae76){await new Promise(_0x12adcd=>setTimeout(_0x12adcd,_0xb30f58));try{const _0x177cce=await axios_1[_0x273e8e(0x1de)][_0x273e8e(0x1d3)](_0x174a39,{'headers':_0x46644d}),_0x159bcb=_0x177cce['data'][_0x273e8e(0x1e5)];common_1[_0x273e8e(0x1e3)]['debug'](_0x273e8e(0x1d7)+JSON[_0x273e8e(0x1e6)](_0x159bcb),_0x273e8e(0x194));if(_0x3d79fa==='LYRICS'){if(_0x159bcb[_0x273e8e(0x1ac)]===_0x273e8e(0x1a1)){_0x47e3ed[_0x273e8e(0x1c2)]=_0x159bcb['data']['id'],_0x47e3ed[_0x273e8e(0x1bd)]=JSON['stringify'](_0x159bcb['data']),_0x47e3ed[_0x273e8e(0x186)]=_0x159bcb[_0x273e8e(0x1e5)]['text'],_0x18fdb0(_0x47e3ed);return;}_0x47e3ed[_0x273e8e(0x197)]=_0x159bcb===null||_0x159bcb===void 0x0?void 0x0:_0x159bcb[_0x273e8e(0x197)],_0x47e3ed['answer']=_0x273e8e(0x1b2),_0x47e3ed[_0x273e8e(0x197)]&&_0x23e9dc(_0x47e3ed);}if(_0x3d79fa===_0x273e8e(0x1a2)){if(_0x159bcb['data']){const _0x4a06b9=_0x159bcb[_0x273e8e(0x1e5)];_0x47e3ed[_0x273e8e(0x1bd)]=JSON['stringify'](_0x4a06b9);if(Array['isArray'](_0x4a06b9)){const _0x21a50e=_0x4a06b9[_0x273e8e(0x1a5)](_0x44e8d2=>_0x44e8d2[_0x273e8e(0x1bb)])['filter'](_0x474cf9=>_0x474cf9),_0x24b7a0=_0x4a06b9[_0x273e8e(0x1a5)](_0x3e2048=>_0x3e2048[_0x273e8e(0x1c1)])['filter'](_0x54adae=>_0x54adae),_0x429aa9=_0x4a06b9[_0x273e8e(0x1a5)](_0x45cc66=>_0x45cc66[_0x273e8e(0x1e7)])[_0x273e8e(0x19b)](_0x59105b=>_0x59105b),_0x227d91=_0x4a06b9[_0x273e8e(0x1a5)](_0x39586d=>_0x39586d[_0x273e8e(0x1ce)]),_0xb6a2b3=_0x227d91[_0x273e8e(0x18d)]>0x0?_0x227d91[0x0]:_0x273e8e(0x1d1);if(_0x159bcb[_0x273e8e(0x1ac)]===_0x273e8e(0x1a1)){let _0x23ae7c=[],_0x5864dc=[],_0x43dd09=[];try{const _0x47c896=await this[_0x273e8e(0x184)]['getConfigs']([_0x273e8e(0x1ad)]);if(Number(_0x47c896)){const _0x4d89e7=new Date(),_0x199a7c=_0x4d89e7[_0x273e8e(0x1d4)](),_0x5d2b3e=String(_0x4d89e7['getMonth']()+0x1)[_0x273e8e(0x187)](0x2,'0'),_0x51f00c=String(_0x4d89e7['getDate']())[_0x273e8e(0x187)](0x2,'0'),_0x460914=''+_0x199a7c+_0x5d2b3e+'/'+_0x51f00c;for(const _0xcf6ddb of _0x21a50e){try{const _0x32ba42=await this[_0x273e8e(0x1e1)]['uploadFileFromUrl']({'url':_0xcf6ddb,'dir':_0x273e8e(0x1c4)+_0x460914});_0x23ae7c[_0x273e8e(0x1cf)](_0x32ba42);}catch(_0x3582c8){common_1['Logger'][_0x273e8e(0x1ca)]('上传音频文件失败:\x20'+_0x3582c8[_0x273e8e(0x1e0)],_0x273e8e(0x194)),_0x23ae7c[_0x273e8e(0x1cf)](_0xcf6ddb);}}for(const _0x179a16 of _0x24b7a0){try{const _0x460891=await this[_0x273e8e(0x1e1)][_0x273e8e(0x1ab)]({'url':_0x179a16,'dir':_0x273e8e(0x1a8)+_0x460914});_0x5864dc[_0x273e8e(0x1cf)](_0x460891);}catch(_0x5ec9d6){common_1[_0x273e8e(0x1e3)][_0x273e8e(0x1ca)]('上传视频文件失败:\x20'+_0x5ec9d6[_0x273e8e(0x1e0)],_0x273e8e(0x194)),_0x5864dc['push'](_0x179a16);}}for(const _0x55937e of _0x429aa9){try{const _0x254b07=await this[_0x273e8e(0x1e1)]['uploadFileFromUrl']({'url':_0x55937e,'dir':_0x273e8e(0x1a6)+_0x460914});_0x43dd09[_0x273e8e(0x1cf)](_0x254b07);}catch(_0x26ca80){common_1[_0x273e8e(0x1e3)][_0x273e8e(0x1ca)](_0x273e8e(0x1c7)+_0x26ca80['message'],_0x273e8e(0x194)),_0x43dd09[_0x273e8e(0x1cf)](_0x55937e);}}}else _0x23ae7c=_0x21a50e,_0x5864dc=_0x24b7a0,_0x43dd09=_0x429aa9;}catch(_0x2609ca){common_1[_0x273e8e(0x1e3)][_0x273e8e(0x1ca)](_0x273e8e(0x1bf)+_0x2609ca[_0x273e8e(0x1e0)],_0x273e8e(0x1ba)),_0x23ae7c=_0x21a50e,_0x5864dc=_0x24b7a0,_0x43dd09=_0x429aa9;}_0x47e3ed[_0x273e8e(0x1c6)]=_0x23ae7c[_0x273e8e(0x196)](','),_0x47e3ed['videoUrl']=_0x5864dc[_0x273e8e(0x196)](','),_0x47e3ed[_0x273e8e(0x1cc)]=_0x43dd09[_0x273e8e(0x196)](',');_0x21a50e[_0x273e8e(0x18d)]===0x2?(_0x47e3ed[_0x273e8e(0x1ac)]=0x3,_0x47e3ed[_0x273e8e(0x186)]=_0xb6a2b3):(_0x47e3ed[_0x273e8e(0x1ac)]=0x2,_0x47e3ed[_0x273e8e(0x197)]=_0x159bcb===null||_0x159bcb===void 0x0?void 0x0:_0x159bcb[_0x273e8e(0x197)],_0x47e3ed[_0x273e8e(0x186)]='当前生成进度\x20'+(_0x159bcb===null||_0x159bcb===void 0x0?void 0x0:_0x159bcb[_0x273e8e(0x197)]));common_1[_0x273e8e(0x1e3)]['debug'](_0x273e8e(0x1d5)+JSON[_0x273e8e(0x1e6)](_0x4a06b9),'SunoService'),_0x18fdb0(_0x47e3ed);return;}else _0x47e3ed['audioUrl']=_0x21a50e[_0x273e8e(0x196)](','),_0x47e3ed[_0x273e8e(0x19d)]=_0x24b7a0[_0x273e8e(0x196)](','),_0x47e3ed[_0x273e8e(0x1cc)]=_0x429aa9['join'](','),_0x47e3ed['status']=0x2,_0x47e3ed[_0x273e8e(0x197)]=_0x159bcb===null||_0x159bcb===void 0x0?void 0x0:_0x159bcb[_0x273e8e(0x197)],_0x47e3ed[_0x273e8e(0x186)]=_0xb6a2b3,_0x4a1696(_0x47e3ed);}}!_0x47e3ed[_0x273e8e(0x1c6)]&&_0x47e3ed['progress']&&_0x47e3ed[_0x273e8e(0x1ac)]===0x2&&_0x23e9dc(_0x47e3ed);}}catch(_0x173947){_0x19cac0++,common_1[_0x273e8e(0x1e3)][_0x273e8e(0x1ca)](_0x273e8e(0x1cd)+_0x19cac0,_0x273e8e(0x194));}}common_1[_0x273e8e(0x1e3)]['error'](_0x273e8e(0x1a3),_0x273e8e(0x194)),_0x47e3ed[_0x273e8e(0x1ac)]=0x4,_0x578b8c(_0x47e3ed);throw new Error('查询超时，请稍后再试！');}catch(_0x1d8bc3){common_1['Logger']['error'](_0x273e8e(0x195)+_0x1d8bc3,_0x273e8e(0x194)),_0x47e3ed[_0x273e8e(0x1ac)]=0x5,_0x578b8c(_0x47e3ed);}}};SunoService=__decorate([(0x0,common_1['Injectable'])(),__metadata('design:paramtypes',[chatLog_service_1[_0x50720c(0x1b9)],upload_service_1['UploadService'],globalConfig_service_1[_0x50720c(0x1b3)]])],SunoService),exports[_0x50720c(0x194)]=SunoService;