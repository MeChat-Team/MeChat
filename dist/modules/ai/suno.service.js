'use strict';function _0x3af4(){const _0x8eab11=['/task/suno/v1/fetch/','getOwnPropertyDescriptor','message','getMonth','audio_url','开始生成音乐','Logger','音乐已生成','video/suno-music/','error','taskData','audioUrl','24wyzBAP','__decorate','getFullYear','get','statusText','pollSunoMusicResult','default','filter','任务提交结果，状态码:\x20','push','parse','2224236CyAcTz','查询超时，请稍后再试！','__metadata','log','axios','@nestjs/common','生成失败','uploadService','未能获取结果数据,\x20即将重试','function','getConfigs','text','SunoService:\x20','169725hPgBAZ','decorate','35305090GPwyxv','audio/suno-music/','chatLogService','轮询超时，请稍后再试！','查询生成结果时发生错误:','../chatLog/chatLog.service','title','24FSDawU','轮询失败，重试次数:\x20','isArray','轮询过程中发生错误:\x20','获取配置失败:\x20','任务提交失败:\x20',',\x20状态消息:\x20','音乐生成成功:\x20','videoUrl','536221wPBjzY','stringify','音乐生成中...','../globalConfig/globalConfig.service','join','上传图片文件失败:\x20','data','updateChatLog','查询生成结果时发生错误','fileInfo','suno','defineProperty','design:paramtypes','status','uploadFileFromUrl','/task/suno/v1/submit/music','Bearer\x20','map','1594674mwYYXE','video_url','progress','，payload:\x20','更新日志失败:\x20','__esModule','11251312XUDPQL','object','globalConfigService',',\x20数据:\x20','ChatLogService','音乐生成失败','MUSIC','taskId','UploadService','debug','SunoService','音频生成成功，等待视频生成...','Injectable','任务提交失败','2vPOLRQ','4556436Whmwoh','上传视频文件失败:\x20','post','now','image_url','length','轮询结果:\x20','LYRICS','SUCCESS','images/suno-music/','localStorageStatus','../upload/upload.service','音乐任务已完成','answer','GlobalConfigService'];_0x3af4=function(){return _0x8eab11;};return _0x3af4();}const _0xc84e24=_0x4ef3;(function(_0x5744ab,_0x4ffa7b){const _0x413cc4=_0x4ef3,_0xa36f92=_0x5744ab();while(!![]){try{const _0x572680=parseInt(_0x413cc4(0x128))/0x1*(-parseInt(_0x413cc4(0x14e))/0x2)+-parseInt(_0x413cc4(0x14f))/0x3+parseInt(_0x413cc4(0x16a))/0x4*(-parseInt(_0x413cc4(0x116))/0x5)+parseInt(_0x413cc4(0x11f))/0x6*(parseInt(_0x413cc4(0x175))/0x7)+-parseInt(_0x413cc4(0x140))/0x8+-parseInt(_0x413cc4(0x13a))/0x9+parseInt(_0x413cc4(0x118))/0xa;if(_0x572680===_0x4ffa7b)break;else _0xa36f92['push'](_0xa36f92['shift']());}catch(_0x1c213c){_0xa36f92['push'](_0xa36f92['shift']());}}}(_0x3af4,0xea2de));var __decorate=this&&this[_0xc84e24(0x16b)]||function(_0x5bf810,_0x571302,_0x3f403d,_0x7e4874){const _0x3747a7=_0xc84e24;var _0x42548e=arguments[_0x3747a7(0x154)],_0x1d81ae=_0x42548e<0x3?_0x571302:_0x7e4874===null?_0x7e4874=Object[_0x3747a7(0x15f)](_0x571302,_0x3f403d):_0x7e4874,_0x2dc5ed;if(typeof Reflect==='object'&&typeof Reflect[_0x3747a7(0x117)]===_0x3747a7(0x17e))_0x1d81ae=Reflect[_0x3747a7(0x117)](_0x5bf810,_0x571302,_0x3f403d,_0x7e4874);else{for(var _0x57cf07=_0x5bf810[_0x3747a7(0x154)]-0x1;_0x57cf07>=0x0;_0x57cf07--)if(_0x2dc5ed=_0x5bf810[_0x57cf07])_0x1d81ae=(_0x42548e<0x3?_0x2dc5ed(_0x1d81ae):_0x42548e>0x3?_0x2dc5ed(_0x571302,_0x3f403d,_0x1d81ae):_0x2dc5ed(_0x571302,_0x3f403d))||_0x1d81ae;}return _0x42548e>0x3&&_0x1d81ae&&Object['defineProperty'](_0x571302,_0x3f403d,_0x1d81ae),_0x1d81ae;},__metadata=this&&this[_0xc84e24(0x177)]||function(_0x26555c,_0x286898){const _0x51ab95=_0xc84e24;if(typeof Reflect===_0x51ab95(0x141)&&typeof Reflect['metadata']==='function')return Reflect['metadata'](_0x26555c,_0x286898);};Object[_0xc84e24(0x133)](exports,_0xc84e24(0x13f),{'value':!![]}),exports[_0xc84e24(0x14a)]=void 0x0;const common_1=require(_0xc84e24(0x17a)),axios_1=require(_0xc84e24(0x179)),chatLog_service_1=require(_0xc84e24(0x11d)),globalConfig_service_1=require(_0xc84e24(0x12b)),upload_service_1=require(_0xc84e24(0x15a));function _0x4ef3(_0x62109b,_0x44aa3e){const _0x3af42f=_0x3af4();return _0x4ef3=function(_0x4ef3d9,_0x44c718){_0x4ef3d9=_0x4ef3d9-0x114;let _0x2e4907=_0x3af42f[_0x4ef3d9];return _0x2e4907;},_0x4ef3(_0x62109b,_0x44aa3e);}let SunoService=class SunoService{constructor(_0x362984,_0x53d07a,_0x79bcb2){const _0x18044c=_0xc84e24;this[_0x18044c(0x11a)]=_0x362984,this[_0x18044c(0x17c)]=_0x53d07a,this[_0x18044c(0x142)]=_0x79bcb2;}async[_0xc84e24(0x132)](_0x279bec){const _0x1ff129=_0xc84e24;var _0x1ba49b,_0x68db6a,_0x47d67e;const {apiKey:_0x46ba7d,proxyUrl:_0x3d0795,action:_0x19abbc,prompt:_0x332039,timeout:_0x2775fa,assistantLogId:_0x5c66a9,taskData:_0x53e0df,extraParam:_0x1fd9e5}=_0x279bec;common_1[_0x1ff129(0x164)][_0x1ff129(0x149)](_0x1ff129(0x115)+JSON[_0x1ff129(0x129)](_0x279bec),'SunoService');let _0x3c0c77={'text':'','fileInfo':'','taskId':'','taskData':'','status':0x2};common_1['Logger']['log'](_0x1ff129(0x163),_0x1ff129(0x14a));let _0x3fef58=null,_0x348c18='',_0x301806={};const _0xff3759={'Authorization':_0x1ff129(0x138)+_0x46ba7d};_0x19abbc===_0x1ff129(0x156)&&(_0x348c18=_0x3d0795+'/task/suno/v1/submit/lyrics',_0x301806={'prompt':_0x332039});if(_0x19abbc===_0x1ff129(0x146)){_0x348c18=_0x3d0795+_0x1ff129(0x137);try{_0x301806=JSON[_0x1ff129(0x174)](_0x53e0df);}catch(_0x204949){common_1[_0x1ff129(0x164)]['error']('解析taskData失败:\x20'+_0x204949[_0x1ff129(0x160)],_0x1ff129(0x14a));throw new Error('taskData格式错误');}}common_1[_0x1ff129(0x164)]['log']('正在准备发送请求到\x20'+_0x348c18+_0x1ff129(0x13d)+JSON['stringify'](_0x301806)+',\x20headers:\x20'+JSON[_0x1ff129(0x129)](_0xff3759),_0x1ff129(0x14a));try{_0x3fef58=await axios_1[_0x1ff129(0x170)][_0x1ff129(0x151)](_0x348c18,_0x301806,{'headers':_0xff3759}),common_1[_0x1ff129(0x164)][_0x1ff129(0x149)](_0x1ff129(0x172)+_0x3fef58[_0x1ff129(0x135)]+_0x1ff129(0x125)+_0x3fef58[_0x1ff129(0x16e)]+_0x1ff129(0x143)+JSON['stringify'](_0x3fef58[_0x1ff129(0x12e)]));}catch(_0x293c3a){common_1[_0x1ff129(0x164)][_0x1ff129(0x167)](_0x1ff129(0x124)+_0x293c3a[_0x1ff129(0x160)],_0x1ff129(0x14a));throw new Error(_0x1ff129(0x14d));}if((_0x1ba49b=_0x3fef58===null||_0x3fef58===void 0x0?void 0x0:_0x3fef58['data'])===null||_0x1ba49b===void 0x0?void 0x0:_0x1ba49b[_0x1ff129(0x12e)])_0x3c0c77[_0x1ff129(0x147)]=(_0x68db6a=_0x3fef58===null||_0x3fef58===void 0x0?void 0x0:_0x3fef58[_0x1ff129(0x12e)])===null||_0x68db6a===void 0x0?void 0x0:_0x68db6a[_0x1ff129(0x12e)],common_1[_0x1ff129(0x164)][_0x1ff129(0x178)]('任务提交成功,\x20任务ID:\x20'+((_0x47d67e=_0x3fef58===null||_0x3fef58===void 0x0?void 0x0:_0x3fef58[_0x1ff129(0x12e)])===null||_0x47d67e===void 0x0?void 0x0:_0x47d67e[_0x1ff129(0x12e)]),_0x1ff129(0x14a));else throw new Error(_0x1ff129(0x17d));try{await this['pollSunoMusicResult']({'proxyUrl':_0x3d0795,'apiKey':_0x46ba7d,'taskId':_0x3fef58[_0x1ff129(0x12e)][_0x1ff129(0x12e)],'timeout':_0x2775fa,'prompt':_0x332039,'action':_0x19abbc,'onSuccess':async _0xffe9ce=>{const _0x3af017=_0x1ff129;try{await this[_0x3af017(0x11a)][_0x3af017(0x12f)](_0x5c66a9,{'videoUrl':_0xffe9ce===null||_0xffe9ce===void 0x0?void 0x0:_0xffe9ce[_0x3af017(0x127)],'audioUrl':_0xffe9ce===null||_0xffe9ce===void 0x0?void 0x0:_0xffe9ce[_0x3af017(0x169)],'fileInfo':_0xffe9ce===null||_0xffe9ce===void 0x0?void 0x0:_0xffe9ce[_0x3af017(0x131)],'answer':(_0xffe9ce===null||_0xffe9ce===void 0x0?void 0x0:_0xffe9ce[_0x3af017(0x15c)])||_0x332039,'progress':'100%','status':0x3,'taskId':_0xffe9ce===null||_0xffe9ce===void 0x0?void 0x0:_0xffe9ce[_0x3af017(0x147)],'taskData':_0xffe9ce===null||_0xffe9ce===void 0x0?void 0x0:_0xffe9ce[_0x3af017(0x168)]}),common_1['Logger']['log'](_0x3af017(0x15b),_0x3af017(0x14a));}catch(_0x5ed085){common_1[_0x3af017(0x164)][_0x3af017(0x167)](_0x3af017(0x13e)+_0x5ed085[_0x3af017(0x160)],'SunoService');}},'onAudioSuccess':async _0x4ab05f=>{const _0x113027=_0x1ff129;try{await this[_0x113027(0x11a)][_0x113027(0x12f)](_0x5c66a9,{'videoUrl':_0x4ab05f===null||_0x4ab05f===void 0x0?void 0x0:_0x4ab05f[_0x113027(0x127)],'audioUrl':_0x4ab05f===null||_0x4ab05f===void 0x0?void 0x0:_0x4ab05f[_0x113027(0x169)],'fileInfo':_0x4ab05f===null||_0x4ab05f===void 0x0?void 0x0:_0x4ab05f[_0x113027(0x131)],'answer':(_0x4ab05f===null||_0x4ab05f===void 0x0?void 0x0:_0x4ab05f['answer'])||_0x332039,'progress':_0x4ab05f===null||_0x4ab05f===void 0x0?void 0x0:_0x4ab05f[_0x113027(0x13c)],'status':_0x4ab05f[_0x113027(0x135)],'taskId':_0x4ab05f===null||_0x4ab05f===void 0x0?void 0x0:_0x4ab05f['taskId'],'taskData':_0x4ab05f===null||_0x4ab05f===void 0x0?void 0x0:_0x4ab05f[_0x113027(0x168)]}),common_1[_0x113027(0x164)][_0x113027(0x178)](_0x113027(0x14b),_0x113027(0x14a));}catch(_0x29d45d){common_1[_0x113027(0x164)][_0x113027(0x167)](_0x113027(0x13e)+_0x29d45d['message'],_0x113027(0x14a));}},'onGenerating':async _0x1cd98a=>{const _0x5349fb=_0x1ff129;try{await this[_0x5349fb(0x11a)]['updateChatLog'](_0x5c66a9,{'videoUrl':_0x1cd98a===null||_0x1cd98a===void 0x0?void 0x0:_0x1cd98a[_0x5349fb(0x127)],'audioUrl':_0x1cd98a===null||_0x1cd98a===void 0x0?void 0x0:_0x1cd98a[_0x5349fb(0x169)],'fileInfo':_0x1cd98a===null||_0x1cd98a===void 0x0?void 0x0:_0x1cd98a['fileInfo'],'answer':(_0x1cd98a===null||_0x1cd98a===void 0x0?void 0x0:_0x1cd98a[_0x5349fb(0x15c)])||_0x5349fb(0x12a),'progress':_0x1cd98a===null||_0x1cd98a===void 0x0?void 0x0:_0x1cd98a['progress'],'status':_0x1cd98a[_0x5349fb(0x135)]}),common_1['Logger'][_0x5349fb(0x178)]('音乐生成中...',_0x5349fb(0x14a));}catch(_0x443e57){common_1[_0x5349fb(0x164)][_0x5349fb(0x167)]('更新日志失败:\x20'+_0x443e57[_0x5349fb(0x160)],_0x5349fb(0x14a));}},'onFailure':async _0x3f59b0=>{const _0x464b03=_0x1ff129;try{await this[_0x464b03(0x11a)][_0x464b03(0x12f)](_0x5c66a9,{'answer':_0x464b03(0x145),'status':_0x3f59b0[_0x464b03(0x135)]}),common_1[_0x464b03(0x164)][_0x464b03(0x178)](_0x464b03(0x17b),'SunoService');}catch(_0x5d52a7){common_1[_0x464b03(0x164)][_0x464b03(0x167)](_0x464b03(0x13e)+_0x5d52a7[_0x464b03(0x160)],_0x464b03(0x14a));}}});}catch(_0x13e63d){common_1[_0x1ff129(0x164)][_0x1ff129(0x167)](_0x1ff129(0x11c),_0x13e63d[_0x1ff129(0x160)],'SunoService');throw new Error(_0x1ff129(0x130));}return _0x3c0c77;}async[_0xc84e24(0x16f)](_0x2ac740){const _0x4b17f6=_0xc84e24,{proxyUrl:_0x496232,apiKey:_0x3d690d,taskId:_0x56e309,timeout:_0x30abc2,onSuccess:_0x3cf21a,onAudioSuccess:_0x43921a,onFailure:_0x174c33,onGenerating:_0x1e448c,action:_0x2fc0cf}=_0x2ac740;let _0x4262ee={'videoUrl':'','audioUrl':'','fileInfo':'','drawId':'','taskData':'','status':0x2,'progress':0x0,'answer':''};const _0x294df9={'Authorization':_0x4b17f6(0x138)+_0x3d690d},_0x5c9f10=_0x496232+_0x4b17f6(0x15e)+_0x56e309,_0x100db1=Date[_0x4b17f6(0x152)](),_0x1e26ce=0x1388;let _0x441f30=0x0;try{while(Date[_0x4b17f6(0x152)]()-_0x100db1<_0x30abc2){await new Promise(_0x257179=>setTimeout(_0x257179,_0x1e26ce));try{const _0x367f6b=await axios_1[_0x4b17f6(0x170)][_0x4b17f6(0x16d)](_0x5c9f10,{'headers':_0x294df9}),_0x49b607=_0x367f6b[_0x4b17f6(0x12e)][_0x4b17f6(0x12e)];common_1['Logger'][_0x4b17f6(0x149)](_0x4b17f6(0x155)+JSON[_0x4b17f6(0x129)](_0x49b607),_0x4b17f6(0x14a));if(_0x2fc0cf===_0x4b17f6(0x156)){if(_0x49b607['status']===_0x4b17f6(0x157)){_0x4262ee[_0x4b17f6(0x147)]=_0x49b607[_0x4b17f6(0x12e)]['id'],_0x4262ee[_0x4b17f6(0x168)]=JSON[_0x4b17f6(0x129)](_0x49b607[_0x4b17f6(0x12e)]),_0x4262ee['answer']=_0x49b607[_0x4b17f6(0x12e)][_0x4b17f6(0x114)],_0x3cf21a(_0x4262ee);return;}_0x4262ee[_0x4b17f6(0x13c)]=_0x49b607===null||_0x49b607===void 0x0?void 0x0:_0x49b607[_0x4b17f6(0x13c)],_0x4262ee[_0x4b17f6(0x15c)]='歌词生成中',_0x4262ee[_0x4b17f6(0x13c)]&&_0x1e448c(_0x4262ee);}if(_0x2fc0cf===_0x4b17f6(0x146)){if(_0x49b607['data']){const _0x5ec674=_0x49b607[_0x4b17f6(0x12e)];_0x4262ee['taskData']=JSON[_0x4b17f6(0x129)](_0x5ec674);if(Array[_0x4b17f6(0x121)](_0x5ec674)){const _0x1039b1=_0x5ec674[_0x4b17f6(0x139)](_0x1038de=>_0x1038de[_0x4b17f6(0x162)])[_0x4b17f6(0x171)](_0x24627b=>_0x24627b),_0x3a7325=_0x5ec674['map'](_0xb741b1=>_0xb741b1[_0x4b17f6(0x13b)])[_0x4b17f6(0x171)](_0x273a75=>_0x273a75),_0x396bc4=_0x5ec674['map'](_0x42e19d=>_0x42e19d[_0x4b17f6(0x153)])[_0x4b17f6(0x171)](_0x4a6270=>_0x4a6270),_0x33ab0a=_0x5ec674['map'](_0x4e4b31=>_0x4e4b31[_0x4b17f6(0x11e)]),_0x14cf9e=_0x33ab0a['length']>0x0?_0x33ab0a[0x0]:_0x4b17f6(0x165);if(_0x49b607[_0x4b17f6(0x135)]===_0x4b17f6(0x157)){let _0x4af7fa=[],_0x473943=[],_0x214c50=[];try{const _0x995f2b=await this[_0x4b17f6(0x142)][_0x4b17f6(0x17f)]([_0x4b17f6(0x159)]);if(Number(_0x995f2b)){const _0x2cf89c=new Date(),_0x288a49=_0x2cf89c[_0x4b17f6(0x16c)](),_0x4855b0=String(_0x2cf89c[_0x4b17f6(0x161)]()+0x1)['padStart'](0x2,'0'),_0x23dde0=String(_0x2cf89c['getDate']())['padStart'](0x2,'0'),_0x582423=''+_0x288a49+_0x4855b0+'/'+_0x23dde0;for(const _0x31b7ee of _0x1039b1){try{const _0x575cc1=await this[_0x4b17f6(0x17c)][_0x4b17f6(0x136)]({'url':_0x31b7ee,'dir':_0x4b17f6(0x119)+_0x582423});_0x4af7fa[_0x4b17f6(0x173)](_0x575cc1);}catch(_0xc7d83d){common_1['Logger'][_0x4b17f6(0x167)]('上传音频文件失败:\x20'+_0xc7d83d[_0x4b17f6(0x160)],'SunoService'),_0x4af7fa[_0x4b17f6(0x173)](_0x31b7ee);}}for(const _0x1ee49a of _0x3a7325){try{const _0x47f0af=await this[_0x4b17f6(0x17c)][_0x4b17f6(0x136)]({'url':_0x1ee49a,'dir':_0x4b17f6(0x166)+_0x582423});_0x473943[_0x4b17f6(0x173)](_0x47f0af);}catch(_0x1e5659){common_1['Logger'][_0x4b17f6(0x167)](_0x4b17f6(0x150)+_0x1e5659[_0x4b17f6(0x160)],'SunoService'),_0x473943[_0x4b17f6(0x173)](_0x1ee49a);}}for(const _0x197fca of _0x396bc4){try{const _0x535e39=await this[_0x4b17f6(0x17c)]['uploadFileFromUrl']({'url':_0x197fca,'dir':_0x4b17f6(0x158)+_0x582423});_0x214c50[_0x4b17f6(0x173)](_0x535e39);}catch(_0x559abf){common_1[_0x4b17f6(0x164)]['error'](_0x4b17f6(0x12d)+_0x559abf['message'],'SunoService'),_0x214c50[_0x4b17f6(0x173)](_0x197fca);}}}else _0x4af7fa=_0x1039b1,_0x473943=_0x3a7325,_0x214c50=_0x396bc4;}catch(_0x563f5b){common_1[_0x4b17f6(0x164)][_0x4b17f6(0x167)](_0x4b17f6(0x123)+_0x563f5b[_0x4b17f6(0x160)],'LumaService'),_0x4af7fa=_0x1039b1,_0x473943=_0x3a7325,_0x214c50=_0x396bc4;}_0x4262ee['audioUrl']=_0x4af7fa['join'](','),_0x4262ee[_0x4b17f6(0x127)]=_0x473943[_0x4b17f6(0x12c)](','),_0x4262ee[_0x4b17f6(0x131)]=_0x214c50[_0x4b17f6(0x12c)](',');_0x1039b1[_0x4b17f6(0x154)]===0x2?(_0x4262ee[_0x4b17f6(0x135)]=0x3,_0x4262ee[_0x4b17f6(0x15c)]=_0x14cf9e):(_0x4262ee[_0x4b17f6(0x135)]=0x2,_0x4262ee[_0x4b17f6(0x13c)]=_0x49b607===null||_0x49b607===void 0x0?void 0x0:_0x49b607[_0x4b17f6(0x13c)],_0x4262ee['answer']='当前生成进度\x20'+(_0x49b607===null||_0x49b607===void 0x0?void 0x0:_0x49b607[_0x4b17f6(0x13c)]));common_1[_0x4b17f6(0x164)][_0x4b17f6(0x149)](_0x4b17f6(0x126)+JSON['stringify'](_0x5ec674),_0x4b17f6(0x14a)),_0x3cf21a(_0x4262ee);return;}else _0x4262ee[_0x4b17f6(0x169)]=_0x1039b1[_0x4b17f6(0x12c)](','),_0x4262ee[_0x4b17f6(0x127)]=_0x3a7325['join'](','),_0x4262ee[_0x4b17f6(0x131)]=_0x396bc4[_0x4b17f6(0x12c)](','),_0x4262ee[_0x4b17f6(0x135)]=0x2,_0x4262ee[_0x4b17f6(0x13c)]=_0x49b607===null||_0x49b607===void 0x0?void 0x0:_0x49b607['progress'],_0x4262ee[_0x4b17f6(0x15c)]=_0x14cf9e,_0x43921a(_0x4262ee);}}!_0x4262ee[_0x4b17f6(0x169)]&&_0x4262ee[_0x4b17f6(0x13c)]&&_0x4262ee[_0x4b17f6(0x135)]===0x2&&_0x1e448c(_0x4262ee);}}catch(_0xa14de3){_0x441f30++,common_1[_0x4b17f6(0x164)][_0x4b17f6(0x167)](_0x4b17f6(0x120)+_0x441f30,_0x4b17f6(0x14a));}}common_1[_0x4b17f6(0x164)][_0x4b17f6(0x167)](_0x4b17f6(0x11b),_0x4b17f6(0x14a)),_0x4262ee[_0x4b17f6(0x135)]=0x4,_0x174c33(_0x4262ee);throw new Error(_0x4b17f6(0x176));}catch(_0x5caede){common_1[_0x4b17f6(0x164)]['error'](_0x4b17f6(0x122)+_0x5caede,_0x4b17f6(0x14a)),_0x4262ee[_0x4b17f6(0x135)]=0x5,_0x174c33(_0x4262ee);}}};SunoService=__decorate([(0x0,common_1[_0xc84e24(0x14c)])(),__metadata(_0xc84e24(0x134),[chatLog_service_1[_0xc84e24(0x144)],upload_service_1[_0xc84e24(0x148)],globalConfig_service_1[_0xc84e24(0x15d)]])],SunoService),exports['SunoService']=SunoService;