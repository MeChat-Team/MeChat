'use strict';const _0x581c2a=_0x4a23;(function(_0x10cdf6,_0x48aeda){const _0x52faa2=_0x4a23,_0x5b4c4b=_0x10cdf6();while(!![]){try{const _0x4eaa2a=parseInt(_0x52faa2(0x1d9))/0x1*(parseInt(_0x52faa2(0x1d0))/0x2)+-parseInt(_0x52faa2(0x1f5))/0x3+parseInt(_0x52faa2(0x1f8))/0x4+-parseInt(_0x52faa2(0x213))/0x5+-parseInt(_0x52faa2(0x1fe))/0x6+-parseInt(_0x52faa2(0x1d1))/0x7+parseInt(_0x52faa2(0x1d2))/0x8*(parseInt(_0x52faa2(0x222))/0x9);if(_0x4eaa2a===_0x48aeda)break;else _0x5b4c4b['push'](_0x5b4c4b['shift']());}catch(_0x5eac6e){_0x5b4c4b['push'](_0x5b4c4b['shift']());}}}(_0x1cc2,0xe7824));var __decorate=this&&this['__decorate']||function(_0x26396d,_0x5d7570,_0x155c63,_0xb43983){const _0x488cc1=_0x4a23;var _0x37b13d=arguments[_0x488cc1(0x1f9)],_0x199f87=_0x37b13d<0x3?_0x5d7570:_0xb43983===null?_0xb43983=Object['getOwnPropertyDescriptor'](_0x5d7570,_0x155c63):_0xb43983,_0x49bbaf;if(typeof Reflect===_0x488cc1(0x1ee)&&typeof Reflect[_0x488cc1(0x1f4)]===_0x488cc1(0x1e8))_0x199f87=Reflect['decorate'](_0x26396d,_0x5d7570,_0x155c63,_0xb43983);else{for(var _0xb88c8d=_0x26396d[_0x488cc1(0x1f9)]-0x1;_0xb88c8d>=0x0;_0xb88c8d--)if(_0x49bbaf=_0x26396d[_0xb88c8d])_0x199f87=(_0x37b13d<0x3?_0x49bbaf(_0x199f87):_0x37b13d>0x3?_0x49bbaf(_0x5d7570,_0x155c63,_0x199f87):_0x49bbaf(_0x5d7570,_0x155c63))||_0x199f87;}return _0x37b13d>0x3&&_0x199f87&&Object[_0x488cc1(0x1da)](_0x5d7570,_0x155c63,_0x199f87),_0x199f87;},__metadata=this&&this[_0x581c2a(0x201)]||function(_0x4692df,_0x4c8ba0){const _0x10d7c0=_0x581c2a;if(typeof Reflect===_0x10d7c0(0x1ee)&&typeof Reflect['metadata']===_0x10d7c0(0x1e8))return Reflect[_0x10d7c0(0x21c)](_0x4692df,_0x4c8ba0);};Object[_0x581c2a(0x1da)](exports,_0x581c2a(0x1d8),{'value':!![]}),exports[_0x581c2a(0x1dd)]=void 0x0;const common_1=require(_0x581c2a(0x1d7)),axios_1=require('axios'),chatLog_service_1=require('../chatLog/chatLog.service'),globalConfig_service_1=require(_0x581c2a(0x228)),upload_service_1=require(_0x581c2a(0x20c));let CogVideoService=class CogVideoService{constructor(_0x2d8d14,_0x1b433e,_0x33c30d){const _0x7e96f1=_0x581c2a;this['chatLogService']=_0x2d8d14,this[_0x7e96f1(0x1f7)]=_0x1b433e,this[_0x7e96f1(0x212)]=_0x33c30d;}async[_0x581c2a(0x227)](_0x4b6ffa){const _0x279019=_0x581c2a;var _0x2a05d9,_0x311ea0,_0x30f09d;const {apiKey:_0x858ff6,proxyUrl:_0x58e025,fileInfo:_0x4645f3,prompt:_0x5c7b4f,timeout:_0x1beb33,assistantLogId:_0x479699}=_0x4b6ffa;let _0x4796d3={'text':'','fileInfo':'','taskId':'','taskData':'','status':0x2},_0x35b2ca=null,_0x31fca4='',_0x3f4313={};const _0x4c002d={'Authorization':_0x279019(0x214)+_0x858ff6};_0x31fca4=_0x58e025+_0x279019(0x215),_0x3f4313={'model':'cogvideox','prompt':_0x5c7b4f};_0x4645f3&&(_0x3f4313[_0x279019(0x224)]=_0x4645f3);common_1[_0x279019(0x1ea)]['log'](_0x279019(0x1ed)+_0x31fca4+_0x279019(0x1e7)+JSON[_0x279019(0x221)](_0x3f4313)+_0x279019(0x1e0)+JSON[_0x279019(0x221)](_0x4c002d),'CogService');try{_0x35b2ca=await axios_1['default'][_0x279019(0x210)](_0x31fca4,_0x3f4313,{'headers':_0x4c002d}),common_1[_0x279019(0x1ea)][_0x279019(0x208)]('任务提交结果，状态码:\x20'+_0x35b2ca[_0x279019(0x1de)]+',\x20状态消息:\x20'+_0x35b2ca[_0x279019(0x1f2)]+_0x279019(0x202)+JSON[_0x279019(0x221)](_0x35b2ca[_0x279019(0x1d6)]));}catch(_0x255838){common_1[_0x279019(0x1ea)][_0x279019(0x1e5)](_0x279019(0x1fd)+_0x255838[_0x279019(0x1ef)],'CogService');throw new Error(_0x279019(0x1f6));}if((_0x2a05d9=_0x35b2ca===null||_0x35b2ca===void 0x0?void 0x0:_0x35b2ca[_0x279019(0x1d6)])===null||_0x2a05d9===void 0x0?void 0x0:_0x2a05d9['id'])_0x4796d3[_0x279019(0x200)]=(_0x311ea0=_0x35b2ca===null||_0x35b2ca===void 0x0?void 0x0:_0x35b2ca[_0x279019(0x1d6)])===null||_0x311ea0===void 0x0?void 0x0:_0x311ea0['id'],common_1[_0x279019(0x1ea)][_0x279019(0x218)](_0x279019(0x206)+((_0x30f09d=_0x35b2ca===null||_0x35b2ca===void 0x0?void 0x0:_0x35b2ca[_0x279019(0x1d6)])===null||_0x30f09d===void 0x0?void 0x0:_0x30f09d['id']),_0x279019(0x20a));else throw new Error(_0x279019(0x20d));try{await this[_0x279019(0x1d3)]({'proxyUrl':_0x58e025,'apiKey':_0x858ff6,'taskId':_0x35b2ca['data']['id'],'timeout':_0x1beb33,'prompt':_0x5c7b4f,'onSuccess':async _0x5c9d56=>{const _0x101cdf=_0x279019;try{await this[_0x101cdf(0x21f)][_0x101cdf(0x1dc)](_0x479699,{'videoUrl':_0x5c9d56===null||_0x5c9d56===void 0x0?void 0x0:_0x5c9d56[_0x101cdf(0x1e1)],'audioUrl':_0x5c9d56===null||_0x5c9d56===void 0x0?void 0x0:_0x5c9d56[_0x101cdf(0x21d)],'fileInfo':_0x5c9d56===null||_0x5c9d56===void 0x0?void 0x0:_0x5c9d56[_0x101cdf(0x1e3)],'answer':(_0x5c9d56===null||_0x5c9d56===void 0x0?void 0x0:_0x5c9d56['answer'])||_0x5c7b4f,'progress':'100%','status':0x3,'taskId':_0x5c9d56===null||_0x5c9d56===void 0x0?void 0x0:_0x5c9d56[_0x101cdf(0x200)],'taskData':_0x5c9d56===null||_0x5c9d56===void 0x0?void 0x0:_0x5c9d56[_0x101cdf(0x1ff)]}),common_1[_0x101cdf(0x1ea)][_0x101cdf(0x218)]('视频任务已完成',_0x101cdf(0x20a));}catch(_0x1b7117){common_1[_0x101cdf(0x1ea)]['error'](_0x101cdf(0x1e6)+_0x1b7117[_0x101cdf(0x1ef)],_0x101cdf(0x20a));}},'onGenerating':async _0x314b8f=>{const _0x3f7b34=_0x279019;try{await this[_0x3f7b34(0x21f)][_0x3f7b34(0x1dc)](_0x479699,{'videoUrl':_0x314b8f===null||_0x314b8f===void 0x0?void 0x0:_0x314b8f[_0x3f7b34(0x1e1)],'audioUrl':_0x314b8f===null||_0x314b8f===void 0x0?void 0x0:_0x314b8f[_0x3f7b34(0x21d)],'fileInfo':_0x314b8f===null||_0x314b8f===void 0x0?void 0x0:_0x314b8f[_0x3f7b34(0x1e3)],'answer':(_0x314b8f===null||_0x314b8f===void 0x0?void 0x0:_0x314b8f[_0x3f7b34(0x21b)])||_0x3f7b34(0x1d5),'progress':_0x314b8f===null||_0x314b8f===void 0x0?void 0x0:_0x314b8f[_0x3f7b34(0x1fa)],'status':_0x314b8f[_0x3f7b34(0x1de)]}),common_1[_0x3f7b34(0x1ea)][_0x3f7b34(0x218)]('视频生成中...','CogService');}catch(_0x4629fc){common_1[_0x3f7b34(0x1ea)][_0x3f7b34(0x1e5)](_0x3f7b34(0x1e6)+_0x4629fc[_0x3f7b34(0x1ef)],_0x3f7b34(0x20a));}},'onFailure':async _0x540973=>{const _0x269e1e=_0x279019;try{await this[_0x269e1e(0x21f)][_0x269e1e(0x1dc)](_0x479699,{'answer':_0x269e1e(0x1ec),'status':_0x540973[_0x269e1e(0x1de)]}),common_1[_0x269e1e(0x1ea)][_0x269e1e(0x218)](_0x269e1e(0x1df),_0x269e1e(0x226));}catch(_0x446c6c){common_1['Logger'][_0x269e1e(0x1e5)](_0x269e1e(0x1e6)+_0x446c6c[_0x269e1e(0x1ef)],_0x269e1e(0x20a));}}});}catch(_0x5ca381){common_1[_0x279019(0x1ea)][_0x279019(0x1e5)](_0x279019(0x1f1),_0x5ca381[_0x279019(0x1ef)],_0x279019(0x20a));throw new Error(_0x279019(0x21a));}return _0x4796d3;}async['pollCogVideoResult'](_0x237594){const _0x26e917=_0x581c2a,{proxyUrl:_0xb9f0df,apiKey:_0x2f30db,taskId:_0x266a18,timeout:_0xb7407e,onSuccess:_0x19bfa1,onFailure:_0x260858,onGenerating:_0x951757,prompt:_0x2378cc,action:_0x3edbe2}=_0x237594;let _0x51876b={'videoUrl':'','audioUrl':'','fileInfo':'','drawId':'','taskData':'','status':0x2,'progress':0x0,'answer':''};const _0x61ef86={'Authorization':_0x26e917(0x214)+_0x2f30db},_0x35ed7d=_0xb9f0df+_0x26e917(0x1eb)+_0x266a18,_0x33e738=Date[_0x26e917(0x220)](),_0x1859c4=0x493e0,_0x374543=0x1388;let _0x7c098f=0x0;try{while(Date[_0x26e917(0x220)]()-_0x33e738<_0xb7407e){await new Promise(_0x1ceb2e=>setTimeout(_0x1ceb2e,_0x374543));try{const _0x485814=await axios_1[_0x26e917(0x209)][_0x26e917(0x1e2)](_0x35ed7d,{'headers':_0x61ef86}),_0x498849=setInterval(()=>{const _0x454aa6=_0x26e917,_0x4a4941=Date[_0x454aa6(0x220)]()-_0x33e738;let _0x465725=Math[_0x454aa6(0x225)](_0x4a4941/_0x1859c4*0x64);if(_0x465725>=0x63)_0x465725=0x63;_0x51876b[_0x454aa6(0x21b)]=_0x454aa6(0x1e9)+_0x465725+'%）';},0x3e8),_0x50dd3d=_0x485814[_0x26e917(0x1d6)];common_1[_0x26e917(0x1ea)][_0x26e917(0x208)]('轮询结果:\x20'+JSON['stringify'](_0x50dd3d),_0x26e917(0x20a));if(_0x50dd3d[_0x26e917(0x1db)]===_0x26e917(0x217)){_0x51876b[_0x26e917(0x200)]=_0x50dd3d[_0x26e917(0x21e)],_0x51876b[_0x26e917(0x1ff)]=JSON[_0x26e917(0x221)](_0x50dd3d),common_1[_0x26e917(0x1ea)]['log'](_0x26e917(0x1cf),_0x26e917(0x20a)),_0x51876b[_0x26e917(0x1e3)]=_0x50dd3d[_0x26e917(0x1fb)][0x0][_0x26e917(0x205)],common_1[_0x26e917(0x1ea)][_0x26e917(0x218)](_0x51876b[_0x26e917(0x1e3)],_0x26e917(0x20a));try{const _0x967d18=await this[_0x26e917(0x1f7)][_0x26e917(0x203)]([_0x26e917(0x1d4)]);if(Number(_0x967d18)){const _0x1da3aa=new Date(),_0x8a1a98=_0x1da3aa[_0x26e917(0x20f)](),_0x36e1aa=String(_0x1da3aa[_0x26e917(0x1f3)]()+0x1)['padStart'](0x2,'0'),_0x20254a=String(_0x1da3aa[_0x26e917(0x207)]())[_0x26e917(0x211)](0x2,'0'),_0x31fe89=''+_0x8a1a98+_0x36e1aa+'/'+_0x20254a;_0x51876b[_0x26e917(0x1e3)]=await this[_0x26e917(0x212)][_0x26e917(0x20b)]({'url':_0x50dd3d['video_result'][0x0][_0x26e917(0x205)],'dir':_0x26e917(0x20e)+_0x31fe89});}}catch(_0x1ae111){common_1['Logger']['error'](_0x26e917(0x216)+_0x1ae111['message'],_0x26e917(0x20a));}_0x51876b[_0x26e917(0x21b)]='提示词:\x20\x22'+_0x2378cc+'\x22',_0x19bfa1(_0x51876b),clearInterval(_0x498849);return;}else _0x951757(_0x51876b);if(_0x51876b[_0x26e917(0x1fa)]){}}catch(_0x5c1582){_0x7c098f++,common_1['Logger']['error'](_0x26e917(0x1fc)+_0x7c098f,_0x26e917(0x20a));}}common_1[_0x26e917(0x1ea)][_0x26e917(0x1e5)](_0x26e917(0x219),'CogService'),_0x51876b[_0x26e917(0x1de)]=0x4,_0x260858(_0x51876b);throw new Error(_0x26e917(0x204));}catch(_0x4983ed){common_1[_0x26e917(0x1ea)][_0x26e917(0x1e5)]('轮询过程中发生错误:\x20'+_0x4983ed,_0x26e917(0x20a)),_0x51876b['status']=0x5,_0x260858(_0x51876b);}}};function _0x4a23(_0x3e8179,_0x55ceee){const _0x1cc2ed=_0x1cc2();return _0x4a23=function(_0x4a23a9,_0x3e2ca9){_0x4a23a9=_0x4a23a9-0x1cf;let _0x2dd337=_0x1cc2ed[_0x4a23a9];return _0x2dd337;},_0x4a23(_0x3e8179,_0x55ceee);}function _0x1cc2(){const _0xf673ee=['视频生成中...','data','@nestjs/common','__esModule','203991LaoANl','defineProperty','task_status','updateChatLog','CogVideoService','status','生成失败',',\x20headers:\x20','videoUrl','get','fileInfo','ChatLogService','error','更新日志失败:\x20','，payload:\x20','function','视频生成中\x20（','Logger','/cogvideox/v4/async-result/','视频生成失败','正在准备发送请求到\x20','object','message','UploadService','查询生成结果时发生错误:','statusText','getMonth','decorate','5418189FuYEVw','任务提交失败','globalConfigService','6107740hITohz','length','progress','video_result','轮询失败，重试次数:\x20','任务提交失败:\x20','2196132VIvsbO','taskData','taskId','__metadata',',\x20数据:\x20','getConfigs','查询超时，请稍后再试！','url','任务提交成功,\x20任务ID:\x20','getDate','debug','default','CogService','uploadFileFromUrl','../upload/upload.service','未能获取结果数据,\x20即将重试','video/cog/','getFullYear','post','padStart','uploadService','8687950wXkaij','Bearer\x20','/cogvideox/v4/videos/generations','上传文件失败:\x20','SUCCESS','log','轮询超时，请稍后再试！','查询生成结果时发生错误','answer','metadata','audioUrl','request_id','chatLogService','now','stringify','23517htRTmL','design:paramtypes','image_url','floor','Lum\x20aService','cogVideo','../globalConfig/globalConfig.service','视频生成成功','18bVYAzg','5575640GvGMSP','7016SzOUKi','pollCogVideoResult','localStorageStatus'];_0x1cc2=function(){return _0xf673ee;};return _0x1cc2();}CogVideoService=__decorate([(0x0,common_1['Injectable'])(),__metadata(_0x581c2a(0x223),[chatLog_service_1[_0x581c2a(0x1e4)],globalConfig_service_1['GlobalConfigService'],upload_service_1[_0x581c2a(0x1f0)]])],CogVideoService),exports[_0x581c2a(0x1dd)]=CogVideoService;