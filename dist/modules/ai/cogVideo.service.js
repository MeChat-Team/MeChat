'use strict';const _0x4df08c=_0x258a;(function(_0x24d210,_0x14084b){const _0x74c2ee=_0x258a,_0x24be5e=_0x24d210();while(!![]){try{const _0x78eedc=-parseInt(_0x74c2ee(0xcf))/0x1*(parseInt(_0x74c2ee(0xe6))/0x2)+-parseInt(_0x74c2ee(0xfd))/0x3*(-parseInt(_0x74c2ee(0xcd))/0x4)+-parseInt(_0x74c2ee(0x103))/0x5+-parseInt(_0x74c2ee(0xd8))/0x6*(-parseInt(_0x74c2ee(0xe1))/0x7)+-parseInt(_0x74c2ee(0xcc))/0x8+parseInt(_0x74c2ee(0xc1))/0x9+-parseInt(_0x74c2ee(0xc3))/0xa*(-parseInt(_0x74c2ee(0x115))/0xb);if(_0x78eedc===_0x14084b)break;else _0x24be5e['push'](_0x24be5e['shift']());}catch(_0x249158){_0x24be5e['push'](_0x24be5e['shift']());}}}(_0x4a3d,0xb1d26));function _0x258a(_0x13646e,_0x3cc6d2){const _0x4a3de3=_0x4a3d();return _0x258a=function(_0x258a4c,_0x470def){_0x258a4c=_0x258a4c-0xbd;let _0x58cd60=_0x4a3de3[_0x258a4c];return _0x58cd60;},_0x258a(_0x13646e,_0x3cc6d2);}var __decorate=this&&this[_0x4df08c(0xec)]||function(_0x5cf1bd,_0x4da032,_0x82ce85,_0x34d4c6){const _0x2976f9=_0x4df08c;var _0x53953b=arguments['length'],_0x10054c=_0x53953b<0x3?_0x4da032:_0x34d4c6===null?_0x34d4c6=Object[_0x2976f9(0xd6)](_0x4da032,_0x82ce85):_0x34d4c6,_0xa4c9c8;if(typeof Reflect==='object'&&typeof Reflect['decorate']===_0x2976f9(0xce))_0x10054c=Reflect[_0x2976f9(0xda)](_0x5cf1bd,_0x4da032,_0x82ce85,_0x34d4c6);else{for(var _0x4ea0aa=_0x5cf1bd['length']-0x1;_0x4ea0aa>=0x0;_0x4ea0aa--)if(_0xa4c9c8=_0x5cf1bd[_0x4ea0aa])_0x10054c=(_0x53953b<0x3?_0xa4c9c8(_0x10054c):_0x53953b>0x3?_0xa4c9c8(_0x4da032,_0x82ce85,_0x10054c):_0xa4c9c8(_0x4da032,_0x82ce85))||_0x10054c;}return _0x53953b>0x3&&_0x10054c&&Object[_0x2976f9(0xd2)](_0x4da032,_0x82ce85,_0x10054c),_0x10054c;},__metadata=this&&this[_0x4df08c(0xde)]||function(_0x377705,_0x446646){const _0x139592=_0x4df08c;if(typeof Reflect===_0x139592(0xe7)&&typeof Reflect['metadata']==='function')return Reflect[_0x139592(0x100)](_0x377705,_0x446646);};function _0x4a3d(){const _0x56f8c5=['轮询失败，重试次数:\x20','answer','chatLogService','未能获取结果数据,\x20即将重试','ChatLogService','CogVideoService','cogvideox','GlobalConfigService','video/cog/','post','getConfigs','../upload/upload.service','debug','任务提交失败:\x20','video_result','default','141uFxTFM','cogVideo','CogService','metadata','SUCCESS','，payload:\x20','6633965caERlb','getMonth','视频生成成功','videoUrl','查询超时，请稍后再试！',',\x20headers:\x20','视频生成失败','视频生成中\x20（','fileInfo','/cogvideox/v4/videos/generations','getDate','提示词:\x20\x22','视频生成中...','Logger','floor','now','../chatLog/chatLog.service','error','11pJSvKM','stringify','status','url','pollCogVideoResult','5123538LTtXXm','padStart','18598390sziILl','updateChatLog','design:paramtypes','轮询过程中发生错误:\x20','更新日志失败:\x20','Injectable','uploadService','@nestjs/common','上传文件失败:\x20','8104464cvSQpF','40588hrFYHh','function','1895cJQjcd','message','../globalConfig/globalConfig.service','defineProperty','查询生成结果时发生错误','Bearer\x20','查询生成结果时发生错误:','getOwnPropertyDescriptor','任务提交结果，状态码:\x20','306wUehFM','axios','decorate','uploadFileFromUrl','task_status','taskId','__metadata','taskData','/cogvideox/v4/async-result/','123438LIOeYy','UploadService','__esModule','log','Lum\x20aService','778qmlVkI','object','request_id','audioUrl','轮询超时，请稍后再试！','data','__decorate'];_0x4a3d=function(){return _0x56f8c5;};return _0x4a3d();}Object['defineProperty'](exports,_0x4df08c(0xe3),{'value':!![]}),exports[_0x4df08c(0xf2)]=void 0x0;const common_1=require(_0x4df08c(0xca)),axios_1=require(_0x4df08c(0xd9)),chatLog_service_1=require(_0x4df08c(0x113)),globalConfig_service_1=require(_0x4df08c(0xd1)),upload_service_1=require(_0x4df08c(0xf8));let CogVideoService=class CogVideoService{constructor(_0x5d4333,_0x37137e,_0x456a06){const _0x3c76d5=_0x4df08c;this[_0x3c76d5(0xef)]=_0x5d4333,this['globalConfigService']=_0x37137e,this[_0x3c76d5(0xc9)]=_0x456a06;}async[_0x4df08c(0xfe)](_0x48d64e){const _0x1d0b5b=_0x4df08c;var _0x10dcdf,_0xc2c21b,_0x5286b4;const {apiKey:_0x2be15c,proxyUrl:_0x3d9cc7,fileInfo:_0x5500c5,prompt:_0x11ee10,timeout:_0x2a5578,assistantLogId:_0x3e73b5}=_0x48d64e;let _0x343420={'text':'','fileInfo':'','taskId':'','taskData':'','status':0x2},_0x44dd01=null,_0x2cde99='',_0x426697={};const _0x30e0be={'Authorization':'Bearer\x20'+_0x2be15c};_0x2cde99=_0x3d9cc7+_0x1d0b5b(0x10c),_0x426697={'model':_0x1d0b5b(0xf3),'prompt':_0x11ee10};_0x5500c5&&(_0x426697['image_url']=_0x5500c5);common_1[_0x1d0b5b(0x110)][_0x1d0b5b(0xe4)]('正在准备发送请求到\x20'+_0x2cde99+_0x1d0b5b(0x102)+JSON[_0x1d0b5b(0xbd)](_0x426697)+_0x1d0b5b(0x108)+JSON[_0x1d0b5b(0xbd)](_0x30e0be),_0x1d0b5b(0xff));try{_0x44dd01=await axios_1['default'][_0x1d0b5b(0xf6)](_0x2cde99,_0x426697,{'headers':_0x30e0be}),common_1[_0x1d0b5b(0x110)][_0x1d0b5b(0xf9)](_0x1d0b5b(0xd7)+_0x44dd01[_0x1d0b5b(0xbe)]+',\x20状态消息:\x20'+_0x44dd01['statusText']+',\x20数据:\x20'+JSON[_0x1d0b5b(0xbd)](_0x44dd01[_0x1d0b5b(0xeb)]));}catch(_0x8177ba){common_1[_0x1d0b5b(0x110)][_0x1d0b5b(0x114)](_0x1d0b5b(0xfa)+_0x8177ba[_0x1d0b5b(0xd0)],_0x1d0b5b(0xff));throw new Error('任务提交失败');}if((_0x10dcdf=_0x44dd01===null||_0x44dd01===void 0x0?void 0x0:_0x44dd01[_0x1d0b5b(0xeb)])===null||_0x10dcdf===void 0x0?void 0x0:_0x10dcdf['id'])_0x343420[_0x1d0b5b(0xdd)]=(_0xc2c21b=_0x44dd01===null||_0x44dd01===void 0x0?void 0x0:_0x44dd01[_0x1d0b5b(0xeb)])===null||_0xc2c21b===void 0x0?void 0x0:_0xc2c21b['id'],common_1['Logger']['log']('任务提交成功,\x20任务ID:\x20'+((_0x5286b4=_0x44dd01===null||_0x44dd01===void 0x0?void 0x0:_0x44dd01[_0x1d0b5b(0xeb)])===null||_0x5286b4===void 0x0?void 0x0:_0x5286b4['id']),_0x1d0b5b(0xff));else throw new Error(_0x1d0b5b(0xf0));try{await this[_0x1d0b5b(0xc0)]({'proxyUrl':_0x3d9cc7,'apiKey':_0x2be15c,'taskId':_0x44dd01[_0x1d0b5b(0xeb)]['id'],'timeout':_0x2a5578,'prompt':_0x11ee10,'onSuccess':async _0x513205=>{const _0x256ae6=_0x1d0b5b;try{await this[_0x256ae6(0xef)][_0x256ae6(0xc4)](_0x3e73b5,{'videoUrl':_0x513205===null||_0x513205===void 0x0?void 0x0:_0x513205[_0x256ae6(0x106)],'audioUrl':_0x513205===null||_0x513205===void 0x0?void 0x0:_0x513205[_0x256ae6(0xe9)],'fileInfo':_0x513205===null||_0x513205===void 0x0?void 0x0:_0x513205[_0x256ae6(0x10b)],'answer':(_0x513205===null||_0x513205===void 0x0?void 0x0:_0x513205[_0x256ae6(0xee)])||_0x11ee10,'progress':'100%','status':0x3,'taskId':_0x513205===null||_0x513205===void 0x0?void 0x0:_0x513205[_0x256ae6(0xdd)],'taskData':_0x513205===null||_0x513205===void 0x0?void 0x0:_0x513205[_0x256ae6(0xdf)]}),common_1[_0x256ae6(0x110)]['log']('视频任务已完成',_0x256ae6(0xff));}catch(_0x4c7d0b){common_1[_0x256ae6(0x110)][_0x256ae6(0x114)]('更新日志失败:\x20'+_0x4c7d0b[_0x256ae6(0xd0)],_0x256ae6(0xff));}},'onGenerating':async _0x4f6361=>{const _0x45447c=_0x1d0b5b;try{await this[_0x45447c(0xef)][_0x45447c(0xc4)](_0x3e73b5,{'videoUrl':_0x4f6361===null||_0x4f6361===void 0x0?void 0x0:_0x4f6361[_0x45447c(0x106)],'audioUrl':_0x4f6361===null||_0x4f6361===void 0x0?void 0x0:_0x4f6361[_0x45447c(0xe9)],'fileInfo':_0x4f6361===null||_0x4f6361===void 0x0?void 0x0:_0x4f6361['fileInfo'],'answer':(_0x4f6361===null||_0x4f6361===void 0x0?void 0x0:_0x4f6361[_0x45447c(0xee)])||_0x45447c(0x10f),'progress':_0x4f6361===null||_0x4f6361===void 0x0?void 0x0:_0x4f6361['progress'],'status':_0x4f6361[_0x45447c(0xbe)]}),common_1['Logger'][_0x45447c(0xe4)](_0x45447c(0x10f),_0x45447c(0xff));}catch(_0x51f6a4){common_1['Logger'][_0x45447c(0x114)](_0x45447c(0xc7)+_0x51f6a4[_0x45447c(0xd0)],_0x45447c(0xff));}},'onFailure':async _0xae61c0=>{const _0x46b5a1=_0x1d0b5b;try{await this[_0x46b5a1(0xef)][_0x46b5a1(0xc4)](_0x3e73b5,{'answer':_0x46b5a1(0x109),'status':_0xae61c0[_0x46b5a1(0xbe)]}),common_1[_0x46b5a1(0x110)][_0x46b5a1(0xe4)]('生成失败',_0x46b5a1(0xe5));}catch(_0x1551cb){common_1[_0x46b5a1(0x110)][_0x46b5a1(0x114)](_0x46b5a1(0xc7)+_0x1551cb[_0x46b5a1(0xd0)],_0x46b5a1(0xff));}}});}catch(_0x465bf0){common_1[_0x1d0b5b(0x110)][_0x1d0b5b(0x114)](_0x1d0b5b(0xd5),_0x465bf0['message'],_0x1d0b5b(0xff));throw new Error(_0x1d0b5b(0xd3));}return _0x343420;}async['pollCogVideoResult'](_0x5757a3){const _0x48897f=_0x4df08c,{proxyUrl:_0x3cd715,apiKey:_0x4e15f2,taskId:_0x243119,timeout:_0xb41e9c,onSuccess:_0x151e05,onFailure:_0x52dc55,onGenerating:_0x28c154,prompt:_0x1c0468,action:_0x38cd22}=_0x5757a3;let _0x2cc360={'videoUrl':'','audioUrl':'','fileInfo':'','drawId':'','taskData':'','status':0x2,'progress':0x0,'answer':''};const _0x33e247={'Authorization':_0x48897f(0xd4)+_0x4e15f2},_0x414840=_0x3cd715+_0x48897f(0xe0)+_0x243119,_0x511eed=Date['now'](),_0x4c4c00=0x493e0,_0x1e0112=0x1388;let _0x403ce1=0x0;try{while(Date[_0x48897f(0x112)]()-_0x511eed<_0xb41e9c){await new Promise(_0x2b4c8c=>setTimeout(_0x2b4c8c,_0x1e0112));try{const _0x327508=await axios_1[_0x48897f(0xfc)]['get'](_0x414840,{'headers':_0x33e247}),_0x598488=setInterval(()=>{const _0x7301e4=_0x48897f,_0x5f4066=Date['now']()-_0x511eed;let _0xf262a6=Math[_0x7301e4(0x111)](_0x5f4066/_0x4c4c00*0x64);if(_0xf262a6>=0x63)_0xf262a6=0x63;_0x2cc360['answer']=_0x7301e4(0x10a)+_0xf262a6+'%）';},0x3e8),_0x38b8c0=_0x327508[_0x48897f(0xeb)];common_1[_0x48897f(0x110)][_0x48897f(0xf9)]('轮询结果:\x20'+JSON[_0x48897f(0xbd)](_0x38b8c0),_0x48897f(0xff));if(_0x38b8c0[_0x48897f(0xdc)]===_0x48897f(0x101)){_0x2cc360[_0x48897f(0xdd)]=_0x38b8c0[_0x48897f(0xe8)],_0x2cc360[_0x48897f(0xdf)]=JSON[_0x48897f(0xbd)](_0x38b8c0),common_1[_0x48897f(0x110)][_0x48897f(0xe4)](_0x48897f(0x105),_0x48897f(0xff)),_0x2cc360[_0x48897f(0x10b)]=_0x38b8c0[_0x48897f(0xfb)][0x0][_0x48897f(0xbf)],common_1[_0x48897f(0x110)]['log'](_0x2cc360[_0x48897f(0x10b)],_0x48897f(0xff));try{const _0x1b8b89=await this['globalConfigService'][_0x48897f(0xf7)](['localStorageStatus']);if(Number(_0x1b8b89)){const _0x447461=new Date(),_0x3b2298=_0x447461['getFullYear'](),_0x215cca=String(_0x447461[_0x48897f(0x104)]()+0x1)[_0x48897f(0xc2)](0x2,'0'),_0x1e9a28=String(_0x447461[_0x48897f(0x10d)]())[_0x48897f(0xc2)](0x2,'0'),_0x35312c=''+_0x3b2298+_0x215cca+'/'+_0x1e9a28;_0x2cc360[_0x48897f(0x10b)]=await this['uploadService'][_0x48897f(0xdb)]({'url':_0x38b8c0[_0x48897f(0xfb)][0x0]['url'],'dir':_0x48897f(0xf5)+_0x35312c});}}catch(_0xb20e5d){common_1['Logger'][_0x48897f(0x114)](_0x48897f(0xcb)+_0xb20e5d['message'],'CogService');}_0x2cc360['answer']=_0x48897f(0x10e)+_0x1c0468+'\x22',_0x151e05(_0x2cc360),clearInterval(_0x598488);return;}else _0x28c154(_0x2cc360);if(_0x2cc360['progress']){}}catch(_0x10ccc4){_0x403ce1++,common_1['Logger'][_0x48897f(0x114)](_0x48897f(0xed)+_0x403ce1,_0x48897f(0xff));}}common_1[_0x48897f(0x110)][_0x48897f(0x114)](_0x48897f(0xea),_0x48897f(0xff)),_0x2cc360['status']=0x4,_0x52dc55(_0x2cc360);throw new Error(_0x48897f(0x107));}catch(_0x2f3aee){common_1[_0x48897f(0x110)][_0x48897f(0x114)](_0x48897f(0xc6)+_0x2f3aee,_0x48897f(0xff)),_0x2cc360['status']=0x5,_0x52dc55(_0x2cc360);}}};CogVideoService=__decorate([(0x0,common_1[_0x4df08c(0xc8)])(),__metadata(_0x4df08c(0xc5),[chatLog_service_1[_0x4df08c(0xf1)],globalConfig_service_1[_0x4df08c(0xf4)],upload_service_1[_0x4df08c(0xe2)]])],CogVideoService),exports['CogVideoService']=CogVideoService;