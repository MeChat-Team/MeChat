'use strict';const _0x7cc321=_0x8929;(function(_0x22b3c4,_0x4e7fb8){const _0x1c7ecf=_0x8929,_0x5a4ed3=_0x22b3c4();while(!![]){try{const _0x4694ad=-parseInt(_0x1c7ecf(0x1fc))/0x1*(-parseInt(_0x1c7ecf(0x1f6))/0x2)+parseInt(_0x1c7ecf(0x207))/0x3*(parseInt(_0x1c7ecf(0x1dd))/0x4)+-parseInt(_0x1c7ecf(0x1df))/0x5*(-parseInt(_0x1c7ecf(0x1e5))/0x6)+parseInt(_0x1c7ecf(0x1f9))/0x7+parseInt(_0x1c7ecf(0x1ff))/0x8+-parseInt(_0x1c7ecf(0x1ef))/0x9*(parseInt(_0x1c7ecf(0x206))/0xa)+-parseInt(_0x1c7ecf(0x203))/0xb;if(_0x4694ad===_0x4e7fb8)break;else _0x5a4ed3['push'](_0x5a4ed3['shift']());}catch(_0x2a03a0){_0x5a4ed3['push'](_0x5a4ed3['shift']());}}}(_0x9ab4,0xc604b));var __decorate=this&&this['__decorate']||function(_0x43c942,_0x37ca01,_0x42e2b5,_0x24f00a){const _0x21671d=_0x8929;var _0x3859eb=arguments['length'],_0x24d3f7=_0x3859eb<0x3?_0x37ca01:_0x24f00a===null?_0x24f00a=Object[_0x21671d(0x21e)](_0x37ca01,_0x42e2b5):_0x24f00a,_0xb2bf4;if(typeof Reflect==='object'&&typeof Reflect['decorate']==='function')_0x24d3f7=Reflect[_0x21671d(0x20b)](_0x43c942,_0x37ca01,_0x42e2b5,_0x24f00a);else{for(var _0x417666=_0x43c942[_0x21671d(0x217)]-0x1;_0x417666>=0x0;_0x417666--)if(_0xb2bf4=_0x43c942[_0x417666])_0x24d3f7=(_0x3859eb<0x3?_0xb2bf4(_0x24d3f7):_0x3859eb>0x3?_0xb2bf4(_0x37ca01,_0x42e2b5,_0x24d3f7):_0xb2bf4(_0x37ca01,_0x42e2b5))||_0x24d3f7;}return _0x3859eb>0x3&&_0x24d3f7&&Object['defineProperty'](_0x37ca01,_0x42e2b5,_0x24d3f7),_0x24d3f7;},__metadata=this&&this[_0x7cc321(0x227)]||function(_0x3bd580,_0x2b8052){const _0x51897a=_0x7cc321;if(typeof Reflect===_0x51897a(0x1e2)&&typeof Reflect[_0x51897a(0x202)]===_0x51897a(0x1fa))return Reflect[_0x51897a(0x202)](_0x3bd580,_0x2b8052);};function _0x9ab4(){const _0x206502=['Bearer\x20','message','4590120GunAcU','default','status','metadata','36986697GzYHjB','查询生成结果时发生错误:','@nestjs/common','30gkWSFU','1413PpKKLI','正在准备发送请求到\x20','pollCogVideoResult','CogVideoService','decorate','log','updateChatLog','../chatLog/chatLog.service','error','GlobalConfigService','getDate','../upload/upload.service','answer','/cogvideox/v4/videos/generations','padStart','video_result','length','debug','url','post','fileInfo',',\x20数据:\x20','__esModule','getOwnPropertyDescriptor','taskId','video/cog/','stringify','taskData','查询生成结果时发生错误','cogVideo','轮询失败，重试次数:\x20','progress','__metadata','Lum\x20aService','/cogvideox/v4/async-result/','视频生成中\x20（','uploadService','生成失败','SUCCESS','CogService',',\x20headers:\x20',',\x20状态消息:\x20','cogvideox','轮询结果:\x20','globalConfigService','Injectable','chatLogService','audioUrl','9484zifOnk','视频生成中...','5404460cEPKRC','100%','轮询过程中发生错误:\x20','object','更新日志失败:\x20','任务提交结果，状态码:\x20','6IHWwfo','轮询超时，请稍后再试！','get','getFullYear','now','任务提交失败:\x20','UploadService','，payload:\x20','data','request_id','262026tBEIWH','axios','getConfigs','videoUrl','视频任务已完成','未能获取结果数据,\x20即将重试','上传文件失败:\x20','1176sdyuPL','Logger','uploadFileFromUrl','7878374eZuFNf','function','design:paramtypes','619rCgvSt'];_0x9ab4=function(){return _0x206502;};return _0x9ab4();}Object['defineProperty'](exports,_0x7cc321(0x21d),{'value':!![]}),exports[_0x7cc321(0x20a)]=void 0x0;function _0x8929(_0x5c80a1,_0xad8118){const _0x9ab40d=_0x9ab4();return _0x8929=function(_0x8929c9,_0x55ab00){_0x8929c9=_0x8929c9-0x1d8;let _0x18ed86=_0x9ab40d[_0x8929c9];return _0x18ed86;},_0x8929(_0x5c80a1,_0xad8118);}const common_1=require(_0x7cc321(0x205)),axios_1=require(_0x7cc321(0x1f0)),chatLog_service_1=require(_0x7cc321(0x20e)),globalConfig_service_1=require('../globalConfig/globalConfig.service'),upload_service_1=require(_0x7cc321(0x212));let CogVideoService=class CogVideoService{constructor(_0x40075d,_0x1ba99a,_0x5cbdb7){const _0x459a3b=_0x7cc321;this['chatLogService']=_0x40075d,this[_0x459a3b(0x1d9)]=_0x1ba99a,this[_0x459a3b(0x22b)]=_0x5cbdb7;}async[_0x7cc321(0x224)](_0x385773){const _0xc6bac7=_0x7cc321;var _0x2b206f,_0x1fbf99,_0xc7bdd;const {apiKey:_0x5c8965,proxyUrl:_0x1c26b4,fileInfo:_0x21d620,prompt:_0x3013b3,timeout:_0x5af4dd,assistantLogId:_0x15ed91}=_0x385773;let _0x419eee={'text':'','fileInfo':'','taskId':'','taskData':'','status':0x2},_0x464db1=null,_0x34fd1d='',_0x58e8b0={};const _0x27def7={'Authorization':_0xc6bac7(0x1fd)+_0x5c8965};_0x34fd1d=_0x1c26b4+_0xc6bac7(0x214),_0x58e8b0={'model':_0xc6bac7(0x231),'prompt':_0x3013b3};_0x21d620&&(_0x58e8b0['image_url']=_0x21d620);common_1[_0xc6bac7(0x1f7)][_0xc6bac7(0x20c)](_0xc6bac7(0x208)+_0x34fd1d+_0xc6bac7(0x1ec)+JSON[_0xc6bac7(0x221)](_0x58e8b0)+_0xc6bac7(0x22f)+JSON[_0xc6bac7(0x221)](_0x27def7),_0xc6bac7(0x22e));try{_0x464db1=await axios_1['default'][_0xc6bac7(0x21a)](_0x34fd1d,_0x58e8b0,{'headers':_0x27def7}),common_1[_0xc6bac7(0x1f7)][_0xc6bac7(0x218)](_0xc6bac7(0x1e4)+_0x464db1[_0xc6bac7(0x201)]+_0xc6bac7(0x230)+_0x464db1['statusText']+_0xc6bac7(0x21c)+JSON[_0xc6bac7(0x221)](_0x464db1[_0xc6bac7(0x1ed)]));}catch(_0x26c3aa){common_1[_0xc6bac7(0x1f7)][_0xc6bac7(0x20f)](_0xc6bac7(0x1ea)+_0x26c3aa[_0xc6bac7(0x1fe)],'CogService');throw new Error('任务提交失败');}if((_0x2b206f=_0x464db1===null||_0x464db1===void 0x0?void 0x0:_0x464db1[_0xc6bac7(0x1ed)])===null||_0x2b206f===void 0x0?void 0x0:_0x2b206f['id'])_0x419eee[_0xc6bac7(0x21f)]=(_0x1fbf99=_0x464db1===null||_0x464db1===void 0x0?void 0x0:_0x464db1[_0xc6bac7(0x1ed)])===null||_0x1fbf99===void 0x0?void 0x0:_0x1fbf99['id'],common_1[_0xc6bac7(0x1f7)]['log']('任务提交成功,\x20任务ID:\x20'+((_0xc7bdd=_0x464db1===null||_0x464db1===void 0x0?void 0x0:_0x464db1['data'])===null||_0xc7bdd===void 0x0?void 0x0:_0xc7bdd['id']),_0xc6bac7(0x22e));else throw new Error(_0xc6bac7(0x1f4));try{await this[_0xc6bac7(0x209)]({'proxyUrl':_0x1c26b4,'apiKey':_0x5c8965,'taskId':_0x464db1[_0xc6bac7(0x1ed)]['id'],'timeout':_0x5af4dd,'prompt':_0x3013b3,'onSuccess':async _0x29c9f2=>{const _0x5903fd=_0xc6bac7;try{await this['chatLogService'][_0x5903fd(0x20d)](_0x15ed91,{'videoUrl':_0x29c9f2===null||_0x29c9f2===void 0x0?void 0x0:_0x29c9f2[_0x5903fd(0x1f2)],'audioUrl':_0x29c9f2===null||_0x29c9f2===void 0x0?void 0x0:_0x29c9f2[_0x5903fd(0x1dc)],'fileInfo':_0x29c9f2===null||_0x29c9f2===void 0x0?void 0x0:_0x29c9f2['fileInfo'],'answer':(_0x29c9f2===null||_0x29c9f2===void 0x0?void 0x0:_0x29c9f2[_0x5903fd(0x213)])||_0x3013b3,'progress':_0x5903fd(0x1e0),'status':0x3,'taskId':_0x29c9f2===null||_0x29c9f2===void 0x0?void 0x0:_0x29c9f2[_0x5903fd(0x21f)],'taskData':_0x29c9f2===null||_0x29c9f2===void 0x0?void 0x0:_0x29c9f2[_0x5903fd(0x222)]}),common_1[_0x5903fd(0x1f7)][_0x5903fd(0x20c)](_0x5903fd(0x1f3),_0x5903fd(0x22e));}catch(_0x11c2c1){common_1[_0x5903fd(0x1f7)]['error'](_0x5903fd(0x1e3)+_0x11c2c1[_0x5903fd(0x1fe)],_0x5903fd(0x22e));}},'onGenerating':async _0x14cd76=>{const _0x19ab79=_0xc6bac7;try{await this[_0x19ab79(0x1db)]['updateChatLog'](_0x15ed91,{'videoUrl':_0x14cd76===null||_0x14cd76===void 0x0?void 0x0:_0x14cd76[_0x19ab79(0x1f2)],'audioUrl':_0x14cd76===null||_0x14cd76===void 0x0?void 0x0:_0x14cd76[_0x19ab79(0x1dc)],'fileInfo':_0x14cd76===null||_0x14cd76===void 0x0?void 0x0:_0x14cd76['fileInfo'],'answer':(_0x14cd76===null||_0x14cd76===void 0x0?void 0x0:_0x14cd76[_0x19ab79(0x213)])||'视频生成中...','progress':_0x14cd76===null||_0x14cd76===void 0x0?void 0x0:_0x14cd76['progress'],'status':_0x14cd76['status']}),common_1['Logger'][_0x19ab79(0x20c)](_0x19ab79(0x1de),_0x19ab79(0x22e));}catch(_0x4c54a8){common_1[_0x19ab79(0x1f7)][_0x19ab79(0x20f)](_0x19ab79(0x1e3)+_0x4c54a8[_0x19ab79(0x1fe)],_0x19ab79(0x22e));}},'onFailure':async _0x59be0e=>{const _0x39c2f3=_0xc6bac7;try{await this[_0x39c2f3(0x1db)][_0x39c2f3(0x20d)](_0x15ed91,{'answer':'视频生成失败','status':_0x59be0e[_0x39c2f3(0x201)]}),common_1[_0x39c2f3(0x1f7)][_0x39c2f3(0x20c)](_0x39c2f3(0x22c),_0x39c2f3(0x228));}catch(_0x5258e1){common_1[_0x39c2f3(0x1f7)][_0x39c2f3(0x20f)](_0x39c2f3(0x1e3)+_0x5258e1[_0x39c2f3(0x1fe)],_0x39c2f3(0x22e));}}});}catch(_0x2ac6dd){common_1[_0xc6bac7(0x1f7)][_0xc6bac7(0x20f)](_0xc6bac7(0x204),_0x2ac6dd[_0xc6bac7(0x1fe)],_0xc6bac7(0x22e));throw new Error(_0xc6bac7(0x223));}return _0x419eee;}async[_0x7cc321(0x209)](_0x2eaa1c){const _0x3321ca=_0x7cc321,{proxyUrl:_0x3e6fdd,apiKey:_0x26a908,taskId:_0x4516ea,timeout:_0xce95de,onSuccess:_0x108e8e,onFailure:_0x438806,onGenerating:_0x20a9fc,prompt:_0x39e710,action:_0x21e4cc}=_0x2eaa1c;let _0x717199={'videoUrl':'','audioUrl':'','fileInfo':'','drawId':'','taskData':'','status':0x2,'progress':0x0,'answer':''};const _0xba87e0={'Authorization':_0x3321ca(0x1fd)+_0x26a908},_0xedd313=_0x3e6fdd+_0x3321ca(0x229)+_0x4516ea,_0x1a3dac=Date[_0x3321ca(0x1e9)](),_0x3e6d57=0x493e0,_0x4d77a0=0x1388;let _0x31ddc9=0x0;try{while(Date[_0x3321ca(0x1e9)]()-_0x1a3dac<_0xce95de){await new Promise(_0x24d2bb=>setTimeout(_0x24d2bb,_0x4d77a0));try{const _0x52a747=await axios_1[_0x3321ca(0x200)][_0x3321ca(0x1e7)](_0xedd313,{'headers':_0xba87e0}),_0x36a96d=setInterval(()=>{const _0x559a97=_0x3321ca,_0x5dd420=Date[_0x559a97(0x1e9)]()-_0x1a3dac;let _0xa79e2d=Math['floor'](_0x5dd420/_0x3e6d57*0x64);if(_0xa79e2d>=0x63)_0xa79e2d=0x63;_0x717199[_0x559a97(0x213)]=_0x559a97(0x22a)+_0xa79e2d+'%）';},0x3e8),_0x193f3a=_0x52a747[_0x3321ca(0x1ed)];common_1['Logger'][_0x3321ca(0x218)](_0x3321ca(0x1d8)+JSON[_0x3321ca(0x221)](_0x193f3a),_0x3321ca(0x22e));if(_0x193f3a['task_status']===_0x3321ca(0x22d)){_0x717199[_0x3321ca(0x21f)]=_0x193f3a[_0x3321ca(0x1ee)],_0x717199['taskData']=JSON[_0x3321ca(0x221)](_0x193f3a),common_1[_0x3321ca(0x1f7)][_0x3321ca(0x20c)]('视频生成成功','CogService'),_0x717199[_0x3321ca(0x21b)]=_0x193f3a['video_result'][0x0][_0x3321ca(0x219)],common_1[_0x3321ca(0x1f7)][_0x3321ca(0x20c)](_0x717199[_0x3321ca(0x21b)],_0x3321ca(0x22e));try{const _0x10f2b6=await this[_0x3321ca(0x1d9)][_0x3321ca(0x1f1)](['localStorageStatus']);if(Number(_0x10f2b6)){const _0x155ede=new Date(),_0x5da9c0=_0x155ede[_0x3321ca(0x1e8)](),_0x583471=String(_0x155ede['getMonth']()+0x1)[_0x3321ca(0x215)](0x2,'0'),_0x2b241e=String(_0x155ede[_0x3321ca(0x211)]())[_0x3321ca(0x215)](0x2,'0'),_0x3a8ba5=''+_0x5da9c0+_0x583471+'/'+_0x2b241e;_0x717199[_0x3321ca(0x21b)]=await this[_0x3321ca(0x22b)][_0x3321ca(0x1f8)]({'url':_0x193f3a[_0x3321ca(0x216)][0x0][_0x3321ca(0x219)],'dir':_0x3321ca(0x220)+_0x3a8ba5});}}catch(_0x314e15){common_1['Logger'][_0x3321ca(0x20f)](_0x3321ca(0x1f5)+_0x314e15['message'],_0x3321ca(0x22e));}_0x717199[_0x3321ca(0x213)]='提示词:\x20\x22'+_0x39e710+'\x22',_0x108e8e(_0x717199),clearInterval(_0x36a96d);return;}else _0x20a9fc(_0x717199);if(_0x717199[_0x3321ca(0x226)]){}}catch(_0x4b9415){_0x31ddc9++,common_1[_0x3321ca(0x1f7)][_0x3321ca(0x20f)](_0x3321ca(0x225)+_0x31ddc9,'CogService');}}common_1[_0x3321ca(0x1f7)][_0x3321ca(0x20f)](_0x3321ca(0x1e6),_0x3321ca(0x22e)),_0x717199[_0x3321ca(0x201)]=0x4,_0x438806(_0x717199);throw new Error('查询超时，请稍后再试！');}catch(_0x32a6b5){common_1[_0x3321ca(0x1f7)][_0x3321ca(0x20f)](_0x3321ca(0x1e1)+_0x32a6b5,_0x3321ca(0x22e)),_0x717199['status']=0x5,_0x438806(_0x717199);}}};CogVideoService=__decorate([(0x0,common_1[_0x7cc321(0x1da)])(),__metadata(_0x7cc321(0x1fb),[chatLog_service_1['ChatLogService'],globalConfig_service_1[_0x7cc321(0x210)],upload_service_1[_0x7cc321(0x1eb)]])],CogVideoService),exports[_0x7cc321(0x20a)]=CogVideoService;