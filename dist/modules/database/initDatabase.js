'use strict';const _0x5f32c5=_0x2c03;(function(_0x1e4f79,_0x1f17dc){const _0x495f0d=_0x2c03,_0x2ca37d=_0x1e4f79();while(!![]){try{const _0x4dd100=-parseInt(_0x495f0d(0x1fc))/0x1+-parseInt(_0x495f0d(0x1ed))/0x2*(parseInt(_0x495f0d(0x20b))/0x3)+-parseInt(_0x495f0d(0x207))/0x4+-parseInt(_0x495f0d(0x1e9))/0x5+parseInt(_0x495f0d(0x1f4))/0x6+-parseInt(_0x495f0d(0x1fb))/0x7+parseInt(_0x495f0d(0x204))/0x8;if(_0x4dd100===_0x1f17dc)break;else _0x2ca37d['push'](_0x2ca37d['shift']());}catch(_0x577f8f){_0x2ca37d['push'](_0x2ca37d['shift']());}}}(_0x2d14,0x2c7c9));Object[_0x5f32c5(0x1e0)](exports,'__esModule',{'value':!![]}),exports[_0x5f32c5(0x1ff)]=void 0x0;const common_1=require(_0x5f32c5(0x1e8)),dotenv_1=require(_0x5f32c5(0x202)),mysql=require('mysql2/promise'),typeorm_1=require(_0x5f32c5(0x205));(0x0,dotenv_1[_0x5f32c5(0x1fa)])();const dataSourceOptions={'type':_0x5f32c5(0x1de),'port':parseInt(process[_0x5f32c5(0x1f6)]['DB_PORT'],0xa),'host':process[_0x5f32c5(0x1f6)]['DB_HOST'],'username':process[_0x5f32c5(0x1f6)][_0x5f32c5(0x1ec)],'password':process[_0x5f32c5(0x1f6)][_0x5f32c5(0x1f8)],'database':process['env'][_0x5f32c5(0x1e4)],'entities':[__dirname+_0x5f32c5(0x1e3)],'logging':![],'synchronize':!![],'charset':_0x5f32c5(0x201),'timezone':_0x5f32c5(0x1f1)};function _0x2d14(){const _0x4ea8e5=['/../**/*.entity{.ts,.js}','DB_DATABASE','end','isArray','error','@nestjs/common','249820rehduO','Logger','\x20is\x20already\x20of\x20type\x20TEXT\x20in\x20table\x20','DB_USER','5618ISyclE','execute','SELECT\x20COLUMN_NAME,\x20DATA_TYPE\x20FROM\x20INFORMATION_SCHEMA.COLUMNS\x20WHERE\x20TABLE_NAME\x20=\x20?\x20AND\x20COLUMN_NAME\x20=\x20?','Database','+08:00','Database\x20connected\x20and\x20synchronized\x20successfully','length','223158xgOMCQ','destroy','env','configVal','DB_PASS','DB_HOST','config','2405207ffWdot','318906iVABUi','initialize','SHOW\x20DATABASES\x20LIKE\x20\x27','initDatabase','createConnection','utf8mb4','dotenv','app','11738392qNimxy','typeorm','Error\x20during\x20database\x20validation:','1281908zLRUyX','ALTER\x20TABLE\x20??\x20MODIFY\x20COLUMN\x20??\x20TEXT','Error\x20during\x20TypeORM\x20initialization:','DATA_TYPE','309KFaWAw','DataSource','\x20type\x20updated\x20to\x20TEXT\x20in\x20table\x20','DB_PORT','log','mysql','text','defineProperty','Column\x20','Error\x20updating\x20column\x20type\x20in\x20table\x20'];_0x2d14=function(){return _0x4ea8e5;};return _0x2d14();}function _0x2c03(_0x8df7ba,_0x48e5d0){const _0x2d14cb=_0x2d14();return _0x2c03=function(_0x2c034a,_0x5b1720){_0x2c034a=_0x2c034a-0x1de;let _0x3ac4c1=_0x2d14cb[_0x2c034a];return _0x3ac4c1;},_0x2c03(_0x8df7ba,_0x48e5d0);}async function validateDatabase(){const _0x1c8bae=_0x5f32c5,_0x4d1c95=await mysql[_0x1c8bae(0x200)]({'host':process[_0x1c8bae(0x1f6)][_0x1c8bae(0x1f9)],'user':process[_0x1c8bae(0x1f6)]['DB_USER'],'password':process[_0x1c8bae(0x1f6)][_0x1c8bae(0x1f8)],'port':parseInt(process[_0x1c8bae(0x1f6)][_0x1c8bae(0x20e)],0xa)});try{const [_0xe96be8]=await _0x4d1c95[_0x1c8bae(0x1ee)](_0x1c8bae(0x1fe)+process[_0x1c8bae(0x1f6)][_0x1c8bae(0x1e4)]+'\x27');Array[_0x1c8bae(0x1e6)](_0xe96be8)&&_0xe96be8[_0x1c8bae(0x1f3)]===0x0?(await _0x4d1c95[_0x1c8bae(0x1ee)]('CREATE\x20DATABASE\x20'+process[_0x1c8bae(0x1f6)]['DB_DATABASE']),common_1[_0x1c8bae(0x1ea)][_0x1c8bae(0x20f)]('数据库创建成功['+process[_0x1c8bae(0x1f6)][_0x1c8bae(0x1e4)]+']',_0x1c8bae(0x1f0))):common_1['Logger'][_0x1c8bae(0x20f)]('数据库已存在['+process[_0x1c8bae(0x1f6)][_0x1c8bae(0x1e4)]+']',_0x1c8bae(0x1f0));}catch(_0x3bada6){common_1[_0x1c8bae(0x1ea)][_0x1c8bae(0x1e7)](_0x1c8bae(0x206),_0x3bada6,_0x1c8bae(0x1f0));}finally{await _0x4d1c95[_0x1c8bae(0x1e5)]();}}async function updateColumnType(){const _0x6d3712=_0x5f32c5,_0x232636=await mysql[_0x6d3712(0x200)]({'host':process['env'][_0x6d3712(0x1f9)],'user':process[_0x6d3712(0x1f6)]['DB_USER'],'password':process[_0x6d3712(0x1f6)]['DB_PASS'],'port':parseInt(process[_0x6d3712(0x1f6)][_0x6d3712(0x20e)],0xa),'database':process[_0x6d3712(0x1f6)][_0x6d3712(0x1e4)]});async function _0x360b9d(_0x2fb3da,_0x24b612){const _0xa27ea5=_0x6d3712;try{const [_0x55533c]=await _0x232636[_0xa27ea5(0x1ee)](_0xa27ea5(0x1ef),[_0x2fb3da,_0x24b612]);_0x55533c[_0xa27ea5(0x1f3)]>0x0&&_0x55533c[0x0][_0xa27ea5(0x20a)]!==_0xa27ea5(0x1df)?(await _0x232636[_0xa27ea5(0x1ee)](_0xa27ea5(0x208),[_0x2fb3da,_0x24b612]),common_1[_0xa27ea5(0x1ea)][_0xa27ea5(0x20f)]('Column\x20'+_0x24b612+_0xa27ea5(0x20d)+_0x2fb3da,'Database')):common_1['Logger'][_0xa27ea5(0x20f)](_0xa27ea5(0x1e1)+_0x24b612+_0xa27ea5(0x1eb)+_0x2fb3da,_0xa27ea5(0x1f0));}catch(_0x1283cf){common_1[_0xa27ea5(0x1ea)]['error'](_0xa27ea5(0x1e2)+_0x2fb3da+':',_0x1283cf);}}try{await _0x360b9d(_0x6d3712(0x1fa),_0x6d3712(0x1f7)),await _0x360b9d(_0x6d3712(0x203),'coverImg');}finally{await _0x232636[_0x6d3712(0x1e5)]();}}async function initDatabase(){const _0x14153e=_0x5f32c5;await validateDatabase(),await updateColumnType();const _0x5ba2e1=new typeorm_1[(_0x14153e(0x20c))](dataSourceOptions);try{await _0x5ba2e1[_0x14153e(0x1fd)](),common_1[_0x14153e(0x1ea)][_0x14153e(0x20f)](_0x14153e(0x1f2),'Database');}catch(_0x40e8c6){common_1[_0x14153e(0x1ea)][_0x14153e(0x1e7)](_0x14153e(0x209),_0x40e8c6);}finally{await _0x5ba2e1[_0x14153e(0x1f5)]();}}exports['initDatabase']=initDatabase;