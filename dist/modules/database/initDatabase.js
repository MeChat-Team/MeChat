'use strict';const _0x103d8=_0x135e;(function(_0x363da7,_0x5c00c5){const _0x32a0d0=_0x135e,_0x523554=_0x363da7();while(!![]){try{const _0x442cc9=-parseInt(_0x32a0d0(0x145))/0x1*(-parseInt(_0x32a0d0(0x142))/0x2)+parseInt(_0x32a0d0(0x15f))/0x3*(-parseInt(_0x32a0d0(0x132))/0x4)+parseInt(_0x32a0d0(0x147))/0x5+parseInt(_0x32a0d0(0x157))/0x6*(-parseInt(_0x32a0d0(0x154))/0x7)+-parseInt(_0x32a0d0(0x15a))/0x8*(-parseInt(_0x32a0d0(0x15e))/0x9)+parseInt(_0x32a0d0(0x13c))/0xa+-parseInt(_0x32a0d0(0x137))/0xb;if(_0x442cc9===_0x5c00c5)break;else _0x523554['push'](_0x523554['shift']());}catch(_0x3d40c6){_0x523554['push'](_0x523554['shift']());}}}(_0x85de,0x1b3e4));Object[_0x103d8(0x155)](exports,_0x103d8(0x15c),{'value':!![]}),exports['initDatabase']=void 0x0;const common_1=require(_0x103d8(0x144)),dotenv_1=require(_0x103d8(0x12e)),mysql=require('mysql2/promise'),typeorm_1=require('typeorm');(0x0,dotenv_1['config'])();function _0x85de(){const _0x346da7=['mysql','CREATE\x20DATABASE\x20','initialize','Error\x20during\x20TypeORM\x20initialization:','514EivVjv','length','@nestjs/common','384ODuNJB','Database\x20connected\x20and\x20synchronized\x20successfully','1008490mQyMFt','utf8mb4','configVal','createConnection','Logger','SHOW\x20DATABASES\x20LIKE\x20\x27','env','+08:00','Error\x20during\x20database\x20validation:','isArray','/../**/*.entity{.ts,.js}','initDatabase','数据库已存在[','1087996ZDJppN','defineProperty','SELECT\x20COLUMN_NAME,\x20DATA_TYPE\x20FROM\x20INFORMATION_SCHEMA.COLUMNS\x20WHERE\x20TABLE_NAME\x20=\x20?\x20AND\x20COLUMN_NAME\x20=\x20?','6IlFwuc','text','config','8QLnvak','DB_PASS','__esModule','log','1387143pafqrL','469326lHPUtz','coverImg','DATA_TYPE','dotenv','error','Database','DB_HOST','4UDQiqx','end','DB_PORT','Error\x20updating\x20column\x20type\x20in\x20table\x20','Column\x20','1323487cvUDej','DB_DATABASE','数据库创建成功[','app','DB_USER','892620rrgduD','execute'];_0x85de=function(){return _0x346da7;};return _0x85de();}const dataSourceOptions={'type':_0x103d8(0x13e),'port':parseInt(process['env'][_0x103d8(0x134)],0xa),'host':process['env'][_0x103d8(0x131)],'username':process[_0x103d8(0x14d)][_0x103d8(0x13b)],'password':process[_0x103d8(0x14d)]['DB_PASS'],'database':process[_0x103d8(0x14d)][_0x103d8(0x138)],'entities':[__dirname+_0x103d8(0x151)],'logging':![],'synchronize':!![],'charset':_0x103d8(0x148),'timezone':_0x103d8(0x14e)};async function validateDatabase(){const _0x7e198b=_0x103d8,_0x3bb492=await mysql['createConnection']({'host':process[_0x7e198b(0x14d)][_0x7e198b(0x131)],'user':process[_0x7e198b(0x14d)]['DB_USER'],'password':process[_0x7e198b(0x14d)][_0x7e198b(0x15b)],'port':parseInt(process[_0x7e198b(0x14d)][_0x7e198b(0x134)],0xa)});try{const [_0xed94a2]=await _0x3bb492['execute'](_0x7e198b(0x14c)+process['env'][_0x7e198b(0x138)]+'\x27');Array[_0x7e198b(0x150)](_0xed94a2)&&_0xed94a2[_0x7e198b(0x143)]===0x0?(await _0x3bb492[_0x7e198b(0x13d)](_0x7e198b(0x13f)+process['env'][_0x7e198b(0x138)]),common_1[_0x7e198b(0x14b)][_0x7e198b(0x15d)](_0x7e198b(0x139)+process[_0x7e198b(0x14d)][_0x7e198b(0x138)]+']',_0x7e198b(0x130))):common_1['Logger'][_0x7e198b(0x15d)](_0x7e198b(0x153)+process[_0x7e198b(0x14d)][_0x7e198b(0x138)]+']','Database');}catch(_0x558742){common_1['Logger'][_0x7e198b(0x12f)](_0x7e198b(0x14f),_0x558742,_0x7e198b(0x130));}finally{await _0x3bb492[_0x7e198b(0x133)]();}}async function updateColumnType(){const _0x63a6f=_0x103d8,_0x537e9a=await mysql[_0x63a6f(0x14a)]({'host':process[_0x63a6f(0x14d)][_0x63a6f(0x131)],'user':process[_0x63a6f(0x14d)][_0x63a6f(0x13b)],'password':process['env'][_0x63a6f(0x15b)],'port':parseInt(process[_0x63a6f(0x14d)]['DB_PORT'],0xa),'database':process[_0x63a6f(0x14d)][_0x63a6f(0x138)]});async function _0x451f1d(_0x44020c,_0x25c29e){const _0x35398d=_0x63a6f;try{const [_0x2c02dd]=await _0x537e9a['execute'](_0x35398d(0x156),[_0x44020c,_0x25c29e]);_0x2c02dd[_0x35398d(0x143)]>0x0&&_0x2c02dd[0x0][_0x35398d(0x12d)]!==_0x35398d(0x158)?(await _0x537e9a['execute']('ALTER\x20TABLE\x20??\x20MODIFY\x20COLUMN\x20??\x20TEXT',[_0x44020c,_0x25c29e]),common_1[_0x35398d(0x14b)]['log']('Column\x20'+_0x25c29e+'\x20type\x20updated\x20to\x20TEXT\x20in\x20table\x20'+_0x44020c,_0x35398d(0x130))):common_1[_0x35398d(0x14b)]['log'](_0x35398d(0x136)+_0x25c29e+'\x20is\x20already\x20of\x20type\x20TEXT\x20in\x20table\x20'+_0x44020c,_0x35398d(0x130));}catch(_0x39540d){common_1[_0x35398d(0x14b)][_0x35398d(0x12f)](_0x35398d(0x135)+_0x44020c+':',_0x39540d);}}try{await _0x451f1d(_0x63a6f(0x159),_0x63a6f(0x149)),await _0x451f1d(_0x63a6f(0x13a),_0x63a6f(0x160));}finally{await _0x537e9a[_0x63a6f(0x133)]();}}function _0x135e(_0x59568d,_0xb0ef1f){const _0x85de96=_0x85de();return _0x135e=function(_0x135ec5,_0x4c8458){_0x135ec5=_0x135ec5-0x12d;let _0x137f34=_0x85de96[_0x135ec5];return _0x137f34;},_0x135e(_0x59568d,_0xb0ef1f);}async function initDatabase(){const _0x1b621a=_0x103d8;await validateDatabase(),await updateColumnType();const _0x3a0f16=new typeorm_1['DataSource'](dataSourceOptions);try{await _0x3a0f16[_0x1b621a(0x140)](),common_1['Logger'][_0x1b621a(0x15d)](_0x1b621a(0x146),'Database');}catch(_0x4fb086){common_1[_0x1b621a(0x14b)][_0x1b621a(0x12f)](_0x1b621a(0x141),_0x4fb086);}finally{await _0x3a0f16['destroy']();}}exports[_0x103d8(0x152)]=initDatabase;