'use strict';const _0x132b30=_0x10b7;function _0x10b7(_0x45867b,_0x1a9fad){const _0x131d8e=_0x131d();return _0x10b7=function(_0x10b785,_0x11d6a5){_0x10b785=_0x10b785-0x164;let _0x296ffd=_0x131d8e[_0x10b785];return _0x296ffd;},_0x10b7(_0x45867b,_0x1a9fad);}(function(_0x2831a8,_0x3248c2){const _0x4b425a=_0x10b7,_0x5d938e=_0x2831a8();while(!![]){try{const _0x435640=parseInt(_0x4b425a(0x184))/0x1+-parseInt(_0x4b425a(0x193))/0x2*(parseInt(_0x4b425a(0x17c))/0x3)+-parseInt(_0x4b425a(0x167))/0x4*(parseInt(_0x4b425a(0x177))/0x5)+-parseInt(_0x4b425a(0x18f))/0x6*(parseInt(_0x4b425a(0x16f))/0x7)+-parseInt(_0x4b425a(0x186))/0x8+-parseInt(_0x4b425a(0x171))/0x9+parseInt(_0x4b425a(0x176))/0xa;if(_0x435640===_0x3248c2)break;else _0x5d938e['push'](_0x5d938e['shift']());}catch(_0x238e84){_0x5d938e['push'](_0x5d938e['shift']());}}}(_0x131d,0x8f2b0));Object[_0x132b30(0x170)](exports,_0x132b30(0x17f),{'value':!![]}),exports[_0x132b30(0x18c)]=void 0x0;const common_1=require(_0x132b30(0x18e)),dotenv_1=require(_0x132b30(0x165)),mysql=require(_0x132b30(0x17d)),typeorm_1=require(_0x132b30(0x168));function _0x131d(){const _0x55f8cc=['32VMDbSy','mysql','\x20is\x20already\x20of\x20type\x20TEXT\x20in\x20table\x20','end','DB_HOST','dotenv','DB_PORT','263104bJBYjZ','typeorm','config','Logger','length','Error\x20updating\x20column\x20type\x20in\x20table\x20','log','SELECT\x20COLUMN_NAME,\x20DATA_TYPE\x20FROM\x20INFORMATION_SCHEMA.COLUMNS\x20WHERE\x20TABLE_NAME\x20=\x20?\x20AND\x20COLUMN_NAME\x20=\x20?','300349hfuzhi','defineProperty','5802057knOCex','initialize','Database','DB_PASS','SHOW\x20DATABASES\x20LIKE\x20\x27','33679450CtSkxP','80ngmUiu','DATA_TYPE','isArray','error','env','59295cSwWNo','mysql2/promise','ALTER\x20TABLE\x20??\x20MODIFY\x20COLUMN\x20??\x20TEXT','__esModule','text','Error\x20during\x20database\x20validation:','Error\x20during\x20TypeORM\x20initialization:','destroy','271742VYujue','Column\x20','6603256QrMuIc','DB_DATABASE','DataSource','utf8mb4','configVal','execute','initDatabase','DB_USER','@nestjs/common','30QSqHGd','数据库创建成功[','数据库已存在[','CREATE\x20DATABASE\x20'];_0x131d=function(){return _0x55f8cc;};return _0x131d();}(0x0,dotenv_1[_0x132b30(0x169)])();const dataSourceOptions={'type':_0x132b30(0x194),'port':parseInt(process[_0x132b30(0x17b)][_0x132b30(0x166)],0xa),'host':process[_0x132b30(0x17b)]['DB_HOST'],'username':process[_0x132b30(0x17b)][_0x132b30(0x18d)],'password':process[_0x132b30(0x17b)][_0x132b30(0x174)],'database':process[_0x132b30(0x17b)][_0x132b30(0x187)],'entities':[__dirname+'/../**/*.entity{.ts,.js}'],'logging':![],'synchronize':!![],'charset':_0x132b30(0x189),'timezone':'+08:00'};async function validateDatabase(){const _0xd15f4e=_0x132b30,_0x502b83=await mysql['createConnection']({'host':process[_0xd15f4e(0x17b)]['DB_HOST'],'user':process['env']['DB_USER'],'password':process[_0xd15f4e(0x17b)][_0xd15f4e(0x174)],'port':parseInt(process[_0xd15f4e(0x17b)][_0xd15f4e(0x166)],0xa)});try{const [_0x77921c]=await _0x502b83[_0xd15f4e(0x18b)](_0xd15f4e(0x175)+process[_0xd15f4e(0x17b)][_0xd15f4e(0x187)]+'\x27');Array[_0xd15f4e(0x179)](_0x77921c)&&_0x77921c[_0xd15f4e(0x16b)]===0x0?(await _0x502b83[_0xd15f4e(0x18b)](_0xd15f4e(0x192)+process[_0xd15f4e(0x17b)][_0xd15f4e(0x187)]),common_1[_0xd15f4e(0x16a)][_0xd15f4e(0x16d)](_0xd15f4e(0x190)+process['env'][_0xd15f4e(0x187)]+']',_0xd15f4e(0x173))):common_1[_0xd15f4e(0x16a)]['log'](_0xd15f4e(0x191)+process[_0xd15f4e(0x17b)]['DB_DATABASE']+']',_0xd15f4e(0x173));}catch(_0x257a6e){common_1[_0xd15f4e(0x16a)][_0xd15f4e(0x17a)](_0xd15f4e(0x181),_0x257a6e,_0xd15f4e(0x173));}finally{await _0x502b83[_0xd15f4e(0x196)]();}}async function updateColumnType(){const _0x15139b=_0x132b30,_0x169730=await mysql['createConnection']({'host':process[_0x15139b(0x17b)][_0x15139b(0x164)],'user':process['env'][_0x15139b(0x18d)],'password':process['env'][_0x15139b(0x174)],'port':parseInt(process[_0x15139b(0x17b)][_0x15139b(0x166)],0xa),'database':process['env'][_0x15139b(0x187)]});async function _0x506e93(_0x24aae2,_0x332166){const _0x4878a7=_0x15139b;try{const [_0x45b40b]=await _0x169730[_0x4878a7(0x18b)](_0x4878a7(0x16e),[_0x24aae2,_0x332166]);_0x45b40b['length']>0x0&&_0x45b40b[0x0][_0x4878a7(0x178)]!==_0x4878a7(0x180)?(await _0x169730[_0x4878a7(0x18b)](_0x4878a7(0x17e),[_0x24aae2,_0x332166]),common_1['Logger'][_0x4878a7(0x16d)](_0x4878a7(0x185)+_0x332166+'\x20type\x20updated\x20to\x20TEXT\x20in\x20table\x20'+_0x24aae2,_0x4878a7(0x173))):common_1['Logger']['log'](_0x4878a7(0x185)+_0x332166+_0x4878a7(0x195)+_0x24aae2,_0x4878a7(0x173));}catch(_0x24a082){common_1[_0x4878a7(0x16a)][_0x4878a7(0x17a)](_0x4878a7(0x16c)+_0x24aae2+':',_0x24a082);}}try{await _0x506e93(_0x15139b(0x169),_0x15139b(0x18a)),await _0x506e93('app','coverImg');}finally{await _0x169730[_0x15139b(0x196)]();}}async function initDatabase(){const _0x23be7a=_0x132b30;await validateDatabase(),await updateColumnType();const _0x46da85=new typeorm_1[(_0x23be7a(0x188))](dataSourceOptions);try{await _0x46da85[_0x23be7a(0x172)](),common_1[_0x23be7a(0x16a)][_0x23be7a(0x16d)]('Database\x20connected\x20and\x20synchronized\x20successfully',_0x23be7a(0x173));}catch(_0x3ebd30){common_1[_0x23be7a(0x16a)][_0x23be7a(0x17a)](_0x23be7a(0x182),_0x3ebd30);}finally{await _0x46da85[_0x23be7a(0x183)]();}}exports[_0x132b30(0x18c)]=initDatabase;