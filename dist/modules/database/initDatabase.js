'use strict';const _0x3c49f0=_0x15fa;(function(_0x135013,_0xd184a2){const _0xf5e260=_0x15fa,_0x2a4c74=_0x135013();while(!![]){try{const _0x381e34=parseInt(_0xf5e260(0x1db))/0x1+-parseInt(_0xf5e260(0x1d2))/0x2+-parseInt(_0xf5e260(0x1ca))/0x3+parseInt(_0xf5e260(0x1eb))/0x4*(parseInt(_0xf5e260(0x1e3))/0x5)+-parseInt(_0xf5e260(0x1df))/0x6*(-parseInt(_0xf5e260(0x1fd))/0x7)+parseInt(_0xf5e260(0x1ee))/0x8*(-parseInt(_0xf5e260(0x1f8))/0x9)+parseInt(_0xf5e260(0x1d0))/0xa;if(_0x381e34===_0xd184a2)break;else _0x2a4c74['push'](_0x2a4c74['shift']());}catch(_0x5b2bfe){_0x2a4c74['push'](_0x2a4c74['shift']());}}}(_0x36a8,0x2b59d));Object[_0x3c49f0(0x1e5)](exports,_0x3c49f0(0x1d8),{'value':!![]}),exports['initDatabase']=void 0x0;const common_1=require(_0x3c49f0(0x1e6)),dotenv_1=require(_0x3c49f0(0x1f4)),mysql=require(_0x3c49f0(0x1ce)),typeorm_1=require(_0x3c49f0(0x1f2));(0x0,dotenv_1[_0x3c49f0(0x1f1)])();function _0x36a8(){const _0x56b915=['initDatabase','Logger','utf8mb4','73360JKjPfn','SELECT\x20COLUMN_NAME,\x20DATA_TYPE\x20FROM\x20INFORMATION_SCHEMA.COLUMNS\x20WHERE\x20TABLE_NAME\x20=\x20?\x20AND\x20COLUMN_NAME\x20=\x20?','1026579VjGkEj','DB_DATABASE','error','execute','mysql2/promise','CREATE\x20DATABASE\x20','837530SjfIjl','Column\x20','99060cMwKdZ','Database','end','Database\x20connected\x20and\x20synchronized\x20successfully','Error\x20during\x20TypeORM\x20initialization:','DB_USER','__esModule','configVal','DB_PASS','194866DTQmHg','Error\x20updating\x20column\x20type\x20in\x20table\x20','数据库创建成功[','env','96HqwpMP','DB_HOST','/../**/*.entity{.ts,.js}','\x20is\x20already\x20of\x20type\x20TEXT\x20in\x20table\x20','874070fvxNbo','DATA_TYPE','defineProperty','@nestjs/common','createConnection','destroy','app','DB_PORT','4hqZMNG','coverImg','DataSource','200wfjIbQ','\x20type\x20updated\x20to\x20TEXT\x20in\x20table\x20','initialize','config','typeorm','mysql','dotenv','ALTER\x20TABLE\x20??\x20MODIFY\x20COLUMN\x20??\x20TEXT','Error\x20during\x20database\x20validation:','length','18657tQsRdT','log'];_0x36a8=function(){return _0x56b915;};return _0x36a8();}const dataSourceOptions={'type':_0x3c49f0(0x1f3),'port':parseInt(process['env'][_0x3c49f0(0x1ea)],0xa),'host':process[_0x3c49f0(0x1de)]['DB_HOST'],'username':process[_0x3c49f0(0x1de)][_0x3c49f0(0x1d7)],'password':process['env']['DB_PASS'],'database':process[_0x3c49f0(0x1de)][_0x3c49f0(0x1cb)],'entities':[__dirname+_0x3c49f0(0x1e1)],'logging':![],'synchronize':!![],'charset':_0x3c49f0(0x1fc),'timezone':'+08:00'};async function validateDatabase(){const _0x11fa75=_0x3c49f0,_0x4262fb=await mysql['createConnection']({'host':process[_0x11fa75(0x1de)][_0x11fa75(0x1e0)],'user':process['env'][_0x11fa75(0x1d7)],'password':process[_0x11fa75(0x1de)][_0x11fa75(0x1da)],'port':parseInt(process[_0x11fa75(0x1de)][_0x11fa75(0x1ea)],0xa)});try{const [_0x1745cb]=await _0x4262fb[_0x11fa75(0x1cd)]('SHOW\x20DATABASES\x20LIKE\x20\x27'+process['env']['DB_DATABASE']+'\x27');Array['isArray'](_0x1745cb)&&_0x1745cb['length']===0x0?(await _0x4262fb['execute'](_0x11fa75(0x1cf)+process['env']['DB_DATABASE']),common_1[_0x11fa75(0x1fb)]['log'](_0x11fa75(0x1dd)+process[_0x11fa75(0x1de)]['DB_DATABASE']+']',_0x11fa75(0x1d3))):common_1[_0x11fa75(0x1fb)][_0x11fa75(0x1f9)]('数据库已存在['+process[_0x11fa75(0x1de)]['DB_DATABASE']+']',_0x11fa75(0x1d3));}catch(_0xd8dcf3){common_1['Logger'][_0x11fa75(0x1cc)](_0x11fa75(0x1f6),_0xd8dcf3,_0x11fa75(0x1d3));}finally{await _0x4262fb[_0x11fa75(0x1d4)]();}}async function updateColumnType(){const _0xb99644=_0x3c49f0,_0x1e3a96=await mysql[_0xb99644(0x1e7)]({'host':process[_0xb99644(0x1de)][_0xb99644(0x1e0)],'user':process['env'][_0xb99644(0x1d7)],'password':process['env'][_0xb99644(0x1da)],'port':parseInt(process[_0xb99644(0x1de)]['DB_PORT'],0xa),'database':process['env'][_0xb99644(0x1cb)]});async function _0x3923d9(_0x1440b7,_0x492a4c){const _0x568c3c=_0xb99644;try{const [_0x2f54b2]=await _0x1e3a96[_0x568c3c(0x1cd)](_0x568c3c(0x1c9),[_0x1440b7,_0x492a4c]);_0x2f54b2[_0x568c3c(0x1f7)]>0x0&&_0x2f54b2[0x0][_0x568c3c(0x1e4)]!=='text'?(await _0x1e3a96[_0x568c3c(0x1cd)](_0x568c3c(0x1f5),[_0x1440b7,_0x492a4c]),common_1[_0x568c3c(0x1fb)]['log'](_0x568c3c(0x1d1)+_0x492a4c+_0x568c3c(0x1ef)+_0x1440b7,_0x568c3c(0x1d3))):common_1[_0x568c3c(0x1fb)][_0x568c3c(0x1f9)](_0x568c3c(0x1d1)+_0x492a4c+_0x568c3c(0x1e2)+_0x1440b7,_0x568c3c(0x1d3));}catch(_0x53262){common_1[_0x568c3c(0x1fb)]['error'](_0x568c3c(0x1dc)+_0x1440b7+':',_0x53262);}}try{await _0x3923d9(_0xb99644(0x1f1),_0xb99644(0x1d9)),await _0x3923d9(_0xb99644(0x1e9),_0xb99644(0x1ec));}finally{await _0x1e3a96[_0xb99644(0x1d4)]();}}function _0x15fa(_0xb22c99,_0x1044b9){const _0x36a8e4=_0x36a8();return _0x15fa=function(_0x15fab1,_0xb93a4a){_0x15fab1=_0x15fab1-0x1c9;let _0x17ca2f=_0x36a8e4[_0x15fab1];return _0x17ca2f;},_0x15fa(_0xb22c99,_0x1044b9);}async function initDatabase(){const _0xde57ea=_0x3c49f0;await validateDatabase(),await updateColumnType();const _0x468efe=new typeorm_1[(_0xde57ea(0x1ed))](dataSourceOptions);try{await _0x468efe[_0xde57ea(0x1f0)](),common_1[_0xde57ea(0x1fb)][_0xde57ea(0x1f9)](_0xde57ea(0x1d5),_0xde57ea(0x1d3));}catch(_0x359071){common_1[_0xde57ea(0x1fb)][_0xde57ea(0x1cc)](_0xde57ea(0x1d6),_0x359071);}finally{await _0x468efe[_0xde57ea(0x1e8)]();}}exports[_0x3c49f0(0x1fa)]=initDatabase;