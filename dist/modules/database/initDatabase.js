'use strict';const _0x40030d=_0x50a3;(function(_0xecc28c,_0x4ad745){const _0x196932=_0x50a3,_0x359739=_0xecc28c();while(!![]){try{const _0x337ded=parseInt(_0x196932(0xd6))/0x1*(parseInt(_0x196932(0xca))/0x2)+parseInt(_0x196932(0xc0))/0x3*(-parseInt(_0x196932(0xd2))/0x4)+-parseInt(_0x196932(0xe1))/0x5+-parseInt(_0x196932(0xd7))/0x6*(-parseInt(_0x196932(0xc7))/0x7)+parseInt(_0x196932(0xd5))/0x8*(-parseInt(_0x196932(0xda))/0x9)+-parseInt(_0x196932(0xc2))/0xa+-parseInt(_0x196932(0xd1))/0xb*(-parseInt(_0x196932(0xcd))/0xc);if(_0x337ded===_0x4ad745)break;else _0x359739['push'](_0x359739['shift']());}catch(_0x3c7404){_0x359739['push'](_0x359739['shift']());}}}(_0x1f50,0x7db11));function _0x50a3(_0xed9dd9,_0x373f47){const _0x1f5068=_0x1f50();return _0x50a3=function(_0x50a36f,_0x38bd08){_0x50a36f=_0x50a36f-0xbc;let _0x1e68f8=_0x1f5068[_0x50a36f];return _0x1e68f8;},_0x50a3(_0xed9dd9,_0x373f47);}Object[_0x40030d(0xcb)](exports,_0x40030d(0xc9),{'value':!![]}),exports[_0x40030d(0xc1)]=void 0x0;const common_1=require('@nestjs/common'),dotenv_1=require('dotenv'),mysql=require('mysql2/promise'),typeorm_1=require(_0x40030d(0xd8));(0x0,dotenv_1['config'])();const dataSourceOptions={'type':_0x40030d(0xe2),'port':parseInt(process['env']['DB_PORT'],0xa),'host':process['env'][_0x40030d(0xdb)],'username':process[_0x40030d(0xdf)][_0x40030d(0xbf)],'password':process[_0x40030d(0xdf)][_0x40030d(0xbd)],'database':process[_0x40030d(0xdf)][_0x40030d(0xbe)],'entities':[__dirname+_0x40030d(0xc6)],'logging':![],'synchronize':!![],'charset':_0x40030d(0xdd),'timezone':_0x40030d(0xe6)};async function validateDatabase(){const _0x1dbeee=_0x40030d,_0x2813cd=await mysql['createConnection']({'host':process[_0x1dbeee(0xdf)][_0x1dbeee(0xdb)],'user':process['env']['DB_USER'],'password':process['env'][_0x1dbeee(0xbd)],'port':parseInt(process[_0x1dbeee(0xdf)][_0x1dbeee(0xcf)],0xa)});try{const [_0x561b9a]=await _0x2813cd[_0x1dbeee(0xdc)]('SHOW\x20DATABASES\x20LIKE\x20\x27'+process['env'][_0x1dbeee(0xbe)]+'\x27');Array['isArray'](_0x561b9a)&&_0x561b9a[_0x1dbeee(0xc8)]===0x0?(await _0x2813cd[_0x1dbeee(0xdc)]('CREATE\x20DATABASE\x20'+process[_0x1dbeee(0xdf)]['DB_DATABASE']),common_1[_0x1dbeee(0xd4)]['log']('数据库创建成功['+process[_0x1dbeee(0xdf)][_0x1dbeee(0xbe)]+']',_0x1dbeee(0xd3))):common_1['Logger'][_0x1dbeee(0xe0)](_0x1dbeee(0xc5)+process['env']['DB_DATABASE']+']','Database');}catch(_0x2011c3){common_1[_0x1dbeee(0xd4)][_0x1dbeee(0xc4)](_0x1dbeee(0xec),_0x2011c3,'Database');}finally{await _0x2813cd[_0x1dbeee(0xe8)]();}}async function updateColumnType(){const _0x164b62=_0x40030d,_0x5e0d43=await mysql[_0x164b62(0xbc)]({'host':process[_0x164b62(0xdf)]['DB_HOST'],'user':process[_0x164b62(0xdf)]['DB_USER'],'password':process['env'][_0x164b62(0xbd)],'port':parseInt(process[_0x164b62(0xdf)][_0x164b62(0xcf)],0xa),'database':process['env'][_0x164b62(0xbe)]});async function _0x5a93f2(_0x5d6079,_0x26b12a){const _0x5a464a=_0x164b62;try{const [_0x4ad4ce]=await _0x5e0d43[_0x5a464a(0xdc)](_0x5a464a(0xc3),[_0x5d6079,_0x26b12a]);_0x4ad4ce[_0x5a464a(0xc8)]>0x0&&_0x4ad4ce[0x0][_0x5a464a(0xcc)]!==_0x5a464a(0xce)?(await _0x5e0d43['execute'](_0x5a464a(0xe4),[_0x5d6079,_0x26b12a]),common_1[_0x5a464a(0xd4)][_0x5a464a(0xe0)]('Column\x20'+_0x26b12a+_0x5a464a(0xe7)+_0x5d6079,_0x5a464a(0xd3))):common_1[_0x5a464a(0xd4)][_0x5a464a(0xe0)](_0x5a464a(0xd0)+_0x26b12a+'\x20is\x20already\x20of\x20type\x20TEXT\x20in\x20table\x20'+_0x5d6079,'Database');}catch(_0x5cad80){common_1[_0x5a464a(0xd4)][_0x5a464a(0xc4)](_0x5a464a(0xd9)+_0x5d6079+':',_0x5cad80);}}try{await _0x5a93f2('config',_0x164b62(0xe9)),await _0x5a93f2(_0x164b62(0xe3),_0x164b62(0xeb));}finally{await _0x5e0d43[_0x164b62(0xe8)]();}}async function initDatabase(){const _0x4c2f98=_0x40030d;await validateDatabase(),await updateColumnType();const _0x4d84ca=new typeorm_1['DataSource'](dataSourceOptions);try{await _0x4d84ca[_0x4c2f98(0xea)](),common_1[_0x4c2f98(0xd4)][_0x4c2f98(0xe0)](_0x4c2f98(0xe5),_0x4c2f98(0xd3));}catch(_0xfe405){common_1['Logger'][_0x4c2f98(0xc4)](_0x4c2f98(0xde),_0xfe405);}finally{await _0x4d84ca['destroy']();}}exports[_0x40030d(0xc1)]=initDatabase;function _0x1f50(){const _0x476a96=['coverImg','Error\x20during\x20database\x20validation:','createConnection','DB_PASS','DB_DATABASE','DB_USER','597NwzNWG','initDatabase','867600beqNHE','SELECT\x20COLUMN_NAME,\x20DATA_TYPE\x20FROM\x20INFORMATION_SCHEMA.COLUMNS\x20WHERE\x20TABLE_NAME\x20=\x20?\x20AND\x20COLUMN_NAME\x20=\x20?','error','数据库已存在[','/../**/*.entity{.ts,.js}','3481457OwPNxF','length','__esModule','2uVePCk','defineProperty','DATA_TYPE','29364WbqSeO','text','DB_PORT','Column\x20','3058mGbsqm','4412qzoINe','Database','Logger','1717320HGBqjA','580094dyuuDq','6BkDNSO','typeorm','Error\x20updating\x20column\x20type\x20in\x20table\x20','27vIfczq','DB_HOST','execute','utf8mb4','Error\x20during\x20TypeORM\x20initialization:','env','log','1463130tkMIFm','mysql','app','ALTER\x20TABLE\x20??\x20MODIFY\x20COLUMN\x20??\x20TEXT','Database\x20connected\x20and\x20synchronized\x20successfully','+08:00','\x20type\x20updated\x20to\x20TEXT\x20in\x20table\x20','end','configVal','initialize'];_0x1f50=function(){return _0x476a96;};return _0x1f50();}