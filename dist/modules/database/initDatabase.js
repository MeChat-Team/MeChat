'use strict';const _0x2e03e3=_0x2ec2;(function(_0x23d80a,_0x3adc1c){const _0x2f78ae=_0x2ec2,_0x4324d3=_0x23d80a();while(!![]){try{const _0x15bcd3=-parseInt(_0x2f78ae(0xd1))/0x1*(-parseInt(_0x2f78ae(0xc7))/0x2)+parseInt(_0x2f78ae(0xb8))/0x3*(-parseInt(_0x2f78ae(0xe5))/0x4)+-parseInt(_0x2f78ae(0xd4))/0x5*(parseInt(_0x2f78ae(0xd2))/0x6)+-parseInt(_0x2f78ae(0xb7))/0x7*(parseInt(_0x2f78ae(0xbf))/0x8)+parseInt(_0x2f78ae(0xd5))/0x9*(parseInt(_0x2f78ae(0xc6))/0xa)+-parseInt(_0x2f78ae(0xdf))/0xb*(-parseInt(_0x2f78ae(0xd8))/0xc)+-parseInt(_0x2f78ae(0xe8))/0xd*(-parseInt(_0x2f78ae(0xdd))/0xe);if(_0x15bcd3===_0x3adc1c)break;else _0x4324d3['push'](_0x4324d3['shift']());}catch(_0x58e583){_0x4324d3['push'](_0x4324d3['shift']());}}}(_0x2848,0xde002));Object[_0x2e03e3(0xca)](exports,_0x2e03e3(0xd3),{'value':!![]}),exports['initDatabase']=void 0x0;function _0x2848(){const _0x53237d=['mysql','dotenv','Logger','数据库创建成功[','Database\x20connected\x20and\x20synchronized\x20successfully','4482652XzaqcX','initialize','execute','2186119ifzjFe','length','/../**/*.entity{.ts,.js}','DB_HOST','168oJoYFa','3xUzCNK','\x20type\x20updated\x20to\x20TEXT\x20in\x20table\x20','DB_PASS','text','Column\x20','configVal','Database','352136FJJlJB','createConnection','typeorm','SELECT\x20COLUMN_NAME,\x20DATA_TYPE\x20FROM\x20INFORMATION_SCHEMA.COLUMNS\x20WHERE\x20TABLE_NAME\x20=\x20?\x20AND\x20COLUMN_NAME\x20=\x20?','DataSource','DB_PORT','error','1200070Jmqwux','1000dTJjHN','log','DB_DATABASE','defineProperty','DATA_TYPE','mysql2/promise','destroy','\x20is\x20already\x20of\x20type\x20TEXT\x20in\x20table\x20','DB_USER','CREATE\x20DATABASE\x20','1950xWZDBO','829410MGSRiC','__esModule','5KhthYf','90imkNNK','数据库已存在[','utf8mb4','500964GwlWsZ','env','ALTER\x20TABLE\x20??\x20MODIFY\x20COLUMN\x20??\x20TEXT','coverImg','Error\x20during\x20database\x20validation:','70QlvtBD','end','55FYwnyh'];_0x2848=function(){return _0x53237d;};return _0x2848();}const common_1=require('@nestjs/common'),dotenv_1=require(_0x2e03e3(0xe1)),mysql=require(_0x2e03e3(0xcc)),typeorm_1=require(_0x2e03e3(0xc1));(0x0,dotenv_1['config'])();const dataSourceOptions={'type':_0x2e03e3(0xe0),'port':parseInt(process['env']['DB_PORT'],0xa),'host':process['env'][_0x2e03e3(0xb6)],'username':process[_0x2e03e3(0xd9)][_0x2e03e3(0xcf)],'password':process[_0x2e03e3(0xd9)][_0x2e03e3(0xba)],'database':process[_0x2e03e3(0xd9)][_0x2e03e3(0xc9)],'entities':[__dirname+_0x2e03e3(0xb5)],'logging':![],'synchronize':!![],'charset':_0x2e03e3(0xd7),'timezone':'+08:00'};async function validateDatabase(){const _0x479687=_0x2e03e3,_0x1aa5db=await mysql[_0x479687(0xc0)]({'host':process['env'][_0x479687(0xb6)],'user':process['env'][_0x479687(0xcf)],'password':process['env'][_0x479687(0xba)],'port':parseInt(process['env']['DB_PORT'],0xa)});try{const [_0x123cb]=await _0x1aa5db['execute']('SHOW\x20DATABASES\x20LIKE\x20\x27'+process[_0x479687(0xd9)][_0x479687(0xc9)]+'\x27');Array['isArray'](_0x123cb)&&_0x123cb[_0x479687(0xb4)]===0x0?(await _0x1aa5db[_0x479687(0xe7)](_0x479687(0xd0)+process['env'][_0x479687(0xc9)]),common_1[_0x479687(0xe2)][_0x479687(0xc8)](_0x479687(0xe3)+process[_0x479687(0xd9)][_0x479687(0xc9)]+']',_0x479687(0xbe))):common_1[_0x479687(0xe2)][_0x479687(0xc8)](_0x479687(0xd6)+process[_0x479687(0xd9)][_0x479687(0xc9)]+']','Database');}catch(_0x39b9e5){common_1[_0x479687(0xe2)]['error'](_0x479687(0xdc),_0x39b9e5,_0x479687(0xbe));}finally{await _0x1aa5db[_0x479687(0xde)]();}}function _0x2ec2(_0xde7ace,_0x46a24b){const _0x28484a=_0x2848();return _0x2ec2=function(_0x2ec26d,_0x56bd52){_0x2ec26d=_0x2ec26d-0xb4;let _0x50a06b=_0x28484a[_0x2ec26d];return _0x50a06b;},_0x2ec2(_0xde7ace,_0x46a24b);}async function updateColumnType(){const _0x1b910a=_0x2e03e3,_0x3a7dfb=await mysql[_0x1b910a(0xc0)]({'host':process[_0x1b910a(0xd9)][_0x1b910a(0xb6)],'user':process[_0x1b910a(0xd9)][_0x1b910a(0xcf)],'password':process['env'][_0x1b910a(0xba)],'port':parseInt(process[_0x1b910a(0xd9)][_0x1b910a(0xc4)],0xa),'database':process[_0x1b910a(0xd9)][_0x1b910a(0xc9)]});async function _0x4993a3(_0x36ac63,_0x1a225b){const _0x8f2472=_0x1b910a;try{const [_0x315fc2]=await _0x3a7dfb['execute'](_0x8f2472(0xc2),[_0x36ac63,_0x1a225b]);_0x315fc2[_0x8f2472(0xb4)]>0x0&&_0x315fc2[0x0][_0x8f2472(0xcb)]!==_0x8f2472(0xbb)?(await _0x3a7dfb[_0x8f2472(0xe7)](_0x8f2472(0xda),[_0x36ac63,_0x1a225b]),common_1['Logger']['log'](_0x8f2472(0xbc)+_0x1a225b+_0x8f2472(0xb9)+_0x36ac63,'Database')):common_1['Logger']['log'](_0x8f2472(0xbc)+_0x1a225b+_0x8f2472(0xce)+_0x36ac63,_0x8f2472(0xbe));}catch(_0xc59d4e){common_1[_0x8f2472(0xe2)][_0x8f2472(0xc5)]('Error\x20updating\x20column\x20type\x20in\x20table\x20'+_0x36ac63+':',_0xc59d4e);}}try{await _0x4993a3('config',_0x1b910a(0xbd)),await _0x4993a3('app',_0x1b910a(0xdb));}finally{await _0x3a7dfb[_0x1b910a(0xde)]();}}async function initDatabase(){const _0x7893cb=_0x2e03e3;await validateDatabase(),await updateColumnType();const _0x4355b3=new typeorm_1[(_0x7893cb(0xc3))](dataSourceOptions);try{await _0x4355b3[_0x7893cb(0xe6)](),common_1[_0x7893cb(0xe2)][_0x7893cb(0xc8)](_0x7893cb(0xe4),_0x7893cb(0xbe));}catch(_0x230aed){common_1[_0x7893cb(0xe2)][_0x7893cb(0xc5)]('Error\x20during\x20TypeORM\x20initialization:',_0x230aed);}finally{await _0x4355b3[_0x7893cb(0xcd)]();}}exports['initDatabase']=initDatabase;