'use strict';const _0x4593e8=_0x2f6a;(function(_0x4976e2,_0x524d0e){const _0x1f5f74=_0x2f6a,_0x73dc5f=_0x4976e2();while(!![]){try{const _0x82a908=parseInt(_0x1f5f74(0xa4))/0x1*(parseInt(_0x1f5f74(0xa8))/0x2)+parseInt(_0x1f5f74(0x93))/0x3+parseInt(_0x1f5f74(0xa9))/0x4+-parseInt(_0x1f5f74(0xb0))/0x5*(-parseInt(_0x1f5f74(0xa0))/0x6)+parseInt(_0x1f5f74(0xb6))/0x7+parseInt(_0x1f5f74(0x8a))/0x8*(-parseInt(_0x1f5f74(0x97))/0x9)+-parseInt(_0x1f5f74(0xac))/0xa*(parseInt(_0x1f5f74(0xad))/0xb);if(_0x82a908===_0x524d0e)break;else _0x73dc5f['push'](_0x73dc5f['shift']());}catch(_0x35675a){_0x73dc5f['push'](_0x73dc5f['shift']());}}}(_0x4534,0x71118));function _0x2f6a(_0x2dbcab,_0x390e30){const _0x453415=_0x4534();return _0x2f6a=function(_0x2f6a35,_0x4e04ff){_0x2f6a35=_0x2f6a35-0x87;let _0x47c4af=_0x453415[_0x2f6a35];return _0x47c4af;},_0x2f6a(_0x2dbcab,_0x390e30);}Object['defineProperty'](exports,_0x4593e8(0xb2),{'value':!![]}),exports[_0x4593e8(0x87)]=void 0x0;const common_1=require(_0x4593e8(0xa6)),dotenv_1=require(_0x4593e8(0xa7)),mysql=require(_0x4593e8(0x9e)),typeorm_1=require(_0x4593e8(0x9c));(0x0,dotenv_1[_0x4593e8(0xb5)])();const dataSourceOptions={'type':_0x4593e8(0xaa),'port':parseInt(process[_0x4593e8(0x8d)][_0x4593e8(0xab)],0xa),'host':process['env'][_0x4593e8(0xa3)],'username':process[_0x4593e8(0x8d)][_0x4593e8(0xb7)],'password':process[_0x4593e8(0x8d)][_0x4593e8(0x98)],'database':process['env']['DB_DATABASE'],'entities':[__dirname+'/../**/*.entity{.ts,.js}'],'logging':![],'synchronize':!![],'charset':_0x4593e8(0x88),'timezone':'+08:00'};async function validateDatabase(){const _0x47149d=_0x4593e8,_0x37e429=await mysql['createConnection']({'host':process[_0x47149d(0x8d)][_0x47149d(0xa3)],'user':process[_0x47149d(0x8d)][_0x47149d(0xb7)],'password':process[_0x47149d(0x8d)][_0x47149d(0x98)],'port':parseInt(process[_0x47149d(0x8d)]['DB_PORT'],0xa)});try{const [_0x1325b9]=await _0x37e429[_0x47149d(0x8c)](_0x47149d(0xaf)+process[_0x47149d(0x8d)][_0x47149d(0xb4)]+'\x27');Array[_0x47149d(0x94)](_0x1325b9)&&_0x1325b9['length']===0x0?(await _0x37e429[_0x47149d(0x8c)](_0x47149d(0x9f)+process['env']['DB_DATABASE']),common_1['Logger'][_0x47149d(0x8b)](_0x47149d(0xb1)+process[_0x47149d(0x8d)][_0x47149d(0xb4)]+']',_0x47149d(0x89))):common_1[_0x47149d(0x99)][_0x47149d(0x8b)](_0x47149d(0x9b)+process[_0x47149d(0x8d)][_0x47149d(0xb4)]+']',_0x47149d(0x89));}catch(_0x172a34){common_1[_0x47149d(0x99)]['error'](_0x47149d(0xa5),_0x172a34,_0x47149d(0x89));}finally{await _0x37e429[_0x47149d(0x91)]();}}async function updateColumnType(){const _0x430ca1=_0x4593e8,_0x20fbff=await mysql[_0x430ca1(0x9d)]({'host':process['env'][_0x430ca1(0xa3)],'user':process[_0x430ca1(0x8d)][_0x430ca1(0xb7)],'password':process[_0x430ca1(0x8d)][_0x430ca1(0x98)],'port':parseInt(process[_0x430ca1(0x8d)]['DB_PORT'],0xa),'database':process[_0x430ca1(0x8d)][_0x430ca1(0xb4)]});async function _0x486b72(_0x48088b,_0x3190de){const _0x5b6d59=_0x430ca1;try{const [_0x17b87d]=await _0x20fbff[_0x5b6d59(0x8c)](_0x5b6d59(0x90),[_0x48088b,_0x3190de]);_0x17b87d['length']>0x0&&_0x17b87d[0x0]['DATA_TYPE']!==_0x5b6d59(0xa2)?(await _0x20fbff[_0x5b6d59(0x8c)](_0x5b6d59(0x92),[_0x48088b,_0x3190de]),common_1['Logger'][_0x5b6d59(0x8b)](_0x5b6d59(0xa1)+_0x3190de+'\x20type\x20updated\x20to\x20TEXT\x20in\x20table\x20'+_0x48088b,_0x5b6d59(0x89))):common_1[_0x5b6d59(0x99)][_0x5b6d59(0x8b)]('Column\x20'+_0x3190de+_0x5b6d59(0xb3)+_0x48088b,_0x5b6d59(0x89));}catch(_0x2d51bb){common_1[_0x5b6d59(0x99)]['error']('Error\x20updating\x20column\x20type\x20in\x20table\x20'+_0x48088b+':',_0x2d51bb);}}try{await _0x486b72('config','configVal'),await _0x486b72(_0x430ca1(0x95),_0x430ca1(0x8e));}finally{await _0x20fbff[_0x430ca1(0x91)]();}}async function initDatabase(){const _0x2ee450=_0x4593e8;await validateDatabase(),await updateColumnType();const _0x187998=new typeorm_1['DataSource'](dataSourceOptions);try{await _0x187998[_0x2ee450(0x96)](),common_1['Logger'][_0x2ee450(0x8b)](_0x2ee450(0x8f),_0x2ee450(0x89));}catch(_0x228e87){common_1[_0x2ee450(0x99)][_0x2ee450(0xae)]('Error\x20during\x20TypeORM\x20initialization:',_0x228e87);}finally{await _0x187998[_0x2ee450(0x9a)]();}}function _0x4534(){const _0x2de35a=['isArray','app','initialize','9abKLkl','DB_PASS','Logger','destroy','数据库已存在[','typeorm','createConnection','mysql2/promise','CREATE\x20DATABASE\x20','12LGlCza','Column\x20','text','DB_HOST','13QzmOjM','Error\x20during\x20database\x20validation:','@nestjs/common','dotenv','15430CFHNSB','2342996RTOVoZ','mysql','DB_PORT','16470apzZnq','5731OXhLIG','error','SHOW\x20DATABASES\x20LIKE\x20\x27','951695PdOagf','数据库创建成功[','__esModule','\x20is\x20already\x20of\x20type\x20TEXT\x20in\x20table\x20','DB_DATABASE','config','338219veDyWW','DB_USER','initDatabase','utf8mb4','Database','4508576oQOLfV','log','execute','env','coverImg','Database\x20connected\x20and\x20synchronized\x20successfully','SELECT\x20COLUMN_NAME,\x20DATA_TYPE\x20FROM\x20INFORMATION_SCHEMA.COLUMNS\x20WHERE\x20TABLE_NAME\x20=\x20?\x20AND\x20COLUMN_NAME\x20=\x20?','end','ALTER\x20TABLE\x20??\x20MODIFY\x20COLUMN\x20??\x20TEXT','2309244NZNyUm'];_0x4534=function(){return _0x2de35a;};return _0x4534();}exports[_0x4593e8(0x87)]=initDatabase;