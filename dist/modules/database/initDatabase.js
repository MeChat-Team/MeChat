'use strict';const _0xd9f59=_0x2e79;(function(_0x3e47b4,_0x8b261e){const _0x4f9748=_0x2e79,_0x1fef1d=_0x3e47b4();while(!![]){try{const _0x3de963=parseInt(_0x4f9748(0xc6))/0x1*(parseInt(_0x4f9748(0xe0))/0x2)+parseInt(_0x4f9748(0xde))/0x3*(-parseInt(_0x4f9748(0xdf))/0x4)+-parseInt(_0x4f9748(0xc5))/0x5*(parseInt(_0x4f9748(0xc1))/0x6)+-parseInt(_0x4f9748(0xe2))/0x7+-parseInt(_0x4f9748(0xbb))/0x8*(-parseInt(_0x4f9748(0xeb))/0x9)+parseInt(_0x4f9748(0xd1))/0xa+-parseInt(_0x4f9748(0xd4))/0xb;if(_0x3de963===_0x8b261e)break;else _0x1fef1d['push'](_0x1fef1d['shift']());}catch(_0x72ba13){_0x1fef1d['push'](_0x1fef1d['shift']());}}}(_0x2eb2,0xbff07));Object[_0xd9f59(0xec)](exports,_0xd9f59(0xe8),{'value':!![]}),exports[_0xd9f59(0xe5)]=void 0x0;const common_1=require(_0xd9f59(0xd7)),dotenv_1=require(_0xd9f59(0xbf)),mysql=require('mysql2/promise'),typeorm_1=require('typeorm');(0x0,dotenv_1[_0xd9f59(0xbe)])();function _0x2e79(_0x2746a4,_0x7f5c8f){const _0x2eb2ca=_0x2eb2();return _0x2e79=function(_0x2e795a,_0x328173){_0x2e795a=_0x2e795a-0xbb;let _0x116faf=_0x2eb2ca[_0x2e795a];return _0x116faf;},_0x2e79(_0x2746a4,_0x7f5c8f);}const dataSourceOptions={'type':_0xd9f59(0xe3),'port':parseInt(process[_0xd9f59(0xc8)][_0xd9f59(0xea)],0xa),'host':process[_0xd9f59(0xc8)]['DB_HOST'],'username':process[_0xd9f59(0xc8)][_0xd9f59(0xc2)],'password':process[_0xd9f59(0xc8)][_0xd9f59(0xc7)],'database':process[_0xd9f59(0xc8)][_0xd9f59(0xbd)],'entities':[__dirname+_0xd9f59(0xd3)],'logging':![],'synchronize':!![],'charset':'utf8mb4','timezone':_0xd9f59(0xca)};async function validateDatabase(){const _0x50f978=_0xd9f59,_0x43c2f2=await mysql[_0x50f978(0xc3)]({'host':process[_0x50f978(0xc8)]['DB_HOST'],'user':process[_0x50f978(0xc8)]['DB_USER'],'password':process[_0x50f978(0xc8)]['DB_PASS'],'port':parseInt(process[_0x50f978(0xc8)][_0x50f978(0xea)],0xa)});try{const [_0x1d26e2]=await _0x43c2f2[_0x50f978(0xd0)](_0x50f978(0xbc)+process['env'][_0x50f978(0xbd)]+'\x27');Array[_0x50f978(0xd6)](_0x1d26e2)&&_0x1d26e2['length']===0x0?(await _0x43c2f2[_0x50f978(0xd0)](_0x50f978(0xe4)+process['env']['DB_DATABASE']),common_1['Logger'][_0x50f978(0xdd)](_0x50f978(0xee)+process[_0x50f978(0xc8)][_0x50f978(0xbd)]+']',_0x50f978(0xe6))):common_1[_0x50f978(0xed)][_0x50f978(0xdd)](_0x50f978(0xc4)+process[_0x50f978(0xc8)][_0x50f978(0xbd)]+']',_0x50f978(0xe6));}catch(_0x2d7868){common_1[_0x50f978(0xed)][_0x50f978(0xcc)](_0x50f978(0xda),_0x2d7868,_0x50f978(0xe6));}finally{await _0x43c2f2[_0x50f978(0xdb)]();}}async function updateColumnType(){const _0x175f8c=_0xd9f59,_0x570f0c=await mysql[_0x175f8c(0xc3)]({'host':process['env'][_0x175f8c(0xce)],'user':process[_0x175f8c(0xc8)][_0x175f8c(0xc2)],'password':process['env']['DB_PASS'],'port':parseInt(process['env'][_0x175f8c(0xea)],0xa),'database':process[_0x175f8c(0xc8)][_0x175f8c(0xbd)]});async function _0x2f6792(_0xd4b567,_0x1d31e1){const _0x5edac1=_0x175f8c;try{const [_0x255260]=await _0x570f0c[_0x5edac1(0xd0)](_0x5edac1(0xdc),[_0xd4b567,_0x1d31e1]);_0x255260[_0x5edac1(0xd8)]>0x0&&_0x255260[0x0][_0x5edac1(0xcb)]!==_0x5edac1(0xcf)?(await _0x570f0c[_0x5edac1(0xd0)](_0x5edac1(0xd2),[_0xd4b567,_0x1d31e1]),common_1[_0x5edac1(0xed)]['log'](_0x5edac1(0xe1)+_0x1d31e1+_0x5edac1(0xc0)+_0xd4b567,_0x5edac1(0xe6))):common_1[_0x5edac1(0xed)]['log']('Column\x20'+_0x1d31e1+_0x5edac1(0xe9)+_0xd4b567,'Database');}catch(_0x47dad2){common_1[_0x5edac1(0xed)][_0x5edac1(0xcc)]('Error\x20updating\x20column\x20type\x20in\x20table\x20'+_0xd4b567+':',_0x47dad2);}}try{await _0x2f6792(_0x175f8c(0xbe),_0x175f8c(0xd5)),await _0x2f6792('app',_0x175f8c(0xc9));}finally{await _0x570f0c[_0x175f8c(0xdb)]();}}function _0x2eb2(){const _0x1406d2=['log','27trbtFP','500740QlCCsP','2930470WoiINH','Column\x20','50477rnhxXt','mysql','CREATE\x20DATABASE\x20','initDatabase','Database','initialize','__esModule','\x20is\x20already\x20of\x20type\x20TEXT\x20in\x20table\x20','DB_PORT','2938527OxdWGs','defineProperty','Logger','数据库创建成功[','8nvvHQL','SHOW\x20DATABASES\x20LIKE\x20\x27','DB_DATABASE','config','dotenv','\x20type\x20updated\x20to\x20TEXT\x20in\x20table\x20','1568574jXxIZN','DB_USER','createConnection','数据库已存在[','15rkCCVY','1UvwCHi','DB_PASS','env','coverImg','+08:00','DATA_TYPE','error','Database\x20connected\x20and\x20synchronized\x20successfully','DB_HOST','text','execute','14975100bYOtRr','ALTER\x20TABLE\x20??\x20MODIFY\x20COLUMN\x20??\x20TEXT','/../**/*.entity{.ts,.js}','6433922zHCXTT','configVal','isArray','@nestjs/common','length','DataSource','Error\x20during\x20database\x20validation:','end','SELECT\x20COLUMN_NAME,\x20DATA_TYPE\x20FROM\x20INFORMATION_SCHEMA.COLUMNS\x20WHERE\x20TABLE_NAME\x20=\x20?\x20AND\x20COLUMN_NAME\x20=\x20?'];_0x2eb2=function(){return _0x1406d2;};return _0x2eb2();}async function initDatabase(){const _0x3ecbe3=_0xd9f59;await validateDatabase(),await updateColumnType();const _0x1d4da7=new typeorm_1[(_0x3ecbe3(0xd9))](dataSourceOptions);try{await _0x1d4da7[_0x3ecbe3(0xe7)](),common_1[_0x3ecbe3(0xed)][_0x3ecbe3(0xdd)](_0x3ecbe3(0xcd),'Database');}catch(_0x4dd46b){common_1[_0x3ecbe3(0xed)][_0x3ecbe3(0xcc)]('Error\x20during\x20TypeORM\x20initialization:',_0x4dd46b);}finally{await _0x1d4da7['destroy']();}}exports[_0xd9f59(0xe5)]=initDatabase;