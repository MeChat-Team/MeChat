'use strict';const _0x5a6511=_0x26c6;(function(_0x354672,_0x4f02d9){const _0x27f249=_0x26c6,_0x56ef48=_0x354672();while(!![]){try{const _0x426cf2=parseInt(_0x27f249(0x1f4))/0x1*(parseInt(_0x27f249(0x209))/0x2)+-parseInt(_0x27f249(0x1fc))/0x3*(-parseInt(_0x27f249(0x1e7))/0x4)+-parseInt(_0x27f249(0x200))/0x5*(parseInt(_0x27f249(0x1e8))/0x6)+parseInt(_0x27f249(0x1f9))/0x7+parseInt(_0x27f249(0x206))/0x8*(-parseInt(_0x27f249(0x211))/0x9)+-parseInt(_0x27f249(0x1f8))/0xa*(-parseInt(_0x27f249(0x1f2))/0xb)+-parseInt(_0x27f249(0x20a))/0xc;if(_0x426cf2===_0x4f02d9)break;else _0x56ef48['push'](_0x56ef48['shift']());}catch(_0x120fb8){_0x56ef48['push'](_0x56ef48['shift']());}}}(_0x331d,0xda41a));Object[_0x5a6511(0x20d)](exports,_0x5a6511(0x1e3),{'value':!![]}),exports[_0x5a6511(0x1fa)]=void 0x0;function _0x331d(){const _0x569fb3=['6081966GmsWPR','config','SHOW\x20DATABASES\x20LIKE\x20\x27','CREATE\x20DATABASE\x20','__esModule','execute','SELECT\x20COLUMN_NAME,\x20DATA_TYPE\x20FROM\x20INFORMATION_SCHEMA.COLUMNS\x20WHERE\x20TABLE_NAME\x20=\x20?\x20AND\x20COLUMN_NAME\x20=\x20?','DB_DATABASE','292KtArqb','5887890IqXvmZ','utf8mb4','end','text','DB_HOST','isArray','Error\x20during\x20TypeORM\x20initialization:','Logger','DB_USER','app','4319271uStcZE','typeorm','92348GiPTFv','数据库创建成功[','@nestjs/common','DB_PASS','20cppzUr','4818870bKiPYz','initDatabase','destroy','23901fLQiXP','configVal','/../**/*.entity{.ts,.js}','Database','5Zlgxkk','error','DB_PORT','Column\x20','initialize','ALTER\x20TABLE\x20??\x20MODIFY\x20COLUMN\x20??\x20TEXT','8PHkyjy','Error\x20during\x20database\x20validation:','mysql2/promise','26FYXSVs','8457360qrrlRC','length','log','defineProperty','Error\x20updating\x20column\x20type\x20in\x20table\x20','dotenv','env'];_0x331d=function(){return _0x569fb3;};return _0x331d();}const common_1=require(_0x5a6511(0x1f6)),dotenv_1=require(_0x5a6511(0x20f)),mysql=require(_0x5a6511(0x208)),typeorm_1=require(_0x5a6511(0x1f3));(0x0,dotenv_1[_0x5a6511(0x212)])();const dataSourceOptions={'type':'mysql','port':parseInt(process[_0x5a6511(0x210)][_0x5a6511(0x202)],0xa),'host':process[_0x5a6511(0x210)][_0x5a6511(0x1ec)],'username':process[_0x5a6511(0x210)][_0x5a6511(0x1f0)],'password':process[_0x5a6511(0x210)][_0x5a6511(0x1f7)],'database':process[_0x5a6511(0x210)][_0x5a6511(0x1e6)],'entities':[__dirname+_0x5a6511(0x1fe)],'logging':![],'synchronize':!![],'charset':_0x5a6511(0x1e9),'timezone':'+08:00'};function _0x26c6(_0x1d8359,_0x1e37d0){const _0x331d9f=_0x331d();return _0x26c6=function(_0x26c6a9,_0x42acaa){_0x26c6a9=_0x26c6a9-0x1e2;let _0x50a26a=_0x331d9f[_0x26c6a9];return _0x50a26a;},_0x26c6(_0x1d8359,_0x1e37d0);}async function validateDatabase(){const _0x4380ae=_0x5a6511,_0x21a2fd=await mysql['createConnection']({'host':process[_0x4380ae(0x210)][_0x4380ae(0x1ec)],'user':process[_0x4380ae(0x210)][_0x4380ae(0x1f0)],'password':process[_0x4380ae(0x210)][_0x4380ae(0x1f7)],'port':parseInt(process[_0x4380ae(0x210)][_0x4380ae(0x202)],0xa)});try{const [_0x5f384c]=await _0x21a2fd['execute'](_0x4380ae(0x213)+process[_0x4380ae(0x210)][_0x4380ae(0x1e6)]+'\x27');Array[_0x4380ae(0x1ed)](_0x5f384c)&&_0x5f384c['length']===0x0?(await _0x21a2fd[_0x4380ae(0x1e4)](_0x4380ae(0x1e2)+process[_0x4380ae(0x210)][_0x4380ae(0x1e6)]),common_1[_0x4380ae(0x1ef)]['log'](_0x4380ae(0x1f5)+process['env'][_0x4380ae(0x1e6)]+']','Database')):common_1[_0x4380ae(0x1ef)][_0x4380ae(0x20c)]('数据库已存在['+process[_0x4380ae(0x210)][_0x4380ae(0x1e6)]+']',_0x4380ae(0x1ff));}catch(_0x47d70b){common_1[_0x4380ae(0x1ef)]['error'](_0x4380ae(0x207),_0x47d70b,'Database');}finally{await _0x21a2fd[_0x4380ae(0x1ea)]();}}async function updateColumnType(){const _0x1ccacd=_0x5a6511,_0x3c6bf6=await mysql['createConnection']({'host':process['env'][_0x1ccacd(0x1ec)],'user':process['env']['DB_USER'],'password':process['env'][_0x1ccacd(0x1f7)],'port':parseInt(process['env'][_0x1ccacd(0x202)],0xa),'database':process['env'][_0x1ccacd(0x1e6)]});async function _0x2fdb66(_0x51b568,_0x492f4a){const _0xc78dfe=_0x1ccacd;try{const [_0x4c6fff]=await _0x3c6bf6[_0xc78dfe(0x1e4)](_0xc78dfe(0x1e5),[_0x51b568,_0x492f4a]);_0x4c6fff[_0xc78dfe(0x20b)]>0x0&&_0x4c6fff[0x0]['DATA_TYPE']!==_0xc78dfe(0x1eb)?(await _0x3c6bf6[_0xc78dfe(0x1e4)](_0xc78dfe(0x205),[_0x51b568,_0x492f4a]),common_1[_0xc78dfe(0x1ef)][_0xc78dfe(0x20c)](_0xc78dfe(0x203)+_0x492f4a+'\x20type\x20updated\x20to\x20TEXT\x20in\x20table\x20'+_0x51b568,_0xc78dfe(0x1ff))):common_1['Logger']['log'](_0xc78dfe(0x203)+_0x492f4a+'\x20is\x20already\x20of\x20type\x20TEXT\x20in\x20table\x20'+_0x51b568,'Database');}catch(_0xcf55b4){common_1[_0xc78dfe(0x1ef)]['error'](_0xc78dfe(0x20e)+_0x51b568+':',_0xcf55b4);}}try{await _0x2fdb66(_0x1ccacd(0x212),_0x1ccacd(0x1fd)),await _0x2fdb66(_0x1ccacd(0x1f1),'coverImg');}finally{await _0x3c6bf6[_0x1ccacd(0x1ea)]();}}async function initDatabase(){const _0x3bb417=_0x5a6511;await validateDatabase(),await updateColumnType();const _0x42a1ab=new typeorm_1['DataSource'](dataSourceOptions);try{await _0x42a1ab[_0x3bb417(0x204)](),common_1[_0x3bb417(0x1ef)][_0x3bb417(0x20c)]('Database\x20connected\x20and\x20synchronized\x20successfully',_0x3bb417(0x1ff));}catch(_0x5a8d6c){common_1[_0x3bb417(0x1ef)][_0x3bb417(0x201)](_0x3bb417(0x1ee),_0x5a8d6c);}finally{await _0x42a1ab[_0x3bb417(0x1fb)]();}}exports[_0x5a6511(0x1fa)]=initDatabase;