'use strict';const _0x51f995=_0x3049;function _0x52ff(){const _0x3e14a2=['__esModule','length','/../**/*.entity{.ts,.js}','6022008HinZWZ','mysql','Database','37014255htpXcR','execute','initDatabase','createConnection','env','\x20is\x20already\x20of\x20type\x20TEXT\x20in\x20table\x20','CREATE\x20DATABASE\x20','SHOW\x20DATABASES\x20LIKE\x20\x27','186kcBuFe','DataSource','destroy','DB_PASS','\x20type\x20updated\x20to\x20TEXT\x20in\x20table\x20','error','1372104SWulRK','Logger','mysql2/promise','utf8mb4','log','415818nJMCWB','75HsQXyO','SELECT\x20COLUMN_NAME,\x20DATA_TYPE\x20FROM\x20INFORMATION_SCHEMA.COLUMNS\x20WHERE\x20TABLE_NAME\x20=\x20?\x20AND\x20COLUMN_NAME\x20=\x20?','DB_PORT','end','app','数据库已存在[','Error\x20updating\x20column\x20type\x20in\x20table\x20','86596HSvUzd','DB_HOST','Error\x20during\x20database\x20validation:','DB_USER','DB_DATABASE','ALTER\x20TABLE\x20??\x20MODIFY\x20COLUMN\x20??\x20TEXT','@nestjs/common','7189903UgejPq','defineProperty','51920abHPxa','config'];_0x52ff=function(){return _0x3e14a2;};return _0x52ff();}(function(_0x28b534,_0x21417f){const _0x48e85d=_0x3049,_0x4c954b=_0x28b534();while(!![]){try{const _0x5087dc=parseInt(_0x48e85d(0x1f5))/0x1+parseInt(_0x48e85d(0x1df))/0x2+parseInt(_0x48e85d(0x205))/0x3*(-parseInt(_0x48e85d(0x1ec))/0x4)+-parseInt(_0x48e85d(0x1e5))/0x5*(parseInt(_0x48e85d(0x1e4))/0x6)+-parseInt(_0x48e85d(0x1f3))/0x7+-parseInt(_0x48e85d(0x1fa))/0x8+parseInt(_0x48e85d(0x1fd))/0x9;if(_0x5087dc===_0x21417f)break;else _0x4c954b['push'](_0x4c954b['shift']());}catch(_0x5b8380){_0x4c954b['push'](_0x4c954b['shift']());}}}(_0x52ff,0xa836c));Object[_0x51f995(0x1f4)](exports,_0x51f995(0x1f7),{'value':!![]}),exports[_0x51f995(0x1ff)]=void 0x0;const common_1=require(_0x51f995(0x1f2)),dotenv_1=require('dotenv'),mysql=require(_0x51f995(0x1e1)),typeorm_1=require('typeorm');(0x0,dotenv_1[_0x51f995(0x1f6)])();const dataSourceOptions={'type':_0x51f995(0x1fb),'port':parseInt(process['env'][_0x51f995(0x1e7)],0xa),'host':process['env']['DB_HOST'],'username':process['env'][_0x51f995(0x1ef)],'password':process[_0x51f995(0x201)]['DB_PASS'],'database':process[_0x51f995(0x201)]['DB_DATABASE'],'entities':[__dirname+_0x51f995(0x1f9)],'logging':![],'synchronize':!![],'charset':_0x51f995(0x1e2),'timezone':'+08:00'};async function validateDatabase(){const _0x103386=_0x51f995,_0x91efcd=await mysql[_0x103386(0x200)]({'host':process[_0x103386(0x201)][_0x103386(0x1ed)],'user':process['env']['DB_USER'],'password':process[_0x103386(0x201)][_0x103386(0x1dc)],'port':parseInt(process[_0x103386(0x201)][_0x103386(0x1e7)],0xa)});try{const [_0x25d225]=await _0x91efcd[_0x103386(0x1fe)](_0x103386(0x204)+process[_0x103386(0x201)][_0x103386(0x1f0)]+'\x27');Array['isArray'](_0x25d225)&&_0x25d225[_0x103386(0x1f8)]===0x0?(await _0x91efcd['execute'](_0x103386(0x203)+process[_0x103386(0x201)][_0x103386(0x1f0)]),common_1['Logger'][_0x103386(0x1e3)]('数据库创建成功['+process[_0x103386(0x201)][_0x103386(0x1f0)]+']','Database')):common_1['Logger'][_0x103386(0x1e3)](_0x103386(0x1ea)+process[_0x103386(0x201)]['DB_DATABASE']+']','Database');}catch(_0x138401){common_1[_0x103386(0x1e0)][_0x103386(0x1de)](_0x103386(0x1ee),_0x138401,'Database');}finally{await _0x91efcd['end']();}}async function updateColumnType(){const _0x2e3ff9=_0x51f995,_0xf8fdb6=await mysql[_0x2e3ff9(0x200)]({'host':process[_0x2e3ff9(0x201)]['DB_HOST'],'user':process[_0x2e3ff9(0x201)][_0x2e3ff9(0x1ef)],'password':process[_0x2e3ff9(0x201)][_0x2e3ff9(0x1dc)],'port':parseInt(process['env'][_0x2e3ff9(0x1e7)],0xa),'database':process[_0x2e3ff9(0x201)][_0x2e3ff9(0x1f0)]});async function _0x169672(_0x513b29,_0xe91c20){const _0x412091=_0x2e3ff9;try{const [_0x46bd7a]=await _0xf8fdb6[_0x412091(0x1fe)](_0x412091(0x1e6),[_0x513b29,_0xe91c20]);_0x46bd7a[_0x412091(0x1f8)]>0x0&&_0x46bd7a[0x0]['DATA_TYPE']!=='text'?(await _0xf8fdb6['execute'](_0x412091(0x1f1),[_0x513b29,_0xe91c20]),common_1['Logger'][_0x412091(0x1e3)]('Column\x20'+_0xe91c20+_0x412091(0x1dd)+_0x513b29,_0x412091(0x1fc))):common_1[_0x412091(0x1e0)][_0x412091(0x1e3)]('Column\x20'+_0xe91c20+_0x412091(0x202)+_0x513b29,_0x412091(0x1fc));}catch(_0x2d8f3d){common_1['Logger']['error'](_0x412091(0x1eb)+_0x513b29+':',_0x2d8f3d);}}try{await _0x169672(_0x2e3ff9(0x1f6),'configVal'),await _0x169672(_0x2e3ff9(0x1e9),'coverImg');}finally{await _0xf8fdb6[_0x2e3ff9(0x1e8)]();}}function _0x3049(_0x307470,_0x28234a){const _0x52ffab=_0x52ff();return _0x3049=function(_0x3049d3,_0xf1053){_0x3049d3=_0x3049d3-0x1db;let _0x47c3b7=_0x52ffab[_0x3049d3];return _0x47c3b7;},_0x3049(_0x307470,_0x28234a);}async function initDatabase(){const _0x377bea=_0x51f995;await validateDatabase(),await updateColumnType();const _0x1ee0b7=new typeorm_1[(_0x377bea(0x206))](dataSourceOptions);try{await _0x1ee0b7['initialize'](),common_1[_0x377bea(0x1e0)][_0x377bea(0x1e3)]('Database\x20connected\x20and\x20synchronized\x20successfully',_0x377bea(0x1fc));}catch(_0x1b5aef){common_1[_0x377bea(0x1e0)][_0x377bea(0x1de)]('Error\x20during\x20TypeORM\x20initialization:',_0x1b5aef);}finally{await _0x1ee0b7[_0x377bea(0x1db)]();}}exports[_0x51f995(0x1ff)]=initDatabase;