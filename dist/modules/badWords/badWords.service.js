'use strict';const _0x421c70=_0x272c;(function(_0x464f48,_0x1aaaaf){const _0x77c24d=_0x272c,_0x3e83df=_0x464f48();while(!![]){try{const _0x542af5=-parseInt(_0x77c24d(0x224))/0x1+-parseInt(_0x77c24d(0x1e1))/0x2+parseInt(_0x77c24d(0x1f9))/0x3+parseInt(_0x77c24d(0x1e7))/0x4*(-parseInt(_0x77c24d(0x1c5))/0x5)+-parseInt(_0x77c24d(0x1d4))/0x6+parseInt(_0x77c24d(0x1f0))/0x7*(parseInt(_0x77c24d(0x1fb))/0x8)+parseInt(_0x77c24d(0x1f7))/0x9;if(_0x542af5===_0x1aaaaf)break;else _0x3e83df['push'](_0x3e83df['shift']());}catch(_0x448af6){_0x3e83df['push'](_0x3e83df['shift']());}}}(_0x5894,0xbe320));var __decorate=this&&this[_0x421c70(0x1e4)]||function(_0x254f1b,_0x528d91,_0x16e101,_0x48e5fb){const _0xbeb752=_0x421c70;var _0x37ca92=arguments[_0xbeb752(0x208)],_0x56a478=_0x37ca92<0x3?_0x528d91:_0x48e5fb===null?_0x48e5fb=Object[_0xbeb752(0x1e0)](_0x528d91,_0x16e101):_0x48e5fb,_0x3ac020;if(typeof Reflect===_0xbeb752(0x211)&&typeof Reflect['decorate']===_0xbeb752(0x1e9))_0x56a478=Reflect[_0xbeb752(0x1ee)](_0x254f1b,_0x528d91,_0x16e101,_0x48e5fb);else{for(var _0x1b2c89=_0x254f1b[_0xbeb752(0x208)]-0x1;_0x1b2c89>=0x0;_0x1b2c89--)if(_0x3ac020=_0x254f1b[_0x1b2c89])_0x56a478=(_0x37ca92<0x3?_0x3ac020(_0x56a478):_0x37ca92>0x3?_0x3ac020(_0x528d91,_0x16e101,_0x56a478):_0x3ac020(_0x528d91,_0x16e101))||_0x56a478;}return _0x37ca92>0x3&&_0x56a478&&Object[_0xbeb752(0x1fd)](_0x528d91,_0x16e101,_0x56a478),_0x56a478;},__metadata=this&&this[_0x421c70(0x1c6)]||function(_0x2ca082,_0x8f3f50){const _0x1a4cfe=_0x421c70;if(typeof Reflect==='object'&&typeof Reflect[_0x1a4cfe(0x222)]===_0x1a4cfe(0x1e9))return Reflect[_0x1a4cfe(0x222)](_0x2ca082,_0x8f3f50);},__param=this&&this[_0x421c70(0x1d5)]||function(_0x5e4f0e,_0x5da4f6){return function(_0x2f107f,_0x2acf82){_0x5da4f6(_0x2f107f,_0x2acf82,_0x5e4f0e);};};function _0x272c(_0x1733fa,_0x5469b5){const _0x5894a7=_0x5894();return _0x272c=function(_0x272cb1,_0x5a3b1a){_0x272cb1=_0x272cb1-0x1bf;let _0x30dd62=_0x5894a7[_0x272cb1];return _0x30dd62;},_0x272c(_0x1733fa,_0x5469b5);}Object[_0x421c70(0x1fd)](exports,_0x421c70(0x207),{'value':!![]}),exports['BadWordsService']=void 0x0;function _0x5894(){const _0x17bb53=['__esModule','length','application/x-www-form-urlencoded','delete','error:\x20','更新敏感词成功','join','baidu','violationLogEntity','GlobalConfigService','object','自定义检测','axios','../globalConfig/globalConfig.service','super','checkBadWordsByConfig','updateBadWords','@nestjs/common','findAndCount','BAD_REQUEST','loadBadWords','***','./badWords.entity','customSensitiveWords','save','./violationLog.entity','userId','metadata','您提交的信息中包含','210793CFBJCS','删除敏感词失败','hideString','HttpStatus','execute','application/json','find','delBadWords','userEntity','email','baiduCheckBadWords','findOne','formarTips','typeOriginCn','InjectRepository','10545UnTpbC','__metadata','您提交的内容中包含','BadWordsService','DESC','user','更新敏感词失败','敏感词已经存在了、请勿重复添加','的信息、我们已对您账号进行标记、请合规使用！','extractContent','badWords','添加敏感词成功','onModuleInit','addBadWord','data','3335052RhWDmO','__param','HttpException','typeorm','queryBadWords','../../common/utils','删除敏感词成功','https://aip.baidubce.com/rest/2.0/solution/v1/text_censor/v2/user_defined?access_token=','design:paramtypes','category','UserEntity','百度云检测','getOwnPropertyDescriptor','1110792GAWnnY','../user/user.entity','includes','__decorate','match','globalConfigService','2596qOiqEj','map','function','affected','createQueryBuilder','ViolationLogEntity','recordUserBadWords','decorate','的内容、我们已对您的账户进行标记、请合规使用！','7srXqYC','BadWordsEntity','ASC','自定义','status','stringify','Injectable','16629408dDrzwG','avatar','660633pUAYgG','badWordsEntity','11215112wiinOC','baiduTextAccessToken','defineProperty','default','敏感词不存在,请检查您的提交信息','forEach','violationCount','update','log','violationCount\x20+\x201','word','userInfo'];_0x5894=function(){return _0x17bb53;};return _0x5894();}const utils_1=require(_0x421c70(0x1d9)),common_1=require(_0x421c70(0x218)),typeorm_1=require('@nestjs/typeorm'),axios_1=require(_0x421c70(0x213)),typeorm_2=require(_0x421c70(0x1d7)),globalConfig_service_1=require(_0x421c70(0x214)),user_entity_1=require(_0x421c70(0x1e2)),badWords_entity_1=require(_0x421c70(0x21d)),violationLog_entity_1=require(_0x421c70(0x220));let BadWordsService=class BadWordsService{constructor(_0x186e8b,_0x2683ff,_0x467ce6,_0x5a09dd){const _0x49c676=_0x421c70;this['badWordsEntity']=_0x186e8b,this[_0x49c676(0x20f)]=_0x2683ff,this[_0x49c676(0x22c)]=_0x467ce6,this[_0x49c676(0x1e6)]=_0x5a09dd,this[_0x49c676(0x1cf)]=[];}async[_0x421c70(0x1d1)](){this['loadBadWords']();}async[_0x421c70(0x21e)](_0xf5ebda,_0x3e214a){const _0x91bbf6=_0x421c70,_0x789817=[];for(let _0x48fa4a=0x0;_0x48fa4a<this[_0x91bbf6(0x1cf)]['length'];_0x48fa4a++){const _0x46e340=this['badWords'][_0x48fa4a];_0xf5ebda[_0x91bbf6(0x1e3)](_0x46e340)&&_0x789817['push'](_0x46e340);}return _0x789817[_0x91bbf6(0x208)]&&await this[_0x91bbf6(0x1ed)](_0x3e214a,_0xf5ebda,_0x789817,[_0x91bbf6(0x1f3)],_0x91bbf6(0x212)),_0x789817;}async['checkBadWords'](_0x286e74,_0x18b576){const _0x5a17a2=_0x421c70,_0x179066=await this[_0x5a17a2(0x1e6)]['getSensitiveConfig']();return _0x179066&&await this[_0x5a17a2(0x216)](_0x286e74,_0x179066,_0x18b576),await this['customSensitiveWords'](_0x286e74,_0x18b576);}async[_0x421c70(0x216)](_0x1189d4,_0x410f2f,_0x193d6b){const _0x1443fd=_0x421c70,{useType:_0x2aff31}=_0x410f2f;_0x2aff31===_0x1443fd(0x20e)&&await this[_0x1443fd(0x1c0)](_0x1189d4,_0x410f2f[_0x1443fd(0x1fc)],_0x193d6b);}[_0x421c70(0x1ce)](_0x4f643e){const _0x564e2a=_0x421c70,_0x487e2f=/存在(.*?)不合规/,_0x315854=_0x4f643e[_0x564e2a(0x1e5)](_0x487e2f);return _0x315854?_0x315854[0x1]:'';}async[_0x421c70(0x1c0)](_0x466380,_0x339e7f,_0x272a52){const _0x35ded4=_0x421c70;if(!_0x339e7f)return;const _0x509eb6=_0x35ded4(0x1db)+_0x339e7f+'}',_0x1b6fd5={'Content-Type':_0x35ded4(0x209),'Accept':_0x35ded4(0x229)},_0x8ebb0b=await axios_1[_0x35ded4(0x1fe)]['post'](_0x509eb6,{'text':_0x466380},{'headers':_0x1b6fd5}),{conclusion:_0x476d98,error_code:_0x48e98f,error_msg:_0x5fb614,conclusionType:_0x58083a,data:_0x55c92b}=_0x8ebb0b[_0x35ded4(0x1d3)];_0x48e98f&&console[_0x35ded4(0x203)]('百度文本检测出现错误、请查看配置信息:\x20',_0x5fb614);if(_0x58083a!==0x1){const _0x1ce89e=[...new Set(_0x55c92b[_0x35ded4(0x1e8)](_0xccc331=>this[_0x35ded4(0x1ce)](_0xccc331['msg'])))];await this[_0x35ded4(0x1ed)](_0x272a52,_0x466380,[_0x35ded4(0x21c)],_0x1ce89e,_0x35ded4(0x1df));const _0x22865c=_0x35ded4(0x223)+_0x1ce89e[_0x35ded4(0x20d)](',')+_0x35ded4(0x1ef);throw new common_1['HttpException'](_0x22865c,common_1[_0x35ded4(0x227)][_0x35ded4(0x21a)]);}}[_0x421c70(0x1c2)](_0x347cca){const _0x55c87e=_0x421c70,_0xb75910=_0x347cca[_0x55c87e(0x1e8)](_0x1d9716=>_0x1d9716[_0x55c87e(0x1dd)]),_0x27d387=[...new Set(_0xb75910)];return _0x55c87e(0x1c7)+_0x27d387[_0x55c87e(0x20d)](',')+_0x55c87e(0x1cd);}async['loadBadWords'](){const _0x16387f=_0x421c70,_0x192471=await this[_0x16387f(0x1fa)][_0x16387f(0x22a)]({'where':{'status':0x1},'select':[_0x16387f(0x205)]});this[_0x16387f(0x1cf)]=_0x192471['map'](_0x5bd01a=>_0x5bd01a[_0x16387f(0x205)]);}async[_0x421c70(0x1d8)](_0x171ae5){const _0x407ba2=_0x421c70,{page:page=0x1,size:size=0x1f4,word:_0x125832,status:_0x28c4f7}=_0x171ae5,_0x2a3778={};[0x0,0x1,'0','1'][_0x407ba2(0x1e3)](_0x28c4f7)&&(_0x2a3778[_0x407ba2(0x1f4)]=_0x28c4f7),_0x125832&&(_0x2a3778['word']=(0x0,typeorm_2['Like'])('%'+_0x125832+'%'));const [_0x52d063,_0x4337b4]=await this[_0x407ba2(0x1fa)][_0x407ba2(0x219)]({'where':_0x2a3778,'skip':(page-0x1)*size,'take':size,'order':{'id':_0x407ba2(0x1f2)}});return{'rows':_0x52d063,'count':_0x4337b4};}async[_0x421c70(0x22b)](_0x2a9f6e){const _0x3d5c48=_0x421c70,_0x62373e=await this[_0x3d5c48(0x1fa)]['findOne']({'where':{'id':_0x2a9f6e['id']}});if(!_0x62373e)throw new common_1['HttpException'](_0x3d5c48(0x1ff),common_1[_0x3d5c48(0x227)][_0x3d5c48(0x21a)]);const _0xc45e3c=await this[_0x3d5c48(0x1fa)][_0x3d5c48(0x20a)]({'id':_0x2a9f6e['id']});if(_0xc45e3c[_0x3d5c48(0x1ea)]>0x0)return await this[_0x3d5c48(0x21b)](),_0x3d5c48(0x1da);else throw new common_1[(_0x3d5c48(0x1d6))](_0x3d5c48(0x225),common_1[_0x3d5c48(0x227)]['BAD_REQUEST']);}async[_0x421c70(0x217)](_0x5c046b){const _0x4a561f=_0x421c70,{id:_0x352fc8,word:_0x17617d,status:_0x348019}=_0x5c046b,_0x1bd0a5=await this[_0x4a561f(0x1fa)][_0x4a561f(0x1c1)]({'where':{'word':_0x17617d}});if(_0x1bd0a5)throw new common_1[(_0x4a561f(0x1d6))](_0x4a561f(0x1cc),common_1[_0x4a561f(0x227)][_0x4a561f(0x21a)]);const _0x163e3b=await this[_0x4a561f(0x1fa)][_0x4a561f(0x202)]({'id':_0x352fc8},{'word':_0x17617d,'status':_0x348019});if(_0x163e3b[_0x4a561f(0x1ea)]>0x0)return await this['loadBadWords'](),_0x4a561f(0x20c);else throw new common_1[(_0x4a561f(0x1d6))](_0x4a561f(0x1cb),common_1[_0x4a561f(0x227)][_0x4a561f(0x21a)]);}async[_0x421c70(0x1d2)](_0x1af0f4){const _0x1f582b=_0x421c70,{word:_0x2234aa}=_0x1af0f4,_0x51456b=await this[_0x1f582b(0x1fa)][_0x1f582b(0x1c1)]({'where':{'word':_0x2234aa}});if(_0x51456b)throw new common_1[(_0x1f582b(0x1d6))]('敏感词已存在,请检查您的提交信息',common_1[_0x1f582b(0x227)]['BAD_REQUEST']);return await this[_0x1f582b(0x1fa)][_0x1f582b(0x21f)]({'word':_0x2234aa}),await this['loadBadWords'](),_0x1f582b(0x1d0);}async[_0x421c70(0x1ed)](_0x1d2cc2,_0x42e0e7,_0x194794,_0x36bf7d,_0x434e69){const _0x15f3a1=_0x421c70,_0x5679a1={'userId':_0x1d2cc2,'content':_0x42e0e7,'words':JSON[_0x15f3a1(0x1f5)](_0x194794),'typeCn':JSON[_0x15f3a1(0x1f5)](_0x36bf7d),'typeOriginCn':_0x434e69};try{await this['userEntity'][_0x15f3a1(0x1eb)]()[_0x15f3a1(0x202)](user_entity_1['UserEntity'])['set']({'violationCount':()=>_0x15f3a1(0x204)})['where']('id\x20=\x20:userId',{'userId':_0x1d2cc2})[_0x15f3a1(0x228)](),await this[_0x15f3a1(0x20f)][_0x15f3a1(0x21f)](_0x5679a1);}catch(_0x42c549){console[_0x15f3a1(0x203)](_0x15f3a1(0x20b),_0x42c549);}}async['violation'](_0x3fdfb5,_0x220d3f){const _0x56e97e=_0x421c70,{role:_0x42ffd7}=_0x3fdfb5[_0x56e97e(0x1ca)],{page:page=0x1,size:size=0xa,userId:_0x1a0f31,typeOriginCn:_0x66fd56}=_0x220d3f,_0x40af02={};_0x1a0f31&&(_0x40af02[_0x56e97e(0x221)]=_0x1a0f31),_0x66fd56&&(_0x40af02[_0x56e97e(0x1c3)]=_0x66fd56);const [_0x8503b2,_0x5e07cd]=await this[_0x56e97e(0x20f)][_0x56e97e(0x219)]({'where':_0x40af02,'skip':(page-0x1)*size,'take':size,'order':{'id':_0x56e97e(0x1c9)}}),_0x2f9def=[...new Set(_0x8503b2['map'](_0x16347b=>_0x16347b['userId']))],_0x23dfc8=await this['userEntity'][_0x56e97e(0x22a)]({'where':{'id':(0x0,typeorm_2['In'])(_0x2f9def)},'select':['id',_0x56e97e(0x1f8),'username','email',_0x56e97e(0x201),_0x56e97e(0x1f4)]});return _0x8503b2[_0x56e97e(0x200)](_0x3677b6=>{const _0x5ea944=_0x56e97e,_0xb9dc6c=_0x23dfc8[_0x5ea944(0x22a)](_0x53a0b7=>_0x53a0b7['id']===_0x3677b6[_0x5ea944(0x221)])||{};_0x42ffd7!==_0x5ea944(0x215)&&(_0xb9dc6c[_0x5ea944(0x1bf)]=(0x0,utils_1[_0x5ea944(0x226)])(_0xb9dc6c[_0x5ea944(0x1bf)])),_0x3677b6[_0x5ea944(0x206)]=_0xb9dc6c;}),{'rows':_0x8503b2,'count':_0x5e07cd};}};BadWordsService=__decorate([(0x0,common_1[_0x421c70(0x1f6)])(),__param(0x0,(0x0,typeorm_1['InjectRepository'])(badWords_entity_1[_0x421c70(0x1f1)])),__param(0x1,(0x0,typeorm_1[_0x421c70(0x1c4)])(violationLog_entity_1[_0x421c70(0x1ec)])),__param(0x2,(0x0,typeorm_1[_0x421c70(0x1c4)])(user_entity_1[_0x421c70(0x1de)])),__metadata(_0x421c70(0x1dc),[typeorm_2['Repository'],typeorm_2['Repository'],typeorm_2['Repository'],globalConfig_service_1[_0x421c70(0x210)]])],BadWordsService),exports[_0x421c70(0x1c8)]=BadWordsService;