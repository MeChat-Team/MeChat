'use strict';const _0x3eeece=_0x348f;function _0x348f(_0x20df52,_0x5e0d04){const _0x9b0170=_0x9b01();return _0x348f=function(_0x348f2b,_0x5acf06){_0x348f2b=_0x348f2b-0x94;let _0x246d52=_0x9b0170[_0x348f2b];return _0x246d52;},_0x348f(_0x20df52,_0x5e0d04);}(function(_0x3f486a,_0x14e532){const _0x5e9ff0=_0x348f,_0x548ec9=_0x3f486a();while(!![]){try{const _0x3471c4=parseInt(_0x5e9ff0(0xd8))/0x1+parseInt(_0x5e9ff0(0xc4))/0x2+parseInt(_0x5e9ff0(0xe1))/0x3+-parseInt(_0x5e9ff0(0x9e))/0x4*(parseInt(_0x5e9ff0(0x96))/0x5)+-parseInt(_0x5e9ff0(0xd3))/0x6*(-parseInt(_0x5e9ff0(0xf1))/0x7)+-parseInt(_0x5e9ff0(0xe9))/0x8+-parseInt(_0x5e9ff0(0xd6))/0x9;if(_0x3471c4===_0x14e532)break;else _0x548ec9['push'](_0x548ec9['shift']());}catch(_0x5f2050){_0x548ec9['push'](_0x548ec9['shift']());}}}(_0x9b01,0xf0170));var __decorate=this&&this[_0x3eeece(0xc5)]||function(_0x382069,_0x4724e2,_0x54a664,_0x1ea68e){const _0xe95db=_0x3eeece;var _0x33b307=arguments[_0xe95db(0xb1)],_0x458653=_0x33b307<0x3?_0x4724e2:_0x1ea68e===null?_0x1ea68e=Object['getOwnPropertyDescriptor'](_0x4724e2,_0x54a664):_0x1ea68e,_0x101e08;if(typeof Reflect===_0xe95db(0xf5)&&typeof Reflect[_0xe95db(0xee)]===_0xe95db(0x99))_0x458653=Reflect[_0xe95db(0xee)](_0x382069,_0x4724e2,_0x54a664,_0x1ea68e);else{for(var _0x19efc9=_0x382069['length']-0x1;_0x19efc9>=0x0;_0x19efc9--)if(_0x101e08=_0x382069[_0x19efc9])_0x458653=(_0x33b307<0x3?_0x101e08(_0x458653):_0x33b307>0x3?_0x101e08(_0x4724e2,_0x54a664,_0x458653):_0x101e08(_0x4724e2,_0x54a664))||_0x458653;}return _0x33b307>0x3&&_0x458653&&Object[_0xe95db(0xf2)](_0x4724e2,_0x54a664,_0x458653),_0x458653;},__metadata=this&&this[_0x3eeece(0xec)]||function(_0x1cb17c,_0x54977a){const _0x3c4a96=_0x3eeece;if(typeof Reflect===_0x3c4a96(0xf5)&&typeof Reflect[_0x3c4a96(0xae)]===_0x3c4a96(0x99))return Reflect[_0x3c4a96(0xae)](_0x1cb17c,_0x54977a);},__param=this&&this[_0x3eeece(0xa0)]||function(_0x424310,_0x592744){return function(_0xb36dcf,_0x4d6f02){_0x592744(_0xb36dcf,_0x4d6f02,_0x424310);};};Object[_0x3eeece(0xf2)](exports,_0x3eeece(0xb3),{'value':!![]}),exports[_0x3eeece(0xac)]=void 0x0;function _0x9b01(){const _0x41c899=['queryBadWords','word','user','updateBadWords','11942592huGEse','UserEntity','username','__metadata','getSensitiveConfig','decorate','badWords','find','953225FyYGOj','defineProperty','customSensitiveWords','的信息、我们已对您账号进行标记、请合规使用！','object','敏感词已存在,请检查您的提交信息','@nestjs/typeorm','recordUserBadWords','super','save','265zmlsLN','baiduCheckBadWords','violationCount\x20+\x201','function','update','affected','join','violation','63564qEBwKP','BadWordsEntity','__param','HttpException','百度文本检测出现错误、请查看配置信息:\x20','findOne','email','push','userEntity','application/x-www-form-urlencoded','typeOriginCn','formarTips','badWordsEntity','includes','BadWordsService','Repository','metadata','自定义检测','violationLogEntity','length','where','__esModule','log','ViolationLogEntity','delBadWords','extractContent','../user/user.entity','删除敏感词成功','百度云检测','findAndCount','delete','onModuleInit','map','checkBadWordsByConfig','loadBadWords','typeorm','baiduTextAccessToken','../globalConfig/globalConfig.service','3477882rBWPnO','__decorate','error:\x20','您提交的信息中包含','addBadWord','checkBadWords','userId','violationCount','avatar','category','BAD_REQUEST','globalConfigService','自定义','status','execute','60wyKkiV','post','Like','18504774TXdsqE','敏感词已经存在了、请勿重复添加','1474596vUycTR','ASC','HttpStatus','userInfo','default','敏感词不存在,请检查您的提交信息','createQueryBuilder','./badWords.entity','添加敏感词成功','2397762EbbxNF','您提交的内容中包含','***','stringify'];_0x9b01=function(){return _0x41c899;};return _0x9b01();}const utils_1=require('../../common/utils'),common_1=require('@nestjs/common'),typeorm_1=require(_0x3eeece(0xf7)),axios_1=require('axios'),typeorm_2=require(_0x3eeece(0xc1)),globalConfig_service_1=require(_0x3eeece(0xc3)),user_entity_1=require(_0x3eeece(0xb8)),badWords_entity_1=require(_0x3eeece(0xdf)),violationLog_entity_1=require('./violationLog.entity');let BadWordsService=class BadWordsService{constructor(_0x3550ee,_0x4816e2,_0x26e46a,_0x890cf8){const _0x3d673a=_0x3eeece;this['badWordsEntity']=_0x3550ee,this['violationLogEntity']=_0x4816e2,this['userEntity']=_0x26e46a,this['globalConfigService']=_0x890cf8,this[_0x3d673a(0xef)]=[];}async[_0x3eeece(0xbd)](){const _0x42ae1b=_0x3eeece;this[_0x42ae1b(0xc0)]();}async[_0x3eeece(0xf3)](_0x22b571,_0x5d2778){const _0x263054=_0x3eeece,_0x3fbb71=[];for(let _0x5adaf2=0x0;_0x5adaf2<this[_0x263054(0xef)][_0x263054(0xb1)];_0x5adaf2++){const _0xbf0ca1=this['badWords'][_0x5adaf2];_0x22b571[_0x263054(0xab)](_0xbf0ca1)&&_0x3fbb71[_0x263054(0xa5)](_0xbf0ca1);}return _0x3fbb71[_0x263054(0xb1)]&&await this['recordUserBadWords'](_0x5d2778,_0x22b571,_0x3fbb71,[_0x263054(0xd0)],_0x263054(0xaf)),_0x3fbb71;}async[_0x3eeece(0xc9)](_0x194387,_0x3903d1){const _0x55c81f=_0x3eeece,_0x9a7999=await this[_0x55c81f(0xcf)][_0x55c81f(0xed)]();return _0x9a7999&&await this[_0x55c81f(0xbf)](_0x194387,_0x9a7999,_0x3903d1),await this[_0x55c81f(0xf3)](_0x194387,_0x3903d1);}async[_0x3eeece(0xbf)](_0x50a431,_0x454372,_0x3796bb){const _0x4f9468=_0x3eeece,{useType:_0x460151}=_0x454372;_0x460151==='baidu'&&await this[_0x4f9468(0x97)](_0x50a431,_0x454372[_0x4f9468(0xc2)],_0x3796bb);}[_0x3eeece(0xb7)](_0x41e652){const _0x44abde=/存在(.*?)不合规/,_0xe9c923=_0x41e652['match'](_0x44abde);return _0xe9c923?_0xe9c923[0x1]:'';}async[_0x3eeece(0x97)](_0x219af0,_0x22495f,_0xded3cd){const _0x55c886=_0x3eeece;if(!_0x22495f)return;const _0x143315='https://aip.baidubce.com/rest/2.0/solution/v1/text_censor/v2/user_defined?access_token='+_0x22495f+'}',_0x3be609={'Content-Type':_0x55c886(0xa7),'Accept':'application/json'},_0x1f8908=await axios_1[_0x55c886(0xdc)][_0x55c886(0xd4)](_0x143315,{'text':_0x219af0},{'headers':_0x3be609}),{conclusion:_0x5796d7,error_code:_0x13dbbd,error_msg:_0x58ca0d,conclusionType:_0x1389cd,data:_0x5b9fe7}=_0x1f8908['data'];_0x13dbbd&&console[_0x55c886(0xb4)](_0x55c886(0xa2),_0x58ca0d);if(_0x1389cd!==0x1){const _0x215d14=[...new Set(_0x5b9fe7[_0x55c886(0xbe)](_0x463c5b=>this['extractContent'](_0x463c5b['msg'])))];await this[_0x55c886(0xf8)](_0xded3cd,_0x219af0,[_0x55c886(0xe3)],_0x215d14,_0x55c886(0xba));const _0x48380a=_0x55c886(0xc7)+_0x215d14[_0x55c886(0x9c)](',')+'的内容、我们已对您的账户进行标记、请合规使用！';throw new common_1['HttpException'](_0x48380a,common_1[_0x55c886(0xda)][_0x55c886(0xce)]);}}[_0x3eeece(0xa9)](_0x38238d){const _0x9a55c0=_0x3eeece,_0x4ca62c=_0x38238d[_0x9a55c0(0xbe)](_0x13ac37=>_0x13ac37[_0x9a55c0(0xcd)]),_0x3f4b01=[...new Set(_0x4ca62c)];return _0x9a55c0(0xe2)+_0x3f4b01[_0x9a55c0(0x9c)](',')+_0x9a55c0(0xf4);}async['loadBadWords'](){const _0x43ac4f=_0x3eeece,_0x49a086=await this['badWordsEntity'][_0x43ac4f(0xf0)]({'where':{'status':0x1},'select':['word']});this[_0x43ac4f(0xef)]=_0x49a086[_0x43ac4f(0xbe)](_0x464ec2=>_0x464ec2[_0x43ac4f(0xe6)]);}async[_0x3eeece(0xe5)](_0x43a157){const _0x437234=_0x3eeece,{page:page=0x1,size:size=0x1f4,word:_0x17ebfe,status:_0x160206}=_0x43a157,_0x185ac9={};[0x0,0x1,'0','1'][_0x437234(0xab)](_0x160206)&&(_0x185ac9[_0x437234(0xd1)]=_0x160206),_0x17ebfe&&(_0x185ac9['word']=(0x0,typeorm_2[_0x437234(0xd5)])('%'+_0x17ebfe+'%'));const [_0x205257,_0x59a236]=await this[_0x437234(0xaa)]['findAndCount']({'where':_0x185ac9,'skip':(page-0x1)*size,'take':size,'order':{'id':_0x437234(0xd9)}});return{'rows':_0x205257,'count':_0x59a236};}async[_0x3eeece(0xb6)](_0x678470){const _0x2ef723=_0x3eeece,_0x1993f6=await this[_0x2ef723(0xaa)][_0x2ef723(0xa3)]({'where':{'id':_0x678470['id']}});if(!_0x1993f6)throw new common_1[(_0x2ef723(0xa1))](_0x2ef723(0xdd),common_1['HttpStatus']['BAD_REQUEST']);const _0x148206=await this[_0x2ef723(0xaa)][_0x2ef723(0xbc)]({'id':_0x678470['id']});if(_0x148206[_0x2ef723(0x9b)]>0x0)return await this[_0x2ef723(0xc0)](),_0x2ef723(0xb9);else throw new common_1[(_0x2ef723(0xa1))]('删除敏感词失败',common_1[_0x2ef723(0xda)][_0x2ef723(0xce)]);}async[_0x3eeece(0xe8)](_0x4779e1){const _0x20dfa7=_0x3eeece,{id:_0x491c40,word:_0xe3f632,status:_0xcabaa3}=_0x4779e1,_0xd20eb4=await this[_0x20dfa7(0xaa)]['findOne']({'where':{'word':_0xe3f632}});if(_0xd20eb4)throw new common_1[(_0x20dfa7(0xa1))](_0x20dfa7(0xd7),common_1[_0x20dfa7(0xda)][_0x20dfa7(0xce)]);const _0x53d637=await this[_0x20dfa7(0xaa)]['update']({'id':_0x491c40},{'word':_0xe3f632,'status':_0xcabaa3});if(_0x53d637['affected']>0x0)return await this['loadBadWords'](),'更新敏感词成功';else throw new common_1[(_0x20dfa7(0xa1))]('更新敏感词失败',common_1['HttpStatus'][_0x20dfa7(0xce)]);}async[_0x3eeece(0xc8)](_0x4cb072){const _0x294543=_0x3eeece,{word:_0x4397f2}=_0x4cb072,_0x2f1759=await this['badWordsEntity'][_0x294543(0xa3)]({'where':{'word':_0x4397f2}});if(_0x2f1759)throw new common_1['HttpException'](_0x294543(0xf6),common_1[_0x294543(0xda)]['BAD_REQUEST']);return await this['badWordsEntity'][_0x294543(0x95)]({'word':_0x4397f2}),await this[_0x294543(0xc0)](),_0x294543(0xe0);}async['recordUserBadWords'](_0x43b62c,_0x1f2eed,_0x444f83,_0x5e33a3,_0x3e1216){const _0x46bccf=_0x3eeece,_0x55c02b={'userId':_0x43b62c,'content':_0x1f2eed,'words':JSON[_0x46bccf(0xe4)](_0x444f83),'typeCn':JSON[_0x46bccf(0xe4)](_0x5e33a3),'typeOriginCn':_0x3e1216};try{await this[_0x46bccf(0xa6)][_0x46bccf(0xde)]()[_0x46bccf(0x9a)](user_entity_1[_0x46bccf(0xea)])['set']({'violationCount':()=>_0x46bccf(0x98)})[_0x46bccf(0xb2)]('id\x20=\x20:userId',{'userId':_0x43b62c})[_0x46bccf(0xd2)](),await this[_0x46bccf(0xb0)][_0x46bccf(0x95)](_0x55c02b);}catch(_0x29b802){console[_0x46bccf(0xb4)](_0x46bccf(0xc6),_0x29b802);}}async[_0x3eeece(0x9d)](_0x2ec7f4,_0x1fe6ad){const _0xe2b739=_0x3eeece,{role:_0x3e8888}=_0x2ec7f4[_0xe2b739(0xe7)],{page:page=0x1,size:size=0xa,userId:_0x107aea,typeOriginCn:_0x3875ca}=_0x1fe6ad,_0x59c8df={};_0x107aea&&(_0x59c8df[_0xe2b739(0xca)]=_0x107aea),_0x3875ca&&(_0x59c8df[_0xe2b739(0xa8)]=_0x3875ca);const [_0x510561,_0x4fd31b]=await this[_0xe2b739(0xb0)][_0xe2b739(0xbb)]({'where':_0x59c8df,'skip':(page-0x1)*size,'take':size,'order':{'id':'DESC'}}),_0xa62445=[...new Set(_0x510561[_0xe2b739(0xbe)](_0x46ba20=>_0x46ba20[_0xe2b739(0xca)]))],_0x2c3aa9=await this[_0xe2b739(0xa6)]['find']({'where':{'id':(0x0,typeorm_2['In'])(_0xa62445)},'select':['id',_0xe2b739(0xcc),_0xe2b739(0xeb),_0xe2b739(0xa4),_0xe2b739(0xcb),_0xe2b739(0xd1)]});return _0x510561['forEach'](_0x5e82e7=>{const _0x4ab6d6=_0xe2b739,_0x186086=_0x2c3aa9[_0x4ab6d6(0xf0)](_0x3097e6=>_0x3097e6['id']===_0x5e82e7[_0x4ab6d6(0xca)])||{};_0x3e8888!==_0x4ab6d6(0x94)&&(_0x186086[_0x4ab6d6(0xa4)]=(0x0,utils_1['hideString'])(_0x186086[_0x4ab6d6(0xa4)])),_0x5e82e7[_0x4ab6d6(0xdb)]=_0x186086;}),{'rows':_0x510561,'count':_0x4fd31b};}};BadWordsService=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,typeorm_1['InjectRepository'])(badWords_entity_1[_0x3eeece(0x9f)])),__param(0x1,(0x0,typeorm_1['InjectRepository'])(violationLog_entity_1[_0x3eeece(0xb5)])),__param(0x2,(0x0,typeorm_1['InjectRepository'])(user_entity_1[_0x3eeece(0xea)])),__metadata('design:paramtypes',[typeorm_2[_0x3eeece(0xad)],typeorm_2[_0x3eeece(0xad)],typeorm_2['Repository'],globalConfig_service_1['GlobalConfigService']])],BadWordsService),exports['BadWordsService']=BadWordsService;