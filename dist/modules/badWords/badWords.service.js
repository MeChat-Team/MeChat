'use strict';const _0x4cb3db=_0xa56b;(function(_0x5a91e6,_0xbe6b90){const _0x3b4baf=_0xa56b,_0x3a56bb=_0x5a91e6();while(!![]){try{const _0x24010b=parseInt(_0x3b4baf(0x1fe))/0x1*(-parseInt(_0x3b4baf(0x1dc))/0x2)+-parseInt(_0x3b4baf(0x1ca))/0x3*(parseInt(_0x3b4baf(0x1f2))/0x4)+parseInt(_0x3b4baf(0x1c4))/0x5+parseInt(_0x3b4baf(0x1d5))/0x6*(parseInt(_0x3b4baf(0x208))/0x7)+-parseInt(_0x3b4baf(0x1ec))/0x8*(-parseInt(_0x3b4baf(0x1fa))/0x9)+-parseInt(_0x3b4baf(0x1da))/0xa+parseInt(_0x3b4baf(0x1d0))/0xb;if(_0x24010b===_0xbe6b90)break;else _0x3a56bb['push'](_0x3a56bb['shift']());}catch(_0x56b446){_0x3a56bb['push'](_0x3a56bb['shift']());}}}(_0x4d9a,0xaa6c7));var __decorate=this&&this[_0x4cb3db(0x1a3)]||function(_0x23235e,_0x50abc4,_0xb6e3cc,_0x1e0f5b){const _0x3e02b2=_0x4cb3db;var _0x3a21d3=arguments[_0x3e02b2(0x1bc)],_0x5af639=_0x3a21d3<0x3?_0x50abc4:_0x1e0f5b===null?_0x1e0f5b=Object[_0x3e02b2(0x1fd)](_0x50abc4,_0xb6e3cc):_0x1e0f5b,_0x3125fb;if(typeof Reflect===_0x3e02b2(0x1ea)&&typeof Reflect[_0x3e02b2(0x1b6)]==='function')_0x5af639=Reflect[_0x3e02b2(0x1b6)](_0x23235e,_0x50abc4,_0xb6e3cc,_0x1e0f5b);else{for(var _0x2246cf=_0x23235e['length']-0x1;_0x2246cf>=0x0;_0x2246cf--)if(_0x3125fb=_0x23235e[_0x2246cf])_0x5af639=(_0x3a21d3<0x3?_0x3125fb(_0x5af639):_0x3a21d3>0x3?_0x3125fb(_0x50abc4,_0xb6e3cc,_0x5af639):_0x3125fb(_0x50abc4,_0xb6e3cc))||_0x5af639;}return _0x3a21d3>0x3&&_0x5af639&&Object[_0x3e02b2(0x1ad)](_0x50abc4,_0xb6e3cc,_0x5af639),_0x5af639;},__metadata=this&&this['__metadata']||function(_0x3809a5,_0x8756a1){const _0x302a58=_0x4cb3db;if(typeof Reflect===_0x302a58(0x1ea)&&typeof Reflect[_0x302a58(0x1ed)]===_0x302a58(0x1b8))return Reflect[_0x302a58(0x1ed)](_0x3809a5,_0x8756a1);},__param=this&&this[_0x4cb3db(0x1c2)]||function(_0x2a4442,_0x3bf61d){return function(_0x2e9a98,_0x3080ad){_0x3bf61d(_0x2e9a98,_0x3080ad,_0x2a4442);};};Object[_0x4cb3db(0x1ad)](exports,_0x4cb3db(0x1e0),{'value':!![]}),exports['BadWordsService']=void 0x0;function _0xa56b(_0x28dd8e,_0x4704a9){const _0x4d9a92=_0x4d9a();return _0xa56b=function(_0xa56bf3,_0x20a4d6){_0xa56bf3=_0xa56bf3-0x19c;let _0x5683de=_0x4d9a92[_0xa56bf3];return _0x5683de;},_0xa56b(_0x28dd8e,_0x4704a9);}const utils_1=require(_0x4cb3db(0x1fc)),common_1=require(_0x4cb3db(0x1cb)),typeorm_1=require(_0x4cb3db(0x1ba)),axios_1=require(_0x4cb3db(0x201)),typeorm_2=require(_0x4cb3db(0x1f7)),globalConfig_service_1=require('../globalConfig/globalConfig.service'),user_entity_1=require(_0x4cb3db(0x1c8)),badWords_entity_1=require(_0x4cb3db(0x203)),violationLog_entity_1=require('./violationLog.entity');function _0x4d9a(){const _0x5d8731=['24XceKUc','metadata','HttpStatus','自定义检测','https://aip.baidubce.com/rest/2.0/solution/v1/text_censor/v2/user_defined?access_token=','的信息、我们已对您账号进行标记、请合规使用！','92908pglVNF','word','email','find','更新敏感词成功','typeorm','match','delBadWords','187659MSwXuf','addBadWord','../../common/utils','getOwnPropertyDescriptor','129167ZBBcHS','更新敏感词失败','design:paramtypes','axios','customSensitiveWords','./badWords.entity','forEach','globalConfigService','data','敏感词已存在,请检查您的提交信息','581rpfTZZ','userEntity','百度文本检测出现错误、请查看配置信息:\x20','添加敏感词成功','InjectRepository','checkBadWordsByConfig','DESC','set','__decorate','userInfo','typeOriginCn','Like','msg','formarTips','baiduCheckBadWords','findAndCount','status','Repository','defineProperty','violation','HttpException','default','username','loadBadWords','avatar','violationLogEntity','删除敏感词成功','decorate','super','function','post','@nestjs/typeorm','BadWordsEntity','length','敏感词已经存在了、请勿重复添加','UserEntity','category','recordUserBadWords','user','__param','您提交的内容中包含','5277775SNjFYa','affected','map','delete','../user/user.entity','自定义','36KOSWNH','@nestjs/common','update','***','extractContent','checkBadWords','9570528koMliO','execute','badWords','stringify','where','33870dUIvQd','GlobalConfigService','save','Injectable','application/x-www-form-urlencoded','4465760EONoNh','findOne','16nkSlqz','ViolationLogEntity','baidu','error:\x20','__esModule','BAD_REQUEST','violationCount','的内容、我们已对您的账户进行标记、请合规使用！','userId','includes','badWordsEntity','log','删除敏感词失败','baiduTextAccessToken','object','onModuleInit'];_0x4d9a=function(){return _0x5d8731;};return _0x4d9a();}let BadWordsService=class BadWordsService{constructor(_0x23b992,_0xc2326f,_0x13221f,_0x4baf9a){const _0x1d5f97=_0x4cb3db;this['badWordsEntity']=_0x23b992,this[_0x1d5f97(0x1b4)]=_0xc2326f,this[_0x1d5f97(0x19c)]=_0x13221f,this[_0x1d5f97(0x205)]=_0x4baf9a,this['badWords']=[];}async[_0x4cb3db(0x1eb)](){const _0x169a19=_0x4cb3db;this[_0x169a19(0x1b2)]();}async[_0x4cb3db(0x202)](_0x330681,_0x3040ff){const _0x230265=_0x4cb3db,_0xa6e11=[];for(let _0x3a82a5=0x0;_0x3a82a5<this[_0x230265(0x1d2)][_0x230265(0x1bc)];_0x3a82a5++){const _0x144cab=this['badWords'][_0x3a82a5];_0x330681[_0x230265(0x1e5)](_0x144cab)&&_0xa6e11['push'](_0x144cab);}return _0xa6e11[_0x230265(0x1bc)]&&await this[_0x230265(0x1c0)](_0x3040ff,_0x330681,_0xa6e11,[_0x230265(0x1c9)],_0x230265(0x1ef)),_0xa6e11;}async[_0x4cb3db(0x1cf)](_0x3cab2a,_0x3c5339){const _0x34aebc=_0x4cb3db,_0x452a62=await this[_0x34aebc(0x205)]['getSensitiveConfig']();return _0x452a62&&await this[_0x34aebc(0x1a0)](_0x3cab2a,_0x452a62,_0x3c5339),await this[_0x34aebc(0x202)](_0x3cab2a,_0x3c5339);}async[_0x4cb3db(0x1a0)](_0xe05688,_0xb28006,_0x588f84){const _0x10fbe6=_0x4cb3db,{useType:_0x42f9f0}=_0xb28006;_0x42f9f0===_0x10fbe6(0x1de)&&await this[_0x10fbe6(0x1a9)](_0xe05688,_0xb28006[_0x10fbe6(0x1e9)],_0x588f84);}[_0x4cb3db(0x1ce)](_0x31a713){const _0x4b9e62=_0x4cb3db,_0x5af1a3=/存在(.*?)不合规/,_0x10224d=_0x31a713[_0x4b9e62(0x1f8)](_0x5af1a3);return _0x10224d?_0x10224d[0x1]:'';}async['baiduCheckBadWords'](_0x872914,_0x30b5bb,_0x2c55d8){const _0x24d0f3=_0x4cb3db;if(!_0x30b5bb)return;const _0x5bb09f=_0x24d0f3(0x1f0)+_0x30b5bb+'}',_0xdc6325={'Content-Type':_0x24d0f3(0x1d9),'Accept':'application/json'},_0x4fd45e=await axios_1[_0x24d0f3(0x1b0)][_0x24d0f3(0x1b9)](_0x5bb09f,{'text':_0x872914},{'headers':_0xdc6325}),{conclusion:_0x21df2a,error_code:_0x2347b1,error_msg:_0x5ca8f1,conclusionType:_0x30d4ea,data:_0x2b7a80}=_0x4fd45e[_0x24d0f3(0x206)];_0x2347b1&&console[_0x24d0f3(0x1e7)](_0x24d0f3(0x19d),_0x5ca8f1);if(_0x30d4ea!==0x1){const _0x158c0e=[...new Set(_0x2b7a80[_0x24d0f3(0x1c6)](_0x14d8a1=>this['extractContent'](_0x14d8a1[_0x24d0f3(0x1a7)])))];await this[_0x24d0f3(0x1c0)](_0x2c55d8,_0x872914,[_0x24d0f3(0x1cd)],_0x158c0e,'百度云检测');const _0xf454fd='您提交的信息中包含'+_0x158c0e['join'](',')+_0x24d0f3(0x1e3);throw new common_1[(_0x24d0f3(0x1af))](_0xf454fd,common_1[_0x24d0f3(0x1ee)][_0x24d0f3(0x1e1)]);}}[_0x4cb3db(0x1a8)](_0x5b66b8){const _0x285af6=_0x4cb3db,_0x4fec9a=_0x5b66b8[_0x285af6(0x1c6)](_0x1022a8=>_0x1022a8[_0x285af6(0x1bf)]),_0x1f8433=[...new Set(_0x4fec9a)];return _0x285af6(0x1c3)+_0x1f8433['join'](',')+_0x285af6(0x1f1);}async[_0x4cb3db(0x1b2)](){const _0x55e235=_0x4cb3db,_0x5cc362=await this[_0x55e235(0x1e6)][_0x55e235(0x1f5)]({'where':{'status':0x1},'select':['word']});this[_0x55e235(0x1d2)]=_0x5cc362[_0x55e235(0x1c6)](_0x3d7d23=>_0x3d7d23[_0x55e235(0x1f3)]);}async['queryBadWords'](_0x3b266e){const _0x5a6300=_0x4cb3db,{page:page=0x1,size:size=0x1f4,word:_0x36cb24,status:_0x1000c7}=_0x3b266e,_0x3d7b7={};[0x0,0x1,'0','1'][_0x5a6300(0x1e5)](_0x1000c7)&&(_0x3d7b7[_0x5a6300(0x1ab)]=_0x1000c7),_0x36cb24&&(_0x3d7b7[_0x5a6300(0x1f3)]=(0x0,typeorm_2[_0x5a6300(0x1a6)])('%'+_0x36cb24+'%'));const [_0xd2b99f,_0x20452a]=await this[_0x5a6300(0x1e6)][_0x5a6300(0x1aa)]({'where':_0x3d7b7,'skip':(page-0x1)*size,'take':size,'order':{'id':'ASC'}});return{'rows':_0xd2b99f,'count':_0x20452a};}async[_0x4cb3db(0x1f9)](_0x4fc82e){const _0x21bd78=_0x4cb3db,_0x4bb116=await this[_0x21bd78(0x1e6)][_0x21bd78(0x1db)]({'where':{'id':_0x4fc82e['id']}});if(!_0x4bb116)throw new common_1[(_0x21bd78(0x1af))]('敏感词不存在,请检查您的提交信息',common_1['HttpStatus']['BAD_REQUEST']);const _0x1d6daa=await this[_0x21bd78(0x1e6)][_0x21bd78(0x1c7)]({'id':_0x4fc82e['id']});if(_0x1d6daa[_0x21bd78(0x1c5)]>0x0)return await this[_0x21bd78(0x1b2)](),_0x21bd78(0x1b5);else throw new common_1[(_0x21bd78(0x1af))](_0x21bd78(0x1e8),common_1[_0x21bd78(0x1ee)][_0x21bd78(0x1e1)]);}async['updateBadWords'](_0x54297a){const _0xc7f5d1=_0x4cb3db,{id:_0x438dc6,word:_0x104eb0,status:_0x473b81}=_0x54297a,_0x397aa4=await this[_0xc7f5d1(0x1e6)][_0xc7f5d1(0x1db)]({'where':{'word':_0x104eb0}});if(_0x397aa4)throw new common_1[(_0xc7f5d1(0x1af))](_0xc7f5d1(0x1bd),common_1['HttpStatus'][_0xc7f5d1(0x1e1)]);const _0x18cc93=await this[_0xc7f5d1(0x1e6)]['update']({'id':_0x438dc6},{'word':_0x104eb0,'status':_0x473b81});if(_0x18cc93[_0xc7f5d1(0x1c5)]>0x0)return await this[_0xc7f5d1(0x1b2)](),_0xc7f5d1(0x1f6);else throw new common_1[(_0xc7f5d1(0x1af))](_0xc7f5d1(0x1ff),common_1[_0xc7f5d1(0x1ee)][_0xc7f5d1(0x1e1)]);}async[_0x4cb3db(0x1fb)](_0x588ed3){const _0x2f5751=_0x4cb3db,{word:_0x27dae8}=_0x588ed3,_0x4c9c6e=await this[_0x2f5751(0x1e6)][_0x2f5751(0x1db)]({'where':{'word':_0x27dae8}});if(_0x4c9c6e)throw new common_1['HttpException'](_0x2f5751(0x207),common_1[_0x2f5751(0x1ee)][_0x2f5751(0x1e1)]);return await this[_0x2f5751(0x1e6)][_0x2f5751(0x1d7)]({'word':_0x27dae8}),await this[_0x2f5751(0x1b2)](),_0x2f5751(0x19e);}async[_0x4cb3db(0x1c0)](_0x153d14,_0xa01063,_0xa7092f,_0x310bbd,_0x3343c6){const _0x381aea=_0x4cb3db,_0x139cc3={'userId':_0x153d14,'content':_0xa01063,'words':JSON['stringify'](_0xa7092f),'typeCn':JSON[_0x381aea(0x1d3)](_0x310bbd),'typeOriginCn':_0x3343c6};try{await this[_0x381aea(0x19c)]['createQueryBuilder']()[_0x381aea(0x1cc)](user_entity_1[_0x381aea(0x1be)])[_0x381aea(0x1a2)]({'violationCount':()=>'violationCount\x20+\x201'})[_0x381aea(0x1d4)]('id\x20=\x20:userId',{'userId':_0x153d14})[_0x381aea(0x1d1)](),await this[_0x381aea(0x1b4)][_0x381aea(0x1d7)](_0x139cc3);}catch(_0x3346c6){console[_0x381aea(0x1e7)](_0x381aea(0x1df),_0x3346c6);}}async[_0x4cb3db(0x1ae)](_0x1d437c,_0x10cb07){const _0x15d0f5=_0x4cb3db,{role:_0x198f73}=_0x1d437c[_0x15d0f5(0x1c1)],{page:page=0x1,size:size=0xa,userId:_0x5b0add,typeOriginCn:_0x1842bc}=_0x10cb07,_0x24c524={};_0x5b0add&&(_0x24c524[_0x15d0f5(0x1e4)]=_0x5b0add),_0x1842bc&&(_0x24c524[_0x15d0f5(0x1a5)]=_0x1842bc);const [_0x41ec8b,_0x2b7c8d]=await this['violationLogEntity'][_0x15d0f5(0x1aa)]({'where':_0x24c524,'skip':(page-0x1)*size,'take':size,'order':{'id':_0x15d0f5(0x1a1)}}),_0x1e5a6c=[...new Set(_0x41ec8b['map'](_0xe190eb=>_0xe190eb[_0x15d0f5(0x1e4)]))],_0x4c22a7=await this[_0x15d0f5(0x19c)][_0x15d0f5(0x1f5)]({'where':{'id':(0x0,typeorm_2['In'])(_0x1e5a6c)},'select':['id',_0x15d0f5(0x1b3),_0x15d0f5(0x1b1),_0x15d0f5(0x1f4),_0x15d0f5(0x1e2),_0x15d0f5(0x1ab)]});return _0x41ec8b[_0x15d0f5(0x204)](_0x4e2572=>{const _0x21d55=_0x15d0f5,_0x20facd=_0x4c22a7[_0x21d55(0x1f5)](_0x5ca1c1=>_0x5ca1c1['id']===_0x4e2572[_0x21d55(0x1e4)])||{};_0x198f73!==_0x21d55(0x1b7)&&(_0x20facd['email']=(0x0,utils_1['hideString'])(_0x20facd['email'])),_0x4e2572[_0x21d55(0x1a4)]=_0x20facd;}),{'rows':_0x41ec8b,'count':_0x2b7c8d};}};BadWordsService=__decorate([(0x0,common_1[_0x4cb3db(0x1d8)])(),__param(0x0,(0x0,typeorm_1[_0x4cb3db(0x19f)])(badWords_entity_1[_0x4cb3db(0x1bb)])),__param(0x1,(0x0,typeorm_1[_0x4cb3db(0x19f)])(violationLog_entity_1[_0x4cb3db(0x1dd)])),__param(0x2,(0x0,typeorm_1[_0x4cb3db(0x19f)])(user_entity_1['UserEntity'])),__metadata(_0x4cb3db(0x200),[typeorm_2['Repository'],typeorm_2[_0x4cb3db(0x1ac)],typeorm_2[_0x4cb3db(0x1ac)],globalConfig_service_1[_0x4cb3db(0x1d6)]])],BadWordsService),exports['BadWordsService']=BadWordsService;