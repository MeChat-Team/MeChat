'use strict';function _0x99fd(){const _0xef2a4a=['word','delete','category','metadata','avatar','userId','../../common/utils','stringify','3875dGQCHD','globalConfigService','axios','violationCount','badWordsEntity','save','10lWFWIr','typeorm','delBadWords','https://aip.baidubce.com/rest/2.0/solution/v1/text_censor/v2/user_defined?access_token=','baiduCheckBadWords','HttpException','find','baidu','./violationLog.entity','update','2AIIEBO','1540749JXthhF','match','2063019CqEbHL','join','extractContent','更新敏感词成功','status','queryBadWords','customSensitiveWords','__param','更新敏感词失败','BAD_REQUEST','@nestjs/typeorm','Repository','default','design:paramtypes','敏感词不存在,请检查您的提交信息','violationLogEntity','findAndCount','updateBadWords','push','decorate','UserEntity','log','getSensitiveConfig','917933SeWrBK','您提交的信息中包含','InjectRepository','您提交的内容中包含','onModuleInit','10403404OoxEeM','ASC','DESC','@nestjs/common','checkBadWordsByConfig','super','object','createQueryBuilder','__decorate','defineProperty','checkBadWords','userEntity','set','37837416XVTLHj','24nMmPKA','自定义检测','post','typeOriginCn','function','map','GlobalConfigService','Like','recordUserBadWords','username','baiduTextAccessToken','BadWordsEntity','error:\x20','violationCount\x20+\x201','HttpStatus','getOwnPropertyDescriptor','百度文本检测出现错误、请查看配置信息:\x20','的内容、我们已对您的账户进行标记、请合规使用！','自定义','Injectable','删除敏感词成功','length','BadWordsService','userInfo','敏感词已经存在了、请勿重复添加','badWords','includes','loadBadWords','13VUIgoN','email','__metadata','添加敏感词成功','formarTips','user','10791lRNrkD','msg','../user/user.entity','affected','../globalConfig/globalConfig.service','1248YmMHzY','删除敏感词失败','的信息、我们已对您账号进行标记、请合规使用！','findOne','id\x20=\x20:userId','./badWords.entity','forEach','5048OIdurB','__esModule'];_0x99fd=function(){return _0xef2a4a;};return _0x99fd();}const _0x3006c3=_0xded1;(function(_0x3bcb44,_0x2485b2){const _0x549c69=_0xded1,_0x390c0d=_0x3bcb44();while(!![]){try{const _0x32bc7f=-parseInt(_0x549c69(0x186))/0x1+-parseInt(_0x549c69(0x16c))/0x2*(parseInt(_0x549c69(0x16f))/0x3)+parseInt(_0x549c69(0x14b))/0x4*(-parseInt(_0x549c69(0x15c))/0x5)+-parseInt(_0x549c69(0x199))/0x6*(parseInt(_0x549c69(0x16d))/0x7)+parseInt(_0x549c69(0x152))/0x8*(-parseInt(_0x549c69(0x146))/0x9)+-parseInt(_0x549c69(0x162))/0xa*(-parseInt(_0x549c69(0x18b))/0xb)+-parseInt(_0x549c69(0x198))/0xc*(-parseInt(_0x549c69(0x1b5))/0xd);if(_0x32bc7f===_0x2485b2)break;else _0x390c0d['push'](_0x390c0d['shift']());}catch(_0x39af5a){_0x390c0d['push'](_0x390c0d['shift']());}}}(_0x99fd,0x9604f));function _0xded1(_0x1f1dcd,_0x5e6c2a){const _0x99fd53=_0x99fd();return _0xded1=function(_0xded10,_0x2a7202){_0xded10=_0xded10-0x146;let _0x17488d=_0x99fd53[_0xded10];return _0x17488d;},_0xded1(_0x1f1dcd,_0x5e6c2a);}var __decorate=this&&this[_0x3006c3(0x193)]||function(_0x19ed6d,_0x561c42,_0x1b2199,_0x1a6bfd){const _0x692b7f=_0x3006c3;var _0x4e51b3=arguments['length'],_0x45224d=_0x4e51b3<0x3?_0x561c42:_0x1a6bfd===null?_0x1a6bfd=Object[_0x692b7f(0x1a8)](_0x561c42,_0x1b2199):_0x1a6bfd,_0x35e9be;if(typeof Reflect===_0x692b7f(0x191)&&typeof Reflect[_0x692b7f(0x182)]===_0x692b7f(0x19d))_0x45224d=Reflect[_0x692b7f(0x182)](_0x19ed6d,_0x561c42,_0x1b2199,_0x1a6bfd);else{for(var _0x4742cd=_0x19ed6d[_0x692b7f(0x1ae)]-0x1;_0x4742cd>=0x0;_0x4742cd--)if(_0x35e9be=_0x19ed6d[_0x4742cd])_0x45224d=(_0x4e51b3<0x3?_0x35e9be(_0x45224d):_0x4e51b3>0x3?_0x35e9be(_0x561c42,_0x1b2199,_0x45224d):_0x35e9be(_0x561c42,_0x1b2199))||_0x45224d;}return _0x4e51b3>0x3&&_0x45224d&&Object['defineProperty'](_0x561c42,_0x1b2199,_0x45224d),_0x45224d;},__metadata=this&&this[_0x3006c3(0x1b7)]||function(_0x5ba6dd,_0x9e896b){const _0xeb0d76=_0x3006c3;if(typeof Reflect==='object'&&typeof Reflect['metadata']==='function')return Reflect[_0xeb0d76(0x157)](_0x5ba6dd,_0x9e896b);},__param=this&&this[_0x3006c3(0x176)]||function(_0x597221,_0x3dde9a){return function(_0x5b059d,_0x4bb5ab){_0x3dde9a(_0x5b059d,_0x4bb5ab,_0x597221);};};Object[_0x3006c3(0x194)](exports,_0x3006c3(0x153),{'value':!![]}),exports[_0x3006c3(0x1af)]=void 0x0;const utils_1=require(_0x3006c3(0x15a)),common_1=require(_0x3006c3(0x18e)),typeorm_1=require(_0x3006c3(0x179)),axios_1=require(_0x3006c3(0x15e)),typeorm_2=require(_0x3006c3(0x163)),globalConfig_service_1=require(_0x3006c3(0x14a)),user_entity_1=require(_0x3006c3(0x148)),badWords_entity_1=require(_0x3006c3(0x150)),violationLog_entity_1=require(_0x3006c3(0x16a));let BadWordsService=class BadWordsService{constructor(_0x1c6566,_0x15814d,_0x3a10d9,_0x1c19c7){const _0x191068=_0x3006c3;this['badWordsEntity']=_0x1c6566,this[_0x191068(0x17e)]=_0x15814d,this[_0x191068(0x196)]=_0x3a10d9,this[_0x191068(0x15d)]=_0x1c19c7,this[_0x191068(0x1b2)]=[];}async[_0x3006c3(0x18a)](){this['loadBadWords']();}async[_0x3006c3(0x175)](_0x4ad2a4,_0x49788d){const _0x5beab1=_0x3006c3,_0x13e8f6=[];for(let _0x510565=0x0;_0x510565<this['badWords'][_0x5beab1(0x1ae)];_0x510565++){const _0x5c8c43=this[_0x5beab1(0x1b2)][_0x510565];_0x4ad2a4['includes'](_0x5c8c43)&&_0x13e8f6[_0x5beab1(0x181)](_0x5c8c43);}return _0x13e8f6[_0x5beab1(0x1ae)]&&await this['recordUserBadWords'](_0x49788d,_0x4ad2a4,_0x13e8f6,[_0x5beab1(0x1ab)],_0x5beab1(0x19a)),_0x13e8f6;}async[_0x3006c3(0x195)](_0x1100ed,_0x1682d1){const _0x4b149f=_0x3006c3,_0x2914b3=await this[_0x4b149f(0x15d)][_0x4b149f(0x185)]();return _0x2914b3&&await this[_0x4b149f(0x18f)](_0x1100ed,_0x2914b3,_0x1682d1),await this[_0x4b149f(0x175)](_0x1100ed,_0x1682d1);}async[_0x3006c3(0x18f)](_0x23edc6,_0x1d0360,_0x34ba36){const _0x123451=_0x3006c3,{useType:_0xed795e}=_0x1d0360;_0xed795e===_0x123451(0x169)&&await this[_0x123451(0x166)](_0x23edc6,_0x1d0360[_0x123451(0x1a3)],_0x34ba36);}[_0x3006c3(0x171)](_0x599c42){const _0x2f5d79=_0x3006c3,_0x1073d0=/存在(.*?)不合规/,_0x5e0f66=_0x599c42[_0x2f5d79(0x16e)](_0x1073d0);return _0x5e0f66?_0x5e0f66[0x1]:'';}async[_0x3006c3(0x166)](_0x3436a9,_0x596222,_0xdcea54){const _0x1a39ae=_0x3006c3;if(!_0x596222)return;const _0x750654=_0x1a39ae(0x165)+_0x596222+'}',_0x405405={'Content-Type':'application/x-www-form-urlencoded','Accept':'application/json'},_0x157811=await axios_1[_0x1a39ae(0x17b)][_0x1a39ae(0x19b)](_0x750654,{'text':_0x3436a9},{'headers':_0x405405}),{conclusion:_0xf8104f,error_code:_0x1af899,error_msg:_0x32eadb,conclusionType:_0x4ed673,data:_0x37f384}=_0x157811['data'];_0x1af899&&console[_0x1a39ae(0x184)](_0x1a39ae(0x1a9),_0x32eadb);if(_0x4ed673!==0x1){const _0x5030b2=[...new Set(_0x37f384[_0x1a39ae(0x19e)](_0x44ab19=>this[_0x1a39ae(0x171)](_0x44ab19[_0x1a39ae(0x147)])))];await this[_0x1a39ae(0x1a1)](_0xdcea54,_0x3436a9,['***'],_0x5030b2,'百度云检测');const _0x323380=_0x1a39ae(0x187)+_0x5030b2[_0x1a39ae(0x170)](',')+_0x1a39ae(0x1aa);throw new common_1[(_0x1a39ae(0x167))](_0x323380,common_1[_0x1a39ae(0x1a7)][_0x1a39ae(0x178)]);}}[_0x3006c3(0x1b9)](_0xdeac57){const _0x1ddc44=_0x3006c3,_0x4b6236=_0xdeac57[_0x1ddc44(0x19e)](_0x12cb77=>_0x12cb77[_0x1ddc44(0x156)]),_0x504e48=[...new Set(_0x4b6236)];return _0x1ddc44(0x189)+_0x504e48[_0x1ddc44(0x170)](',')+_0x1ddc44(0x14d);}async[_0x3006c3(0x1b4)](){const _0x386a18=_0x3006c3,_0x5dc1bb=await this['badWordsEntity'][_0x386a18(0x168)]({'where':{'status':0x1},'select':[_0x386a18(0x154)]});this[_0x386a18(0x1b2)]=_0x5dc1bb[_0x386a18(0x19e)](_0xfb64d3=>_0xfb64d3['word']);}async[_0x3006c3(0x174)](_0x5efad4){const _0x5292d8=_0x3006c3,{page:page=0x1,size:size=0x1f4,word:_0x4a52a0,status:_0x89e206}=_0x5efad4,_0x2cd821={};[0x0,0x1,'0','1'][_0x5292d8(0x1b3)](_0x89e206)&&(_0x2cd821[_0x5292d8(0x173)]=_0x89e206),_0x4a52a0&&(_0x2cd821[_0x5292d8(0x154)]=(0x0,typeorm_2[_0x5292d8(0x1a0)])('%'+_0x4a52a0+'%'));const [_0x50285a,_0x300d78]=await this[_0x5292d8(0x160)][_0x5292d8(0x17f)]({'where':_0x2cd821,'skip':(page-0x1)*size,'take':size,'order':{'id':_0x5292d8(0x18c)}});return{'rows':_0x50285a,'count':_0x300d78};}async[_0x3006c3(0x164)](_0x567599){const _0xe90fd2=_0x3006c3,_0x563faf=await this['badWordsEntity'][_0xe90fd2(0x14e)]({'where':{'id':_0x567599['id']}});if(!_0x563faf)throw new common_1[(_0xe90fd2(0x167))](_0xe90fd2(0x17d),common_1[_0xe90fd2(0x1a7)][_0xe90fd2(0x178)]);const _0x3fbf5d=await this[_0xe90fd2(0x160)][_0xe90fd2(0x155)]({'id':_0x567599['id']});if(_0x3fbf5d[_0xe90fd2(0x149)]>0x0)return await this[_0xe90fd2(0x1b4)](),_0xe90fd2(0x1ad);else throw new common_1['HttpException'](_0xe90fd2(0x14c),common_1[_0xe90fd2(0x1a7)][_0xe90fd2(0x178)]);}async[_0x3006c3(0x180)](_0x3cccad){const _0x56b6c4=_0x3006c3,{id:_0x3c0b97,word:_0x4084c4,status:_0x213d38}=_0x3cccad,_0x3c5505=await this['badWordsEntity']['findOne']({'where':{'word':_0x4084c4}});if(_0x3c5505)throw new common_1[(_0x56b6c4(0x167))](_0x56b6c4(0x1b1),common_1[_0x56b6c4(0x1a7)]['BAD_REQUEST']);const _0x2f2cf0=await this[_0x56b6c4(0x160)][_0x56b6c4(0x16b)]({'id':_0x3c0b97},{'word':_0x4084c4,'status':_0x213d38});if(_0x2f2cf0['affected']>0x0)return await this['loadBadWords'](),_0x56b6c4(0x172);else throw new common_1[(_0x56b6c4(0x167))](_0x56b6c4(0x177),common_1[_0x56b6c4(0x1a7)][_0x56b6c4(0x178)]);}async['addBadWord'](_0x4cb17e){const _0x5183f3=_0x3006c3,{word:_0x163462}=_0x4cb17e,_0x579760=await this[_0x5183f3(0x160)][_0x5183f3(0x14e)]({'where':{'word':_0x163462}});if(_0x579760)throw new common_1[(_0x5183f3(0x167))]('敏感词已存在,请检查您的提交信息',common_1['HttpStatus'][_0x5183f3(0x178)]);return await this[_0x5183f3(0x160)]['save']({'word':_0x163462}),await this['loadBadWords'](),_0x5183f3(0x1b8);}async[_0x3006c3(0x1a1)](_0x204dfb,_0x3b8cf2,_0x4f4141,_0x348ba4,_0x227681){const _0x44f698=_0x3006c3,_0x1eacc3={'userId':_0x204dfb,'content':_0x3b8cf2,'words':JSON['stringify'](_0x4f4141),'typeCn':JSON[_0x44f698(0x15b)](_0x348ba4),'typeOriginCn':_0x227681};try{await this[_0x44f698(0x196)][_0x44f698(0x192)]()[_0x44f698(0x16b)](user_entity_1['UserEntity'])[_0x44f698(0x197)]({'violationCount':()=>_0x44f698(0x1a6)})['where'](_0x44f698(0x14f),{'userId':_0x204dfb})['execute'](),await this[_0x44f698(0x17e)][_0x44f698(0x161)](_0x1eacc3);}catch(_0x25872b){console[_0x44f698(0x184)](_0x44f698(0x1a5),_0x25872b);}}async['violation'](_0x38c0ef,_0x5034a9){const _0x101487=_0x3006c3,{role:_0x4d7b21}=_0x38c0ef[_0x101487(0x1ba)],{page:page=0x1,size:size=0xa,userId:_0x55f27d,typeOriginCn:_0x43b59c}=_0x5034a9,_0x34c343={};_0x55f27d&&(_0x34c343[_0x101487(0x159)]=_0x55f27d),_0x43b59c&&(_0x34c343[_0x101487(0x19c)]=_0x43b59c);const [_0x3b29df,_0x48c2cc]=await this[_0x101487(0x17e)][_0x101487(0x17f)]({'where':_0x34c343,'skip':(page-0x1)*size,'take':size,'order':{'id':_0x101487(0x18d)}}),_0x10507e=[...new Set(_0x3b29df[_0x101487(0x19e)](_0x543307=>_0x543307[_0x101487(0x159)]))],_0x50b054=await this[_0x101487(0x196)][_0x101487(0x168)]({'where':{'id':(0x0,typeorm_2['In'])(_0x10507e)},'select':['id',_0x101487(0x158),_0x101487(0x1a2),_0x101487(0x1b6),_0x101487(0x15f),_0x101487(0x173)]});return _0x3b29df[_0x101487(0x151)](_0x230721=>{const _0x175d52=_0x101487,_0xf213fc=_0x50b054[_0x175d52(0x168)](_0x1bdbcb=>_0x1bdbcb['id']===_0x230721[_0x175d52(0x159)])||{};_0x4d7b21!==_0x175d52(0x190)&&(_0xf213fc[_0x175d52(0x1b6)]=(0x0,utils_1['hideString'])(_0xf213fc[_0x175d52(0x1b6)])),_0x230721[_0x175d52(0x1b0)]=_0xf213fc;}),{'rows':_0x3b29df,'count':_0x48c2cc};}};BadWordsService=__decorate([(0x0,common_1[_0x3006c3(0x1ac)])(),__param(0x0,(0x0,typeorm_1['InjectRepository'])(badWords_entity_1[_0x3006c3(0x1a4)])),__param(0x1,(0x0,typeorm_1[_0x3006c3(0x188)])(violationLog_entity_1['ViolationLogEntity'])),__param(0x2,(0x0,typeorm_1[_0x3006c3(0x188)])(user_entity_1[_0x3006c3(0x183)])),__metadata(_0x3006c3(0x17c),[typeorm_2[_0x3006c3(0x17a)],typeorm_2['Repository'],typeorm_2[_0x3006c3(0x17a)],globalConfig_service_1[_0x3006c3(0x19f)]])],BadWordsService),exports[_0x3006c3(0x1af)]=BadWordsService;