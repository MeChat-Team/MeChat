'use strict';const _0x5472bd=_0x522e;(function(_0x2cfad1,_0x5abc9e){const _0x231503=_0x522e,_0x2bcc7f=_0x2cfad1();while(!![]){try{const _0x13bac9=-parseInt(_0x231503(0x129))/0x1+parseInt(_0x231503(0x109))/0x2+-parseInt(_0x231503(0x116))/0x3+-parseInt(_0x231503(0x12a))/0x4*(parseInt(_0x231503(0x121))/0x5)+parseInt(_0x231503(0x14c))/0x6+-parseInt(_0x231503(0x132))/0x7+parseInt(_0x231503(0x166))/0x8;if(_0x13bac9===_0x5abc9e)break;else _0x2bcc7f['push'](_0x2bcc7f['shift']());}catch(_0x5dffba){_0x2bcc7f['push'](_0x2bcc7f['shift']());}}}(_0x4871,0x6aab6));var __decorate=this&&this[_0x5472bd(0x10e)]||function(_0x385b99,_0xf63797,_0x3aa05e,_0x2add8f){const _0x1d1949=_0x5472bd;var _0x50a2a8=arguments[_0x1d1949(0x111)],_0x3bae31=_0x50a2a8<0x3?_0xf63797:_0x2add8f===null?_0x2add8f=Object[_0x1d1949(0x155)](_0xf63797,_0x3aa05e):_0x2add8f,_0x243de5;if(typeof Reflect===_0x1d1949(0x134)&&typeof Reflect[_0x1d1949(0x158)]===_0x1d1949(0x13f))_0x3bae31=Reflect[_0x1d1949(0x158)](_0x385b99,_0xf63797,_0x3aa05e,_0x2add8f);else{for(var _0x4da7fa=_0x385b99[_0x1d1949(0x111)]-0x1;_0x4da7fa>=0x0;_0x4da7fa--)if(_0x243de5=_0x385b99[_0x4da7fa])_0x3bae31=(_0x50a2a8<0x3?_0x243de5(_0x3bae31):_0x50a2a8>0x3?_0x243de5(_0xf63797,_0x3aa05e,_0x3bae31):_0x243de5(_0xf63797,_0x3aa05e))||_0x3bae31;}return _0x50a2a8>0x3&&_0x3bae31&&Object[_0x1d1949(0x147)](_0xf63797,_0x3aa05e,_0x3bae31),_0x3bae31;},__metadata=this&&this['__metadata']||function(_0x1c6ea3,_0x36a3e6){const _0x450a3d=_0x5472bd;if(typeof Reflect===_0x450a3d(0x134)&&typeof Reflect[_0x450a3d(0x119)]===_0x450a3d(0x13f))return Reflect[_0x450a3d(0x119)](_0x1c6ea3,_0x36a3e6);},__param=this&&this[_0x5472bd(0x12e)]||function(_0x58de1c,_0x381a65){return function(_0x49b695,_0x1e8ca6){_0x381a65(_0x49b695,_0x1e8ca6,_0x58de1c);};};function _0x522e(_0x5c6ff9,_0x3f576d){const _0x487160=_0x4871();return _0x522e=function(_0x522e4b,_0x12a44b){_0x522e4b=_0x522e4b-0x104;let _0x4b486f=_0x487160[_0x522e4b];return _0x4b486f;},_0x522e(_0x5c6ff9,_0x3f576d);}function _0x4871(){const _0x1c4108=['defineProperty','delBadWords','badWordsEntity','百度云检测','UserEntity','1223640JAxxXl','axios','敏感词已经存在了、请勿重复添加','userId','save','extractContent','application/json','email','baidu','getOwnPropertyDescriptor','更新敏感词成功','InjectRepository','decorate','BAD_REQUEST','ViolationLogEntity','map','HttpException','../../common/utils','BadWordsService','hideString','@nestjs/common','createQueryBuilder','baiduCheckBadWords','onModuleInit','updateBadWords','敏感词已存在,请检查您的提交信息','14950728Pzepys','删除敏感词失败','includes','checkBadWordsByConfig','./badWords.entity','badWords','forEach','@nestjs/typeorm','design:paramtypes','match','539216wTwGCg','DESC','./violationLog.entity','violationLogEntity','ASC','__decorate','id\x20=\x20:userId','../user/user.entity','length','status','super','set','join','294414WmHJpa','application/x-www-form-urlencoded','error:\x20','metadata','自定义','百度文本检测出现错误、请查看配置信息:\x20','recordUserBadWords','execute','user','Repository','HttpStatus','10735zxLSBv','自定义检测','../globalConfig/globalConfig.service','__esModule','find','Like','avatar','stringify','869646dUTFUA','476brPHlj','getSensitiveConfig','您提交的信息中包含','***','__param','userEntity','queryBadWords','loadBadWords','4775358XPqbeJ','affected','object','baiduTextAccessToken','word','BadWordsEntity','findAndCount','globalConfigService','violationCount\x20+\x201','update','更新敏感词失败','log','的内容、我们已对您的账户进行标记、请合规使用！','function','category','customSensitiveWords','删除敏感词成功','Injectable','您提交的内容中包含','username','userInfo'];_0x4871=function(){return _0x1c4108;};return _0x4871();}Object[_0x5472bd(0x147)](exports,_0x5472bd(0x124),{'value':!![]}),exports[_0x5472bd(0x15e)]=void 0x0;const utils_1=require(_0x5472bd(0x15d)),common_1=require(_0x5472bd(0x160)),typeorm_1=require(_0x5472bd(0x106)),axios_1=require(_0x5472bd(0x14d)),typeorm_2=require('typeorm'),globalConfig_service_1=require(_0x5472bd(0x123)),user_entity_1=require(_0x5472bd(0x110)),badWords_entity_1=require(_0x5472bd(0x16a)),violationLog_entity_1=require(_0x5472bd(0x10b));let BadWordsService=class BadWordsService{constructor(_0x257d1f,_0x34a89b,_0x4b755c,_0x3fc1e6){const _0x4c2615=_0x5472bd;this[_0x4c2615(0x149)]=_0x257d1f,this['violationLogEntity']=_0x34a89b,this[_0x4c2615(0x12f)]=_0x4b755c,this[_0x4c2615(0x139)]=_0x3fc1e6,this['badWords']=[];}async[_0x5472bd(0x163)](){this['loadBadWords']();}async[_0x5472bd(0x141)](_0x2620a7,_0x5a6c58){const _0x445713=_0x5472bd,_0x162267=[];for(let _0xd30246=0x0;_0xd30246<this['badWords'][_0x445713(0x111)];_0xd30246++){const _0x49fb79=this['badWords'][_0xd30246];_0x2620a7['includes'](_0x49fb79)&&_0x162267['push'](_0x49fb79);}return _0x162267[_0x445713(0x111)]&&await this[_0x445713(0x11c)](_0x5a6c58,_0x2620a7,_0x162267,[_0x445713(0x11a)],_0x445713(0x122)),_0x162267;}async['checkBadWords'](_0x58a16c,_0x23b5ab){const _0xb98aa=_0x5472bd,_0x5e69fe=await this['globalConfigService'][_0xb98aa(0x12b)]();return _0x5e69fe&&await this[_0xb98aa(0x169)](_0x58a16c,_0x5e69fe,_0x23b5ab),await this[_0xb98aa(0x141)](_0x58a16c,_0x23b5ab);}async[_0x5472bd(0x169)](_0x44a9f9,_0x297d23,_0x5a9b6d){const _0x45c0a7=_0x5472bd,{useType:_0x47c86e}=_0x297d23;_0x47c86e===_0x45c0a7(0x154)&&await this[_0x45c0a7(0x162)](_0x44a9f9,_0x297d23[_0x45c0a7(0x135)],_0x5a9b6d);}[_0x5472bd(0x151)](_0x4112f5){const _0x1463b3=_0x5472bd,_0xa9b7dc=/存在(.*?)不合规/,_0x2697ec=_0x4112f5[_0x1463b3(0x108)](_0xa9b7dc);return _0x2697ec?_0x2697ec[0x1]:'';}async[_0x5472bd(0x162)](_0xdad808,_0x314396,_0x31f8cc){const _0x562982=_0x5472bd;if(!_0x314396)return;const _0x8399c='https://aip.baidubce.com/rest/2.0/solution/v1/text_censor/v2/user_defined?access_token='+_0x314396+'}',_0x2904e2={'Content-Type':_0x562982(0x117),'Accept':_0x562982(0x152)},_0x8cf58b=await axios_1['default']['post'](_0x8399c,{'text':_0xdad808},{'headers':_0x2904e2}),{conclusion:_0x30c0c1,error_code:_0x399baa,error_msg:_0x409aec,conclusionType:_0x3e9bb9,data:_0x1c2d32}=_0x8cf58b['data'];_0x399baa&&console[_0x562982(0x13d)](_0x562982(0x11b),_0x409aec);if(_0x3e9bb9!==0x1){const _0x30245f=[...new Set(_0x1c2d32[_0x562982(0x15b)](_0x406ddf=>this[_0x562982(0x151)](_0x406ddf['msg'])))];await this['recordUserBadWords'](_0x31f8cc,_0xdad808,[_0x562982(0x12d)],_0x30245f,_0x562982(0x14a));const _0x227e71=_0x562982(0x12c)+_0x30245f[_0x562982(0x115)](',')+_0x562982(0x13e);throw new common_1['HttpException'](_0x227e71,common_1['HttpStatus'][_0x562982(0x159)]);}}['formarTips'](_0x8cdd7a){const _0x23ccf8=_0x5472bd,_0xf0b1e0=_0x8cdd7a[_0x23ccf8(0x15b)](_0x18e21b=>_0x18e21b[_0x23ccf8(0x140)]),_0x3a31dc=[...new Set(_0xf0b1e0)];return _0x23ccf8(0x144)+_0x3a31dc[_0x23ccf8(0x115)](',')+'的信息、我们已对您账号进行标记、请合规使用！';}async[_0x5472bd(0x131)](){const _0xa10037=_0x5472bd,_0x22e85b=await this[_0xa10037(0x149)][_0xa10037(0x125)]({'where':{'status':0x1},'select':[_0xa10037(0x136)]});this[_0xa10037(0x104)]=_0x22e85b[_0xa10037(0x15b)](_0x5c0d70=>_0x5c0d70[_0xa10037(0x136)]);}async[_0x5472bd(0x130)](_0x27e202){const _0x46dce2=_0x5472bd,{page:page=0x1,size:size=0x1f4,word:_0xcc5641,status:_0x20ed60}=_0x27e202,_0x58fa8c={};[0x0,0x1,'0','1'][_0x46dce2(0x168)](_0x20ed60)&&(_0x58fa8c[_0x46dce2(0x112)]=_0x20ed60),_0xcc5641&&(_0x58fa8c['word']=(0x0,typeorm_2[_0x46dce2(0x126)])('%'+_0xcc5641+'%'));const [_0x2b5160,_0x322709]=await this[_0x46dce2(0x149)][_0x46dce2(0x138)]({'where':_0x58fa8c,'skip':(page-0x1)*size,'take':size,'order':{'id':_0x46dce2(0x10d)}});return{'rows':_0x2b5160,'count':_0x322709};}async[_0x5472bd(0x148)](_0x99b530){const _0x370b14=_0x5472bd,_0x4c3181=await this['badWordsEntity']['findOne']({'where':{'id':_0x99b530['id']}});if(!_0x4c3181)throw new common_1[(_0x370b14(0x15c))]('敏感词不存在,请检查您的提交信息',common_1[_0x370b14(0x120)][_0x370b14(0x159)]);const _0x1bfecc=await this['badWordsEntity']['delete']({'id':_0x99b530['id']});if(_0x1bfecc[_0x370b14(0x133)]>0x0)return await this[_0x370b14(0x131)](),_0x370b14(0x142);else throw new common_1[(_0x370b14(0x15c))](_0x370b14(0x167),common_1['HttpStatus']['BAD_REQUEST']);}async[_0x5472bd(0x164)](_0x4aae86){const _0xdcbaa1=_0x5472bd,{id:_0x3f6e0d,word:_0x211bbe,status:_0x23c042}=_0x4aae86,_0x47fc3f=await this['badWordsEntity']['findOne']({'where':{'word':_0x211bbe}});if(_0x47fc3f)throw new common_1[(_0xdcbaa1(0x15c))](_0xdcbaa1(0x14e),common_1['HttpStatus'][_0xdcbaa1(0x159)]);const _0xc03747=await this[_0xdcbaa1(0x149)][_0xdcbaa1(0x13b)]({'id':_0x3f6e0d},{'word':_0x211bbe,'status':_0x23c042});if(_0xc03747[_0xdcbaa1(0x133)]>0x0)return await this[_0xdcbaa1(0x131)](),_0xdcbaa1(0x156);else throw new common_1[(_0xdcbaa1(0x15c))](_0xdcbaa1(0x13c),common_1[_0xdcbaa1(0x120)][_0xdcbaa1(0x159)]);}async['addBadWord'](_0x2068b5){const _0x40bcb8=_0x5472bd,{word:_0x3cc258}=_0x2068b5,_0x36e530=await this[_0x40bcb8(0x149)]['findOne']({'where':{'word':_0x3cc258}});if(_0x36e530)throw new common_1['HttpException'](_0x40bcb8(0x165),common_1[_0x40bcb8(0x120)][_0x40bcb8(0x159)]);return await this[_0x40bcb8(0x149)][_0x40bcb8(0x150)]({'word':_0x3cc258}),await this[_0x40bcb8(0x131)](),'添加敏感词成功';}async[_0x5472bd(0x11c)](_0x48a662,_0xedfbd7,_0x3de512,_0x4ae814,_0x247577){const _0x3f05bd=_0x5472bd,_0x1c7925={'userId':_0x48a662,'content':_0xedfbd7,'words':JSON[_0x3f05bd(0x128)](_0x3de512),'typeCn':JSON[_0x3f05bd(0x128)](_0x4ae814),'typeOriginCn':_0x247577};try{await this['userEntity'][_0x3f05bd(0x161)]()['update'](user_entity_1['UserEntity'])[_0x3f05bd(0x114)]({'violationCount':()=>_0x3f05bd(0x13a)})['where'](_0x3f05bd(0x10f),{'userId':_0x48a662})[_0x3f05bd(0x11d)](),await this['violationLogEntity'][_0x3f05bd(0x150)](_0x1c7925);}catch(_0x4f4114){console['log'](_0x3f05bd(0x118),_0x4f4114);}}async['violation'](_0x388657,_0x15b90b){const _0xd52a46=_0x5472bd,{role:_0x1a45a3}=_0x388657[_0xd52a46(0x11e)],{page:page=0x1,size:size=0xa,userId:_0xc06955,typeOriginCn:_0x512da1}=_0x15b90b,_0x2b70bc={};_0xc06955&&(_0x2b70bc[_0xd52a46(0x14f)]=_0xc06955),_0x512da1&&(_0x2b70bc['typeOriginCn']=_0x512da1);const [_0x1c6136,_0x5865a8]=await this[_0xd52a46(0x10c)][_0xd52a46(0x138)]({'where':_0x2b70bc,'skip':(page-0x1)*size,'take':size,'order':{'id':_0xd52a46(0x10a)}}),_0x28fc1c=[...new Set(_0x1c6136[_0xd52a46(0x15b)](_0x4a1e00=>_0x4a1e00[_0xd52a46(0x14f)]))],_0x3d5135=await this[_0xd52a46(0x12f)][_0xd52a46(0x125)]({'where':{'id':(0x0,typeorm_2['In'])(_0x28fc1c)},'select':['id',_0xd52a46(0x127),_0xd52a46(0x145),_0xd52a46(0x153),'violationCount',_0xd52a46(0x112)]});return _0x1c6136[_0xd52a46(0x105)](_0x3768ea=>{const _0x3e5be5=_0xd52a46,_0x1009dc=_0x3d5135[_0x3e5be5(0x125)](_0x5f449e=>_0x5f449e['id']===_0x3768ea[_0x3e5be5(0x14f)])||{};_0x1a45a3!==_0x3e5be5(0x113)&&(_0x1009dc[_0x3e5be5(0x153)]=(0x0,utils_1[_0x3e5be5(0x15f)])(_0x1009dc[_0x3e5be5(0x153)])),_0x3768ea[_0x3e5be5(0x146)]=_0x1009dc;}),{'rows':_0x1c6136,'count':_0x5865a8};}};BadWordsService=__decorate([(0x0,common_1[_0x5472bd(0x143)])(),__param(0x0,(0x0,typeorm_1[_0x5472bd(0x157)])(badWords_entity_1[_0x5472bd(0x137)])),__param(0x1,(0x0,typeorm_1[_0x5472bd(0x157)])(violationLog_entity_1[_0x5472bd(0x15a)])),__param(0x2,(0x0,typeorm_1['InjectRepository'])(user_entity_1[_0x5472bd(0x14b)])),__metadata(_0x5472bd(0x107),[typeorm_2[_0x5472bd(0x11f)],typeorm_2[_0x5472bd(0x11f)],typeorm_2[_0x5472bd(0x11f)],globalConfig_service_1['GlobalConfigService']])],BadWordsService),exports[_0x5472bd(0x15e)]=BadWordsService;