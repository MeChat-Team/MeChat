'use strict';function _0x4f3a(_0x156838,_0x2e0dbd){const _0x138008=_0x1380();return _0x4f3a=function(_0x4f3a4c,_0x306bd2){_0x4f3a4c=_0x4f3a4c-0x11a;let _0x196e7f=_0x138008[_0x4f3a4c];return _0x196e7f;},_0x4f3a(_0x156838,_0x2e0dbd);}const _0x1e3dc8=_0x4f3a;(function(_0x49291a,_0x51ce61){const _0x1aac84=_0x4f3a,_0x4b023c=_0x49291a();while(!![]){try{const _0x5e986d=parseInt(_0x1aac84(0x17c))/0x1+parseInt(_0x1aac84(0x182))/0x2*(parseInt(_0x1aac84(0x12b))/0x3)+parseInt(_0x1aac84(0x175))/0x4*(-parseInt(_0x1aac84(0x124))/0x5)+-parseInt(_0x1aac84(0x13d))/0x6*(-parseInt(_0x1aac84(0x143))/0x7)+parseInt(_0x1aac84(0x135))/0x8*(-parseInt(_0x1aac84(0x16e))/0x9)+parseInt(_0x1aac84(0x167))/0xa*(parseInt(_0x1aac84(0x169))/0xb)+parseInt(_0x1aac84(0x13c))/0xc*(-parseInt(_0x1aac84(0x16b))/0xd);if(_0x5e986d===_0x51ce61)break;else _0x4b023c['push'](_0x4b023c['shift']());}catch(_0x1be359){_0x4b023c['push'](_0x4b023c['shift']());}}}(_0x1380,0xe9f84));var __decorate=this&&this[_0x1e3dc8(0x14d)]||function(_0x4b4407,_0x2a0819,_0x4a55a4,_0x313b6b){const _0xeccf6b=_0x1e3dc8;var _0x21b40a=arguments[_0xeccf6b(0x136)],_0x450b2d=_0x21b40a<0x3?_0x2a0819:_0x313b6b===null?_0x313b6b=Object[_0xeccf6b(0x122)](_0x2a0819,_0x4a55a4):_0x313b6b,_0x3260a7;if(typeof Reflect===_0xeccf6b(0x144)&&typeof Reflect[_0xeccf6b(0x154)]===_0xeccf6b(0x14e))_0x450b2d=Reflect['decorate'](_0x4b4407,_0x2a0819,_0x4a55a4,_0x313b6b);else{for(var _0x2ce086=_0x4b4407['length']-0x1;_0x2ce086>=0x0;_0x2ce086--)if(_0x3260a7=_0x4b4407[_0x2ce086])_0x450b2d=(_0x21b40a<0x3?_0x3260a7(_0x450b2d):_0x21b40a>0x3?_0x3260a7(_0x2a0819,_0x4a55a4,_0x450b2d):_0x3260a7(_0x2a0819,_0x4a55a4))||_0x450b2d;}return _0x21b40a>0x3&&_0x450b2d&&Object[_0xeccf6b(0x164)](_0x2a0819,_0x4a55a4,_0x450b2d),_0x450b2d;},__metadata=this&&this[_0x1e3dc8(0x142)]||function(_0xa71cfb,_0x4d7075){const _0x13fea9=_0x1e3dc8;if(typeof Reflect===_0x13fea9(0x144)&&typeof Reflect[_0x13fea9(0x140)]==='function')return Reflect[_0x13fea9(0x140)](_0xa71cfb,_0x4d7075);},__param=this&&this[_0x1e3dc8(0x130)]||function(_0x155b06,_0x1dc002){return function(_0x4ea683,_0x8bef9){_0x1dc002(_0x4ea683,_0x8bef9,_0x155b06);};};function _0x1380(){const _0x19a68c=['606249KOweCV','userId','https://aip.baidubce.com/rest/2.0/solution/v1/text_censor/v2/user_defined?access_token=','getSensitiveConfig','@nestjs/typeorm','find','188hqCSqi','更新敏感词失败','delBadWords','createQueryBuilder','includes','***','HttpStatus','BAD_REQUEST','您提交的信息中包含','default','badWords','username','typeOriginCn','delete','violationCount','addBadWord','getOwnPropertyDescriptor','findAndCount','555eVoXmj','log','百度文本检测出现错误、请查看配置信息:\x20','design:paramtypes','敏感词已存在,请检查您的提交信息','userInfo','forEach','7641fdFfkw','HttpException','ASC','InjectRepository','的信息、我们已对您账号进行标记、请合规使用！','__param','UserEntity','violationLogEntity','msg','badWordsEntity','11672ZCVESq','length','Like','map','../user/user.entity','BadWordsEntity','updateBadWords','2040LbfmcP','222sfMSra','application/json','checkBadWordsByConfig','metadata','GlobalConfigService','__metadata','305130NvkJvd','object','recordUserBadWords','的内容、我们已对您的账户进行标记、请合规使用！','ViolationLogEntity','自定义检测','match','checkBadWords','violationCount\x20+\x201','敏感词已经存在了、请勿重复添加','__decorate','function','queryBadWords','extractContent','loadBadWords','data','set','decorate','globalConfigService','affected','更新敏感词成功','../globalConfig/globalConfig.service','stringify','DESC','application/x-www-form-urlencoded','id\x20=\x20:userId','violation','./badWords.entity','__esModule','formarTips','baiduTextAccessToken','word','join','defineProperty','findOne','email','1485370UNjLrF','super','77qyeRmV','customSensitiveWords','33293MxieaW','userEntity','baiduCheckBadWords','10107yIyWFU','添加敏感词成功','onModuleInit','error:\x20','baidu','@nestjs/common','execute','16796pscuGR','./violationLog.entity','save','百度云检测','Repository','自定义','敏感词不存在,请检查您的提交信息'];_0x1380=function(){return _0x19a68c;};return _0x1380();}Object[_0x1e3dc8(0x164)](exports,_0x1e3dc8(0x15f),{'value':!![]}),exports['BadWordsService']=void 0x0;const utils_1=require('../../common/utils'),common_1=require(_0x1e3dc8(0x173)),typeorm_1=require(_0x1e3dc8(0x180)),axios_1=require('axios'),typeorm_2=require('typeorm'),globalConfig_service_1=require(_0x1e3dc8(0x158)),user_entity_1=require(_0x1e3dc8(0x139)),badWords_entity_1=require(_0x1e3dc8(0x15e)),violationLog_entity_1=require(_0x1e3dc8(0x176));let BadWordsService=class BadWordsService{constructor(_0x407e82,_0xc359bb,_0x5c9128,_0x34ba91){const _0x38847b=_0x1e3dc8;this[_0x38847b(0x134)]=_0x407e82,this['violationLogEntity']=_0xc359bb,this[_0x38847b(0x16c)]=_0x5c9128,this[_0x38847b(0x155)]=_0x34ba91,this[_0x38847b(0x11c)]=[];}async[_0x1e3dc8(0x170)](){this['loadBadWords']();}async[_0x1e3dc8(0x16a)](_0x5b678f,_0x57f637){const _0x380758=_0x1e3dc8,_0x7c5a8e=[];for(let _0x5a4abf=0x0;_0x5a4abf<this[_0x380758(0x11c)][_0x380758(0x136)];_0x5a4abf++){const _0x2165db=this[_0x380758(0x11c)][_0x5a4abf];_0x5b678f[_0x380758(0x186)](_0x2165db)&&_0x7c5a8e['push'](_0x2165db);}return _0x7c5a8e[_0x380758(0x136)]&&await this[_0x380758(0x145)](_0x57f637,_0x5b678f,_0x7c5a8e,[_0x380758(0x17a)],_0x380758(0x148)),_0x7c5a8e;}async[_0x1e3dc8(0x14a)](_0x3f6bc3,_0x40de97){const _0x5a18a6=_0x1e3dc8,_0x433488=await this[_0x5a18a6(0x155)][_0x5a18a6(0x17f)]();return _0x433488&&await this[_0x5a18a6(0x13f)](_0x3f6bc3,_0x433488,_0x40de97),await this['customSensitiveWords'](_0x3f6bc3,_0x40de97);}async[_0x1e3dc8(0x13f)](_0x5e82c0,_0x455913,_0x51dafd){const _0x56f84f=_0x1e3dc8,{useType:_0x5b11ea}=_0x455913;_0x5b11ea===_0x56f84f(0x172)&&await this[_0x56f84f(0x16d)](_0x5e82c0,_0x455913[_0x56f84f(0x161)],_0x51dafd);}[_0x1e3dc8(0x150)](_0x56bc18){const _0x51bd01=_0x1e3dc8,_0x20baa6=/存在(.*?)不合规/,_0x19aa15=_0x56bc18[_0x51bd01(0x149)](_0x20baa6);return _0x19aa15?_0x19aa15[0x1]:'';}async['baiduCheckBadWords'](_0x5f5379,_0x2e28ff,_0x618147){const _0x501041=_0x1e3dc8;if(!_0x2e28ff)return;const _0x4817df=_0x501041(0x17e)+_0x2e28ff+'}',_0x52026a={'Content-Type':_0x501041(0x15b),'Accept':_0x501041(0x13e)},_0x4eac64=await axios_1[_0x501041(0x11b)]['post'](_0x4817df,{'text':_0x5f5379},{'headers':_0x52026a}),{conclusion:_0x5894da,error_code:_0xbad159,error_msg:_0x3ee9c5,conclusionType:_0x3914c2,data:_0x1108e3}=_0x4eac64[_0x501041(0x152)];_0xbad159&&console[_0x501041(0x125)](_0x501041(0x126),_0x3ee9c5);if(_0x3914c2!==0x1){const _0x488373=[...new Set(_0x1108e3['map'](_0x39d48a=>this[_0x501041(0x150)](_0x39d48a[_0x501041(0x133)])))];await this[_0x501041(0x145)](_0x618147,_0x5f5379,[_0x501041(0x187)],_0x488373,_0x501041(0x178));const _0x1532d8=_0x501041(0x11a)+_0x488373[_0x501041(0x163)](',')+_0x501041(0x146);throw new common_1[(_0x501041(0x12c))](_0x1532d8,common_1[_0x501041(0x188)][_0x501041(0x189)]);}}[_0x1e3dc8(0x160)](_0x1428f2){const _0x1557ab=_0x1e3dc8,_0x2efa6c=_0x1428f2[_0x1557ab(0x138)](_0x3c8db2=>_0x3c8db2['category']),_0x3f061a=[...new Set(_0x2efa6c)];return'您提交的内容中包含'+_0x3f061a['join'](',')+_0x1557ab(0x12f);}async[_0x1e3dc8(0x151)](){const _0x2821ed=_0x1e3dc8,_0x5800fb=await this[_0x2821ed(0x134)][_0x2821ed(0x181)]({'where':{'status':0x1},'select':[_0x2821ed(0x162)]});this['badWords']=_0x5800fb['map'](_0x232123=>_0x232123[_0x2821ed(0x162)]);}async[_0x1e3dc8(0x14f)](_0x2012c4){const _0x258aa0=_0x1e3dc8,{page:page=0x1,size:size=0x1f4,word:_0x147918,status:_0x54e204}=_0x2012c4,_0x333bb7={};[0x0,0x1,'0','1']['includes'](_0x54e204)&&(_0x333bb7['status']=_0x54e204),_0x147918&&(_0x333bb7[_0x258aa0(0x162)]=(0x0,typeorm_2[_0x258aa0(0x137)])('%'+_0x147918+'%'));const [_0x5e962e,_0x40e55e]=await this[_0x258aa0(0x134)][_0x258aa0(0x123)]({'where':_0x333bb7,'skip':(page-0x1)*size,'take':size,'order':{'id':_0x258aa0(0x12d)}});return{'rows':_0x5e962e,'count':_0x40e55e};}async[_0x1e3dc8(0x184)](_0x3e1cbe){const _0x3ad252=_0x1e3dc8,_0x118cac=await this[_0x3ad252(0x134)]['findOne']({'where':{'id':_0x3e1cbe['id']}});if(!_0x118cac)throw new common_1[(_0x3ad252(0x12c))](_0x3ad252(0x17b),common_1[_0x3ad252(0x188)][_0x3ad252(0x189)]);const _0x1e6fd8=await this[_0x3ad252(0x134)][_0x3ad252(0x11f)]({'id':_0x3e1cbe['id']});if(_0x1e6fd8[_0x3ad252(0x156)]>0x0)return await this['loadBadWords'](),'删除敏感词成功';else throw new common_1[(_0x3ad252(0x12c))]('删除敏感词失败',common_1[_0x3ad252(0x188)][_0x3ad252(0x189)]);}async[_0x1e3dc8(0x13b)](_0xc250d){const _0x555406=_0x1e3dc8,{id:_0x321f4e,word:_0x476395,status:_0x364452}=_0xc250d,_0x1d897b=await this[_0x555406(0x134)]['findOne']({'where':{'word':_0x476395}});if(_0x1d897b)throw new common_1[(_0x555406(0x12c))](_0x555406(0x14c),common_1['HttpStatus']['BAD_REQUEST']);const _0x56138d=await this[_0x555406(0x134)]['update']({'id':_0x321f4e},{'word':_0x476395,'status':_0x364452});if(_0x56138d[_0x555406(0x156)]>0x0)return await this[_0x555406(0x151)](),_0x555406(0x157);else throw new common_1[(_0x555406(0x12c))](_0x555406(0x183),common_1[_0x555406(0x188)][_0x555406(0x189)]);}async[_0x1e3dc8(0x121)](_0x591570){const _0x2f7399=_0x1e3dc8,{word:_0x2d9777}=_0x591570,_0x2784a8=await this['badWordsEntity'][_0x2f7399(0x165)]({'where':{'word':_0x2d9777}});if(_0x2784a8)throw new common_1[(_0x2f7399(0x12c))](_0x2f7399(0x128),common_1['HttpStatus'][_0x2f7399(0x189)]);return await this[_0x2f7399(0x134)][_0x2f7399(0x177)]({'word':_0x2d9777}),await this[_0x2f7399(0x151)](),_0x2f7399(0x16f);}async[_0x1e3dc8(0x145)](_0x542d31,_0x4f4c7f,_0x574bf9,_0x24f907,_0x273523){const _0x4139ac=_0x1e3dc8,_0x34e133={'userId':_0x542d31,'content':_0x4f4c7f,'words':JSON[_0x4139ac(0x159)](_0x574bf9),'typeCn':JSON[_0x4139ac(0x159)](_0x24f907),'typeOriginCn':_0x273523};try{await this[_0x4139ac(0x16c)][_0x4139ac(0x185)]()['update'](user_entity_1[_0x4139ac(0x131)])[_0x4139ac(0x153)]({'violationCount':()=>_0x4139ac(0x14b)})['where'](_0x4139ac(0x15c),{'userId':_0x542d31})[_0x4139ac(0x174)](),await this[_0x4139ac(0x132)][_0x4139ac(0x177)](_0x34e133);}catch(_0x599812){console[_0x4139ac(0x125)](_0x4139ac(0x171),_0x599812);}}async[_0x1e3dc8(0x15d)](_0x4b09f6,_0x1336ee){const _0x38d6ed=_0x1e3dc8,{role:_0x3bd4bc}=_0x4b09f6['user'],{page:page=0x1,size:size=0xa,userId:_0x520e47,typeOriginCn:_0x2e40a9}=_0x1336ee,_0x5e9f8e={};_0x520e47&&(_0x5e9f8e['userId']=_0x520e47),_0x2e40a9&&(_0x5e9f8e[_0x38d6ed(0x11e)]=_0x2e40a9);const [_0x33a8b8,_0x4f06be]=await this[_0x38d6ed(0x132)]['findAndCount']({'where':_0x5e9f8e,'skip':(page-0x1)*size,'take':size,'order':{'id':_0x38d6ed(0x15a)}}),_0x457bfb=[...new Set(_0x33a8b8[_0x38d6ed(0x138)](_0x5435ef=>_0x5435ef[_0x38d6ed(0x17d)]))],_0x4afb4a=await this[_0x38d6ed(0x16c)]['find']({'where':{'id':(0x0,typeorm_2['In'])(_0x457bfb)},'select':['id','avatar',_0x38d6ed(0x11d),'email',_0x38d6ed(0x120),'status']});return _0x33a8b8[_0x38d6ed(0x12a)](_0x21886c=>{const _0x173d5e=_0x38d6ed,_0x4047a7=_0x4afb4a[_0x173d5e(0x181)](_0x4a5e23=>_0x4a5e23['id']===_0x21886c[_0x173d5e(0x17d)])||{};_0x3bd4bc!==_0x173d5e(0x168)&&(_0x4047a7[_0x173d5e(0x166)]=(0x0,utils_1['hideString'])(_0x4047a7['email'])),_0x21886c[_0x173d5e(0x129)]=_0x4047a7;}),{'rows':_0x33a8b8,'count':_0x4f06be};}};BadWordsService=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,typeorm_1[_0x1e3dc8(0x12e)])(badWords_entity_1[_0x1e3dc8(0x13a)])),__param(0x1,(0x0,typeorm_1['InjectRepository'])(violationLog_entity_1[_0x1e3dc8(0x147)])),__param(0x2,(0x0,typeorm_1['InjectRepository'])(user_entity_1[_0x1e3dc8(0x131)])),__metadata(_0x1e3dc8(0x127),[typeorm_2[_0x1e3dc8(0x179)],typeorm_2[_0x1e3dc8(0x179)],typeorm_2[_0x1e3dc8(0x179)],globalConfig_service_1[_0x1e3dc8(0x141)]])],BadWordsService),exports['BadWordsService']=BadWordsService;