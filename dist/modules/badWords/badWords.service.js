'use strict';const _0x3f0e65=_0x31ff;(function(_0x1354a9,_0x1c9f45){const _0x38406c=_0x31ff,_0x8dd89f=_0x1354a9();while(!![]){try{const _0x107d55=parseInt(_0x38406c(0x219))/0x1*(-parseInt(_0x38406c(0x1ee))/0x2)+-parseInt(_0x38406c(0x1ed))/0x3*(parseInt(_0x38406c(0x1cc))/0x4)+-parseInt(_0x38406c(0x1b8))/0x5*(-parseInt(_0x38406c(0x1c3))/0x6)+-parseInt(_0x38406c(0x1bb))/0x7*(-parseInt(_0x38406c(0x20c))/0x8)+parseInt(_0x38406c(0x209))/0x9+-parseInt(_0x38406c(0x1e9))/0xa*(-parseInt(_0x38406c(0x1d1))/0xb)+-parseInt(_0x38406c(0x1de))/0xc*(parseInt(_0x38406c(0x20e))/0xd);if(_0x107d55===_0x1c9f45)break;else _0x8dd89f['push'](_0x8dd89f['shift']());}catch(_0xe1b37e){_0x8dd89f['push'](_0x8dd89f['shift']());}}}(_0x3bd1,0xdc623));var __decorate=this&&this[_0x3f0e65(0x206)]||function(_0x5c8a3c,_0x5daf4d,_0x55aa34,_0x4ec3e0){const _0x88a507=_0x3f0e65;var _0x47abad=arguments['length'],_0x13cd72=_0x47abad<0x3?_0x5daf4d:_0x4ec3e0===null?_0x4ec3e0=Object[_0x88a507(0x1d4)](_0x5daf4d,_0x55aa34):_0x4ec3e0,_0x5dffc7;if(typeof Reflect==='object'&&typeof Reflect['decorate']===_0x88a507(0x1e2))_0x13cd72=Reflect['decorate'](_0x5c8a3c,_0x5daf4d,_0x55aa34,_0x4ec3e0);else{for(var _0x341110=_0x5c8a3c['length']-0x1;_0x341110>=0x0;_0x341110--)if(_0x5dffc7=_0x5c8a3c[_0x341110])_0x13cd72=(_0x47abad<0x3?_0x5dffc7(_0x13cd72):_0x47abad>0x3?_0x5dffc7(_0x5daf4d,_0x55aa34,_0x13cd72):_0x5dffc7(_0x5daf4d,_0x55aa34))||_0x13cd72;}return _0x47abad>0x3&&_0x13cd72&&Object[_0x88a507(0x1b9)](_0x5daf4d,_0x55aa34,_0x13cd72),_0x13cd72;},__metadata=this&&this[_0x3f0e65(0x1ec)]||function(_0x566c37,_0x5d8bbd){const _0x3c3d0a=_0x3f0e65;if(typeof Reflect===_0x3c3d0a(0x1cb)&&typeof Reflect[_0x3c3d0a(0x1c5)]===_0x3c3d0a(0x1e2))return Reflect[_0x3c3d0a(0x1c5)](_0x566c37,_0x5d8bbd);},__param=this&&this[_0x3f0e65(0x1f8)]||function(_0x1be94a,_0x10161e){return function(_0x305ed2,_0x1aca04){_0x10161e(_0x305ed2,_0x1aca04,_0x1be94a);};};Object['defineProperty'](exports,_0x3f0e65(0x1be),{'value':!![]}),exports['BadWordsService']=void 0x0;const utils_1=require(_0x3f0e65(0x1dc)),common_1=require(_0x3f0e65(0x214)),typeorm_1=require('@nestjs/typeorm'),axios_1=require('axios'),typeorm_2=require(_0x3f0e65(0x1b6)),globalConfig_service_1=require(_0x3f0e65(0x216)),user_entity_1=require(_0x3f0e65(0x1e0)),badWords_entity_1=require(_0x3f0e65(0x1e6)),violationLog_entity_1=require(_0x3f0e65(0x1ca));let BadWordsService=class BadWordsService{constructor(_0xe17337,_0x75d38,_0x562496,_0x5bb199){const _0x5b4ea8=_0x3f0e65;this[_0x5b4ea8(0x205)]=_0xe17337,this[_0x5b4ea8(0x200)]=_0x75d38,this[_0x5b4ea8(0x1a9)]=_0x562496,this[_0x5b4ea8(0x1b5)]=_0x5bb199,this['badWords']=[];}async[_0x3f0e65(0x1f4)](){const _0x10e706=_0x3f0e65;this[_0x10e706(0x1fe)]();}async['customSensitiveWords'](_0x2ebca4,_0x565606){const _0x315ab1=_0x3f0e65,_0x33c617=[];for(let _0x2d39b9=0x0;_0x2d39b9<this['badWords'][_0x315ab1(0x1f7)];_0x2d39b9++){const _0x1b9da6=this[_0x315ab1(0x1f3)][_0x2d39b9];_0x2ebca4[_0x315ab1(0x1bf)](_0x1b9da6)&&_0x33c617['push'](_0x1b9da6);}return _0x33c617[_0x315ab1(0x1f7)]&&await this[_0x315ab1(0x1ba)](_0x565606,_0x2ebca4,_0x33c617,[_0x315ab1(0x215)],'自定义检测'),_0x33c617;}async[_0x3f0e65(0x1a8)](_0x38a1a5,_0x11964c){const _0x4f3132=_0x3f0e65,_0x2a30a3=await this[_0x4f3132(0x1b5)][_0x4f3132(0x1ea)]();return _0x2a30a3&&await this[_0x4f3132(0x202)](_0x38a1a5,_0x2a30a3,_0x11964c),await this[_0x4f3132(0x1a7)](_0x38a1a5,_0x11964c);}async['checkBadWordsByConfig'](_0x5acb79,_0x333529,_0x3ff0f4){const _0x559ee8=_0x3f0e65,{useType:_0x49856b}=_0x333529;_0x49856b===_0x559ee8(0x1ff)&&await this[_0x559ee8(0x1d3)](_0x5acb79,_0x333529[_0x559ee8(0x1c2)],_0x3ff0f4);}[_0x3f0e65(0x1d0)](_0x39cd31){const _0x31d91c=/存在(.*?)不合规/,_0x3a4416=_0x39cd31['match'](_0x31d91c);return _0x3a4416?_0x3a4416[0x1]:'';}async[_0x3f0e65(0x1d3)](_0xf49f89,_0x2b4a3b,_0x108243){const _0x3b07e4=_0x3f0e65;if(!_0x2b4a3b)return;const _0x331533=_0x3b07e4(0x1b2)+_0x2b4a3b+'}',_0x2446ec={'Content-Type':_0x3b07e4(0x1bd),'Accept':'application/json'},_0x17cca4=await axios_1[_0x3b07e4(0x1c1)]['post'](_0x331533,{'text':_0xf49f89},{'headers':_0x2446ec}),{conclusion:_0x5b658e,error_code:_0x5b0a25,error_msg:_0x52175e,conclusionType:_0x1a7b0b,data:_0x1ec832}=_0x17cca4[_0x3b07e4(0x1e7)];_0x5b0a25&&console['log'](_0x3b07e4(0x1f6),_0x52175e);if(_0x1a7b0b!==0x1){const _0x45e4f9=[...new Set(_0x1ec832[_0x3b07e4(0x21a)](_0x324e1d=>this[_0x3b07e4(0x1d0)](_0x324e1d['msg'])))];await this['recordUserBadWords'](_0x108243,_0xf49f89,[_0x3b07e4(0x1f9)],_0x45e4f9,_0x3b07e4(0x1ae));const _0x421d78=_0x3b07e4(0x1fd)+_0x45e4f9[_0x3b07e4(0x1fb)](',')+_0x3b07e4(0x201);throw new common_1[(_0x3b07e4(0x1c0))](_0x421d78,common_1[_0x3b07e4(0x1ac)][_0x3b07e4(0x1e4)]);}}[_0x3f0e65(0x20b)](_0x5f5251){const _0x1c84ac=_0x3f0e65,_0x372cc5=_0x5f5251[_0x1c84ac(0x21a)](_0x44c75a=>_0x44c75a[_0x1c84ac(0x212)]),_0x1641db=[...new Set(_0x372cc5)];return _0x1c84ac(0x1ad)+_0x1641db[_0x1c84ac(0x1fb)](',')+_0x1c84ac(0x1f1);}async[_0x3f0e65(0x1fe)](){const _0x447100=_0x3f0e65,_0x4ff00a=await this[_0x447100(0x205)][_0x447100(0x1e1)]({'where':{'status':0x1},'select':[_0x447100(0x207)]});this[_0x447100(0x1f3)]=_0x4ff00a['map'](_0x27fdf3=>_0x27fdf3[_0x447100(0x207)]);}async[_0x3f0e65(0x1ce)](_0xda0f63){const _0x2e403e=_0x3f0e65,{page:page=0x1,size:size=0x1f4,word:_0x4ce3d5,status:_0x2f1083}=_0xda0f63,_0x4ef67c={};[0x0,0x1,'0','1']['includes'](_0x2f1083)&&(_0x4ef67c[_0x2e403e(0x1e3)]=_0x2f1083),_0x4ce3d5&&(_0x4ef67c[_0x2e403e(0x207)]=(0x0,typeorm_2[_0x2e403e(0x1db)])('%'+_0x4ce3d5+'%'));const [_0x3b5760,_0x1d72ec]=await this[_0x2e403e(0x205)][_0x2e403e(0x210)]({'where':_0x4ef67c,'skip':(page-0x1)*size,'take':size,'order':{'id':_0x2e403e(0x1c9)}});return{'rows':_0x3b5760,'count':_0x1d72ec};}async[_0x3f0e65(0x1f2)](_0x2da89d){const _0x1de5b8=_0x3f0e65,_0x3975c1=await this[_0x1de5b8(0x205)][_0x1de5b8(0x1fa)]({'where':{'id':_0x2da89d['id']}});if(!_0x3975c1)throw new common_1['HttpException'](_0x1de5b8(0x1b4),common_1[_0x1de5b8(0x1ac)][_0x1de5b8(0x1e4)]);const _0x12b1ff=await this['badWordsEntity'][_0x1de5b8(0x1c8)]({'id':_0x2da89d['id']});if(_0x12b1ff[_0x1de5b8(0x1da)]>0x0)return await this[_0x1de5b8(0x1fe)](),_0x1de5b8(0x1dd);else throw new common_1['HttpException'](_0x1de5b8(0x1f5),common_1[_0x1de5b8(0x1ac)]['BAD_REQUEST']);}async[_0x3f0e65(0x20d)](_0x453769){const _0x461ea6=_0x3f0e65,{id:_0x53e6bc,word:_0x4dcd2f,status:_0x749bc8}=_0x453769,_0x465727=await this[_0x461ea6(0x205)][_0x461ea6(0x1fa)]({'where':{'word':_0x4dcd2f}});if(_0x465727)throw new common_1[(_0x461ea6(0x1c0))](_0x461ea6(0x1c4),common_1[_0x461ea6(0x1ac)][_0x461ea6(0x1e4)]);const _0x9690d8=await this[_0x461ea6(0x205)]['update']({'id':_0x53e6bc},{'word':_0x4dcd2f,'status':_0x749bc8});if(_0x9690d8['affected']>0x0)return await this[_0x461ea6(0x1fe)](),_0x461ea6(0x208);else throw new common_1['HttpException'](_0x461ea6(0x1d9),common_1['HttpStatus'][_0x461ea6(0x1e4)]);}async[_0x3f0e65(0x1cf)](_0x286730){const _0x4609dc=_0x3f0e65,{word:_0x18b8ea}=_0x286730,_0x236e01=await this['badWordsEntity']['findOne']({'where':{'word':_0x18b8ea}});if(_0x236e01)throw new common_1[(_0x4609dc(0x1c0))](_0x4609dc(0x218),common_1[_0x4609dc(0x1ac)][_0x4609dc(0x1e4)]);return await this[_0x4609dc(0x205)][_0x4609dc(0x1c7)]({'word':_0x18b8ea}),await this[_0x4609dc(0x1fe)](),_0x4609dc(0x1f0);}async[_0x3f0e65(0x1ba)](_0xe7975f,_0x335238,_0x48dab9,_0x1e80df,_0x5a7664){const _0x4ef3e7=_0x3f0e65,_0x1dcade={'userId':_0xe7975f,'content':_0x335238,'words':JSON[_0x4ef3e7(0x1e8)](_0x48dab9),'typeCn':JSON[_0x4ef3e7(0x1e8)](_0x1e80df),'typeOriginCn':_0x5a7664};try{await this['userEntity'][_0x4ef3e7(0x1eb)]()[_0x4ef3e7(0x211)](user_entity_1['UserEntity'])[_0x4ef3e7(0x1d5)]({'violationCount':()=>_0x4ef3e7(0x1b3)})[_0x4ef3e7(0x203)](_0x4ef3e7(0x217),{'userId':_0xe7975f})[_0x4ef3e7(0x1cd)](),await this[_0x4ef3e7(0x200)]['save'](_0x1dcade);}catch(_0x4d92ff){console['log'](_0x4ef3e7(0x20f),_0x4d92ff);}}async[_0x3f0e65(0x1d6)](_0x3884be,_0x285504){const _0x269757=_0x3f0e65,{role:_0x21b8e9}=_0x3884be[_0x269757(0x213)],{page:page=0x1,size:size=0xa,userId:_0x3d69b5,typeOriginCn:_0x3e96d1}=_0x285504,_0x439e6e={};_0x3d69b5&&(_0x439e6e[_0x269757(0x204)]=_0x3d69b5),_0x3e96d1&&(_0x439e6e[_0x269757(0x1df)]=_0x3e96d1);const [_0x5784e2,_0x6bd9ac]=await this['violationLogEntity'][_0x269757(0x210)]({'where':_0x439e6e,'skip':(page-0x1)*size,'take':size,'order':{'id':'DESC'}}),_0x30e9d0=[...new Set(_0x5784e2[_0x269757(0x21a)](_0x3ae0af=>_0x3ae0af[_0x269757(0x204)]))],_0x25f8fc=await this['userEntity'][_0x269757(0x1e1)]({'where':{'id':(0x0,typeorm_2['In'])(_0x30e9d0)},'select':['id',_0x269757(0x1d7),_0x269757(0x1b1),'email',_0x269757(0x1e5),_0x269757(0x1e3)]});return _0x5784e2['forEach'](_0x2247a6=>{const _0x4a741b=_0x269757,_0x43ef51=_0x25f8fc[_0x4a741b(0x1e1)](_0x4d2744=>_0x4d2744['id']===_0x2247a6[_0x4a741b(0x204)])||{};_0x21b8e9!==_0x4a741b(0x1b0)&&(_0x43ef51[_0x4a741b(0x1ef)]=(0x0,utils_1[_0x4a741b(0x1d8)])(_0x43ef51['email'])),_0x2247a6[_0x4a741b(0x1af)]=_0x43ef51;}),{'rows':_0x5784e2,'count':_0x6bd9ac};}};function _0x31ff(_0x368c5e,_0x48ac65){const _0x3bd148=_0x3bd1();return _0x31ff=function(_0x31ff1b,_0x24c4a4){_0x31ff1b=_0x31ff1b-0x1a7;let _0x1dd151=_0x3bd148[_0x31ff1b];return _0x1dd151;},_0x31ff(_0x368c5e,_0x48ac65);}BadWordsService=__decorate([(0x0,common_1[_0x3f0e65(0x1aa)])(),__param(0x0,(0x0,typeorm_1[_0x3f0e65(0x1d2)])(badWords_entity_1[_0x3f0e65(0x20a)])),__param(0x1,(0x0,typeorm_1['InjectRepository'])(violationLog_entity_1[_0x3f0e65(0x1ab)])),__param(0x2,(0x0,typeorm_1[_0x3f0e65(0x1d2)])(user_entity_1['UserEntity'])),__metadata(_0x3f0e65(0x1fc),[typeorm_2[_0x3f0e65(0x1c6)],typeorm_2[_0x3f0e65(0x1c6)],typeorm_2[_0x3f0e65(0x1c6)],globalConfig_service_1[_0x3f0e65(0x1bc)]])],BadWordsService),exports[_0x3f0e65(0x1b7)]=BadWordsService;function _0x3bd1(){const _0x138bf7=['添加敏感词成功','的信息、我们已对您账号进行标记、请合规使用！','delBadWords','badWords','onModuleInit','删除敏感词失败','百度文本检测出现错误、请查看配置信息:\x20','length','__param','***','findOne','join','design:paramtypes','您提交的信息中包含','loadBadWords','baidu','violationLogEntity','的内容、我们已对您的账户进行标记、请合规使用！','checkBadWordsByConfig','where','userId','badWordsEntity','__decorate','word','更新敏感词成功','13422069nEWOTM','BadWordsEntity','formarTips','858680bWDgJt','updateBadWords','30722068lGBira','error:\x20','findAndCount','update','category','user','@nestjs/common','自定义','../globalConfig/globalConfig.service','id\x20=\x20:userId','敏感词已存在,请检查您的提交信息','2302MsIDam','map','customSensitiveWords','checkBadWords','userEntity','Injectable','ViolationLogEntity','HttpStatus','您提交的内容中包含','百度云检测','userInfo','super','username','https://aip.baidubce.com/rest/2.0/solution/v1/text_censor/v2/user_defined?access_token=','violationCount\x20+\x201','敏感词不存在,请检查您的提交信息','globalConfigService','typeorm','BadWordsService','1115PuSDyT','defineProperty','recordUserBadWords','21AFFYRz','GlobalConfigService','application/x-www-form-urlencoded','__esModule','includes','HttpException','default','baiduTextAccessToken','34788gOUSaK','敏感词已经存在了、请勿重复添加','metadata','Repository','save','delete','ASC','./violationLog.entity','object','34708PEmrvX','execute','queryBadWords','addBadWord','extractContent','521697YmQuHv','InjectRepository','baiduCheckBadWords','getOwnPropertyDescriptor','set','violation','avatar','hideString','更新敏感词失败','affected','Like','../../common/utils','删除敏感词成功','12YkYMsM','typeOriginCn','../user/user.entity','find','function','status','BAD_REQUEST','violationCount','./badWords.entity','data','stringify','90VRTHZw','getSensitiveConfig','createQueryBuilder','__metadata','90naeBvC','6RoaXEB','email'];_0x3bd1=function(){return _0x138bf7;};return _0x3bd1();}