'use strict';function _0x4054(_0x5e4f02,_0x47a678){const _0x29fa9e=_0x29fa();return _0x4054=function(_0x4054e5,_0x398e6f){_0x4054e5=_0x4054e5-0xe1;let _0x213fd6=_0x29fa9e[_0x4054e5];return _0x213fd6;},_0x4054(_0x5e4f02,_0x47a678);}const _0x2197e0=_0x4054;(function(_0x74f548,_0x36dfb7){const _0x30e6a6=_0x4054,_0x3a9dff=_0x74f548();while(!![]){try{const _0x3c0167=parseInt(_0x30e6a6(0x102))/0x1*(-parseInt(_0x30e6a6(0xe4))/0x2)+-parseInt(_0x30e6a6(0x144))/0x3+-parseInt(_0x30e6a6(0xe1))/0x4*(parseInt(_0x30e6a6(0xf4))/0x5)+-parseInt(_0x30e6a6(0x12f))/0x6*(-parseInt(_0x30e6a6(0x132))/0x7)+parseInt(_0x30e6a6(0x136))/0x8+-parseInt(_0x30e6a6(0xfb))/0x9+parseInt(_0x30e6a6(0x103))/0xa;if(_0x3c0167===_0x36dfb7)break;else _0x3a9dff['push'](_0x3a9dff['shift']());}catch(_0x3bcd0e){_0x3a9dff['push'](_0x3a9dff['shift']());}}}(_0x29fa,0x49371));var __decorate=this&&this[_0x2197e0(0x145)]||function(_0xfd5bf2,_0x2ed84e,_0x142c9e,_0x112fd1){const _0x25bb11=_0x2197e0;var _0x50bbd5=arguments[_0x25bb11(0x120)],_0x596dfc=_0x50bbd5<0x3?_0x2ed84e:_0x112fd1===null?_0x112fd1=Object[_0x25bb11(0x127)](_0x2ed84e,_0x142c9e):_0x112fd1,_0x5e69fc;if(typeof Reflect===_0x25bb11(0x138)&&typeof Reflect['decorate']===_0x25bb11(0x11b))_0x596dfc=Reflect[_0x25bb11(0x106)](_0xfd5bf2,_0x2ed84e,_0x142c9e,_0x112fd1);else{for(var _0x45bbe0=_0xfd5bf2[_0x25bb11(0x120)]-0x1;_0x45bbe0>=0x0;_0x45bbe0--)if(_0x5e69fc=_0xfd5bf2[_0x45bbe0])_0x596dfc=(_0x50bbd5<0x3?_0x5e69fc(_0x596dfc):_0x50bbd5>0x3?_0x5e69fc(_0x2ed84e,_0x142c9e,_0x596dfc):_0x5e69fc(_0x2ed84e,_0x142c9e))||_0x596dfc;}return _0x50bbd5>0x3&&_0x596dfc&&Object[_0x25bb11(0x135)](_0x2ed84e,_0x142c9e,_0x596dfc),_0x596dfc;},__metadata=this&&this[_0x2197e0(0x11c)]||function(_0x14ff82,_0x4b1e13){const _0x4b1c93=_0x2197e0;if(typeof Reflect===_0x4b1c93(0x138)&&typeof Reflect[_0x4b1c93(0xed)]===_0x4b1c93(0x11b))return Reflect[_0x4b1c93(0xed)](_0x14ff82,_0x4b1e13);},__param=this&&this['__param']||function(_0x34ea29,_0x95ac23){return function(_0xf38f4e,_0x3f2c70){_0x95ac23(_0xf38f4e,_0x3f2c70,_0x34ea29);};};Object[_0x2197e0(0x135)](exports,'__esModule',{'value':!![]}),exports[_0x2197e0(0x10a)]=void 0x0;function _0x29fa(){const _0x40847a=['status','删除敏感词成功','log','1268892SjiMnW','__decorate','default','forEach','1892InIjQW','InjectRepository','data','38wljASK','删除敏感词失败','createQueryBuilder','hideString','updateBadWords','design:paramtypes','axios','username','Injectable','metadata','execute','../globalConfig/globalConfig.service','set','violationCount\x20+\x201','的内容、我们已对您的账户进行标记、请合规使用！','badWordsEntity','1595WPqvby','includes','baiduCheckBadWords','HttpStatus','category','typeorm','queryBadWords','879858ociXpV','百度云检测','application/json','的信息、我们已对您账号进行标记、请合规使用！','./violationLog.entity','BadWordsEntity','update','25798ebFjvC','10602700IXWSGe','checkBadWords','extractContent','decorate','globalConfigService','Repository','formarTips','BadWordsService','loadBadWords','post','findOne','findAndCount','更新敏感词成功','UserEntity','super','自定义','HttpException','BAD_REQUEST','join','更新敏感词失败','GlobalConfigService','find','userEntity','stringify','function','__metadata','push','violationLogEntity','msg','length','您提交的信息中包含','map','id\x20=\x20:userId','word','ASC','addBadWord','getOwnPropertyDescriptor','where','delBadWords','affected','敏感词已存在,请检查您的提交信息','save','recordUserBadWords','violation','48MvvodD','customSensitiveWords','Like','52367TcSbea','userId','您提交的内容中包含','defineProperty','2732368StpVlX','error:\x20','object','ViolationLogEntity','@nestjs/typeorm','添加敏感词成功','badWords','email','onModuleInit','***','https://aip.baidubce.com/rest/2.0/solution/v1/text_censor/v2/user_defined?access_token='];_0x29fa=function(){return _0x40847a;};return _0x29fa();}const utils_1=require('../../common/utils'),common_1=require('@nestjs/common'),typeorm_1=require(_0x2197e0(0x13a)),axios_1=require(_0x2197e0(0xea)),typeorm_2=require(_0x2197e0(0xf9)),globalConfig_service_1=require(_0x2197e0(0xef)),user_entity_1=require('../user/user.entity'),badWords_entity_1=require('./badWords.entity'),violationLog_entity_1=require(_0x2197e0(0xff));let BadWordsService=class BadWordsService{constructor(_0x9d86e0,_0x28e5de,_0x2ce471,_0x270ff1){const _0x19d71c=_0x2197e0;this['badWordsEntity']=_0x9d86e0,this[_0x19d71c(0x11e)]=_0x28e5de,this[_0x19d71c(0x119)]=_0x2ce471,this[_0x19d71c(0x107)]=_0x270ff1,this[_0x19d71c(0x13c)]=[];}async[_0x2197e0(0x13e)](){const _0x3c5d8a=_0x2197e0;this[_0x3c5d8a(0x10b)]();}async[_0x2197e0(0x130)](_0x18c85f,_0x1c6767){const _0x178eae=_0x2197e0,_0x1cdca9=[];for(let _0x5a9f27=0x0;_0x5a9f27<this[_0x178eae(0x13c)][_0x178eae(0x120)];_0x5a9f27++){const _0x82c093=this[_0x178eae(0x13c)][_0x5a9f27];_0x18c85f[_0x178eae(0xf5)](_0x82c093)&&_0x1cdca9[_0x178eae(0x11d)](_0x82c093);}return _0x1cdca9[_0x178eae(0x120)]&&await this[_0x178eae(0x12d)](_0x1c6767,_0x18c85f,_0x1cdca9,[_0x178eae(0x112)],'自定义检测'),_0x1cdca9;}async[_0x2197e0(0x104)](_0x3a26e7,_0x3350cb){const _0x3b1f9f=_0x2197e0,_0x7d32d1=await this[_0x3b1f9f(0x107)]['getSensitiveConfig']();return _0x7d32d1&&await this['checkBadWordsByConfig'](_0x3a26e7,_0x7d32d1,_0x3350cb),await this['customSensitiveWords'](_0x3a26e7,_0x3350cb);}async['checkBadWordsByConfig'](_0x3799bd,_0xb60d94,_0x44798e){const _0x4a97c2=_0x2197e0,{useType:_0x402644}=_0xb60d94;_0x402644==='baidu'&&await this[_0x4a97c2(0xf6)](_0x3799bd,_0xb60d94['baiduTextAccessToken'],_0x44798e);}[_0x2197e0(0x105)](_0x59d49e){const _0x467248=/存在(.*?)不合规/,_0xb7033e=_0x59d49e['match'](_0x467248);return _0xb7033e?_0xb7033e[0x1]:'';}async['baiduCheckBadWords'](_0x519e32,_0x20c7f3,_0x3b8b86){const _0x946cdb=_0x2197e0;if(!_0x20c7f3)return;const _0x31b57a=_0x946cdb(0x140)+_0x20c7f3+'}',_0x40f29c={'Content-Type':'application/x-www-form-urlencoded','Accept':_0x946cdb(0xfd)},_0x1bb8f0=await axios_1[_0x946cdb(0x146)][_0x946cdb(0x10c)](_0x31b57a,{'text':_0x519e32},{'headers':_0x40f29c}),{conclusion:_0x59e196,error_code:_0x42acc8,error_msg:_0x5116d8,conclusionType:_0x29da9b,data:_0x478673}=_0x1bb8f0[_0x946cdb(0xe3)];_0x42acc8&&console[_0x946cdb(0x143)]('百度文本检测出现错误、请查看配置信息:\x20',_0x5116d8);if(_0x29da9b!==0x1){const _0x5ecf91=[...new Set(_0x478673[_0x946cdb(0x122)](_0x543afc=>this['extractContent'](_0x543afc[_0x946cdb(0x11f)])))];await this[_0x946cdb(0x12d)](_0x3b8b86,_0x519e32,[_0x946cdb(0x13f)],_0x5ecf91,_0x946cdb(0xfc));const _0x5aeab4=_0x946cdb(0x121)+_0x5ecf91[_0x946cdb(0x115)](',')+_0x946cdb(0xf2);throw new common_1[(_0x946cdb(0x113))](_0x5aeab4,common_1[_0x946cdb(0xf7)][_0x946cdb(0x114)]);}}[_0x2197e0(0x109)](_0x5a9bd8){const _0xcfd71b=_0x2197e0,_0x1afd3d=_0x5a9bd8[_0xcfd71b(0x122)](_0x5c9722=>_0x5c9722[_0xcfd71b(0xf8)]),_0x58cea6=[...new Set(_0x1afd3d)];return _0xcfd71b(0x134)+_0x58cea6['join'](',')+_0xcfd71b(0xfe);}async[_0x2197e0(0x10b)](){const _0x2320f5=_0x2197e0,_0x10a888=await this[_0x2320f5(0xf3)][_0x2320f5(0x118)]({'where':{'status':0x1},'select':[_0x2320f5(0x124)]});this['badWords']=_0x10a888['map'](_0x1c7bab=>_0x1c7bab[_0x2320f5(0x124)]);}async[_0x2197e0(0xfa)](_0x3d7a1a){const _0x156d28=_0x2197e0,{page:page=0x1,size:size=0x1f4,word:_0xb3c813,status:_0x2212d0}=_0x3d7a1a,_0x3ee4e5={};[0x0,0x1,'0','1'][_0x156d28(0xf5)](_0x2212d0)&&(_0x3ee4e5['status']=_0x2212d0),_0xb3c813&&(_0x3ee4e5[_0x156d28(0x124)]=(0x0,typeorm_2[_0x156d28(0x131)])('%'+_0xb3c813+'%'));const [_0x1c6771,_0x481600]=await this['badWordsEntity'][_0x156d28(0x10e)]({'where':_0x3ee4e5,'skip':(page-0x1)*size,'take':size,'order':{'id':_0x156d28(0x125)}});return{'rows':_0x1c6771,'count':_0x481600};}async[_0x2197e0(0x129)](_0x3be89c){const _0x443b24=_0x2197e0,_0x15ed65=await this[_0x443b24(0xf3)][_0x443b24(0x10d)]({'where':{'id':_0x3be89c['id']}});if(!_0x15ed65)throw new common_1[(_0x443b24(0x113))]('敏感词不存在,请检查您的提交信息',common_1[_0x443b24(0xf7)][_0x443b24(0x114)]);const _0x3f9110=await this['badWordsEntity']['delete']({'id':_0x3be89c['id']});if(_0x3f9110[_0x443b24(0x12a)]>0x0)return await this[_0x443b24(0x10b)](),_0x443b24(0x142);else throw new common_1[(_0x443b24(0x113))](_0x443b24(0xe5),common_1[_0x443b24(0xf7)][_0x443b24(0x114)]);}async[_0x2197e0(0xe8)](_0x5ef230){const _0x3c2b10=_0x2197e0,{id:_0x179424,word:_0x46c8e7,status:_0x38fc3c}=_0x5ef230,_0x3b20ef=await this[_0x3c2b10(0xf3)][_0x3c2b10(0x10d)]({'where':{'word':_0x46c8e7}});if(_0x3b20ef)throw new common_1[(_0x3c2b10(0x113))]('敏感词已经存在了、请勿重复添加',common_1['HttpStatus'][_0x3c2b10(0x114)]);const _0x2c5c55=await this[_0x3c2b10(0xf3)][_0x3c2b10(0x101)]({'id':_0x179424},{'word':_0x46c8e7,'status':_0x38fc3c});if(_0x2c5c55[_0x3c2b10(0x12a)]>0x0)return await this['loadBadWords'](),_0x3c2b10(0x10f);else throw new common_1[(_0x3c2b10(0x113))](_0x3c2b10(0x116),common_1['HttpStatus'][_0x3c2b10(0x114)]);}async[_0x2197e0(0x126)](_0x2bb41f){const _0x57f643=_0x2197e0,{word:_0x15befa}=_0x2bb41f,_0x2143c4=await this[_0x57f643(0xf3)][_0x57f643(0x10d)]({'where':{'word':_0x15befa}});if(_0x2143c4)throw new common_1[(_0x57f643(0x113))](_0x57f643(0x12b),common_1[_0x57f643(0xf7)][_0x57f643(0x114)]);return await this[_0x57f643(0xf3)][_0x57f643(0x12c)]({'word':_0x15befa}),await this[_0x57f643(0x10b)](),_0x57f643(0x13b);}async[_0x2197e0(0x12d)](_0xfa035,_0x179f2b,_0x53aaf9,_0x39f6b2,_0x1b00b1){const _0x5ec90f=_0x2197e0,_0x184ba8={'userId':_0xfa035,'content':_0x179f2b,'words':JSON[_0x5ec90f(0x11a)](_0x53aaf9),'typeCn':JSON[_0x5ec90f(0x11a)](_0x39f6b2),'typeOriginCn':_0x1b00b1};try{await this[_0x5ec90f(0x119)][_0x5ec90f(0xe6)]()['update'](user_entity_1['UserEntity'])[_0x5ec90f(0xf0)]({'violationCount':()=>_0x5ec90f(0xf1)})[_0x5ec90f(0x128)](_0x5ec90f(0x123),{'userId':_0xfa035})[_0x5ec90f(0xee)](),await this[_0x5ec90f(0x11e)][_0x5ec90f(0x12c)](_0x184ba8);}catch(_0x2066fd){console[_0x5ec90f(0x143)](_0x5ec90f(0x137),_0x2066fd);}}async[_0x2197e0(0x12e)](_0x5b2cb4,_0x17a7d7){const _0xbd5a17=_0x2197e0,{role:_0x4db030}=_0x5b2cb4['user'],{page:page=0x1,size:size=0xa,userId:_0x57a1b1,typeOriginCn:_0x172105}=_0x17a7d7,_0x4cd154={};_0x57a1b1&&(_0x4cd154[_0xbd5a17(0x133)]=_0x57a1b1),_0x172105&&(_0x4cd154['typeOriginCn']=_0x172105);const [_0xfabc36,_0x1b2c77]=await this[_0xbd5a17(0x11e)][_0xbd5a17(0x10e)]({'where':_0x4cd154,'skip':(page-0x1)*size,'take':size,'order':{'id':'DESC'}}),_0x288c1c=[...new Set(_0xfabc36[_0xbd5a17(0x122)](_0x250141=>_0x250141[_0xbd5a17(0x133)]))],_0x394d2a=await this[_0xbd5a17(0x119)]['find']({'where':{'id':(0x0,typeorm_2['In'])(_0x288c1c)},'select':['id','avatar',_0xbd5a17(0xeb),_0xbd5a17(0x13d),'violationCount',_0xbd5a17(0x141)]});return _0xfabc36[_0xbd5a17(0x147)](_0xb301c6=>{const _0x4adb70=_0xbd5a17,_0x6ead9a=_0x394d2a['find'](_0x17b7d8=>_0x17b7d8['id']===_0xb301c6[_0x4adb70(0x133)])||{};_0x4db030!==_0x4adb70(0x111)&&(_0x6ead9a['email']=(0x0,utils_1[_0x4adb70(0xe7)])(_0x6ead9a[_0x4adb70(0x13d)])),_0xb301c6['userInfo']=_0x6ead9a;}),{'rows':_0xfabc36,'count':_0x1b2c77};}};BadWordsService=__decorate([(0x0,common_1[_0x2197e0(0xec)])(),__param(0x0,(0x0,typeorm_1['InjectRepository'])(badWords_entity_1[_0x2197e0(0x100)])),__param(0x1,(0x0,typeorm_1[_0x2197e0(0xe2)])(violationLog_entity_1[_0x2197e0(0x139)])),__param(0x2,(0x0,typeorm_1['InjectRepository'])(user_entity_1[_0x2197e0(0x110)])),__metadata(_0x2197e0(0xe9),[typeorm_2[_0x2197e0(0x108)],typeorm_2[_0x2197e0(0x108)],typeorm_2[_0x2197e0(0x108)],globalConfig_service_1[_0x2197e0(0x117)]])],BadWordsService),exports[_0x2197e0(0x10a)]=BadWordsService;