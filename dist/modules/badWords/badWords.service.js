'use strict';const _0x37d2ee=_0x37e7;(function(_0x5133b5,_0x32956e){const _0x339bac=_0x37e7,_0x4ede9c=_0x5133b5();while(!![]){try{const _0x4a2f24=parseInt(_0x339bac(0x1ef))/0x1+parseInt(_0x339bac(0x1e1))/0x2+parseInt(_0x339bac(0x1c3))/0x3*(parseInt(_0x339bac(0x1d7))/0x4)+parseInt(_0x339bac(0x1b8))/0x5+-parseInt(_0x339bac(0x1f0))/0x6+parseInt(_0x339bac(0x1eb))/0x7*(-parseInt(_0x339bac(0x1d8))/0x8)+parseInt(_0x339bac(0x1f3))/0x9*(-parseInt(_0x339bac(0x1e0))/0xa);if(_0x4a2f24===_0x32956e)break;else _0x4ede9c['push'](_0x4ede9c['shift']());}catch(_0x5f4ed0){_0x4ede9c['push'](_0x4ede9c['shift']());}}}(_0x3925,0x38e48));function _0x3925(){const _0x5358ae=['BAD_REQUEST','敏感词不存在,请检查您的提交信息','join','userId','category','更新敏感词成功','__param','Like','word','queryBadWords','status','敏感词已经存在了、请勿重复添加','badWordsEntity','violation','自定义检测','***','自定义','您提交的内容中包含','baiduTextAccessToken','__decorate','stringify','__metadata','globalConfigService','find','./violationLog.entity','username','customSensitiveWords','id\x20=\x20:userId','../globalConfig/globalConfig.service','push','map','findAndCount','where','onModuleInit','InjectRepository','violationCount\x20+\x201','1931630vtItAQ','email','includes','GlobalConfigService','https://aip.baidubce.com/rest/2.0/solution/v1/text_censor/v2/user_defined?access_token=','HttpException','Repository','decorate','post','violationCount','loadBadWords','625242kuQDyS','violationLogEntity','您提交的信息中包含','axios','checkBadWords','__esModule','getOwnPropertyDescriptor','set','findOne','badWords','recordUserBadWords','ASC','更新敏感词失败','function','forEach','formarTips','百度文本检测出现错误、请查看配置信息:\x20','userInfo','checkBadWordsByConfig','./badWords.entity','8ofUNeO','56KJWtlX','defineProperty','BadWordsService','log','delete','default','metadata','敏感词已存在,请检查您的提交信息','16990iLOuqW','78356aAnkgO','的内容、我们已对您的账户进行标记、请合规使用！','HttpStatus','getSensitiveConfig','DESC','UserEntity','typeorm','update','userEntity','baiduCheckBadWords','436093Ffdoqf','execute','length','typeOriginCn','436281NeGJkk','1016682uOmyGy','application/x-www-form-urlencoded','createQueryBuilder','2331PUyGJT','删除敏感词成功','error:\x20'];_0x3925=function(){return _0x5358ae;};return _0x3925();}function _0x37e7(_0x20db31,_0x2517f0){const _0x392570=_0x3925();return _0x37e7=function(_0x37e759,_0xa4ed4c){_0x37e759=_0x37e759-0x1ae;let _0x5a8548=_0x392570[_0x37e759];return _0x5a8548;},_0x37e7(_0x20db31,_0x2517f0);}var __decorate=this&&this[_0x37d2ee(0x209)]||function(_0x5a5d7f,_0x1f782c,_0x5176ac,_0x5cafe3){const _0x5716dc=_0x37d2ee;var _0x2d0cf0=arguments['length'],_0x534dc3=_0x2d0cf0<0x3?_0x1f782c:_0x5cafe3===null?_0x5cafe3=Object[_0x5716dc(0x1c9)](_0x1f782c,_0x5176ac):_0x5cafe3,_0x3b9cd6;if(typeof Reflect==='object'&&typeof Reflect[_0x5716dc(0x1bf)]==='function')_0x534dc3=Reflect[_0x5716dc(0x1bf)](_0x5a5d7f,_0x1f782c,_0x5176ac,_0x5cafe3);else{for(var _0x2f979d=_0x5a5d7f['length']-0x1;_0x2f979d>=0x0;_0x2f979d--)if(_0x3b9cd6=_0x5a5d7f[_0x2f979d])_0x534dc3=(_0x2d0cf0<0x3?_0x3b9cd6(_0x534dc3):_0x2d0cf0>0x3?_0x3b9cd6(_0x1f782c,_0x5176ac,_0x534dc3):_0x3b9cd6(_0x1f782c,_0x5176ac))||_0x534dc3;}return _0x2d0cf0>0x3&&_0x534dc3&&Object[_0x5716dc(0x1d9)](_0x1f782c,_0x5176ac,_0x534dc3),_0x534dc3;},__metadata=this&&this[_0x37d2ee(0x20b)]||function(_0x48794b,_0x3936d9){const _0x5c707f=_0x37d2ee;if(typeof Reflect==='object'&&typeof Reflect['metadata']===_0x5c707f(0x1d0))return Reflect[_0x5c707f(0x1de)](_0x48794b,_0x3936d9);},__param=this&&this[_0x37d2ee(0x1fc)]||function(_0x1d6162,_0x16521c){return function(_0x22c91c,_0x3e8a5d){_0x16521c(_0x22c91c,_0x3e8a5d,_0x1d6162);};};Object[_0x37d2ee(0x1d9)](exports,_0x37d2ee(0x1c8),{'value':!![]}),exports['BadWordsService']=void 0x0;const utils_1=require('../../common/utils'),common_1=require('@nestjs/common'),typeorm_1=require('@nestjs/typeorm'),axios_1=require(_0x37d2ee(0x1c6)),typeorm_2=require(_0x37d2ee(0x1e7)),globalConfig_service_1=require(_0x37d2ee(0x1b0)),user_entity_1=require('../user/user.entity'),badWords_entity_1=require(_0x37d2ee(0x1d6)),violationLog_entity_1=require(_0x37d2ee(0x20e));let BadWordsService=class BadWordsService{constructor(_0x3dc12e,_0x177249,_0x294021,_0x2efc59){const _0x5a3c33=_0x37d2ee;this[_0x5a3c33(0x202)]=_0x3dc12e,this[_0x5a3c33(0x1c4)]=_0x177249,this['userEntity']=_0x294021,this['globalConfigService']=_0x2efc59,this[_0x5a3c33(0x1cc)]=[];}async[_0x37d2ee(0x1b5)](){const _0x3889d3=_0x37d2ee;this[_0x3889d3(0x1c2)]();}async[_0x37d2ee(0x1ae)](_0x219957,_0x262ca2){const _0x6330c4=_0x37d2ee,_0x309553=[];for(let _0xf461cb=0x0;_0xf461cb<this[_0x6330c4(0x1cc)][_0x6330c4(0x1ed)];_0xf461cb++){const _0x545143=this[_0x6330c4(0x1cc)][_0xf461cb];_0x219957[_0x6330c4(0x1ba)](_0x545143)&&_0x309553[_0x6330c4(0x1b1)](_0x545143);}return _0x309553[_0x6330c4(0x1ed)]&&await this[_0x6330c4(0x1cd)](_0x262ca2,_0x219957,_0x309553,[_0x6330c4(0x206)],_0x6330c4(0x204)),_0x309553;}async[_0x37d2ee(0x1c7)](_0x5027bd,_0x24c62c){const _0x42e364=_0x37d2ee,_0xbcdd11=await this[_0x42e364(0x20c)][_0x42e364(0x1e4)]();return _0xbcdd11&&await this[_0x42e364(0x1d5)](_0x5027bd,_0xbcdd11,_0x24c62c),await this[_0x42e364(0x1ae)](_0x5027bd,_0x24c62c);}async[_0x37d2ee(0x1d5)](_0x1724e1,_0x3fd360,_0x4b4f23){const _0x4e7e22=_0x37d2ee,{useType:_0x1df2ae}=_0x3fd360;_0x1df2ae==='baidu'&&await this[_0x4e7e22(0x1ea)](_0x1724e1,_0x3fd360[_0x4e7e22(0x208)],_0x4b4f23);}['extractContent'](_0x448baa){const _0x356800=/存在(.*?)不合规/,_0x5302f8=_0x448baa['match'](_0x356800);return _0x5302f8?_0x5302f8[0x1]:'';}async['baiduCheckBadWords'](_0x3d8205,_0x3a5f8d,_0x1f980b){const _0x4f68d3=_0x37d2ee;if(!_0x3a5f8d)return;const _0xdd9549=_0x4f68d3(0x1bc)+_0x3a5f8d+'}',_0x233078={'Content-Type':_0x4f68d3(0x1f1),'Accept':'application/json'},_0x144c3c=await axios_1[_0x4f68d3(0x1dd)][_0x4f68d3(0x1c0)](_0xdd9549,{'text':_0x3d8205},{'headers':_0x233078}),{conclusion:_0x2f3724,error_code:_0xcde468,error_msg:_0x1e1a53,conclusionType:_0x228018,data:_0x3074a2}=_0x144c3c['data'];_0xcde468&&console[_0x4f68d3(0x1db)](_0x4f68d3(0x1d3),_0x1e1a53);if(_0x228018!==0x1){const _0x22b055=[...new Set(_0x3074a2[_0x4f68d3(0x1b2)](_0x2f66f4=>this['extractContent'](_0x2f66f4['msg'])))];await this[_0x4f68d3(0x1cd)](_0x1f980b,_0x3d8205,[_0x4f68d3(0x205)],_0x22b055,'百度云检测');const _0x12bb7d=_0x4f68d3(0x1c5)+_0x22b055[_0x4f68d3(0x1f8)](',')+_0x4f68d3(0x1e2);throw new common_1[(_0x4f68d3(0x1bd))](_0x12bb7d,common_1[_0x4f68d3(0x1e3)]['BAD_REQUEST']);}}[_0x37d2ee(0x1d2)](_0x4780be){const _0x154edd=_0x37d2ee,_0x36d14a=_0x4780be[_0x154edd(0x1b2)](_0x215863=>_0x215863[_0x154edd(0x1fa)]),_0x21b31e=[...new Set(_0x36d14a)];return _0x154edd(0x207)+_0x21b31e[_0x154edd(0x1f8)](',')+'的信息、我们已对您账号进行标记、请合规使用！';}async[_0x37d2ee(0x1c2)](){const _0x5759fe=_0x37d2ee,_0x33cd24=await this['badWordsEntity'][_0x5759fe(0x20d)]({'where':{'status':0x1},'select':[_0x5759fe(0x1fe)]});this[_0x5759fe(0x1cc)]=_0x33cd24[_0x5759fe(0x1b2)](_0x29a388=>_0x29a388['word']);}async[_0x37d2ee(0x1ff)](_0x17ec72){const _0x53fddc=_0x37d2ee,{page:page=0x1,size:size=0x1f4,word:_0x2791ed,status:_0x329455}=_0x17ec72,_0x585afd={};[0x0,0x1,'0','1']['includes'](_0x329455)&&(_0x585afd[_0x53fddc(0x200)]=_0x329455),_0x2791ed&&(_0x585afd['word']=(0x0,typeorm_2[_0x53fddc(0x1fd)])('%'+_0x2791ed+'%'));const [_0x241a06,_0x57300d]=await this[_0x53fddc(0x202)][_0x53fddc(0x1b3)]({'where':_0x585afd,'skip':(page-0x1)*size,'take':size,'order':{'id':_0x53fddc(0x1ce)}});return{'rows':_0x241a06,'count':_0x57300d};}async['delBadWords'](_0x37e9b1){const _0x2c8af1=_0x37d2ee,_0x1ae15a=await this[_0x2c8af1(0x202)][_0x2c8af1(0x1cb)]({'where':{'id':_0x37e9b1['id']}});if(!_0x1ae15a)throw new common_1['HttpException'](_0x2c8af1(0x1f7),common_1[_0x2c8af1(0x1e3)][_0x2c8af1(0x1f6)]);const _0x2b2eca=await this[_0x2c8af1(0x202)][_0x2c8af1(0x1dc)]({'id':_0x37e9b1['id']});if(_0x2b2eca['affected']>0x0)return await this[_0x2c8af1(0x1c2)](),_0x2c8af1(0x1f4);else throw new common_1['HttpException']('删除敏感词失败',common_1[_0x2c8af1(0x1e3)]['BAD_REQUEST']);}async['updateBadWords'](_0x47c191){const _0x42c746=_0x37d2ee,{id:_0x26b3ae,word:_0x78fed4,status:_0x4a2799}=_0x47c191,_0x2d0555=await this[_0x42c746(0x202)][_0x42c746(0x1cb)]({'where':{'word':_0x78fed4}});if(_0x2d0555)throw new common_1[(_0x42c746(0x1bd))](_0x42c746(0x201),common_1['HttpStatus'][_0x42c746(0x1f6)]);const _0x79ac3e=await this['badWordsEntity']['update']({'id':_0x26b3ae},{'word':_0x78fed4,'status':_0x4a2799});if(_0x79ac3e['affected']>0x0)return await this[_0x42c746(0x1c2)](),_0x42c746(0x1fb);else throw new common_1[(_0x42c746(0x1bd))](_0x42c746(0x1cf),common_1[_0x42c746(0x1e3)][_0x42c746(0x1f6)]);}async['addBadWord'](_0x5a194d){const _0x2567d1=_0x37d2ee,{word:_0x48eb47}=_0x5a194d,_0x4ff09f=await this[_0x2567d1(0x202)]['findOne']({'where':{'word':_0x48eb47}});if(_0x4ff09f)throw new common_1['HttpException'](_0x2567d1(0x1df),common_1[_0x2567d1(0x1e3)][_0x2567d1(0x1f6)]);return await this[_0x2567d1(0x202)]['save']({'word':_0x48eb47}),await this[_0x2567d1(0x1c2)](),'添加敏感词成功';}async['recordUserBadWords'](_0x1fb37e,_0x35a28d,_0x245c72,_0xc25304,_0x267ab7){const _0x49a1af=_0x37d2ee,_0x5f414e={'userId':_0x1fb37e,'content':_0x35a28d,'words':JSON[_0x49a1af(0x20a)](_0x245c72),'typeCn':JSON[_0x49a1af(0x20a)](_0xc25304),'typeOriginCn':_0x267ab7};try{await this[_0x49a1af(0x1e9)][_0x49a1af(0x1f2)]()[_0x49a1af(0x1e8)](user_entity_1[_0x49a1af(0x1e6)])[_0x49a1af(0x1ca)]({'violationCount':()=>_0x49a1af(0x1b7)})[_0x49a1af(0x1b4)](_0x49a1af(0x1af),{'userId':_0x1fb37e})[_0x49a1af(0x1ec)](),await this['violationLogEntity']['save'](_0x5f414e);}catch(_0x56694f){console[_0x49a1af(0x1db)](_0x49a1af(0x1f5),_0x56694f);}}async[_0x37d2ee(0x203)](_0x135a75,_0x1f6be3){const _0x525b06=_0x37d2ee,{role:_0x5e0642}=_0x135a75['user'],{page:page=0x1,size:size=0xa,userId:_0x5652a5,typeOriginCn:_0x126b5f}=_0x1f6be3,_0x18ff0b={};_0x5652a5&&(_0x18ff0b[_0x525b06(0x1f9)]=_0x5652a5),_0x126b5f&&(_0x18ff0b[_0x525b06(0x1ee)]=_0x126b5f);const [_0x1eb4fe,_0x4d76e7]=await this[_0x525b06(0x1c4)][_0x525b06(0x1b3)]({'where':_0x18ff0b,'skip':(page-0x1)*size,'take':size,'order':{'id':_0x525b06(0x1e5)}}),_0x5c0fdc=[...new Set(_0x1eb4fe['map'](_0x23023d=>_0x23023d[_0x525b06(0x1f9)]))],_0x3f7321=await this[_0x525b06(0x1e9)]['find']({'where':{'id':(0x0,typeorm_2['In'])(_0x5c0fdc)},'select':['id','avatar',_0x525b06(0x20f),_0x525b06(0x1b9),_0x525b06(0x1c1),'status']});return _0x1eb4fe[_0x525b06(0x1d1)](_0x2603c8=>{const _0x54f8e0=_0x525b06,_0x4b474a=_0x3f7321[_0x54f8e0(0x20d)](_0x89b847=>_0x89b847['id']===_0x2603c8[_0x54f8e0(0x1f9)])||{};_0x5e0642!=='super'&&(_0x4b474a['email']=(0x0,utils_1['hideString'])(_0x4b474a[_0x54f8e0(0x1b9)])),_0x2603c8[_0x54f8e0(0x1d4)]=_0x4b474a;}),{'rows':_0x1eb4fe,'count':_0x4d76e7};}};BadWordsService=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,typeorm_1[_0x37d2ee(0x1b6)])(badWords_entity_1['BadWordsEntity'])),__param(0x1,(0x0,typeorm_1['InjectRepository'])(violationLog_entity_1['ViolationLogEntity'])),__param(0x2,(0x0,typeorm_1[_0x37d2ee(0x1b6)])(user_entity_1['UserEntity'])),__metadata('design:paramtypes',[typeorm_2['Repository'],typeorm_2[_0x37d2ee(0x1be)],typeorm_2[_0x37d2ee(0x1be)],globalConfig_service_1[_0x37d2ee(0x1bb)]])],BadWordsService),exports[_0x37d2ee(0x1da)]=BadWordsService;