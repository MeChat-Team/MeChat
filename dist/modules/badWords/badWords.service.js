'use strict';const _0x1b44a1=_0x472d;(function(_0x53d003,_0x31a085){const _0x375616=_0x472d,_0x526445=_0x53d003();while(!![]){try{const _0x520bc1=-parseInt(_0x375616(0xd8))/0x1+-parseInt(_0x375616(0xc5))/0x2*(-parseInt(_0x375616(0xc8))/0x3)+-parseInt(_0x375616(0xab))/0x4+parseInt(_0x375616(0x7e))/0x5+-parseInt(_0x375616(0x84))/0x6*(-parseInt(_0x375616(0xc1))/0x7)+parseInt(_0x375616(0x9d))/0x8*(parseInt(_0x375616(0xb0))/0x9)+parseInt(_0x375616(0xad))/0xa*(-parseInt(_0x375616(0xbe))/0xb);if(_0x520bc1===_0x31a085)break;else _0x526445['push'](_0x526445['shift']());}catch(_0x2a4a5f){_0x526445['push'](_0x526445['shift']());}}}(_0x2b75,0x8380e));var __decorate=this&&this[_0x1b44a1(0x97)]||function(_0xa6dcd4,_0x18c1df,_0x58b817,_0x2461ce){const _0x4b95d3=_0x1b44a1;var _0x19347a=arguments[_0x4b95d3(0x70)],_0x7f12d8=_0x19347a<0x3?_0x18c1df:_0x2461ce===null?_0x2461ce=Object[_0x4b95d3(0xd0)](_0x18c1df,_0x58b817):_0x2461ce,_0x3f0b8d;if(typeof Reflect==='object'&&typeof Reflect[_0x4b95d3(0x99)]===_0x4b95d3(0x79))_0x7f12d8=Reflect['decorate'](_0xa6dcd4,_0x18c1df,_0x58b817,_0x2461ce);else{for(var _0x255886=_0xa6dcd4['length']-0x1;_0x255886>=0x0;_0x255886--)if(_0x3f0b8d=_0xa6dcd4[_0x255886])_0x7f12d8=(_0x19347a<0x3?_0x3f0b8d(_0x7f12d8):_0x19347a>0x3?_0x3f0b8d(_0x18c1df,_0x58b817,_0x7f12d8):_0x3f0b8d(_0x18c1df,_0x58b817))||_0x7f12d8;}return _0x19347a>0x3&&_0x7f12d8&&Object['defineProperty'](_0x18c1df,_0x58b817,_0x7f12d8),_0x7f12d8;},__metadata=this&&this[_0x1b44a1(0x9b)]||function(_0x92d978,_0x51a368){const _0x44f379=_0x1b44a1;if(typeof Reflect===_0x44f379(0x90)&&typeof Reflect[_0x44f379(0xb6)]===_0x44f379(0x79))return Reflect[_0x44f379(0xb6)](_0x92d978,_0x51a368);},__param=this&&this[_0x1b44a1(0x9e)]||function(_0x26026e,_0x2d78be){return function(_0x1c0ed2,_0x5af81d){_0x2d78be(_0x1c0ed2,_0x5af81d,_0x26026e);};};Object['defineProperty'](exports,_0x1b44a1(0x92),{'value':!![]}),exports[_0x1b44a1(0x82)]=void 0x0;function _0x2b75(){const _0x176bc5=['error:\x20','word','object','typeOriginCn','__esModule','extractContent','UserEntity','where','category','__decorate','onModuleInit','decorate','join','__metadata','user','6195160uUhzPn','__param','userInfo','更新敏感词失败','application/json','../globalConfig/globalConfig.service','Repository','HttpStatus','affected','delete','customSensitiveWords','添加敏感词成功','自定义检测','敏感词已经存在了、请勿重复添加','226560cLCtdb','删除敏感词成功','20180dWhPsT','set','addBadWord','9GpDpFi','您提交的信息中包含','match','map','log','./violationLog.entity','metadata','status','hideString','userId','getSensitiveConfig','@nestjs/common','formarTips','敏感词已存在,请检查您的提交信息','11143phkYqH','checkBadWordsByConfig','userEntity','203yBMAwx','DESC','BAD_REQUEST','baiduTextAccessToken','6OfeOJu','findAndCount','violation','900639pedMwc','的内容、我们已对您的账户进行标记、请合规使用！','violationCount','敏感词不存在,请检查您的提交信息','自定义','update','design:paramtypes','violationCount\x20+\x201','getOwnPropertyDescriptor','violationLogEntity','更新敏感词成功','recordUserBadWords','stringify','../user/user.entity','BadWordsEntity','checkBadWords','379589oGRdeD','includes','InjectRepository','length','https://aip.baidubce.com/rest/2.0/solution/v1/text_censor/v2/user_defined?access_token=','queryBadWords','Like','badWords','HttpException','email','post','badWordsEntity','function','super','default','@nestjs/typeorm','ASC','5143895VgAvGn','Injectable','find','findOne','BadWordsService','的信息、我们已对您账号进行标记、请合规使用！','65232UiMqFr','updateBadWords','百度云检测','id\x20=\x20:userId','loadBadWords','globalConfigService','avatar','push','save','baidu'];_0x2b75=function(){return _0x176bc5;};return _0x2b75();}const utils_1=require('../../common/utils'),common_1=require(_0x1b44a1(0xbb)),typeorm_1=require(_0x1b44a1(0x7c)),axios_1=require('axios'),typeorm_2=require('typeorm'),globalConfig_service_1=require(_0x1b44a1(0xa2)),user_entity_1=require(_0x1b44a1(0xd5)),badWords_entity_1=require('./badWords.entity'),violationLog_entity_1=require(_0x1b44a1(0xb5));function _0x472d(_0x31c70f,_0x8b3154){const _0x2b75c5=_0x2b75();return _0x472d=function(_0x472d17,_0x21f18a){_0x472d17=_0x472d17-0x70;let _0x1eab4d=_0x2b75c5[_0x472d17];return _0x1eab4d;},_0x472d(_0x31c70f,_0x8b3154);}let BadWordsService=class BadWordsService{constructor(_0x433f64,_0x4f0457,_0x1e9b37,_0x3c0fe3){const _0xc7e806=_0x1b44a1;this[_0xc7e806(0x78)]=_0x433f64,this[_0xc7e806(0xd1)]=_0x4f0457,this[_0xc7e806(0xc0)]=_0x1e9b37,this[_0xc7e806(0x89)]=_0x3c0fe3,this[_0xc7e806(0x74)]=[];}async[_0x1b44a1(0x98)](){const _0x310896=_0x1b44a1;this[_0x310896(0x88)]();}async[_0x1b44a1(0xa7)](_0x12964b,_0x106096){const _0x6b5154=_0x1b44a1,_0x44dd31=[];for(let _0x2804d1=0x0;_0x2804d1<this[_0x6b5154(0x74)]['length'];_0x2804d1++){const _0x1c3510=this[_0x6b5154(0x74)][_0x2804d1];_0x12964b[_0x6b5154(0xd9)](_0x1c3510)&&_0x44dd31[_0x6b5154(0x8b)](_0x1c3510);}return _0x44dd31[_0x6b5154(0x70)]&&await this['recordUserBadWords'](_0x106096,_0x12964b,_0x44dd31,[_0x6b5154(0xcc)],_0x6b5154(0xa9)),_0x44dd31;}async[_0x1b44a1(0xd7)](_0x39ce33,_0x4fd420){const _0x559082=_0x1b44a1,_0x4b2cfb=await this[_0x559082(0x89)][_0x559082(0xba)]();return _0x4b2cfb&&await this[_0x559082(0xbf)](_0x39ce33,_0x4b2cfb,_0x4fd420),await this[_0x559082(0xa7)](_0x39ce33,_0x4fd420);}async['checkBadWordsByConfig'](_0x588831,_0x1f1c54,_0x29bfc4){const _0x4008ed=_0x1b44a1,{useType:_0x468c43}=_0x1f1c54;_0x468c43===_0x4008ed(0x8d)&&await this['baiduCheckBadWords'](_0x588831,_0x1f1c54[_0x4008ed(0xc4)],_0x29bfc4);}[_0x1b44a1(0x93)](_0x396749){const _0x4c0521=_0x1b44a1,_0x2e597a=/存在(.*?)不合规/,_0x5c7e72=_0x396749[_0x4c0521(0xb2)](_0x2e597a);return _0x5c7e72?_0x5c7e72[0x1]:'';}async['baiduCheckBadWords'](_0xca51d9,_0x1b53a6,_0x3035f6){const _0x5c60cf=_0x1b44a1;if(!_0x1b53a6)return;const _0x44d688=_0x5c60cf(0x71)+_0x1b53a6+'}',_0x1cfae6={'Content-Type':'application/x-www-form-urlencoded','Accept':_0x5c60cf(0xa1)},_0x236e6e=await axios_1[_0x5c60cf(0x7b)][_0x5c60cf(0x77)](_0x44d688,{'text':_0xca51d9},{'headers':_0x1cfae6}),{conclusion:_0x1bfe9c,error_code:_0x3a4a83,error_msg:_0x480ce2,conclusionType:_0x1ee98b,data:_0x497a32}=_0x236e6e['data'];_0x3a4a83&&console[_0x5c60cf(0xb4)]('百度文本检测出现错误、请查看配置信息:\x20',_0x480ce2);if(_0x1ee98b!==0x1){const _0x439b2a=[...new Set(_0x497a32[_0x5c60cf(0xb3)](_0x29277c=>this[_0x5c60cf(0x93)](_0x29277c['msg'])))];await this[_0x5c60cf(0xd3)](_0x3035f6,_0xca51d9,['***'],_0x439b2a,_0x5c60cf(0x86));const _0x53fc33=_0x5c60cf(0xb1)+_0x439b2a['join'](',')+_0x5c60cf(0xc9);throw new common_1[(_0x5c60cf(0x75))](_0x53fc33,common_1[_0x5c60cf(0xa4)][_0x5c60cf(0xc3)]);}}[_0x1b44a1(0xbc)](_0x3a17d0){const _0x6fe09=_0x1b44a1,_0x5cf63b=_0x3a17d0[_0x6fe09(0xb3)](_0x3bec62=>_0x3bec62[_0x6fe09(0x96)]),_0x105743=[...new Set(_0x5cf63b)];return'您提交的内容中包含'+_0x105743[_0x6fe09(0x9a)](',')+_0x6fe09(0x83);}async[_0x1b44a1(0x88)](){const _0x12e4fe=_0x1b44a1,_0x5c0420=await this[_0x12e4fe(0x78)][_0x12e4fe(0x80)]({'where':{'status':0x1},'select':[_0x12e4fe(0x8f)]});this[_0x12e4fe(0x74)]=_0x5c0420[_0x12e4fe(0xb3)](_0x5e6823=>_0x5e6823[_0x12e4fe(0x8f)]);}async[_0x1b44a1(0x72)](_0xa78d74){const _0x4f58c2=_0x1b44a1,{page:page=0x1,size:size=0x1f4,word:_0x58963e,status:_0x47801b}=_0xa78d74,_0x585695={};[0x0,0x1,'0','1'][_0x4f58c2(0xd9)](_0x47801b)&&(_0x585695['status']=_0x47801b),_0x58963e&&(_0x585695['word']=(0x0,typeorm_2[_0x4f58c2(0x73)])('%'+_0x58963e+'%'));const [_0x51355f,_0x2da022]=await this[_0x4f58c2(0x78)][_0x4f58c2(0xc6)]({'where':_0x585695,'skip':(page-0x1)*size,'take':size,'order':{'id':_0x4f58c2(0x7d)}});return{'rows':_0x51355f,'count':_0x2da022};}async['delBadWords'](_0x36f7f2){const _0x4ebb41=_0x1b44a1,_0x242a33=await this[_0x4ebb41(0x78)][_0x4ebb41(0x81)]({'where':{'id':_0x36f7f2['id']}});if(!_0x242a33)throw new common_1[(_0x4ebb41(0x75))](_0x4ebb41(0xcb),common_1['HttpStatus'][_0x4ebb41(0xc3)]);const _0x5a68d6=await this[_0x4ebb41(0x78)][_0x4ebb41(0xa6)]({'id':_0x36f7f2['id']});if(_0x5a68d6['affected']>0x0)return await this[_0x4ebb41(0x88)](),_0x4ebb41(0xac);else throw new common_1[(_0x4ebb41(0x75))]('删除敏感词失败',common_1[_0x4ebb41(0xa4)]['BAD_REQUEST']);}async[_0x1b44a1(0x85)](_0x22a156){const _0x447ee3=_0x1b44a1,{id:_0x210be8,word:_0x14a778,status:_0x2d9458}=_0x22a156,_0x18d0a7=await this[_0x447ee3(0x78)][_0x447ee3(0x81)]({'where':{'word':_0x14a778}});if(_0x18d0a7)throw new common_1[(_0x447ee3(0x75))](_0x447ee3(0xaa),common_1['HttpStatus'][_0x447ee3(0xc3)]);const _0x5ca473=await this[_0x447ee3(0x78)][_0x447ee3(0xcd)]({'id':_0x210be8},{'word':_0x14a778,'status':_0x2d9458});if(_0x5ca473[_0x447ee3(0xa5)]>0x0)return await this[_0x447ee3(0x88)](),_0x447ee3(0xd2);else throw new common_1[(_0x447ee3(0x75))](_0x447ee3(0xa0),common_1[_0x447ee3(0xa4)][_0x447ee3(0xc3)]);}async[_0x1b44a1(0xaf)](_0x580829){const _0x8e26dc=_0x1b44a1,{word:_0x514e54}=_0x580829,_0x235bc7=await this[_0x8e26dc(0x78)][_0x8e26dc(0x81)]({'where':{'word':_0x514e54}});if(_0x235bc7)throw new common_1['HttpException'](_0x8e26dc(0xbd),common_1[_0x8e26dc(0xa4)][_0x8e26dc(0xc3)]);return await this[_0x8e26dc(0x78)][_0x8e26dc(0x8c)]({'word':_0x514e54}),await this[_0x8e26dc(0x88)](),_0x8e26dc(0xa8);}async[_0x1b44a1(0xd3)](_0x3480bc,_0x1f6895,_0x2002f2,_0x115c2c,_0x14e381){const _0x10ae8b=_0x1b44a1,_0x54caf6={'userId':_0x3480bc,'content':_0x1f6895,'words':JSON[_0x10ae8b(0xd4)](_0x2002f2),'typeCn':JSON[_0x10ae8b(0xd4)](_0x115c2c),'typeOriginCn':_0x14e381};try{await this[_0x10ae8b(0xc0)]['createQueryBuilder']()[_0x10ae8b(0xcd)](user_entity_1['UserEntity'])[_0x10ae8b(0xae)]({'violationCount':()=>_0x10ae8b(0xcf)})[_0x10ae8b(0x95)](_0x10ae8b(0x87),{'userId':_0x3480bc})['execute'](),await this['violationLogEntity'][_0x10ae8b(0x8c)](_0x54caf6);}catch(_0x5d7df3){console[_0x10ae8b(0xb4)](_0x10ae8b(0x8e),_0x5d7df3);}}async[_0x1b44a1(0xc7)](_0x4c72cd,_0x59d0cd){const _0x56849d=_0x1b44a1,{role:_0x59bf96}=_0x4c72cd[_0x56849d(0x9c)],{page:page=0x1,size:size=0xa,userId:_0x4f1e31,typeOriginCn:_0x4a19c1}=_0x59d0cd,_0x5cad2e={};_0x4f1e31&&(_0x5cad2e[_0x56849d(0xb9)]=_0x4f1e31),_0x4a19c1&&(_0x5cad2e[_0x56849d(0x91)]=_0x4a19c1);const [_0x1d1203,_0x2b5861]=await this[_0x56849d(0xd1)]['findAndCount']({'where':_0x5cad2e,'skip':(page-0x1)*size,'take':size,'order':{'id':_0x56849d(0xc2)}}),_0x34db1c=[...new Set(_0x1d1203[_0x56849d(0xb3)](_0x52f344=>_0x52f344[_0x56849d(0xb9)]))],_0x4b69f6=await this['userEntity'][_0x56849d(0x80)]({'where':{'id':(0x0,typeorm_2['In'])(_0x34db1c)},'select':['id',_0x56849d(0x8a),'username',_0x56849d(0x76),_0x56849d(0xca),_0x56849d(0xb7)]});return _0x1d1203['forEach'](_0x140120=>{const _0x2a9b70=_0x56849d,_0x17a497=_0x4b69f6[_0x2a9b70(0x80)](_0xa682ae=>_0xa682ae['id']===_0x140120[_0x2a9b70(0xb9)])||{};_0x59bf96!==_0x2a9b70(0x7a)&&(_0x17a497[_0x2a9b70(0x76)]=(0x0,utils_1[_0x2a9b70(0xb8)])(_0x17a497['email'])),_0x140120[_0x2a9b70(0x9f)]=_0x17a497;}),{'rows':_0x1d1203,'count':_0x2b5861};}};BadWordsService=__decorate([(0x0,common_1[_0x1b44a1(0x7f)])(),__param(0x0,(0x0,typeorm_1[_0x1b44a1(0xda)])(badWords_entity_1[_0x1b44a1(0xd6)])),__param(0x1,(0x0,typeorm_1[_0x1b44a1(0xda)])(violationLog_entity_1['ViolationLogEntity'])),__param(0x2,(0x0,typeorm_1['InjectRepository'])(user_entity_1[_0x1b44a1(0x94)])),__metadata(_0x1b44a1(0xce),[typeorm_2[_0x1b44a1(0xa3)],typeorm_2[_0x1b44a1(0xa3)],typeorm_2['Repository'],globalConfig_service_1['GlobalConfigService']])],BadWordsService),exports[_0x1b44a1(0x82)]=BadWordsService;