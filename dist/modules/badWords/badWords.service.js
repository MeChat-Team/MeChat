'use strict';const _0x51cbe9=_0x59b3;(function(_0x2f40e5,_0x41ca32){const _0x404f88=_0x59b3,_0x4d34e5=_0x2f40e5();while(!![]){try{const _0x5a4de2=-parseInt(_0x404f88(0x173))/0x1*(-parseInt(_0x404f88(0x15b))/0x2)+-parseInt(_0x404f88(0x164))/0x3*(-parseInt(_0x404f88(0x152))/0x4)+parseInt(_0x404f88(0x177))/0x5+-parseInt(_0x404f88(0x163))/0x6+-parseInt(_0x404f88(0x178))/0x7*(-parseInt(_0x404f88(0x1a9))/0x8)+-parseInt(_0x404f88(0x157))/0x9+-parseInt(_0x404f88(0x159))/0xa*(parseInt(_0x404f88(0x186))/0xb);if(_0x5a4de2===_0x41ca32)break;else _0x4d34e5['push'](_0x4d34e5['shift']());}catch(_0x2fe1c9){_0x4d34e5['push'](_0x4d34e5['shift']());}}}(_0x200b,0xe03f0));var __decorate=this&&this['__decorate']||function(_0x2fc362,_0x366559,_0x450599,_0x1a48ea){const _0x50ceb8=_0x59b3;var _0x503579=arguments[_0x50ceb8(0x185)],_0x4d1af1=_0x503579<0x3?_0x366559:_0x1a48ea===null?_0x1a48ea=Object[_0x50ceb8(0x156)](_0x366559,_0x450599):_0x1a48ea,_0xa96c3c;if(typeof Reflect===_0x50ceb8(0x19c)&&typeof Reflect['decorate']==='function')_0x4d1af1=Reflect['decorate'](_0x2fc362,_0x366559,_0x450599,_0x1a48ea);else{for(var _0x18f7e8=_0x2fc362[_0x50ceb8(0x185)]-0x1;_0x18f7e8>=0x0;_0x18f7e8--)if(_0xa96c3c=_0x2fc362[_0x18f7e8])_0x4d1af1=(_0x503579<0x3?_0xa96c3c(_0x4d1af1):_0x503579>0x3?_0xa96c3c(_0x366559,_0x450599,_0x4d1af1):_0xa96c3c(_0x366559,_0x450599))||_0x4d1af1;}return _0x503579>0x3&&_0x4d1af1&&Object[_0x50ceb8(0x1a7)](_0x366559,_0x450599,_0x4d1af1),_0x4d1af1;},__metadata=this&&this[_0x51cbe9(0x14a)]||function(_0x588d26,_0x2c4c58){const _0x43d09b=_0x51cbe9;if(typeof Reflect===_0x43d09b(0x19c)&&typeof Reflect[_0x43d09b(0x14e)]===_0x43d09b(0x18b))return Reflect[_0x43d09b(0x14e)](_0x588d26,_0x2c4c58);},__param=this&&this['__param']||function(_0x5ebe9c,_0x5b7f29){return function(_0x3a4437,_0xe58882){_0x5b7f29(_0x3a4437,_0xe58882,_0x5ebe9c);};};Object['defineProperty'](exports,_0x51cbe9(0x198),{'value':!![]}),exports[_0x51cbe9(0x179)]=void 0x0;function _0x200b(){const _0x575440=['defineProperty','ASC','382216zuQXrP','更新敏感词成功','您提交的信息中包含','stringify','map','violationCount\x20+\x201','globalConfigService','error:\x20','formarTips','__metadata','typeorm','../user/user.entity','删除敏感词成功','metadata','Like','customSensitiveWords','recordUserBadWords','6011276fpxzmt','BadWordsEntity','email','push','getOwnPropertyDescriptor','14020767PmrTox','violationCount','10QZanbV','checkBadWordsByConfig','14NPGJCy','DESC','./violationLog.entity','set','userId','@nestjs/typeorm','checkBadWords','execute','4907730QkcQju','3IgSlNg','的内容、我们已对您的账户进行标记、请合规使用！','findAndCount','更新敏感词失败','BAD_REQUEST','@nestjs/common','InjectRepository','userInfo','match','getSensitiveConfig','HttpStatus','includes','***','design:paramtypes','自定义检测','85975zMPQpE','badWords','application/json','敏感词已经存在了、请勿重复添加','5386540hxCIts','21VsqeQm','BadWordsService','敏感词不存在,请检查您的提交信息','baiduCheckBadWords','addBadWord','loadBadWords','forEach','Repository','category','status','添加敏感词成功','onModuleInit','msg','length','340483CjaLfZ','findOne','find','badWordsEntity','affected','function','where','UserEntity','username','update','save','delBadWords','baiduTextAccessToken','typeOriginCn','join','Injectable','log','violationLogEntity','__esModule','post','userEntity','axios','object','createQueryBuilder','hideString','queryBadWords','default','https://aip.baidubce.com/rest/2.0/solution/v1/text_censor/v2/user_defined?access_token=','./badWords.entity','delete','violation','HttpException','word'];_0x200b=function(){return _0x575440;};return _0x200b();}function _0x59b3(_0x41275c,_0x38f5f5){const _0x200b5a=_0x200b();return _0x59b3=function(_0x59b35e,_0x5500a6){_0x59b35e=_0x59b35e-0x148;let _0x12ebd7=_0x200b5a[_0x59b35e];return _0x12ebd7;},_0x59b3(_0x41275c,_0x38f5f5);}const utils_1=require('../../common/utils'),common_1=require(_0x51cbe9(0x169)),typeorm_1=require(_0x51cbe9(0x160)),axios_1=require(_0x51cbe9(0x19b)),typeorm_2=require(_0x51cbe9(0x14b)),globalConfig_service_1=require('../globalConfig/globalConfig.service'),user_entity_1=require(_0x51cbe9(0x14c)),badWords_entity_1=require(_0x51cbe9(0x1a2)),violationLog_entity_1=require(_0x51cbe9(0x15d));let BadWordsService=class BadWordsService{constructor(_0x4e3f3b,_0x51bad8,_0x10c454,_0x52cd0a){const _0x32f832=_0x51cbe9;this[_0x32f832(0x189)]=_0x4e3f3b,this[_0x32f832(0x197)]=_0x51bad8,this[_0x32f832(0x19a)]=_0x10c454,this[_0x32f832(0x1af)]=_0x52cd0a,this['badWords']=[];}async[_0x51cbe9(0x183)](){this['loadBadWords']();}async['customSensitiveWords'](_0x5349c4,_0x5cd580){const _0x5c1c85=_0x51cbe9,_0x179cbb=[];for(let _0x33acca=0x0;_0x33acca<this[_0x5c1c85(0x174)]['length'];_0x33acca++){const _0x4bf666=this[_0x5c1c85(0x174)][_0x33acca];_0x5349c4['includes'](_0x4bf666)&&_0x179cbb[_0x5c1c85(0x155)](_0x4bf666);}return _0x179cbb[_0x5c1c85(0x185)]&&await this['recordUserBadWords'](_0x5cd580,_0x5349c4,_0x179cbb,['自定义'],_0x5c1c85(0x172)),_0x179cbb;}async[_0x51cbe9(0x161)](_0x3e0f7d,_0x1148d2){const _0x58b428=_0x51cbe9,_0x278687=await this[_0x58b428(0x1af)][_0x58b428(0x16d)]();return _0x278687&&await this['checkBadWordsByConfig'](_0x3e0f7d,_0x278687,_0x1148d2),await this[_0x58b428(0x150)](_0x3e0f7d,_0x1148d2);}async[_0x51cbe9(0x15a)](_0x4e6294,_0x3afc3a,_0x35543f){const _0x149f8b=_0x51cbe9,{useType:_0x5f1def}=_0x3afc3a;_0x5f1def==='baidu'&&await this[_0x149f8b(0x17b)](_0x4e6294,_0x3afc3a[_0x149f8b(0x192)],_0x35543f);}['extractContent'](_0x1d7e57){const _0x140631=_0x51cbe9,_0x591bbf=/存在(.*?)不合规/,_0x9e6bd7=_0x1d7e57[_0x140631(0x16c)](_0x591bbf);return _0x9e6bd7?_0x9e6bd7[0x1]:'';}async[_0x51cbe9(0x17b)](_0x5dfc8a,_0x255627,_0x9c0f18){const _0x53eca2=_0x51cbe9;if(!_0x255627)return;const _0x268da6=_0x53eca2(0x1a1)+_0x255627+'}',_0x4eec2c={'Content-Type':'application/x-www-form-urlencoded','Accept':_0x53eca2(0x175)},_0x5afbe2=await axios_1[_0x53eca2(0x1a0)][_0x53eca2(0x199)](_0x268da6,{'text':_0x5dfc8a},{'headers':_0x4eec2c}),{conclusion:_0x1213df,error_code:_0x374b54,error_msg:_0x1709cc,conclusionType:_0x5856a1,data:_0x35647b}=_0x5afbe2['data'];_0x374b54&&console['log']('百度文本检测出现错误、请查看配置信息:\x20',_0x1709cc);if(_0x5856a1!==0x1){const _0x2b6ce0=[...new Set(_0x35647b[_0x53eca2(0x1ad)](_0x11b532=>this['extractContent'](_0x11b532[_0x53eca2(0x184)])))];await this[_0x53eca2(0x151)](_0x9c0f18,_0x5dfc8a,[_0x53eca2(0x170)],_0x2b6ce0,'百度云检测');const _0x5713d2=_0x53eca2(0x1ab)+_0x2b6ce0[_0x53eca2(0x194)](',')+_0x53eca2(0x165);throw new common_1[(_0x53eca2(0x1a5))](_0x5713d2,common_1[_0x53eca2(0x16e)][_0x53eca2(0x168)]);}}[_0x51cbe9(0x149)](_0x5d8d42){const _0x3fc6d0=_0x51cbe9,_0x5a2092=_0x5d8d42[_0x3fc6d0(0x1ad)](_0xe7bde4=>_0xe7bde4[_0x3fc6d0(0x180)]),_0x131aca=[...new Set(_0x5a2092)];return'您提交的内容中包含'+_0x131aca[_0x3fc6d0(0x194)](',')+'的信息、我们已对您账号进行标记、请合规使用！';}async[_0x51cbe9(0x17d)](){const _0x28986e=_0x51cbe9,_0x5c0caa=await this[_0x28986e(0x189)]['find']({'where':{'status':0x1},'select':[_0x28986e(0x1a6)]});this[_0x28986e(0x174)]=_0x5c0caa[_0x28986e(0x1ad)](_0x2c9dd3=>_0x2c9dd3[_0x28986e(0x1a6)]);}async[_0x51cbe9(0x19f)](_0x5ed0fc){const _0x14feee=_0x51cbe9,{page:page=0x1,size:size=0x1f4,word:_0xf2047e,status:_0xa945b0}=_0x5ed0fc,_0x34037c={};[0x0,0x1,'0','1'][_0x14feee(0x16f)](_0xa945b0)&&(_0x34037c[_0x14feee(0x181)]=_0xa945b0),_0xf2047e&&(_0x34037c[_0x14feee(0x1a6)]=(0x0,typeorm_2[_0x14feee(0x14f)])('%'+_0xf2047e+'%'));const [_0x5997d9,_0x1037a1]=await this[_0x14feee(0x189)][_0x14feee(0x166)]({'where':_0x34037c,'skip':(page-0x1)*size,'take':size,'order':{'id':_0x14feee(0x1a8)}});return{'rows':_0x5997d9,'count':_0x1037a1};}async[_0x51cbe9(0x191)](_0x6bbb30){const _0x26a61b=_0x51cbe9,_0x39765b=await this[_0x26a61b(0x189)]['findOne']({'where':{'id':_0x6bbb30['id']}});if(!_0x39765b)throw new common_1[(_0x26a61b(0x1a5))](_0x26a61b(0x17a),common_1['HttpStatus']['BAD_REQUEST']);const _0x5aafc0=await this[_0x26a61b(0x189)][_0x26a61b(0x1a3)]({'id':_0x6bbb30['id']});if(_0x5aafc0[_0x26a61b(0x18a)]>0x0)return await this[_0x26a61b(0x17d)](),_0x26a61b(0x14d);else throw new common_1[(_0x26a61b(0x1a5))]('删除敏感词失败',common_1[_0x26a61b(0x16e)][_0x26a61b(0x168)]);}async['updateBadWords'](_0x4bd377){const _0x10c913=_0x51cbe9,{id:_0x459a9d,word:_0x2c4c15,status:_0x519586}=_0x4bd377,_0x312e0f=await this['badWordsEntity']['findOne']({'where':{'word':_0x2c4c15}});if(_0x312e0f)throw new common_1['HttpException'](_0x10c913(0x176),common_1[_0x10c913(0x16e)][_0x10c913(0x168)]);const _0x4429bd=await this['badWordsEntity'][_0x10c913(0x18f)]({'id':_0x459a9d},{'word':_0x2c4c15,'status':_0x519586});if(_0x4429bd[_0x10c913(0x18a)]>0x0)return await this[_0x10c913(0x17d)](),_0x10c913(0x1aa);else throw new common_1[(_0x10c913(0x1a5))](_0x10c913(0x167),common_1[_0x10c913(0x16e)]['BAD_REQUEST']);}async[_0x51cbe9(0x17c)](_0x1c1504){const _0x231222=_0x51cbe9,{word:_0x1b8b29}=_0x1c1504,_0x826ec=await this[_0x231222(0x189)][_0x231222(0x187)]({'where':{'word':_0x1b8b29}});if(_0x826ec)throw new common_1['HttpException']('敏感词已存在,请检查您的提交信息',common_1[_0x231222(0x16e)][_0x231222(0x168)]);return await this['badWordsEntity']['save']({'word':_0x1b8b29}),await this[_0x231222(0x17d)](),_0x231222(0x182);}async['recordUserBadWords'](_0x2b1b27,_0xb3bc1c,_0x55a6f8,_0x308385,_0x37ef68){const _0x581a06=_0x51cbe9,_0x460609={'userId':_0x2b1b27,'content':_0xb3bc1c,'words':JSON[_0x581a06(0x1ac)](_0x55a6f8),'typeCn':JSON[_0x581a06(0x1ac)](_0x308385),'typeOriginCn':_0x37ef68};try{await this['userEntity'][_0x581a06(0x19d)]()[_0x581a06(0x18f)](user_entity_1[_0x581a06(0x18d)])[_0x581a06(0x15e)]({'violationCount':()=>_0x581a06(0x1ae)})[_0x581a06(0x18c)]('id\x20=\x20:userId',{'userId':_0x2b1b27})[_0x581a06(0x162)](),await this[_0x581a06(0x197)][_0x581a06(0x190)](_0x460609);}catch(_0x3bf805){console[_0x581a06(0x196)](_0x581a06(0x148),_0x3bf805);}}async[_0x51cbe9(0x1a4)](_0x33e0af,_0x5784b1){const _0x26d4c3=_0x51cbe9,{role:_0x5023ff}=_0x33e0af['user'],{page:page=0x1,size:size=0xa,userId:_0x1316bd,typeOriginCn:_0x22c21d}=_0x5784b1,_0x44c6d={};_0x1316bd&&(_0x44c6d[_0x26d4c3(0x15f)]=_0x1316bd),_0x22c21d&&(_0x44c6d[_0x26d4c3(0x193)]=_0x22c21d);const [_0x2afed1,_0x4562c2]=await this[_0x26d4c3(0x197)][_0x26d4c3(0x166)]({'where':_0x44c6d,'skip':(page-0x1)*size,'take':size,'order':{'id':_0x26d4c3(0x15c)}}),_0x27c033=[...new Set(_0x2afed1['map'](_0x579751=>_0x579751[_0x26d4c3(0x15f)]))],_0x5526b6=await this[_0x26d4c3(0x19a)][_0x26d4c3(0x188)]({'where':{'id':(0x0,typeorm_2['In'])(_0x27c033)},'select':['id','avatar',_0x26d4c3(0x18e),_0x26d4c3(0x154),_0x26d4c3(0x158),'status']});return _0x2afed1[_0x26d4c3(0x17e)](_0x164ba8=>{const _0x3ccc98=_0x26d4c3,_0x3e49da=_0x5526b6['find'](_0x2eb1bf=>_0x2eb1bf['id']===_0x164ba8['userId'])||{};_0x5023ff!=='super'&&(_0x3e49da[_0x3ccc98(0x154)]=(0x0,utils_1[_0x3ccc98(0x19e)])(_0x3e49da[_0x3ccc98(0x154)])),_0x164ba8[_0x3ccc98(0x16b)]=_0x3e49da;}),{'rows':_0x2afed1,'count':_0x4562c2};}};BadWordsService=__decorate([(0x0,common_1[_0x51cbe9(0x195)])(),__param(0x0,(0x0,typeorm_1[_0x51cbe9(0x16a)])(badWords_entity_1[_0x51cbe9(0x153)])),__param(0x1,(0x0,typeorm_1[_0x51cbe9(0x16a)])(violationLog_entity_1['ViolationLogEntity'])),__param(0x2,(0x0,typeorm_1[_0x51cbe9(0x16a)])(user_entity_1['UserEntity'])),__metadata(_0x51cbe9(0x171),[typeorm_2[_0x51cbe9(0x17f)],typeorm_2[_0x51cbe9(0x17f)],typeorm_2[_0x51cbe9(0x17f)],globalConfig_service_1['GlobalConfigService']])],BadWordsService),exports[_0x51cbe9(0x179)]=BadWordsService;