'use strict';const _0x3b48e4=_0x20f3;function _0x20f3(_0x36ebd1,_0x24858a){const _0x57e5dc=_0x57e5();return _0x20f3=function(_0x20f397,_0x1020fd){_0x20f397=_0x20f397-0x1a2;let _0xe35bc5=_0x57e5dc[_0x20f397];return _0xe35bc5;},_0x20f3(_0x36ebd1,_0x24858a);}(function(_0x3ee110,_0x598a88){const _0x42aa18=_0x20f3,_0x147e76=_0x3ee110();while(!![]){try{const _0x390571=-parseInt(_0x42aa18(0x1b4))/0x1*(-parseInt(_0x42aa18(0x1cd))/0x2)+parseInt(_0x42aa18(0x1e8))/0x3*(parseInt(_0x42aa18(0x1d1))/0x4)+parseInt(_0x42aa18(0x1b7))/0x5+-parseInt(_0x42aa18(0x200))/0x6+parseInt(_0x42aa18(0x1a9))/0x7*(parseInt(_0x42aa18(0x1fe))/0x8)+-parseInt(_0x42aa18(0x1b5))/0x9+parseInt(_0x42aa18(0x1ac))/0xa*(-parseInt(_0x42aa18(0x1ec))/0xb);if(_0x390571===_0x598a88)break;else _0x147e76['push'](_0x147e76['shift']());}catch(_0x11d4aa){_0x147e76['push'](_0x147e76['shift']());}}}(_0x57e5,0x8fe5b));var __decorate=this&&this[_0x3b48e4(0x1ea)]||function(_0x292a3d,_0x691e22,_0x144c04,_0x5c1cb9){const _0x3b1a9b=_0x3b48e4;var _0x40cda1=arguments[_0x3b1a9b(0x1f7)],_0x450b98=_0x40cda1<0x3?_0x691e22:_0x5c1cb9===null?_0x5c1cb9=Object[_0x3b1a9b(0x1e3)](_0x691e22,_0x144c04):_0x5c1cb9,_0x8643ec;if(typeof Reflect===_0x3b1a9b(0x1a2)&&typeof Reflect[_0x3b1a9b(0x1d6)]===_0x3b1a9b(0x208))_0x450b98=Reflect[_0x3b1a9b(0x1d6)](_0x292a3d,_0x691e22,_0x144c04,_0x5c1cb9);else{for(var _0x86ce20=_0x292a3d[_0x3b1a9b(0x1f7)]-0x1;_0x86ce20>=0x0;_0x86ce20--)if(_0x8643ec=_0x292a3d[_0x86ce20])_0x450b98=(_0x40cda1<0x3?_0x8643ec(_0x450b98):_0x40cda1>0x3?_0x8643ec(_0x691e22,_0x144c04,_0x450b98):_0x8643ec(_0x691e22,_0x144c04))||_0x450b98;}return _0x40cda1>0x3&&_0x450b98&&Object[_0x3b1a9b(0x1f6)](_0x691e22,_0x144c04,_0x450b98),_0x450b98;},__metadata=this&&this['__metadata']||function(_0x599204,_0x58fa51){const _0x3506f7=_0x3b48e4;if(typeof Reflect===_0x3506f7(0x1a2)&&typeof Reflect['metadata']===_0x3506f7(0x208))return Reflect['metadata'](_0x599204,_0x58fa51);},__param=this&&this['__param']||function(_0x2dd63b,_0xd90860){return function(_0x5ddb27,_0x104211){_0xd90860(_0x5ddb27,_0x104211,_0x2dd63b);};};Object[_0x3b48e4(0x1f6)](exports,_0x3b48e4(0x1b8),{'value':!![]}),exports['BadWordsService']=void 0x0;const utils_1=require('../../common/utils'),common_1=require(_0x3b48e4(0x1ed)),typeorm_1=require('@nestjs/typeorm'),axios_1=require(_0x3b48e4(0x20a)),typeorm_2=require(_0x3b48e4(0x1f2)),globalConfig_service_1=require(_0x3b48e4(0x1ff)),user_entity_1=require(_0x3b48e4(0x1ef)),badWords_entity_1=require(_0x3b48e4(0x203)),violationLog_entity_1=require(_0x3b48e4(0x1fa));let BadWordsService=class BadWordsService{constructor(_0x56dc1e,_0x1a48bd,_0x5cfd50,_0x6603bd){const _0x1308db=_0x3b48e4;this[_0x1308db(0x1b6)]=_0x56dc1e,this[_0x1308db(0x1c2)]=_0x1a48bd,this[_0x1308db(0x1bb)]=_0x5cfd50,this['globalConfigService']=_0x6603bd,this['badWords']=[];}async[_0x3b48e4(0x1db)](){const _0x3d0e69=_0x3b48e4;this[_0x3d0e69(0x1cb)]();}async[_0x3b48e4(0x1b1)](_0x76fe99,_0x3181cf){const _0x1d070b=_0x3b48e4,_0x41ea04=[];for(let _0x356d6a=0x0;_0x356d6a<this[_0x1d070b(0x1d2)]['length'];_0x356d6a++){const _0xdf8108=this[_0x1d070b(0x1d2)][_0x356d6a];_0x76fe99[_0x1d070b(0x1de)](_0xdf8108)&&_0x41ea04['push'](_0xdf8108);}return _0x41ea04[_0x1d070b(0x1f7)]&&await this['recordUserBadWords'](_0x3181cf,_0x76fe99,_0x41ea04,[_0x1d070b(0x1b0)],_0x1d070b(0x202)),_0x41ea04;}async['checkBadWords'](_0x4648bf,_0x12eff9){const _0x266c8b=_0x3b48e4,_0x6d836d=await this[_0x266c8b(0x1bd)][_0x266c8b(0x1e2)]();return _0x6d836d&&await this[_0x266c8b(0x1ce)](_0x4648bf,_0x6d836d,_0x12eff9),await this['customSensitiveWords'](_0x4648bf,_0x12eff9);}async[_0x3b48e4(0x1ce)](_0x150955,_0x1e5a53,_0x4e3204){const _0x2b3cb2=_0x3b48e4,{useType:_0x1aad13}=_0x1e5a53;_0x1aad13===_0x2b3cb2(0x1be)&&await this['baiduCheckBadWords'](_0x150955,_0x1e5a53['baiduTextAccessToken'],_0x4e3204);}['extractContent'](_0x263e6e){const _0x538374=_0x3b48e4,_0x1acd02=/存在(.*?)不合规/,_0x37521e=_0x263e6e[_0x538374(0x1d4)](_0x1acd02);return _0x37521e?_0x37521e[0x1]:'';}async[_0x3b48e4(0x205)](_0x441602,_0x560fce,_0x3a0601){const _0x1b3a6c=_0x3b48e4;if(!_0x560fce)return;const _0x3d4eeb=_0x1b3a6c(0x1fb)+_0x560fce+'}',_0x3f0caa={'Content-Type':_0x1b3a6c(0x1ca),'Accept':_0x1b3a6c(0x1a6)},_0xa35bd2=await axios_1[_0x1b3a6c(0x1b2)][_0x1b3a6c(0x1ab)](_0x3d4eeb,{'text':_0x441602},{'headers':_0x3f0caa}),{conclusion:_0x3518b4,error_code:_0x2192f6,error_msg:_0x1ee3b0,conclusionType:_0x4de8e6,data:_0x7d425e}=_0xa35bd2[_0x1b3a6c(0x1ad)];_0x2192f6&&console[_0x1b3a6c(0x1f3)](_0x1b3a6c(0x1d3),_0x1ee3b0);if(_0x4de8e6!==0x1){const _0x4850e5=[...new Set(_0x7d425e[_0x1b3a6c(0x1a7)](_0x2a32ac=>this[_0x1b3a6c(0x1d0)](_0x2a32ac[_0x1b3a6c(0x1bc)])))];await this[_0x1b3a6c(0x1bf)](_0x3a0601,_0x441602,[_0x1b3a6c(0x209)],_0x4850e5,_0x1b3a6c(0x1ba));const _0x1cc8da=_0x1b3a6c(0x1cc)+_0x4850e5['join'](',')+_0x1b3a6c(0x20d);throw new common_1[(_0x1b3a6c(0x1c5))](_0x1cc8da,common_1[_0x1b3a6c(0x1da)][_0x1b3a6c(0x1ee)]);}}['formarTips'](_0x10f991){const _0x47cdcf=_0x3b48e4,_0x19014a=_0x10f991[_0x47cdcf(0x1a7)](_0x18dc1a=>_0x18dc1a['category']),_0x56f8f6=[...new Set(_0x19014a)];return _0x47cdcf(0x1eb)+_0x56f8f6[_0x47cdcf(0x1aa)](',')+_0x47cdcf(0x1b9);}async[_0x3b48e4(0x1cb)](){const _0x466c3e=_0x3b48e4,_0x3266d6=await this[_0x466c3e(0x1b6)]['find']({'where':{'status':0x1},'select':[_0x466c3e(0x1d7)]});this[_0x466c3e(0x1d2)]=_0x3266d6['map'](_0xbc7f21=>_0xbc7f21['word']);}async['queryBadWords'](_0x5749df){const _0x19adf2=_0x3b48e4,{page:page=0x1,size:size=0x1f4,word:_0x52add6,status:_0x4e3d75}=_0x5749df,_0x2bb700={};[0x0,0x1,'0','1']['includes'](_0x4e3d75)&&(_0x2bb700[_0x19adf2(0x1df)]=_0x4e3d75),_0x52add6&&(_0x2bb700['word']=(0x0,typeorm_2[_0x19adf2(0x20b)])('%'+_0x52add6+'%'));const [_0x3ad809,_0x323e17]=await this[_0x19adf2(0x1b6)][_0x19adf2(0x1c0)]({'where':_0x2bb700,'skip':(page-0x1)*size,'take':size,'order':{'id':'ASC'}});return{'rows':_0x3ad809,'count':_0x323e17};}async[_0x3b48e4(0x201)](_0x203ccb){const _0x4bf060=_0x3b48e4,_0x38fdc7=await this[_0x4bf060(0x1b6)][_0x4bf060(0x1fc)]({'where':{'id':_0x203ccb['id']}});if(!_0x38fdc7)throw new common_1[(_0x4bf060(0x1c5))](_0x4bf060(0x1cf),common_1[_0x4bf060(0x1da)]['BAD_REQUEST']);const _0x3c2a03=await this['badWordsEntity'][_0x4bf060(0x1c6)]({'id':_0x203ccb['id']});if(_0x3c2a03['affected']>0x0)return await this[_0x4bf060(0x1cb)](),_0x4bf060(0x1d9);else throw new common_1[(_0x4bf060(0x1c5))](_0x4bf060(0x206),common_1['HttpStatus']['BAD_REQUEST']);}async[_0x3b48e4(0x1e1)](_0x437bf8){const _0x236776=_0x3b48e4,{id:_0x31c111,word:_0x2cc0b5,status:_0x5e0edf}=_0x437bf8,_0xacb0ce=await this['badWordsEntity']['findOne']({'where':{'word':_0x2cc0b5}});if(_0xacb0ce)throw new common_1[(_0x236776(0x1c5))](_0x236776(0x1d8),common_1[_0x236776(0x1da)][_0x236776(0x1ee)]);const _0x519b7e=await this['badWordsEntity'][_0x236776(0x1c1)]({'id':_0x31c111},{'word':_0x2cc0b5,'status':_0x5e0edf});if(_0x519b7e[_0x236776(0x1ae)]>0x0)return await this[_0x236776(0x1cb)](),_0x236776(0x1f4);else throw new common_1[(_0x236776(0x1c5))](_0x236776(0x1b3),common_1[_0x236776(0x1da)][_0x236776(0x1ee)]);}async['addBadWord'](_0x31d21e){const _0x29be26=_0x3b48e4,{word:_0x537e9d}=_0x31d21e,_0x109acd=await this[_0x29be26(0x1b6)][_0x29be26(0x1fc)]({'where':{'word':_0x537e9d}});if(_0x109acd)throw new common_1[(_0x29be26(0x1c5))](_0x29be26(0x1a4),common_1['HttpStatus'][_0x29be26(0x1ee)]);return await this[_0x29be26(0x1b6)][_0x29be26(0x1e4)]({'word':_0x537e9d}),await this[_0x29be26(0x1cb)](),_0x29be26(0x1dc);}async[_0x3b48e4(0x1bf)](_0x129b4c,_0x303c94,_0x3e637d,_0x3733b7,_0x521a98){const _0x2cbf23=_0x3b48e4,_0x1d5854={'userId':_0x129b4c,'content':_0x303c94,'words':JSON[_0x2cbf23(0x1e6)](_0x3e637d),'typeCn':JSON['stringify'](_0x3733b7),'typeOriginCn':_0x521a98};try{await this[_0x2cbf23(0x1bb)][_0x2cbf23(0x1a8)]()[_0x2cbf23(0x1c1)](user_entity_1[_0x2cbf23(0x207)])[_0x2cbf23(0x1d5)]({'violationCount':()=>_0x2cbf23(0x1f8)})[_0x2cbf23(0x1c4)](_0x2cbf23(0x1af),{'userId':_0x129b4c})[_0x2cbf23(0x1fd)](),await this[_0x2cbf23(0x1c2)][_0x2cbf23(0x1e4)](_0x1d5854);}catch(_0x174c8a){console['log']('error:\x20',_0x174c8a);}}async[_0x3b48e4(0x20c)](_0x1c1abf,_0x5f5294){const _0x119a85=_0x3b48e4,{role:_0x3ad1f0}=_0x1c1abf[_0x119a85(0x1f1)],{page:page=0x1,size:size=0xa,userId:_0x3ef4ca,typeOriginCn:_0x3ec289}=_0x5f5294,_0xe02d47={};_0x3ef4ca&&(_0xe02d47[_0x119a85(0x1e5)]=_0x3ef4ca),_0x3ec289&&(_0xe02d47[_0x119a85(0x1c8)]=_0x3ec289);const [_0xb46ff1,_0x38dcd5]=await this['violationLogEntity']['findAndCount']({'where':_0xe02d47,'skip':(page-0x1)*size,'take':size,'order':{'id':_0x119a85(0x1dd)}}),_0x281b38=[...new Set(_0xb46ff1['map'](_0x158093=>_0x158093[_0x119a85(0x1e5)]))],_0x3347b4=await this['userEntity']['find']({'where':{'id':(0x0,typeorm_2['In'])(_0x281b38)},'select':['id',_0x119a85(0x1c7),'username','email',_0x119a85(0x1c3),'status']});return _0xb46ff1[_0x119a85(0x1f0)](_0x40b251=>{const _0x425303=_0x119a85,_0x113369=_0x3347b4['find'](_0x40e283=>_0x40e283['id']===_0x40b251[_0x425303(0x1e5)])||{};_0x3ad1f0!==_0x425303(0x1e7)&&(_0x113369['email']=(0x0,utils_1['hideString'])(_0x113369[_0x425303(0x1f5)])),_0x40b251['userInfo']=_0x113369;}),{'rows':_0xb46ff1,'count':_0x38dcd5};}};BadWordsService=__decorate([(0x0,common_1[_0x3b48e4(0x204)])(),__param(0x0,(0x0,typeorm_1[_0x3b48e4(0x1f9)])(badWords_entity_1['BadWordsEntity'])),__param(0x1,(0x0,typeorm_1[_0x3b48e4(0x1f9)])(violationLog_entity_1[_0x3b48e4(0x1a5)])),__param(0x2,(0x0,typeorm_1['InjectRepository'])(user_entity_1['UserEntity'])),__metadata(_0x3b48e4(0x1c9),[typeorm_2[_0x3b48e4(0x1e9)],typeorm_2[_0x3b48e4(0x1e9)],typeorm_2[_0x3b48e4(0x1e9)],globalConfig_service_1[_0x3b48e4(0x1e0)]])],BadWordsService),exports[_0x3b48e4(0x1a3)]=BadWordsService;function _0x57e5(){const _0x39b120=['axios','Like','violation','的内容、我们已对您的账户进行标记、请合规使用！','object','BadWordsService','敏感词已存在,请检查您的提交信息','ViolationLogEntity','application/json','map','createQueryBuilder','35cRGYyb','join','post','16473170VSHlmj','data','affected','id\x20=\x20:userId','自定义','customSensitiveWords','default','更新敏感词失败','1YmRMVP','5064480zBkHxZ','badWordsEntity','4125970yKesBS','__esModule','的信息、我们已对您账号进行标记、请合规使用！','百度云检测','userEntity','msg','globalConfigService','baidu','recordUserBadWords','findAndCount','update','violationLogEntity','violationCount','where','HttpException','delete','avatar','typeOriginCn','design:paramtypes','application/x-www-form-urlencoded','loadBadWords','您提交的信息中包含','2239010nrFIRR','checkBadWordsByConfig','敏感词不存在,请检查您的提交信息','extractContent','12jPYTog','badWords','百度文本检测出现错误、请查看配置信息:\x20','match','set','decorate','word','敏感词已经存在了、请勿重复添加','删除敏感词成功','HttpStatus','onModuleInit','添加敏感词成功','DESC','includes','status','GlobalConfigService','updateBadWords','getSensitiveConfig','getOwnPropertyDescriptor','save','userId','stringify','super','740469PUZhST','Repository','__decorate','您提交的内容中包含','11HaBihH','@nestjs/common','BAD_REQUEST','../user/user.entity','forEach','user','typeorm','log','更新敏感词成功','email','defineProperty','length','violationCount\x20+\x201','InjectRepository','./violationLog.entity','https://aip.baidubce.com/rest/2.0/solution/v1/text_censor/v2/user_defined?access_token=','findOne','execute','1668616vJyayA','../globalConfig/globalConfig.service','5571678sxusXy','delBadWords','自定义检测','./badWords.entity','Injectable','baiduCheckBadWords','删除敏感词失败','UserEntity','function','***'];_0x57e5=function(){return _0x39b120;};return _0x57e5();}