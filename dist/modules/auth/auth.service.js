'use strict';const _0x50d0b2=_0x2695;(function(_0x406e3e,_0x530ee2){const _0x2ee890=_0x2695,_0x4deab9=_0x406e3e();while(!![]){try{const _0x17f41a=parseInt(_0x2ee890(0x1d8))/0x1+-parseInt(_0x2ee890(0x1e4))/0x2*(-parseInt(_0x2ee890(0x236))/0x3)+parseInt(_0x2ee890(0x217))/0x4+parseInt(_0x2ee890(0x19d))/0x5+-parseInt(_0x2ee890(0x1c7))/0x6*(parseInt(_0x2ee890(0x198))/0x7)+-parseInt(_0x2ee890(0x1e2))/0x8*(parseInt(_0x2ee890(0x1a4))/0x9)+-parseInt(_0x2ee890(0x1c1))/0xa;if(_0x17f41a===_0x530ee2)break;else _0x4deab9['push'](_0x4deab9['shift']());}catch(_0x419f86){_0x4deab9['push'](_0x4deab9['shift']());}}}(_0x4282,0xd9e2d));function _0x4282(){const _0x4443dc=['getClientIp','__param','6690205DwSaTA','验证过程出现错误','updateUserPhone','../../common/constants/user.constant','认证成功',',\x20期望的验证码:\x20','redisCacheService','3127248nkJHfu','@nestjs/common','用户凭证验证成功，用户ID:\x20',',\x20用户名:\x20','当前手机号已注册，请勿重复注册！','metadata','UserBalanceService','完成新用户余额处理','用户创建成功，用户ID:\x20','该手机号未注册，请先注册！','savaLoginIp','status','注册成功','saveToken','updatePassword','address','加密用户密码...','test','请输入验证码','password','avatar','getUserInfo','register','今日发送验证码次数已达上限，请24小时后再试！','验证码错误:\x20','getOwnPropertyDescriptor','登录失败:\x20用户凭证无效\x20-\x20用户名:\x20','UserStatusErrMsg','verifyUserRegister','12220090DxgShR','\x20-\x20用户ID:\x20','hashSync','NOT_FOUND','getIp','noVerifyRegister:\x20','12ToZGKe','loginWithCaptcha','createRandomUid','Injectable','ACTIVE','internal','__metadata','AuthService','sendPhoneCode','jwtService','userService','set','该邮箱未注册，请先注册！','@aiweb.com','../globalConfig/globalConfig.service','令牌已保存到Redis\x20-\x20用户ID:\x20','createRandomCode','1717496btiLfZ','当前邮箱已注册，请勿重复注册！','ipAddress','用户名已存在！','del','loginByOpenId','keys','GlobalConfigService','127.0.0.1','\x20is\x20available:\x20','32wqKTsQ','getInfo','234872yMwehd','configEntity','身份验证错误，请检查实名信息','../user/user.service','error','RedisCacheService','UserService','密码修改成功','使用默认用户头像:\x20','globalConfigService','Retrieved\x20redisCode\x20for\x20','addBalanceToNewUser','用户不存在，请先注册！','VerificationService','verifyPhoneIdentity','getUserByContact','defineProperty','UserStatusEnum','JWT令牌生成成功\x20-\x20用户ID:\x20','verifyIdentity','updateUserPassword','@nestjs/typeorm','../redisCache/redisCache.service','验证码过期:\x20','mailerService','username','HttpException','verifyUserCredentials','length','该邮箱已注册，请直接登录！','Logger','认证失败，请检查相关信息','Phone\x20','log','保存新用户到数据库...','ttl','获取默认用户头像...','../globalConfig/config.entity','TOO_MANY_REQUESTS','saveRealNameInfo','onModuleInit','sendMail',':CODE:','authService','debug','请提供有效的邮箱地址或手机号码。','MailerService','验证码已过期，请重新发送！','登录失败，用户凭证无效。','noVerifyRegister','decorate','2058956GvVryj','sign','verificationService','getConfigs','秒内不得重复发送验证码！','getNamespace','object','typeorm','@visitor.com','Contact:\x20','实名认证结果:\x20','userDefautlAvatar','Email\x20','验证码填写错误，请重新输入！',':RATE_LIMIT:','user','Checking\x20if\x20username\x20','bcryptjs','开始用户登录流程，用户名:\x20','该手机号已注册，请直接登录！','InjectRepository','JwtService','function','createUser','__decorate','HttpStatus','get','userBalanceService','ConfigEntity','\x20is\x20taken:\x20','./../verification/verification.service','9rZZktq',',\x20isPhone:\x20','../../common/utils','1463791QpWDFT','@nestjs/jwt','BAD_REQUEST'];_0x4282=function(){return _0x4443dc;};return _0x4282();}var __decorate=this&&this[_0x50d0b2(0x22f)]||function(_0x210f3f,_0x10e793,_0xd89882,_0x38bcb9){const _0x391a8a=_0x50d0b2;var _0x291714=arguments[_0x391a8a(0x200)],_0x45e67f=_0x291714<0x3?_0x10e793:_0x38bcb9===null?_0x38bcb9=Object[_0x391a8a(0x1bd)](_0x10e793,_0xd89882):_0x38bcb9,_0x448d4e;if(typeof Reflect===_0x391a8a(0x21d)&&typeof Reflect[_0x391a8a(0x216)]===_0x391a8a(0x22d))_0x45e67f=Reflect[_0x391a8a(0x216)](_0x210f3f,_0x10e793,_0xd89882,_0x38bcb9);else{for(var _0x522fc0=_0x210f3f[_0x391a8a(0x200)]-0x1;_0x522fc0>=0x0;_0x522fc0--)if(_0x448d4e=_0x210f3f[_0x522fc0])_0x45e67f=(_0x291714<0x3?_0x448d4e(_0x45e67f):_0x291714>0x3?_0x448d4e(_0x10e793,_0xd89882,_0x45e67f):_0x448d4e(_0x10e793,_0xd89882))||_0x45e67f;}return _0x291714>0x3&&_0x45e67f&&Object[_0x391a8a(0x1f4)](_0x10e793,_0xd89882,_0x45e67f),_0x45e67f;},__metadata=this&&this[_0x50d0b2(0x1cd)]||function(_0x5396f7,_0x17608a){const _0x36a4ad=_0x50d0b2;if(typeof Reflect===_0x36a4ad(0x21d)&&typeof Reflect['metadata']===_0x36a4ad(0x22d))return Reflect[_0x36a4ad(0x1a9)](_0x5396f7,_0x17608a);},__param=this&&this[_0x50d0b2(0x19c)]||function(_0x28a639,_0xfbea0c){return function(_0x183238,_0x361c51){_0xfbea0c(_0x183238,_0x361c51,_0x28a639);};};Object[_0x50d0b2(0x1f4)](exports,'__esModule',{'value':!![]}),exports[_0x50d0b2(0x1ce)]=void 0x0;const user_constant_1=require(_0x50d0b2(0x1a0)),utils_1=require(_0x50d0b2(0x238)),globalConfig_service_1=require(_0x50d0b2(0x1d5)),common_1=require(_0x50d0b2(0x1a5)),jwt_1=require(_0x50d0b2(0x199)),typeorm_1=require(_0x50d0b2(0x1f9)),bcrypt=require(_0x50d0b2(0x228)),os=require('os'),typeorm_2=require(_0x50d0b2(0x21e)),config_entity_1=require(_0x50d0b2(0x209)),mailer_service_1=require('../mailer/mailer.service'),redisCache_service_1=require(_0x50d0b2(0x1fa)),user_service_1=require(_0x50d0b2(0x1e7)),userBalance_service_1=require('../userBalance/userBalance.service'),verification_service_1=require(_0x50d0b2(0x235));let AuthService=class AuthService{constructor(_0x270501,_0xd8881b,_0x23ad67,_0x28cd40,_0x13a1bc,_0xccfbd1,_0x161463,_0x3bf022){const _0x921a3=_0x50d0b2;this[_0x921a3(0x1e5)]=_0x270501,this[_0x921a3(0x1d1)]=_0xd8881b,this[_0x921a3(0x1d0)]=_0x23ad67,this[_0x921a3(0x1fc)]=_0x28cd40,this[_0x921a3(0x219)]=_0x13a1bc,this[_0x921a3(0x232)]=_0xccfbd1,this[_0x921a3(0x1a3)]=_0x161463,this['globalConfigService']=_0x3bf022;}async[_0x50d0b2(0x20c)](){const _0x4c7026=_0x50d0b2;this[_0x4c7026(0x1c5)]();}async[_0x50d0b2(0x1ba)](_0xe82b4f,_0x1d2193){const _0x5ed27a=_0x50d0b2,{password:_0x357afd,contact:_0x3b2bd4,code:_0x268dcd}=_0xe82b4f;let _0x11687b='',_0x4bce99='';const _0x13489f=/\S+@\S+\.\S+/[_0x5ed27a(0x1b5)](_0x3b2bd4),_0xd2b703=/^\d{10,}$/[_0x5ed27a(0x1b5)](_0x3b2bd4);common_1[_0x5ed27a(0x202)]['debug'](_0x5ed27a(0x220)+_0x3b2bd4+',\x20isEmail:\x20'+_0x13489f+_0x5ed27a(0x237)+_0xd2b703);let _0x350c3c=(0x0,utils_1[_0x5ed27a(0x1c9)])();while(!![]){const _0x18811e=await this[_0x5ed27a(0x1d1)][_0x5ed27a(0x1c0)]({'username':_0x350c3c});common_1['Logger'][_0x5ed27a(0x210)](_0x5ed27a(0x227)+_0x350c3c+_0x5ed27a(0x234)+_0x18811e);if(_0x18811e)break;_0x350c3c=(0x0,utils_1[_0x5ed27a(0x1c9)])();}if(_0x13489f){_0x11687b=_0x3b2bd4;const _0x519339=await this[_0x5ed27a(0x1d1)][_0x5ed27a(0x1c0)]({'username':_0x350c3c,'email':_0x11687b});common_1[_0x5ed27a(0x202)][_0x5ed27a(0x210)](_0x5ed27a(0x223)+_0x11687b+'\x20is\x20available:\x20'+_0x519339);if(!_0x519339)throw new common_1[(_0x5ed27a(0x1fe))](_0x5ed27a(0x1d9),common_1[_0x5ed27a(0x230)][_0x5ed27a(0x19a)]);}else{if(_0xd2b703){_0x4bce99=_0x3b2bd4;const _0x285d0b=await this['userService']['verifyUserRegister']({'username':_0x350c3c,'phone':_0x4bce99});common_1['Logger'][_0x5ed27a(0x210)](_0x5ed27a(0x204)+_0x4bce99+_0x5ed27a(0x1e1)+_0x285d0b);if(!_0x285d0b)throw new common_1[(_0x5ed27a(0x1fe))](_0x5ed27a(0x1a8),common_1[_0x5ed27a(0x230)][_0x5ed27a(0x19a)]);}else throw new common_1[(_0x5ed27a(0x1fe))](_0x5ed27a(0x211),common_1['HttpStatus'][_0x5ed27a(0x19a)]);}const _0x4bda9e=await this[_0x5ed27a(0x1ed)][_0x5ed27a(0x21a)]([_0x5ed27a(0x215)]);common_1[_0x5ed27a(0x202)][_0x5ed27a(0x210)](_0x5ed27a(0x1c6)+_0x4bda9e);if(_0x4bda9e!=='1'){const _0x4ae33c=await this[_0x5ed27a(0x1ed)][_0x5ed27a(0x21c)](),_0x3ee3ca=_0x4ae33c+_0x5ed27a(0x20e)+_0x3b2bd4,_0x206684=await this[_0x5ed27a(0x1a3)][_0x5ed27a(0x231)]({'key':_0x3ee3ca});common_1[_0x5ed27a(0x202)][_0x5ed27a(0x210)]('Retrieved\x20redisCode\x20for\x20'+_0x3b2bd4+':\x20'+_0x206684);if(_0x268dcd==='')throw new common_1[(_0x5ed27a(0x1fe))](_0x5ed27a(0x1b6),common_1['HttpStatus']['BAD_REQUEST']);if(!_0x206684){common_1[_0x5ed27a(0x202)]['log']('验证码过期:\x20'+_0x3b2bd4,'authService');throw new common_1['HttpException']('验证码已过期，请重新发送！',common_1[_0x5ed27a(0x230)][_0x5ed27a(0x19a)]);}if(_0x268dcd!==_0x206684){common_1[_0x5ed27a(0x202)][_0x5ed27a(0x205)](_0x5ed27a(0x1bc)+_0x3b2bd4+'\x20输入的验证码:\x20'+_0x268dcd+_0x5ed27a(0x1a2)+_0x206684,_0x5ed27a(0x20f));throw new common_1[(_0x5ed27a(0x1fe))](_0x5ed27a(0x224),common_1[_0x5ed27a(0x230)]['BAD_REQUEST']);}}let _0xefc7fe;if(_0x13489f)_0xefc7fe={'username':_0x350c3c,'password':_0x357afd,'email':_0x3b2bd4,'status':user_constant_1[_0x5ed27a(0x1f5)][_0x5ed27a(0x1cb)]};else{const _0x527d57=(0x0,utils_1[_0x5ed27a(0x1c9)])()+_0x5ed27a(0x1d4);_0xefc7fe={'username':_0x350c3c,'password':_0x357afd,'email':_0x527d57,'phone':_0x3b2bd4,'status':user_constant_1[_0x5ed27a(0x1f5)][_0x5ed27a(0x1cb)]};}common_1['Logger']['debug'](_0x5ed27a(0x208));const _0x2060bf=await this[_0x5ed27a(0x1ed)][_0x5ed27a(0x21a)]([_0x5ed27a(0x222)]);common_1[_0x5ed27a(0x202)][_0x5ed27a(0x210)](_0x5ed27a(0x1ec)+_0x2060bf),_0xefc7fe[_0x5ed27a(0x1b8)]=_0x2060bf,common_1[_0x5ed27a(0x202)]['debug'](_0x5ed27a(0x1b4));const _0x37aa5d=bcrypt[_0x5ed27a(0x1c3)](_0x357afd,0xa);_0xefc7fe[_0x5ed27a(0x1b7)]=_0x37aa5d,common_1['Logger'][_0x5ed27a(0x210)](_0x5ed27a(0x206));const _0x12bd07=await this['userService'][_0x5ed27a(0x22e)](_0xefc7fe);return common_1[_0x5ed27a(0x202)]['debug'](_0x5ed27a(0x1ac)+_0x12bd07['id']),await this[_0x5ed27a(0x232)][_0x5ed27a(0x1ef)](_0x12bd07['id']),common_1['Logger']['debug'](_0x5ed27a(0x1ab)),{'success':!![],'message':_0x5ed27a(0x1b0)};}async['login'](_0x250c25,_0x2fa556){const _0xd24811=_0x50d0b2;console['log'](_0xd24811(0x229)+_0x250c25[_0xd24811(0x1fd)]);const _0x3f0098=await this[_0xd24811(0x1d1)][_0xd24811(0x1ff)](_0x250c25);if(!_0x3f0098){console[_0xd24811(0x1e8)](_0xd24811(0x1be)+_0x250c25['username']);throw new common_1[(_0xd24811(0x1fe))](_0xd24811(0x214),common_1[_0xd24811(0x230)]['UNAUTHORIZED']);}const {username:_0x512ac4,id:_0x27fc15,email:_0x4bab8d,role:_0x30f9c1,openId:_0x4b8d8d,client:_0x425321,phone:_0x27e59a}=_0x3f0098;console['log'](_0xd24811(0x1a6)+_0x27fc15+_0xd24811(0x1a7)+_0x512ac4);const _0x5b3bd5=(0x0,utils_1['getClientIp'])(_0x2fa556);await this[_0xd24811(0x1d1)]['savaLoginIp'](_0x27fc15,_0x5b3bd5),console[_0xd24811(0x205)]('保存登录IP:\x20'+_0x5b3bd5+_0xd24811(0x1c2)+_0x27fc15);const _0xe0f75d=await this['jwtService'][_0xd24811(0x218)]({'username':_0x512ac4,'id':_0x27fc15,'email':_0x4bab8d,'role':_0x30f9c1,'openId':_0x4b8d8d,'client':_0x425321,'phone':_0x27e59a});return console['log'](_0xd24811(0x1f6)+_0x27fc15),await this[_0xd24811(0x1a3)][_0xd24811(0x1b1)](_0x27fc15,_0xe0f75d),console[_0xd24811(0x205)](_0xd24811(0x1d6)+_0x27fc15),_0xe0f75d;}async[_0x50d0b2(0x1c8)](_0x430d58,_0x47088d){const _0x51ed04=_0x50d0b2,{contact:_0x43f388,code:_0x22e224}=_0x430d58;let _0x2a6c75='',_0x2c92d3='';const _0x2b5958=/\S+@\S+\.\S+/[_0x51ed04(0x1b5)](_0x43f388),_0x526adb=/^\d{10,}$/[_0x51ed04(0x1b5)](_0x43f388);if(_0x2b5958)_0x2a6c75=_0x43f388;else{if(_0x526adb)_0x2c92d3=_0x43f388;else throw new common_1[(_0x51ed04(0x1fe))](_0x51ed04(0x211),common_1['HttpStatus']['BAD_REQUEST']);}if(!![]){if(_0x2b5958){const _0x5df4fb=await this['userService'][_0x51ed04(0x1c0)]({'email':_0x43f388});if(_0x5df4fb)throw new common_1['HttpException'](_0x51ed04(0x1d3),common_1['HttpStatus'][_0x51ed04(0x19a)]);}else{if(_0x526adb){const _0x273392=await this[_0x51ed04(0x1d1)][_0x51ed04(0x1c0)]({'phone':_0x43f388});if(_0x273392)throw new common_1['HttpException']('该手机号未注册，请先注册！',common_1[_0x51ed04(0x230)]['BAD_REQUEST']);}}}else{if(_0x2b5958){const _0x52e21c=await this[_0x51ed04(0x1d1)][_0x51ed04(0x1c0)]({'email':_0x43f388});if(!_0x52e21c)throw new common_1[(_0x51ed04(0x1fe))](_0x51ed04(0x201),common_1['HttpStatus']['BAD_REQUEST']);}else{if(_0x526adb){const _0x28ab39=await this[_0x51ed04(0x1d1)][_0x51ed04(0x1c0)]({'phone':_0x43f388});if(!_0x28ab39)throw new common_1[(_0x51ed04(0x1fe))]('该手机号已注册，请直接登录！',common_1[_0x51ed04(0x230)]['BAD_REQUEST']);}}}const _0x2662d8=await this[_0x51ed04(0x1ed)][_0x51ed04(0x21c)](),_0x2a19fe=_0x2662d8+_0x51ed04(0x20e)+_0x43f388,_0xd1b4ef=await this[_0x51ed04(0x1a3)][_0x51ed04(0x231)]({'key':_0x2a19fe});if(!_0xd1b4ef){common_1[_0x51ed04(0x202)][_0x51ed04(0x205)](_0x51ed04(0x1fb)+_0x43f388,_0x51ed04(0x20f));throw new common_1[(_0x51ed04(0x1fe))](_0x51ed04(0x213),common_1[_0x51ed04(0x230)][_0x51ed04(0x19a)]);}if(_0xd1b4ef!==_0x22e224){common_1['Logger'][_0x51ed04(0x205)](_0x51ed04(0x1bc)+_0x43f388,'authService');throw new common_1[(_0x51ed04(0x1fe))]('验证码错误，请重新输入！',common_1['HttpStatus'][_0x51ed04(0x19a)]);}const _0x448cb2=await this[_0x51ed04(0x1d1)][_0x51ed04(0x1f3)]({'email':_0x2a6c75,'phone':_0x2c92d3});if(!_0x448cb2)throw new common_1[(_0x51ed04(0x1fe))](_0x51ed04(0x1f0),common_1[_0x51ed04(0x230)][_0x51ed04(0x1c4)]);if(_0x448cb2[_0x51ed04(0x1af)]!==user_constant_1[_0x51ed04(0x1f5)][_0x51ed04(0x1cb)])throw new common_1[(_0x51ed04(0x1fe))](user_constant_1['UserStatusErrMsg'][_0x448cb2[_0x51ed04(0x1af)]],common_1['HttpStatus']['BAD_REQUEST']);const {username:_0x1de750,id:_0xd8911b,role:_0x55255b,openId:_0x6bda33,client:_0x36e43e}=_0x448cb2,_0x2eacd0=(0x0,utils_1[_0x51ed04(0x19b)])(_0x47088d);await this['userService'][_0x51ed04(0x1ae)](_0xd8911b,_0x2eacd0);const _0x6ec805=await this[_0x51ed04(0x1d0)]['sign']({'username':_0x1de750,'id':_0xd8911b,'email':_0x2a6c75,'role':_0x55255b,'openId':_0x6bda33,'client':_0x36e43e,'phone':_0x2c92d3});return await this[_0x51ed04(0x1a3)][_0x51ed04(0x1b1)](_0xd8911b,_0x6ec805),await this[_0x51ed04(0x1a3)][_0x51ed04(0x1dc)](_0x2a19fe),_0x6ec805;}async[_0x50d0b2(0x1dd)](_0x19b3f2,_0x4e9e04){const _0x4bf8d4=_0x50d0b2,{status:_0x268f90}=_0x19b3f2;if(_0x268f90!==user_constant_1[_0x4bf8d4(0x1f5)]['ACTIVE'])throw new common_1['HttpException'](user_constant_1[_0x4bf8d4(0x1bf)][_0x268f90],common_1['HttpStatus'][_0x4bf8d4(0x19a)]);const {username:_0x357392,id:_0x43a031,email:_0x166d16,role:_0x90613f,openId:_0xfb0b9f,client:_0x1423b4}=_0x19b3f2,_0x55060f=(0x0,utils_1[_0x4bf8d4(0x19b)])(_0x4e9e04);await this[_0x4bf8d4(0x1d1)][_0x4bf8d4(0x1ae)](_0x43a031,_0x55060f);const _0x3bb7db=await this['jwtService'][_0x4bf8d4(0x218)]({'username':_0x357392,'id':_0x43a031,'email':_0x166d16,'role':_0x90613f,'openId':_0xfb0b9f,'client':_0x1423b4});return await this['redisCacheService'][_0x4bf8d4(0x1b1)](_0x43a031,_0x3bb7db),_0x3bb7db;}async[_0x50d0b2(0x1e3)](_0x3036fc){const _0x43417f=_0x50d0b2,{id:_0x3aabb4}=_0x3036fc[_0x43417f(0x226)];return await this[_0x43417f(0x1d1)][_0x43417f(0x1b9)](_0x3aabb4);}async[_0x50d0b2(0x1b2)](_0x3e4e2b,_0x5646d3){const _0x4a02fe=_0x50d0b2,{id:_0x35c2ab}=_0x3e4e2b[_0x4a02fe(0x226)];return this['userService'][_0x4a02fe(0x1f8)](_0x35c2ab,_0x5646d3[_0x4a02fe(0x1b7)]),_0x4a02fe(0x1eb);}[_0x50d0b2(0x1c5)](){const _0x3f49ca=_0x50d0b2;let _0x1c09d1;const _0x1b5a89=os['networkInterfaces']();Object[_0x3f49ca(0x1de)](_0x1b5a89)['forEach'](_0x164cbb=>{const _0x22a413=_0x3f49ca,_0x830d43=_0x1b5a89[_0x164cbb];for(let _0xbb1bbb=0x0;_0xbb1bbb<_0x830d43[_0x22a413(0x200)];_0xbb1bbb++){const _0x16c057=_0x830d43[_0xbb1bbb];if(_0x16c057['family']==='IPv4'&&_0x16c057[_0x22a413(0x1b3)]!==_0x22a413(0x1e0)&&!_0x16c057[_0x22a413(0x1cc)]){_0x1c09d1=_0x16c057[_0x22a413(0x1b3)];break;}}}),this[_0x3f49ca(0x1da)]=_0x1c09d1;}async['sendCode'](_0x34b703){const _0x38f412=_0x50d0b2,{contact:_0x460de9,isLogin:_0x2abd2b}=_0x34b703,_0x3f4587=(0x0,utils_1[_0x38f412(0x1d7)])(),_0x391610=/\S+@\S+\.\S+/[_0x38f412(0x1b5)](_0x460de9),_0x2833e7=/^1\d{10}$/['test'](_0x460de9);if(!_0x391610&&!_0x2833e7)throw new common_1[(_0x38f412(0x1fe))](_0x38f412(0x211),common_1[_0x38f412(0x230)]['BAD_REQUEST']);if(_0x2abd2b){if(_0x391610){const _0x3c890b=await this[_0x38f412(0x1d1)][_0x38f412(0x1c0)]({'email':_0x460de9});if(_0x3c890b)throw new common_1[(_0x38f412(0x1fe))](_0x38f412(0x1d3),common_1['HttpStatus'][_0x38f412(0x19a)]);}else{if(_0x2833e7){const _0x353322=await this[_0x38f412(0x1d1)][_0x38f412(0x1c0)]({'phone':_0x460de9});if(_0x353322)throw new common_1['HttpException'](_0x38f412(0x1ad),common_1['HttpStatus'][_0x38f412(0x19a)]);}}}else{if(_0x391610){const _0x24fee4=await this[_0x38f412(0x1d1)]['verifyUserRegister']({'email':_0x460de9});if(!_0x24fee4)throw new common_1[(_0x38f412(0x1fe))](_0x38f412(0x201),common_1[_0x38f412(0x230)][_0x38f412(0x19a)]);}else{if(_0x2833e7){const _0x484558=await this[_0x38f412(0x1d1)]['verifyUserRegister']({'phone':_0x460de9});if(!_0x484558)throw new common_1[(_0x38f412(0x1fe))](_0x38f412(0x22a),common_1['HttpStatus'][_0x38f412(0x19a)]);}}}const _0x1ef9e9=await this[_0x38f412(0x1ed)][_0x38f412(0x21c)](),_0x112b5f=_0x1ef9e9+_0x38f412(0x20e)+_0x460de9,_0x5a0d2b=_0x1ef9e9+_0x38f412(0x225)+_0x460de9,_0x722d00=await this[_0x38f412(0x1a3)][_0x38f412(0x207)](_0x112b5f);if(_0x722d00&&_0x722d00>0x0)throw new common_1['HttpException'](_0x722d00+_0x38f412(0x21b),common_1[_0x38f412(0x230)][_0x38f412(0x19a)]);const _0x243b24=await this[_0x38f412(0x1a3)][_0x38f412(0x231)]({'key':_0x5a0d2b})||0x0;if(_0x243b24>=0xa)throw new common_1[(_0x38f412(0x1fe))](_0x38f412(0x1bb),common_1[_0x38f412(0x230)][_0x38f412(0x20a)]);if(_0x391610)await this[_0x38f412(0x1fc)][_0x38f412(0x20d)]({'to':_0x460de9,'context':{'code':_0x3f4587}});else{if(_0x2833e7){const _0x26872f={'phone':_0x460de9,'code':_0x3f4587};await this['verificationService'][_0x38f412(0x1cf)](_0x26872f);}}return await this[_0x38f412(0x1a3)][_0x38f412(0x1d2)]({'key':_0x112b5f,'val':_0x3f4587},0x5*0x3c),await this['redisCacheService'][_0x38f412(0x1d2)]({'key':_0x5a0d2b,'val':Number(_0x243b24)+0x1},0x18*0x3c*0x3c),await this[_0x38f412(0x1a3)]['set']({'key':_0x112b5f,'val':_0x3f4587},0x3c),'验证码发送成功、请填写验证码完成'+(_0x2abd2b?'注册':'验证')+'！';}['createTokenFromFingerprint'](_0x5ee462){const _0x20584c=_0x50d0b2,_0x3d761a=this[_0x20584c(0x1d0)][_0x20584c(0x218)]({'username':'游客'+_0x5ee462,'id':_0x5ee462,'email':_0x5ee462+_0x20584c(0x21f),'role':'visitor','openId':null,'client':null});return _0x3d761a;}async['verifyIdentity'](_0x424ccc,_0x53f073){const _0x1d91e1=_0x50d0b2;common_1[_0x1d91e1(0x202)]['debug']('开始实名认证流程');const {name:_0x42f425,idCard:_0x4eb1b8}=_0x53f073,{id:_0x513ce5}=_0x424ccc[_0x1d91e1(0x226)];try{const _0xdd6094=await this[_0x1d91e1(0x219)][_0x1d91e1(0x1f7)](_0x53f073);common_1['Logger'][_0x1d91e1(0x210)](_0x1d91e1(0x221)+_0xdd6094);if(!_0xdd6094)throw new common_1[(_0x1d91e1(0x1fe))](_0x1d91e1(0x1e6),common_1[_0x1d91e1(0x230)][_0x1d91e1(0x19a)]);return await this[_0x1d91e1(0x1d1)][_0x1d91e1(0x20b)](_0x513ce5,_0x42f425,_0x4eb1b8),_0x1d91e1(0x1a1);}catch(_0x5f54e2){common_1['Logger'][_0x1d91e1(0x1e8)](_0x1d91e1(0x19e),_0x5f54e2);throw new common_1[(_0x1d91e1(0x1fe))](_0x1d91e1(0x203),common_1[_0x1d91e1(0x230)][_0x1d91e1(0x19a)]);}}async[_0x50d0b2(0x1f2)](_0x3c0c8a,_0x5d8c21){const _0x2105fa=_0x50d0b2;common_1['Logger'][_0x2105fa(0x210)]('开始手机号认证流程');const {phone:_0x4921ef,username:_0x19931d,password:_0x161e08,code:_0x3fe179}=_0x5d8c21,{id:_0x4699a4}=_0x3c0c8a[_0x2105fa(0x226)],_0x3f2025=this[_0x2105fa(0x1ed)][_0x2105fa(0x21c)](),_0x2d24a3=_0x3f2025+_0x2105fa(0x20e)+_0x4921ef,_0x280925=await this[_0x2105fa(0x1a3)][_0x2105fa(0x231)]({'key':_0x2d24a3});common_1[_0x2105fa(0x202)][_0x2105fa(0x210)](_0x2105fa(0x1ee)+_0x4921ef+':\x20'+_0x280925);if(_0x3fe179==='')throw new common_1[(_0x2105fa(0x1fe))](_0x2105fa(0x1b6),common_1[_0x2105fa(0x230)][_0x2105fa(0x19a)]);if(!_0x280925){common_1[_0x2105fa(0x202)][_0x2105fa(0x205)](_0x2105fa(0x1fb)+_0x4921ef,'authService');throw new common_1[(_0x2105fa(0x1fe))](_0x2105fa(0x213),common_1['HttpStatus'][_0x2105fa(0x19a)]);}if(_0x3fe179!==_0x280925){common_1[_0x2105fa(0x202)][_0x2105fa(0x205)](_0x2105fa(0x1bc)+_0x4921ef+'\x20输入的验证码:\x20'+_0x3fe179+',\x20期望的验证码:\x20'+_0x280925,_0x2105fa(0x20f));throw new common_1[(_0x2105fa(0x1fe))](_0x2105fa(0x224),common_1['HttpStatus'][_0x2105fa(0x19a)]);}if(_0x19931d){const _0x514e24=await this[_0x2105fa(0x1d1)]['isUsernameTaken'](_0x5d8c21['username'],_0x4699a4);if(_0x514e24)throw new common_1[(_0x2105fa(0x1fe))](_0x2105fa(0x1db),common_1[_0x2105fa(0x230)][_0x2105fa(0x19a)]);}try{return await this[_0x2105fa(0x1d1)][_0x2105fa(0x19f)](_0x4699a4,_0x4921ef,_0x19931d,_0x161e08),'认证成功';}catch(_0x16f0d0){common_1[_0x2105fa(0x202)][_0x2105fa(0x1e8)](_0x2105fa(0x19e),_0x16f0d0);throw new common_1[(_0x2105fa(0x1fe))]('身份验证错误，请检查相关信息',common_1[_0x2105fa(0x230)]['BAD_REQUEST']);}}};function _0x2695(_0x395a08,_0x780704){const _0x4282ac=_0x4282();return _0x2695=function(_0x269550,_0x147945){_0x269550=_0x269550-0x198;let _0xf35f6c=_0x4282ac[_0x269550];return _0xf35f6c;},_0x2695(_0x395a08,_0x780704);}AuthService=__decorate([(0x0,common_1[_0x50d0b2(0x1ca)])(),__param(0x0,(0x0,typeorm_1[_0x50d0b2(0x22b)])(config_entity_1[_0x50d0b2(0x233)])),__metadata('design:paramtypes',[typeorm_2['Repository'],user_service_1[_0x50d0b2(0x1ea)],jwt_1[_0x50d0b2(0x22c)],mailer_service_1[_0x50d0b2(0x212)],verification_service_1[_0x50d0b2(0x1f1)],userBalance_service_1[_0x50d0b2(0x1aa)],redisCache_service_1[_0x50d0b2(0x1e9)],globalConfig_service_1[_0x50d0b2(0x1df)]])],AuthService),exports[_0x50d0b2(0x1ce)]=AuthService;