'use strict';const _0x5c74b0=_0x471d;(function(_0x16142e,_0x552a60){const _0x833702=_0x471d,_0x1a5886=_0x16142e();while(!![]){try{const _0x473dca=-parseInt(_0x833702(0x19c))/0x1+-parseInt(_0x833702(0x180))/0x2+-parseInt(_0x833702(0x160))/0x3*(-parseInt(_0x833702(0x189))/0x4)+-parseInt(_0x833702(0x14a))/0x5+-parseInt(_0x833702(0x1aa))/0x6*(-parseInt(_0x833702(0x158))/0x7)+-parseInt(_0x833702(0x1b0))/0x8*(-parseInt(_0x833702(0x17f))/0x9)+parseInt(_0x833702(0x1ca))/0xa;if(_0x473dca===_0x552a60)break;else _0x1a5886['push'](_0x1a5886['shift']());}catch(_0x2dc046){_0x1a5886['push'](_0x1a5886['shift']());}}}(_0x40ba,0x8e777));var __decorate=this&&this[_0x5c74b0(0x171)]||function(_0x13fcff,_0x1866d9,_0xb91b50,_0x362464){const _0xa61358=_0x5c74b0;var _0x1d547e=arguments[_0xa61358(0x13b)],_0x931a86=_0x1d547e<0x3?_0x1866d9:_0x362464===null?_0x362464=Object[_0xa61358(0x19a)](_0x1866d9,_0xb91b50):_0x362464,_0x33602c;if(typeof Reflect==='object'&&typeof Reflect[_0xa61358(0x1a5)]===_0xa61358(0x14d))_0x931a86=Reflect['decorate'](_0x13fcff,_0x1866d9,_0xb91b50,_0x362464);else{for(var _0x2f62e7=_0x13fcff[_0xa61358(0x13b)]-0x1;_0x2f62e7>=0x0;_0x2f62e7--)if(_0x33602c=_0x13fcff[_0x2f62e7])_0x931a86=(_0x1d547e<0x3?_0x33602c(_0x931a86):_0x1d547e>0x3?_0x33602c(_0x1866d9,_0xb91b50,_0x931a86):_0x33602c(_0x1866d9,_0xb91b50))||_0x931a86;}return _0x1d547e>0x3&&_0x931a86&&Object[_0xa61358(0x17c)](_0x1866d9,_0xb91b50,_0x931a86),_0x931a86;},__metadata=this&&this[_0x5c74b0(0x169)]||function(_0x3eb2df,_0x3270fe){const _0x3555ca=_0x5c74b0;if(typeof Reflect==='object'&&typeof Reflect[_0x3555ca(0x19d)]===_0x3555ca(0x14d))return Reflect[_0x3555ca(0x19d)](_0x3eb2df,_0x3270fe);},__param=this&&this['__param']||function(_0xd17c8c,_0x286b66){return function(_0x2ade8d,_0x36f1b4){_0x286b66(_0x2ade8d,_0x36f1b4,_0xd17c8c);};};Object[_0x5c74b0(0x17c)](exports,_0x5c74b0(0x1bf),{'value':!![]}),exports[_0x5c74b0(0x154)]=void 0x0;const user_constant_1=require(_0x5c74b0(0x1be)),utils_1=require(_0x5c74b0(0x19b)),globalConfig_service_1=require(_0x5c74b0(0x16f)),common_1=require(_0x5c74b0(0x14f)),jwt_1=require(_0x5c74b0(0x185)),typeorm_1=require(_0x5c74b0(0x199)),bcrypt=require('bcryptjs'),os=require('os'),typeorm_2=require(_0x5c74b0(0x15c)),config_entity_1=require(_0x5c74b0(0x149)),mailer_service_1=require(_0x5c74b0(0x159)),redisCache_service_1=require(_0x5c74b0(0x138)),user_service_1=require(_0x5c74b0(0x16c)),userBalance_service_1=require(_0x5c74b0(0x1b9)),verification_service_1=require('./../verification/verification.service');function _0x40ba(){const _0x133df0=['__metadata','UNAUTHORIZED','密码修改成功','../user/user.service','verifyUserCredentials','当前手机号已注册，请勿重复注册！','../globalConfig/globalConfig.service','user','__decorate','验证码错误:\x20','完成新用户余额处理','Contact:\x20','秒内不得重复发送验证码！','error','updateUserPhone','hashSync','请输入验证码','authService','用户凭证验证成功，用户ID:\x20','defineProperty',',\x20期望的验证码:\x20','获取默认用户头像...','27aMbEFp','124286bZgYYO','HttpStatus','createRandomCode','开始用户登录流程，用户名:\x20','noVerifyRegister','@nestjs/jwt',':CODE:','验证过程出现错误','noVerifyRegister:\x20','486316tSCskv','del','登录失败，用户凭证无效。','createUser','getUserByContact','当前邮箱已注册，请勿重复注册！','Repository','getClientIp','status','Retrieved\x20redisCode\x20for\x20','visitor','verifyUserRegister','JWT令牌生成成功\x20-\x20用户ID:\x20','实名认证结果:\x20','updateUserPassword','password','@nestjs/typeorm','getOwnPropertyDescriptor','../../common/utils','272474rhZooJ','metadata',',\x20isPhone:\x20','get','身份验证错误，请检查实名信息','userService','test','UserService','onModuleInit','decorate','NOT_FOUND','updatePassword','loginWithCaptcha','loginByOpenId','976476FLVeCF','sign','开始手机号认证流程','verificationService','用户名已存在！','用户不存在，请先注册！','844344lSwDOX','forEach',',\x20用户名:\x20','Email\x20','getInfo','验证码发送成功、请填写验证码完成',':RATE_LIMIT:','savaLoginIp','ConfigEntity','../userBalance/userBalance.service','HttpException','set','\x20is\x20available:\x20','保存新用户到数据库...','../../common/constants/user.constant','__esModule','BAD_REQUEST','debug','globalConfigService','\x20-\x20用户ID:\x20','@visitor.com','验证码过期:\x20','avatar','\x20输入的验证码:\x20','RedisCacheService','userDefautlAvatar','12707920WwLacM','请提供有效的邮箱地址或手机号码。','TOO_MANY_REQUESTS','log','UserStatusErrMsg','sendMail','getUserInfo','userBalanceService','saveToken','VerificationService','getIp','../redisCache/redisCache.service','MailerService','username','length',',\x20isEmail:\x20','127.0.0.1','ttl','Logger','令牌已保存到Redis\x20-\x20用户ID:\x20','internal','用户创建成功，用户ID:\x20','保存登录IP:\x20','redisCacheService','ipAddress','sendPhoneCode','jwtService','开始实名认证流程','../globalConfig/config.entity','5581660gXXVGD','认证成功','design:paramtypes','function','认证失败，请检查相关信息','@nestjs/common','Injectable','ACTIVE','verifyPhoneIdentity','addBalanceToNewUser','AuthService','address','Checking\x20if\x20username\x20','GlobalConfigService','14jmJtzV','../mailer/mailer.service','该邮箱未注册，请先注册！','验证码已过期，请重新发送！','typeorm','getConfigs','身份验证错误，请检查相关信息','UserStatusEnum','3ZFxueb','createRandomUid','login','mailerService','verifyIdentity','getNamespace','Phone\x20','今日发送验证码次数已达上限，请24小时后再试！','加密用户密码...'];_0x40ba=function(){return _0x133df0;};return _0x40ba();}function _0x471d(_0x501fce,_0x3d653f){const _0x40ba97=_0x40ba();return _0x471d=function(_0x471dee,_0x49932d){_0x471dee=_0x471dee-0x132;let _0x47106d=_0x40ba97[_0x471dee];return _0x47106d;},_0x471d(_0x501fce,_0x3d653f);}let AuthService=class AuthService{constructor(_0x2471cc,_0x12f3a5,_0x204e7c,_0x31404a,_0x3b8cf7,_0x4d8322,_0xb965e6,_0x50a9cb){const _0x153934=_0x5c74b0;this['configEntity']=_0x2471cc,this[_0x153934(0x1a1)]=_0x12f3a5,this[_0x153934(0x147)]=_0x204e7c,this[_0x153934(0x163)]=_0x31404a,this[_0x153934(0x1ad)]=_0x3b8cf7,this[_0x153934(0x134)]=_0x4d8322,this[_0x153934(0x144)]=_0xb965e6,this['globalConfigService']=_0x50a9cb;}async[_0x5c74b0(0x1a4)](){const _0xb67f62=_0x5c74b0;this[_0xb67f62(0x137)]();}async['register'](_0x341cc7,_0x15f72c){const _0x432ff4=_0x5c74b0,{password:_0x4022bd,contact:_0xae79e4,code:_0x5b2d27}=_0x341cc7;let _0x1ded09='',_0x302790='';const _0x4caafe=/\S+@\S+\.\S+/['test'](_0xae79e4),_0x39d0f7=/^\d{10,}$/[_0x432ff4(0x1a2)](_0xae79e4);common_1[_0x432ff4(0x13f)][_0x432ff4(0x1c1)](_0x432ff4(0x174)+_0xae79e4+_0x432ff4(0x13c)+_0x4caafe+_0x432ff4(0x19e)+_0x39d0f7);let _0x232676=(0x0,utils_1[_0x432ff4(0x161)])();while(!![]){const _0x3ba547=await this[_0x432ff4(0x1a1)][_0x432ff4(0x194)]({'username':_0x232676});common_1[_0x432ff4(0x13f)][_0x432ff4(0x1c1)](_0x432ff4(0x156)+_0x232676+'\x20is\x20taken:\x20'+_0x3ba547);if(_0x3ba547)break;_0x232676=(0x0,utils_1[_0x432ff4(0x161)])();}if(_0x4caafe){_0x1ded09=_0xae79e4;const _0x32d93d=await this[_0x432ff4(0x1a1)][_0x432ff4(0x194)]({'username':_0x232676,'email':_0x1ded09});common_1['Logger'][_0x432ff4(0x1c1)](_0x432ff4(0x1b3)+_0x1ded09+_0x432ff4(0x1bc)+_0x32d93d);if(!_0x32d93d)throw new common_1[(_0x432ff4(0x1ba))](_0x432ff4(0x18e),common_1[_0x432ff4(0x181)][_0x432ff4(0x1c0)]);}else{if(_0x39d0f7){_0x302790=_0xae79e4;const _0x1e762e=await this['userService']['verifyUserRegister']({'username':_0x232676,'phone':_0x302790});common_1[_0x432ff4(0x13f)][_0x432ff4(0x1c1)](_0x432ff4(0x166)+_0x302790+_0x432ff4(0x1bc)+_0x1e762e);if(!_0x1e762e)throw new common_1[(_0x432ff4(0x1ba))](_0x432ff4(0x16e),common_1[_0x432ff4(0x181)][_0x432ff4(0x1c0)]);}else throw new common_1[(_0x432ff4(0x1ba))](_0x432ff4(0x1cb),common_1['HttpStatus']['BAD_REQUEST']);}const _0x3f9941=await this[_0x432ff4(0x1c2)][_0x432ff4(0x15d)]([_0x432ff4(0x184)]);common_1['Logger'][_0x432ff4(0x1c1)](_0x432ff4(0x188)+_0x3f9941);if(_0x3f9941!=='1'){const _0x8b006d=await this[_0x432ff4(0x1c2)][_0x432ff4(0x165)](),_0x555b3d=_0x8b006d+':CODE:'+_0xae79e4,_0x3de54a=await this[_0x432ff4(0x144)][_0x432ff4(0x19f)]({'key':_0x555b3d});common_1[_0x432ff4(0x13f)][_0x432ff4(0x1c1)](_0x432ff4(0x192)+_0xae79e4+':\x20'+_0x3de54a);if(_0x5b2d27==='')throw new common_1['HttpException']('请输入验证码',common_1['HttpStatus'][_0x432ff4(0x1c0)]);if(!_0x3de54a){common_1[_0x432ff4(0x13f)][_0x432ff4(0x1cd)](_0x432ff4(0x1c5)+_0xae79e4,_0x432ff4(0x17a));throw new common_1[(_0x432ff4(0x1ba))](_0x432ff4(0x15b),common_1[_0x432ff4(0x181)][_0x432ff4(0x1c0)]);}if(_0x5b2d27!==_0x3de54a){common_1[_0x432ff4(0x13f)][_0x432ff4(0x1cd)](_0x432ff4(0x172)+_0xae79e4+_0x432ff4(0x1c7)+_0x5b2d27+',\x20期望的验证码:\x20'+_0x3de54a,'authService');throw new common_1[(_0x432ff4(0x1ba))]('验证码填写错误，请重新输入！',common_1['HttpStatus']['BAD_REQUEST']);}}let _0x574b60;if(_0x4caafe)_0x574b60={'username':_0x232676,'password':_0x4022bd,'email':_0xae79e4,'status':user_constant_1[_0x432ff4(0x15f)]['ACTIVE']};else{const _0x4b6479=(0x0,utils_1[_0x432ff4(0x161)])()+'@aiweb.com';_0x574b60={'username':_0x232676,'password':_0x4022bd,'email':_0x4b6479,'phone':_0xae79e4,'status':user_constant_1[_0x432ff4(0x15f)][_0x432ff4(0x151)]};}common_1[_0x432ff4(0x13f)][_0x432ff4(0x1c1)](_0x432ff4(0x17e));const _0x967c92=await this['globalConfigService'][_0x432ff4(0x15d)]([_0x432ff4(0x1c9)]);common_1[_0x432ff4(0x13f)][_0x432ff4(0x1c1)]('使用默认用户头像:\x20'+_0x967c92),_0x574b60[_0x432ff4(0x1c6)]=_0x967c92,common_1[_0x432ff4(0x13f)][_0x432ff4(0x1c1)](_0x432ff4(0x168));const _0xa77af7=bcrypt[_0x432ff4(0x178)](_0x4022bd,0xa);_0x574b60[_0x432ff4(0x198)]=_0xa77af7,common_1[_0x432ff4(0x13f)][_0x432ff4(0x1c1)](_0x432ff4(0x1bd));const _0x3b00fe=await this[_0x432ff4(0x1a1)][_0x432ff4(0x18c)](_0x574b60);return common_1[_0x432ff4(0x13f)][_0x432ff4(0x1c1)](_0x432ff4(0x142)+_0x3b00fe['id']),await this[_0x432ff4(0x134)][_0x432ff4(0x153)](_0x3b00fe['id']),common_1[_0x432ff4(0x13f)][_0x432ff4(0x1c1)](_0x432ff4(0x173)),{'success':!![],'message':'注册成功'};}async[_0x5c74b0(0x162)](_0x568316,_0x1c3866){const _0x31b539=_0x5c74b0;console['log'](_0x31b539(0x183)+_0x568316[_0x31b539(0x13a)]);const _0x3c3ede=await this[_0x31b539(0x1a1)][_0x31b539(0x16d)](_0x568316);if(!_0x3c3ede){console[_0x31b539(0x176)]('登录失败:\x20用户凭证无效\x20-\x20用户名:\x20'+_0x568316['username']);throw new common_1['HttpException'](_0x31b539(0x18b),common_1[_0x31b539(0x181)][_0x31b539(0x16a)]);}const {username:_0x2b6948,id:_0x5919ee,email:_0x34740b,role:_0x52ac6a,openId:_0x5ebdf4,client:_0xc4b460,phone:_0x5849b9}=_0x3c3ede;console[_0x31b539(0x1cd)](_0x31b539(0x17b)+_0x5919ee+_0x31b539(0x1b2)+_0x2b6948);const _0x36f46e=(0x0,utils_1[_0x31b539(0x190)])(_0x1c3866);await this[_0x31b539(0x1a1)][_0x31b539(0x1b7)](_0x5919ee,_0x36f46e),console['log'](_0x31b539(0x143)+_0x36f46e+_0x31b539(0x1c3)+_0x5919ee);const _0x38cb22=await this[_0x31b539(0x147)][_0x31b539(0x1ab)]({'username':_0x2b6948,'id':_0x5919ee,'email':_0x34740b,'role':_0x52ac6a,'openId':_0x5ebdf4,'client':_0xc4b460,'phone':_0x5849b9});return console[_0x31b539(0x1cd)](_0x31b539(0x195)+_0x5919ee),await this[_0x31b539(0x144)][_0x31b539(0x135)](_0x5919ee,_0x38cb22),console[_0x31b539(0x1cd)](_0x31b539(0x140)+_0x5919ee),_0x38cb22;}async[_0x5c74b0(0x1a8)](_0x46db52,_0x18bf8e){const _0xd4b967=_0x5c74b0,{contact:_0x2dfd83,code:_0x61233a}=_0x46db52;let _0x1c1f0d='',_0x18df0f='';const _0xf3d281=/\S+@\S+\.\S+/[_0xd4b967(0x1a2)](_0x2dfd83),_0x5e5ac1=/^\d{10,}$/['test'](_0x2dfd83);if(_0xf3d281)_0x1c1f0d=_0x2dfd83;else{if(_0x5e5ac1)_0x18df0f=_0x2dfd83;else throw new common_1[(_0xd4b967(0x1ba))](_0xd4b967(0x1cb),common_1[_0xd4b967(0x181)]['BAD_REQUEST']);}if(!![]){if(_0xf3d281){const _0x1205f8=await this[_0xd4b967(0x1a1)][_0xd4b967(0x194)]({'email':_0x2dfd83});if(_0x1205f8)throw new common_1['HttpException'](_0xd4b967(0x15a),common_1[_0xd4b967(0x181)]['BAD_REQUEST']);}else{if(_0x5e5ac1){const _0x45db98=await this[_0xd4b967(0x1a1)][_0xd4b967(0x194)]({'phone':_0x2dfd83});if(_0x45db98)throw new common_1['HttpException']('该手机号未注册，请先注册！',common_1[_0xd4b967(0x181)]['BAD_REQUEST']);}}}else{if(_0xf3d281){const _0x2b04ac=await this['userService'][_0xd4b967(0x194)]({'email':_0x2dfd83});if(!_0x2b04ac)throw new common_1[(_0xd4b967(0x1ba))]('该邮箱已注册，请直接登录！',common_1[_0xd4b967(0x181)]['BAD_REQUEST']);}else{if(_0x5e5ac1){const _0x27cd22=await this['userService']['verifyUserRegister']({'phone':_0x2dfd83});if(!_0x27cd22)throw new common_1[(_0xd4b967(0x1ba))]('该手机号已注册，请直接登录！',common_1[_0xd4b967(0x181)][_0xd4b967(0x1c0)]);}}}const _0x59dd7b=await this['globalConfigService']['getNamespace'](),_0xa2552b=_0x59dd7b+_0xd4b967(0x186)+_0x2dfd83,_0xf3fb6b=await this[_0xd4b967(0x144)][_0xd4b967(0x19f)]({'key':_0xa2552b});if(!_0xf3fb6b){common_1['Logger'][_0xd4b967(0x1cd)]('验证码过期:\x20'+_0x2dfd83,_0xd4b967(0x17a));throw new common_1[(_0xd4b967(0x1ba))](_0xd4b967(0x15b),common_1[_0xd4b967(0x181)][_0xd4b967(0x1c0)]);}if(_0xf3fb6b!==_0x61233a){common_1['Logger'][_0xd4b967(0x1cd)](_0xd4b967(0x172)+_0x2dfd83,_0xd4b967(0x17a));throw new common_1[(_0xd4b967(0x1ba))]('验证码错误，请重新输入！',common_1[_0xd4b967(0x181)]['BAD_REQUEST']);}const _0x2426cb=await this[_0xd4b967(0x1a1)][_0xd4b967(0x18d)]({'email':_0x1c1f0d,'phone':_0x18df0f});if(!_0x2426cb)throw new common_1[(_0xd4b967(0x1ba))](_0xd4b967(0x1af),common_1[_0xd4b967(0x181)][_0xd4b967(0x1a6)]);if(_0x2426cb[_0xd4b967(0x191)]!==user_constant_1['UserStatusEnum'][_0xd4b967(0x151)])throw new common_1[(_0xd4b967(0x1ba))](user_constant_1[_0xd4b967(0x1ce)][_0x2426cb[_0xd4b967(0x191)]],common_1[_0xd4b967(0x181)][_0xd4b967(0x1c0)]);const {username:_0x21859c,id:_0x55bd1f,role:_0x1a8943,openId:_0x4bbaa0,client:_0x3ce8f7}=_0x2426cb,_0x2b8cca=(0x0,utils_1['getClientIp'])(_0x18bf8e);await this['userService'][_0xd4b967(0x1b7)](_0x55bd1f,_0x2b8cca);const _0xd3c376=await this[_0xd4b967(0x147)][_0xd4b967(0x1ab)]({'username':_0x21859c,'id':_0x55bd1f,'email':_0x1c1f0d,'role':_0x1a8943,'openId':_0x4bbaa0,'client':_0x3ce8f7,'phone':_0x18df0f});return await this[_0xd4b967(0x144)]['saveToken'](_0x55bd1f,_0xd3c376),await this[_0xd4b967(0x144)][_0xd4b967(0x18a)](_0xa2552b),_0xd3c376;}async[_0x5c74b0(0x1a9)](_0x134bb3,_0x99c463){const _0x599f8b=_0x5c74b0,{status:_0x5c68af}=_0x134bb3;if(_0x5c68af!==user_constant_1[_0x599f8b(0x15f)][_0x599f8b(0x151)])throw new common_1[(_0x599f8b(0x1ba))](user_constant_1[_0x599f8b(0x1ce)][_0x5c68af],common_1[_0x599f8b(0x181)][_0x599f8b(0x1c0)]);const {username:_0x1624bc,id:_0x1f68a7,email:_0x354225,role:_0x5a9992,openId:_0x221f52,client:_0x2a6d2f}=_0x134bb3,_0x6005eb=(0x0,utils_1[_0x599f8b(0x190)])(_0x99c463);await this['userService'][_0x599f8b(0x1b7)](_0x1f68a7,_0x6005eb);const _0x4cc8f9=await this['jwtService'][_0x599f8b(0x1ab)]({'username':_0x1624bc,'id':_0x1f68a7,'email':_0x354225,'role':_0x5a9992,'openId':_0x221f52,'client':_0x2a6d2f});return await this[_0x599f8b(0x144)][_0x599f8b(0x135)](_0x1f68a7,_0x4cc8f9),_0x4cc8f9;}async[_0x5c74b0(0x1b4)](_0x156f4c){const _0x5a75fd=_0x5c74b0,{id:_0x1f68dd}=_0x156f4c[_0x5a75fd(0x170)];return await this[_0x5a75fd(0x1a1)][_0x5a75fd(0x133)](_0x1f68dd);}async[_0x5c74b0(0x1a7)](_0x103691,_0x363ab9){const _0x2dcf41=_0x5c74b0,{id:_0x5ec48d}=_0x103691['user'];return this[_0x2dcf41(0x1a1)][_0x2dcf41(0x197)](_0x5ec48d,_0x363ab9[_0x2dcf41(0x198)]),_0x2dcf41(0x16b);}['getIp'](){const _0x4916ec=_0x5c74b0;let _0x256f7c;const _0x3ae35c=os['networkInterfaces']();Object['keys'](_0x3ae35c)[_0x4916ec(0x1b1)](_0x125d5b=>{const _0xbf2216=_0x4916ec,_0x533ae5=_0x3ae35c[_0x125d5b];for(let _0x202b55=0x0;_0x202b55<_0x533ae5[_0xbf2216(0x13b)];_0x202b55++){const _0x2024c7=_0x533ae5[_0x202b55];if(_0x2024c7['family']==='IPv4'&&_0x2024c7[_0xbf2216(0x155)]!==_0xbf2216(0x13d)&&!_0x2024c7[_0xbf2216(0x141)]){_0x256f7c=_0x2024c7['address'];break;}}}),this[_0x4916ec(0x145)]=_0x256f7c;}async['sendCode'](_0x3f10dd){const _0x799145=_0x5c74b0,{contact:_0x53242e,isLogin:_0x362111}=_0x3f10dd,_0x319188=(0x0,utils_1[_0x799145(0x182)])(),_0xc96803=/\S+@\S+\.\S+/[_0x799145(0x1a2)](_0x53242e),_0x177d05=/^1\d{10}$/[_0x799145(0x1a2)](_0x53242e);if(!_0xc96803&&!_0x177d05)throw new common_1['HttpException'](_0x799145(0x1cb),common_1[_0x799145(0x181)][_0x799145(0x1c0)]);if(_0x362111){if(_0xc96803){const _0x342f64=await this['userService'][_0x799145(0x194)]({'email':_0x53242e});if(_0x342f64)throw new common_1[(_0x799145(0x1ba))]('该邮箱未注册，请先注册！',common_1[_0x799145(0x181)][_0x799145(0x1c0)]);}else{if(_0x177d05){const _0x43235e=await this['userService']['verifyUserRegister']({'phone':_0x53242e});if(_0x43235e)throw new common_1[(_0x799145(0x1ba))]('该手机号未注册，请先注册！',common_1[_0x799145(0x181)][_0x799145(0x1c0)]);}}}else{if(_0xc96803){const _0x10049d=await this[_0x799145(0x1a1)][_0x799145(0x194)]({'email':_0x53242e});if(!_0x10049d)throw new common_1[(_0x799145(0x1ba))]('该邮箱已注册，请直接登录！',common_1[_0x799145(0x181)]['BAD_REQUEST']);}else{if(_0x177d05){const _0x1ff299=await this[_0x799145(0x1a1)][_0x799145(0x194)]({'phone':_0x53242e});if(!_0x1ff299)throw new common_1[(_0x799145(0x1ba))]('该手机号已注册，请直接登录！',common_1[_0x799145(0x181)][_0x799145(0x1c0)]);}}}const _0x2d2ffb=await this['globalConfigService'][_0x799145(0x165)](),_0x32c35e=_0x2d2ffb+_0x799145(0x186)+_0x53242e,_0x4642aa=_0x2d2ffb+_0x799145(0x1b6)+_0x53242e,_0x34b693=await this[_0x799145(0x144)][_0x799145(0x13e)](_0x32c35e);if(_0x34b693&&_0x34b693>0x0)throw new common_1['HttpException'](_0x34b693+_0x799145(0x175),common_1[_0x799145(0x181)]['BAD_REQUEST']);const _0x100683=await this[_0x799145(0x144)][_0x799145(0x19f)]({'key':_0x4642aa})||0x0;if(_0x100683>=0xa)throw new common_1['HttpException'](_0x799145(0x167),common_1[_0x799145(0x181)][_0x799145(0x1cc)]);if(_0xc96803)await this[_0x799145(0x163)][_0x799145(0x132)]({'to':_0x53242e,'context':{'code':_0x319188}});else{if(_0x177d05){const _0x14e8b5={'phone':_0x53242e,'code':_0x319188};await this[_0x799145(0x1ad)][_0x799145(0x146)](_0x14e8b5);}}return await this[_0x799145(0x144)][_0x799145(0x1bb)]({'key':_0x32c35e,'val':_0x319188},0x5*0x3c),await this[_0x799145(0x144)]['set']({'key':_0x4642aa,'val':Number(_0x100683)+0x1},0x18*0x3c*0x3c),await this['redisCacheService'][_0x799145(0x1bb)]({'key':_0x32c35e,'val':_0x319188},0x3c),_0x799145(0x1b5)+(_0x362111?'注册':'验证')+'！';}['createTokenFromFingerprint'](_0x36e2b5){const _0x56249b=_0x5c74b0,_0x5b35ff=this[_0x56249b(0x147)][_0x56249b(0x1ab)]({'username':'游客'+_0x36e2b5,'id':_0x36e2b5,'email':_0x36e2b5+_0x56249b(0x1c4),'role':_0x56249b(0x193),'openId':null,'client':null});return _0x5b35ff;}async[_0x5c74b0(0x164)](_0x483777,_0x4da4b4){const _0x2b66c8=_0x5c74b0;common_1[_0x2b66c8(0x13f)]['debug'](_0x2b66c8(0x148));const {name:_0x41c41c,idCard:_0x3b597d}=_0x4da4b4,{id:_0x3d1836}=_0x483777[_0x2b66c8(0x170)];try{const _0x1449d9=await this[_0x2b66c8(0x1ad)][_0x2b66c8(0x164)](_0x4da4b4);common_1[_0x2b66c8(0x13f)][_0x2b66c8(0x1c1)](_0x2b66c8(0x196)+_0x1449d9);if(!_0x1449d9)throw new common_1[(_0x2b66c8(0x1ba))](_0x2b66c8(0x1a0),common_1[_0x2b66c8(0x181)][_0x2b66c8(0x1c0)]);return await this[_0x2b66c8(0x1a1)]['saveRealNameInfo'](_0x3d1836,_0x41c41c,_0x3b597d),_0x2b66c8(0x14b);}catch(_0x47db60){common_1[_0x2b66c8(0x13f)][_0x2b66c8(0x176)](_0x2b66c8(0x187),_0x47db60);throw new common_1[(_0x2b66c8(0x1ba))](_0x2b66c8(0x14e),common_1['HttpStatus'][_0x2b66c8(0x1c0)]);}}async[_0x5c74b0(0x152)](_0x18b58a,_0x4367cf){const _0x3c08b5=_0x5c74b0;common_1['Logger'][_0x3c08b5(0x1c1)](_0x3c08b5(0x1ac));const {phone:_0x37b2ca,username:_0x5e9d33,password:_0x15ca7a,code:_0x25532c}=_0x4367cf,{id:_0x12e89c}=_0x18b58a[_0x3c08b5(0x170)],_0x38b397=this[_0x3c08b5(0x1c2)][_0x3c08b5(0x165)](),_0xb8bdb9=_0x38b397+':CODE:'+_0x37b2ca,_0x5e5756=await this['redisCacheService']['get']({'key':_0xb8bdb9});common_1['Logger']['debug'](_0x3c08b5(0x192)+_0x37b2ca+':\x20'+_0x5e5756);if(_0x25532c==='')throw new common_1['HttpException'](_0x3c08b5(0x179),common_1[_0x3c08b5(0x181)][_0x3c08b5(0x1c0)]);if(!_0x5e5756){common_1[_0x3c08b5(0x13f)][_0x3c08b5(0x1cd)]('验证码过期:\x20'+_0x37b2ca,_0x3c08b5(0x17a));throw new common_1[(_0x3c08b5(0x1ba))](_0x3c08b5(0x15b),common_1[_0x3c08b5(0x181)][_0x3c08b5(0x1c0)]);}if(_0x25532c!==_0x5e5756){common_1[_0x3c08b5(0x13f)][_0x3c08b5(0x1cd)]('验证码错误:\x20'+_0x37b2ca+_0x3c08b5(0x1c7)+_0x25532c+_0x3c08b5(0x17d)+_0x5e5756,_0x3c08b5(0x17a));throw new common_1[(_0x3c08b5(0x1ba))]('验证码填写错误，请重新输入！',common_1[_0x3c08b5(0x181)][_0x3c08b5(0x1c0)]);}if(_0x5e9d33){const _0x2bc8ee=await this[_0x3c08b5(0x1a1)]['isUsernameTaken'](_0x4367cf[_0x3c08b5(0x13a)],_0x12e89c);if(_0x2bc8ee)throw new common_1[(_0x3c08b5(0x1ba))](_0x3c08b5(0x1ae),common_1[_0x3c08b5(0x181)][_0x3c08b5(0x1c0)]);}try{return await this[_0x3c08b5(0x1a1)][_0x3c08b5(0x177)](_0x12e89c,_0x37b2ca,_0x5e9d33,_0x15ca7a),_0x3c08b5(0x14b);}catch(_0x2ad4b9){common_1[_0x3c08b5(0x13f)][_0x3c08b5(0x176)](_0x3c08b5(0x187),_0x2ad4b9);throw new common_1[(_0x3c08b5(0x1ba))](_0x3c08b5(0x15e),common_1['HttpStatus'][_0x3c08b5(0x1c0)]);}}};AuthService=__decorate([(0x0,common_1[_0x5c74b0(0x150)])(),__param(0x0,(0x0,typeorm_1['InjectRepository'])(config_entity_1[_0x5c74b0(0x1b8)])),__metadata(_0x5c74b0(0x14c),[typeorm_2[_0x5c74b0(0x18f)],user_service_1[_0x5c74b0(0x1a3)],jwt_1['JwtService'],mailer_service_1[_0x5c74b0(0x139)],verification_service_1[_0x5c74b0(0x136)],userBalance_service_1['UserBalanceService'],redisCache_service_1[_0x5c74b0(0x1c8)],globalConfig_service_1[_0x5c74b0(0x157)]])],AuthService),exports[_0x5c74b0(0x154)]=AuthService;