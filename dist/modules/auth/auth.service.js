'use strict';const _0x194b86=_0x34bb;(function(_0x400e20,_0x551914){const _0x1c2315=_0x34bb,_0x13efae=_0x400e20();while(!![]){try{const _0x4206b1=parseInt(_0x1c2315(0xd4))/0x1*(parseInt(_0x1c2315(0x117))/0x2)+-parseInt(_0x1c2315(0xbf))/0x3+parseInt(_0x1c2315(0x132))/0x4*(parseInt(_0x1c2315(0x122))/0x5)+-parseInt(_0x1c2315(0x14c))/0x6*(parseInt(_0x1c2315(0xd5))/0x7)+-parseInt(_0x1c2315(0xc3))/0x8+-parseInt(_0x1c2315(0xf0))/0x9+parseInt(_0x1c2315(0x14b))/0xa;if(_0x4206b1===_0x551914)break;else _0x13efae['push'](_0x13efae['shift']());}catch(_0x133bce){_0x13efae['push'](_0x13efae['shift']());}}}(_0x53c6,0x91a09));var __decorate=this&&this['__decorate']||function(_0x1a7615,_0x5ccde0,_0xad6e0e,_0x5ecfea){const _0x1dc420=_0x34bb;var _0xbc4339=arguments[_0x1dc420(0xcb)],_0x455ff4=_0xbc4339<0x3?_0x5ccde0:_0x5ecfea===null?_0x5ecfea=Object[_0x1dc420(0xe9)](_0x5ccde0,_0xad6e0e):_0x5ecfea,_0x3c4a9f;if(typeof Reflect===_0x1dc420(0x12d)&&typeof Reflect['decorate']==='function')_0x455ff4=Reflect[_0x1dc420(0x126)](_0x1a7615,_0x5ccde0,_0xad6e0e,_0x5ecfea);else{for(var _0x161076=_0x1a7615[_0x1dc420(0xcb)]-0x1;_0x161076>=0x0;_0x161076--)if(_0x3c4a9f=_0x1a7615[_0x161076])_0x455ff4=(_0xbc4339<0x3?_0x3c4a9f(_0x455ff4):_0xbc4339>0x3?_0x3c4a9f(_0x5ccde0,_0xad6e0e,_0x455ff4):_0x3c4a9f(_0x5ccde0,_0xad6e0e))||_0x455ff4;}return _0xbc4339>0x3&&_0x455ff4&&Object[_0x1dc420(0x131)](_0x5ccde0,_0xad6e0e,_0x455ff4),_0x455ff4;},__metadata=this&&this[_0x194b86(0x125)]||function(_0x1f432f,_0x246e94){const _0x13e188=_0x194b86;if(typeof Reflect===_0x13e188(0x12d)&&typeof Reflect[_0x13e188(0x12f)]==='function')return Reflect['metadata'](_0x1f432f,_0x246e94);},__param=this&&this[_0x194b86(0xdc)]||function(_0x4da7cf,_0x3014ce){return function(_0x44f376,_0x4c73a1){_0x3014ce(_0x44f376,_0x4c73a1,_0x4da7cf);};};function _0x53c6(){const _0x26efa4=['updateUserPhone','username','请输入验证码','保存新用户到数据库...',':CODE:','\x20输入的验证码:\x20','VerificationService','AuthService','14498120GSFfqC','6UGdMhD','user','../mailer/mailer.service','@visitor.com','createUser','authService','test','login','开始用户登录流程，用户名:\x20',':RATE_LIMIT:','noVerifyRegister:\x20','该手机号已注册，请直接登录！','用户凭证验证成功，用户ID:\x20','del','updatePassword','2516991ioFMUx','该邮箱未注册，请先注册！','BAD_REQUEST','addBalanceToNewUser','1791048iVIBQq','savaLoginIp','internal','__esModule','noVerifyRegister','set','globalConfigService','验证码发送成功、请填写验证码完成','length','forEach','getConfigs','family','\x20is\x20available:\x20','sign','UserBalanceService','IPv4','HttpStatus','3OryuKN','6242341popTVR','NOT_FOUND','获取默认用户头像...','\x20is\x20taken:\x20','loginWithCaptcha','UNAUTHORIZED','keys','__param','Email\x20',',\x20isPhone:\x20','实名认证结果:\x20','onModuleInit','JwtService','Injectable','verifyUserCredentials','ACTIVE','RedisCacheService','sendMail','验证码错误:\x20','redisCacheService','getOwnPropertyDescriptor','验证码填写错误，请重新输入！','用户不存在，请先注册！','@aiweb.com','令牌已保存到Redis\x20-\x20用户ID:\x20','今日发送验证码次数已达上限，请24小时后再试！','UserStatusEnum','3572496eJqOIp','@nestjs/typeorm','../user/user.service','design:paramtypes','createRandomUid','debug','sendPhoneCode','使用默认用户头像:\x20','认证成功','开始手机号认证流程','getClientIp','@nestjs/jwt','saveToken','networkInterfaces','../redisCache/redisCache.service','userService','开始实名认证流程','ttl','Logger','HttpException','JWT令牌生成成功\x20-\x20用户ID:\x20','../globalConfig/globalConfig.service','typeorm','verifyIdentity','verificationService','TOO_MANY_REQUESTS','isUsernameTaken','error','userDefautlAvatar','createRandomCode',',\x20期望的验证码:\x20','身份验证错误，请检查相关信息','验证码已过期，请重新发送！','秒内不得重复发送验证码！','登录失败:\x20用户凭证无效\x20-\x20用户名:\x20','getIp','该邮箱已注册，请直接登录！','127.0.0.1','\x20-\x20用户ID:\x20','463306pMarES',',\x20用户名:\x20','UserStatusErrMsg','createTokenFromFingerprint','jwtService','加密用户密码...','InjectRepository','完成新用户余额处理','验证码过期:\x20','../globalConfig/config.entity','验证过程出现错误','5cYSHWh','@nestjs/common','hashSync','__metadata','decorate','status','ConfigEntity','password','verifyUserRegister','get','avatar','object','请提供有效的邮箱地址或手机号码。','metadata','ipAddress','defineProperty','3213212YDQGwV','log','updateUserPassword','./../verification/verification.service','mailerService','userBalanceService','身份验证错误，请检查实名信息','getUserByContact','密码修改成功','UserService','GlobalConfigService','address','configEntity','getNamespace','认证失败，请检查相关信息','register','Repository'];_0x53c6=function(){return _0x26efa4;};return _0x53c6();}Object[_0x194b86(0x131)](exports,_0x194b86(0xc6),{'value':!![]}),exports[_0x194b86(0x14a)]=void 0x0;function _0x34bb(_0xa7400d,_0x219eb2){const _0x53c6eb=_0x53c6();return _0x34bb=function(_0x34bbd2,_0x694c9d){_0x34bbd2=_0x34bbd2-0xbb;let _0x73c9b6=_0x53c6eb[_0x34bbd2];return _0x73c9b6;},_0x34bb(_0xa7400d,_0x219eb2);}const user_constant_1=require('../../common/constants/user.constant'),utils_1=require('../../common/utils'),globalConfig_service_1=require(_0x194b86(0x105)),common_1=require(_0x194b86(0x123)),jwt_1=require(_0x194b86(0xfb)),typeorm_1=require(_0x194b86(0xf1)),bcrypt=require('bcryptjs'),os=require('os'),typeorm_2=require(_0x194b86(0x106)),config_entity_1=require(_0x194b86(0x120)),mailer_service_1=require(_0x194b86(0x14e)),redisCache_service_1=require(_0x194b86(0xfe)),user_service_1=require(_0x194b86(0xf2)),userBalance_service_1=require('../userBalance/userBalance.service'),verification_service_1=require(_0x194b86(0x135));let AuthService=class AuthService{constructor(_0x5e0dec,_0x397b29,_0x11401d,_0x2ce7cf,_0xcbd0bc,_0x465b4d,_0x9af9ac,_0x5cf7bb){const _0x1ea75d=_0x194b86;this[_0x1ea75d(0x13e)]=_0x5e0dec,this['userService']=_0x397b29,this[_0x1ea75d(0x11b)]=_0x11401d,this[_0x1ea75d(0x136)]=_0x2ce7cf,this[_0x1ea75d(0x108)]=_0xcbd0bc,this[_0x1ea75d(0x137)]=_0x465b4d,this[_0x1ea75d(0xe8)]=_0x9af9ac,this['globalConfigService']=_0x5cf7bb;}async[_0x194b86(0xe0)](){const _0xd90e57=_0x194b86;this[_0xd90e57(0x113)]();}async[_0x194b86(0x141)](_0x1ba650,_0x54a1fa){const _0x37be08=_0x194b86,{password:_0x47d2c6,contact:_0xb1dbb,code:_0x4e250f}=_0x1ba650;let _0x188068='',_0x50745d='';const _0x2c1289=/\S+@\S+\.\S+/['test'](_0xb1dbb),_0x264e96=/^\d{10,}$/['test'](_0xb1dbb);common_1['Logger']['debug']('Contact:\x20'+_0xb1dbb+',\x20isEmail:\x20'+_0x2c1289+_0x37be08(0xde)+_0x264e96);let _0xa8e4c4=(0x0,utils_1['createRandomUid'])();while(!![]){const _0x535060=await this[_0x37be08(0xff)][_0x37be08(0x12a)]({'username':_0xa8e4c4});common_1[_0x37be08(0x102)][_0x37be08(0xf5)]('Checking\x20if\x20username\x20'+_0xa8e4c4+_0x37be08(0xd8)+_0x535060);if(_0x535060)break;_0xa8e4c4=(0x0,utils_1[_0x37be08(0xf4)])();}if(_0x2c1289){_0x188068=_0xb1dbb;const _0x15bd9a=await this[_0x37be08(0xff)][_0x37be08(0x12a)]({'username':_0xa8e4c4,'email':_0x188068});common_1[_0x37be08(0x102)][_0x37be08(0xf5)](_0x37be08(0xdd)+_0x188068+_0x37be08(0xcf)+_0x15bd9a);if(!_0x15bd9a)throw new common_1[(_0x37be08(0x103))]('当前邮箱已注册，请勿重复注册！',common_1['HttpStatus']['BAD_REQUEST']);}else{if(_0x264e96){_0x50745d=_0xb1dbb;const _0x5c1c0e=await this['userService'][_0x37be08(0x12a)]({'username':_0xa8e4c4,'phone':_0x50745d});common_1[_0x37be08(0x102)][_0x37be08(0xf5)]('Phone\x20'+_0x50745d+'\x20is\x20available:\x20'+_0x5c1c0e);if(!_0x5c1c0e)throw new common_1[(_0x37be08(0x103))]('当前手机号已注册，请勿重复注册！',common_1[_0x37be08(0xd3)]['BAD_REQUEST']);}else throw new common_1[(_0x37be08(0x103))](_0x37be08(0x12e),common_1[_0x37be08(0xd3)]['BAD_REQUEST']);}const _0xa2aca2=await this[_0x37be08(0xc9)][_0x37be08(0xcd)]([_0x37be08(0xc7)]);common_1[_0x37be08(0x102)][_0x37be08(0xf5)](_0x37be08(0x156)+_0xa2aca2);if(_0xa2aca2!=='1'){const _0x534551=await this[_0x37be08(0xc9)][_0x37be08(0x13f)](),_0x18bc17=_0x534551+_0x37be08(0x147)+_0xb1dbb,_0x54ea39=await this[_0x37be08(0xe8)][_0x37be08(0x12b)]({'key':_0x18bc17});common_1[_0x37be08(0x102)][_0x37be08(0xf5)]('Retrieved\x20redisCode\x20for\x20'+_0xb1dbb+':\x20'+_0x54ea39);if(_0x4e250f==='')throw new common_1['HttpException']('请输入验证码',common_1['HttpStatus'][_0x37be08(0xc1)]);if(!_0x54ea39){common_1[_0x37be08(0x102)][_0x37be08(0x133)](_0x37be08(0x11f)+_0xb1dbb,'authService');throw new common_1[(_0x37be08(0x103))]('验证码已过期，请重新发送！',common_1[_0x37be08(0xd3)][_0x37be08(0xc1)]);}if(_0x4e250f!==_0x54ea39){common_1[_0x37be08(0x102)][_0x37be08(0x133)](_0x37be08(0xe7)+_0xb1dbb+_0x37be08(0x148)+_0x4e250f+_0x37be08(0x10e)+_0x54ea39,'authService');throw new common_1[(_0x37be08(0x103))](_0x37be08(0xea),common_1[_0x37be08(0xd3)][_0x37be08(0xc1)]);}}let _0x3c10fe;if(_0x2c1289)_0x3c10fe={'username':_0xa8e4c4,'password':_0x47d2c6,'email':_0xb1dbb,'status':user_constant_1['UserStatusEnum'][_0x37be08(0xe4)]};else{const _0x5e13df=(0x0,utils_1[_0x37be08(0xf4)])()+_0x37be08(0xec);_0x3c10fe={'username':_0xa8e4c4,'password':_0x47d2c6,'email':_0x5e13df,'phone':_0xb1dbb,'status':user_constant_1[_0x37be08(0xef)][_0x37be08(0xe4)]};}common_1[_0x37be08(0x102)][_0x37be08(0xf5)](_0x37be08(0xd7));const _0x3938e3=await this['globalConfigService'][_0x37be08(0xcd)]([_0x37be08(0x10c)]);common_1['Logger'][_0x37be08(0xf5)](_0x37be08(0xf7)+_0x3938e3),_0x3c10fe[_0x37be08(0x12c)]=_0x3938e3,common_1[_0x37be08(0x102)][_0x37be08(0xf5)](_0x37be08(0x11c));const _0x363748=bcrypt[_0x37be08(0x124)](_0x47d2c6,0xa);_0x3c10fe[_0x37be08(0x129)]=_0x363748,common_1[_0x37be08(0x102)][_0x37be08(0xf5)](_0x37be08(0x146));const _0x4e32ed=await this['userService'][_0x37be08(0x150)](_0x3c10fe);return common_1['Logger'][_0x37be08(0xf5)]('用户创建成功，用户ID:\x20'+_0x4e32ed['id']),await this[_0x37be08(0x137)][_0x37be08(0xc2)](_0x4e32ed['id']),common_1['Logger']['debug'](_0x37be08(0x11e)),{'success':!![],'message':'注册成功'};}async[_0x194b86(0x153)](_0x5ee821,_0x2e2f03){const _0x12f56b=_0x194b86;console[_0x12f56b(0x133)](_0x12f56b(0x154)+_0x5ee821[_0x12f56b(0x144)]);const _0x58faf9=await this[_0x12f56b(0xff)][_0x12f56b(0xe3)](_0x5ee821);if(!_0x58faf9){console[_0x12f56b(0x10b)](_0x12f56b(0x112)+_0x5ee821[_0x12f56b(0x144)]);throw new common_1['HttpException']('登录失败，用户凭证无效。',common_1[_0x12f56b(0xd3)][_0x12f56b(0xda)]);}const {username:_0x413efe,id:_0x587f8c,email:_0x277b07,role:_0x89ea70,openId:_0x428fce,client:_0x312bce,phone:_0x53de5e}=_0x58faf9;console[_0x12f56b(0x133)](_0x12f56b(0xbc)+_0x587f8c+_0x12f56b(0x118)+_0x413efe);const _0x69c1bd=(0x0,utils_1[_0x12f56b(0xfa)])(_0x2e2f03);await this[_0x12f56b(0xff)][_0x12f56b(0xc4)](_0x587f8c,_0x69c1bd),console[_0x12f56b(0x133)]('保存登录IP:\x20'+_0x69c1bd+_0x12f56b(0x116)+_0x587f8c);const _0x3325e9=await this['jwtService'][_0x12f56b(0xd0)]({'username':_0x413efe,'id':_0x587f8c,'email':_0x277b07,'role':_0x89ea70,'openId':_0x428fce,'client':_0x312bce,'phone':_0x53de5e});return console[_0x12f56b(0x133)](_0x12f56b(0x104)+_0x587f8c),await this[_0x12f56b(0xe8)]['saveToken'](_0x587f8c,_0x3325e9),console['log'](_0x12f56b(0xed)+_0x587f8c),_0x3325e9;}async[_0x194b86(0xd9)](_0x372ca1,_0x5219cb){const _0x27e3f4=_0x194b86,{contact:_0x4fcca3,code:_0x5c70a1}=_0x372ca1;let _0x3c03e3='',_0x1ab94b='';const _0x254e5e=/\S+@\S+\.\S+/[_0x27e3f4(0x152)](_0x4fcca3),_0x27626c=/^\d{10,}$/['test'](_0x4fcca3);if(_0x254e5e)_0x3c03e3=_0x4fcca3;else{if(_0x27626c)_0x1ab94b=_0x4fcca3;else throw new common_1['HttpException'](_0x27e3f4(0x12e),common_1[_0x27e3f4(0xd3)][_0x27e3f4(0xc1)]);}if(!![]){if(_0x254e5e){const _0xe754e3=await this[_0x27e3f4(0xff)][_0x27e3f4(0x12a)]({'email':_0x4fcca3});if(_0xe754e3)throw new common_1[(_0x27e3f4(0x103))](_0x27e3f4(0xc0),common_1[_0x27e3f4(0xd3)][_0x27e3f4(0xc1)]);}else{if(_0x27626c){const _0x49a045=await this[_0x27e3f4(0xff)]['verifyUserRegister']({'phone':_0x4fcca3});if(_0x49a045)throw new common_1[(_0x27e3f4(0x103))]('该手机号未注册，请先注册！',common_1[_0x27e3f4(0xd3)][_0x27e3f4(0xc1)]);}}}else{if(_0x254e5e){const _0x2f5203=await this['userService'][_0x27e3f4(0x12a)]({'email':_0x4fcca3});if(!_0x2f5203)throw new common_1[(_0x27e3f4(0x103))](_0x27e3f4(0x114),common_1['HttpStatus']['BAD_REQUEST']);}else{if(_0x27626c){const _0x4926cb=await this['userService'][_0x27e3f4(0x12a)]({'phone':_0x4fcca3});if(!_0x4926cb)throw new common_1[(_0x27e3f4(0x103))](_0x27e3f4(0xbb),common_1['HttpStatus'][_0x27e3f4(0xc1)]);}}}const _0x257b8b=await this[_0x27e3f4(0xc9)]['getNamespace'](),_0x27a90a=_0x257b8b+_0x27e3f4(0x147)+_0x4fcca3,_0x183ff6=await this[_0x27e3f4(0xe8)]['get']({'key':_0x27a90a});if(!_0x183ff6){common_1[_0x27e3f4(0x102)]['log'](_0x27e3f4(0x11f)+_0x4fcca3,'authService');throw new common_1[(_0x27e3f4(0x103))](_0x27e3f4(0x110),common_1['HttpStatus'][_0x27e3f4(0xc1)]);}if(_0x183ff6!==_0x5c70a1){common_1['Logger'][_0x27e3f4(0x133)](_0x27e3f4(0xe7)+_0x4fcca3,_0x27e3f4(0x151));throw new common_1[(_0x27e3f4(0x103))]('验证码错误，请重新输入！',common_1[_0x27e3f4(0xd3)][_0x27e3f4(0xc1)]);}const _0x1cc629=await this[_0x27e3f4(0xff)][_0x27e3f4(0x139)]({'email':_0x3c03e3,'phone':_0x1ab94b});if(!_0x1cc629)throw new common_1[(_0x27e3f4(0x103))](_0x27e3f4(0xeb),common_1['HttpStatus'][_0x27e3f4(0xd6)]);if(_0x1cc629[_0x27e3f4(0x127)]!==user_constant_1[_0x27e3f4(0xef)][_0x27e3f4(0xe4)])throw new common_1[(_0x27e3f4(0x103))](user_constant_1[_0x27e3f4(0x119)][_0x1cc629[_0x27e3f4(0x127)]],common_1[_0x27e3f4(0xd3)][_0x27e3f4(0xc1)]);const {username:_0x455f4b,id:_0x4158e3,role:_0x20af9e,openId:_0x216907,client:_0x367533}=_0x1cc629,_0x2ba469=(0x0,utils_1['getClientIp'])(_0x5219cb);await this[_0x27e3f4(0xff)][_0x27e3f4(0xc4)](_0x4158e3,_0x2ba469);const _0x1410fe=await this[_0x27e3f4(0x11b)]['sign']({'username':_0x455f4b,'id':_0x4158e3,'email':_0x3c03e3,'role':_0x20af9e,'openId':_0x216907,'client':_0x367533,'phone':_0x1ab94b});return await this['redisCacheService'][_0x27e3f4(0xfc)](_0x4158e3,_0x1410fe),await this[_0x27e3f4(0xe8)][_0x27e3f4(0xbd)](_0x27a90a),_0x1410fe;}async['loginByOpenId'](_0x5429a,_0x4e02c6){const _0x12d4b4=_0x194b86,{status:_0x38ab7c}=_0x5429a;if(_0x38ab7c!==user_constant_1[_0x12d4b4(0xef)][_0x12d4b4(0xe4)])throw new common_1['HttpException'](user_constant_1[_0x12d4b4(0x119)][_0x38ab7c],common_1[_0x12d4b4(0xd3)][_0x12d4b4(0xc1)]);const {username:_0x4b6361,id:_0x59ecca,email:_0x3da898,role:_0x3759b3,openId:_0x84dd16,client:_0x56c500}=_0x5429a,_0x422875=(0x0,utils_1[_0x12d4b4(0xfa)])(_0x4e02c6);await this['userService'][_0x12d4b4(0xc4)](_0x59ecca,_0x422875);const _0x36be82=await this['jwtService'][_0x12d4b4(0xd0)]({'username':_0x4b6361,'id':_0x59ecca,'email':_0x3da898,'role':_0x3759b3,'openId':_0x84dd16,'client':_0x56c500});return await this[_0x12d4b4(0xe8)][_0x12d4b4(0xfc)](_0x59ecca,_0x36be82),_0x36be82;}async['getInfo'](_0x10f17f){const _0x21d2ae=_0x194b86,{id:_0x1649d0}=_0x10f17f[_0x21d2ae(0x14d)];return await this[_0x21d2ae(0xff)]['getUserInfo'](_0x1649d0);}async[_0x194b86(0xbe)](_0x1934e7,_0x1d81d8){const _0x191cb6=_0x194b86,{id:_0x7451cc}=_0x1934e7[_0x191cb6(0x14d)];return this[_0x191cb6(0xff)][_0x191cb6(0x134)](_0x7451cc,_0x1d81d8[_0x191cb6(0x129)]),_0x191cb6(0x13a);}[_0x194b86(0x113)](){const _0x5d2d15=_0x194b86;let _0x4cf043;const _0x3640ba=os[_0x5d2d15(0xfd)]();Object[_0x5d2d15(0xdb)](_0x3640ba)[_0x5d2d15(0xcc)](_0x4de393=>{const _0xdd1162=_0x5d2d15,_0x315dc0=_0x3640ba[_0x4de393];for(let _0x19b6d5=0x0;_0x19b6d5<_0x315dc0[_0xdd1162(0xcb)];_0x19b6d5++){const _0x4fd161=_0x315dc0[_0x19b6d5];if(_0x4fd161[_0xdd1162(0xce)]===_0xdd1162(0xd2)&&_0x4fd161[_0xdd1162(0x13d)]!==_0xdd1162(0x115)&&!_0x4fd161[_0xdd1162(0xc5)]){_0x4cf043=_0x4fd161[_0xdd1162(0x13d)];break;}}}),this[_0x5d2d15(0x130)]=_0x4cf043;}async['sendCode'](_0x3749b4){const _0x438780=_0x194b86,{contact:_0x9859e8,isLogin:_0x5c799c}=_0x3749b4,_0x5b664f=(0x0,utils_1[_0x438780(0x10d)])(),_0x3072ca=/\S+@\S+\.\S+/[_0x438780(0x152)](_0x9859e8),_0x33b1bf=/^1\d{10}$/['test'](_0x9859e8);if(!_0x3072ca&&!_0x33b1bf)throw new common_1[(_0x438780(0x103))](_0x438780(0x12e),common_1[_0x438780(0xd3)][_0x438780(0xc1)]);if(_0x5c799c){if(_0x3072ca){const _0x38d414=await this['userService'][_0x438780(0x12a)]({'email':_0x9859e8});if(_0x38d414)throw new common_1[(_0x438780(0x103))](_0x438780(0xc0),common_1[_0x438780(0xd3)]['BAD_REQUEST']);}else{if(_0x33b1bf){const _0x11dcb2=await this[_0x438780(0xff)]['verifyUserRegister']({'phone':_0x9859e8});if(_0x11dcb2)throw new common_1['HttpException']('该手机号未注册，请先注册！',common_1[_0x438780(0xd3)]['BAD_REQUEST']);}}}else{if(_0x3072ca){const _0xd8eec=await this[_0x438780(0xff)][_0x438780(0x12a)]({'email':_0x9859e8});if(!_0xd8eec)throw new common_1[(_0x438780(0x103))]('该邮箱已注册，请直接登录！',common_1[_0x438780(0xd3)][_0x438780(0xc1)]);}else{if(_0x33b1bf){const _0x1bb81e=await this[_0x438780(0xff)][_0x438780(0x12a)]({'phone':_0x9859e8});if(!_0x1bb81e)throw new common_1[(_0x438780(0x103))](_0x438780(0xbb),common_1[_0x438780(0xd3)][_0x438780(0xc1)]);}}}const _0x4906ff=await this[_0x438780(0xc9)]['getNamespace'](),_0x5988d7=_0x4906ff+_0x438780(0x147)+_0x9859e8,_0x48f844=_0x4906ff+_0x438780(0x155)+_0x9859e8,_0x122369=await this['redisCacheService'][_0x438780(0x101)](_0x5988d7);if(_0x122369&&_0x122369>0x0)throw new common_1[(_0x438780(0x103))](_0x122369+_0x438780(0x111),common_1[_0x438780(0xd3)][_0x438780(0xc1)]);const _0x3762fc=await this[_0x438780(0xe8)]['get']({'key':_0x48f844})||0x0;if(_0x3762fc>=0xa)throw new common_1[(_0x438780(0x103))](_0x438780(0xee),common_1[_0x438780(0xd3)][_0x438780(0x109)]);if(_0x3072ca)await this['mailerService'][_0x438780(0xe6)]({'to':_0x9859e8,'context':{'code':_0x5b664f}});else{if(_0x33b1bf){const _0x323ffc={'phone':_0x9859e8,'code':_0x5b664f};await this[_0x438780(0x108)][_0x438780(0xf6)](_0x323ffc);}}return await this['redisCacheService']['set']({'key':_0x5988d7,'val':_0x5b664f},0x5*0x3c),await this['redisCacheService'][_0x438780(0xc8)]({'key':_0x48f844,'val':Number(_0x3762fc)+0x1},0x18*0x3c*0x3c),await this[_0x438780(0xe8)][_0x438780(0xc8)]({'key':_0x5988d7,'val':_0x5b664f},0x3c),_0x438780(0xca)+(_0x5c799c?'注册':'验证')+'！';}[_0x194b86(0x11a)](_0x1d9965){const _0x1ca092=_0x194b86,_0x14309f=this['jwtService']['sign']({'username':'游客'+_0x1d9965,'id':_0x1d9965,'email':_0x1d9965+_0x1ca092(0x14f),'role':'visitor','openId':null,'client':null});return _0x14309f;}async[_0x194b86(0x107)](_0x5ded22,_0x3e35a5){const _0x22cba0=_0x194b86;common_1[_0x22cba0(0x102)][_0x22cba0(0xf5)](_0x22cba0(0x100));const {name:_0x203204,idCard:_0x593974}=_0x3e35a5,{id:_0x4bd759}=_0x5ded22[_0x22cba0(0x14d)];try{const _0x1f78d2=await this[_0x22cba0(0x108)][_0x22cba0(0x107)](_0x3e35a5);common_1[_0x22cba0(0x102)][_0x22cba0(0xf5)](_0x22cba0(0xdf)+_0x1f78d2);if(!_0x1f78d2)throw new common_1[(_0x22cba0(0x103))](_0x22cba0(0x138),common_1[_0x22cba0(0xd3)][_0x22cba0(0xc1)]);return await this[_0x22cba0(0xff)]['saveRealNameInfo'](_0x4bd759,_0x203204,_0x593974),_0x22cba0(0xf8);}catch(_0x4766b2){common_1[_0x22cba0(0x102)][_0x22cba0(0x10b)](_0x22cba0(0x121),_0x4766b2);throw new common_1[(_0x22cba0(0x103))](_0x22cba0(0x140),common_1['HttpStatus'][_0x22cba0(0xc1)]);}}async['verifyPhoneIdentity'](_0x321c95,_0x13c5ac){const _0xec5d7f=_0x194b86;common_1[_0xec5d7f(0x102)][_0xec5d7f(0xf5)](_0xec5d7f(0xf9));const {phone:_0x5bdfb9,username:_0x40aa1a,password:_0x1216b9,code:_0x59d0bf}=_0x13c5ac,{id:_0x3fc03e}=_0x321c95[_0xec5d7f(0x14d)],_0x4f55f0=this[_0xec5d7f(0xc9)]['getNamespace'](),_0x364936=_0x4f55f0+_0xec5d7f(0x147)+_0x5bdfb9,_0x5dcb76=await this[_0xec5d7f(0xe8)][_0xec5d7f(0x12b)]({'key':_0x364936});common_1['Logger'][_0xec5d7f(0xf5)]('Retrieved\x20redisCode\x20for\x20'+_0x5bdfb9+':\x20'+_0x5dcb76);if(_0x59d0bf==='')throw new common_1[(_0xec5d7f(0x103))](_0xec5d7f(0x145),common_1[_0xec5d7f(0xd3)]['BAD_REQUEST']);if(!_0x5dcb76){common_1[_0xec5d7f(0x102)]['log'](_0xec5d7f(0x11f)+_0x5bdfb9,'authService');throw new common_1[(_0xec5d7f(0x103))](_0xec5d7f(0x110),common_1[_0xec5d7f(0xd3)][_0xec5d7f(0xc1)]);}if(_0x59d0bf!==_0x5dcb76){common_1[_0xec5d7f(0x102)]['log'](_0xec5d7f(0xe7)+_0x5bdfb9+_0xec5d7f(0x148)+_0x59d0bf+_0xec5d7f(0x10e)+_0x5dcb76,_0xec5d7f(0x151));throw new common_1['HttpException']('验证码填写错误，请重新输入！',common_1['HttpStatus'][_0xec5d7f(0xc1)]);}if(_0x40aa1a){const _0x34a5fd=await this[_0xec5d7f(0xff)][_0xec5d7f(0x10a)](_0x13c5ac[_0xec5d7f(0x144)],_0x3fc03e);if(_0x34a5fd)throw new common_1['HttpException']('用户名已存在！',common_1['HttpStatus'][_0xec5d7f(0xc1)]);}try{return await this[_0xec5d7f(0xff)][_0xec5d7f(0x143)](_0x3fc03e,_0x5bdfb9,_0x40aa1a,_0x1216b9),'认证成功';}catch(_0x364b44){common_1[_0xec5d7f(0x102)][_0xec5d7f(0x10b)](_0xec5d7f(0x121),_0x364b44);throw new common_1[(_0xec5d7f(0x103))](_0xec5d7f(0x10f),common_1[_0xec5d7f(0xd3)][_0xec5d7f(0xc1)]);}}};AuthService=__decorate([(0x0,common_1[_0x194b86(0xe2)])(),__param(0x0,(0x0,typeorm_1[_0x194b86(0x11d)])(config_entity_1[_0x194b86(0x128)])),__metadata(_0x194b86(0xf3),[typeorm_2[_0x194b86(0x142)],user_service_1[_0x194b86(0x13b)],jwt_1[_0x194b86(0xe1)],mailer_service_1['MailerService'],verification_service_1[_0x194b86(0x149)],userBalance_service_1[_0x194b86(0xd1)],redisCache_service_1[_0x194b86(0xe5)],globalConfig_service_1[_0x194b86(0x13c)]])],AuthService),exports[_0x194b86(0x14a)]=AuthService;