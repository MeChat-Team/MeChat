'use strict';const _0x4dc9f2=_0x32fe;function _0x32fe(_0x46e18e,_0x203d0d){const _0x468214=_0x4682();return _0x32fe=function(_0x32feda,_0x3436b5){_0x32feda=_0x32feda-0x7e;let _0x2367b7=_0x468214[_0x32feda];return _0x2367b7;},_0x32fe(_0x46e18e,_0x203d0d);}(function(_0x29fd47,_0x2e0ba5){const _0x2ebaae=_0x32fe,_0x11c897=_0x29fd47();while(!![]){try{const _0x4975e6=parseInt(_0x2ebaae(0xb0))/0x1*(parseInt(_0x2ebaae(0x8e))/0x2)+parseInt(_0x2ebaae(0x102))/0x3*(parseInt(_0x2ebaae(0x81))/0x4)+-parseInt(_0x2ebaae(0xed))/0x5+parseInt(_0x2ebaae(0xa4))/0x6+-parseInt(_0x2ebaae(0xb4))/0x7+parseInt(_0x2ebaae(0xa1))/0x8+-parseInt(_0x2ebaae(0xc3))/0x9;if(_0x4975e6===_0x2e0ba5)break;else _0x11c897['push'](_0x11c897['shift']());}catch(_0x2c2e18){_0x11c897['push'](_0x11c897['shift']());}}}(_0x4682,0x5863c));var __decorate=this&&this[_0x4dc9f2(0x88)]||function(_0x3fb37d,_0x4d8e35,_0x17a36c,_0x3ee396){const _0x1ce760=_0x4dc9f2;var _0x2ad69c=arguments['length'],_0x16fdf9=_0x2ad69c<0x3?_0x4d8e35:_0x3ee396===null?_0x3ee396=Object[_0x1ce760(0xe3)](_0x4d8e35,_0x17a36c):_0x3ee396,_0x2b4e09;if(typeof Reflect===_0x1ce760(0x110)&&typeof Reflect[_0x1ce760(0x107)]===_0x1ce760(0xe4))_0x16fdf9=Reflect[_0x1ce760(0x107)](_0x3fb37d,_0x4d8e35,_0x17a36c,_0x3ee396);else{for(var _0x2fd234=_0x3fb37d['length']-0x1;_0x2fd234>=0x0;_0x2fd234--)if(_0x2b4e09=_0x3fb37d[_0x2fd234])_0x16fdf9=(_0x2ad69c<0x3?_0x2b4e09(_0x16fdf9):_0x2ad69c>0x3?_0x2b4e09(_0x4d8e35,_0x17a36c,_0x16fdf9):_0x2b4e09(_0x4d8e35,_0x17a36c))||_0x16fdf9;}return _0x2ad69c>0x3&&_0x16fdf9&&Object[_0x1ce760(0xf6)](_0x4d8e35,_0x17a36c,_0x16fdf9),_0x16fdf9;},__metadata=this&&this['__metadata']||function(_0x15c78a,_0x52dcd5){const _0x2957f3=_0x4dc9f2;if(typeof Reflect===_0x2957f3(0x110)&&typeof Reflect[_0x2957f3(0xf0)]===_0x2957f3(0xe4))return Reflect['metadata'](_0x15c78a,_0x52dcd5);},__param=this&&this['__param']||function(_0x2f25aa,_0x40c414){return function(_0x5d27e8,_0x38a5e0){_0x40c414(_0x5d27e8,_0x38a5e0,_0x2f25aa);};};Object['defineProperty'](exports,_0x4dc9f2(0xf8),{'value':!![]}),exports[_0x4dc9f2(0xdb)]=void 0x0;function _0x4682(){const _0x12a1da=['ACTIVE','getConfigs','hashSync','defineProperty','@visitor.com','__esModule','密码修改成功','verificationService',':CODE:','该邮箱已注册，请直接登录！','error','verifyUserRegister','验证码已过期，请重新发送！','keys','验证码错误:\x20','24uFuLBk','Contact:\x20','../globalConfig/config.entity','visitor','Logger','decorate','updatePassword','127.0.0.1','verifyUserCredentials','完成新用户余额处理','UNAUTHORIZED','验证码过期:\x20','../../common/utils','UserStatusErrMsg','object','updateUserPhone','实名认证结果:\x20','IPv4','61284AxxrlN','\x20is\x20taken:\x20','createRandomCode','getUserByContact','sendCode','noVerifyRegister','noVerifyRegister:\x20','__decorate','Phone\x20','password','del','updateUserPassword','getIp','102rgLxur','登录失败:\x20用户凭证无效\x20-\x20用户名:\x20','design:paramtypes','savaLoginIp','createRandomUid','address','authService','验证码错误，请重新输入！','用户创建成功，用户ID:\x20','ttl','Checking\x20if\x20username\x20','../redisCache/redisCache.service','验证过程出现错误','NOT_FOUND','configEntity','JwtService',':RATE_LIMIT:','HttpStatus','Retrieved\x20redisCode\x20for\x20','5755056sFgpVX','getNamespace','认证成功','267570wmULnH','get','\x20输入的验证码:\x20','verifyIdentity','../globalConfig/globalConfig.service','../user/user.service','user','用户名已存在！','BAD_REQUEST','开始手机号认证流程','mailerService','请提供有效的邮箱地址或手机号码。','579NrkxJP','@nestjs/typeorm','sign','username','1587110nbLCpl','注册成功','JWT令牌生成成功\x20-\x20用户ID:\x20','HttpException','该手机号已注册，请直接登录！','Injectable','VerificationService','ConfigEntity','UserService','./../verification/verification.service','loginWithCaptcha','status','验证码填写错误，请重新输入！','addBalanceToNewUser','保存新用户到数据库...','2593269amFZMM','test','@nestjs/common','\x20is\x20available:\x20','isUsernameTaken','verifyPhoneIdentity',',\x20isEmail:\x20','userService','获取默认用户头像...','该手机号未注册，请先注册！','getClientIp','forEach','InjectRepository','onModuleInit','globalConfigService','ipAddress','使用默认用户头像:\x20','GlobalConfigService','认证失败，请检查相关信息','\x20-\x20用户ID:\x20','debug','avatar','身份验证错误，请检查实名信息','family','AuthService','该邮箱未注册，请先注册！','saveToken','loginByOpenId','createUser','保存登录IP:\x20','jwtService','../userBalance/userBalance.service','getOwnPropertyDescriptor','function','身份验证错误，请检查相关信息','验证码发送成功、请填写验证码完成','UserBalanceService','set','开始实名认证流程','redisCacheService','internal','userBalanceService','195795ZTdlYf','请输入验证码','log','metadata','@nestjs/jwt',',\x20期望的验证码:\x20'];_0x4682=function(){return _0x12a1da;};return _0x4682();}const user_constant_1=require('../../common/constants/user.constant'),utils_1=require(_0x4dc9f2(0x10e)),globalConfig_service_1=require(_0x4dc9f2(0xa8)),common_1=require(_0x4dc9f2(0xc5)),jwt_1=require(_0x4dc9f2(0xf1)),typeorm_1=require(_0x4dc9f2(0xb1)),bcrypt=require('bcryptjs'),os=require('os'),typeorm_2=require('typeorm'),config_entity_1=require(_0x4dc9f2(0x104)),mailer_service_1=require('../mailer/mailer.service'),redisCache_service_1=require(_0x4dc9f2(0x99)),user_service_1=require(_0x4dc9f2(0xa9)),userBalance_service_1=require(_0x4dc9f2(0xe2)),verification_service_1=require(_0x4dc9f2(0xbd));let AuthService=class AuthService{constructor(_0xe1a589,_0x52b89e,_0x22a6d3,_0x1e4555,_0x38039b,_0x15db92,_0x384304,_0x221bb6){const _0x38eff4=_0x4dc9f2;this[_0x38eff4(0x9c)]=_0xe1a589,this['userService']=_0x52b89e,this[_0x38eff4(0xe1)]=_0x22a6d3,this[_0x38eff4(0xae)]=_0x1e4555,this[_0x38eff4(0xfa)]=_0x38039b,this['userBalanceService']=_0x15db92,this['redisCacheService']=_0x384304,this[_0x38eff4(0xd1)]=_0x221bb6;}async[_0x4dc9f2(0xd0)](){const _0xedb23c=_0x4dc9f2;this[_0xedb23c(0x8d)]();}async['register'](_0x42929e,_0x48a475){const _0x5a84d3=_0x4dc9f2,{password:_0x3d859a,contact:_0x42df7b,code:_0x1a5070}=_0x42929e;let _0xa06c43='',_0x244762='';const _0x2ace59=/\S+@\S+\.\S+/[_0x5a84d3(0xc4)](_0x42df7b),_0x5d07e0=/^\d{10,}$/[_0x5a84d3(0xc4)](_0x42df7b);common_1['Logger']['debug'](_0x5a84d3(0x103)+_0x42df7b+_0x5a84d3(0xc9)+_0x2ace59+',\x20isPhone:\x20'+_0x5d07e0);let _0x3ce43a=(0x0,utils_1[_0x5a84d3(0x92)])();while(!![]){const _0x2d6854=await this[_0x5a84d3(0xca)][_0x5a84d3(0xfe)]({'username':_0x3ce43a});common_1[_0x5a84d3(0x106)][_0x5a84d3(0xd7)](_0x5a84d3(0x98)+_0x3ce43a+_0x5a84d3(0x82)+_0x2d6854);if(_0x2d6854)break;_0x3ce43a=(0x0,utils_1[_0x5a84d3(0x92)])();}if(_0x2ace59){_0xa06c43=_0x42df7b;const _0x16260c=await this[_0x5a84d3(0xca)][_0x5a84d3(0xfe)]({'username':_0x3ce43a,'email':_0xa06c43});common_1[_0x5a84d3(0x106)][_0x5a84d3(0xd7)]('Email\x20'+_0xa06c43+'\x20is\x20available:\x20'+_0x16260c);if(!_0x16260c)throw new common_1[(_0x5a84d3(0xb7))]('当前邮箱已注册，请勿重复注册！',common_1[_0x5a84d3(0x9f)][_0x5a84d3(0xac)]);}else{if(_0x5d07e0){_0x244762=_0x42df7b;const _0x75cfaa=await this[_0x5a84d3(0xca)]['verifyUserRegister']({'username':_0x3ce43a,'phone':_0x244762});common_1['Logger'][_0x5a84d3(0xd7)](_0x5a84d3(0x89)+_0x244762+_0x5a84d3(0xc6)+_0x75cfaa);if(!_0x75cfaa)throw new common_1[(_0x5a84d3(0xb7))]('当前手机号已注册，请勿重复注册！',common_1['HttpStatus']['BAD_REQUEST']);}else throw new common_1['HttpException'](_0x5a84d3(0xaf),common_1[_0x5a84d3(0x9f)][_0x5a84d3(0xac)]);}const _0x358527=await this[_0x5a84d3(0xd1)]['getConfigs']([_0x5a84d3(0x86)]);common_1[_0x5a84d3(0x106)]['debug'](_0x5a84d3(0x87)+_0x358527);if(_0x358527!=='1'){const _0x1390b1=await this[_0x5a84d3(0xd1)]['getNamespace'](),_0x44ef43=_0x1390b1+_0x5a84d3(0xfb)+_0x42df7b,_0x4ffc7b=await this[_0x5a84d3(0xea)][_0x5a84d3(0xa5)]({'key':_0x44ef43});common_1[_0x5a84d3(0x106)]['debug'](_0x5a84d3(0xa0)+_0x42df7b+':\x20'+_0x4ffc7b);if(_0x1a5070==='')throw new common_1[(_0x5a84d3(0xb7))]('请输入验证码',common_1[_0x5a84d3(0x9f)]['BAD_REQUEST']);if(!_0x4ffc7b){common_1[_0x5a84d3(0x106)][_0x5a84d3(0xef)](_0x5a84d3(0x10d)+_0x42df7b,'authService');throw new common_1[(_0x5a84d3(0xb7))]('验证码已过期，请重新发送！',common_1[_0x5a84d3(0x9f)][_0x5a84d3(0xac)]);}if(_0x1a5070!==_0x4ffc7b){common_1[_0x5a84d3(0x106)]['log'](_0x5a84d3(0x101)+_0x42df7b+_0x5a84d3(0xa6)+_0x1a5070+',\x20期望的验证码:\x20'+_0x4ffc7b,_0x5a84d3(0x94));throw new common_1[(_0x5a84d3(0xb7))](_0x5a84d3(0xc0),common_1[_0x5a84d3(0x9f)][_0x5a84d3(0xac)]);}}let _0x5e7a92;if(_0x2ace59)_0x5e7a92={'username':_0x3ce43a,'password':_0x3d859a,'email':_0x42df7b,'status':user_constant_1['UserStatusEnum'][_0x5a84d3(0xf3)]};else{const _0x421336=(0x0,utils_1[_0x5a84d3(0x92)])()+'@aiweb.com';_0x5e7a92={'username':_0x3ce43a,'password':_0x3d859a,'email':_0x421336,'phone':_0x42df7b,'status':user_constant_1['UserStatusEnum'][_0x5a84d3(0xf3)]};}common_1['Logger'][_0x5a84d3(0xd7)](_0x5a84d3(0xcb));const _0x265478=await this[_0x5a84d3(0xd1)][_0x5a84d3(0xf4)](['userDefautlAvatar']);common_1[_0x5a84d3(0x106)][_0x5a84d3(0xd7)](_0x5a84d3(0xd3)+_0x265478),_0x5e7a92[_0x5a84d3(0xd8)]=_0x265478,common_1['Logger']['debug']('加密用户密码...');const _0x5873c2=bcrypt[_0x5a84d3(0xf5)](_0x3d859a,0xa);_0x5e7a92[_0x5a84d3(0x8a)]=_0x5873c2,common_1[_0x5a84d3(0x106)][_0x5a84d3(0xd7)](_0x5a84d3(0xc2));const _0x2defc1=await this['userService'][_0x5a84d3(0xdf)](_0x5e7a92);return common_1['Logger'][_0x5a84d3(0xd7)](_0x5a84d3(0x96)+_0x2defc1['id']),await this[_0x5a84d3(0xec)][_0x5a84d3(0xc1)](_0x2defc1['id']),common_1['Logger']['debug'](_0x5a84d3(0x10b)),{'success':!![],'message':_0x5a84d3(0xb5)};}async['login'](_0x246553,_0x278506){const _0x1b2cf6=_0x4dc9f2;console['log']('开始用户登录流程，用户名:\x20'+_0x246553[_0x1b2cf6(0xb3)]);const _0x26f725=await this['userService'][_0x1b2cf6(0x10a)](_0x246553);if(!_0x26f725){console[_0x1b2cf6(0xfd)](_0x1b2cf6(0x8f)+_0x246553['username']);throw new common_1[(_0x1b2cf6(0xb7))]('登录失败，用户凭证无效。',common_1['HttpStatus'][_0x1b2cf6(0x10c)]);}const {username:_0x12ab0e,id:_0x188078,email:_0x1747b6,role:_0x5cde81,openId:_0x5bb374,client:_0x2cc0ca,phone:_0x2e1356}=_0x26f725;console[_0x1b2cf6(0xef)]('用户凭证验证成功，用户ID:\x20'+_0x188078+',\x20用户名:\x20'+_0x12ab0e);const _0x3a00f6=(0x0,utils_1[_0x1b2cf6(0xcd)])(_0x278506);await this[_0x1b2cf6(0xca)][_0x1b2cf6(0x91)](_0x188078,_0x3a00f6),console['log'](_0x1b2cf6(0xe0)+_0x3a00f6+_0x1b2cf6(0xd6)+_0x188078);const _0x261f4e=await this[_0x1b2cf6(0xe1)]['sign']({'username':_0x12ab0e,'id':_0x188078,'email':_0x1747b6,'role':_0x5cde81,'openId':_0x5bb374,'client':_0x2cc0ca,'phone':_0x2e1356});return console[_0x1b2cf6(0xef)](_0x1b2cf6(0xb6)+_0x188078),await this['redisCacheService'][_0x1b2cf6(0xdd)](_0x188078,_0x261f4e),console[_0x1b2cf6(0xef)]('令牌已保存到Redis\x20-\x20用户ID:\x20'+_0x188078),_0x261f4e;}async[_0x4dc9f2(0xbe)](_0x43e828,_0x4fc5b4){const _0x6c52dd=_0x4dc9f2,{contact:_0x132f80,code:_0x271cb3}=_0x43e828;let _0x1d512a='',_0x9cb811='';const _0x3a2405=/\S+@\S+\.\S+/['test'](_0x132f80),_0x5a8d47=/^\d{10,}$/[_0x6c52dd(0xc4)](_0x132f80);if(_0x3a2405)_0x1d512a=_0x132f80;else{if(_0x5a8d47)_0x9cb811=_0x132f80;else throw new common_1['HttpException'](_0x6c52dd(0xaf),common_1[_0x6c52dd(0x9f)][_0x6c52dd(0xac)]);}if(!![]){if(_0x3a2405){const _0x5b4355=await this['userService'][_0x6c52dd(0xfe)]({'email':_0x132f80});if(_0x5b4355)throw new common_1['HttpException']('该邮箱未注册，请先注册！',common_1[_0x6c52dd(0x9f)][_0x6c52dd(0xac)]);}else{if(_0x5a8d47){const _0x49bc68=await this[_0x6c52dd(0xca)][_0x6c52dd(0xfe)]({'phone':_0x132f80});if(_0x49bc68)throw new common_1[(_0x6c52dd(0xb7))]('该手机号未注册，请先注册！',common_1[_0x6c52dd(0x9f)][_0x6c52dd(0xac)]);}}}else{if(_0x3a2405){const _0x3191d3=await this[_0x6c52dd(0xca)][_0x6c52dd(0xfe)]({'email':_0x132f80});if(!_0x3191d3)throw new common_1[(_0x6c52dd(0xb7))](_0x6c52dd(0xfc),common_1[_0x6c52dd(0x9f)][_0x6c52dd(0xac)]);}else{if(_0x5a8d47){const _0x2b39de=await this[_0x6c52dd(0xca)][_0x6c52dd(0xfe)]({'phone':_0x132f80});if(!_0x2b39de)throw new common_1[(_0x6c52dd(0xb7))](_0x6c52dd(0xb8),common_1[_0x6c52dd(0x9f)][_0x6c52dd(0xac)]);}}}const _0x2b4ec7=await this[_0x6c52dd(0xd1)]['getNamespace'](),_0x179327=_0x2b4ec7+_0x6c52dd(0xfb)+_0x132f80,_0x2d3992=await this[_0x6c52dd(0xea)][_0x6c52dd(0xa5)]({'key':_0x179327});if(!_0x2d3992){common_1[_0x6c52dd(0x106)][_0x6c52dd(0xef)](_0x6c52dd(0x10d)+_0x132f80,_0x6c52dd(0x94));throw new common_1[(_0x6c52dd(0xb7))](_0x6c52dd(0xff),common_1[_0x6c52dd(0x9f)]['BAD_REQUEST']);}if(_0x2d3992!==_0x271cb3){common_1[_0x6c52dd(0x106)][_0x6c52dd(0xef)](_0x6c52dd(0x101)+_0x132f80,_0x6c52dd(0x94));throw new common_1[(_0x6c52dd(0xb7))](_0x6c52dd(0x95),common_1[_0x6c52dd(0x9f)]['BAD_REQUEST']);}const _0xbc449=await this[_0x6c52dd(0xca)][_0x6c52dd(0x84)]({'email':_0x1d512a,'phone':_0x9cb811});if(!_0xbc449)throw new common_1[(_0x6c52dd(0xb7))]('用户不存在，请先注册！',common_1['HttpStatus'][_0x6c52dd(0x9b)]);if(_0xbc449[_0x6c52dd(0xbf)]!==user_constant_1['UserStatusEnum'][_0x6c52dd(0xf3)])throw new common_1['HttpException'](user_constant_1[_0x6c52dd(0x10f)][_0xbc449[_0x6c52dd(0xbf)]],common_1[_0x6c52dd(0x9f)][_0x6c52dd(0xac)]);const {username:_0x4d2d26,id:_0x1ad586,role:_0xfaf60f,openId:_0x1aad81,client:_0x586562}=_0xbc449,_0x15aabd=(0x0,utils_1['getClientIp'])(_0x4fc5b4);await this[_0x6c52dd(0xca)]['savaLoginIp'](_0x1ad586,_0x15aabd);const _0x4c718b=await this[_0x6c52dd(0xe1)][_0x6c52dd(0xb2)]({'username':_0x4d2d26,'id':_0x1ad586,'email':_0x1d512a,'role':_0xfaf60f,'openId':_0x1aad81,'client':_0x586562,'phone':_0x9cb811});return await this['redisCacheService'][_0x6c52dd(0xdd)](_0x1ad586,_0x4c718b),await this[_0x6c52dd(0xea)][_0x6c52dd(0x8b)](_0x179327),_0x4c718b;}async[_0x4dc9f2(0xde)](_0x4302ee,_0x4cbec6){const _0x254d0f=_0x4dc9f2,{status:_0x5ca3d0}=_0x4302ee;if(_0x5ca3d0!==user_constant_1['UserStatusEnum']['ACTIVE'])throw new common_1[(_0x254d0f(0xb7))](user_constant_1[_0x254d0f(0x10f)][_0x5ca3d0],common_1[_0x254d0f(0x9f)][_0x254d0f(0xac)]);const {username:_0x27a679,id:_0x5d92f8,email:_0x163d01,role:_0x565480,openId:_0x313f34,client:_0x45466b}=_0x4302ee,_0x4b0398=(0x0,utils_1[_0x254d0f(0xcd)])(_0x4cbec6);await this['userService'][_0x254d0f(0x91)](_0x5d92f8,_0x4b0398);const _0x751c70=await this['jwtService']['sign']({'username':_0x27a679,'id':_0x5d92f8,'email':_0x163d01,'role':_0x565480,'openId':_0x313f34,'client':_0x45466b});return await this['redisCacheService'][_0x254d0f(0xdd)](_0x5d92f8,_0x751c70),_0x751c70;}async['getInfo'](_0x30e0cc){const {id:_0x4361f7}=_0x30e0cc['user'];return await this['userService']['getUserInfo'](_0x4361f7);}async[_0x4dc9f2(0x108)](_0x342020,_0x45f03d){const _0x58c33f=_0x4dc9f2,{id:_0x3bc542}=_0x342020['user'];return this[_0x58c33f(0xca)][_0x58c33f(0x8c)](_0x3bc542,_0x45f03d[_0x58c33f(0x8a)]),_0x58c33f(0xf9);}[_0x4dc9f2(0x8d)](){const _0x87b434=_0x4dc9f2;let _0x233758;const _0x480f03=os['networkInterfaces']();Object[_0x87b434(0x100)](_0x480f03)[_0x87b434(0xce)](_0x108ef5=>{const _0x124177=_0x87b434,_0x2ee295=_0x480f03[_0x108ef5];for(let _0x190372=0x0;_0x190372<_0x2ee295['length'];_0x190372++){const _0x1e9951=_0x2ee295[_0x190372];if(_0x1e9951[_0x124177(0xda)]===_0x124177(0x80)&&_0x1e9951[_0x124177(0x93)]!==_0x124177(0x109)&&!_0x1e9951[_0x124177(0xeb)]){_0x233758=_0x1e9951[_0x124177(0x93)];break;}}}),this[_0x87b434(0xd2)]=_0x233758;}async[_0x4dc9f2(0x85)](_0x58409c){const _0x111097=_0x4dc9f2,{contact:_0x575d73,isLogin:_0x52bfd5}=_0x58409c,_0x36a2d6=(0x0,utils_1[_0x111097(0x83)])(),_0x551d37=/\S+@\S+\.\S+/[_0x111097(0xc4)](_0x575d73),_0x432052=/^1\d{10}$/[_0x111097(0xc4)](_0x575d73);if(!_0x551d37&&!_0x432052)throw new common_1['HttpException'](_0x111097(0xaf),common_1[_0x111097(0x9f)][_0x111097(0xac)]);if(_0x52bfd5){if(_0x551d37){const _0xd7c278=await this[_0x111097(0xca)][_0x111097(0xfe)]({'email':_0x575d73});if(_0xd7c278)throw new common_1[(_0x111097(0xb7))](_0x111097(0xdc),common_1[_0x111097(0x9f)]['BAD_REQUEST']);}else{if(_0x432052){const _0x330660=await this['userService'][_0x111097(0xfe)]({'phone':_0x575d73});if(_0x330660)throw new common_1[(_0x111097(0xb7))](_0x111097(0xcc),common_1[_0x111097(0x9f)][_0x111097(0xac)]);}}}else{if(_0x551d37){const _0x2b61e4=await this['userService'][_0x111097(0xfe)]({'email':_0x575d73});if(!_0x2b61e4)throw new common_1['HttpException'](_0x111097(0xfc),common_1['HttpStatus']['BAD_REQUEST']);}else{if(_0x432052){const _0xb66110=await this[_0x111097(0xca)]['verifyUserRegister']({'phone':_0x575d73});if(!_0xb66110)throw new common_1[(_0x111097(0xb7))]('该手机号已注册，请直接登录！',common_1[_0x111097(0x9f)][_0x111097(0xac)]);}}}const _0x15cb2a=await this[_0x111097(0xd1)]['getNamespace'](),_0xf85ceb=_0x15cb2a+_0x111097(0xfb)+_0x575d73,_0x11eb12=_0x15cb2a+_0x111097(0x9e)+_0x575d73,_0x14287f=await this[_0x111097(0xea)][_0x111097(0x97)](_0xf85ceb);if(_0x14287f&&_0x14287f>0x0)throw new common_1[(_0x111097(0xb7))](_0x14287f+'秒内不得重复发送验证码！',common_1[_0x111097(0x9f)][_0x111097(0xac)]);const _0x4ddcbf=await this[_0x111097(0xea)][_0x111097(0xa5)]({'key':_0x11eb12})||0x0;if(_0x4ddcbf>=0xa)throw new common_1[(_0x111097(0xb7))]('今日发送验证码次数已达上限，请24小时后再试！',common_1[_0x111097(0x9f)]['TOO_MANY_REQUESTS']);if(_0x551d37)await this['mailerService']['sendMail']({'to':_0x575d73,'context':{'code':_0x36a2d6}});else{if(_0x432052){const _0x15e871={'phone':_0x575d73,'code':_0x36a2d6};await this['verificationService']['sendPhoneCode'](_0x15e871);}}return await this['redisCacheService'][_0x111097(0xe8)]({'key':_0xf85ceb,'val':_0x36a2d6},0x5*0x3c),await this[_0x111097(0xea)][_0x111097(0xe8)]({'key':_0x11eb12,'val':Number(_0x4ddcbf)+0x1},0x18*0x3c*0x3c),await this[_0x111097(0xea)][_0x111097(0xe8)]({'key':_0xf85ceb,'val':_0x36a2d6},0x3c),_0x111097(0xe6)+(_0x52bfd5?'注册':'验证')+'！';}['createTokenFromFingerprint'](_0x22c345){const _0xd14c05=_0x4dc9f2,_0x59109c=this[_0xd14c05(0xe1)][_0xd14c05(0xb2)]({'username':'游客'+_0x22c345,'id':_0x22c345,'email':_0x22c345+_0xd14c05(0xf7),'role':_0xd14c05(0x105),'openId':null,'client':null});return _0x59109c;}async[_0x4dc9f2(0xa7)](_0x105bff,_0x141534){const _0x275904=_0x4dc9f2;common_1[_0x275904(0x106)][_0x275904(0xd7)](_0x275904(0xe9));const {name:_0x300415,idCard:_0x4b375a}=_0x141534,{id:_0x25cfe6}=_0x105bff['user'];try{const _0x5c1b19=await this['verificationService']['verifyIdentity'](_0x141534);common_1[_0x275904(0x106)][_0x275904(0xd7)](_0x275904(0x7f)+_0x5c1b19);if(!_0x5c1b19)throw new common_1[(_0x275904(0xb7))](_0x275904(0xd9),common_1[_0x275904(0x9f)][_0x275904(0xac)]);return await this[_0x275904(0xca)]['saveRealNameInfo'](_0x25cfe6,_0x300415,_0x4b375a),_0x275904(0xa3);}catch(_0x271b28){common_1[_0x275904(0x106)][_0x275904(0xfd)](_0x275904(0x9a),_0x271b28);throw new common_1[(_0x275904(0xb7))](_0x275904(0xd5),common_1[_0x275904(0x9f)][_0x275904(0xac)]);}}async[_0x4dc9f2(0xc8)](_0x331696,_0x186892){const _0xa1af20=_0x4dc9f2;common_1[_0xa1af20(0x106)][_0xa1af20(0xd7)](_0xa1af20(0xad));const {phone:_0x50ba0b,username:_0x4524bb,password:_0x5562c1,code:_0x5caee4}=_0x186892,{id:_0xea4e2f}=_0x331696[_0xa1af20(0xaa)],_0x2bc6ed=this[_0xa1af20(0xd1)][_0xa1af20(0xa2)](),_0xc2520b=_0x2bc6ed+_0xa1af20(0xfb)+_0x50ba0b,_0xc157e4=await this['redisCacheService'][_0xa1af20(0xa5)]({'key':_0xc2520b});common_1[_0xa1af20(0x106)][_0xa1af20(0xd7)](_0xa1af20(0xa0)+_0x50ba0b+':\x20'+_0xc157e4);if(_0x5caee4==='')throw new common_1['HttpException'](_0xa1af20(0xee),common_1[_0xa1af20(0x9f)][_0xa1af20(0xac)]);if(!_0xc157e4){common_1['Logger'][_0xa1af20(0xef)]('验证码过期:\x20'+_0x50ba0b,_0xa1af20(0x94));throw new common_1[(_0xa1af20(0xb7))](_0xa1af20(0xff),common_1[_0xa1af20(0x9f)][_0xa1af20(0xac)]);}if(_0x5caee4!==_0xc157e4){common_1[_0xa1af20(0x106)][_0xa1af20(0xef)](_0xa1af20(0x101)+_0x50ba0b+'\x20输入的验证码:\x20'+_0x5caee4+_0xa1af20(0xf2)+_0xc157e4,_0xa1af20(0x94));throw new common_1[(_0xa1af20(0xb7))](_0xa1af20(0xc0),common_1[_0xa1af20(0x9f)]['BAD_REQUEST']);}if(_0x4524bb){const _0x333c1b=await this['userService'][_0xa1af20(0xc7)](_0x186892[_0xa1af20(0xb3)],_0xea4e2f);if(_0x333c1b)throw new common_1[(_0xa1af20(0xb7))](_0xa1af20(0xab),common_1[_0xa1af20(0x9f)][_0xa1af20(0xac)]);}try{return await this[_0xa1af20(0xca)][_0xa1af20(0x7e)](_0xea4e2f,_0x50ba0b,_0x4524bb,_0x5562c1),_0xa1af20(0xa3);}catch(_0x1241c0){common_1[_0xa1af20(0x106)][_0xa1af20(0xfd)]('验证过程出现错误',_0x1241c0);throw new common_1[(_0xa1af20(0xb7))](_0xa1af20(0xe5),common_1['HttpStatus'][_0xa1af20(0xac)]);}}};AuthService=__decorate([(0x0,common_1[_0x4dc9f2(0xb9)])(),__param(0x0,(0x0,typeorm_1[_0x4dc9f2(0xcf)])(config_entity_1[_0x4dc9f2(0xbb)])),__metadata(_0x4dc9f2(0x90),[typeorm_2['Repository'],user_service_1[_0x4dc9f2(0xbc)],jwt_1[_0x4dc9f2(0x9d)],mailer_service_1['MailerService'],verification_service_1[_0x4dc9f2(0xba)],userBalance_service_1[_0x4dc9f2(0xe7)],redisCache_service_1['RedisCacheService'],globalConfig_service_1[_0x4dc9f2(0xd4)]])],AuthService),exports[_0x4dc9f2(0xdb)]=AuthService;