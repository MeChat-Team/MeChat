'use strict';const _0x43846a=_0x171f;(function(_0x3bbcba,_0x3544c6){const _0x3754a9=_0x171f,_0x22b9b0=_0x3bbcba();while(!![]){try{const _0x21a54b=parseInt(_0x3754a9(0x1aa))/0x1+-parseInt(_0x3754a9(0x192))/0x2*(-parseInt(_0x3754a9(0x19b))/0x3)+parseInt(_0x3754a9(0x17a))/0x4*(-parseInt(_0x3754a9(0x181))/0x5)+parseInt(_0x3754a9(0x171))/0x6+-parseInt(_0x3754a9(0x162))/0x7+-parseInt(_0x3754a9(0x195))/0x8*(parseInt(_0x3754a9(0x15a))/0x9)+-parseInt(_0x3754a9(0x1c5))/0xa;if(_0x21a54b===_0x3544c6)break;else _0x22b9b0['push'](_0x22b9b0['shift']());}catch(_0x518608){_0x22b9b0['push'](_0x22b9b0['shift']());}}}(_0x38f9,0xe7859));var __decorate=this&&this['__decorate']||function(_0x2d9902,_0x2f35a7,_0x169c0c,_0xf57148){const _0x3abfcb=_0x171f;var _0x523672=arguments[_0x3abfcb(0x14b)],_0x640bd4=_0x523672<0x3?_0x2f35a7:_0xf57148===null?_0xf57148=Object[_0x3abfcb(0x168)](_0x2f35a7,_0x169c0c):_0xf57148,_0x3aaaf0;if(typeof Reflect===_0x3abfcb(0x1af)&&typeof Reflect[_0x3abfcb(0x182)]===_0x3abfcb(0x1ba))_0x640bd4=Reflect[_0x3abfcb(0x182)](_0x2d9902,_0x2f35a7,_0x169c0c,_0xf57148);else{for(var _0xbdae5d=_0x2d9902[_0x3abfcb(0x14b)]-0x1;_0xbdae5d>=0x0;_0xbdae5d--)if(_0x3aaaf0=_0x2d9902[_0xbdae5d])_0x640bd4=(_0x523672<0x3?_0x3aaaf0(_0x640bd4):_0x523672>0x3?_0x3aaaf0(_0x2f35a7,_0x169c0c,_0x640bd4):_0x3aaaf0(_0x2f35a7,_0x169c0c))||_0x640bd4;}return _0x523672>0x3&&_0x640bd4&&Object[_0x3abfcb(0x1ab)](_0x2f35a7,_0x169c0c,_0x640bd4),_0x640bd4;},__metadata=this&&this[_0x43846a(0x1cb)]||function(_0x411ede,_0x117ad9){const _0x3bbf27=_0x43846a;if(typeof Reflect===_0x3bbf27(0x1af)&&typeof Reflect[_0x3bbf27(0x153)]===_0x3bbf27(0x1ba))return Reflect[_0x3bbf27(0x153)](_0x411ede,_0x117ad9);},__param=this&&this['__param']||function(_0xef660d,_0x50623e){return function(_0x5c85a4,_0xc727a5){_0x50623e(_0x5c85a4,_0xc727a5,_0xef660d);};};Object[_0x43846a(0x1ab)](exports,_0x43846a(0x16f),{'value':!![]}),exports['AuthService']=void 0x0;const user_constant_1=require(_0x43846a(0x18d)),utils_1=require(_0x43846a(0x165)),globalConfig_service_1=require(_0x43846a(0x1d3)),common_1=require(_0x43846a(0x17e)),jwt_1=require('@nestjs/jwt'),typeorm_1=require(_0x43846a(0x156)),bcrypt=require('bcryptjs'),os=require('os'),typeorm_2=require(_0x43846a(0x1b2)),config_entity_1=require('../globalConfig/config.entity'),mailer_service_1=require('../mailer/mailer.service'),redisCache_service_1=require('../redisCache/redisCache.service'),user_service_1=require(_0x43846a(0x18e)),userBalance_service_1=require(_0x43846a(0x16b)),verification_service_1=require(_0x43846a(0x18c));let AuthService=class AuthService{constructor(_0x451514,_0x4b05aa,_0x120aed,_0xedb04a,_0x52aaa9,_0x287545,_0x47ae3d,_0x2af5d3){const _0x3c4fc8=_0x43846a;this['configEntity']=_0x451514,this[_0x3c4fc8(0x19a)]=_0x4b05aa,this[_0x3c4fc8(0x1a1)]=_0x120aed,this['mailerService']=_0xedb04a,this[_0x3c4fc8(0x190)]=_0x52aaa9,this[_0x3c4fc8(0x18a)]=_0x287545,this[_0x3c4fc8(0x170)]=_0x47ae3d,this['globalConfigService']=_0x2af5d3;}async['onModuleInit'](){const _0x1f1359=_0x43846a;this[_0x1f1359(0x15f)]();}async[_0x43846a(0x1ca)](_0x138e7d,_0x1863e2){const _0x2ceb80=_0x43846a,{password:_0x480106,contact:_0x6430d0,code:_0x324975}=_0x138e7d;let _0x163d05='',_0x51f6a7='';const _0xb82b25=/\S+@\S+\.\S+/[_0x2ceb80(0x1d0)](_0x6430d0),_0x2d2e21=/^\d{10,}$/[_0x2ceb80(0x1d0)](_0x6430d0);common_1[_0x2ceb80(0x1c4)][_0x2ceb80(0x167)]('Contact:\x20'+_0x6430d0+',\x20isEmail:\x20'+_0xb82b25+',\x20isPhone:\x20'+_0x2d2e21);let _0x564171=(0x0,utils_1[_0x2ceb80(0x196)])();while(!![]){const _0x5b4b83=await this[_0x2ceb80(0x19a)][_0x2ceb80(0x161)]({'username':_0x564171});common_1['Logger'][_0x2ceb80(0x167)](_0x2ceb80(0x17b)+_0x564171+'\x20is\x20taken:\x20'+_0x5b4b83);if(_0x5b4b83)break;_0x564171=(0x0,utils_1[_0x2ceb80(0x196)])();}if(_0xb82b25){_0x163d05=_0x6430d0;const _0x32b58a=await this[_0x2ceb80(0x19a)][_0x2ceb80(0x161)]({'username':_0x564171,'email':_0x163d05});common_1[_0x2ceb80(0x1c4)][_0x2ceb80(0x167)](_0x2ceb80(0x1d2)+_0x163d05+_0x2ceb80(0x19f)+_0x32b58a);if(!_0x32b58a)throw new common_1[(_0x2ceb80(0x1c6))](_0x2ceb80(0x1a5),common_1['HttpStatus'][_0x2ceb80(0x17c)]);}else{if(_0x2d2e21){_0x51f6a7=_0x6430d0;const _0x4a2f7c=await this[_0x2ceb80(0x19a)][_0x2ceb80(0x161)]({'username':_0x564171,'phone':_0x51f6a7});common_1[_0x2ceb80(0x1c4)]['debug']('Phone\x20'+_0x51f6a7+_0x2ceb80(0x19f)+_0x4a2f7c);if(!_0x4a2f7c)throw new common_1[(_0x2ceb80(0x1c6))](_0x2ceb80(0x160),common_1[_0x2ceb80(0x1a6)]['BAD_REQUEST']);}else throw new common_1['HttpException']('请提供有效的邮箱地址或手机号码。',common_1[_0x2ceb80(0x1a6)][_0x2ceb80(0x17c)]);}const _0x37dd11=await this['globalConfigService']['getConfigs'](['noVerifyRegister']);common_1[_0x2ceb80(0x1c4)]['debug']('noVerifyRegister:\x20'+_0x37dd11);if(_0x37dd11!=='1'){const _0x2df02a=await this['globalConfigService'][_0x2ceb80(0x1b9)](),_0x3161d8=_0x2df02a+_0x2ceb80(0x188)+_0x6430d0,_0xb87747=await this[_0x2ceb80(0x170)][_0x2ceb80(0x1bc)]({'key':_0x3161d8});common_1[_0x2ceb80(0x1c4)][_0x2ceb80(0x167)](_0x2ceb80(0x157)+_0x6430d0+':\x20'+_0xb87747);if(_0x324975==='')throw new common_1[(_0x2ceb80(0x1c6))](_0x2ceb80(0x158),common_1[_0x2ceb80(0x1a6)]['BAD_REQUEST']);if(!_0xb87747){common_1[_0x2ceb80(0x1c4)]['log'](_0x2ceb80(0x14e)+_0x6430d0,_0x2ceb80(0x1d5));throw new common_1[(_0x2ceb80(0x1c6))]('验证码已过期，请重新发送！',common_1[_0x2ceb80(0x1a6)][_0x2ceb80(0x17c)]);}if(_0x324975!==_0xb87747){common_1['Logger'][_0x2ceb80(0x191)]('验证码错误:\x20'+_0x6430d0+_0x2ceb80(0x18b)+_0x324975+',\x20期望的验证码:\x20'+_0xb87747,'authService');throw new common_1[(_0x2ceb80(0x1c6))](_0x2ceb80(0x1bd),common_1['HttpStatus'][_0x2ceb80(0x17c)]);}}let _0x402161;if(_0xb82b25)_0x402161={'username':_0x564171,'password':_0x480106,'email':_0x6430d0,'status':user_constant_1['UserStatusEnum']['ACTIVE']};else{const _0x48e09d=(0x0,utils_1[_0x2ceb80(0x196)])()+'@aiweb.com';_0x402161={'username':_0x564171,'password':_0x480106,'email':_0x48e09d,'phone':_0x6430d0,'status':user_constant_1[_0x2ceb80(0x1ae)][_0x2ceb80(0x178)]};}common_1[_0x2ceb80(0x1c4)][_0x2ceb80(0x167)](_0x2ceb80(0x1a7));const _0x1e8827=await this['globalConfigService'][_0x2ceb80(0x15d)]([_0x2ceb80(0x1b5)]);common_1[_0x2ceb80(0x1c4)]['debug']('使用默认用户头像:\x20'+_0x1e8827),_0x402161[_0x2ceb80(0x199)]=_0x1e8827,common_1['Logger'][_0x2ceb80(0x167)](_0x2ceb80(0x15b));const _0x31a44a=bcrypt[_0x2ceb80(0x16e)](_0x480106,0xa);_0x402161[_0x2ceb80(0x1d1)]=_0x31a44a,common_1[_0x2ceb80(0x1c4)][_0x2ceb80(0x167)](_0x2ceb80(0x1c7));const _0x3be067=await this[_0x2ceb80(0x19a)]['createUser'](_0x402161);return common_1[_0x2ceb80(0x1c4)]['debug']('用户创建成功，用户ID:\x20'+_0x3be067['id']),await this[_0x2ceb80(0x18a)][_0x2ceb80(0x1a0)](_0x3be067['id']),common_1['Logger']['debug']('完成新用户余额处理'),{'success':!![],'message':_0x2ceb80(0x187)};}async[_0x43846a(0x1d4)](_0xbc5a78,_0x21d58e){const _0xc46548=_0x43846a;console['log'](_0xc46548(0x14c)+_0xbc5a78[_0xc46548(0x179)]);const _0x5ad302=await this[_0xc46548(0x19a)][_0xc46548(0x151)](_0xbc5a78);if(!_0x5ad302){console[_0xc46548(0x1ac)](_0xc46548(0x174)+_0xbc5a78['username']);throw new common_1[(_0xc46548(0x1c6))](_0xc46548(0x197),common_1['HttpStatus']['UNAUTHORIZED']);}const {username:_0x5b3374,id:_0x57d7ea,email:_0x21e46c,role:_0x3a7b7b,openId:_0x22b129,client:_0x5caa99,phone:_0x83135f}=_0x5ad302;console['log'](_0xc46548(0x1a8)+_0x57d7ea+_0xc46548(0x177)+_0x5b3374);const _0x5ec3b9=(0x0,utils_1[_0xc46548(0x180)])(_0x21d58e);await this[_0xc46548(0x19a)][_0xc46548(0x194)](_0x57d7ea,_0x5ec3b9),console['log'](_0xc46548(0x183)+_0x5ec3b9+_0xc46548(0x155)+_0x57d7ea);const _0x567b41=await this[_0xc46548(0x1a1)]['sign']({'username':_0x5b3374,'id':_0x57d7ea,'email':_0x21e46c,'role':_0x3a7b7b,'openId':_0x22b129,'client':_0x5caa99,'phone':_0x83135f});return console[_0xc46548(0x191)]('JWT令牌生成成功\x20-\x20用户ID:\x20'+_0x57d7ea),await this[_0xc46548(0x170)][_0xc46548(0x1ce)](_0x57d7ea,_0x567b41),console['log']('令牌已保存到Redis\x20-\x20用户ID:\x20'+_0x57d7ea),_0x567b41;}async[_0x43846a(0x185)](_0x4360c6,_0x260ece){const _0x4007a9=_0x43846a,{contact:_0x45fddf,code:_0x49db9}=_0x4360c6;let _0x5b54ee='',_0x4fe853='';const _0x18b692=/\S+@\S+\.\S+/[_0x4007a9(0x1d0)](_0x45fddf),_0x3208ca=/^\d{10,}$/[_0x4007a9(0x1d0)](_0x45fddf);if(_0x18b692)_0x5b54ee=_0x45fddf;else{if(_0x3208ca)_0x4fe853=_0x45fddf;else throw new common_1[(_0x4007a9(0x1c6))](_0x4007a9(0x172),common_1[_0x4007a9(0x1a6)][_0x4007a9(0x17c)]);}if(!![]){if(_0x18b692){const _0x33b221=await this[_0x4007a9(0x19a)]['verifyUserRegister']({'email':_0x45fddf});if(_0x33b221)throw new common_1['HttpException'](_0x4007a9(0x198),common_1[_0x4007a9(0x1a6)]['BAD_REQUEST']);}else{if(_0x3208ca){const _0x58daa8=await this[_0x4007a9(0x19a)][_0x4007a9(0x161)]({'phone':_0x45fddf});if(_0x58daa8)throw new common_1[(_0x4007a9(0x1c6))](_0x4007a9(0x184),common_1[_0x4007a9(0x1a6)][_0x4007a9(0x17c)]);}}}else{if(_0x18b692){const _0x1cae84=await this[_0x4007a9(0x19a)][_0x4007a9(0x161)]({'email':_0x45fddf});if(!_0x1cae84)throw new common_1['HttpException'](_0x4007a9(0x189),common_1[_0x4007a9(0x1a6)]['BAD_REQUEST']);}else{if(_0x3208ca){const _0x48af9b=await this[_0x4007a9(0x19a)][_0x4007a9(0x161)]({'phone':_0x45fddf});if(!_0x48af9b)throw new common_1[(_0x4007a9(0x1c6))](_0x4007a9(0x14d),common_1[_0x4007a9(0x1a6)][_0x4007a9(0x17c)]);}}}const _0x555668=await this[_0x4007a9(0x1c0)][_0x4007a9(0x1b9)](),_0x129c85=_0x555668+_0x4007a9(0x188)+_0x45fddf,_0x1cd76b=await this[_0x4007a9(0x170)][_0x4007a9(0x1bc)]({'key':_0x129c85});if(!_0x1cd76b){common_1[_0x4007a9(0x1c4)][_0x4007a9(0x191)](_0x4007a9(0x14e)+_0x45fddf,'authService');throw new common_1[(_0x4007a9(0x1c6))](_0x4007a9(0x149),common_1[_0x4007a9(0x1a6)][_0x4007a9(0x17c)]);}if(_0x1cd76b!==_0x49db9){common_1[_0x4007a9(0x1c4)]['log'](_0x4007a9(0x1b1)+_0x45fddf,_0x4007a9(0x1d5));throw new common_1['HttpException'](_0x4007a9(0x186),common_1[_0x4007a9(0x1a6)][_0x4007a9(0x17c)]);}const _0x1ad260=await this[_0x4007a9(0x19a)]['getUserByContact']({'email':_0x5b54ee,'phone':_0x4fe853});if(!_0x1ad260)throw new common_1[(_0x4007a9(0x1c6))]('用户不存在，请先注册！',common_1[_0x4007a9(0x1a6)]['NOT_FOUND']);if(_0x1ad260[_0x4007a9(0x1a3)]!==user_constant_1[_0x4007a9(0x1ae)][_0x4007a9(0x178)])throw new common_1[(_0x4007a9(0x1c6))](user_constant_1[_0x4007a9(0x1b3)][_0x1ad260[_0x4007a9(0x1a3)]],common_1[_0x4007a9(0x1a6)][_0x4007a9(0x17c)]);const {username:_0x47f10f,id:_0x31db51,role:_0xcc68cd,openId:_0x14fa0c,client:_0x5e4e6b}=_0x1ad260,_0x51531d=(0x0,utils_1[_0x4007a9(0x180)])(_0x260ece);await this['userService'][_0x4007a9(0x194)](_0x31db51,_0x51531d);const _0x16dc07=await this['jwtService'][_0x4007a9(0x1a4)]({'username':_0x47f10f,'id':_0x31db51,'email':_0x5b54ee,'role':_0xcc68cd,'openId':_0x14fa0c,'client':_0x5e4e6b,'phone':_0x4fe853});return await this[_0x4007a9(0x170)][_0x4007a9(0x1ce)](_0x31db51,_0x16dc07),await this[_0x4007a9(0x170)]['del'](_0x129c85),_0x16dc07;}async['loginByOpenId'](_0x4bb776,_0x1ebff6){const _0x1d4163=_0x43846a,{status:_0xaff366}=_0x4bb776;if(_0xaff366!==user_constant_1['UserStatusEnum'][_0x1d4163(0x178)])throw new common_1[(_0x1d4163(0x1c6))](user_constant_1[_0x1d4163(0x1b3)][_0xaff366],common_1['HttpStatus'][_0x1d4163(0x17c)]);const {username:_0x1fa75d,id:_0x557094,email:_0x3e5beb,role:_0x22dcdc,openId:_0x49e3f4,client:_0x9f19b5}=_0x4bb776,_0x4d0cb2=(0x0,utils_1[_0x1d4163(0x180)])(_0x1ebff6);await this[_0x1d4163(0x19a)][_0x1d4163(0x194)](_0x557094,_0x4d0cb2);const _0x324dea=await this[_0x1d4163(0x1a1)]['sign']({'username':_0x1fa75d,'id':_0x557094,'email':_0x3e5beb,'role':_0x22dcdc,'openId':_0x49e3f4,'client':_0x9f19b5});return await this[_0x1d4163(0x170)][_0x1d4163(0x1ce)](_0x557094,_0x324dea),_0x324dea;}async[_0x43846a(0x1be)](_0x159b53){const _0x13ee49=_0x43846a,{id:_0x2cefa2}=_0x159b53[_0x13ee49(0x1c8)];return await this[_0x13ee49(0x19a)][_0x13ee49(0x166)](_0x2cefa2);}async[_0x43846a(0x1cd)](_0x4044b3,_0x33696d){const _0x1f0c4a=_0x43846a,{id:_0x3f0cdb}=_0x4044b3[_0x1f0c4a(0x1c8)];return this[_0x1f0c4a(0x19a)][_0x1f0c4a(0x159)](_0x3f0cdb,_0x33696d[_0x1f0c4a(0x1d1)]),'密码修改成功';}[_0x43846a(0x15f)](){const _0x3666c7=_0x43846a;let _0x212b68;const _0x116293=os[_0x3666c7(0x1bb)]();Object[_0x3666c7(0x14f)](_0x116293)['forEach'](_0x546f33=>{const _0x34f66a=_0x3666c7,_0x3d5629=_0x116293[_0x546f33];for(let _0x2d9a57=0x0;_0x2d9a57<_0x3d5629[_0x34f66a(0x14b)];_0x2d9a57++){const _0x5185ae=_0x3d5629[_0x2d9a57];if(_0x5185ae[_0x34f66a(0x1c1)]===_0x34f66a(0x1a2)&&_0x5185ae[_0x34f66a(0x1c2)]!==_0x34f66a(0x1b0)&&!_0x5185ae[_0x34f66a(0x15e)]){_0x212b68=_0x5185ae[_0x34f66a(0x1c2)];break;}}}),this[_0x3666c7(0x1d6)]=_0x212b68;}async['sendCode'](_0x495538){const _0x2a534a=_0x43846a,{contact:_0x1db3cd,isLogin:_0x1ae145}=_0x495538,_0x39c523=(0x0,utils_1['createRandomCode'])(),_0x495ad1=/\S+@\S+\.\S+/[_0x2a534a(0x1d0)](_0x1db3cd),_0x3c3141=/^1\d{10}$/[_0x2a534a(0x1d0)](_0x1db3cd);if(!_0x495ad1&&!_0x3c3141)throw new common_1[(_0x2a534a(0x1c6))](_0x2a534a(0x172),common_1[_0x2a534a(0x1a6)][_0x2a534a(0x17c)]);if(_0x1ae145){if(_0x495ad1){const _0x4189fb=await this[_0x2a534a(0x19a)]['verifyUserRegister']({'email':_0x1db3cd});if(_0x4189fb)throw new common_1[(_0x2a534a(0x1c6))](_0x2a534a(0x198),common_1[_0x2a534a(0x1a6)][_0x2a534a(0x17c)]);}else{if(_0x3c3141){const _0x47df30=await this[_0x2a534a(0x19a)][_0x2a534a(0x161)]({'phone':_0x1db3cd});if(_0x47df30)throw new common_1[(_0x2a534a(0x1c6))](_0x2a534a(0x184),common_1[_0x2a534a(0x1a6)][_0x2a534a(0x17c)]);}}}else{if(_0x495ad1){const _0x3af43b=await this[_0x2a534a(0x19a)][_0x2a534a(0x161)]({'email':_0x1db3cd});if(!_0x3af43b)throw new common_1['HttpException'](_0x2a534a(0x189),common_1[_0x2a534a(0x1a6)][_0x2a534a(0x17c)]);}else{if(_0x3c3141){const _0x247468=await this[_0x2a534a(0x19a)][_0x2a534a(0x161)]({'phone':_0x1db3cd});if(!_0x247468)throw new common_1[(_0x2a534a(0x1c6))]('该手机号已注册，请直接登录！',common_1[_0x2a534a(0x1a6)][_0x2a534a(0x17c)]);}}}const _0x42fa29=await this[_0x2a534a(0x1c0)][_0x2a534a(0x1b9)](),_0x431004=_0x42fa29+_0x2a534a(0x188)+_0x1db3cd,_0x5bd814=_0x42fa29+_0x2a534a(0x19e)+_0x1db3cd,_0x324f17=await this[_0x2a534a(0x170)]['ttl'](_0x431004);if(_0x324f17&&_0x324f17>0x0)throw new common_1[(_0x2a534a(0x1c6))](_0x324f17+_0x2a534a(0x19d),common_1[_0x2a534a(0x1a6)]['BAD_REQUEST']);const _0x372441=await this[_0x2a534a(0x170)][_0x2a534a(0x1bc)]({'key':_0x5bd814})||0x0;if(_0x372441>=0xa)throw new common_1[(_0x2a534a(0x1c6))](_0x2a534a(0x1b7),common_1[_0x2a534a(0x1a6)][_0x2a534a(0x163)]);if(_0x495ad1)await this[_0x2a534a(0x19c)]['sendMail']({'to':_0x1db3cd,'context':{'code':_0x39c523}});else{if(_0x3c3141){const _0x4ba5a2={'phone':_0x1db3cd,'code':_0x39c523};await this['verificationService'][_0x2a534a(0x15c)](_0x4ba5a2);}}return await this[_0x2a534a(0x170)][_0x2a534a(0x1bf)]({'key':_0x431004,'val':_0x39c523},0x5*0x3c),await this[_0x2a534a(0x170)][_0x2a534a(0x1bf)]({'key':_0x5bd814,'val':Number(_0x372441)+0x1},0x18*0x3c*0x3c),await this[_0x2a534a(0x170)][_0x2a534a(0x1bf)]({'key':_0x431004,'val':_0x39c523},0x3c),_0x2a534a(0x1b6)+(_0x1ae145?'注册':'验证')+'！';}[_0x43846a(0x150)](_0x333fd1){const _0x4961d5=_0x43846a,_0x5b0370=this['jwtService'][_0x4961d5(0x1a4)]({'username':'游客'+_0x333fd1,'id':_0x333fd1,'email':_0x333fd1+'@visitor.com','role':'visitor','openId':null,'client':null});return _0x5b0370;}async[_0x43846a(0x1cc)](_0x28e691,_0x3d5ab3){const _0x1861d7=_0x43846a;common_1[_0x1861d7(0x1c4)][_0x1861d7(0x167)](_0x1861d7(0x164));const {name:_0x119d57,idCard:_0x2ecd4e}=_0x3d5ab3,{id:_0x4f3ea6}=_0x28e691[_0x1861d7(0x1c8)];try{const _0x683473=await this[_0x1861d7(0x190)][_0x1861d7(0x1cc)](_0x3d5ab3);common_1[_0x1861d7(0x1c4)][_0x1861d7(0x167)](_0x1861d7(0x173)+_0x683473);if(!_0x683473)throw new common_1[(_0x1861d7(0x1c6))]('身份验证错误，请检查实名信息',common_1[_0x1861d7(0x1a6)][_0x1861d7(0x17c)]);return await this[_0x1861d7(0x19a)][_0x1861d7(0x1c9)](_0x4f3ea6,_0x119d57,_0x2ecd4e),_0x1861d7(0x1a9);}catch(_0x3a36a3){common_1[_0x1861d7(0x1c4)][_0x1861d7(0x1ac)](_0x1861d7(0x193),_0x3a36a3);throw new common_1['HttpException'](_0x1861d7(0x176),common_1[_0x1861d7(0x1a6)][_0x1861d7(0x17c)]);}}async[_0x43846a(0x18f)](_0x4d8ad2,_0xb9a2c1){const _0x8898f6=_0x43846a;common_1['Logger']['debug']('开始手机号认证流程');const {phone:_0x160080,username:_0x518835,password:_0x21aa49,code:_0x2913ee}=_0xb9a2c1,{id:_0xcefcfd}=_0x4d8ad2[_0x8898f6(0x1c8)],_0x4d7ba0=this[_0x8898f6(0x1c0)][_0x8898f6(0x1b9)](),_0x4f5b11=_0x4d7ba0+_0x8898f6(0x188)+_0x160080,_0x5311a5=await this[_0x8898f6(0x170)]['get']({'key':_0x4f5b11});common_1[_0x8898f6(0x1c4)][_0x8898f6(0x167)](_0x8898f6(0x157)+_0x160080+':\x20'+_0x5311a5);if(_0x2913ee==='')throw new common_1[(_0x8898f6(0x1c6))](_0x8898f6(0x158),common_1[_0x8898f6(0x1a6)][_0x8898f6(0x17c)]);if(!_0x5311a5){common_1[_0x8898f6(0x1c4)][_0x8898f6(0x191)](_0x8898f6(0x14e)+_0x160080,_0x8898f6(0x1d5));throw new common_1['HttpException'](_0x8898f6(0x149),common_1[_0x8898f6(0x1a6)][_0x8898f6(0x17c)]);}if(_0x2913ee!==_0x5311a5){common_1['Logger'][_0x8898f6(0x191)](_0x8898f6(0x1b1)+_0x160080+_0x8898f6(0x18b)+_0x2913ee+_0x8898f6(0x152)+_0x5311a5,_0x8898f6(0x1d5));throw new common_1[(_0x8898f6(0x1c6))](_0x8898f6(0x1bd),common_1['HttpStatus'][_0x8898f6(0x17c)]);}if(_0x518835){const _0xe403eb=await this[_0x8898f6(0x19a)][_0x8898f6(0x154)](_0xb9a2c1[_0x8898f6(0x179)],_0xcefcfd);if(_0xe403eb)throw new common_1[(_0x8898f6(0x1c6))](_0x8898f6(0x175),common_1[_0x8898f6(0x1a6)]['BAD_REQUEST']);}try{return await this['userService'][_0x8898f6(0x1b4)](_0xcefcfd,_0x160080,_0x518835,_0x21aa49),'认证成功';}catch(_0x54f3bc){common_1[_0x8898f6(0x1c4)][_0x8898f6(0x1ac)](_0x8898f6(0x193),_0x54f3bc);throw new common_1['HttpException'](_0x8898f6(0x16d),common_1['HttpStatus'][_0x8898f6(0x17c)]);}}};AuthService=__decorate([(0x0,common_1[_0x43846a(0x17f)])(),__param(0x0,(0x0,typeorm_1[_0x43846a(0x14a)])(config_entity_1[_0x43846a(0x1c3)])),__metadata('design:paramtypes',[typeorm_2[_0x43846a(0x1ad)],user_service_1[_0x43846a(0x16c)],jwt_1[_0x43846a(0x1cf)],mailer_service_1['MailerService'],verification_service_1[_0x43846a(0x169)],userBalance_service_1[_0x43846a(0x1b8)],redisCache_service_1[_0x43846a(0x16a)],globalConfig_service_1[_0x43846a(0x17d)]])],AuthService),exports['AuthService']=AuthService;function _0x171f(_0x215cf1,_0x132d4d){const _0x38f976=_0x38f9();return _0x171f=function(_0x171f28,_0x322f24){_0x171f28=_0x171f28-0x149;let _0x3879d0=_0x38f976[_0x171f28];return _0x3879d0;},_0x171f(_0x215cf1,_0x132d4d);}function _0x38f9(){const _0x4f9326=['9760158Hvkmlf','请提供有效的邮箱地址或手机号码。','实名认证结果:\x20','登录失败:\x20用户凭证无效\x20-\x20用户名:\x20','用户名已存在！','认证失败，请检查相关信息',',\x20用户名:\x20','ACTIVE','username','24488MKSjKf','Checking\x20if\x20username\x20','BAD_REQUEST','GlobalConfigService','@nestjs/common','Injectable','getClientIp','580lsuDrA','decorate','保存登录IP:\x20','该手机号未注册，请先注册！','loginWithCaptcha','验证码错误，请重新输入！','注册成功',':CODE:','该邮箱已注册，请直接登录！','userBalanceService','\x20输入的验证码:\x20','./../verification/verification.service','../../common/constants/user.constant','../user/user.service','verifyPhoneIdentity','verificationService','log','228930UtvzTe','验证过程出现错误','savaLoginIp','8dBRNtC','createRandomUid','登录失败，用户凭证无效。','该邮箱未注册，请先注册！','avatar','userService','21DQjlLq','mailerService','秒内不得重复发送验证码！',':RATE_LIMIT:','\x20is\x20available:\x20','addBalanceToNewUser','jwtService','IPv4','status','sign','当前邮箱已注册，请勿重复注册！','HttpStatus','获取默认用户头像...','用户凭证验证成功，用户ID:\x20','认证成功','204986RUZsqZ','defineProperty','error','Repository','UserStatusEnum','object','127.0.0.1','验证码错误:\x20','typeorm','UserStatusErrMsg','updateUserPhone','userDefautlAvatar','验证码发送成功、请填写验证码完成','今日发送验证码次数已达上限，请24小时后再试！','UserBalanceService','getNamespace','function','networkInterfaces','get','验证码填写错误，请重新输入！','getInfo','set','globalConfigService','family','address','ConfigEntity','Logger','1267420hlHNjU','HttpException','保存新用户到数据库...','user','saveRealNameInfo','register','__metadata','verifyIdentity','updatePassword','saveToken','JwtService','test','password','Email\x20','../globalConfig/globalConfig.service','login','authService','ipAddress','验证码已过期，请重新发送！','InjectRepository','length','开始用户登录流程，用户名:\x20','该手机号已注册，请直接登录！','验证码过期:\x20','keys','createTokenFromFingerprint','verifyUserCredentials',',\x20期望的验证码:\x20','metadata','isUsernameTaken','\x20-\x20用户ID:\x20','@nestjs/typeorm','Retrieved\x20redisCode\x20for\x20','请输入验证码','updateUserPassword','274977rTmUcS','加密用户密码...','sendPhoneCode','getConfigs','internal','getIp','当前手机号已注册，请勿重复注册！','verifyUserRegister','5720218LbzAID','TOO_MANY_REQUESTS','开始实名认证流程','../../common/utils','getUserInfo','debug','getOwnPropertyDescriptor','VerificationService','RedisCacheService','../userBalance/userBalance.service','UserService','身份验证错误，请检查相关信息','hashSync','__esModule','redisCacheService'];_0x38f9=function(){return _0x4f9326;};return _0x38f9();}