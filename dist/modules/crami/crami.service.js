'use strict';const _0x329194=_0x1ce1;(function(_0x4d9635,_0x11ea11){const _0x3dda7f=_0x1ce1,_0x37912b=_0x4d9635();while(!![]){try{const _0xbe2015=parseInt(_0x3dda7f(0x1d1))/0x1+-parseInt(_0x3dda7f(0x1dc))/0x2+-parseInt(_0x3dda7f(0x1f1))/0x3+parseInt(_0x3dda7f(0x1bb))/0x4*(parseInt(_0x3dda7f(0x1c5))/0x5)+parseInt(_0x3dda7f(0x19a))/0x6*(parseInt(_0x3dda7f(0x1c3))/0x7)+parseInt(_0x3dda7f(0x1bc))/0x8*(parseInt(_0x3dda7f(0x1d7))/0x9)+-parseInt(_0x3dda7f(0x19e))/0xa*(parseInt(_0x3dda7f(0x1a5))/0xb);if(_0xbe2015===_0x11ea11)break;else _0x37912b['push'](_0x37912b['shift']());}catch(_0x363083){_0x37912b['push'](_0x37912b['shift']());}}}(_0x5e65,0x8b368));var __decorate=this&&this[_0x329194(0x1da)]||function(_0x4a3ea8,_0x22a8f9,_0x311393,_0x2afb4e){const _0xd512ef=_0x329194;var _0x25b105=arguments[_0xd512ef(0x1e0)],_0x2df2b5=_0x25b105<0x3?_0x22a8f9:_0x2afb4e===null?_0x2afb4e=Object[_0xd512ef(0x1ce)](_0x22a8f9,_0x311393):_0x2afb4e,_0x3bc40e;if(typeof Reflect===_0xd512ef(0x1be)&&typeof Reflect[_0xd512ef(0x1d3)]===_0xd512ef(0x1ab))_0x2df2b5=Reflect[_0xd512ef(0x1d3)](_0x4a3ea8,_0x22a8f9,_0x311393,_0x2afb4e);else{for(var _0x240b31=_0x4a3ea8['length']-0x1;_0x240b31>=0x0;_0x240b31--)if(_0x3bc40e=_0x4a3ea8[_0x240b31])_0x2df2b5=(_0x25b105<0x3?_0x3bc40e(_0x2df2b5):_0x25b105>0x3?_0x3bc40e(_0x22a8f9,_0x311393,_0x2df2b5):_0x3bc40e(_0x22a8f9,_0x311393))||_0x2df2b5;}return _0x25b105>0x3&&_0x2df2b5&&Object[_0xd512ef(0x1c7)](_0x22a8f9,_0x311393,_0x2df2b5),_0x2df2b5;},__metadata=this&&this[_0x329194(0x1ba)]||function(_0x138a47,_0x46f141){const _0x2b7a35=_0x329194;if(typeof Reflect==='object'&&typeof Reflect[_0x2b7a35(0x1f4)]===_0x2b7a35(0x1ab))return Reflect[_0x2b7a35(0x1f4)](_0x138a47,_0x46f141);},__param=this&&this[_0x329194(0x1e6)]||function(_0x4f30fe,_0x586bc7){return function(_0x5012c9,_0x935e0b){_0x586bc7(_0x5012c9,_0x935e0b,_0x4f30fe);};};Object[_0x329194(0x1c7)](exports,_0x329194(0x1eb),{'value':!![]}),exports['CramiService']=void 0x0;function _0x1ce1(_0x572ea3,_0x16d249){const _0x5e657b=_0x5e65();return _0x1ce1=function(_0x1ce1e0,_0x119aba){_0x1ce1e0=_0x1ce1e0-0x19a;let _0x53e4cc=_0x5e657b[_0x1ce1e0];return _0x53e4cc;},_0x1ce1(_0x572ea3,_0x16d249);}const common_1=require(_0x329194(0x1e5)),crami_entity_1=require(_0x329194(0x1d4)),typeorm_1=require(_0x329194(0x1f5)),typeorm_2=require(_0x329194(0x1b5)),cramiPackage_entity_1=require('./cramiPackage.entity'),utils_1=require(_0x329194(0x1ac)),user_entity_1=require('../user/user.entity'),userBalance_service_1=require(_0x329194(0x1f8)),balance_constant_1=require(_0x329194(0x1e8));let CramiService=class CramiService{constructor(_0x393324,_0x6714aa,_0x3dba80,_0x1b2eaa){const _0x496d1c=_0x329194;this['cramiEntity']=_0x393324,this[_0x496d1c(0x1fa)]=_0x6714aa,this[_0x496d1c(0x1b9)]=_0x3dba80,this[_0x496d1c(0x1f9)]=_0x1b2eaa;}async[_0x329194(0x1e4)](_0x302db7){const _0x5446ba=_0x329194;return await this[_0x5446ba(0x1fa)][_0x5446ba(0x1d9)]({'where':{'id':_0x302db7}});}async[_0x329194(0x1ed)](_0x2815ce){const _0x321ae9=_0x329194;try{const {page:page=0x1,size:size=0xa,name:_0x2b8dd8,status:_0x45f5c3,type:_0x4e8b31}=_0x2815ce,_0x56ad30={};_0x2b8dd8&&Object[_0x321ae9(0x1c4)](_0x56ad30,{'name':(0x0,typeorm_2['Like'])('%'+_0x2b8dd8+'%')}),_0x45f5c3&&Object[_0x321ae9(0x1c4)](_0x56ad30,{'status':_0x45f5c3});_0x4e8b31&&(_0x4e8b31>0x0?Object[_0x321ae9(0x1c4)](_0x56ad30,{'days':(0x0,typeorm_2[_0x321ae9(0x1a0)])(0x0)}):Object[_0x321ae9(0x1c4)](_0x56ad30,{'days':(0x0,typeorm_2[_0x321ae9(0x1ca)])(0x0)}));const [_0xd29125,_0x131aa0]=await this['cramiPackageEntity'][_0x321ae9(0x1d6)]({'skip':(page-0x1)*size,'take':size,'where':_0x56ad30,'order':{'order':_0x321ae9(0x1db)}});return{'rows':_0xd29125,'count':_0x131aa0};}catch(_0x55278d){console['log'](_0x321ae9(0x1f7),_0x55278d);}}async[_0x329194(0x1e9)](_0x4bb1a5){const _0x51e5f5=_0x329194,{name:_0x3ad4d9,weight:_0x2fcfa5}=_0x4bb1a5,_0x3c7e73=await this[_0x51e5f5(0x1fa)][_0x51e5f5(0x1d9)]({'where':[{'name':_0x3ad4d9},{'weight':_0x2fcfa5}]});if(_0x3c7e73)throw new common_1[(_0x51e5f5(0x1b2))](_0x51e5f5(0x1c2),common_1[_0x51e5f5(0x19f)][_0x51e5f5(0x1a4)]);try{return await this['cramiPackageEntity'][_0x51e5f5(0x1cb)](_0x4bb1a5);}catch(_0x43f657){console[_0x51e5f5(0x1a3)](_0x51e5f5(0x1f7),_0x43f657);throw new common_1[(_0x51e5f5(0x1b2))](_0x43f657,common_1[_0x51e5f5(0x19f)]['BAD_REQUEST']);}}async[_0x329194(0x1d5)](_0xe526f1){const _0x1126e1=_0x329194,{id:_0x4c01b3,name:_0x4ba7ab,weight:_0x3e1f7a}=_0xe526f1,_0x40d78c=await this['cramiPackageEntity'][_0x1126e1(0x1d9)]({'where':{'id':_0x4c01b3}});if(!_0x40d78c)throw new common_1['HttpException'](_0x1126e1(0x1e7),common_1[_0x1126e1(0x19f)][_0x1126e1(0x1a4)]);const _0x3b6cb7=await this[_0x1126e1(0x1fa)][_0x1126e1(0x1cd)]({'where':[{'name':_0x4ba7ab,'id':(0x0,typeorm_2[_0x1126e1(0x1bd)])(_0x4c01b3)},{'weight':_0x3e1f7a,'id':(0x0,typeorm_2[_0x1126e1(0x1bd)])(_0x4c01b3)}]});if(_0x3b6cb7)throw new common_1[(_0x1126e1(0x1b2))](_0x1126e1(0x1c2),common_1[_0x1126e1(0x19f)][_0x1126e1(0x1a4)]);const _0x2c30c2=await this[_0x1126e1(0x1fa)][_0x1126e1(0x1ec)]({'id':_0x4c01b3},_0xe526f1);if(_0x2c30c2[_0x1126e1(0x19d)]>0x0)return _0x1126e1(0x1c9);else throw new common_1[(_0x1126e1(0x1b2))](_0x1126e1(0x1c0),common_1[_0x1126e1(0x19f)][_0x1126e1(0x1a4)]);}async[_0x329194(0x1e2)](_0x429b68){const _0x1b774b=_0x329194,{id:_0x4f2248}=_0x429b68,_0x4232a2=await this[_0x1b774b(0x1b1)][_0x1b774b(0x1cd)]({'where':{'packageId':_0x4f2248}});if(_0x4232a2)throw new common_1[(_0x1b774b(0x1b2))]('当前套餐下存在卡密、请先删除卡密后才可删除套餐！',common_1[_0x1b774b(0x19f)][_0x1b774b(0x1a4)]);return await this['cramiPackageEntity'][_0x1b774b(0x1f3)]({'id':_0x4f2248});}async[_0x329194(0x1a6)](_0x1d7da0){const _0x54d6b2=_0x329194,{packageId:_0xf539d4,count:count=0x1}=_0x1d7da0;if(_0xf539d4){const _0x59ccde=await this[_0x54d6b2(0x1fa)][_0x54d6b2(0x1d9)]({'where':{'id':_0xf539d4}});if(!_0x59ccde)throw new common_1[(_0x54d6b2(0x1b2))](_0x54d6b2(0x1aa),common_1[_0x54d6b2(0x19f)][_0x54d6b2(0x1a4)]);const {days:days=-0x1,model3Count:model3Count=0x0,model4Count:model4Count=0x0,drawMjCount:drawMjCount=0x0}=_0x59ccde,_0x69d668={'packageId':_0xf539d4,'days':days,'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount};return await this['generateCrami'](_0x69d668,count);}if(!_0xf539d4){const {model3Count:model3Count=0x0,model4Count:model4Count=0x0,drawMjCount:drawMjCount=0x0}=_0x1d7da0;if([model3Count,model4Count,drawMjCount][_0x54d6b2(0x1e3)](_0x42dad2=>!_0x42dad2))throw new common_1[(_0x54d6b2(0x1b2))]('自定义卡密必须至少一项余额不为0️零！',common_1[_0x54d6b2(0x19f)][_0x54d6b2(0x1a4)]);const _0x2e9f5c={'days':-0x1,'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount};return await this[_0x54d6b2(0x1dd)](_0x2e9f5c,count);}}async['generateCrami'](_0x44edf4,_0x3a2363){const _0x4ec9c6=_0x329194,_0x31ef32=[];for(let _0x2d0ff5=0x0;_0x2d0ff5<_0x3a2363;_0x2d0ff5++){const _0x442822=(0x0,utils_1[_0x4ec9c6(0x1df)])(),_0x314c1b=this[_0x4ec9c6(0x1b1)]['create'](Object[_0x4ec9c6(0x1c4)](Object[_0x4ec9c6(0x1c4)]({},_0x44edf4),{'code':_0x442822}));_0x31ef32[_0x4ec9c6(0x1ae)](_0x314c1b);}return await this[_0x4ec9c6(0x1b1)][_0x4ec9c6(0x1cb)](_0x31ef32);}async[_0x329194(0x1b0)](_0x38d61e,_0x1964f0){const _0xa9ed02=_0x329194,{id:_0x325ceb}=_0x38d61e[_0xa9ed02(0x1a7)],_0x5978e5=await this[_0xa9ed02(0x1b1)]['findOne']({'where':{'code':_0x1964f0[_0xa9ed02(0x1c8)]}});if(!_0x5978e5)throw new common_1[(_0xa9ed02(0x1b2))](_0xa9ed02(0x1b7),common_1[_0xa9ed02(0x19f)][_0xa9ed02(0x1a4)]);const {status:_0x3dabdb,days:days=-0x1,model3Count:model3Count=0x0,model4Count:model4Count=0x0,drawMjCount:drawMjCount=0x0,packageId:_0x3d481f}=_0x5978e5;if(_0x3dabdb===0x1)throw new common_1['HttpException'](_0xa9ed02(0x19b),common_1[_0xa9ed02(0x19f)][_0xa9ed02(0x1a4)]);const _0x12e3fd={'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount,'packageId':_0x3d481f};return await this[_0xa9ed02(0x1f9)][_0xa9ed02(0x19c)](_0x325ceb,Object[_0xa9ed02(0x1c4)]({},_0x12e3fd),days),await this[_0xa9ed02(0x1f9)]['saveRecordRechargeLog']({'userId':_0x325ceb,'rechargeType':balance_constant_1[_0xa9ed02(0x1e1)][_0xa9ed02(0x1ee)],'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount,'days':days}),await this[_0xa9ed02(0x1b1)][_0xa9ed02(0x1ec)]({'code':_0x1964f0[_0xa9ed02(0x1c8)]},{'useId':_0x325ceb,'status':0x1}),_0xa9ed02(0x1b3);}async['queryAllCrami'](_0x1e5259,_0x1bb8f2){const _0x3e66a0=_0x329194,{page:page=0x1,size:size=0xa,status:_0x44d0a2,useId:_0x5a03d8}=_0x1e5259,_0x90d434={};_0x44d0a2&&Object['assign'](_0x90d434,{'status':_0x44d0a2}),_0x5a03d8&&Object['assign'](_0x90d434,{'useId':_0x5a03d8});const [_0x563e22,_0x488d72]=await this[_0x3e66a0(0x1b1)][_0x3e66a0(0x1d6)]({'skip':(page-0x1)*size,'take':size,'order':{'createdAt':_0x3e66a0(0x1db)},'where':_0x90d434}),_0x4f13d3=_0x563e22['map'](_0x40bcd3=>_0x40bcd3[_0x3e66a0(0x1f0)]),_0x13e86e=_0x563e22[_0x3e66a0(0x1ef)](_0x2e5d0b=>_0x2e5d0b[_0x3e66a0(0x1b6)]),_0x51aa46=await this['userEntity']['find']({'where':{'id':(0x0,typeorm_2['In'])(_0x4f13d3)}}),_0x35615c=await this['cramiPackageEntity'][_0x3e66a0(0x1c6)]({'where':{'id':(0x0,typeorm_2['In'])(_0x13e86e)}});return _0x563e22[_0x3e66a0(0x1b4)](_0x34916e=>{const _0x3b83aa=_0x3e66a0;var _0x5a11f6,_0x3377a5,_0x2d29f8;_0x34916e['username']=(_0x5a11f6=_0x51aa46[_0x3b83aa(0x1c6)](_0x53c34a=>_0x53c34a['id']===_0x34916e[_0x3b83aa(0x1f0)]))===null||_0x5a11f6===void 0x0?void 0x0:_0x5a11f6[_0x3b83aa(0x1ad)],_0x34916e[_0x3b83aa(0x1f2)]=(_0x3377a5=_0x51aa46[_0x3b83aa(0x1c6)](_0x59d21d=>_0x59d21d['id']===_0x34916e[_0x3b83aa(0x1f0)]))===null||_0x3377a5===void 0x0?void 0x0:_0x3377a5[_0x3b83aa(0x1f2)],_0x34916e['packageName']=(_0x2d29f8=_0x35615c[_0x3b83aa(0x1c6)](_0x58ec08=>_0x58ec08['id']===_0x34916e[_0x3b83aa(0x1b6)]))===null||_0x2d29f8===void 0x0?void 0x0:_0x2d29f8[_0x3b83aa(0x1d2)];}),_0x1bb8f2['user'][_0x3e66a0(0x1a8)]!=='super'&&_0x563e22[_0x3e66a0(0x1b4)](_0xb3f68d=>_0xb3f68d[_0x3e66a0(0x1f2)]=(0x0,utils_1['maskEmail'])(_0xb3f68d['email'])),_0x1bb8f2['user'][_0x3e66a0(0x1a8)]!=='super'&&_0x563e22[_0x3e66a0(0x1b4)](_0x14b03f=>_0x14b03f['code']=(0x0,utils_1[_0x3e66a0(0x1cf)])(_0x14b03f[_0x3e66a0(0x1c8)])),{'rows':_0x563e22,'count':_0x488d72};}async[_0x329194(0x1d8)](_0x22541e){const _0x4fb9b6=_0x329194,_0x1bc2cb=await this[_0x4fb9b6(0x1b1)][_0x4fb9b6(0x1d9)]({'where':{'id':_0x22541e}});if(!_0x1bc2cb)throw new common_1[(_0x4fb9b6(0x1b2))]('当前卡密不存在、请确认您要删除的卡密是否存在！',common_1['HttpStatus'][_0x4fb9b6(0x1a4)]);if(_0x1bc2cb[_0x4fb9b6(0x1a2)]===0x1)throw new common_1[(_0x4fb9b6(0x1b2))](_0x4fb9b6(0x1c1),common_1[_0x4fb9b6(0x19f)]['BAD_REQUEST']);return await this[_0x4fb9b6(0x1b1)]['delete']({'id':_0x22541e});}async[_0x329194(0x1a9)](_0x3e2630){const _0x2ab435=_0x329194,{ids:_0x1cee5b}=_0x3e2630,_0x39c289=await this['cramiEntity'][_0x2ab435(0x1f3)](_0x1cee5b);if(_0x39c289[_0x2ab435(0x19d)]>0x0)return _0x2ab435(0x1cc);else throw new common_1[(_0x2ab435(0x1b2))](_0x2ab435(0x1af),common_1[_0x2ab435(0x19f)][_0x2ab435(0x1a4)]);}};CramiService=__decorate([(0x0,common_1[_0x329194(0x1a1)])(),__param(0x0,(0x0,typeorm_1[_0x329194(0x1f6)])(crami_entity_1[_0x329194(0x1bf)])),__param(0x1,(0x0,typeorm_1[_0x329194(0x1f6)])(cramiPackage_entity_1[_0x329194(0x1ea)])),__param(0x2,(0x0,typeorm_1['InjectRepository'])(user_entity_1[_0x329194(0x1b8)])),__metadata('design:paramtypes',[typeorm_2[_0x329194(0x1d0)],typeorm_2[_0x329194(0x1d0)],typeorm_2['Repository'],userBalance_service_1['UserBalanceService']])],CramiService),exports[_0x329194(0x1de)]=CramiService;function _0x5e65(){const _0x60c91f=['Not','object','CramiEntity','更新套餐失败、请重试！','当前卡密已被使用、已使用的卡密禁止删除！','套餐名称或套餐等级重复、请检查！','4446519YhSvoL','assign','15QXejxn','find','defineProperty','code','更新套餐成功！','LessThanOrEqual','save','删除卡密成功！','count','getOwnPropertyDescriptor','maskCrami','Repository','266342jpUfav','name','decorate','./crami.entity','updatePackage','findAndCount','1899YtulVd','delCrami','findOne','__decorate','DESC','1057848GFEzIp','generateCrami','CramiService','generateCramiCode','length','RechargeType','delPackage','every','queryOnePackage','@nestjs/common','__param','当前套餐不存在、请检查你的输入参数！','../../common/constants/balance.constant','createPackage','CramiPackageEntity','__esModule','update','queryAllPackage','PACKAGE_GIFT','map','useId','1445421WDILjg','email','delete','metadata','@nestjs/typeorm','InjectRepository','error:\x20','../userBalance/userBalance.service','userBalanceService','cramiPackageEntity','6EROCts','当前卡密已被使用、请确认您输入的卡密是否正确！','addBalanceToUser','affected','50YwJCby','HttpStatus','MoreThan','Injectable','status','log','BAD_REQUEST','280863GsZEzg','createCrami','user','role','batchDelCrami','当前套餐不存在、请确认您选择的套餐是否存在！','function','../../common/utils','username','push','删除卡密失败、请重试！','useCrami','cramiEntity','HttpException','使用卡密成功','forEach','typeorm','packageId','当前卡密不存在、请确认您输入的卡密是否正确！','UserEntity','userEntity','__metadata','148796BmjIrZ','26368aeKHxx'];_0x5e65=function(){return _0x60c91f;};return _0x5e65();}