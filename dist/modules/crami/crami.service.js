'use strict';function _0x3d2a(_0x1e2be2,_0x518506){const _0x290092=_0x2900();return _0x3d2a=function(_0x3d2ae0,_0x4bdb01){_0x3d2ae0=_0x3d2ae0-0x12f;let _0x84687b=_0x290092[_0x3d2ae0];return _0x84687b;},_0x3d2a(_0x1e2be2,_0x518506);}const _0x350841=_0x3d2a;(function(_0x299206,_0x34edde){const _0x110dee=_0x3d2a,_0x99571d=_0x299206();while(!![]){try{const _0x45a4c0=-parseInt(_0x110dee(0x178))/0x1+parseInt(_0x110dee(0x17a))/0x2+-parseInt(_0x110dee(0x13f))/0x3+parseInt(_0x110dee(0x13d))/0x4*(-parseInt(_0x110dee(0x15f))/0x5)+-parseInt(_0x110dee(0x143))/0x6*(-parseInt(_0x110dee(0x15a))/0x7)+-parseInt(_0x110dee(0x163))/0x8*(parseInt(_0x110dee(0x156))/0x9)+parseInt(_0x110dee(0x13a))/0xa*(parseInt(_0x110dee(0x160))/0xb);if(_0x45a4c0===_0x34edde)break;else _0x99571d['push'](_0x99571d['shift']());}catch(_0x17878c){_0x99571d['push'](_0x99571d['shift']());}}}(_0x2900,0x1c42b));var __decorate=this&&this['__decorate']||function(_0x1f09ce,_0x5a6312,_0x14cbf1,_0x2f2ebc){const _0x4a36a9=_0x3d2a;var _0x5efd4e=arguments[_0x4a36a9(0x17d)],_0x393f6a=_0x5efd4e<0x3?_0x5a6312:_0x2f2ebc===null?_0x2f2ebc=Object[_0x4a36a9(0x132)](_0x5a6312,_0x14cbf1):_0x2f2ebc,_0x6e8069;if(typeof Reflect==='object'&&typeof Reflect['decorate']===_0x4a36a9(0x186))_0x393f6a=Reflect[_0x4a36a9(0x136)](_0x1f09ce,_0x5a6312,_0x14cbf1,_0x2f2ebc);else{for(var _0x246326=_0x1f09ce['length']-0x1;_0x246326>=0x0;_0x246326--)if(_0x6e8069=_0x1f09ce[_0x246326])_0x393f6a=(_0x5efd4e<0x3?_0x6e8069(_0x393f6a):_0x5efd4e>0x3?_0x6e8069(_0x5a6312,_0x14cbf1,_0x393f6a):_0x6e8069(_0x5a6312,_0x14cbf1))||_0x393f6a;}return _0x5efd4e>0x3&&_0x393f6a&&Object[_0x4a36a9(0x141)](_0x5a6312,_0x14cbf1,_0x393f6a),_0x393f6a;},__metadata=this&&this[_0x350841(0x175)]||function(_0x1a4d78,_0x1a6716){const _0x57e9f2=_0x350841;if(typeof Reflect===_0x57e9f2(0x140)&&typeof Reflect[_0x57e9f2(0x151)]==='function')return Reflect[_0x57e9f2(0x151)](_0x1a4d78,_0x1a6716);},__param=this&&this[_0x350841(0x18d)]||function(_0x38315c,_0x3820e6){return function(_0x971a6e,_0x304fb1){_0x3820e6(_0x971a6e,_0x304fb1,_0x38315c);};};function _0x2900(){const _0x543505=['getOwnPropertyDescriptor','CramiPackageEntity','./cramiPackage.entity','CramiService','decorate','LessThanOrEqual','当前套餐不存在、请检查你的输入参数！','使用卡密成功','3967550zKOWQV','find','super','671368pKMixq','../user/user.entity','34311vWibXK','object','defineProperty','更新套餐成功！','7368hgQTJL','PACKAGE_GIFT','packageName','useCrami','DESC','forEach','addBalanceToUser','error:\x20','user','UserEntity','RechargeType','cramiPackageEntity','@nestjs/common','../../common/constants/balance.constant','metadata','HttpException','更新套餐失败、请重试！','InjectRepository','name','27fFxvGN','删除卡密失败、请重试！','findAndCount','generateCrami','273zIBHHu','BAD_REQUEST','userEntity','every','affected','5ealBlS','11VNHBcD','delPackage','role','527480gFMHUr','maskEmail','套餐名称或套餐等级重复、请检查！','MoreThan','CramiEntity','__esModule','删除卡密成功！','Injectable','log','delete','useId','cramiEntity','count','当前卡密已被使用、请确认您输入的卡密是否正确！','../../common/utils','save','./crami.entity','findOne','__metadata','当前套餐下存在卡密、请先删除卡密后才可删除套餐！','@nestjs/typeorm','98598qaFQfr','assign','293580evwkoy','username','update','length','code','status','maskCrami','HttpStatus','create','Like','userBalanceService','typeorm','function','createPackage','../userBalance/userBalance.service','packageId','Repository','queryOnePackage','email','__param','batchDelCrami','Not','map'];_0x2900=function(){return _0x543505;};return _0x2900();}Object['defineProperty'](exports,_0x350841(0x168),{'value':!![]}),exports[_0x350841(0x135)]=void 0x0;const common_1=require(_0x350841(0x14f)),crami_entity_1=require(_0x350841(0x173)),typeorm_1=require(_0x350841(0x177)),typeorm_2=require(_0x350841(0x185)),cramiPackage_entity_1=require(_0x350841(0x134)),utils_1=require(_0x350841(0x171)),user_entity_1=require(_0x350841(0x13e)),userBalance_service_1=require(_0x350841(0x188)),balance_constant_1=require(_0x350841(0x150));let CramiService=class CramiService{constructor(_0x5d8d23,_0x4dce45,_0x4f34c1,_0x140d21){const _0x3b7006=_0x350841;this[_0x3b7006(0x16e)]=_0x5d8d23,this[_0x3b7006(0x14e)]=_0x4dce45,this[_0x3b7006(0x15c)]=_0x4f34c1,this[_0x3b7006(0x184)]=_0x140d21;}async[_0x350841(0x18b)](_0x1424b1){const _0x3a4e7a=_0x350841;return await this[_0x3a4e7a(0x14e)][_0x3a4e7a(0x174)]({'where':{'id':_0x1424b1}});}async['queryAllPackage'](_0x4aa974){const _0x599f8a=_0x350841;try{const {page:page=0x1,size:size=0xa,name:_0xa031ae,status:_0x5ab35d,type:_0x3c8354}=_0x4aa974,_0x284402={};_0xa031ae&&Object['assign'](_0x284402,{'name':(0x0,typeorm_2[_0x599f8a(0x183)])('%'+_0xa031ae+'%')}),_0x5ab35d&&Object[_0x599f8a(0x179)](_0x284402,{'status':_0x5ab35d});_0x3c8354&&(_0x3c8354>0x0?Object['assign'](_0x284402,{'days':(0x0,typeorm_2[_0x599f8a(0x166)])(0x0)}):Object[_0x599f8a(0x179)](_0x284402,{'days':(0x0,typeorm_2[_0x599f8a(0x137)])(0x0)}));const [_0x537521,_0x46413d]=await this[_0x599f8a(0x14e)][_0x599f8a(0x158)]({'skip':(page-0x1)*size,'take':size,'where':_0x284402,'order':{'order':_0x599f8a(0x147)}});return{'rows':_0x537521,'count':_0x46413d};}catch(_0x446c6f){console[_0x599f8a(0x16b)](_0x599f8a(0x14a),_0x446c6f);}}async[_0x350841(0x187)](_0x56f819){const _0x2bf8a0=_0x350841,{name:_0x42a9c2,weight:_0x3aaf4b}=_0x56f819,_0x39320f=await this[_0x2bf8a0(0x14e)][_0x2bf8a0(0x174)]({'where':[{'name':_0x42a9c2},{'weight':_0x3aaf4b}]});if(_0x39320f)throw new common_1['HttpException'](_0x2bf8a0(0x165),common_1['HttpStatus'][_0x2bf8a0(0x15b)]);try{return await this[_0x2bf8a0(0x14e)][_0x2bf8a0(0x172)](_0x56f819);}catch(_0x4e4291){console[_0x2bf8a0(0x16b)](_0x2bf8a0(0x14a),_0x4e4291);throw new common_1[(_0x2bf8a0(0x152))](_0x4e4291,common_1[_0x2bf8a0(0x181)]['BAD_REQUEST']);}}async['updatePackage'](_0x336fe4){const _0x136fb3=_0x350841,{id:_0x144a30,name:_0x337dd1,weight:_0x2e1f08}=_0x336fe4,_0x4826e1=await this[_0x136fb3(0x14e)][_0x136fb3(0x174)]({'where':{'id':_0x144a30}});if(!_0x4826e1)throw new common_1['HttpException'](_0x136fb3(0x138),common_1[_0x136fb3(0x181)][_0x136fb3(0x15b)]);const _0x3dff7f=await this['cramiPackageEntity'][_0x136fb3(0x16f)]({'where':[{'name':_0x337dd1,'id':(0x0,typeorm_2[_0x136fb3(0x130)])(_0x144a30)},{'weight':_0x2e1f08,'id':(0x0,typeorm_2[_0x136fb3(0x130)])(_0x144a30)}]});if(_0x3dff7f)throw new common_1[(_0x136fb3(0x152))]('套餐名称或套餐等级重复、请检查！',common_1['HttpStatus'][_0x136fb3(0x15b)]);const _0x535bb2=await this[_0x136fb3(0x14e)][_0x136fb3(0x17c)]({'id':_0x144a30},_0x336fe4);if(_0x535bb2[_0x136fb3(0x15e)]>0x0)return _0x136fb3(0x142);else throw new common_1[(_0x136fb3(0x152))](_0x136fb3(0x153),common_1['HttpStatus'][_0x136fb3(0x15b)]);}async[_0x350841(0x161)](_0x404577){const _0x598e6e=_0x350841,{id:_0x167e9c}=_0x404577,_0xc2cee0=await this['cramiEntity'][_0x598e6e(0x16f)]({'where':{'packageId':_0x167e9c}});if(_0xc2cee0)throw new common_1['HttpException'](_0x598e6e(0x176),common_1['HttpStatus']['BAD_REQUEST']);return await this[_0x598e6e(0x14e)][_0x598e6e(0x16c)]({'id':_0x167e9c});}async['createCrami'](_0xd42cc3){const _0x4ff258=_0x350841,{packageId:_0x489f69,count:count=0x1}=_0xd42cc3;if(_0x489f69){const _0x85cdd8=await this['cramiPackageEntity'][_0x4ff258(0x174)]({'where':{'id':_0x489f69}});if(!_0x85cdd8)throw new common_1['HttpException']('当前套餐不存在、请确认您选择的套餐是否存在！',common_1[_0x4ff258(0x181)][_0x4ff258(0x15b)]);const {days:days=-0x1,model3Count:model3Count=0x0,model4Count:model4Count=0x0,drawMjCount:drawMjCount=0x0}=_0x85cdd8,_0xa68c80={'packageId':_0x489f69,'days':days,'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount};return await this[_0x4ff258(0x159)](_0xa68c80,count);}if(!_0x489f69){const {model3Count:model3Count=0x0,model4Count:model4Count=0x0,drawMjCount:drawMjCount=0x0}=_0xd42cc3;if([model3Count,model4Count,drawMjCount][_0x4ff258(0x15d)](_0xa52b6b=>!_0xa52b6b))throw new common_1['HttpException']('自定义卡密必须至少一项余额不为0️零！',common_1[_0x4ff258(0x181)][_0x4ff258(0x15b)]);const _0x59bcda={'days':-0x1,'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount};return await this[_0x4ff258(0x159)](_0x59bcda,count);}}async[_0x350841(0x159)](_0x8fa7ce,_0x43ad8b){const _0x381463=_0x350841,_0x21d9b2=[];for(let _0x3b732e=0x0;_0x3b732e<_0x43ad8b;_0x3b732e++){const _0x638c9e=(0x0,utils_1['generateCramiCode'])(),_0x27eb23=this['cramiEntity'][_0x381463(0x182)](Object[_0x381463(0x179)](Object[_0x381463(0x179)]({},_0x8fa7ce),{'code':_0x638c9e}));_0x21d9b2['push'](_0x27eb23);}return await this[_0x381463(0x16e)][_0x381463(0x172)](_0x21d9b2);}async[_0x350841(0x146)](_0xfb9259,_0x32aef4){const _0x41f29a=_0x350841,{id:_0xe9803a}=_0xfb9259[_0x41f29a(0x14b)],_0x41394a=await this[_0x41f29a(0x16e)][_0x41f29a(0x174)]({'where':{'code':_0x32aef4[_0x41f29a(0x17e)]}});if(!_0x41394a)throw new common_1[(_0x41f29a(0x152))]('当前卡密不存在、请确认您输入的卡密是否正确！',common_1[_0x41f29a(0x181)][_0x41f29a(0x15b)]);const {status:_0x3206cd,days:days=-0x1,model3Count:model3Count=0x0,model4Count:model4Count=0x0,drawMjCount:drawMjCount=0x0,packageId:_0x2f34ab}=_0x41394a;if(_0x3206cd===0x1)throw new common_1[(_0x41f29a(0x152))](_0x41f29a(0x170),common_1[_0x41f29a(0x181)]['BAD_REQUEST']);const _0xcdcc6a={'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount,'packageId':_0x2f34ab};return await this['userBalanceService'][_0x41f29a(0x149)](_0xe9803a,Object[_0x41f29a(0x179)]({},_0xcdcc6a),days),await this[_0x41f29a(0x184)]['saveRecordRechargeLog']({'userId':_0xe9803a,'rechargeType':balance_constant_1[_0x41f29a(0x14d)][_0x41f29a(0x144)],'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount,'days':days}),await this['cramiEntity'][_0x41f29a(0x17c)]({'code':_0x32aef4['code']},{'useId':_0xe9803a,'status':0x1}),_0x41f29a(0x139);}async['queryAllCrami'](_0x5e6890,_0x44fa47){const _0x49ffc4=_0x350841,{page:page=0x1,size:size=0xa,status:_0x41ceb1,useId:_0x565206}=_0x5e6890,_0x3feb23={};_0x41ceb1&&Object[_0x49ffc4(0x179)](_0x3feb23,{'status':_0x41ceb1}),_0x565206&&Object[_0x49ffc4(0x179)](_0x3feb23,{'useId':_0x565206});const [_0x37f18f,_0xa78ae8]=await this[_0x49ffc4(0x16e)][_0x49ffc4(0x158)]({'skip':(page-0x1)*size,'take':size,'order':{'createdAt':_0x49ffc4(0x147)},'where':_0x3feb23}),_0x1dc69e=_0x37f18f[_0x49ffc4(0x131)](_0x89ba43=>_0x89ba43['useId']),_0x2415ee=_0x37f18f['map'](_0x290743=>_0x290743[_0x49ffc4(0x189)]),_0x83212d=await this[_0x49ffc4(0x15c)][_0x49ffc4(0x13b)]({'where':{'id':(0x0,typeorm_2['In'])(_0x1dc69e)}}),_0x1820a0=await this[_0x49ffc4(0x14e)][_0x49ffc4(0x13b)]({'where':{'id':(0x0,typeorm_2['In'])(_0x2415ee)}});return _0x37f18f['forEach'](_0x6728fe=>{const _0x4acb31=_0x49ffc4;var _0x25b52c,_0x4c5681,_0x31d587;_0x6728fe[_0x4acb31(0x17b)]=(_0x25b52c=_0x83212d[_0x4acb31(0x13b)](_0x554753=>_0x554753['id']===_0x6728fe[_0x4acb31(0x16d)]))===null||_0x25b52c===void 0x0?void 0x0:_0x25b52c[_0x4acb31(0x17b)],_0x6728fe[_0x4acb31(0x18c)]=(_0x4c5681=_0x83212d[_0x4acb31(0x13b)](_0x1fdec7=>_0x1fdec7['id']===_0x6728fe['useId']))===null||_0x4c5681===void 0x0?void 0x0:_0x4c5681[_0x4acb31(0x18c)],_0x6728fe[_0x4acb31(0x145)]=(_0x31d587=_0x1820a0[_0x4acb31(0x13b)](_0x405212=>_0x405212['id']===_0x6728fe['packageId']))===null||_0x31d587===void 0x0?void 0x0:_0x31d587[_0x4acb31(0x155)];}),_0x44fa47[_0x49ffc4(0x14b)][_0x49ffc4(0x162)]!=='super'&&_0x37f18f[_0x49ffc4(0x148)](_0x41520=>_0x41520[_0x49ffc4(0x18c)]=(0x0,utils_1[_0x49ffc4(0x164)])(_0x41520[_0x49ffc4(0x18c)])),_0x44fa47[_0x49ffc4(0x14b)][_0x49ffc4(0x162)]!==_0x49ffc4(0x13c)&&_0x37f18f[_0x49ffc4(0x148)](_0x57b067=>_0x57b067[_0x49ffc4(0x17e)]=(0x0,utils_1[_0x49ffc4(0x180)])(_0x57b067[_0x49ffc4(0x17e)])),{'rows':_0x37f18f,'count':_0xa78ae8};}async['delCrami'](_0x49b1c5){const _0x4da486=_0x350841,_0x4bf8ee=await this[_0x4da486(0x16e)][_0x4da486(0x174)]({'where':{'id':_0x49b1c5}});if(!_0x4bf8ee)throw new common_1[(_0x4da486(0x152))]('当前卡密不存在、请确认您要删除的卡密是否存在！',common_1['HttpStatus'][_0x4da486(0x15b)]);if(_0x4bf8ee[_0x4da486(0x17f)]===0x1)throw new common_1['HttpException']('当前卡密已被使用、已使用的卡密禁止删除！',common_1[_0x4da486(0x181)][_0x4da486(0x15b)]);return await this[_0x4da486(0x16e)]['delete']({'id':_0x49b1c5});}async[_0x350841(0x12f)](_0x5f555f){const _0x21f310=_0x350841,{ids:_0x5ef439}=_0x5f555f,_0x37a930=await this[_0x21f310(0x16e)][_0x21f310(0x16c)](_0x5ef439);if(_0x37a930[_0x21f310(0x15e)]>0x0)return _0x21f310(0x169);else throw new common_1[(_0x21f310(0x152))](_0x21f310(0x157),common_1['HttpStatus'][_0x21f310(0x15b)]);}};CramiService=__decorate([(0x0,common_1[_0x350841(0x16a)])(),__param(0x0,(0x0,typeorm_1[_0x350841(0x154)])(crami_entity_1[_0x350841(0x167)])),__param(0x1,(0x0,typeorm_1[_0x350841(0x154)])(cramiPackage_entity_1[_0x350841(0x133)])),__param(0x2,(0x0,typeorm_1[_0x350841(0x154)])(user_entity_1[_0x350841(0x14c)])),__metadata('design:paramtypes',[typeorm_2[_0x350841(0x18a)],typeorm_2['Repository'],typeorm_2['Repository'],userBalance_service_1['UserBalanceService']])],CramiService),exports[_0x350841(0x135)]=CramiService;