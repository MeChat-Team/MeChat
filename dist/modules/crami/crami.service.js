'use strict';const _0x15a151=_0x4401;(function(_0x251200,_0x16b28d){const _0x5e0239=_0x4401,_0x2864bf=_0x251200();while(!![]){try{const _0x3226c8=parseInt(_0x5e0239(0xa7))/0x1+-parseInt(_0x5e0239(0xa3))/0x2*(parseInt(_0x5e0239(0xc9))/0x3)+-parseInt(_0x5e0239(0xcc))/0x4*(-parseInt(_0x5e0239(0xf4))/0x5)+parseInt(_0x5e0239(0xe8))/0x6*(parseInt(_0x5e0239(0xbb))/0x7)+-parseInt(_0x5e0239(0xc8))/0x8+-parseInt(_0x5e0239(0xa5))/0x9+parseInt(_0x5e0239(0xb4))/0xa*(parseInt(_0x5e0239(0xcb))/0xb);if(_0x3226c8===_0x16b28d)break;else _0x2864bf['push'](_0x2864bf['shift']());}catch(_0x21f3c2){_0x2864bf['push'](_0x2864bf['shift']());}}}(_0x2bdc,0xc4bc0));function _0x4401(_0x1476b9,_0x3554b3){const _0x2bdc6e=_0x2bdc();return _0x4401=function(_0x440108,_0x453ac3){_0x440108=_0x440108-0x9f;let _0x7ab5cc=_0x2bdc6e[_0x440108];return _0x7ab5cc;},_0x4401(_0x1476b9,_0x3554b3);}function _0x2bdc(){const _0x2f4f5f=['2621696jceoWE','1846746nWdaOQ','metadata','768603nCpAYa','4vzXMfb','forEach','删除卡密失败、请重试！','../user/user.entity','Not','PACKAGE_GIFT','assign','generateCrami','save','maskEmail','find','CramiPackageEntity','status','DESC','CramiService','./crami.entity','MoreThan','当前卡密不存在、请确认您要删除的卡密是否存在！','push','RechargeType','@nestjs/common','affected','name','当前卡密已被使用、请确认您输入的卡密是否正确！','role','userBalanceService','email','object','30ZigLFC','typeorm','design:paramtypes','update','../../common/constants/balance.constant','user','code','delPackage','cramiPackageEntity','HttpStatus','当前套餐不存在、请确认您选择的套餐是否存在！','当前套餐下存在卡密、请先删除卡密后才可删除套餐！','59310tgBvDA','当前卡密已被使用、已使用的卡密禁止删除！','username','count','delete','Like','packageId','2HUDLPV','createPackage','3125322NcpOEQ','BAD_REQUEST','698188VuLWpA','findAndCount','当前卡密不存在、请确认您输入的卡密是否正确！','@nestjs/typeorm','super','../userBalance/userBalance.service','findOne','userEntity','使用卡密成功','useId','generateCramiCode','function','InjectRepository','120KOEVGh','HttpException','defineProperty','every','length','useCrami','batchDelCrami','766990BUjqod','createCrami','log','map','cramiEntity','addBalanceToUser','error:\x20','decorate','Repository','__decorate','UserBalanceService','create','套餐名称或套餐等级重复、请检查！'];_0x2bdc=function(){return _0x2f4f5f;};return _0x2bdc();}var __decorate=this&&this[_0x15a151(0xc4)]||function(_0x2d3e78,_0x3ecef5,_0x12ab18,_0x4e0583){const _0x4292d2=_0x15a151;var _0x790bff=arguments[_0x4292d2(0xb8)],_0x1a708d=_0x790bff<0x3?_0x3ecef5:_0x4e0583===null?_0x4e0583=Object['getOwnPropertyDescriptor'](_0x3ecef5,_0x12ab18):_0x4e0583,_0x2e24;if(typeof Reflect==='object'&&typeof Reflect['decorate']===_0x4292d2(0xb2))_0x1a708d=Reflect[_0x4292d2(0xc2)](_0x2d3e78,_0x3ecef5,_0x12ab18,_0x4e0583);else{for(var _0x19c1cb=_0x2d3e78[_0x4292d2(0xb8)]-0x1;_0x19c1cb>=0x0;_0x19c1cb--)if(_0x2e24=_0x2d3e78[_0x19c1cb])_0x1a708d=(_0x790bff<0x3?_0x2e24(_0x1a708d):_0x790bff>0x3?_0x2e24(_0x3ecef5,_0x12ab18,_0x1a708d):_0x2e24(_0x3ecef5,_0x12ab18))||_0x1a708d;}return _0x790bff>0x3&&_0x1a708d&&Object[_0x4292d2(0xb6)](_0x3ecef5,_0x12ab18,_0x1a708d),_0x1a708d;},__metadata=this&&this['__metadata']||function(_0x41e77b,_0x425902){const _0x91daf5=_0x15a151;if(typeof Reflect===_0x91daf5(0xe7)&&typeof Reflect[_0x91daf5(0xca)]==='function')return Reflect[_0x91daf5(0xca)](_0x41e77b,_0x425902);},__param=this&&this['__param']||function(_0x1392b9,_0x367d64){return function(_0x194ede,_0x1a80ac){_0x367d64(_0x194ede,_0x1a80ac,_0x1392b9);};};Object[_0x15a151(0xb6)](exports,'__esModule',{'value':!![]}),exports[_0x15a151(0xda)]=void 0x0;const common_1=require(_0x15a151(0xe0)),crami_entity_1=require(_0x15a151(0xdb)),typeorm_1=require(_0x15a151(0xaa)),typeorm_2=require(_0x15a151(0xe9)),cramiPackage_entity_1=require('./cramiPackage.entity'),utils_1=require('../../common/utils'),user_entity_1=require(_0x15a151(0xcf)),userBalance_service_1=require(_0x15a151(0xac)),balance_constant_1=require(_0x15a151(0xec));let CramiService=class CramiService{constructor(_0x465269,_0xb61e9c,_0x36f730,_0x214dd4){const _0x223708=_0x15a151;this[_0x223708(0xbf)]=_0x465269,this[_0x223708(0xf0)]=_0xb61e9c,this[_0x223708(0xae)]=_0x36f730,this[_0x223708(0xe5)]=_0x214dd4;}async['queryOnePackage'](_0x4cd6cf){const _0x490d53=_0x15a151;return await this['cramiPackageEntity'][_0x490d53(0xad)]({'where':{'id':_0x4cd6cf}});}async['queryAllPackage'](_0x5777e7){const _0x1520c1=_0x15a151;try{const {page:page=0x1,size:size=0xa,name:_0x4d5882,status:_0x35e861,type:_0x1e7c6b}=_0x5777e7,_0x3ad71e={};_0x4d5882&&Object['assign'](_0x3ad71e,{'name':(0x0,typeorm_2[_0x1520c1(0xa1)])('%'+_0x4d5882+'%')}),_0x35e861&&Object[_0x1520c1(0xd2)](_0x3ad71e,{'status':_0x35e861});_0x1e7c6b&&(_0x1e7c6b>0x0?Object[_0x1520c1(0xd2)](_0x3ad71e,{'days':(0x0,typeorm_2[_0x1520c1(0xdc)])(0x0)}):Object['assign'](_0x3ad71e,{'days':(0x0,typeorm_2['LessThanOrEqual'])(0x0)}));const [_0x37ead2,_0x256591]=await this[_0x1520c1(0xf0)][_0x1520c1(0xa8)]({'skip':(page-0x1)*size,'take':size,'where':_0x3ad71e,'order':{'order':_0x1520c1(0xd9)}});return{'rows':_0x37ead2,'count':_0x256591};}catch(_0x6b7f28){console[_0x1520c1(0xbd)](_0x1520c1(0xc1),_0x6b7f28);}}async[_0x15a151(0xa4)](_0x4394d7){const _0x3d2fc8=_0x15a151,{name:_0x437554,weight:_0x4f667a}=_0x4394d7,_0x315db0=await this['cramiPackageEntity'][_0x3d2fc8(0xad)]({'where':[{'name':_0x437554},{'weight':_0x4f667a}]});if(_0x315db0)throw new common_1[(_0x3d2fc8(0xb5))](_0x3d2fc8(0xc7),common_1[_0x3d2fc8(0xf1)][_0x3d2fc8(0xa6)]);try{return await this[_0x3d2fc8(0xf0)]['save'](_0x4394d7);}catch(_0x363c90){console[_0x3d2fc8(0xbd)](_0x3d2fc8(0xc1),_0x363c90);throw new common_1[(_0x3d2fc8(0xb5))](_0x363c90,common_1['HttpStatus'][_0x3d2fc8(0xa6)]);}}async['updatePackage'](_0x1b61e5){const _0xf619ed=_0x15a151,{id:_0x41c2f2,name:_0x1a24d2,weight:_0x58cc83}=_0x1b61e5,_0x14a776=await this[_0xf619ed(0xf0)][_0xf619ed(0xad)]({'where':{'id':_0x41c2f2}});if(!_0x14a776)throw new common_1[(_0xf619ed(0xb5))]('当前套餐不存在、请检查你的输入参数！',common_1[_0xf619ed(0xf1)][_0xf619ed(0xa6)]);const _0x155097=await this['cramiPackageEntity'][_0xf619ed(0x9f)]({'where':[{'name':_0x1a24d2,'id':(0x0,typeorm_2[_0xf619ed(0xd0)])(_0x41c2f2)},{'weight':_0x58cc83,'id':(0x0,typeorm_2[_0xf619ed(0xd0)])(_0x41c2f2)}]});if(_0x155097)throw new common_1[(_0xf619ed(0xb5))](_0xf619ed(0xc7),common_1[_0xf619ed(0xf1)][_0xf619ed(0xa6)]);const _0x16f5a4=await this[_0xf619ed(0xf0)][_0xf619ed(0xeb)]({'id':_0x41c2f2},_0x1b61e5);if(_0x16f5a4[_0xf619ed(0xe1)]>0x0)return'更新套餐成功！';else throw new common_1[(_0xf619ed(0xb5))]('更新套餐失败、请重试！',common_1['HttpStatus'][_0xf619ed(0xa6)]);}async[_0x15a151(0xef)](_0x5a4c0e){const _0x213b91=_0x15a151,{id:_0x586955}=_0x5a4c0e,_0x33ddbb=await this[_0x213b91(0xbf)][_0x213b91(0x9f)]({'where':{'packageId':_0x586955}});if(_0x33ddbb)throw new common_1[(_0x213b91(0xb5))](_0x213b91(0xf3),common_1[_0x213b91(0xf1)][_0x213b91(0xa6)]);return await this[_0x213b91(0xf0)][_0x213b91(0xa0)]({'id':_0x586955});}async[_0x15a151(0xbc)](_0x171b8a){const _0x4ce38d=_0x15a151,{packageId:_0x232490,count:count=0x1}=_0x171b8a;if(_0x232490){const _0x257091=await this[_0x4ce38d(0xf0)][_0x4ce38d(0xad)]({'where':{'id':_0x232490}});if(!_0x257091)throw new common_1[(_0x4ce38d(0xb5))](_0x4ce38d(0xf2),common_1[_0x4ce38d(0xf1)][_0x4ce38d(0xa6)]);const {days:days=-0x1,model3Count:model3Count=0x0,model4Count:model4Count=0x0,drawMjCount:drawMjCount=0x0}=_0x257091,_0x11a74a={'packageId':_0x232490,'days':days,'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount};return await this[_0x4ce38d(0xd3)](_0x11a74a,count);}if(!_0x232490){const {model3Count:model3Count=0x0,model4Count:model4Count=0x0,drawMjCount:drawMjCount=0x0}=_0x171b8a;if([model3Count,model4Count,drawMjCount][_0x4ce38d(0xb7)](_0x448650=>!_0x448650))throw new common_1['HttpException']('自定义卡密必须至少一项余额不为0️零！',common_1[_0x4ce38d(0xf1)][_0x4ce38d(0xa6)]);const _0x5e5c97={'days':-0x1,'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount};return await this[_0x4ce38d(0xd3)](_0x5e5c97,count);}}async['generateCrami'](_0x522194,_0x424c33){const _0x371d2c=_0x15a151,_0x412c5d=[];for(let _0xa7ea1e=0x0;_0xa7ea1e<_0x424c33;_0xa7ea1e++){const _0xb09c51=(0x0,utils_1[_0x371d2c(0xb1)])(),_0x5df0bd=this[_0x371d2c(0xbf)][_0x371d2c(0xc6)](Object[_0x371d2c(0xd2)](Object[_0x371d2c(0xd2)]({},_0x522194),{'code':_0xb09c51}));_0x412c5d[_0x371d2c(0xde)](_0x5df0bd);}return await this[_0x371d2c(0xbf)][_0x371d2c(0xd4)](_0x412c5d);}async[_0x15a151(0xb9)](_0x3c90e4,_0x535d64){const _0x21c7ee=_0x15a151,{id:_0x4156b0}=_0x3c90e4['user'],_0x5b85c3=await this[_0x21c7ee(0xbf)][_0x21c7ee(0xad)]({'where':{'code':_0x535d64[_0x21c7ee(0xee)]}});if(!_0x5b85c3)throw new common_1[(_0x21c7ee(0xb5))](_0x21c7ee(0xa9),common_1['HttpStatus'][_0x21c7ee(0xa6)]);const {status:_0x1ce3b8,days:days=-0x1,model3Count:model3Count=0x0,model4Count:model4Count=0x0,drawMjCount:drawMjCount=0x0,packageId:_0x29d0e1}=_0x5b85c3;if(_0x1ce3b8===0x1)throw new common_1[(_0x21c7ee(0xb5))](_0x21c7ee(0xe3),common_1[_0x21c7ee(0xf1)][_0x21c7ee(0xa6)]);const _0x3c90ba={'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount,'packageId':_0x29d0e1};return await this[_0x21c7ee(0xe5)][_0x21c7ee(0xc0)](_0x4156b0,Object[_0x21c7ee(0xd2)]({},_0x3c90ba),days),await this[_0x21c7ee(0xe5)]['saveRecordRechargeLog']({'userId':_0x4156b0,'rechargeType':balance_constant_1[_0x21c7ee(0xdf)][_0x21c7ee(0xd1)],'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount,'days':days}),await this[_0x21c7ee(0xbf)][_0x21c7ee(0xeb)]({'code':_0x535d64['code']},{'useId':_0x4156b0,'status':0x1}),_0x21c7ee(0xaf);}async['queryAllCrami'](_0x42c3ef,_0x28c51c){const _0xf3cca1=_0x15a151,{page:page=0x1,size:size=0xa,status:_0x3a0f7d,useId:_0x492c2a}=_0x42c3ef,_0x54887c={};_0x3a0f7d&&Object['assign'](_0x54887c,{'status':_0x3a0f7d}),_0x492c2a&&Object[_0xf3cca1(0xd2)](_0x54887c,{'useId':_0x492c2a});const [_0x498b8f,_0x259b02]=await this[_0xf3cca1(0xbf)]['findAndCount']({'skip':(page-0x1)*size,'take':size,'order':{'createdAt':_0xf3cca1(0xd9)},'where':_0x54887c}),_0x3b4e3e=_0x498b8f[_0xf3cca1(0xbe)](_0x46fe06=>_0x46fe06['useId']),_0x5bed93=_0x498b8f[_0xf3cca1(0xbe)](_0x57d6e6=>_0x57d6e6[_0xf3cca1(0xa2)]),_0x5e12d0=await this[_0xf3cca1(0xae)][_0xf3cca1(0xd6)]({'where':{'id':(0x0,typeorm_2['In'])(_0x3b4e3e)}}),_0x5e7d89=await this[_0xf3cca1(0xf0)][_0xf3cca1(0xd6)]({'where':{'id':(0x0,typeorm_2['In'])(_0x5bed93)}});return _0x498b8f[_0xf3cca1(0xcd)](_0x2bb4ce=>{const _0x555bc5=_0xf3cca1;var _0x42c955,_0x3beae2,_0x2977ea;_0x2bb4ce[_0x555bc5(0xf6)]=(_0x42c955=_0x5e12d0[_0x555bc5(0xd6)](_0x193163=>_0x193163['id']===_0x2bb4ce[_0x555bc5(0xb0)]))===null||_0x42c955===void 0x0?void 0x0:_0x42c955[_0x555bc5(0xf6)],_0x2bb4ce[_0x555bc5(0xe6)]=(_0x3beae2=_0x5e12d0[_0x555bc5(0xd6)](_0x4579ff=>_0x4579ff['id']===_0x2bb4ce[_0x555bc5(0xb0)]))===null||_0x3beae2===void 0x0?void 0x0:_0x3beae2[_0x555bc5(0xe6)],_0x2bb4ce['packageName']=(_0x2977ea=_0x5e7d89[_0x555bc5(0xd6)](_0x1c0edd=>_0x1c0edd['id']===_0x2bb4ce[_0x555bc5(0xa2)]))===null||_0x2977ea===void 0x0?void 0x0:_0x2977ea[_0x555bc5(0xe2)];}),_0x28c51c[_0xf3cca1(0xed)][_0xf3cca1(0xe4)]!==_0xf3cca1(0xab)&&_0x498b8f[_0xf3cca1(0xcd)](_0x3ad3ae=>_0x3ad3ae['email']=(0x0,utils_1[_0xf3cca1(0xd5)])(_0x3ad3ae[_0xf3cca1(0xe6)])),_0x28c51c[_0xf3cca1(0xed)][_0xf3cca1(0xe4)]!==_0xf3cca1(0xab)&&_0x498b8f[_0xf3cca1(0xcd)](_0x4d85ae=>_0x4d85ae[_0xf3cca1(0xee)]=(0x0,utils_1['maskCrami'])(_0x4d85ae[_0xf3cca1(0xee)])),{'rows':_0x498b8f,'count':_0x259b02};}async['delCrami'](_0x13b05a){const _0x3815ea=_0x15a151,_0xed545a=await this[_0x3815ea(0xbf)][_0x3815ea(0xad)]({'where':{'id':_0x13b05a}});if(!_0xed545a)throw new common_1[(_0x3815ea(0xb5))](_0x3815ea(0xdd),common_1[_0x3815ea(0xf1)][_0x3815ea(0xa6)]);if(_0xed545a[_0x3815ea(0xd8)]===0x1)throw new common_1['HttpException'](_0x3815ea(0xf5),common_1[_0x3815ea(0xf1)]['BAD_REQUEST']);return await this['cramiEntity']['delete']({'id':_0x13b05a});}async[_0x15a151(0xba)](_0x232953){const _0x3bb846=_0x15a151,{ids:_0x4221dd}=_0x232953,_0x48ca97=await this['cramiEntity'][_0x3bb846(0xa0)](_0x4221dd);if(_0x48ca97[_0x3bb846(0xe1)]>0x0)return'删除卡密成功！';else throw new common_1[(_0x3bb846(0xb5))](_0x3bb846(0xce),common_1['HttpStatus'][_0x3bb846(0xa6)]);}};CramiService=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,typeorm_1[_0x15a151(0xb3)])(crami_entity_1['CramiEntity'])),__param(0x1,(0x0,typeorm_1[_0x15a151(0xb3)])(cramiPackage_entity_1[_0x15a151(0xd7)])),__param(0x2,(0x0,typeorm_1['InjectRepository'])(user_entity_1['UserEntity'])),__metadata(_0x15a151(0xea),[typeorm_2['Repository'],typeorm_2[_0x15a151(0xc3)],typeorm_2[_0x15a151(0xc3)],userBalance_service_1[_0x15a151(0xc5)]])],CramiService),exports['CramiService']=CramiService;