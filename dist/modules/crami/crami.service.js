'use strict';const _0x3b713f=_0x6e5e;function _0x1935(){const _0xf3df78=['当前卡密不存在、请确认您要删除的卡密是否存在！','当前套餐不存在、请检查你的输入参数！','findOne','delete','email','count','585vBLPys','useCrami','BAD_REQUEST','role','Not','cramiEntity','1983380lTKkMm','19800dHaIHk','CramiEntity','push','findAndCount','batchDelCrami','UserEntity','design:paramtypes','当前套餐下存在卡密、请先删除卡密后才可删除套餐！','affected','packageId','185OYwPXl','9990240ybLvxy','generateCramiCode','cramiPackageEntity','31020whiKIs','assign','find','create','CramiPackageEntity','__esModule','updatePackage','CramiService','../../common/constants/balance.constant','packageName','saveRecordRechargeLog','更新套餐失败、请重试！','LessThanOrEqual','自定义卡密必须至少一项余额不为0️零！','__metadata','当前卡密不存在、请确认您输入的卡密是否正确！','@nestjs/common','使用卡密成功','super','Injectable','every','当前卡密已被使用、请确认您输入的卡密是否正确！','queryAllPackage','HttpStatus','forEach','createCrami','InjectRepository','function','addBalanceToUser','queryAllCrami','Repository','map','HttpException','generateCrami','username','maskEmail','defineProperty','PACKAGE_GIFT','DESC','save','update','status','userEntity','当前套餐不存在、请确认您选择的套餐是否存在！','delCrami','userBalanceService','__decorate','error:\x20','getOwnPropertyDescriptor','decorate','object','./cramiPackage.entity','metadata','delPackage','80781YOdjyX','createPackage','578336LFjYSy','套餐名称或套餐等级重复、请检查！','48318CodpCS','__param','code','UserBalanceService','maskCrami','queryOnePackage','16SSkslp','name','useId','删除卡密失败、请重试！','user','./crami.entity'];_0x1935=function(){return _0xf3df78;};return _0x1935();}(function(_0x12c11f,_0x1407ec){const _0xf36b24=_0x6e5e,_0x49853c=_0x12c11f();while(!![]){try{const _0x206ce5=-parseInt(_0xf36b24(0x1be))/0x1+parseInt(_0xf36b24(0x1fe))/0x2*(-parseInt(_0xf36b24(0x1f4))/0x3)+-parseInt(_0xf36b24(0x1f6))/0x4+-parseInt(_0xf36b24(0x1ba))/0x5*(parseInt(_0xf36b24(0x1f8))/0x6)+-parseInt(_0xf36b24(0x1af))/0x7+-parseInt(_0xf36b24(0x1b0))/0x8*(-parseInt(_0xf36b24(0x20a))/0x9)+parseInt(_0xf36b24(0x1bb))/0xa;if(_0x206ce5===_0x1407ec)break;else _0x49853c['push'](_0x49853c['shift']());}catch(_0x2cfa1a){_0x49853c['push'](_0x49853c['shift']());}}}(_0x1935,0x2dcba));function _0x6e5e(_0xce881,_0x1e57ec){const _0x1935e3=_0x1935();return _0x6e5e=function(_0x6e5ed3,_0x57848b){_0x6e5ed3=_0x6e5ed3-0x1ab;let _0x1809ca=_0x1935e3[_0x6e5ed3];return _0x1809ca;},_0x6e5e(_0xce881,_0x1e57ec);}var __decorate=this&&this[_0x3b713f(0x1ec)]||function(_0x3d9c16,_0x1f71c5,_0x34ca20,_0x38a0ac){const _0x213811=_0x3b713f;var _0x3a2960=arguments['length'],_0x36bf31=_0x3a2960<0x3?_0x1f71c5:_0x38a0ac===null?_0x38a0ac=Object[_0x213811(0x1ee)](_0x1f71c5,_0x34ca20):_0x38a0ac,_0x4ea727;if(typeof Reflect==='object'&&typeof Reflect[_0x213811(0x1ef)]==='function')_0x36bf31=Reflect['decorate'](_0x3d9c16,_0x1f71c5,_0x34ca20,_0x38a0ac);else{for(var _0x1362ff=_0x3d9c16['length']-0x1;_0x1362ff>=0x0;_0x1362ff--)if(_0x4ea727=_0x3d9c16[_0x1362ff])_0x36bf31=(_0x3a2960<0x3?_0x4ea727(_0x36bf31):_0x3a2960>0x3?_0x4ea727(_0x1f71c5,_0x34ca20,_0x36bf31):_0x4ea727(_0x1f71c5,_0x34ca20))||_0x36bf31;}return _0x3a2960>0x3&&_0x36bf31&&Object[_0x213811(0x1e2)](_0x1f71c5,_0x34ca20,_0x36bf31),_0x36bf31;},__metadata=this&&this[_0x3b713f(0x1cc)]||function(_0x214f99,_0x5028ac){const _0x4a5ec1=_0x3b713f;if(typeof Reflect===_0x4a5ec1(0x1f0)&&typeof Reflect[_0x4a5ec1(0x1f2)]===_0x4a5ec1(0x1d9))return Reflect[_0x4a5ec1(0x1f2)](_0x214f99,_0x5028ac);},__param=this&&this[_0x3b713f(0x1f9)]||function(_0x51ef73,_0x80905b){return function(_0x3874c6,_0x2299a9){_0x80905b(_0x3874c6,_0x2299a9,_0x51ef73);};};Object[_0x3b713f(0x1e2)](exports,_0x3b713f(0x1c3),{'value':!![]}),exports[_0x3b713f(0x1c5)]=void 0x0;const common_1=require(_0x3b713f(0x1ce)),crami_entity_1=require(_0x3b713f(0x203)),typeorm_1=require('@nestjs/typeorm'),typeorm_2=require('typeorm'),cramiPackage_entity_1=require(_0x3b713f(0x1f1)),utils_1=require('../../common/utils'),user_entity_1=require('../user/user.entity'),userBalance_service_1=require('../userBalance/userBalance.service'),balance_constant_1=require(_0x3b713f(0x1c6));let CramiService=class CramiService{constructor(_0x4e555a,_0x13c9f7,_0x4ee820,_0x1235e8){const _0x48b1a9=_0x3b713f;this[_0x48b1a9(0x1ae)]=_0x4e555a,this['cramiPackageEntity']=_0x13c9f7,this['userEntity']=_0x4ee820,this['userBalanceService']=_0x1235e8;}async[_0x3b713f(0x1fd)](_0x502a0b){const _0x6cd891=_0x3b713f;return await this[_0x6cd891(0x1bd)][_0x6cd891(0x206)]({'where':{'id':_0x502a0b}});}async[_0x3b713f(0x1d4)](_0x1f0e5d){const _0x3ce8de=_0x3b713f;try{const {page:page=0x1,size:size=0xa,name:_0x2527f9,status:_0x39e5aa,type:_0x538aaa}=_0x1f0e5d,_0x3f47ee={};_0x2527f9&&Object['assign'](_0x3f47ee,{'name':(0x0,typeorm_2['Like'])('%'+_0x2527f9+'%')}),_0x39e5aa&&Object[_0x3ce8de(0x1bf)](_0x3f47ee,{'status':_0x39e5aa});_0x538aaa&&(_0x538aaa>0x0?Object[_0x3ce8de(0x1bf)](_0x3f47ee,{'days':(0x0,typeorm_2['MoreThan'])(0x0)}):Object[_0x3ce8de(0x1bf)](_0x3f47ee,{'days':(0x0,typeorm_2[_0x3ce8de(0x1ca)])(0x0)}));const [_0x5ca064,_0x7a0715]=await this[_0x3ce8de(0x1bd)]['findAndCount']({'skip':(page-0x1)*size,'take':size,'where':_0x3f47ee,'order':{'order':'DESC'}});return{'rows':_0x5ca064,'count':_0x7a0715};}catch(_0x861773){console['log'](_0x3ce8de(0x1ed),_0x861773);}}async[_0x3b713f(0x1f5)](_0x18f452){const _0x2fabd4=_0x3b713f,{name:_0x13f5a4,weight:_0x1986dc}=_0x18f452,_0x5cce7e=await this[_0x2fabd4(0x1bd)][_0x2fabd4(0x206)]({'where':[{'name':_0x13f5a4},{'weight':_0x1986dc}]});if(_0x5cce7e)throw new common_1['HttpException'](_0x2fabd4(0x1f7),common_1['HttpStatus']['BAD_REQUEST']);try{return await this['cramiPackageEntity'][_0x2fabd4(0x1e5)](_0x18f452);}catch(_0xd098e){console['log'](_0x2fabd4(0x1ed),_0xd098e);throw new common_1[(_0x2fabd4(0x1de))](_0xd098e,common_1[_0x2fabd4(0x1d5)][_0x2fabd4(0x1ab)]);}}async[_0x3b713f(0x1c4)](_0x1e377b){const _0x74539f=_0x3b713f,{id:_0x7150fe,name:_0x215008,weight:_0x296708}=_0x1e377b,_0x5d9b71=await this[_0x74539f(0x1bd)][_0x74539f(0x206)]({'where':{'id':_0x7150fe}});if(!_0x5d9b71)throw new common_1[(_0x74539f(0x1de))](_0x74539f(0x205),common_1['HttpStatus'][_0x74539f(0x1ab)]);const _0x117293=await this[_0x74539f(0x1bd)][_0x74539f(0x209)]({'where':[{'name':_0x215008,'id':(0x0,typeorm_2[_0x74539f(0x1ad)])(_0x7150fe)},{'weight':_0x296708,'id':(0x0,typeorm_2['Not'])(_0x7150fe)}]});if(_0x117293)throw new common_1[(_0x74539f(0x1de))](_0x74539f(0x1f7),common_1[_0x74539f(0x1d5)][_0x74539f(0x1ab)]);const _0x4b0c3e=await this[_0x74539f(0x1bd)][_0x74539f(0x1e6)]({'id':_0x7150fe},_0x1e377b);if(_0x4b0c3e['affected']>0x0)return'更新套餐成功！';else throw new common_1[(_0x74539f(0x1de))](_0x74539f(0x1c9),common_1['HttpStatus'][_0x74539f(0x1ab)]);}async[_0x3b713f(0x1f3)](_0x25af37){const _0x4c1c41=_0x3b713f,{id:_0x176709}=_0x25af37,_0x43f16d=await this[_0x4c1c41(0x1ae)][_0x4c1c41(0x209)]({'where':{'packageId':_0x176709}});if(_0x43f16d)throw new common_1[(_0x4c1c41(0x1de))](_0x4c1c41(0x1b7),common_1[_0x4c1c41(0x1d5)]['BAD_REQUEST']);return await this[_0x4c1c41(0x1bd)][_0x4c1c41(0x207)]({'id':_0x176709});}async[_0x3b713f(0x1d7)](_0x2c2ae2){const _0x2c5347=_0x3b713f,{packageId:_0x504b04,count:count=0x1}=_0x2c2ae2;if(_0x504b04){const _0x58d99c=await this['cramiPackageEntity'][_0x2c5347(0x206)]({'where':{'id':_0x504b04}});if(!_0x58d99c)throw new common_1[(_0x2c5347(0x1de))](_0x2c5347(0x1e9),common_1['HttpStatus'][_0x2c5347(0x1ab)]);const {days:days=-0x1,model3Count:model3Count=0x0,model4Count:model4Count=0x0,drawMjCount:drawMjCount=0x0}=_0x58d99c,_0x14c141={'packageId':_0x504b04,'days':days,'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount};return await this[_0x2c5347(0x1df)](_0x14c141,count);}if(!_0x504b04){const {model3Count:model3Count=0x0,model4Count:model4Count=0x0,drawMjCount:drawMjCount=0x0}=_0x2c2ae2;if([model3Count,model4Count,drawMjCount][_0x2c5347(0x1d2)](_0x24f62d=>!_0x24f62d))throw new common_1['HttpException'](_0x2c5347(0x1cb),common_1['HttpStatus'][_0x2c5347(0x1ab)]);const _0x59a3bb={'days':-0x1,'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount};return await this[_0x2c5347(0x1df)](_0x59a3bb,count);}}async['generateCrami'](_0xc0b01,_0x2b2eff){const _0x5de08a=_0x3b713f,_0x27d67a=[];for(let _0x2eba26=0x0;_0x2eba26<_0x2b2eff;_0x2eba26++){const _0x340136=(0x0,utils_1[_0x5de08a(0x1bc)])(),_0x3a998e=this[_0x5de08a(0x1ae)][_0x5de08a(0x1c1)](Object[_0x5de08a(0x1bf)](Object[_0x5de08a(0x1bf)]({},_0xc0b01),{'code':_0x340136}));_0x27d67a[_0x5de08a(0x1b2)](_0x3a998e);}return await this[_0x5de08a(0x1ae)][_0x5de08a(0x1e5)](_0x27d67a);}async[_0x3b713f(0x20b)](_0x3df3d0,_0x2fa792){const _0x557e81=_0x3b713f,{id:_0x743fb3}=_0x3df3d0[_0x557e81(0x202)],_0x1b4f81=await this['cramiEntity']['findOne']({'where':{'code':_0x2fa792[_0x557e81(0x1fa)]}});if(!_0x1b4f81)throw new common_1[(_0x557e81(0x1de))](_0x557e81(0x1cd),common_1[_0x557e81(0x1d5)][_0x557e81(0x1ab)]);const {status:_0x20b850,days:days=-0x1,model3Count:model3Count=0x0,model4Count:model4Count=0x0,drawMjCount:drawMjCount=0x0,packageId:_0x2af4e2}=_0x1b4f81;if(_0x20b850===0x1)throw new common_1[(_0x557e81(0x1de))](_0x557e81(0x1d3),common_1[_0x557e81(0x1d5)]['BAD_REQUEST']);const _0x5d4b1c={'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount,'packageId':_0x2af4e2};return await this[_0x557e81(0x1eb)][_0x557e81(0x1da)](_0x743fb3,Object['assign']({},_0x5d4b1c),days),await this[_0x557e81(0x1eb)][_0x557e81(0x1c8)]({'userId':_0x743fb3,'rechargeType':balance_constant_1['RechargeType'][_0x557e81(0x1e3)],'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount,'days':days}),await this[_0x557e81(0x1ae)]['update']({'code':_0x2fa792[_0x557e81(0x1fa)]},{'useId':_0x743fb3,'status':0x1}),_0x557e81(0x1cf);}async[_0x3b713f(0x1db)](_0x237b78,_0x514894){const _0x52bfa7=_0x3b713f,{page:page=0x1,size:size=0xa,status:_0x320f7f,useId:_0x1977a8}=_0x237b78,_0xa16ebd={};_0x320f7f&&Object[_0x52bfa7(0x1bf)](_0xa16ebd,{'status':_0x320f7f}),_0x1977a8&&Object['assign'](_0xa16ebd,{'useId':_0x1977a8});const [_0x502573,_0x30d5c0]=await this['cramiEntity'][_0x52bfa7(0x1b3)]({'skip':(page-0x1)*size,'take':size,'order':{'createdAt':_0x52bfa7(0x1e4)},'where':_0xa16ebd}),_0x214d8f=_0x502573[_0x52bfa7(0x1dd)](_0x3b63ef=>_0x3b63ef[_0x52bfa7(0x200)]),_0x2d11a2=_0x502573['map'](_0x3e690d=>_0x3e690d[_0x52bfa7(0x1b9)]),_0x4fca02=await this[_0x52bfa7(0x1e8)][_0x52bfa7(0x1c0)]({'where':{'id':(0x0,typeorm_2['In'])(_0x214d8f)}}),_0x4a5477=await this['cramiPackageEntity'][_0x52bfa7(0x1c0)]({'where':{'id':(0x0,typeorm_2['In'])(_0x2d11a2)}});return _0x502573[_0x52bfa7(0x1d6)](_0x9d7891=>{const _0x555106=_0x52bfa7;var _0x59bb4c,_0x32d2fb,_0x1dd0d9;_0x9d7891[_0x555106(0x1e0)]=(_0x59bb4c=_0x4fca02['find'](_0x5f5424=>_0x5f5424['id']===_0x9d7891[_0x555106(0x200)]))===null||_0x59bb4c===void 0x0?void 0x0:_0x59bb4c[_0x555106(0x1e0)],_0x9d7891['email']=(_0x32d2fb=_0x4fca02['find'](_0x46e6c0=>_0x46e6c0['id']===_0x9d7891[_0x555106(0x200)]))===null||_0x32d2fb===void 0x0?void 0x0:_0x32d2fb[_0x555106(0x208)],_0x9d7891[_0x555106(0x1c7)]=(_0x1dd0d9=_0x4a5477[_0x555106(0x1c0)](_0x97d15a=>_0x97d15a['id']===_0x9d7891[_0x555106(0x1b9)]))===null||_0x1dd0d9===void 0x0?void 0x0:_0x1dd0d9[_0x555106(0x1ff)];}),_0x514894['user'][_0x52bfa7(0x1ac)]!==_0x52bfa7(0x1d0)&&_0x502573[_0x52bfa7(0x1d6)](_0x494214=>_0x494214[_0x52bfa7(0x208)]=(0x0,utils_1[_0x52bfa7(0x1e1)])(_0x494214[_0x52bfa7(0x208)])),_0x514894[_0x52bfa7(0x202)][_0x52bfa7(0x1ac)]!=='super'&&_0x502573[_0x52bfa7(0x1d6)](_0x1bc7c3=>_0x1bc7c3[_0x52bfa7(0x1fa)]=(0x0,utils_1[_0x52bfa7(0x1fc)])(_0x1bc7c3[_0x52bfa7(0x1fa)])),{'rows':_0x502573,'count':_0x30d5c0};}async[_0x3b713f(0x1ea)](_0x53522d){const _0x416abe=_0x3b713f,_0x5da9fa=await this[_0x416abe(0x1ae)][_0x416abe(0x206)]({'where':{'id':_0x53522d}});if(!_0x5da9fa)throw new common_1['HttpException'](_0x416abe(0x204),common_1[_0x416abe(0x1d5)][_0x416abe(0x1ab)]);if(_0x5da9fa[_0x416abe(0x1e7)]===0x1)throw new common_1[(_0x416abe(0x1de))]('当前卡密已被使用、已使用的卡密禁止删除！',common_1[_0x416abe(0x1d5)][_0x416abe(0x1ab)]);return await this['cramiEntity'][_0x416abe(0x207)]({'id':_0x53522d});}async[_0x3b713f(0x1b4)](_0x14e249){const _0xd1e96c=_0x3b713f,{ids:_0x2dc324}=_0x14e249,_0x280f53=await this[_0xd1e96c(0x1ae)][_0xd1e96c(0x207)](_0x2dc324);if(_0x280f53[_0xd1e96c(0x1b8)]>0x0)return'删除卡密成功！';else throw new common_1[(_0xd1e96c(0x1de))](_0xd1e96c(0x201),common_1[_0xd1e96c(0x1d5)][_0xd1e96c(0x1ab)]);}};CramiService=__decorate([(0x0,common_1[_0x3b713f(0x1d1)])(),__param(0x0,(0x0,typeorm_1['InjectRepository'])(crami_entity_1[_0x3b713f(0x1b1)])),__param(0x1,(0x0,typeorm_1[_0x3b713f(0x1d8)])(cramiPackage_entity_1[_0x3b713f(0x1c2)])),__param(0x2,(0x0,typeorm_1[_0x3b713f(0x1d8)])(user_entity_1[_0x3b713f(0x1b5)])),__metadata(_0x3b713f(0x1b6),[typeorm_2[_0x3b713f(0x1dc)],typeorm_2[_0x3b713f(0x1dc)],typeorm_2['Repository'],userBalance_service_1[_0x3b713f(0x1fb)]])],CramiService),exports['CramiService']=CramiService;