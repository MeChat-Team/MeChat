'use strict';const _0x368fdc=_0x10b5;function _0x10b5(_0x18f55b,_0x12fa20){const _0x5af53c=_0x5af5();return _0x10b5=function(_0x10b560,_0x471fb7){_0x10b560=_0x10b560-0x13a;let _0x31b61a=_0x5af53c[_0x10b560];return _0x31b61a;},_0x10b5(_0x18f55b,_0x12fa20);}function _0x5af5(){const _0x265e28=['DESC','10VQVBWS','queryAllPackage','当前卡密不存在、请确认您输入的卡密是否正确！','CramiService','status','super','addBalanceToUser','username','defineProperty','1002692PycEnU','当前卡密不存在、请确认您要删除的卡密是否存在！','24ZaCLuw','删除卡密失败、请重试！','map','error:\x20','../user/user.entity','当前卡密已被使用、请确认您输入的卡密是否正确！','当前套餐不存在、请检查你的输入参数！','1632579XyXCLE','metadata','save','findOne','userBalanceService','delete','__decorate','Repository','31944267jQMTXY','InjectRepository','name','createCrami','@nestjs/common','1033936MCrlZy','../../common/utils','LessThanOrEqual','log','maskCrami','@nestjs/typeorm','更新套餐失败、请重试！','assign','userEntity','maskEmail','使用卡密成功','decorate','套餐名称或套餐等级重复、请检查！','update','PACKAGE_GIFT','packageId','./cramiPackage.entity','1328719dXwLNU','useId','find','当前套餐不存在、请确认您选择的套餐是否存在！','generateCramiCode','function','affected','Not','forEach','saveRecordRechargeLog','cramiEntity','role','findAndCount','自定义卡密必须至少一项余额不为0️零！','email','typeorm','../../common/constants/balance.constant','__metadata','UserBalanceService','every','create','__param','code','BAD_REQUEST','delCrami','object','batchDelCrami','count','Like','HttpStatus','HttpException','RechargeType','length','user','queryAllCrami','packageName','__esModule','4084986LKFCKR','design:paramtypes','../userBalance/userBalance.service','CramiPackageEntity','Injectable','generateCrami','./crami.entity','UserEntity','1600622dSGyIv','cramiPackageEntity'];_0x5af5=function(){return _0x265e28;};return _0x5af5();}(function(_0x341648,_0x293157){const _0x2e9e0a=_0x10b5,_0x2ce71e=_0x341648();while(!![]){try{const _0x4dca02=parseInt(_0x2e9e0a(0x177))/0x1+parseInt(_0x2e9e0a(0x155))/0x2+parseInt(_0x2e9e0a(0x16a))/0x3+parseInt(_0x2e9e0a(0x161))/0x4*(parseInt(_0x2e9e0a(0x158))/0x5)+parseInt(_0x2e9e0a(0x14d))/0x6+-parseInt(_0x2e9e0a(0x188))/0x7*(-parseInt(_0x2e9e0a(0x163))/0x8)+-parseInt(_0x2e9e0a(0x172))/0x9;if(_0x4dca02===_0x293157)break;else _0x2ce71e['push'](_0x2ce71e['shift']());}catch(_0x3d2efc){_0x2ce71e['push'](_0x2ce71e['shift']());}}}(_0x5af5,0x8dc61));var __decorate=this&&this[_0x368fdc(0x170)]||function(_0x3c2716,_0x23de80,_0x43e749,_0x325102){const _0x548c94=_0x368fdc;var _0x3b73f4=arguments[_0x548c94(0x148)],_0x54223f=_0x3b73f4<0x3?_0x23de80:_0x325102===null?_0x325102=Object['getOwnPropertyDescriptor'](_0x23de80,_0x43e749):_0x325102,_0x4ad868;if(typeof Reflect===_0x548c94(0x141)&&typeof Reflect[_0x548c94(0x182)]==='function')_0x54223f=Reflect[_0x548c94(0x182)](_0x3c2716,_0x23de80,_0x43e749,_0x325102);else{for(var _0x808bdb=_0x3c2716['length']-0x1;_0x808bdb>=0x0;_0x808bdb--)if(_0x4ad868=_0x3c2716[_0x808bdb])_0x54223f=(_0x3b73f4<0x3?_0x4ad868(_0x54223f):_0x3b73f4>0x3?_0x4ad868(_0x23de80,_0x43e749,_0x54223f):_0x4ad868(_0x23de80,_0x43e749))||_0x54223f;}return _0x3b73f4>0x3&&_0x54223f&&Object[_0x548c94(0x160)](_0x23de80,_0x43e749,_0x54223f),_0x54223f;},__metadata=this&&this[_0x368fdc(0x199)]||function(_0x5645c8,_0x1de425){const _0x2d08cc=_0x368fdc;if(typeof Reflect===_0x2d08cc(0x141)&&typeof Reflect[_0x2d08cc(0x16b)]===_0x2d08cc(0x18d))return Reflect['metadata'](_0x5645c8,_0x1de425);},__param=this&&this[_0x368fdc(0x13d)]||function(_0x4b4224,_0x12d602){return function(_0x555c04,_0x441717){_0x12d602(_0x555c04,_0x441717,_0x4b4224);};};Object[_0x368fdc(0x160)](exports,_0x368fdc(0x14c),{'value':!![]}),exports[_0x368fdc(0x15b)]=void 0x0;const common_1=require(_0x368fdc(0x176)),crami_entity_1=require(_0x368fdc(0x153)),typeorm_1=require(_0x368fdc(0x17c)),typeorm_2=require(_0x368fdc(0x197)),cramiPackage_entity_1=require(_0x368fdc(0x187)),utils_1=require(_0x368fdc(0x178)),user_entity_1=require(_0x368fdc(0x167)),userBalance_service_1=require(_0x368fdc(0x14f)),balance_constant_1=require(_0x368fdc(0x198));let CramiService=class CramiService{constructor(_0x4c69e6,_0x4971dc,_0x28c84a,_0x264d14){const _0x23bb07=_0x368fdc;this['cramiEntity']=_0x4c69e6,this[_0x23bb07(0x156)]=_0x4971dc,this['userEntity']=_0x28c84a,this[_0x23bb07(0x16e)]=_0x264d14;}async['queryOnePackage'](_0x5462b4){const _0x122e55=_0x368fdc;return await this[_0x122e55(0x156)][_0x122e55(0x16d)]({'where':{'id':_0x5462b4}});}async[_0x368fdc(0x159)](_0x4f45e2){const _0x599a49=_0x368fdc;try{const {page:page=0x1,size:size=0xa,name:_0x592358,status:_0xcb72fa,type:_0x5f5dd6}=_0x4f45e2,_0xb49603={};_0x592358&&Object['assign'](_0xb49603,{'name':(0x0,typeorm_2[_0x599a49(0x144)])('%'+_0x592358+'%')}),_0xcb72fa&&Object[_0x599a49(0x17e)](_0xb49603,{'status':_0xcb72fa});_0x5f5dd6&&(_0x5f5dd6>0x0?Object[_0x599a49(0x17e)](_0xb49603,{'days':(0x0,typeorm_2['MoreThan'])(0x0)}):Object['assign'](_0xb49603,{'days':(0x0,typeorm_2[_0x599a49(0x179)])(0x0)}));const [_0x49d04a,_0x520b48]=await this[_0x599a49(0x156)][_0x599a49(0x194)]({'skip':(page-0x1)*size,'take':size,'where':_0xb49603,'order':{'order':'DESC'}});return{'rows':_0x49d04a,'count':_0x520b48};}catch(_0xec4268){console[_0x599a49(0x17a)](_0x599a49(0x166),_0xec4268);}}async['createPackage'](_0x4e6d5b){const _0x17ed50=_0x368fdc,{name:_0x4322e8,weight:_0x17c1fb}=_0x4e6d5b,_0x2ecb92=await this[_0x17ed50(0x156)][_0x17ed50(0x16d)]({'where':[{'name':_0x4322e8},{'weight':_0x17c1fb}]});if(_0x2ecb92)throw new common_1[(_0x17ed50(0x146))](_0x17ed50(0x183),common_1[_0x17ed50(0x145)][_0x17ed50(0x13f)]);try{return await this[_0x17ed50(0x156)][_0x17ed50(0x16c)](_0x4e6d5b);}catch(_0x108860){console[_0x17ed50(0x17a)](_0x17ed50(0x166),_0x108860);throw new common_1[(_0x17ed50(0x146))](_0x108860,common_1[_0x17ed50(0x145)][_0x17ed50(0x13f)]);}}async['updatePackage'](_0x4c025a){const _0xb115c=_0x368fdc,{id:_0x2cf3dc,name:_0x9624bd,weight:_0x408565}=_0x4c025a,_0x41fe7a=await this[_0xb115c(0x156)][_0xb115c(0x16d)]({'where':{'id':_0x2cf3dc}});if(!_0x41fe7a)throw new common_1[(_0xb115c(0x146))](_0xb115c(0x169),common_1[_0xb115c(0x145)]['BAD_REQUEST']);const _0x28cc0a=await this[_0xb115c(0x156)][_0xb115c(0x143)]({'where':[{'name':_0x9624bd,'id':(0x0,typeorm_2['Not'])(_0x2cf3dc)},{'weight':_0x408565,'id':(0x0,typeorm_2[_0xb115c(0x18f)])(_0x2cf3dc)}]});if(_0x28cc0a)throw new common_1[(_0xb115c(0x146))](_0xb115c(0x183),common_1[_0xb115c(0x145)][_0xb115c(0x13f)]);const _0x421846=await this[_0xb115c(0x156)][_0xb115c(0x184)]({'id':_0x2cf3dc},_0x4c025a);if(_0x421846[_0xb115c(0x18e)]>0x0)return'更新套餐成功！';else throw new common_1[(_0xb115c(0x146))](_0xb115c(0x17d),common_1[_0xb115c(0x145)][_0xb115c(0x13f)]);}async['delPackage'](_0xb08049){const _0x31fca3=_0x368fdc,{id:_0x477669}=_0xb08049,_0x5d064f=await this[_0x31fca3(0x192)]['count']({'where':{'packageId':_0x477669}});if(_0x5d064f)throw new common_1[(_0x31fca3(0x146))]('当前套餐下存在卡密、请先删除卡密后才可删除套餐！',common_1[_0x31fca3(0x145)]['BAD_REQUEST']);return await this['cramiPackageEntity'][_0x31fca3(0x16f)]({'id':_0x477669});}async[_0x368fdc(0x175)](_0x3bc490){const _0x1ef5bd=_0x368fdc,{packageId:_0x286d0d,count:count=0x1}=_0x3bc490;if(_0x286d0d){const _0x5f35cb=await this[_0x1ef5bd(0x156)][_0x1ef5bd(0x16d)]({'where':{'id':_0x286d0d}});if(!_0x5f35cb)throw new common_1[(_0x1ef5bd(0x146))](_0x1ef5bd(0x18b),common_1['HttpStatus']['BAD_REQUEST']);const {days:days=-0x1,model3Count:model3Count=0x0,model4Count:model4Count=0x0,drawMjCount:drawMjCount=0x0}=_0x5f35cb,_0x3bfc2c={'packageId':_0x286d0d,'days':days,'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount};return await this[_0x1ef5bd(0x152)](_0x3bfc2c,count);}if(!_0x286d0d){const {model3Count:model3Count=0x0,model4Count:model4Count=0x0,drawMjCount:drawMjCount=0x0}=_0x3bc490;if([model3Count,model4Count,drawMjCount][_0x1ef5bd(0x13b)](_0x1cb618=>!_0x1cb618))throw new common_1[(_0x1ef5bd(0x146))](_0x1ef5bd(0x195),common_1[_0x1ef5bd(0x145)][_0x1ef5bd(0x13f)]);const _0x17d7e6={'days':-0x1,'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount};return await this[_0x1ef5bd(0x152)](_0x17d7e6,count);}}async[_0x368fdc(0x152)](_0x2a5752,_0x37933f){const _0x5dc697=_0x368fdc,_0xbf4ecf=[];for(let _0x3483d1=0x0;_0x3483d1<_0x37933f;_0x3483d1++){const _0x4ff973=(0x0,utils_1[_0x5dc697(0x18c)])(),_0x2e6563=this[_0x5dc697(0x192)][_0x5dc697(0x13c)](Object[_0x5dc697(0x17e)](Object[_0x5dc697(0x17e)]({},_0x2a5752),{'code':_0x4ff973}));_0xbf4ecf['push'](_0x2e6563);}return await this['cramiEntity'][_0x5dc697(0x16c)](_0xbf4ecf);}async['useCrami'](_0x19021b,_0x1c612d){const _0x3f214e=_0x368fdc,{id:_0xb9840f}=_0x19021b[_0x3f214e(0x149)],_0x58ae34=await this[_0x3f214e(0x192)][_0x3f214e(0x16d)]({'where':{'code':_0x1c612d['code']}});if(!_0x58ae34)throw new common_1[(_0x3f214e(0x146))](_0x3f214e(0x15a),common_1[_0x3f214e(0x145)][_0x3f214e(0x13f)]);const {status:_0x49ce5e,days:days=-0x1,model3Count:model3Count=0x0,model4Count:model4Count=0x0,drawMjCount:drawMjCount=0x0,packageId:_0x481be5}=_0x58ae34;if(_0x49ce5e===0x1)throw new common_1[(_0x3f214e(0x146))](_0x3f214e(0x168),common_1[_0x3f214e(0x145)][_0x3f214e(0x13f)]);const _0xd3b854={'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount,'packageId':_0x481be5};return await this[_0x3f214e(0x16e)][_0x3f214e(0x15e)](_0xb9840f,Object[_0x3f214e(0x17e)]({},_0xd3b854),days),await this[_0x3f214e(0x16e)][_0x3f214e(0x191)]({'userId':_0xb9840f,'rechargeType':balance_constant_1[_0x3f214e(0x147)][_0x3f214e(0x185)],'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount,'days':days}),await this[_0x3f214e(0x192)][_0x3f214e(0x184)]({'code':_0x1c612d[_0x3f214e(0x13e)]},{'useId':_0xb9840f,'status':0x1}),_0x3f214e(0x181);}async[_0x368fdc(0x14a)](_0x53b559,_0x728e54){const _0x273238=_0x368fdc,{page:page=0x1,size:size=0xa,status:_0x27ecee,useId:_0x51ccd4}=_0x53b559,_0x107db8={};_0x27ecee&&Object[_0x273238(0x17e)](_0x107db8,{'status':_0x27ecee}),_0x51ccd4&&Object[_0x273238(0x17e)](_0x107db8,{'useId':_0x51ccd4});const [_0x4163e9,_0x3d6fef]=await this[_0x273238(0x192)]['findAndCount']({'skip':(page-0x1)*size,'take':size,'order':{'createdAt':_0x273238(0x157)},'where':_0x107db8}),_0x2dcae9=_0x4163e9[_0x273238(0x165)](_0x54f76c=>_0x54f76c['useId']),_0x504a06=_0x4163e9[_0x273238(0x165)](_0x4f0596=>_0x4f0596[_0x273238(0x186)]),_0x1a79e4=await this[_0x273238(0x17f)]['find']({'where':{'id':(0x0,typeorm_2['In'])(_0x2dcae9)}}),_0x36077f=await this[_0x273238(0x156)][_0x273238(0x18a)]({'where':{'id':(0x0,typeorm_2['In'])(_0x504a06)}});return _0x4163e9[_0x273238(0x190)](_0xcf2978=>{const _0x2d17a6=_0x273238;var _0xaf57bb,_0x164cf0,_0x584020;_0xcf2978[_0x2d17a6(0x15f)]=(_0xaf57bb=_0x1a79e4['find'](_0x1c13a5=>_0x1c13a5['id']===_0xcf2978[_0x2d17a6(0x189)]))===null||_0xaf57bb===void 0x0?void 0x0:_0xaf57bb[_0x2d17a6(0x15f)],_0xcf2978[_0x2d17a6(0x196)]=(_0x164cf0=_0x1a79e4['find'](_0x4cb789=>_0x4cb789['id']===_0xcf2978[_0x2d17a6(0x189)]))===null||_0x164cf0===void 0x0?void 0x0:_0x164cf0[_0x2d17a6(0x196)],_0xcf2978[_0x2d17a6(0x14b)]=(_0x584020=_0x36077f[_0x2d17a6(0x18a)](_0x2607b3=>_0x2607b3['id']===_0xcf2978[_0x2d17a6(0x186)]))===null||_0x584020===void 0x0?void 0x0:_0x584020[_0x2d17a6(0x174)];}),_0x728e54[_0x273238(0x149)][_0x273238(0x193)]!==_0x273238(0x15d)&&_0x4163e9[_0x273238(0x190)](_0x10cdcf=>_0x10cdcf['email']=(0x0,utils_1[_0x273238(0x180)])(_0x10cdcf[_0x273238(0x196)])),_0x728e54[_0x273238(0x149)][_0x273238(0x193)]!=='super'&&_0x4163e9[_0x273238(0x190)](_0x5773b1=>_0x5773b1[_0x273238(0x13e)]=(0x0,utils_1[_0x273238(0x17b)])(_0x5773b1[_0x273238(0x13e)])),{'rows':_0x4163e9,'count':_0x3d6fef};}async[_0x368fdc(0x140)](_0x48ddc1){const _0x586191=_0x368fdc,_0x35c59b=await this[_0x586191(0x192)][_0x586191(0x16d)]({'where':{'id':_0x48ddc1}});if(!_0x35c59b)throw new common_1[(_0x586191(0x146))](_0x586191(0x162),common_1[_0x586191(0x145)][_0x586191(0x13f)]);if(_0x35c59b[_0x586191(0x15c)]===0x1)throw new common_1[(_0x586191(0x146))]('当前卡密已被使用、已使用的卡密禁止删除！',common_1[_0x586191(0x145)][_0x586191(0x13f)]);return await this[_0x586191(0x192)][_0x586191(0x16f)]({'id':_0x48ddc1});}async[_0x368fdc(0x142)](_0xd46548){const _0x4db1f0=_0x368fdc,{ids:_0x496379}=_0xd46548,_0x94194d=await this[_0x4db1f0(0x192)][_0x4db1f0(0x16f)](_0x496379);if(_0x94194d['affected']>0x0)return'删除卡密成功！';else throw new common_1['HttpException'](_0x4db1f0(0x164),common_1[_0x4db1f0(0x145)][_0x4db1f0(0x13f)]);}};CramiService=__decorate([(0x0,common_1[_0x368fdc(0x151)])(),__param(0x0,(0x0,typeorm_1['InjectRepository'])(crami_entity_1['CramiEntity'])),__param(0x1,(0x0,typeorm_1[_0x368fdc(0x173)])(cramiPackage_entity_1[_0x368fdc(0x150)])),__param(0x2,(0x0,typeorm_1[_0x368fdc(0x173)])(user_entity_1[_0x368fdc(0x154)])),__metadata(_0x368fdc(0x14e),[typeorm_2['Repository'],typeorm_2[_0x368fdc(0x171)],typeorm_2['Repository'],userBalance_service_1[_0x368fdc(0x13a)]])],CramiService),exports[_0x368fdc(0x15b)]=CramiService;