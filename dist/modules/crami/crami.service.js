'use strict';function _0x57b0(_0x5892a1,_0xf7c73){const _0x14219a=_0x1421();return _0x57b0=function(_0x57b016,_0xb8f0f7){_0x57b016=_0x57b016-0x97;let _0x5d6037=_0x14219a[_0x57b016];return _0x5d6037;},_0x57b0(_0x5892a1,_0xf7c73);}const _0x4ac5b5=_0x57b0;(function(_0xefddcd,_0x1eb61e){const _0x5c38cf=_0x57b0,_0xeb755d=_0xefddcd();while(!![]){try{const _0x2296da=-parseInt(_0x5c38cf(0xed))/0x1+-parseInt(_0x5c38cf(0xb2))/0x2+parseInt(_0x5c38cf(0xd7))/0x3+parseInt(_0x5c38cf(0xbb))/0x4*(parseInt(_0x5c38cf(0xac))/0x5)+parseInt(_0x5c38cf(0x9b))/0x6*(parseInt(_0x5c38cf(0xbc))/0x7)+-parseInt(_0x5c38cf(0xdb))/0x8*(-parseInt(_0x5c38cf(0xbf))/0x9)+parseInt(_0x5c38cf(0xf3))/0xa;if(_0x2296da===_0x1eb61e)break;else _0xeb755d['push'](_0xeb755d['shift']());}catch(_0x186036){_0xeb755d['push'](_0xeb755d['shift']());}}}(_0x1421,0x734ce));function _0x1421(){const _0x47f993=['@nestjs/common','套餐名称或套餐等级重复、请检查！','UserEntity','849457TIQUEZ','error:\x20','username','assign','当前套餐不存在、请确认您选择的套餐是否存在！','cramiEntity','8631930YWxzkA','CramiEntity','generateCrami','delCrami','status','6RDHmUl','../../common/utils','findOne','HttpException','CramiPackageEntity','cramiPackageEntity','userEntity','MoreThan','function','userBalanceService','role','LessThanOrEqual','Repository','RechargeType','useCrami','findAndCount','删除卡密失败、请重试！','8375VXhSMK','every','Like','当前套餐不存在、请检查你的输入参数！','find','affected','1108878vyORPh','__metadata','../../common/constants/balance.constant','UserBalanceService','update','../userBalance/userBalance.service','log','design:paramtypes','name','8pLzVBL','340172cLNfqH','email','自定义卡密必须至少一项余额不为0️零！','10629nUfOjM','packageId','Injectable','DESC','queryOnePackage','当前卡密已被使用、请确认您输入的卡密是否正确！','maskEmail','updatePackage','./cramiPackage.entity','HttpStatus','object','createPackage','delete','删除卡密成功！','CramiService','map','使用卡密成功','当前套餐下存在卡密、请先删除卡密后才可删除套餐！','getOwnPropertyDescriptor','BAD_REQUEST','maskCrami','InjectRepository','../user/user.entity','@nestjs/typeorm','1575714Knkzdp','code','count','packageName','2952ywyiWV','当前卡密已被使用、已使用的卡密禁止删除！','metadata','decorate','length','user','当前卡密不存在、请确认您输入的卡密是否正确！','queryAllCrami','useId','save','push','forEach','__esModule','Not','defineProperty'];_0x1421=function(){return _0x47f993;};return _0x1421();}var __decorate=this&&this['__decorate']||function(_0x23c069,_0x2a3515,_0x3beb66,_0x1bfa2d){const _0x2eb051=_0x57b0;var _0x13cc0c=arguments[_0x2eb051(0xdf)],_0x4dbba3=_0x13cc0c<0x3?_0x2a3515:_0x1bfa2d===null?_0x1bfa2d=Object[_0x2eb051(0xd1)](_0x2a3515,_0x3beb66):_0x1bfa2d,_0x3a3230;if(typeof Reflect===_0x2eb051(0xc9)&&typeof Reflect['decorate']===_0x2eb051(0xa3))_0x4dbba3=Reflect[_0x2eb051(0xde)](_0x23c069,_0x2a3515,_0x3beb66,_0x1bfa2d);else{for(var _0x2d8738=_0x23c069[_0x2eb051(0xdf)]-0x1;_0x2d8738>=0x0;_0x2d8738--)if(_0x3a3230=_0x23c069[_0x2d8738])_0x4dbba3=(_0x13cc0c<0x3?_0x3a3230(_0x4dbba3):_0x13cc0c>0x3?_0x3a3230(_0x2a3515,_0x3beb66,_0x4dbba3):_0x3a3230(_0x2a3515,_0x3beb66))||_0x4dbba3;}return _0x13cc0c>0x3&&_0x4dbba3&&Object[_0x2eb051(0xe9)](_0x2a3515,_0x3beb66,_0x4dbba3),_0x4dbba3;},__metadata=this&&this[_0x4ac5b5(0xb3)]||function(_0x4c24c6,_0x4ef602){const _0x3b8c2b=_0x4ac5b5;if(typeof Reflect==='object'&&typeof Reflect[_0x3b8c2b(0xdd)]===_0x3b8c2b(0xa3))return Reflect['metadata'](_0x4c24c6,_0x4ef602);},__param=this&&this['__param']||function(_0x23d292,_0x8b09e5){return function(_0xb26ff0,_0x122f78){_0x8b09e5(_0xb26ff0,_0x122f78,_0x23d292);};};Object['defineProperty'](exports,_0x4ac5b5(0xe7),{'value':!![]}),exports[_0x4ac5b5(0xcd)]=void 0x0;const common_1=require(_0x4ac5b5(0xea)),crami_entity_1=require('./crami.entity'),typeorm_1=require(_0x4ac5b5(0xd6)),typeorm_2=require('typeorm'),cramiPackage_entity_1=require(_0x4ac5b5(0xc7)),utils_1=require(_0x4ac5b5(0x9c)),user_entity_1=require(_0x4ac5b5(0xd5)),userBalance_service_1=require(_0x4ac5b5(0xb7)),balance_constant_1=require(_0x4ac5b5(0xb4));let CramiService=class CramiService{constructor(_0x469ea3,_0x5a3097,_0x5bbc6c,_0x352ee0){const _0x20e803=_0x4ac5b5;this[_0x20e803(0xf2)]=_0x469ea3,this['cramiPackageEntity']=_0x5a3097,this[_0x20e803(0xa1)]=_0x5bbc6c,this[_0x20e803(0xa4)]=_0x352ee0;}async[_0x4ac5b5(0xc3)](_0x105915){const _0x203e5f=_0x4ac5b5;return await this[_0x203e5f(0xa0)]['findOne']({'where':{'id':_0x105915}});}async['queryAllPackage'](_0x613e71){const _0x410f09=_0x4ac5b5;try{const {page:page=0x1,size:size=0xa,name:_0x1720a9,status:_0xd91ab1,type:_0x4d7fb4}=_0x613e71,_0x58bdaf={};_0x1720a9&&Object[_0x410f09(0xf0)](_0x58bdaf,{'name':(0x0,typeorm_2[_0x410f09(0xae)])('%'+_0x1720a9+'%')}),_0xd91ab1&&Object[_0x410f09(0xf0)](_0x58bdaf,{'status':_0xd91ab1});_0x4d7fb4&&(_0x4d7fb4>0x0?Object[_0x410f09(0xf0)](_0x58bdaf,{'days':(0x0,typeorm_2[_0x410f09(0xa2)])(0x0)}):Object['assign'](_0x58bdaf,{'days':(0x0,typeorm_2[_0x410f09(0xa6)])(0x0)}));const [_0x58bfe6,_0x27f5de]=await this['cramiPackageEntity'][_0x410f09(0xaa)]({'skip':(page-0x1)*size,'take':size,'where':_0x58bdaf,'order':{'order':_0x410f09(0xc2)}});return{'rows':_0x58bfe6,'count':_0x27f5de};}catch(_0x250995){console[_0x410f09(0xb8)](_0x410f09(0xee),_0x250995);}}async[_0x4ac5b5(0xca)](_0x45cd52){const _0x3f5639=_0x4ac5b5,{name:_0x52ba55,weight:_0x4e4dd2}=_0x45cd52,_0x5e2ba3=await this[_0x3f5639(0xa0)]['findOne']({'where':[{'name':_0x52ba55},{'weight':_0x4e4dd2}]});if(_0x5e2ba3)throw new common_1['HttpException'](_0x3f5639(0xeb),common_1[_0x3f5639(0xc8)]['BAD_REQUEST']);try{return await this[_0x3f5639(0xa0)][_0x3f5639(0xe4)](_0x45cd52);}catch(_0x29ad13){console[_0x3f5639(0xb8)](_0x3f5639(0xee),_0x29ad13);throw new common_1[(_0x3f5639(0x9e))](_0x29ad13,common_1[_0x3f5639(0xc8)][_0x3f5639(0xd2)]);}}async[_0x4ac5b5(0xc6)](_0x132f8f){const _0x1bc283=_0x4ac5b5,{id:_0x20d138,name:_0x2fdfb9,weight:_0xa7cdeb}=_0x132f8f,_0xf93ce7=await this[_0x1bc283(0xa0)][_0x1bc283(0x9d)]({'where':{'id':_0x20d138}});if(!_0xf93ce7)throw new common_1[(_0x1bc283(0x9e))](_0x1bc283(0xaf),common_1[_0x1bc283(0xc8)]['BAD_REQUEST']);const _0x528531=await this[_0x1bc283(0xa0)][_0x1bc283(0xd9)]({'where':[{'name':_0x2fdfb9,'id':(0x0,typeorm_2[_0x1bc283(0xe8)])(_0x20d138)},{'weight':_0xa7cdeb,'id':(0x0,typeorm_2[_0x1bc283(0xe8)])(_0x20d138)}]});if(_0x528531)throw new common_1[(_0x1bc283(0x9e))](_0x1bc283(0xeb),common_1[_0x1bc283(0xc8)][_0x1bc283(0xd2)]);const _0xd79472=await this['cramiPackageEntity'][_0x1bc283(0xb6)]({'id':_0x20d138},_0x132f8f);if(_0xd79472[_0x1bc283(0xb1)]>0x0)return'更新套餐成功！';else throw new common_1[(_0x1bc283(0x9e))]('更新套餐失败、请重试！',common_1[_0x1bc283(0xc8)][_0x1bc283(0xd2)]);}async['delPackage'](_0x20258f){const _0x278f09=_0x4ac5b5,{id:_0x5dafd0}=_0x20258f,_0x5b3c61=await this[_0x278f09(0xf2)][_0x278f09(0xd9)]({'where':{'packageId':_0x5dafd0}});if(_0x5b3c61)throw new common_1['HttpException'](_0x278f09(0xd0),common_1[_0x278f09(0xc8)]['BAD_REQUEST']);return await this[_0x278f09(0xa0)][_0x278f09(0xcb)]({'id':_0x5dafd0});}async['createCrami'](_0x5599b6){const _0x9cd401=_0x4ac5b5,{packageId:_0x487d29,count:count=0x1}=_0x5599b6;if(_0x487d29){const _0x4fd604=await this['cramiPackageEntity']['findOne']({'where':{'id':_0x487d29}});if(!_0x4fd604)throw new common_1[(_0x9cd401(0x9e))](_0x9cd401(0xf1),common_1[_0x9cd401(0xc8)][_0x9cd401(0xd2)]);const {days:days=-0x1,model3Count:model3Count=0x0,model4Count:model4Count=0x0,drawMjCount:drawMjCount=0x0}=_0x4fd604,_0x2b2086={'packageId':_0x487d29,'days':days,'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount};return await this[_0x9cd401(0x98)](_0x2b2086,count);}if(!_0x487d29){const {model3Count:model3Count=0x0,model4Count:model4Count=0x0,drawMjCount:drawMjCount=0x0}=_0x5599b6;if([model3Count,model4Count,drawMjCount][_0x9cd401(0xad)](_0x59b042=>!_0x59b042))throw new common_1[(_0x9cd401(0x9e))](_0x9cd401(0xbe),common_1[_0x9cd401(0xc8)][_0x9cd401(0xd2)]);const _0x52cbeb={'days':-0x1,'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount};return await this[_0x9cd401(0x98)](_0x52cbeb,count);}}async[_0x4ac5b5(0x98)](_0x2f2b8e,_0x4d31d2){const _0x4957b9=_0x4ac5b5,_0x16436f=[];for(let _0xb371b0=0x0;_0xb371b0<_0x4d31d2;_0xb371b0++){const _0x5ba848=(0x0,utils_1['generateCramiCode'])(),_0x2a729c=this[_0x4957b9(0xf2)]['create'](Object['assign'](Object[_0x4957b9(0xf0)]({},_0x2f2b8e),{'code':_0x5ba848}));_0x16436f[_0x4957b9(0xe5)](_0x2a729c);}return await this[_0x4957b9(0xf2)][_0x4957b9(0xe4)](_0x16436f);}async[_0x4ac5b5(0xa9)](_0x31697a,_0x24eb70){const _0x319e7c=_0x4ac5b5,{id:_0x1d2acf}=_0x31697a[_0x319e7c(0xe0)],_0x482e15=await this[_0x319e7c(0xf2)][_0x319e7c(0x9d)]({'where':{'code':_0x24eb70[_0x319e7c(0xd8)]}});if(!_0x482e15)throw new common_1['HttpException'](_0x319e7c(0xe1),common_1[_0x319e7c(0xc8)]['BAD_REQUEST']);const {status:_0x332c5a,days:days=-0x1,model3Count:model3Count=0x0,model4Count:model4Count=0x0,drawMjCount:drawMjCount=0x0,packageId:_0x544d32}=_0x482e15;if(_0x332c5a===0x1)throw new common_1[(_0x319e7c(0x9e))](_0x319e7c(0xc4),common_1[_0x319e7c(0xc8)][_0x319e7c(0xd2)]);const _0x11a863={'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount,'packageId':_0x544d32};return await this['userBalanceService']['addBalanceToUser'](_0x1d2acf,Object[_0x319e7c(0xf0)]({},_0x11a863),days),await this[_0x319e7c(0xa4)]['saveRecordRechargeLog']({'userId':_0x1d2acf,'rechargeType':balance_constant_1[_0x319e7c(0xa8)]['PACKAGE_GIFT'],'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount,'days':days}),await this[_0x319e7c(0xf2)][_0x319e7c(0xb6)]({'code':_0x24eb70[_0x319e7c(0xd8)]},{'useId':_0x1d2acf,'status':0x1}),_0x319e7c(0xcf);}async[_0x4ac5b5(0xe2)](_0x22b461,_0x149e1a){const _0x430921=_0x4ac5b5,{page:page=0x1,size:size=0xa,status:_0x40109a,useId:_0x297e3a}=_0x22b461,_0x6b8fae={};_0x40109a&&Object[_0x430921(0xf0)](_0x6b8fae,{'status':_0x40109a}),_0x297e3a&&Object[_0x430921(0xf0)](_0x6b8fae,{'useId':_0x297e3a});const [_0x2c9bbc,_0x3559d4]=await this[_0x430921(0xf2)][_0x430921(0xaa)]({'skip':(page-0x1)*size,'take':size,'order':{'createdAt':_0x430921(0xc2)},'where':_0x6b8fae}),_0x4291e9=_0x2c9bbc[_0x430921(0xce)](_0x40363d=>_0x40363d[_0x430921(0xe3)]),_0x3a6666=_0x2c9bbc[_0x430921(0xce)](_0x2ea7ee=>_0x2ea7ee[_0x430921(0xc0)]),_0x51d4ec=await this[_0x430921(0xa1)][_0x430921(0xb0)]({'where':{'id':(0x0,typeorm_2['In'])(_0x4291e9)}}),_0xf0f3c3=await this['cramiPackageEntity'][_0x430921(0xb0)]({'where':{'id':(0x0,typeorm_2['In'])(_0x3a6666)}});return _0x2c9bbc[_0x430921(0xe6)](_0x59285d=>{const _0x502017=_0x430921;var _0x263d18,_0x1a0013,_0x534227;_0x59285d[_0x502017(0xef)]=(_0x263d18=_0x51d4ec[_0x502017(0xb0)](_0x155b93=>_0x155b93['id']===_0x59285d['useId']))===null||_0x263d18===void 0x0?void 0x0:_0x263d18[_0x502017(0xef)],_0x59285d[_0x502017(0xbd)]=(_0x1a0013=_0x51d4ec[_0x502017(0xb0)](_0x25c4de=>_0x25c4de['id']===_0x59285d[_0x502017(0xe3)]))===null||_0x1a0013===void 0x0?void 0x0:_0x1a0013[_0x502017(0xbd)],_0x59285d[_0x502017(0xda)]=(_0x534227=_0xf0f3c3[_0x502017(0xb0)](_0x40ebf1=>_0x40ebf1['id']===_0x59285d['packageId']))===null||_0x534227===void 0x0?void 0x0:_0x534227[_0x502017(0xba)];}),_0x149e1a[_0x430921(0xe0)][_0x430921(0xa5)]!=='super'&&_0x2c9bbc[_0x430921(0xe6)](_0x4db018=>_0x4db018['email']=(0x0,utils_1[_0x430921(0xc5)])(_0x4db018[_0x430921(0xbd)])),_0x149e1a['user'][_0x430921(0xa5)]!=='super'&&_0x2c9bbc[_0x430921(0xe6)](_0x13d580=>_0x13d580[_0x430921(0xd8)]=(0x0,utils_1[_0x430921(0xd3)])(_0x13d580[_0x430921(0xd8)])),{'rows':_0x2c9bbc,'count':_0x3559d4};}async[_0x4ac5b5(0x99)](_0x2e7c16){const _0x11624f=_0x4ac5b5,_0x4dc580=await this[_0x11624f(0xf2)]['findOne']({'where':{'id':_0x2e7c16}});if(!_0x4dc580)throw new common_1[(_0x11624f(0x9e))]('当前卡密不存在、请确认您要删除的卡密是否存在！',common_1[_0x11624f(0xc8)][_0x11624f(0xd2)]);if(_0x4dc580[_0x11624f(0x9a)]===0x1)throw new common_1['HttpException'](_0x11624f(0xdc),common_1[_0x11624f(0xc8)][_0x11624f(0xd2)]);return await this[_0x11624f(0xf2)][_0x11624f(0xcb)]({'id':_0x2e7c16});}async['batchDelCrami'](_0x11b796){const _0x506341=_0x4ac5b5,{ids:_0x102c76}=_0x11b796,_0x3b12c2=await this[_0x506341(0xf2)][_0x506341(0xcb)](_0x102c76);if(_0x3b12c2[_0x506341(0xb1)]>0x0)return _0x506341(0xcc);else throw new common_1[(_0x506341(0x9e))](_0x506341(0xab),common_1[_0x506341(0xc8)]['BAD_REQUEST']);}};CramiService=__decorate([(0x0,common_1[_0x4ac5b5(0xc1)])(),__param(0x0,(0x0,typeorm_1[_0x4ac5b5(0xd4)])(crami_entity_1[_0x4ac5b5(0x97)])),__param(0x1,(0x0,typeorm_1['InjectRepository'])(cramiPackage_entity_1[_0x4ac5b5(0x9f)])),__param(0x2,(0x0,typeorm_1[_0x4ac5b5(0xd4)])(user_entity_1[_0x4ac5b5(0xec)])),__metadata(_0x4ac5b5(0xb9),[typeorm_2[_0x4ac5b5(0xa7)],typeorm_2[_0x4ac5b5(0xa7)],typeorm_2[_0x4ac5b5(0xa7)],userBalance_service_1[_0x4ac5b5(0xb5)]])],CramiService),exports[_0x4ac5b5(0xcd)]=CramiService;