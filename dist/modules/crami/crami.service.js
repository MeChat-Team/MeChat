'use strict';const _0x11740d=_0x5064;(function(_0x148736,_0x22e2cb){const _0x451d26=_0x5064,_0x18a8f7=_0x148736();while(!![]){try{const _0x1f2431=parseInt(_0x451d26(0x1c7))/0x1*(-parseInt(_0x451d26(0x1f8))/0x2)+-parseInt(_0x451d26(0x20a))/0x3+-parseInt(_0x451d26(0x1fb))/0x4+-parseInt(_0x451d26(0x1de))/0x5*(parseInt(_0x451d26(0x206))/0x6)+-parseInt(_0x451d26(0x1e4))/0x7+-parseInt(_0x451d26(0x1c3))/0x8+parseInt(_0x451d26(0x1bb))/0x9;if(_0x1f2431===_0x22e2cb)break;else _0x18a8f7['push'](_0x18a8f7['shift']());}catch(_0x2fb26f){_0x18a8f7['push'](_0x18a8f7['shift']());}}}(_0x2656,0x497c6));function _0x2656(){const _0x1ad7cf=['当前卡密不存在、请确认您输入的卡密是否正确！','PACKAGE_GIFT','更新套餐失败、请重试！','DESC','findAndCount','useId','username','54vSBTOO','Like','当前套餐不存在、请确认您选择的套餐是否存在！','queryOnePackage','1576665Brwavz','userBalanceService','cramiEntity','log','当前卡密不存在、请确认您要删除的卡密是否存在！','删除卡密失败、请重试！','queryAllPackage','error:\x20','update','packageName','object','../user/user.entity','21358917IPNKWQ','affected','assign','typeorm','save','HttpException','defineProperty','length','446872PTxIDj','CramiEntity','自定义卡密必须至少一项余额不为0️零！','套餐名称或套餐等级重复、请检查！','183759QpikiD','HttpStatus','CramiPackageEntity','BAD_REQUEST','当前套餐下存在卡密、请先删除卡密后才可删除套餐！','RechargeType','当前套餐不存在、请检查你的输入参数！','Repository','delPackage','addBalanceToUser','generateCramiCode','user','InjectRepository','email','find','updatePackage','create','@nestjs/common','forEach','getOwnPropertyDescriptor','createPackage','__param','删除卡密成功！','157330YjaZxZ','MoreThan','batchDelCrami','role','findOne','使用卡密成功','3027486dldNEc','count','userEntity','generateCrami','UserEntity','LessThanOrEqual','CramiService','packageId','maskCrami','当前卡密已被使用、已使用的卡密禁止删除！','__metadata','saveRecordRechargeLog','delete','../userBalance/userBalance.service','@nestjs/typeorm','code','Not','当前卡密已被使用、请确认您输入的卡密是否正确！','更新套餐成功！','metadata','2yircad','cramiPackageEntity','createCrami','2365400EhWhEE','Injectable','delCrami','super'];_0x2656=function(){return _0x1ad7cf;};return _0x2656();}var __decorate=this&&this['__decorate']||function(_0x59672e,_0x2e49e6,_0x5716a7,_0x2ddb6a){const _0x56d3f4=_0x5064;var _0x4d8734=arguments[_0x56d3f4(0x1c2)],_0x1b7ae2=_0x4d8734<0x3?_0x2e49e6:_0x2ddb6a===null?_0x2ddb6a=Object[_0x56d3f4(0x1da)](_0x2e49e6,_0x5716a7):_0x2ddb6a,_0x44aab3;if(typeof Reflect===_0x56d3f4(0x1b9)&&typeof Reflect['decorate']==='function')_0x1b7ae2=Reflect['decorate'](_0x59672e,_0x2e49e6,_0x5716a7,_0x2ddb6a);else{for(var _0x1aebda=_0x59672e[_0x56d3f4(0x1c2)]-0x1;_0x1aebda>=0x0;_0x1aebda--)if(_0x44aab3=_0x59672e[_0x1aebda])_0x1b7ae2=(_0x4d8734<0x3?_0x44aab3(_0x1b7ae2):_0x4d8734>0x3?_0x44aab3(_0x2e49e6,_0x5716a7,_0x1b7ae2):_0x44aab3(_0x2e49e6,_0x5716a7))||_0x1b7ae2;}return _0x4d8734>0x3&&_0x1b7ae2&&Object[_0x56d3f4(0x1c1)](_0x2e49e6,_0x5716a7,_0x1b7ae2),_0x1b7ae2;},__metadata=this&&this[_0x11740d(0x1ee)]||function(_0x5e6a6e,_0x2513e1){const _0xabc97d=_0x11740d;if(typeof Reflect===_0xabc97d(0x1b9)&&typeof Reflect[_0xabc97d(0x1f7)]==='function')return Reflect[_0xabc97d(0x1f7)](_0x5e6a6e,_0x2513e1);},__param=this&&this[_0x11740d(0x1dc)]||function(_0x5c99dc,_0x12ef07){return function(_0x1a030e,_0xd9002){_0x12ef07(_0x1a030e,_0xd9002,_0x5c99dc);};};Object[_0x11740d(0x1c1)](exports,'__esModule',{'value':!![]}),exports[_0x11740d(0x1ea)]=void 0x0;const common_1=require(_0x11740d(0x1d8)),crami_entity_1=require('./crami.entity'),typeorm_1=require(_0x11740d(0x1f2)),typeorm_2=require(_0x11740d(0x1be)),cramiPackage_entity_1=require('./cramiPackage.entity'),utils_1=require('../../common/utils'),user_entity_1=require(_0x11740d(0x1ba)),userBalance_service_1=require(_0x11740d(0x1f1)),balance_constant_1=require('../../common/constants/balance.constant');function _0x5064(_0x12c764,_0x3ca58d){const _0x265608=_0x2656();return _0x5064=function(_0x5064ad,_0x5ed9ec){_0x5064ad=_0x5064ad-0x1b5;let _0x332abf=_0x265608[_0x5064ad];return _0x332abf;},_0x5064(_0x12c764,_0x3ca58d);}let CramiService=class CramiService{constructor(_0x9f4c5e,_0x8c19e7,_0x51b1c5,_0x308b1f){const _0x3de604=_0x11740d;this['cramiEntity']=_0x9f4c5e,this[_0x3de604(0x1f9)]=_0x8c19e7,this[_0x3de604(0x1e6)]=_0x51b1c5,this[_0x3de604(0x20b)]=_0x308b1f;}async[_0x11740d(0x209)](_0x9936f8){const _0x59e418=_0x11740d;return await this['cramiPackageEntity'][_0x59e418(0x1e2)]({'where':{'id':_0x9936f8}});}async[_0x11740d(0x1b5)](_0x13efdb){const _0x4f5411=_0x11740d;try{const {page:page=0x1,size:size=0xa,name:_0x341af4,status:_0x3d89c2,type:_0x1f1950}=_0x13efdb,_0x1273f3={};_0x341af4&&Object[_0x4f5411(0x1bd)](_0x1273f3,{'name':(0x0,typeorm_2[_0x4f5411(0x207)])('%'+_0x341af4+'%')}),_0x3d89c2&&Object[_0x4f5411(0x1bd)](_0x1273f3,{'status':_0x3d89c2});_0x1f1950&&(_0x1f1950>0x0?Object[_0x4f5411(0x1bd)](_0x1273f3,{'days':(0x0,typeorm_2[_0x4f5411(0x1df)])(0x0)}):Object[_0x4f5411(0x1bd)](_0x1273f3,{'days':(0x0,typeorm_2[_0x4f5411(0x1e9)])(0x0)}));const [_0x5bc207,_0x2496c0]=await this['cramiPackageEntity'][_0x4f5411(0x203)]({'skip':(page-0x1)*size,'take':size,'where':_0x1273f3,'order':{'order':'DESC'}});return{'rows':_0x5bc207,'count':_0x2496c0};}catch(_0x4cbb4c){console[_0x4f5411(0x20d)](_0x4f5411(0x1b6),_0x4cbb4c);}}async[_0x11740d(0x1db)](_0x535b73){const _0x14fc70=_0x11740d,{name:_0x1888cd,weight:_0x17a369}=_0x535b73,_0x16af8e=await this['cramiPackageEntity'][_0x14fc70(0x1e2)]({'where':[{'name':_0x1888cd},{'weight':_0x17a369}]});if(_0x16af8e)throw new common_1[(_0x14fc70(0x1c0))](_0x14fc70(0x1c6),common_1[_0x14fc70(0x1c8)][_0x14fc70(0x1ca)]);try{return await this[_0x14fc70(0x1f9)][_0x14fc70(0x1bf)](_0x535b73);}catch(_0x237df1){console[_0x14fc70(0x20d)]('error:\x20',_0x237df1);throw new common_1[(_0x14fc70(0x1c0))](_0x237df1,common_1[_0x14fc70(0x1c8)][_0x14fc70(0x1ca)]);}}async[_0x11740d(0x1d6)](_0x5ef99a){const _0x595539=_0x11740d,{id:_0x191814,name:_0xc9f87b,weight:_0x5b290c}=_0x5ef99a,_0x5ef24a=await this[_0x595539(0x1f9)][_0x595539(0x1e2)]({'where':{'id':_0x191814}});if(!_0x5ef24a)throw new common_1[(_0x595539(0x1c0))](_0x595539(0x1cd),common_1['HttpStatus'][_0x595539(0x1ca)]);const _0x49823b=await this[_0x595539(0x1f9)][_0x595539(0x1e5)]({'where':[{'name':_0xc9f87b,'id':(0x0,typeorm_2[_0x595539(0x1f4)])(_0x191814)},{'weight':_0x5b290c,'id':(0x0,typeorm_2[_0x595539(0x1f4)])(_0x191814)}]});if(_0x49823b)throw new common_1['HttpException'](_0x595539(0x1c6),common_1['HttpStatus'][_0x595539(0x1ca)]);const _0x47d568=await this[_0x595539(0x1f9)][_0x595539(0x1b7)]({'id':_0x191814},_0x5ef99a);if(_0x47d568[_0x595539(0x1bc)]>0x0)return _0x595539(0x1f6);else throw new common_1[(_0x595539(0x1c0))](_0x595539(0x201),common_1[_0x595539(0x1c8)][_0x595539(0x1ca)]);}async[_0x11740d(0x1cf)](_0x4b8664){const _0xfb77db=_0x11740d,{id:_0xd30c1f}=_0x4b8664,_0x4c3de0=await this[_0xfb77db(0x20c)][_0xfb77db(0x1e5)]({'where':{'packageId':_0xd30c1f}});if(_0x4c3de0)throw new common_1[(_0xfb77db(0x1c0))](_0xfb77db(0x1cb),common_1['HttpStatus'][_0xfb77db(0x1ca)]);return await this['cramiPackageEntity'][_0xfb77db(0x1f0)]({'id':_0xd30c1f});}async[_0x11740d(0x1fa)](_0x265bd5){const _0x2f553d=_0x11740d,{packageId:_0x27f4ba,count:count=0x1}=_0x265bd5;if(_0x27f4ba){const _0x1cc371=await this['cramiPackageEntity']['findOne']({'where':{'id':_0x27f4ba}});if(!_0x1cc371)throw new common_1['HttpException'](_0x2f553d(0x208),common_1[_0x2f553d(0x1c8)]['BAD_REQUEST']);const {days:days=-0x1,model3Count:model3Count=0x0,model4Count:model4Count=0x0,drawMjCount:drawMjCount=0x0}=_0x1cc371,_0x558245={'packageId':_0x27f4ba,'days':days,'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount};return await this[_0x2f553d(0x1e7)](_0x558245,count);}if(!_0x27f4ba){const {model3Count:model3Count=0x0,model4Count:model4Count=0x0,drawMjCount:drawMjCount=0x0}=_0x265bd5;if([model3Count,model4Count,drawMjCount]['every'](_0x421de4=>!_0x421de4))throw new common_1[(_0x2f553d(0x1c0))](_0x2f553d(0x1c5),common_1[_0x2f553d(0x1c8)]['BAD_REQUEST']);const _0x3dbae4={'days':-0x1,'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount};return await this[_0x2f553d(0x1e7)](_0x3dbae4,count);}}async[_0x11740d(0x1e7)](_0x12d0a7,_0x1ef5c5){const _0x4ce8bf=_0x11740d,_0x2052bd=[];for(let _0x402ad9=0x0;_0x402ad9<_0x1ef5c5;_0x402ad9++){const _0x302488=(0x0,utils_1[_0x4ce8bf(0x1d1)])(),_0x49a75e=this[_0x4ce8bf(0x20c)][_0x4ce8bf(0x1d7)](Object[_0x4ce8bf(0x1bd)](Object[_0x4ce8bf(0x1bd)]({},_0x12d0a7),{'code':_0x302488}));_0x2052bd['push'](_0x49a75e);}return await this[_0x4ce8bf(0x20c)]['save'](_0x2052bd);}async['useCrami'](_0x4309f4,_0xe3332c){const _0x247fe4=_0x11740d,{id:_0x25d876}=_0x4309f4[_0x247fe4(0x1d2)],_0x3e3cf4=await this['cramiEntity']['findOne']({'where':{'code':_0xe3332c['code']}});if(!_0x3e3cf4)throw new common_1[(_0x247fe4(0x1c0))](_0x247fe4(0x1ff),common_1[_0x247fe4(0x1c8)][_0x247fe4(0x1ca)]);const {status:_0x220988,days:days=-0x1,model3Count:model3Count=0x0,model4Count:model4Count=0x0,drawMjCount:drawMjCount=0x0,packageId:_0x1c9228}=_0x3e3cf4;if(_0x220988===0x1)throw new common_1[(_0x247fe4(0x1c0))](_0x247fe4(0x1f5),common_1['HttpStatus']['BAD_REQUEST']);const _0x336356={'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount,'packageId':_0x1c9228};return await this['userBalanceService'][_0x247fe4(0x1d0)](_0x25d876,Object[_0x247fe4(0x1bd)]({},_0x336356),days),await this[_0x247fe4(0x20b)][_0x247fe4(0x1ef)]({'userId':_0x25d876,'rechargeType':balance_constant_1[_0x247fe4(0x1cc)][_0x247fe4(0x200)],'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount,'days':days}),await this[_0x247fe4(0x20c)][_0x247fe4(0x1b7)]({'code':_0xe3332c[_0x247fe4(0x1f3)]},{'useId':_0x25d876,'status':0x1}),_0x247fe4(0x1e3);}async['queryAllCrami'](_0x1914b5,_0xaa5e8a){const _0x62b833=_0x11740d,{page:page=0x1,size:size=0xa,status:_0x414e7e,useId:_0x433f73}=_0x1914b5,_0x17b3ae={};_0x414e7e&&Object[_0x62b833(0x1bd)](_0x17b3ae,{'status':_0x414e7e}),_0x433f73&&Object['assign'](_0x17b3ae,{'useId':_0x433f73});const [_0x148d1b,_0xca696e]=await this[_0x62b833(0x20c)][_0x62b833(0x203)]({'skip':(page-0x1)*size,'take':size,'order':{'createdAt':_0x62b833(0x202)},'where':_0x17b3ae}),_0x1014d2=_0x148d1b['map'](_0x4e3862=>_0x4e3862['useId']),_0x466d6f=_0x148d1b['map'](_0x55f56a=>_0x55f56a[_0x62b833(0x1eb)]),_0x30def6=await this['userEntity'][_0x62b833(0x1d5)]({'where':{'id':(0x0,typeorm_2['In'])(_0x1014d2)}}),_0x312c6d=await this[_0x62b833(0x1f9)][_0x62b833(0x1d5)]({'where':{'id':(0x0,typeorm_2['In'])(_0x466d6f)}});return _0x148d1b[_0x62b833(0x1d9)](_0x5d3756=>{const _0x2e5126=_0x62b833;var _0x520e11,_0x370825,_0x4530f5;_0x5d3756[_0x2e5126(0x205)]=(_0x520e11=_0x30def6[_0x2e5126(0x1d5)](_0x1f42b1=>_0x1f42b1['id']===_0x5d3756[_0x2e5126(0x204)]))===null||_0x520e11===void 0x0?void 0x0:_0x520e11[_0x2e5126(0x205)],_0x5d3756[_0x2e5126(0x1d4)]=(_0x370825=_0x30def6[_0x2e5126(0x1d5)](_0x521e0b=>_0x521e0b['id']===_0x5d3756[_0x2e5126(0x204)]))===null||_0x370825===void 0x0?void 0x0:_0x370825[_0x2e5126(0x1d4)],_0x5d3756[_0x2e5126(0x1b8)]=(_0x4530f5=_0x312c6d[_0x2e5126(0x1d5)](_0x22b59e=>_0x22b59e['id']===_0x5d3756[_0x2e5126(0x1eb)]))===null||_0x4530f5===void 0x0?void 0x0:_0x4530f5['name'];}),_0xaa5e8a[_0x62b833(0x1d2)]['role']!=='super'&&_0x148d1b['forEach'](_0x127f2b=>_0x127f2b[_0x62b833(0x1d4)]=(0x0,utils_1['maskEmail'])(_0x127f2b['email'])),_0xaa5e8a[_0x62b833(0x1d2)][_0x62b833(0x1e1)]!==_0x62b833(0x1fe)&&_0x148d1b[_0x62b833(0x1d9)](_0x448af1=>_0x448af1[_0x62b833(0x1f3)]=(0x0,utils_1[_0x62b833(0x1ec)])(_0x448af1['code'])),{'rows':_0x148d1b,'count':_0xca696e};}async[_0x11740d(0x1fd)](_0x37cfdd){const _0x3a2987=_0x11740d,_0x2ef980=await this[_0x3a2987(0x20c)]['findOne']({'where':{'id':_0x37cfdd}});if(!_0x2ef980)throw new common_1['HttpException'](_0x3a2987(0x20e),common_1[_0x3a2987(0x1c8)][_0x3a2987(0x1ca)]);if(_0x2ef980['status']===0x1)throw new common_1[(_0x3a2987(0x1c0))](_0x3a2987(0x1ed),common_1[_0x3a2987(0x1c8)][_0x3a2987(0x1ca)]);return await this[_0x3a2987(0x20c)][_0x3a2987(0x1f0)]({'id':_0x37cfdd});}async[_0x11740d(0x1e0)](_0x5f4b62){const _0x18dca4=_0x11740d,{ids:_0x2aa52c}=_0x5f4b62,_0x193edc=await this['cramiEntity'][_0x18dca4(0x1f0)](_0x2aa52c);if(_0x193edc['affected']>0x0)return _0x18dca4(0x1dd);else throw new common_1['HttpException'](_0x18dca4(0x20f),common_1[_0x18dca4(0x1c8)][_0x18dca4(0x1ca)]);}};CramiService=__decorate([(0x0,common_1[_0x11740d(0x1fc)])(),__param(0x0,(0x0,typeorm_1[_0x11740d(0x1d3)])(crami_entity_1[_0x11740d(0x1c4)])),__param(0x1,(0x0,typeorm_1['InjectRepository'])(cramiPackage_entity_1[_0x11740d(0x1c9)])),__param(0x2,(0x0,typeorm_1[_0x11740d(0x1d3)])(user_entity_1[_0x11740d(0x1e8)])),__metadata('design:paramtypes',[typeorm_2['Repository'],typeorm_2[_0x11740d(0x1ce)],typeorm_2[_0x11740d(0x1ce)],userBalance_service_1['UserBalanceService']])],CramiService),exports[_0x11740d(0x1ea)]=CramiService;