'use strict';const _0xae7a2=_0x1672;(function(_0x3f55b3,_0x456ac0){const _0x14fbb5=_0x1672,_0x3c9d5d=_0x3f55b3();while(!![]){try{const _0x3995bb=parseInt(_0x14fbb5(0xd8))/0x1*(parseInt(_0x14fbb5(0xde))/0x2)+parseInt(_0x14fbb5(0xbf))/0x3+-parseInt(_0x14fbb5(0x9f))/0x4*(-parseInt(_0x14fbb5(0xf9))/0x5)+parseInt(_0x14fbb5(0x11a))/0x6*(parseInt(_0x14fbb5(0xed))/0x7)+-parseInt(_0x14fbb5(0x84))/0x8+-parseInt(_0x14fbb5(0x102))/0x9+-parseInt(_0x14fbb5(0xae))/0xa;if(_0x3995bb===_0x456ac0)break;else _0x3c9d5d['push'](_0x3c9d5d['shift']());}catch(_0x17cd52){_0x3c9d5d['push'](_0x3c9d5d['shift']());}}}(_0x2b5f,0x44e87));function _0x1672(_0x32afc1,_0x166e1c){const _0x2b5f5a=_0x2b5f();return _0x1672=function(_0x1672bf,_0x39bcf7){_0x1672bf=_0x1672bf-0x77;let _0x1826fe=_0x2b5f5a[_0x1672bf];return _0x1826fe;},_0x1672(_0x32afc1,_0x166e1c);}var __decorate=this&&this[_0xae7a2(0x90)]||function(_0x596caa,_0x462832,_0x2ab4b2,_0x21fd91){const _0x2a0a92=_0xae7a2;var _0x168e85=arguments['length'],_0x569521=_0x168e85<0x3?_0x462832:_0x21fd91===null?_0x21fd91=Object[_0x2a0a92(0x124)](_0x462832,_0x2ab4b2):_0x21fd91,_0x4bf760;if(typeof Reflect===_0x2a0a92(0xfe)&&typeof Reflect[_0x2a0a92(0x93)]===_0x2a0a92(0x12b))_0x569521=Reflect['decorate'](_0x596caa,_0x462832,_0x2ab4b2,_0x21fd91);else{for(var _0x1a9da5=_0x596caa[_0x2a0a92(0xe4)]-0x1;_0x1a9da5>=0x0;_0x1a9da5--)if(_0x4bf760=_0x596caa[_0x1a9da5])_0x569521=(_0x168e85<0x3?_0x4bf760(_0x569521):_0x168e85>0x3?_0x4bf760(_0x462832,_0x2ab4b2,_0x569521):_0x4bf760(_0x462832,_0x2ab4b2))||_0x569521;}return _0x168e85>0x3&&_0x569521&&Object['defineProperty'](_0x462832,_0x2ab4b2,_0x569521),_0x569521;},__metadata=this&&this[_0xae7a2(0xbe)]||function(_0x5c117b,_0x5234a9){const _0x136ce8=_0xae7a2;if(typeof Reflect===_0x136ce8(0xfe)&&typeof Reflect['metadata']==='function')return Reflect[_0x136ce8(0x100)](_0x5c117b,_0x5234a9);},__param=this&&this['__param']||function(_0xa19355,_0x1f369a){return function(_0x57357f,_0x36d24e){_0x1f369a(_0x57357f,_0x36d24e,_0xa19355);};};function _0x2b5f(){const _0x55a7c3=['compareSync','校验失败:\x20邮箱\x20\x22','UserEntity','DESC','没有变更，无需更改！','../mailer/mailer.service','重置密码失败！','ACTIVE','./../globalConfig/globalConfig.service','verifyUserRegisterByPhone','reduce','registerVerifyExpir','修改用户状态失败！','configVal','2OrqhLN','maskEmail','尝试发送邮件到:\x20','userRecharge','getUserById','configKey','91408UFijad','addBalanceToNewUser','HttpStatus','status','updateUserStatus','../../common/utils','length','isBindWx','verifyUserPassword','BLACKLISTED','email','error','client','../userBalance/userBalance.service','saveRecordRechargeLog','7SCIJcO','checkUserStatus','@nestjs/common','用户名已存在！','idCard','cloneDeep','UserBalanceService','Not','../../common/constants/verification.constant','RechargeType','getUserOpenId','您的账户已被永久加入黑名单、如有疑问、请联系管理员！','125DwmNUT','Connection','findOne','该微信已绑定其他账号！','design:paramtypes','object','@default.com','metadata','getConfigs','1774674TsIJjq','consecutiveDays','getSuper','BAD_REQUEST','./user.entity','userDefautlAvatar','当前手机号已注册、请勿重复注册！','visitor','registerIp','绑定微信失败、请联系管理员！','findAndCount','用户名或者邮箱已被注册！','Injectable','用户名已存在、请更换用户名！','username','修改用户信息失败！','HttpException','toUpperCase','恭喜您绑定成功、后续可直接扫码登录了！','queryUserBalance','balanceInfo','userEntity','校验邮箱注册:\x20开始\x20-\x20用户名:\x20','password','725070spswXk','isUsernameTaken','assign','修改密码失败、请重新试试吧。','用户不存在','\x22\x20已被注册','phone','userBalanceService','createUser','createdAt','getOwnPropertyDescriptor','ConfigEntity','您的账户已被封禁、如有疑问、请联系管理员！','log','修改用户状态成功！','verificationService','updateUserPassword','function','UNAUTHORIZED','realName','error:\x20','UserStatusEnum','Logger','../../common/constants/balance.constant','maskIpAddress','configEntity','\x22\x20已存在','./../verification/verification.service','hashSync','getUserFromOpenId','defineProperty','createUserFromOpenId','queryOne','verifyUserCredentials','ADMIN_GIFT','slice','3952456FKyVrV','connection','当前账户不存在！','avatar','isVerifyEmail','createUserFromContact','registerVerifyEmailTitle','123456','map','role','forEach','mailerService','__decorate','registerBaseUrl',']成功!','decorate','bindWx','verifyUserRegister','getOpenIdByUserId','createRandomUid','Like','校验失败:\x20用户名\x20\x22','super',',\x20邮箱:\x20','typeorm','save','用户不存在！','83228xZNvnA','getClientIp','globalConfigService','saveRealNameInfo','getUserStatus','校验邮箱注册:\x20成功\x20-\x20用户名:\x20','queryUserInfoById','push','PENDING','addBalanceToUser','Repository','getUserByContact','resetUserPass','InjectRepository','queryAll','1892490rtlOGC','openId','sign','userId','当前用户信息失效、请重新登录！','Registration','当前邮箱已注册、请勿重复注册！','updateInfo','UserService','lastLoginIp','当前密码错误！','../globalConfig/config.entity','超级管理员不可被操作！','verifyUserRegisterByEmail','\x20未被占用','find','__metadata','1290933hjBDEf','密码重置为[','UserStatusErrMsg','修改用户信息成功！','user','@nestjs/typeorm','update','affected','LOCKED','VerificationEnum','getUserInfo'];_0x2b5f=function(){return _0x55a7c3;};return _0x2b5f();}Object[_0xae7a2(0x7e)](exports,'__esModule',{'value':!![]}),exports[_0xae7a2(0xb6)]=void 0x0;const balance_constant_1=require(_0xae7a2(0x77)),verification_constant_1=require(_0xae7a2(0xf5)),utils_1=require(_0xae7a2(0xe3)),mailer_service_1=require(_0xae7a2(0xcf)),common_1=require(_0xae7a2(0xef)),typeorm_1=require(_0xae7a2(0xc4)),bcrypt=require('bcryptjs'),_=require('lodash'),typeorm_2=require(_0xae7a2(0x9c)),config_entity_1=require(_0xae7a2(0xb9)),userBalance_service_1=require(_0xae7a2(0xeb)),user_constant_1=require('./../../common/constants/user.constant'),globalConfig_service_1=require(_0xae7a2(0xd2)),verification_service_1=require(_0xae7a2(0x7b)),user_entity_1=require(_0xae7a2(0x106));let UserService=class UserService{constructor(_0x41a224,_0x1ae754,_0x3b7f8f,_0x997ec6,_0x493858,_0x116ce6,_0x1c3666){const _0x550c0c=_0xae7a2;this['userEntity']=_0x41a224,this[_0x550c0c(0x85)]=_0x1ae754,this[_0x550c0c(0x129)]=_0x3b7f8f,this[_0x550c0c(0x8f)]=_0x997ec6,this['userBalanceService']=_0x493858,this[_0x550c0c(0xa1)]=_0x116ce6,this[_0x550c0c(0x79)]=_0x1c3666;}async['createUserAndVerifycation'](_0x71aa9a,_0x37f329){const _0x5151f0=_0xae7a2,{username:_0x1f3375,email:_0x541262,password:_0x11b376,client:client=0x0}=_0x71aa9a,_0x5431c8=[{'username':_0x1f3375},{'email':_0x541262}],_0x557ad7=await this[_0x5151f0(0x117)][_0x5151f0(0xfb)]({'where':_0x5431c8});if(_0x557ad7&&_0x557ad7[_0x5151f0(0xe1)]!==user_constant_1[_0x5151f0(0x12f)][_0x5151f0(0xa7)])throw new common_1[(_0x5151f0(0x112))](_0x5151f0(0x10d),common_1[_0x5151f0(0xe0)][_0x5151f0(0x105)]);try{const _0x34d7a5=_[_0x5151f0(0xf2)](_0x71aa9a),_0x490c15=bcrypt[_0x5151f0(0x7c)](_0x11b376,0xa),_0x161edf=(0x0,utils_1[_0x5151f0(0xa0)])(_0x37f329);_0x34d7a5[_0x5151f0(0x119)]=_0x490c15,_0x34d7a5[_0x5151f0(0x10a)]=_0x161edf,_0x34d7a5[_0x5151f0(0xea)]=client;let _0x902eb4;if(!_0x557ad7){const _0x2fce51=await this[_0x5151f0(0xa1)]['getConfigs'](['userDefautlAvatar']);_0x34d7a5[_0x5151f0(0x87)]=_0x2fce51,_0x902eb4=await this[_0x5151f0(0x117)][_0x5151f0(0x9d)](_0x34d7a5);}else _0x902eb4=_0x557ad7;const _0x52506c=await this[_0x5151f0(0x79)][_0x5151f0(0xbd)]({'where':{'configKey':(0x0,typeorm_2['In'])([_0x5151f0(0x88),_0x5151f0(0x91),_0x5151f0(0x8a),'registerVerifyEmailDesc','registerVerifyEmailFrom',_0x5151f0(0xd5)])}}),_0x23add5=_0x52506c[_0x5151f0(0xd4)]((_0x1377a3,_0x3b4743)=>{const _0xfc11ac=_0x5151f0;return _0x1377a3[_0x3b4743[_0xfc11ac(0xdd)]]=_0x3b4743[_0xfc11ac(0xd7)],_0x1377a3;},{}),_0x2d8783=_0x23add5[_0x5151f0(0x88)]?Number(_0x23add5[_0x5151f0(0x88)]):0x1;if(_0x2d8783){const _0x4fd28d=_0x23add5[_0x5151f0(0xd5)]?Number(_0x23add5['registerVerifyExpir']):0x1e*0x3c,_0x4631ad=await this[_0x5151f0(0x129)]['createVerification'](_0x902eb4,verification_constant_1[_0x5151f0(0xc8)][_0x5151f0(0xb3)],_0x4fd28d),{code:_0x56437d,email:_0x17c8f6,id:_0x408d8f}=_0x4631ad,{registerVerifyEmailFrom:_0x4ef7a7}=_0x23add5;console['log']('configMap:\x20',_0x23add5),console[_0x5151f0(0x127)](_0x5151f0(0xda)+_0x17c8f6);}else{const {id:_0x1ed0be}=_0x902eb4;await this[_0x5151f0(0xe2)](_0x1ed0be,user_constant_1['UserStatusEnum'][_0x5151f0(0xd1)]),await this[_0x5151f0(0x121)][_0x5151f0(0xdf)](_0x1ed0be);}return _0x902eb4;}catch(_0x3c0191){console[_0x5151f0(0x127)](_0x5151f0(0x12e),_0x3c0191);throw _0x3c0191;}}async[_0xae7a2(0x104)](){const _0x7225bc=_0xae7a2,_0x29f251=await this[_0x7225bc(0x117)][_0x7225bc(0xfb)]({'where':{'role':_0x7225bc(0x9a)}});return _0x29f251;}async[_0xae7a2(0x81)](_0x5ddd34){const _0x1b4b0e=_0xae7a2,{username:_0x427481,password:_0x4dae92,uid:uid=0x0,phone:_0x5c4e62}=_0x5ddd34;let _0xc67910=null;if(uid>0x0){_0xc67910=await this[_0x1b4b0e(0x117)][_0x1b4b0e(0xfb)]({'where':{'id':uid}});if(!_0xc67910)throw new common_1[(_0x1b4b0e(0x112))](_0x1b4b0e(0x86),common_1[_0x1b4b0e(0xe0)][_0x1b4b0e(0x105)]);if(!bcrypt['compareSync'](_0x4dae92,_0xc67910[_0x1b4b0e(0x119)]))throw new common_1[(_0x1b4b0e(0x112))](_0x1b4b0e(0xb8),common_1[_0x1b4b0e(0xe0)][_0x1b4b0e(0x105)]);}if(_0x427481&&_0x4dae92){const _0x59bfa2=[{'username':_0x427481},{'email':_0x427481},{'phone':_0x427481}];_0xc67910=await this[_0x1b4b0e(0x117)][_0x1b4b0e(0xfb)]({'where':_0x59bfa2});if(!_0xc67910)throw new common_1[(_0x1b4b0e(0x112))](_0x1b4b0e(0x86),common_1[_0x1b4b0e(0xe0)][_0x1b4b0e(0x105)]);if(!bcrypt['compareSync'](_0x4dae92,_0xc67910[_0x1b4b0e(0x119)]))throw new common_1[(_0x1b4b0e(0x112))](_0x1b4b0e(0xb8),common_1[_0x1b4b0e(0xe0)]['BAD_REQUEST']);}if(!_0xc67910)throw new common_1[(_0x1b4b0e(0x112))]('当前账户不存在！',common_1[_0x1b4b0e(0xe0)][_0x1b4b0e(0x105)]);if(_0xc67910[_0x1b4b0e(0xe1)]!==user_constant_1[_0x1b4b0e(0x12f)]['ACTIVE'])throw new common_1[(_0x1b4b0e(0x112))](user_constant_1[_0x1b4b0e(0xc1)][_0xc67910[_0x1b4b0e(0xe1)]],common_1[_0x1b4b0e(0xe0)][_0x1b4b0e(0x105)]);return _0xc67910;}async[_0xae7a2(0xe6)](_0x35b991,_0x429c45){const _0x5e8112=_0xae7a2,_0x39b1f4=await this[_0x5e8112(0x117)]['findOne']({'where':{'id':_0x35b991}});return bcrypt[_0x5e8112(0xca)](_0x429c45,_0x39b1f4['password']);}async[_0xae7a2(0xe2)](_0xafe131,_0x28026a){const _0xf7d3fa=_0xae7a2,_0x23ccf1=await this['userEntity'][_0xf7d3fa(0xc5)]({'id':_0xafe131},{'status':_0x28026a});return _0x23ccf1[_0xf7d3fa(0xc6)]>0x0;}async[_0xae7a2(0xa3)](_0x30c6e2){const _0x2d5da4=_0xae7a2,_0x59f6d8=await this[_0x2d5da4(0x117)][_0x2d5da4(0xfb)]({'where':{'id':_0x30c6e2}});return _0x59f6d8[_0x2d5da4(0xe1)];}async[_0xae7a2(0xa5)](_0x53cfde){const _0xda83f6=_0xae7a2;return await this[_0xda83f6(0x117)]['findOne']({'where':{'id':_0x53cfde}});}async['queryOneUserInfo'](_0x2d9f49){const _0x3621c4=_0xae7a2;return await this[_0x3621c4(0x117)][_0x3621c4(0xfb)]({'where':{'id':_0x2d9f49}});}async[_0xae7a2(0xee)](_0x4a7b92){const _0x56153e=_0xae7a2,{id:_0x22de21,role:_0x4dbcc0}=_0x4a7b92;if(_0x4dbcc0===_0x56153e(0x109))return!![];const _0x4a4b3f=await this['userEntity'][_0x56153e(0xfb)]({'where':{'id':_0x22de21}});if(!_0x4a4b3f)throw new common_1[(_0x56153e(0x112))](_0x56153e(0xb2),common_1['HttpStatus']['UNAUTHORIZED']);if(_0x4a4b3f['status']===user_constant_1[_0x56153e(0x12f)][_0x56153e(0xe7)])throw new common_1['HttpException'](_0x56153e(0xf8),common_1['HttpStatus'][_0x56153e(0x105)]);if(_0x4a4b3f[_0x56153e(0xe1)]===user_constant_1['UserStatusEnum'][_0x56153e(0xc7)])throw new common_1[(_0x56153e(0x112))](_0x56153e(0x126),common_1['HttpStatus'][_0x56153e(0x105)]);}async[_0xae7a2(0xc9)](_0x2f7021){const _0x349ba9=_0xae7a2,_0x356e3d=await this['userEntity'][_0x349ba9(0xfb)]({'where':{'id':_0x2f7021},'select':[_0x349ba9(0x110),_0x349ba9(0x87),'role',_0x349ba9(0xe8),'sign',_0x349ba9(0xaf),_0x349ba9(0x103)]});if(!_0x356e3d)throw new common_1[(_0x349ba9(0x112))]('当前用户信息失效、请重新登录！',common_1[_0x349ba9(0xe0)][_0x349ba9(0x12c)]);_0x356e3d[_0x349ba9(0xe5)]=!!(_0x356e3d===null||_0x356e3d===void 0x0?void 0x0:_0x356e3d['openId']),delete _0x356e3d[_0x349ba9(0xaf)];const _0x486c70=await this['userBalanceService'][_0x349ba9(0x115)](_0x2f7021),_0x4f5f62=(_0x2f7021*0x7b+0x5f5e100)['toString'](0x24)[_0x349ba9(0x113)]()[_0x349ba9(0x83)](-0x6);return _0x356e3d['id']=_0x4f5f62,{'userInfo':_0x356e3d,'userBalance':Object[_0x349ba9(0x11c)]({},_0x486c70)};}async[_0xae7a2(0xdc)](_0xa271ea){const _0x11b64b=_0xae7a2;return await this[_0x11b64b(0x117)][_0x11b64b(0xfb)]({'where':{'id':_0xa271ea}});}async[_0xae7a2(0xf7)](_0x214647){const _0x1426fb=_0xae7a2;return await this[_0x1426fb(0x117)][_0x1426fb(0xfb)]({'where':{'openId':_0x214647}});}async[_0xae7a2(0xb5)](_0x4ad444,_0x346166){const _0x396ea9=_0xae7a2,{id:_0x1c6e64}=_0x346166['user'],_0x4c368c=await this[_0x396ea9(0x117)]['findOne']({'where':{'id':_0x1c6e64}});if(!_0x4c368c)throw new common_1[(_0x396ea9(0x112))]('当前用户不存在！',common_1['HttpStatus'][_0x396ea9(0x105)]);if(_0x4ad444[_0x396ea9(0x110)]&&_0x4c368c[_0x396ea9(0x110)]===_0x4ad444['username'])throw new common_1[(_0x396ea9(0x112))](_0x396ea9(0xce),common_1[_0x396ea9(0xe0)]['BAD_REQUEST']);if(_0x4ad444[_0x396ea9(0x110)]){const _0xbfb8f8=await this[_0x396ea9(0x11b)](_0x4ad444[_0x396ea9(0x110)],_0x1c6e64);if(_0xbfb8f8)throw new common_1[(_0x396ea9(0x112))](_0x396ea9(0xf0),common_1[_0x396ea9(0xe0)][_0x396ea9(0x105)]);}const _0x406e95=await this['userEntity'][_0x396ea9(0xc5)]({'id':_0x1c6e64},_0x4ad444);if(_0x406e95[_0x396ea9(0xc6)]<=0x0)throw new common_1['HttpException'](_0x396ea9(0x111),common_1[_0x396ea9(0xe0)]['BAD_REQUEST']);return _0x396ea9(0xc2);}async['isUsernameTaken'](_0x5aa7ff,_0x51fca9){const _0x164a13=_0xae7a2,_0x5b8333={'username':_0x5aa7ff};_0x51fca9&&(_0x5b8333['id']=(0x0,typeorm_2[_0x164a13(0xf4)])(_0x51fca9));const _0x1f43fd=await this[_0x164a13(0x117)]['findOne']({'where':_0x5b8333});return!!_0x1f43fd;}async[_0xae7a2(0x12a)](_0x39cc40,_0x123c83){const _0x262f26=_0xae7a2,_0x1e36dc=bcrypt['hashSync'](_0x123c83,0xa),_0x2e869e=await this[_0x262f26(0x117)][_0x262f26(0xc5)]({'id':_0x39cc40},{'password':_0x1e36dc});if(_0x2e869e[_0x262f26(0xc6)]<=0x0)throw new common_1['HttpException'](_0x262f26(0x11d),common_1['HttpStatus'][_0x262f26(0x105)]);}async[_0xae7a2(0xdb)](_0x42984d){const _0x2732c0=_0xae7a2,{userId:_0x15646a,model3Count:model3Count=0x0,model4Count:model4Count=0x0,drawMjCount:drawMjCount=0x0}=_0x42984d;await this['userBalanceService'][_0x2732c0(0xa8)](_0x15646a,{'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount});const _0x307214=await this['userBalanceService'][_0x2732c0(0xec)]({'userId':_0x15646a,'rechargeType':balance_constant_1[_0x2732c0(0xf6)][_0x2732c0(0x82)],'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount,'extent':''});return _0x307214;}async[_0xae7a2(0xad)](_0x360296,_0x5e5371){const _0x2dd511=_0xae7a2,{page:page=0x1,size:size=0xa,username:_0x6cc0fd,email:_0x186b89,status:_0x3cfe2c,keyword:_0x4bd77f,phone:_0x39335f}=_0x360296;let _0x2af757={};_0x6cc0fd&&Object[_0x2dd511(0x11c)](_0x2af757,{'username':(0x0,typeorm_2[_0x2dd511(0x98)])('%'+_0x6cc0fd+'%')}),_0x186b89&&Object[_0x2dd511(0x11c)](_0x2af757,{'email':(0x0,typeorm_2['Like'])('%'+_0x186b89+'%')}),_0x39335f&&Object[_0x2dd511(0x11c)](_0x2af757,{'phone':(0x0,typeorm_2[_0x2dd511(0x98)])('%'+_0x39335f+'%')}),_0x3cfe2c&&Object[_0x2dd511(0x11c)](_0x2af757,{'status':_0x3cfe2c});_0x4bd77f&&(_0x2af757=[{'username':(0x0,typeorm_2['Like'])('%'+_0x4bd77f+'%')},{'email':(0x0,typeorm_2[_0x2dd511(0x98)])('%'+_0x4bd77f+'%')},{'phone':(0x0,typeorm_2['Like'])('%'+_0x4bd77f+'%')}]);const [_0x20e93e,_0x1c5367]=await this[_0x2dd511(0x117)][_0x2dd511(0x10c)]({'skip':(page-0x1)*size,'where':_0x2af757,'take':size,'order':{'createdAt':_0x2dd511(0xcd)},'cache':!![],'select':[_0x2dd511(0x110),'avatar',_0x2dd511(0x8d),'sign',_0x2dd511(0xe1),'id',_0x2dd511(0xe8),_0x2dd511(0x123),_0x2dd511(0xb7),'phone',_0x2dd511(0x12d),_0x2dd511(0xf1)]}),_0x2824b2=_0x20e93e[_0x2dd511(0x8c)](_0x5b3542=>_0x5b3542['id']),_0x2d2fa7=await this[_0x2dd511(0x121)]['queryUserBalanceByIds'](_0x2824b2);return _0x20e93e[_0x2dd511(0x8e)](_0x3e227=>_0x3e227[_0x2dd511(0x116)]=_0x2d2fa7[_0x2dd511(0xbd)](_0x503b63=>_0x503b63[_0x2dd511(0xb1)]===_0x3e227['id'])),_0x5e5371[_0x2dd511(0xc3)]['role']!==_0x2dd511(0x9a)&&_0x20e93e['forEach'](_0x540f01=>_0x540f01['email']=(0x0,utils_1[_0x2dd511(0xd9)])(_0x540f01[_0x2dd511(0xe8)])),_0x5e5371['user'][_0x2dd511(0x8d)]!=='super'&&_0x20e93e['forEach'](_0x162062=>_0x162062[_0x2dd511(0xb7)]=(0x0,utils_1['maskIpAddress'])(_0x162062[_0x2dd511(0xb7)])),_0x5e5371[_0x2dd511(0xc3)]['role']!==_0x2dd511(0x9a)&&_0x20e93e['forEach'](_0x38ea10=>_0x38ea10[_0x2dd511(0x120)]=(0x0,utils_1[_0x2dd511(0x78)])(_0x38ea10[_0x2dd511(0x120)])),{'rows':_0x20e93e,'count':_0x1c5367};}async[_0xae7a2(0x80)]({id:_0x4309f5}){const _0x293314=_0xae7a2;return await this['userEntity'][_0x293314(0xfb)]({'where':{'id':_0x4309f5},'select':['username',_0x293314(0x87),'role',_0x293314(0xb0),_0x293314(0xe1)]});}async['updateStatus'](_0x38ed07){const _0x2a3d31=_0xae7a2,{id:_0x5cf126,status:_0x453363}=_0x38ed07,_0x79e69=await this[_0x2a3d31(0x117)][_0x2a3d31(0xfb)]({'where':{'id':_0x5cf126}});if(!_0x79e69)throw new common_1['HttpException'](_0x2a3d31(0x9e),common_1[_0x2a3d31(0xe0)][_0x2a3d31(0x105)]);if(_0x79e69[_0x2a3d31(0x8d)]===_0x2a3d31(0x9a))throw new common_1['HttpException'](_0x2a3d31(0xba),common_1[_0x2a3d31(0xe0)][_0x2a3d31(0x105)]);if(_0x79e69[_0x2a3d31(0x8d)]===_0x2a3d31(0x9a))throw new common_1[(_0x2a3d31(0x112))](_0x2a3d31(0xba),common_1[_0x2a3d31(0xe0)][_0x2a3d31(0x105)]);const _0xe256bd=await this[_0x2a3d31(0x117)]['update']({'id':_0x5cf126},{'status':_0x453363});if(_0xe256bd[_0x2a3d31(0xc6)]<=0x0)throw new common_1['HttpException'](_0x2a3d31(0xd6),common_1['HttpStatus'][_0x2a3d31(0x105)]);return _0x2a3d31(0x128);}async[_0xae7a2(0xab)](_0x586781){const _0x11201b=_0xae7a2,{id:_0x22d141}=_0x586781,_0x8083fd=await this[_0x11201b(0x117)][_0x11201b(0xfb)]({'where':{'id':_0x22d141}});if(!_0x8083fd)throw new common_1[(_0x11201b(0x112))]('用户不存在！',common_1['HttpStatus']['BAD_REQUEST']);const _0x4d412e=_0x11201b(0x8b),_0xeae511=bcrypt[_0x11201b(0x7c)](_0x4d412e,0xa),_0x3fa6a3=await this[_0x11201b(0x117)][_0x11201b(0xc5)]({'id':_0x22d141},{'password':_0xeae511});if(_0x3fa6a3[_0x11201b(0xc6)]<=0x0)throw new common_1[(_0x11201b(0x112))](_0x11201b(0xd0),common_1[_0x11201b(0xe0)][_0x11201b(0x105)]);return _0x11201b(0xc0)+_0x4d412e+_0x11201b(0x92);}async['savaLoginIp'](_0xe48c70,_0x4cccda){const _0xedfcc3=_0xae7a2;return await this[_0xedfcc3(0x117)]['update']({'id':_0xe48c70},{'lastLoginIp':_0x4cccda});}async[_0xae7a2(0x7d)](_0x220303,_0x30f4c7){const _0x5daee6=_0xae7a2,_0x5479d1=await this[_0x5daee6(0x117)][_0x5daee6(0xfb)]({'where':{'openId':_0x220303}});if(!_0x5479d1){const _0xaea080=await this[_0x5daee6(0x7f)](_0x220303);return await this['userBalanceService']['addBalanceToNewUser'](_0xaea080['id']),_0xaea080;}return _0x5479d1;}async[_0xae7a2(0x7f)](_0x558262){const _0x100570=_0xae7a2,_0x2b6438=await this[_0x100570(0xa1)][_0x100570(0x101)]([_0x100570(0x107)]),_0x893ef3={'avatar':_0x2b6438,'username':'用户'+(0x0,utils_1[_0x100570(0x97)])(),'status':user_constant_1[_0x100570(0x12f)][_0x100570(0xd1)],'sex':0x0,'email':(0x0,utils_1[_0x100570(0x97)])()+_0x100570(0xff),'openId':_0x558262},_0x57b490=await this[_0x100570(0x117)]['save'](_0x893ef3);return _0x57b490;}async[_0xae7a2(0x89)](_0x88b7e1){const _0x36243f=_0xae7a2,{username:_0x9b978b,email:_0x1725ef,phone:_0x4dabf9}=_0x88b7e1,_0x2a4b02=await this[_0x36243f(0xa1)][_0x36243f(0x101)](['userDefautlAvatar']),_0x5d9d7d={'avatar':_0x2a4b02,'username':'用户'+(0x0,utils_1[_0x36243f(0x97)])(),'status':user_constant_1[_0x36243f(0x12f)]['ACTIVE'],'sex':0x0};_0x9b978b&&(_0x5d9d7d[_0x36243f(0x110)]=_0x9b978b);_0x1725ef&&(_0x5d9d7d[_0x36243f(0xe8)]=_0x1725ef);_0x4dabf9&&(_0x5d9d7d['phone']=_0x4dabf9);const _0x50154b=await this[_0x36243f(0x117)]['save'](_0x5d9d7d);return _0x50154b;}async[_0xae7a2(0xaa)](_0x5ebf15){const _0x81b451=_0xae7a2,{username:_0x428fbe,email:_0x280e04,phone:_0x428d43}=_0x5ebf15,_0x1e75cc=[];return _0x428fbe&&_0x1e75cc[_0x81b451(0xa6)]({'username':_0x428fbe}),_0x280e04&&_0x1e75cc[_0x81b451(0xa6)]({'email':_0x280e04}),_0x428d43&&_0x1e75cc[_0x81b451(0xa6)]({'phone':_0x428d43}),await this[_0x81b451(0x117)][_0x81b451(0xfb)]({'where':_0x1e75cc});}async[_0xae7a2(0x94)](_0x2d9c1b,_0x557966){const _0x5ac399=_0xae7a2;try{const _0x198529=await this[_0x5ac399(0x117)][_0x5ac399(0xfb)]({'where':{'id':_0x557966}});if(!_0x198529)return{'status':![],'msg':'当前绑定用户不存在！'};const _0x3babf5=await this[_0x5ac399(0x117)]['findOne']({'where':{'openId':_0x2d9c1b}});if(_0x3babf5)return{'status':![],'msg':_0x5ac399(0xfc)};const _0x24279c=await this[_0x5ac399(0x117)][_0x5ac399(0xc5)]({'id':_0x557966},{'openId':_0x2d9c1b});if(_0x24279c[_0x5ac399(0xc6)]<=0x0)return{'status':![],'msg':_0x5ac399(0x10b)};return{'status':!![],'msg':_0x5ac399(0x114)};}catch(_0x583706){return{'status':![],'msg':_0x5ac399(0x10b)};}}async[_0xae7a2(0x96)](_0xa4210d){const _0x16d5a6=_0xae7a2,_0x58293a=await this['userEntity'][_0x16d5a6(0xfb)]({'where':{'id':_0xa4210d}});return _0x58293a===null||_0x58293a===void 0x0?void 0x0:_0x58293a['openId'];}async[_0xae7a2(0x95)](_0x35d56f){const _0x27d08a=_0xae7a2,{username:_0x439a7d,phone:_0x4dabb9,email:_0x5c89f3}=_0x35d56f;if(_0x4dabb9){const _0x4f7e10=await this[_0x27d08a(0x117)][_0x27d08a(0xfb)]({'where':{'phone':_0x4dabb9}});if(_0x4f7e10)return![];}if(_0x5c89f3){const _0x2752f4=await this[_0x27d08a(0x117)][_0x27d08a(0xfb)]({'where':{'email':_0x5c89f3}});if(_0x2752f4)return![];}if(_0x439a7d){const _0x2e4d3c=await this[_0x27d08a(0x117)][_0x27d08a(0xfb)]({'where':{'username':_0x439a7d}});if(_0x2e4d3c)return![];}if(!_0x4dabb9&&!_0x5c89f3&&!_0x439a7d)return![];return!![];}async[_0xae7a2(0xd3)](_0x502ec5){const _0x37310b=_0xae7a2,{username:_0x52c40e,password:_0xc3ffd2,phone:_0x483977,phoneCode:_0x526715}=_0x502ec5,_0x54b019=await this[_0x37310b(0x117)][_0x37310b(0xfb)]({'where':[{'username':_0x52c40e},{'phone':_0x483977}]});if(_0x54b019&&_0x54b019[_0x37310b(0x110)]===_0x52c40e)throw new common_1[(_0x37310b(0x112))](_0x37310b(0x10f),common_1[_0x37310b(0xe0)]['BAD_REQUEST']);if(_0x54b019&&_0x54b019['phone']===_0x483977)throw new common_1[(_0x37310b(0x112))](_0x37310b(0x108),common_1[_0x37310b(0xe0)][_0x37310b(0x105)]);}async[_0xae7a2(0xbb)](_0x119235){const _0x53ca3c=_0xae7a2,{username:_0x25fd2c,email:_0x105c8f}=_0x119235;console[_0x53ca3c(0x127)](_0x53ca3c(0x118)+_0x25fd2c+_0x53ca3c(0x9b)+_0x105c8f);const _0x4b6184=await this[_0x53ca3c(0x117)][_0x53ca3c(0xfb)]({'where':[{'username':_0x25fd2c},{'email':_0x105c8f}]});if(_0x4b6184&&_0x4b6184['username']===_0x25fd2c){console[_0x53ca3c(0xe9)](_0x53ca3c(0x99)+_0x25fd2c+_0x53ca3c(0x7a));throw new common_1[(_0x53ca3c(0x112))](_0x53ca3c(0x10f),common_1[_0x53ca3c(0xe0)][_0x53ca3c(0x105)]);}if(_0x4b6184&&_0x4b6184[_0x53ca3c(0xe8)]===_0x105c8f){console[_0x53ca3c(0xe9)](_0x53ca3c(0xcb)+_0x105c8f+_0x53ca3c(0x11f));throw new common_1['HttpException'](_0x53ca3c(0xb4),common_1[_0x53ca3c(0xe0)][_0x53ca3c(0x105)]);}console['log'](_0x53ca3c(0xa4)+_0x25fd2c+_0x53ca3c(0x9b)+_0x105c8f+_0x53ca3c(0xbc));}async[_0xae7a2(0x122)](_0xfb6c62){const _0x1071ab=_0xae7a2;return await this[_0x1071ab(0x117)][_0x1071ab(0x9d)](_0xfb6c62);}async[_0xae7a2(0xa2)](_0x523d16,_0x412db3,_0x4533ea){const _0x2bd844=_0xae7a2,_0x25f472=await this[_0x2bd844(0x117)]['findOne']({'where':{'id':_0x523d16}});!_0x25f472&&common_1[_0x2bd844(0x130)][_0x2bd844(0xe9)](_0x2bd844(0x11e));await this[_0x2bd844(0x117)]['update']({'id':_0x523d16},{'realName':_0x412db3,'idCard':_0x4533ea});return;}async['updateUserPhone'](_0x36c881,_0x4a1f40,_0x1fca1e,_0x333edf){const _0x4269fd=_0xae7a2,_0x464bee=await this[_0x4269fd(0x117)][_0x4269fd(0xfb)]({'where':{'id':_0x36c881}}),_0x2a139e=bcrypt[_0x4269fd(0x7c)](_0x333edf,0xa);!_0x464bee&&common_1['Logger'][_0x4269fd(0xe9)](_0x4269fd(0x11e));if(!_0x4a1f40||!_0x1fca1e||!_0x2a139e)throw new common_1['HttpException']('参数错误！',common_1[_0x4269fd(0xe0)][_0x4269fd(0x105)]);await this[_0x4269fd(0x117)][_0x4269fd(0xc5)]({'id':_0x36c881},{'phone':_0x4a1f40,'username':_0x1fca1e,'password':_0x2a139e});return;}};UserService=__decorate([(0x0,common_1[_0xae7a2(0x10e)])(),__param(0x0,(0x0,typeorm_1[_0xae7a2(0xac)])(user_entity_1[_0xae7a2(0xcc)])),__param(0x6,(0x0,typeorm_1[_0xae7a2(0xac)])(config_entity_1[_0xae7a2(0x125)])),__metadata(_0xae7a2(0xfd),[typeorm_2[_0xae7a2(0xa9)],typeorm_2[_0xae7a2(0xfa)],verification_service_1['VerificationService'],mailer_service_1['MailerService'],userBalance_service_1[_0xae7a2(0xf3)],globalConfig_service_1['GlobalConfigService'],typeorm_2['Repository']])],UserService),exports[_0xae7a2(0xb6)]=UserService;