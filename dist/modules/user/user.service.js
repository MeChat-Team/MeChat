'use strict';const _0x1da16a=_0x15dd;(function(_0x5ce948,_0x2ef411){const _0x2d624a=_0x15dd,_0x3a778e=_0x5ce948();while(!![]){try{const _0x2c77cd=parseInt(_0x2d624a(0x168))/0x1*(-parseInt(_0x2d624a(0x133))/0x2)+parseInt(_0x2d624a(0x12a))/0x3*(parseInt(_0x2d624a(0x175))/0x4)+parseInt(_0x2d624a(0x156))/0x5+-parseInt(_0x2d624a(0x113))/0x6*(parseInt(_0x2d624a(0x152))/0x7)+parseInt(_0x2d624a(0x134))/0x8*(parseInt(_0x2d624a(0x14c))/0x9)+-parseInt(_0x2d624a(0x11f))/0xa*(-parseInt(_0x2d624a(0x153))/0xb)+parseInt(_0x2d624a(0x151))/0xc*(-parseInt(_0x2d624a(0x15e))/0xd);if(_0x2c77cd===_0x2ef411)break;else _0x3a778e['push'](_0x3a778e['shift']());}catch(_0x165de8){_0x3a778e['push'](_0x3a778e['shift']());}}}(_0xfada,0x83fe2));function _0x15dd(_0x55e9dd,_0x25659a){const _0xfada3e=_0xfada();return _0x15dd=function(_0x15dd3d,_0x24c26e){_0x15dd3d=_0x15dd3d-0xe7;let _0x53b011=_0xfada3e[_0x15dd3d];return _0x53b011;},_0x15dd(_0x55e9dd,_0x25659a);}var __decorate=this&&this[_0x1da16a(0xf9)]||function(_0x37605d,_0x545a7e,_0x4aa3e3,_0x5c2d07){const _0x2a1ba7=_0x1da16a;var _0x261147=arguments['length'],_0x2af904=_0x261147<0x3?_0x545a7e:_0x5c2d07===null?_0x5c2d07=Object['getOwnPropertyDescriptor'](_0x545a7e,_0x4aa3e3):_0x5c2d07,_0x7b969e;if(typeof Reflect===_0x2a1ba7(0xf4)&&typeof Reflect[_0x2a1ba7(0x154)]==='function')_0x2af904=Reflect[_0x2a1ba7(0x154)](_0x37605d,_0x545a7e,_0x4aa3e3,_0x5c2d07);else{for(var _0x25a0ba=_0x37605d[_0x2a1ba7(0x107)]-0x1;_0x25a0ba>=0x0;_0x25a0ba--)if(_0x7b969e=_0x37605d[_0x25a0ba])_0x2af904=(_0x261147<0x3?_0x7b969e(_0x2af904):_0x261147>0x3?_0x7b969e(_0x545a7e,_0x4aa3e3,_0x2af904):_0x7b969e(_0x545a7e,_0x4aa3e3))||_0x2af904;}return _0x261147>0x3&&_0x2af904&&Object[_0x2a1ba7(0x143)](_0x545a7e,_0x4aa3e3,_0x2af904),_0x2af904;},__metadata=this&&this[_0x1da16a(0x149)]||function(_0x207543,_0x628d0f){const _0x5d3d27=_0x1da16a;if(typeof Reflect==='object'&&typeof Reflect[_0x5d3d27(0x18d)]===_0x5d3d27(0x17e))return Reflect[_0x5d3d27(0x18d)](_0x207543,_0x628d0f);},__param=this&&this[_0x1da16a(0x121)]||function(_0x21a2ec,_0x1db54f){return function(_0x81754f,_0xbcbaf7){_0x1db54f(_0x81754f,_0xbcbaf7,_0x21a2ec);};};Object[_0x1da16a(0x143)](exports,_0x1da16a(0x18a),{'value':!![]}),exports[_0x1da16a(0x144)]=void 0x0;const balance_constant_1=require(_0x1da16a(0xea)),verification_constant_1=require('../../common/constants/verification.constant'),utils_1=require('../../common/utils'),mailer_service_1=require(_0x1da16a(0x16b)),common_1=require(_0x1da16a(0xed)),typeorm_1=require(_0x1da16a(0x161)),bcrypt=require(_0x1da16a(0x116)),_=require(_0x1da16a(0xeb)),typeorm_2=require(_0x1da16a(0x10b)),config_entity_1=require(_0x1da16a(0x14f)),userBalance_service_1=require(_0x1da16a(0x184)),user_constant_1=require('./../../common/constants/user.constant'),globalConfig_service_1=require(_0x1da16a(0x18c)),verification_service_1=require(_0x1da16a(0x180)),user_entity_1=require(_0x1da16a(0x185));let UserService=class UserService{constructor(_0xd66735,_0x51fc7e,_0x514017,_0x186da8,_0x3d7695,_0x275790,_0x3d8e67){const _0x3761b8=_0x1da16a;this['userEntity']=_0xd66735,this['connection']=_0x51fc7e,this['verificationService']=_0x514017,this['mailerService']=_0x186da8,this['userBalanceService']=_0x3d7695,this[_0x3761b8(0xec)]=_0x275790,this['configEntity']=_0x3d8e67;}async['createUserAndVerifycation'](_0x53b6c4,_0x4d55ec){const _0x4fcd9e=_0x1da16a,{username:_0x378fa8,email:_0x42229f,password:_0x42cae5,client:client=0x0}=_0x53b6c4,_0x588b2d=[{'username':_0x378fa8},{'email':_0x42229f}],_0x39762c=await this[_0x4fcd9e(0xe9)]['findOne']({'where':_0x588b2d});if(_0x39762c&&_0x39762c['status']!==user_constant_1[_0x4fcd9e(0x15a)]['PENDING'])throw new common_1[(_0x4fcd9e(0x178))](_0x4fcd9e(0x142),common_1['HttpStatus'][_0x4fcd9e(0x164)]);try{const _0x3193b8=_[_0x4fcd9e(0x147)](_0x53b6c4),_0x16973a=bcrypt['hashSync'](_0x42cae5,0xa),_0x3a194a=(0x0,utils_1['getClientIp'])(_0x4d55ec);_0x3193b8[_0x4fcd9e(0x110)]=_0x16973a,_0x3193b8['registerIp']=_0x3a194a,_0x3193b8[_0x4fcd9e(0x108)]=client;let _0x234777;if(!_0x39762c){const _0x22d382=await this[_0x4fcd9e(0xec)]['getConfigs']([_0x4fcd9e(0x157)]);_0x3193b8['avatar']=_0x22d382,_0x234777=await this[_0x4fcd9e(0xe9)][_0x4fcd9e(0x16a)](_0x3193b8);}else _0x234777=_0x39762c;const _0x2dfb17=await this[_0x4fcd9e(0x118)][_0x4fcd9e(0xe7)]({'where':{'configKey':(0x0,typeorm_2['In'])([_0x4fcd9e(0x14d),_0x4fcd9e(0x188),_0x4fcd9e(0x15b),_0x4fcd9e(0x10c),_0x4fcd9e(0x103),_0x4fcd9e(0x115)])}}),_0x50d879=_0x2dfb17[_0x4fcd9e(0x174)]((_0x1def48,_0x19094c)=>{const _0x391eaa=_0x4fcd9e;return _0x1def48[_0x19094c[_0x391eaa(0x12f)]]=_0x19094c[_0x391eaa(0x148)],_0x1def48;},{}),_0x51b59c=_0x50d879[_0x4fcd9e(0x14d)]?Number(_0x50d879[_0x4fcd9e(0x14d)]):0x1;if(_0x51b59c){const _0x1146db=_0x50d879[_0x4fcd9e(0x115)]?Number(_0x50d879[_0x4fcd9e(0x115)]):0x1e*0x3c,_0x245fb9=await this[_0x4fcd9e(0x13a)]['createVerification'](_0x234777,verification_constant_1['VerificationEnum'][_0x4fcd9e(0x13c)],_0x1146db),{code:_0x12efa0,email:_0x3c4474,id:_0x5a1f0c}=_0x245fb9,{registerVerifyEmailFrom:_0x348985}=_0x50d879;console[_0x4fcd9e(0x138)](_0x4fcd9e(0x139),_0x50d879),console[_0x4fcd9e(0x138)]('尝试发送邮件到:\x20'+_0x3c4474);}else{const {id:_0x2293e2}=_0x234777;await this[_0x4fcd9e(0x14a)](_0x2293e2,user_constant_1[_0x4fcd9e(0x15a)]['ACTIVE']),await this[_0x4fcd9e(0x131)][_0x4fcd9e(0x17f)](_0x2293e2);}return _0x234777;}catch(_0x1eb564){console[_0x4fcd9e(0x138)](_0x4fcd9e(0x111),_0x1eb564);throw _0x1eb564;}}async[_0x1da16a(0x10f)](){const _0x3596ec=_0x1da16a,_0x2f2e1a=await this[_0x3596ec(0xe9)][_0x3596ec(0x13b)]({'where':{'role':_0x3596ec(0x119)}});return _0x2f2e1a;}async['verifyUserCredentials'](_0x16286d){const _0x5bacb9=_0x1da16a,{username:_0x378f97,password:_0x151f54,uid:uid=0x0,phone:_0x5726a}=_0x16286d;let _0x17ce0d=null;if(uid>0x0){_0x17ce0d=await this[_0x5bacb9(0xe9)][_0x5bacb9(0x13b)]({'where':{'id':uid}});if(!_0x17ce0d)throw new common_1[(_0x5bacb9(0x178))](_0x5bacb9(0x136),common_1['HttpStatus']['BAD_REQUEST']);if(!bcrypt[_0x5bacb9(0x150)](_0x151f54,_0x17ce0d[_0x5bacb9(0x110)]))throw new common_1[(_0x5bacb9(0x178))](_0x5bacb9(0x140),common_1[_0x5bacb9(0x160)][_0x5bacb9(0x164)]);}if(_0x378f97&&_0x151f54){const _0x36203a=[{'username':_0x378f97},{'email':_0x378f97},{'phone':_0x378f97}];_0x17ce0d=await this[_0x5bacb9(0xe9)][_0x5bacb9(0x13b)]({'where':_0x36203a});if(!_0x17ce0d)throw new common_1[(_0x5bacb9(0x178))]('当前账户不存在！',common_1[_0x5bacb9(0x160)][_0x5bacb9(0x164)]);if(!bcrypt[_0x5bacb9(0x150)](_0x151f54,_0x17ce0d[_0x5bacb9(0x110)]))throw new common_1[(_0x5bacb9(0x178))](_0x5bacb9(0x140),common_1[_0x5bacb9(0x160)][_0x5bacb9(0x164)]);}if(!_0x17ce0d)throw new common_1[(_0x5bacb9(0x178))](_0x5bacb9(0x136),common_1[_0x5bacb9(0x160)][_0x5bacb9(0x164)]);if(_0x17ce0d['status']!==user_constant_1[_0x5bacb9(0x15a)][_0x5bacb9(0xfe)])throw new common_1[(_0x5bacb9(0x178))](user_constant_1['UserStatusErrMsg'][_0x17ce0d['status']],common_1[_0x5bacb9(0x160)][_0x5bacb9(0x164)]);return _0x17ce0d;}async[_0x1da16a(0x182)](_0x47cc8f,_0x43d4a0){const _0x47884c=_0x1da16a,_0x1b8172=await this[_0x47884c(0xe9)]['findOne']({'where':{'id':_0x47cc8f}});return bcrypt['compareSync'](_0x43d4a0,_0x1b8172[_0x47884c(0x110)]);}async['updateUserStatus'](_0x1001aa,_0x478538){const _0x253e8d=_0x1da16a,_0x1c1c51=await this['userEntity'][_0x253e8d(0x104)]({'id':_0x1001aa},{'status':_0x478538});return _0x1c1c51[_0x253e8d(0xf3)]>0x0;}async['getUserStatus'](_0x4ac882){const _0x604b9f=_0x1da16a,_0x108370=await this['userEntity'][_0x604b9f(0x13b)]({'where':{'id':_0x4ac882}});return _0x108370[_0x604b9f(0x158)];}async[_0x1da16a(0x126)](_0x493920){const _0x277a0e=_0x1da16a;return await this[_0x277a0e(0xe9)][_0x277a0e(0x13b)]({'where':{'id':_0x493920}});}async['queryOneUserInfo'](_0x1af96f){const _0x54ff3c=_0x1da16a;return await this[_0x54ff3c(0xe9)]['findOne']({'where':{'id':_0x1af96f}});}async[_0x1da16a(0x162)](_0x6bf961){const _0x1acf4f=_0x1da16a,{id:_0x351c8a,role:_0x531e53}=_0x6bf961;if(_0x531e53===_0x1acf4f(0x172))return!![];const _0x87a84c=await this[_0x1acf4f(0xe9)][_0x1acf4f(0x13b)]({'where':{'id':_0x351c8a}});if(!_0x87a84c)throw new common_1[(_0x1acf4f(0x178))](_0x1acf4f(0x17c),common_1[_0x1acf4f(0x160)][_0x1acf4f(0x15d)]);if(_0x87a84c['status']===user_constant_1[_0x1acf4f(0x15a)]['BLACKLISTED'])throw new common_1[(_0x1acf4f(0x178))](_0x1acf4f(0x11a),common_1[_0x1acf4f(0x160)][_0x1acf4f(0x164)]);if(_0x87a84c[_0x1acf4f(0x158)]===user_constant_1[_0x1acf4f(0x15a)]['LOCKED'])throw new common_1[(_0x1acf4f(0x178))](_0x1acf4f(0x123),common_1[_0x1acf4f(0x160)]['BAD_REQUEST']);}async['getUserInfo'](_0x247e07){const _0x5ec73b=_0x1da16a,_0x38386c=await this[_0x5ec73b(0xe9)]['findOne']({'where':{'id':_0x247e07},'select':['username','avatar',_0x5ec73b(0x135),'email',_0x5ec73b(0x12e),_0x5ec73b(0x16d),_0x5ec73b(0x16e)]});if(!_0x38386c)throw new common_1[(_0x5ec73b(0x178))]('当前用户信息失效、请重新登录！',common_1[_0x5ec73b(0x160)][_0x5ec73b(0x15d)]);_0x38386c['isBindWx']=!!(_0x38386c===null||_0x38386c===void 0x0?void 0x0:_0x38386c['openId']),delete _0x38386c[_0x5ec73b(0x16d)];const _0x386210=await this[_0x5ec73b(0x131)][_0x5ec73b(0x102)](_0x247e07),_0x49b0cd=(_0x247e07*0x7b+0x5f5e100)[_0x5ec73b(0x11c)](0x24)['toUpperCase']()[_0x5ec73b(0x132)](-0x6);return _0x38386c['id']=_0x49b0cd,{'userInfo':_0x38386c,'userBalance':Object[_0x5ec73b(0x12b)]({},_0x386210)};}async['getUserById'](_0x5b47b5){const _0x212c56=_0x1da16a;return await this[_0x212c56(0xe9)]['findOne']({'where':{'id':_0x5b47b5}});}async['getUserOpenId'](_0x5bdd0d){return await this['userEntity']['findOne']({'where':{'openId':_0x5bdd0d}});}async['updateInfo'](_0x21c07d,_0x3cdc35){const _0x2400c8=_0x1da16a,{id:_0x541829}=_0x3cdc35['user'],_0x3329ed=await this[_0x2400c8(0xe9)][_0x2400c8(0x13b)]({'where':{'id':_0x541829}});if(!_0x3329ed)throw new common_1['HttpException'](_0x2400c8(0xf0),common_1['HttpStatus']['BAD_REQUEST']);if(_0x21c07d[_0x2400c8(0x177)]&&_0x3329ed['username']===_0x21c07d[_0x2400c8(0x177)])throw new common_1[(_0x2400c8(0x178))]('没有变更，无需更改！',common_1[_0x2400c8(0x160)][_0x2400c8(0x164)]);if(_0x21c07d[_0x2400c8(0x177)]){const _0x2ff2eb=await this[_0x2400c8(0x165)](_0x21c07d[_0x2400c8(0x177)],_0x541829);if(_0x2ff2eb)throw new common_1[(_0x2400c8(0x178))](_0x2400c8(0x166),common_1[_0x2400c8(0x160)][_0x2400c8(0x164)]);}const _0x97bf76=await this[_0x2400c8(0xe9)][_0x2400c8(0x104)]({'id':_0x541829},_0x21c07d);if(_0x97bf76[_0x2400c8(0xf3)]<=0x0)throw new common_1[(_0x2400c8(0x178))](_0x2400c8(0x106),common_1['HttpStatus']['BAD_REQUEST']);return'修改用户信息成功！';}async[_0x1da16a(0x165)](_0x45ff6e,_0x1dd4d8){const _0x526d9d=_0x1da16a,_0x6d5748={'username':_0x45ff6e};_0x1dd4d8&&(_0x6d5748['id']=(0x0,typeorm_2[_0x526d9d(0x13d)])(_0x1dd4d8));const _0x546e08=await this[_0x526d9d(0xe9)][_0x526d9d(0x13b)]({'where':_0x6d5748});return!!_0x546e08;}async[_0x1da16a(0x137)](_0x56b0b1,_0x50f0dd){const _0x30647c=_0x1da16a,_0x2b72d1=bcrypt[_0x30647c(0x10a)](_0x50f0dd,0xa),_0x235dea=await this[_0x30647c(0xe9)][_0x30647c(0x104)]({'id':_0x56b0b1},{'password':_0x2b72d1});if(_0x235dea[_0x30647c(0xf3)]<=0x0)throw new common_1[(_0x30647c(0x178))]('修改密码失败、请重新试试吧。',common_1[_0x30647c(0x160)][_0x30647c(0x164)]);}async[_0x1da16a(0xf1)](_0x5b6fa1){const _0x5a5f59=_0x1da16a,{userId:_0x5acef1,model3Count:model3Count=0x0,model4Count:model4Count=0x0,drawMjCount:drawMjCount=0x0}=_0x5b6fa1;await this[_0x5a5f59(0x131)][_0x5a5f59(0x13f)](_0x5acef1,{'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount});const _0x19b720=await this['userBalanceService'][_0x5a5f59(0x100)]({'userId':_0x5acef1,'rechargeType':balance_constant_1['RechargeType']['ADMIN_GIFT'],'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount,'extent':''});return _0x19b720;}async[_0x1da16a(0x163)](_0x2e4dd1,_0x3a0ccd){const _0x14c63e=_0x1da16a,{page:page=0x1,size:size=0xa,username:_0x440db5,email:_0xe972d9,status:_0x2736fd,keyword:_0x633f51,phone:_0x3b9690}=_0x2e4dd1;let _0x55b82e={};_0x440db5&&Object['assign'](_0x55b82e,{'username':(0x0,typeorm_2[_0x14c63e(0x16c)])('%'+_0x440db5+'%')}),_0xe972d9&&Object[_0x14c63e(0x12b)](_0x55b82e,{'email':(0x0,typeorm_2[_0x14c63e(0x16c)])('%'+_0xe972d9+'%')}),_0x3b9690&&Object[_0x14c63e(0x12b)](_0x55b82e,{'phone':(0x0,typeorm_2['Like'])('%'+_0x3b9690+'%')}),_0x2736fd&&Object['assign'](_0x55b82e,{'status':_0x2736fd});_0x633f51&&(_0x55b82e=[{'username':(0x0,typeorm_2['Like'])('%'+_0x633f51+'%')},{'email':(0x0,typeorm_2['Like'])('%'+_0x633f51+'%')},{'phone':(0x0,typeorm_2[_0x14c63e(0x16c)])('%'+_0x633f51+'%')}]);const [_0x51cd8c,_0x2734cb]=await this['userEntity'][_0x14c63e(0xef)]({'skip':(page-0x1)*size,'where':_0x55b82e,'take':size,'order':{'createdAt':_0x14c63e(0x124)},'cache':!![],'select':['username',_0x14c63e(0x183),'role',_0x14c63e(0x12e),_0x14c63e(0x158),'id','email',_0x14c63e(0x13e),'lastLoginIp',_0x14c63e(0x10d),'realName',_0x14c63e(0xfc)]}),_0x52d353=_0x51cd8c[_0x14c63e(0x128)](_0x5df446=>_0x5df446['id']),_0x5ca157=await this['userBalanceService'][_0x14c63e(0x17d)](_0x52d353);return _0x51cd8c['forEach'](_0x4b781a=>_0x4b781a['balanceInfo']=_0x5ca157[_0x14c63e(0xe7)](_0x3bb36f=>_0x3bb36f[_0x14c63e(0xf2)]===_0x4b781a['id'])),_0x3a0ccd['user'][_0x14c63e(0x135)]!==_0x14c63e(0x119)&&_0x51cd8c[_0x14c63e(0x127)](_0x297722=>_0x297722[_0x14c63e(0x176)]=(0x0,utils_1[_0x14c63e(0x11e)])(_0x297722[_0x14c63e(0x176)])),_0x3a0ccd[_0x14c63e(0x11d)][_0x14c63e(0x135)]!=='super'&&_0x51cd8c['forEach'](_0x30fa97=>_0x30fa97[_0x14c63e(0x14b)]=(0x0,utils_1[_0x14c63e(0x179)])(_0x30fa97[_0x14c63e(0x14b)])),_0x3a0ccd['user']['role']!==_0x14c63e(0x119)&&_0x51cd8c['forEach'](_0x3539a1=>_0x3539a1[_0x14c63e(0x10d)]=(0x0,utils_1['maskIpAddress'])(_0x3539a1[_0x14c63e(0x10d)])),{'rows':_0x51cd8c,'count':_0x2734cb};}async[_0x1da16a(0xfb)]({id:_0x94ba0f}){const _0x499485=_0x1da16a;return await this[_0x499485(0xe9)][_0x499485(0x13b)]({'where':{'id':_0x94ba0f},'select':[_0x499485(0x177),_0x499485(0x183),_0x499485(0x135),_0x499485(0x12e),_0x499485(0x158)]});}async[_0x1da16a(0x173)](_0x13d2c6){const _0x23c419=_0x1da16a,{id:_0xda0050,status:_0x20ebd8}=_0x13d2c6,_0x15fe50=await this[_0x23c419(0xe9)][_0x23c419(0x13b)]({'where':{'id':_0xda0050}});if(!_0x15fe50)throw new common_1[(_0x23c419(0x178))]('用户不存在！',common_1['HttpStatus'][_0x23c419(0x164)]);if(_0x15fe50[_0x23c419(0x135)]===_0x23c419(0x119))throw new common_1[(_0x23c419(0x178))](_0x23c419(0x141),common_1['HttpStatus']['BAD_REQUEST']);if(_0x15fe50[_0x23c419(0x135)]===_0x23c419(0x119))throw new common_1[(_0x23c419(0x178))]('超级管理员不可被操作！',common_1[_0x23c419(0x160)][_0x23c419(0x164)]);const _0x80f5cd=await this[_0x23c419(0xe9)][_0x23c419(0x104)]({'id':_0xda0050},{'status':_0x20ebd8});if(_0x80f5cd[_0x23c419(0xf3)]<=0x0)throw new common_1[(_0x23c419(0x178))](_0x23c419(0x145),common_1[_0x23c419(0x160)]['BAD_REQUEST']);return'修改用户状态成功！';}async[_0x1da16a(0x16f)](_0x24fab4){const _0x1c137a=_0x1da16a,{id:_0x28d33c}=_0x24fab4,_0xf9e85f=await this[_0x1c137a(0xe9)]['findOne']({'where':{'id':_0x28d33c}});if(!_0xf9e85f)throw new common_1[(_0x1c137a(0x178))](_0x1c137a(0x120),common_1[_0x1c137a(0x160)][_0x1c137a(0x164)]);const _0x461122='123456',_0x586822=bcrypt[_0x1c137a(0x10a)](_0x461122,0xa),_0x13d18c=await this[_0x1c137a(0xe9)][_0x1c137a(0x104)]({'id':_0x28d33c},{'password':_0x586822});if(_0x13d18c[_0x1c137a(0xf3)]<=0x0)throw new common_1[(_0x1c137a(0x178))](_0x1c137a(0xee),common_1[_0x1c137a(0x160)]['BAD_REQUEST']);return _0x1c137a(0xf7)+_0x461122+_0x1c137a(0x14e);}async['savaLoginIp'](_0x215420,_0x1cf1ac){const _0x33fade=_0x1da16a;return await this[_0x33fade(0xe9)][_0x33fade(0x104)]({'id':_0x215420},{'lastLoginIp':_0x1cf1ac});}async['getUserFromOpenId'](_0x13d9b0,_0xc1a9b3){const _0x3bc626=_0x1da16a,_0x48381a=await this[_0x3bc626(0xe9)][_0x3bc626(0x13b)]({'where':{'openId':_0x13d9b0}});if(!_0x48381a){const _0x35f21e=await this[_0x3bc626(0x112)](_0x13d9b0);return await this[_0x3bc626(0x131)][_0x3bc626(0x17f)](_0x35f21e['id']),_0x35f21e;}return _0x48381a;}async[_0x1da16a(0x112)](_0x3cec09){const _0x291b14=_0x1da16a,_0xdac7c5=await this[_0x291b14(0xec)][_0x291b14(0x122)]([_0x291b14(0x157)]),_0x5f0358={'avatar':_0xdac7c5,'username':'用户'+(0x0,utils_1[_0x291b14(0x15f)])(),'status':user_constant_1[_0x291b14(0x15a)][_0x291b14(0xfe)],'sex':0x0,'email':(0x0,utils_1[_0x291b14(0x15f)])()+'@default.com','openId':_0x3cec09},_0x2ce8a8=await this[_0x291b14(0xe9)][_0x291b14(0x16a)](_0x5f0358);return _0x2ce8a8;}async[_0x1da16a(0xf6)](_0x378d46){const _0x1223a8=_0x1da16a,{username:_0x47de3d,email:_0x2709fc,phone:_0x4dca90}=_0x378d46,_0x3ea85b=await this[_0x1223a8(0xec)][_0x1223a8(0x122)](['userDefautlAvatar']),_0x25f7cc={'avatar':_0x3ea85b,'username':'用户'+(0x0,utils_1[_0x1223a8(0x15f)])(),'status':user_constant_1[_0x1223a8(0x15a)]['ACTIVE'],'sex':0x0};_0x47de3d&&(_0x25f7cc[_0x1223a8(0x177)]=_0x47de3d);_0x2709fc&&(_0x25f7cc[_0x1223a8(0x176)]=_0x2709fc);_0x4dca90&&(_0x25f7cc[_0x1223a8(0x10d)]=_0x4dca90);const _0x281b3c=await this[_0x1223a8(0xe9)][_0x1223a8(0x16a)](_0x25f7cc);return _0x281b3c;}async[_0x1da16a(0x101)](_0x55db45){const _0x261e1e=_0x1da16a,{username:_0x99eb48,email:_0x47a874,phone:_0x3ac91c}=_0x55db45,_0x299b7a=[];return _0x99eb48&&_0x299b7a[_0x261e1e(0x146)]({'username':_0x99eb48}),_0x47a874&&_0x299b7a[_0x261e1e(0x146)]({'email':_0x47a874}),_0x3ac91c&&_0x299b7a[_0x261e1e(0x146)]({'phone':_0x3ac91c}),await this[_0x261e1e(0xe9)][_0x261e1e(0x13b)]({'where':_0x299b7a});}async[_0x1da16a(0x155)](_0x42c1b8,_0x11d7ce){const _0x1edc42=_0x1da16a;try{const _0x59a0d6=await this[_0x1edc42(0xe9)][_0x1edc42(0x13b)]({'where':{'id':_0x11d7ce}});if(!_0x59a0d6)return{'status':![],'msg':_0x1edc42(0x114)};const _0x1850b2=await this[_0x1edc42(0xe9)][_0x1edc42(0x13b)]({'where':{'openId':_0x42c1b8}});if(_0x1850b2)return{'status':![],'msg':_0x1edc42(0xfd)};const _0x350e79=await this['userEntity'][_0x1edc42(0x104)]({'id':_0x11d7ce},{'openId':_0x42c1b8});if(_0x350e79['affected']<=0x0)return{'status':![],'msg':_0x1edc42(0x181)};return{'status':!![],'msg':_0x1edc42(0x18b)};}catch(_0x1d3c65){return{'status':![],'msg':_0x1edc42(0x181)};}}async[_0x1da16a(0xfa)](_0x4bb360){const _0x5d52a0=_0x1da16a,_0x3c6b81=await this[_0x5d52a0(0xe9)][_0x5d52a0(0x13b)]({'where':{'id':_0x4bb360}});return _0x3c6b81===null||_0x3c6b81===void 0x0?void 0x0:_0x3c6b81[_0x5d52a0(0x16d)];}async[_0x1da16a(0xf8)](_0x7695c){const _0x8f4bca=_0x1da16a,{username:_0x47bf8a,phone:_0x57c585,email:_0x5ac604}=_0x7695c;if(_0x57c585){const _0x3332a9=await this[_0x8f4bca(0xe9)]['findOne']({'where':{'phone':_0x57c585}});if(_0x3332a9)return![];}if(_0x5ac604){const _0x52e64d=await this[_0x8f4bca(0xe9)][_0x8f4bca(0x13b)]({'where':{'email':_0x5ac604}});if(_0x52e64d)return![];}if(_0x47bf8a){const _0xf4c506=await this[_0x8f4bca(0xe9)]['findOne']({'where':{'username':_0x47bf8a}});if(_0xf4c506)return![];}if(!_0x57c585&&!_0x5ac604&&!_0x47bf8a)return![];return!![];}async['verifyUserRegisterByPhone'](_0x3836af){const _0x1d4342=_0x1da16a,{username:_0x4d2fe0,password:_0x84aa6a,phone:_0x5f2729,phoneCode:_0x9b97d6}=_0x3836af,_0x23eb4b=await this[_0x1d4342(0xe9)][_0x1d4342(0x13b)]({'where':[{'username':_0x4d2fe0},{'phone':_0x5f2729}]});if(_0x23eb4b&&_0x23eb4b['username']===_0x4d2fe0)throw new common_1[(_0x1d4342(0x178))]('用户名已存在、请更换用户名！',common_1[_0x1d4342(0x160)][_0x1d4342(0x164)]);if(_0x23eb4b&&_0x23eb4b[_0x1d4342(0x10d)]===_0x5f2729)throw new common_1['HttpException'](_0x1d4342(0x171),common_1[_0x1d4342(0x160)][_0x1d4342(0x164)]);}async['verifyUserRegisterByEmail'](_0x4b2d9a){const _0x1f4d08=_0x1da16a,{username:_0x5bda46,email:_0x44d449}=_0x4b2d9a;console['log'](_0x1f4d08(0x12c)+_0x5bda46+_0x1f4d08(0xf5)+_0x44d449);const _0x14ca30=await this['userEntity']['findOne']({'where':[{'username':_0x5bda46},{'email':_0x44d449}]});if(_0x14ca30&&_0x14ca30[_0x1f4d08(0x177)]===_0x5bda46){console['error'](_0x1f4d08(0x109)+_0x5bda46+'\x22\x20已存在');throw new common_1[(_0x1f4d08(0x178))](_0x1f4d08(0x169),common_1['HttpStatus'][_0x1f4d08(0x164)]);}if(_0x14ca30&&_0x14ca30[_0x1f4d08(0x176)]===_0x44d449){console[_0x1f4d08(0x12d)](_0x1f4d08(0x170)+_0x44d449+'\x22\x20已被注册');throw new common_1[(_0x1f4d08(0x178))](_0x1f4d08(0x129),common_1['HttpStatus'][_0x1f4d08(0x164)]);}console[_0x1f4d08(0x138)](_0x1f4d08(0x17b)+_0x5bda46+_0x1f4d08(0xf5)+_0x44d449+_0x1f4d08(0x105));}async['createUser'](_0x4cd889){const _0x3c268f=_0x1da16a;return await this[_0x3c268f(0xe9)][_0x3c268f(0x16a)](_0x4cd889);}async[_0x1da16a(0x187)](_0x1e08e9,_0x30a2a0,_0x3bb6d6){const _0x18bd46=_0x1da16a,_0x1e9b08=await this[_0x18bd46(0xe9)][_0x18bd46(0x13b)]({'where':{'id':_0x1e08e9}});!_0x1e9b08&&common_1[_0x18bd46(0x167)][_0x18bd46(0x12d)](_0x18bd46(0xe8));await this[_0x18bd46(0xe9)]['update']({'id':_0x1e08e9},{'realName':_0x30a2a0,'idCard':_0x3bb6d6});return;}async['updateUserPhone'](_0x422df6,_0x15d81f,_0x208745,_0x3bc3f2){const _0xcc7962=_0x1da16a,_0x43b31a=await this[_0xcc7962(0xe9)]['findOne']({'where':{'id':_0x422df6}}),_0x20df40=bcrypt['hashSync'](_0x3bc3f2,0xa);!_0x43b31a&&common_1[_0xcc7962(0x167)][_0xcc7962(0x12d)](_0xcc7962(0xe8));if(!_0x15d81f||!_0x208745||!_0x20df40)throw new common_1[(_0xcc7962(0x178))](_0xcc7962(0x130),common_1[_0xcc7962(0x160)][_0xcc7962(0x164)]);await this[_0xcc7962(0xe9)][_0xcc7962(0x104)]({'id':_0x422df6},{'phone':_0x15d81f,'username':_0x208745,'password':_0x20df40});return;}};UserService=__decorate([(0x0,common_1[_0x1da16a(0xff)])(),__param(0x0,(0x0,typeorm_1[_0x1da16a(0x17a)])(user_entity_1[_0x1da16a(0x125)])),__param(0x6,(0x0,typeorm_1['InjectRepository'])(config_entity_1[_0x1da16a(0x117)])),__metadata(_0x1da16a(0x159),[typeorm_2[_0x1da16a(0x15c)],typeorm_2['Connection'],verification_service_1[_0x1da16a(0x189)],mailer_service_1[_0x1da16a(0x11b)],userBalance_service_1[_0x1da16a(0x10e)],globalConfig_service_1[_0x1da16a(0x186)],typeorm_2[_0x1da16a(0x15c)]])],UserService),exports[_0x1da16a(0x144)]=UserService;function _0xfada(){const _0x47d135=['UserService','修改用户状态失败！','push','cloneDeep','configVal','__metadata','updateUserStatus','lastLoginIp','135153tZDHtV','isVerifyEmail',']成功!','../globalConfig/config.entity','compareSync','564ubNlfo','2355220xzsOdw','11MESRgN','decorate','bindWx','53465LgzBpu','userDefautlAvatar','status','design:paramtypes','UserStatusEnum','registerVerifyEmailTitle','Repository','UNAUTHORIZED','153764avFyiX','createRandomUid','HttpStatus','@nestjs/typeorm','checkUserStatus','queryAll','BAD_REQUEST','isUsernameTaken','用户名已存在！','Logger','315569FIStMd','用户名已存在、请更换用户名！','save','../mailer/mailer.service','Like','openId','consecutiveDays','resetUserPass','校验失败:\x20邮箱\x20\x22','当前手机号已注册、请勿重复注册！','visitor','updateStatus','reduce','4pCLxmw','email','username','HttpException','maskIpAddress','InjectRepository','校验邮箱注册:\x20成功\x20-\x20用户名:\x20','当前用户信息失效、请重新登录！','queryUserBalanceByIds','function','addBalanceToNewUser','./../verification/verification.service','绑定微信失败、请联系管理员！','verifyUserPassword','avatar','../userBalance/userBalance.service','./user.entity','GlobalConfigService','saveRealNameInfo','registerBaseUrl','VerificationService','__esModule','恭喜您绑定成功、后续可直接扫码登录了！','./../globalConfig/globalConfig.service','metadata','find','用户不存在','userEntity','../../common/constants/balance.constant','lodash','globalConfigService','@nestjs/common','重置密码失败！','findAndCount','当前用户不存在！','userRecharge','userId','affected','object',',\x20邮箱:\x20','createUserFromContact','密码重置为[','verifyUserRegister','__decorate','getOpenIdByUserId','queryOne','idCard','该微信已绑定其他账号！','ACTIVE','Injectable','saveRecordRechargeLog','getUserByContact','queryUserBalance','registerVerifyEmailFrom','update','\x20未被占用','修改用户信息失败！','length','client','校验失败:\x20用户名\x20\x22','hashSync','typeorm','registerVerifyEmailDesc','phone','UserBalanceService','getSuper','password','error:\x20','createUserFromOpenId','6FFHSTg','当前绑定用户不存在！','registerVerifyExpir','bcryptjs','ConfigEntity','configEntity','super','您的账户已被永久加入黑名单、如有疑问、请联系管理员！','MailerService','toString','user','maskEmail','10660830dLiKfw','用户不存在！','__param','getConfigs','您的账户已被封禁、如有疑问、请联系管理员！','DESC','UserEntity','queryUserInfoById','forEach','map','当前邮箱已注册、请勿重复注册！','845379jEqorT','assign','校验邮箱注册:\x20开始\x20-\x20用户名:\x20','error','sign','configKey','参数错误！','userBalanceService','slice','6LAqPtv','544pVyvBn','role','当前账户不存在！','updateUserPassword','log','configMap:\x20','verificationService','findOne','Registration','Not','createdAt','addBalanceToUser','当前密码错误！','超级管理员不可被操作！','用户名或者邮箱已被注册！','defineProperty'];_0xfada=function(){return _0x47d135;};return _0xfada();}