'use strict';const _0x58623a=_0x1762;(function(_0x3530b1,_0x5c83f7){const _0x419ee2=_0x1762,_0x29c9d9=_0x3530b1();while(!![]){try{const _0x1f0b2d=-parseInt(_0x419ee2(0xbf))/0x1+-parseInt(_0x419ee2(0xc8))/0x2*(parseInt(_0x419ee2(0x110))/0x3)+parseInt(_0x419ee2(0xff))/0x4*(-parseInt(_0x419ee2(0xa5))/0x5)+parseInt(_0x419ee2(0xb5))/0x6+-parseInt(_0x419ee2(0xd4))/0x7*(parseInt(_0x419ee2(0x9c))/0x8)+-parseInt(_0x419ee2(0xcc))/0x9+parseInt(_0x419ee2(0xe6))/0xa;if(_0x1f0b2d===_0x5c83f7)break;else _0x29c9d9['push'](_0x29c9d9['shift']());}catch(_0x446693){_0x29c9d9['push'](_0x29c9d9['shift']());}}}(_0x4eef,0xb0a25));function _0x4eef(){const _0x11ac3a=['error:\x20','9492eoWpBO','校验失败:\x20用户名\x20\x22','getUserByContact','尝试发送邮件到:\x20','修改用户状态成功！','修改用户状态失败！','assign','reduce','connection','toUpperCase','当前密码错误！','getClientIp','VerificationEnum','saveRecordRechargeLog','defineProperty','UserService','status','idCard','恭喜您绑定成功、后续可直接扫码登录了！','userEntity','configMap:\x20','@nestjs/common','push','hashSync','client','verifyUserRegisterByPhone','没有变更，无需更改！','registerIp','用户名已存在！','createUserFromOpenId','getUserFromOpenId','用户不存在！','registerVerifyEmailDesc','getOpenIdByUserId','typeorm','consecutiveDays','findOne','addBalanceToNewUser','用户名或者邮箱已被注册！','getUserOpenId','updateUserPassword','密码重置为[','userRecharge','ACTIVE','UserEntity','metadata','__metadata','registerVerifyExpir','avatar','configKey','queryUserInfoById','length','isUsernameTaken','map','verifyUserPassword','11154032eiyAzt','update','affected','find','saveRealNameInfo','ADMIN_GIFT','修改用户信息失败！','../../common/utils','openId','270615xaKuZx','当前账户不存在！','MailerService','queryUserBalance','PENDING','queryOne','userDefautlAvatar','getOwnPropertyDescriptor','DESC','queryOneUserInfo',',\x20邮箱:\x20','createVerification','Logger','username','您的账户已被永久加入黑名单、如有疑问、请联系管理员！','isBindWx','7040346XwJqTb','sign','getConfigs','queryAll','email','RechargeType','maskEmail','object','phone','updateStatus','1286211oTLyOg','./user.entity','Not','updateInfo','findAndCount','userId','createUserAndVerifycation','UserBalanceService','校验邮箱注册:\x20成功\x20-\x20用户名:\x20','804YgtJNt','registerVerifyEmailTitle','password','verifyUserCredentials','9898866ROYyFi','getUserById','getUserStatus','globalConfigService','UserStatusEnum','userBalanceService','design:paramtypes','maskIpAddress','7cPkNNh','role','balanceInfo','Like','用户名已存在、请更换用户名！','log','forEach','createUserFromContact','@nestjs/typeorm','修改用户信息成功！','createdAt','function','../../common/constants/verification.constant','Injectable','../../common/constants/balance.constant','updateUserStatus','savaLoginIp','./../globalConfig/globalConfig.service','58471980TsaAKC','user','addBalanceToUser','HttpException','checkUserStatus','lastLoginIp','queryUserBalanceByIds','lodash','绑定微信失败、请联系管理员！','HttpStatus','configEntity','__esModule','toString','超级管理员不可被操作！','用户不存在','当前用户信息失效、请重新登录！','slice','当前绑定用户不存在！','Repository','super','isVerifyEmail','updateUserPhone','BLACKLISTED','registerBaseUrl','verificationService','92JWapnA','decorate','bindWx','error','compareSync','UNAUTHORIZED','UserStatusErrMsg','save','该微信已绑定其他账号！','BAD_REQUEST','configVal','\x22\x20已被注册','createRandomUid','InjectRepository','registerVerifyEmailFrom','123456'];_0x4eef=function(){return _0x11ac3a;};return _0x4eef();}function _0x1762(_0x422752,_0x3bae15){const _0x4eef43=_0x4eef();return _0x1762=function(_0x1762eb,_0x1990dd){_0x1762eb=_0x1762eb-0x85;let _0xc71cc8=_0x4eef43[_0x1762eb];return _0xc71cc8;},_0x1762(_0x422752,_0x3bae15);}var __decorate=this&&this['__decorate']||function(_0x3fed36,_0x30019b,_0x5122b5,_0xf30878){const _0x58e213=_0x1762;var _0x46a79a=arguments[_0x58e213(0x98)],_0x4ec8e6=_0x46a79a<0x3?_0x30019b:_0xf30878===null?_0xf30878=Object[_0x58e213(0xac)](_0x30019b,_0x5122b5):_0xf30878,_0x35f844;if(typeof Reflect===_0x58e213(0xbc)&&typeof Reflect[_0x58e213(0x100)]===_0x58e213(0xdf))_0x4ec8e6=Reflect['decorate'](_0x3fed36,_0x30019b,_0x5122b5,_0xf30878);else{for(var _0x1b3a0b=_0x3fed36[_0x58e213(0x98)]-0x1;_0x1b3a0b>=0x0;_0x1b3a0b--)if(_0x35f844=_0x3fed36[_0x1b3a0b])_0x4ec8e6=(_0x46a79a<0x3?_0x35f844(_0x4ec8e6):_0x46a79a>0x3?_0x35f844(_0x30019b,_0x5122b5,_0x4ec8e6):_0x35f844(_0x30019b,_0x5122b5))||_0x4ec8e6;}return _0x46a79a>0x3&&_0x4ec8e6&&Object[_0x58e213(0x11e)](_0x30019b,_0x5122b5,_0x4ec8e6),_0x4ec8e6;},__metadata=this&&this[_0x58623a(0x93)]||function(_0x368f85,_0x43281b){const _0x53103c=_0x58623a;if(typeof Reflect===_0x53103c(0xbc)&&typeof Reflect[_0x53103c(0x92)]===_0x53103c(0xdf))return Reflect[_0x53103c(0x92)](_0x368f85,_0x43281b);},__param=this&&this['__param']||function(_0x220260,_0xe5e4a0){return function(_0x1d9209,_0xa4a554){_0xe5e4a0(_0x1d9209,_0xa4a554,_0x220260);};};Object[_0x58623a(0x11e)](exports,_0x58623a(0xf1),{'value':!![]}),exports[_0x58623a(0x11f)]=void 0x0;const balance_constant_1=require(_0x58623a(0xe2)),verification_constant_1=require(_0x58623a(0xe0)),utils_1=require(_0x58623a(0xa3)),mailer_service_1=require('../mailer/mailer.service'),common_1=require(_0x58623a(0x125)),typeorm_1=require(_0x58623a(0xdc)),bcrypt=require('bcryptjs'),_=require(_0x58623a(0xed)),typeorm_2=require(_0x58623a(0x87)),config_entity_1=require('../globalConfig/config.entity'),userBalance_service_1=require('../userBalance/userBalance.service'),user_constant_1=require('./../../common/constants/user.constant'),globalConfig_service_1=require(_0x58623a(0xe5)),verification_service_1=require('./../verification/verification.service'),user_entity_1=require(_0x58623a(0xc0));let UserService=class UserService{constructor(_0x57e9ca,_0x443d5a,_0x4a9667,_0x30cbb7,_0x530d96,_0x43e09e,_0x11ae1e){const _0x10f72d=_0x58623a;this[_0x10f72d(0x123)]=_0x57e9ca,this[_0x10f72d(0x118)]=_0x443d5a,this[_0x10f72d(0xfe)]=_0x4a9667,this['mailerService']=_0x30cbb7,this[_0x10f72d(0xd1)]=_0x530d96,this[_0x10f72d(0xcf)]=_0x43e09e,this[_0x10f72d(0xf0)]=_0x11ae1e;}async[_0x58623a(0xc5)](_0x561e18,_0x5824c0){const _0x242c09=_0x58623a,{username:_0x48d25b,email:_0x56a517,password:_0x404b8d,client:client=0x0}=_0x561e18,_0x1614d1=[{'username':_0x48d25b},{'email':_0x56a517}],_0x391b5f=await this[_0x242c09(0x123)][_0x242c09(0x89)]({'where':_0x1614d1});if(_0x391b5f&&_0x391b5f[_0x242c09(0x120)]!==user_constant_1[_0x242c09(0xd0)][_0x242c09(0xa9)])throw new common_1[(_0x242c09(0xe9))](_0x242c09(0x8b),common_1[_0x242c09(0xef)][_0x242c09(0x108)]);try{const _0x219aad=_['cloneDeep'](_0x561e18),_0x66e97f=bcrypt[_0x242c09(0x127)](_0x404b8d,0xa),_0xae78a1=(0x0,utils_1[_0x242c09(0x11b)])(_0x5824c0);_0x219aad['password']=_0x66e97f,_0x219aad[_0x242c09(0x12b)]=_0xae78a1,_0x219aad[_0x242c09(0x128)]=client;let _0x29a4de;if(!_0x391b5f){const _0x31dbda=await this['globalConfigService'][_0x242c09(0xb7)]([_0x242c09(0xab)]);_0x219aad['avatar']=_0x31dbda,_0x29a4de=await this['userEntity'][_0x242c09(0x106)](_0x219aad);}else _0x29a4de=_0x391b5f;const _0x1768f0=await this[_0x242c09(0xf0)]['find']({'where':{'configKey':(0x0,typeorm_2['In'])([_0x242c09(0xfa),_0x242c09(0xfd),_0x242c09(0xc9),_0x242c09(0x85),_0x242c09(0x10d),_0x242c09(0x94)])}}),_0x2dddf7=_0x1768f0[_0x242c09(0x117)]((_0x35b6ab,_0x7ab15a)=>{const _0x17c01f=_0x242c09;return _0x35b6ab[_0x7ab15a[_0x17c01f(0x96)]]=_0x7ab15a[_0x17c01f(0x109)],_0x35b6ab;},{}),_0xedb63c=_0x2dddf7[_0x242c09(0xfa)]?Number(_0x2dddf7[_0x242c09(0xfa)]):0x1;if(_0xedb63c){const _0x4d0e4a=_0x2dddf7[_0x242c09(0x94)]?Number(_0x2dddf7[_0x242c09(0x94)]):0x1e*0x3c,_0x24c42c=await this['verificationService'][_0x242c09(0xb0)](_0x29a4de,verification_constant_1[_0x242c09(0x11c)]['Registration'],_0x4d0e4a),{code:_0x5445fb,email:_0x1c475a,id:_0x41c1c9}=_0x24c42c,{registerVerifyEmailFrom:_0x38cacb}=_0x2dddf7;console['log'](_0x242c09(0x124),_0x2dddf7),console[_0x242c09(0xd9)](_0x242c09(0x113)+_0x1c475a);}else{const {id:_0x22b779}=_0x29a4de;await this[_0x242c09(0xe3)](_0x22b779,user_constant_1[_0x242c09(0xd0)][_0x242c09(0x90)]),await this[_0x242c09(0xd1)][_0x242c09(0x8a)](_0x22b779);}return _0x29a4de;}catch(_0x3e2010){console[_0x242c09(0xd9)](_0x242c09(0x10f),_0x3e2010);throw _0x3e2010;}}async['getSuper'](){const _0x9ef656=_0x58623a,_0x598230=await this[_0x9ef656(0x123)][_0x9ef656(0x89)]({'where':{'role':_0x9ef656(0xf9)}});return _0x598230;}async[_0x58623a(0xcb)](_0x4c81c6){const _0x4f1e01=_0x58623a,{username:_0x3676cd,password:_0x1c2b0f,uid:uid=0x0,phone:_0x15a554}=_0x4c81c6;let _0x648923=null;if(uid>0x0){_0x648923=await this['userEntity']['findOne']({'where':{'id':uid}});if(!_0x648923)throw new common_1['HttpException'](_0x4f1e01(0xa6),common_1[_0x4f1e01(0xef)]['BAD_REQUEST']);if(!bcrypt[_0x4f1e01(0x103)](_0x1c2b0f,_0x648923[_0x4f1e01(0xca)]))throw new common_1[(_0x4f1e01(0xe9))](_0x4f1e01(0x11a),common_1[_0x4f1e01(0xef)]['BAD_REQUEST']);}if(_0x3676cd&&_0x1c2b0f){const _0x3d823a=[{'username':_0x3676cd},{'email':_0x3676cd},{'phone':_0x3676cd}];_0x648923=await this[_0x4f1e01(0x123)][_0x4f1e01(0x89)]({'where':_0x3d823a});if(!_0x648923)throw new common_1['HttpException']('当前账户不存在！',common_1[_0x4f1e01(0xef)][_0x4f1e01(0x108)]);if(!bcrypt['compareSync'](_0x1c2b0f,_0x648923[_0x4f1e01(0xca)]))throw new common_1['HttpException']('当前密码错误！',common_1[_0x4f1e01(0xef)][_0x4f1e01(0x108)]);}if(!_0x648923)throw new common_1[(_0x4f1e01(0xe9))](_0x4f1e01(0xa6),common_1[_0x4f1e01(0xef)][_0x4f1e01(0x108)]);if(_0x648923[_0x4f1e01(0x120)]!==user_constant_1['UserStatusEnum'][_0x4f1e01(0x90)])throw new common_1['HttpException'](user_constant_1[_0x4f1e01(0x105)][_0x648923[_0x4f1e01(0x120)]],common_1[_0x4f1e01(0xef)][_0x4f1e01(0x108)]);return _0x648923;}async[_0x58623a(0x9b)](_0x2aac9e,_0x2928a6){const _0x307bed=_0x58623a,_0x966fe3=await this[_0x307bed(0x123)][_0x307bed(0x89)]({'where':{'id':_0x2aac9e}});return bcrypt[_0x307bed(0x103)](_0x2928a6,_0x966fe3[_0x307bed(0xca)]);}async['updateUserStatus'](_0x2441e7,_0x311697){const _0x3a02e4=_0x58623a,_0x1e0d81=await this[_0x3a02e4(0x123)][_0x3a02e4(0x9d)]({'id':_0x2441e7},{'status':_0x311697});return _0x1e0d81['affected']>0x0;}async[_0x58623a(0xce)](_0x19d5c7){const _0x10c78f=_0x58623a,_0x540565=await this[_0x10c78f(0x123)][_0x10c78f(0x89)]({'where':{'id':_0x19d5c7}});return _0x540565[_0x10c78f(0x120)];}async[_0x58623a(0x97)](_0x3f9f01){const _0x18c71f=_0x58623a;return await this[_0x18c71f(0x123)][_0x18c71f(0x89)]({'where':{'id':_0x3f9f01}});}async[_0x58623a(0xae)](_0x41f351){const _0x1f9a39=_0x58623a;return await this[_0x1f9a39(0x123)][_0x1f9a39(0x89)]({'where':{'id':_0x41f351}});}async[_0x58623a(0xea)](_0x8ff42){const _0x3c20e2=_0x58623a,{id:_0xa07d88,role:_0x287c99}=_0x8ff42;if(_0x287c99==='visitor')return!![];const _0x1d83b9=await this['userEntity'][_0x3c20e2(0x89)]({'where':{'id':_0xa07d88}});if(!_0x1d83b9)throw new common_1[(_0x3c20e2(0xe9))](_0x3c20e2(0xf5),common_1[_0x3c20e2(0xef)][_0x3c20e2(0x104)]);if(_0x1d83b9['status']===user_constant_1['UserStatusEnum'][_0x3c20e2(0xfc)])throw new common_1[(_0x3c20e2(0xe9))](_0x3c20e2(0xb3),common_1['HttpStatus'][_0x3c20e2(0x108)]);if(_0x1d83b9['status']===user_constant_1[_0x3c20e2(0xd0)]['LOCKED'])throw new common_1[(_0x3c20e2(0xe9))]('您的账户已被封禁、如有疑问、请联系管理员！',common_1[_0x3c20e2(0xef)]['BAD_REQUEST']);}async['getUserInfo'](_0x2d55f2){const _0x94cb8b=_0x58623a,_0x7b90ab=await this['userEntity'][_0x94cb8b(0x89)]({'where':{'id':_0x2d55f2},'select':['username',_0x94cb8b(0x95),_0x94cb8b(0xd5),_0x94cb8b(0xb9),_0x94cb8b(0xb6),'openId',_0x94cb8b(0x88)]});if(!_0x7b90ab)throw new common_1[(_0x94cb8b(0xe9))](_0x94cb8b(0xf5),common_1['HttpStatus'][_0x94cb8b(0x104)]);_0x7b90ab[_0x94cb8b(0xb4)]=!!(_0x7b90ab===null||_0x7b90ab===void 0x0?void 0x0:_0x7b90ab[_0x94cb8b(0xa4)]),delete _0x7b90ab[_0x94cb8b(0xa4)];const _0x2c1b2a=await this['userBalanceService'][_0x94cb8b(0xa8)](_0x2d55f2),_0x540be3=(_0x2d55f2*0x7b+0x5f5e100)[_0x94cb8b(0xf2)](0x24)[_0x94cb8b(0x119)]()[_0x94cb8b(0xf6)](-0x6);return _0x7b90ab['id']=_0x540be3,{'userInfo':_0x7b90ab,'userBalance':Object[_0x94cb8b(0x116)]({},_0x2c1b2a)};}async[_0x58623a(0xcd)](_0x58577c){const _0x15a8b8=_0x58623a;return await this[_0x15a8b8(0x123)]['findOne']({'where':{'id':_0x58577c}});}async[_0x58623a(0x8c)](_0x10b218){const _0x30dee8=_0x58623a;return await this[_0x30dee8(0x123)][_0x30dee8(0x89)]({'where':{'openId':_0x10b218}});}async[_0x58623a(0xc2)](_0x416c7b,_0x558469){const _0x48119a=_0x58623a,{id:_0x2bb36f}=_0x558469['user'],_0x450ea1=await this[_0x48119a(0x123)][_0x48119a(0x89)]({'where':{'id':_0x2bb36f}});if(!_0x450ea1)throw new common_1[(_0x48119a(0xe9))]('当前用户不存在！',common_1['HttpStatus'][_0x48119a(0x108)]);if(_0x416c7b[_0x48119a(0xb2)]&&_0x450ea1['username']===_0x416c7b['username'])throw new common_1['HttpException'](_0x48119a(0x12a),common_1[_0x48119a(0xef)][_0x48119a(0x108)]);if(_0x416c7b['username']){const _0xe44364=await this[_0x48119a(0x99)](_0x416c7b[_0x48119a(0xb2)],_0x2bb36f);if(_0xe44364)throw new common_1[(_0x48119a(0xe9))](_0x48119a(0x12c),common_1[_0x48119a(0xef)][_0x48119a(0x108)]);}const _0x38d67a=await this[_0x48119a(0x123)]['update']({'id':_0x2bb36f},_0x416c7b);if(_0x38d67a['affected']<=0x0)throw new common_1[(_0x48119a(0xe9))](_0x48119a(0xa2),common_1[_0x48119a(0xef)][_0x48119a(0x108)]);return _0x48119a(0xdd);}async[_0x58623a(0x99)](_0x48cf44,_0x37694c){const _0xe9fa11=_0x58623a,_0x53b1a2={'username':_0x48cf44};_0x37694c&&(_0x53b1a2['id']=(0x0,typeorm_2[_0xe9fa11(0xc1)])(_0x37694c));const _0x164a6d=await this['userEntity']['findOne']({'where':_0x53b1a2});return!!_0x164a6d;}async[_0x58623a(0x8d)](_0x40f035,_0x6eb6ef){const _0x15de9c=_0x58623a,_0x5ea6fe=bcrypt['hashSync'](_0x6eb6ef,0xa),_0x129fd1=await this[_0x15de9c(0x123)][_0x15de9c(0x9d)]({'id':_0x40f035},{'password':_0x5ea6fe});if(_0x129fd1['affected']<=0x0)throw new common_1[(_0x15de9c(0xe9))]('修改密码失败、请重新试试吧。',common_1[_0x15de9c(0xef)][_0x15de9c(0x108)]);}async[_0x58623a(0x8f)](_0x4523e6){const _0x3d092d=_0x58623a,{userId:_0x1fe484,model3Count:model3Count=0x0,model4Count:model4Count=0x0,drawMjCount:drawMjCount=0x0}=_0x4523e6;await this[_0x3d092d(0xd1)][_0x3d092d(0xe8)](_0x1fe484,{'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount});const _0x22e58d=await this['userBalanceService'][_0x3d092d(0x11d)]({'userId':_0x1fe484,'rechargeType':balance_constant_1[_0x3d092d(0xba)][_0x3d092d(0xa1)],'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount,'extent':''});return _0x22e58d;}async[_0x58623a(0xb8)](_0xdf67a5,_0x1f8f99){const _0x28768d=_0x58623a,{page:page=0x1,size:size=0xa,username:_0x49e8ca,email:_0x1d7d80,status:_0x4026fa,keyword:_0x505801,phone:_0x1ad7da}=_0xdf67a5;let _0x330652={};_0x49e8ca&&Object['assign'](_0x330652,{'username':(0x0,typeorm_2['Like'])('%'+_0x49e8ca+'%')}),_0x1d7d80&&Object['assign'](_0x330652,{'email':(0x0,typeorm_2[_0x28768d(0xd7)])('%'+_0x1d7d80+'%')}),_0x1ad7da&&Object['assign'](_0x330652,{'phone':(0x0,typeorm_2[_0x28768d(0xd7)])('%'+_0x1ad7da+'%')}),_0x4026fa&&Object[_0x28768d(0x116)](_0x330652,{'status':_0x4026fa});_0x505801&&(_0x330652=[{'username':(0x0,typeorm_2['Like'])('%'+_0x505801+'%')},{'email':(0x0,typeorm_2[_0x28768d(0xd7)])('%'+_0x505801+'%')},{'phone':(0x0,typeorm_2[_0x28768d(0xd7)])('%'+_0x505801+'%')}]);const [_0x7ed76a,_0x1d6e6c]=await this[_0x28768d(0x123)][_0x28768d(0xc3)]({'skip':(page-0x1)*size,'where':_0x330652,'take':size,'order':{'createdAt':_0x28768d(0xad)},'cache':!![],'select':[_0x28768d(0xb2),_0x28768d(0x95),'role',_0x28768d(0xb6),_0x28768d(0x120),'id',_0x28768d(0xb9),_0x28768d(0xde),_0x28768d(0xeb),_0x28768d(0xbd),'realName',_0x28768d(0x121)]}),_0x2701df=_0x7ed76a[_0x28768d(0x9a)](_0xd8d990=>_0xd8d990['id']),_0x4cabe1=await this['userBalanceService'][_0x28768d(0xec)](_0x2701df);return _0x7ed76a[_0x28768d(0xda)](_0x1d9c6c=>_0x1d9c6c[_0x28768d(0xd6)]=_0x4cabe1[_0x28768d(0x9f)](_0x54b691=>_0x54b691[_0x28768d(0xc4)]===_0x1d9c6c['id'])),_0x1f8f99[_0x28768d(0xe7)][_0x28768d(0xd5)]!==_0x28768d(0xf9)&&_0x7ed76a[_0x28768d(0xda)](_0x445069=>_0x445069[_0x28768d(0xb9)]=(0x0,utils_1[_0x28768d(0xbb)])(_0x445069[_0x28768d(0xb9)])),_0x1f8f99['user'][_0x28768d(0xd5)]!==_0x28768d(0xf9)&&_0x7ed76a['forEach'](_0x40996a=>_0x40996a['lastLoginIp']=(0x0,utils_1[_0x28768d(0xd3)])(_0x40996a[_0x28768d(0xeb)])),_0x1f8f99[_0x28768d(0xe7)]['role']!==_0x28768d(0xf9)&&_0x7ed76a[_0x28768d(0xda)](_0x5b0b28=>_0x5b0b28['phone']=(0x0,utils_1[_0x28768d(0xd3)])(_0x5b0b28[_0x28768d(0xbd)])),{'rows':_0x7ed76a,'count':_0x1d6e6c};}async[_0x58623a(0xaa)]({id:_0x30a2a8}){const _0x2ce438=_0x58623a;return await this[_0x2ce438(0x123)][_0x2ce438(0x89)]({'where':{'id':_0x30a2a8},'select':[_0x2ce438(0xb2),'avatar',_0x2ce438(0xd5),_0x2ce438(0xb6),_0x2ce438(0x120)]});}async[_0x58623a(0xbe)](_0x4ea877){const _0x53aa13=_0x58623a,{id:_0x545006,status:_0x77c090}=_0x4ea877,_0x1aad2b=await this[_0x53aa13(0x123)][_0x53aa13(0x89)]({'where':{'id':_0x545006}});if(!_0x1aad2b)throw new common_1[(_0x53aa13(0xe9))](_0x53aa13(0x12f),common_1[_0x53aa13(0xef)][_0x53aa13(0x108)]);if(_0x1aad2b[_0x53aa13(0xd5)]==='super')throw new common_1[(_0x53aa13(0xe9))]('超级管理员不可被操作！',common_1['HttpStatus'][_0x53aa13(0x108)]);if(_0x1aad2b[_0x53aa13(0xd5)]===_0x53aa13(0xf9))throw new common_1[(_0x53aa13(0xe9))](_0x53aa13(0xf3),common_1[_0x53aa13(0xef)]['BAD_REQUEST']);const _0x1a8896=await this[_0x53aa13(0x123)][_0x53aa13(0x9d)]({'id':_0x545006},{'status':_0x77c090});if(_0x1a8896['affected']<=0x0)throw new common_1[(_0x53aa13(0xe9))](_0x53aa13(0x115),common_1[_0x53aa13(0xef)][_0x53aa13(0x108)]);return _0x53aa13(0x114);}async['resetUserPass'](_0x1b4106){const _0x5f1b52=_0x58623a,{id:_0x3984f5}=_0x1b4106,_0x1e0e5d=await this[_0x5f1b52(0x123)][_0x5f1b52(0x89)]({'where':{'id':_0x3984f5}});if(!_0x1e0e5d)throw new common_1[(_0x5f1b52(0xe9))](_0x5f1b52(0x12f),common_1[_0x5f1b52(0xef)]['BAD_REQUEST']);const _0x49542c=_0x5f1b52(0x10e),_0x4ecf99=bcrypt['hashSync'](_0x49542c,0xa),_0x4459b8=await this[_0x5f1b52(0x123)][_0x5f1b52(0x9d)]({'id':_0x3984f5},{'password':_0x4ecf99});if(_0x4459b8[_0x5f1b52(0x9e)]<=0x0)throw new common_1['HttpException']('重置密码失败！',common_1['HttpStatus'][_0x5f1b52(0x108)]);return _0x5f1b52(0x8e)+_0x49542c+']成功!';}async[_0x58623a(0xe4)](_0x14db12,_0xc0a7a0){const _0x4e4acd=_0x58623a;return await this['userEntity'][_0x4e4acd(0x9d)]({'id':_0x14db12},{'lastLoginIp':_0xc0a7a0});}async[_0x58623a(0x12e)](_0x42c863,_0x5c60be){const _0x6dbed9=_0x58623a,_0x34f6d0=await this['userEntity'][_0x6dbed9(0x89)]({'where':{'openId':_0x42c863}});if(!_0x34f6d0){const _0x47a8f6=await this[_0x6dbed9(0x12d)](_0x42c863);return await this[_0x6dbed9(0xd1)]['addBalanceToNewUser'](_0x47a8f6['id']),_0x47a8f6;}return _0x34f6d0;}async[_0x58623a(0x12d)](_0x253b9a){const _0xe7cc6e=_0x58623a,_0x120ca0=await this[_0xe7cc6e(0xcf)][_0xe7cc6e(0xb7)]([_0xe7cc6e(0xab)]),_0x471a17={'avatar':_0x120ca0,'username':'用户'+(0x0,utils_1[_0xe7cc6e(0x10b)])(),'status':user_constant_1['UserStatusEnum'][_0xe7cc6e(0x90)],'sex':0x0,'email':(0x0,utils_1[_0xe7cc6e(0x10b)])()+'@default.com','openId':_0x253b9a},_0x338491=await this[_0xe7cc6e(0x123)][_0xe7cc6e(0x106)](_0x471a17);return _0x338491;}async[_0x58623a(0xdb)](_0x4b1e82){const _0x5446df=_0x58623a,{username:_0x406f76,email:_0x2940a3,phone:_0xc87f17}=_0x4b1e82,_0x3b3fea=await this['globalConfigService'][_0x5446df(0xb7)]([_0x5446df(0xab)]),_0x2829d0={'avatar':_0x3b3fea,'username':'用户'+(0x0,utils_1['createRandomUid'])(),'status':user_constant_1[_0x5446df(0xd0)][_0x5446df(0x90)],'sex':0x0};_0x406f76&&(_0x2829d0[_0x5446df(0xb2)]=_0x406f76);_0x2940a3&&(_0x2829d0[_0x5446df(0xb9)]=_0x2940a3);_0xc87f17&&(_0x2829d0[_0x5446df(0xbd)]=_0xc87f17);const _0xa5e4ac=await this['userEntity'][_0x5446df(0x106)](_0x2829d0);return _0xa5e4ac;}async[_0x58623a(0x112)](_0x239cea){const _0x5ed207=_0x58623a,{username:_0x4acfc6,email:_0x33d5b9,phone:_0xe8b42d}=_0x239cea,_0x7f4c3e=[];return _0x4acfc6&&_0x7f4c3e[_0x5ed207(0x126)]({'username':_0x4acfc6}),_0x33d5b9&&_0x7f4c3e[_0x5ed207(0x126)]({'email':_0x33d5b9}),_0xe8b42d&&_0x7f4c3e[_0x5ed207(0x126)]({'phone':_0xe8b42d}),await this['userEntity'][_0x5ed207(0x89)]({'where':_0x7f4c3e});}async[_0x58623a(0x101)](_0x287019,_0x860ddb){const _0x4e7a99=_0x58623a;try{const _0x142d8b=await this[_0x4e7a99(0x123)][_0x4e7a99(0x89)]({'where':{'id':_0x860ddb}});if(!_0x142d8b)return{'status':![],'msg':_0x4e7a99(0xf7)};const _0xfa85b7=await this[_0x4e7a99(0x123)][_0x4e7a99(0x89)]({'where':{'openId':_0x287019}});if(_0xfa85b7)return{'status':![],'msg':_0x4e7a99(0x107)};const _0x2d9974=await this[_0x4e7a99(0x123)][_0x4e7a99(0x9d)]({'id':_0x860ddb},{'openId':_0x287019});if(_0x2d9974['affected']<=0x0)return{'status':![],'msg':_0x4e7a99(0xee)};return{'status':!![],'msg':_0x4e7a99(0x122)};}catch(_0x4443c4){return{'status':![],'msg':_0x4e7a99(0xee)};}}async[_0x58623a(0x86)](_0x280dc6){const _0x318daa=_0x58623a,_0x20836b=await this[_0x318daa(0x123)][_0x318daa(0x89)]({'where':{'id':_0x280dc6}});return _0x20836b===null||_0x20836b===void 0x0?void 0x0:_0x20836b[_0x318daa(0xa4)];}async['verifyUserRegister'](_0x1f8f3f){const _0x783183=_0x58623a,{username:_0x146588,phone:_0x20fc78,email:_0x1c4e6a}=_0x1f8f3f;if(_0x20fc78){const _0x4c350f=await this[_0x783183(0x123)][_0x783183(0x89)]({'where':{'phone':_0x20fc78}});if(_0x4c350f)return![];}if(_0x1c4e6a){const _0x35e04b=await this[_0x783183(0x123)][_0x783183(0x89)]({'where':{'email':_0x1c4e6a}});if(_0x35e04b)return![];}if(_0x146588){const _0x25aeef=await this[_0x783183(0x123)][_0x783183(0x89)]({'where':{'username':_0x146588}});if(_0x25aeef)return![];}if(!_0x20fc78&&!_0x1c4e6a&&!_0x146588)return![];return!![];}async[_0x58623a(0x129)](_0x34b152){const _0x311eea=_0x58623a,{username:_0x559be3,password:_0xc0549a,phone:_0x3fd317,phoneCode:_0x3fa550}=_0x34b152,_0x297a71=await this['userEntity'][_0x311eea(0x89)]({'where':[{'username':_0x559be3},{'phone':_0x3fd317}]});if(_0x297a71&&_0x297a71['username']===_0x559be3)throw new common_1[(_0x311eea(0xe9))](_0x311eea(0xd8),common_1['HttpStatus']['BAD_REQUEST']);if(_0x297a71&&_0x297a71[_0x311eea(0xbd)]===_0x3fd317)throw new common_1['HttpException']('当前手机号已注册、请勿重复注册！',common_1[_0x311eea(0xef)][_0x311eea(0x108)]);}async['verifyUserRegisterByEmail'](_0x1d8318){const _0x4f02d9=_0x58623a,{username:_0x32fdf2,email:_0x9317b3}=_0x1d8318;console[_0x4f02d9(0xd9)]('校验邮箱注册:\x20开始\x20-\x20用户名:\x20'+_0x32fdf2+_0x4f02d9(0xaf)+_0x9317b3);const _0x512187=await this[_0x4f02d9(0x123)][_0x4f02d9(0x89)]({'where':[{'username':_0x32fdf2},{'email':_0x9317b3}]});if(_0x512187&&_0x512187[_0x4f02d9(0xb2)]===_0x32fdf2){console[_0x4f02d9(0x102)](_0x4f02d9(0x111)+_0x32fdf2+'\x22\x20已存在');throw new common_1[(_0x4f02d9(0xe9))]('用户名已存在、请更换用户名！',common_1[_0x4f02d9(0xef)][_0x4f02d9(0x108)]);}if(_0x512187&&_0x512187['email']===_0x9317b3){console[_0x4f02d9(0x102)]('校验失败:\x20邮箱\x20\x22'+_0x9317b3+_0x4f02d9(0x10a));throw new common_1[(_0x4f02d9(0xe9))]('当前邮箱已注册、请勿重复注册！',common_1[_0x4f02d9(0xef)]['BAD_REQUEST']);}console[_0x4f02d9(0xd9)](_0x4f02d9(0xc7)+_0x32fdf2+_0x4f02d9(0xaf)+_0x9317b3+'\x20未被占用');}async['createUser'](_0x1b05bf){const _0x5f411c=_0x58623a;return await this[_0x5f411c(0x123)][_0x5f411c(0x106)](_0x1b05bf);}async[_0x58623a(0xa0)](_0x336b04,_0x156650,_0x1dce32){const _0x446539=_0x58623a,_0x490102=await this[_0x446539(0x123)][_0x446539(0x89)]({'where':{'id':_0x336b04}});!_0x490102&&common_1['Logger'][_0x446539(0x102)](_0x446539(0xf4));await this['userEntity'][_0x446539(0x9d)]({'id':_0x336b04},{'realName':_0x156650,'idCard':_0x1dce32});return;}async[_0x58623a(0xfb)](_0x7d26bd,_0xccf4f8,_0x54fc4a,_0x2f1c85){const _0x5d0d4a=_0x58623a,_0x39defd=await this[_0x5d0d4a(0x123)][_0x5d0d4a(0x89)]({'where':{'id':_0x7d26bd}}),_0x8baea=bcrypt[_0x5d0d4a(0x127)](_0x2f1c85,0xa);!_0x39defd&&common_1[_0x5d0d4a(0xb1)][_0x5d0d4a(0x102)](_0x5d0d4a(0xf4));if(!_0xccf4f8||!_0x54fc4a||!_0x8baea)throw new common_1[(_0x5d0d4a(0xe9))]('参数错误！',common_1[_0x5d0d4a(0xef)][_0x5d0d4a(0x108)]);await this[_0x5d0d4a(0x123)][_0x5d0d4a(0x9d)]({'id':_0x7d26bd},{'phone':_0xccf4f8,'username':_0x54fc4a,'password':_0x8baea});return;}};UserService=__decorate([(0x0,common_1[_0x58623a(0xe1)])(),__param(0x0,(0x0,typeorm_1[_0x58623a(0x10c)])(user_entity_1[_0x58623a(0x91)])),__param(0x6,(0x0,typeorm_1['InjectRepository'])(config_entity_1['ConfigEntity'])),__metadata(_0x58623a(0xd2),[typeorm_2['Repository'],typeorm_2['Connection'],verification_service_1['VerificationService'],mailer_service_1[_0x58623a(0xa7)],userBalance_service_1[_0x58623a(0xc6)],globalConfig_service_1['GlobalConfigService'],typeorm_2[_0x58623a(0xf8)]])],UserService),exports['UserService']=UserService;