'use strict';function _0x5ab6(_0x132abe,_0x581c53){const _0x397753=_0x3977();return _0x5ab6=function(_0x5ab639,_0x2bb497){_0x5ab639=_0x5ab639-0x143;let _0x43a5f4=_0x397753[_0x5ab639];return _0x43a5f4;},_0x5ab6(_0x132abe,_0x581c53);}const _0x65f768=_0x5ab6;(function(_0x3f383d,_0x4ebed8){const _0x465389=_0x5ab6,_0x49b94d=_0x3f383d();while(!![]){try{const _0x5f5901=-parseInt(_0x465389(0x14a))/0x1*(parseInt(_0x465389(0x143))/0x2)+parseInt(_0x465389(0x1ca))/0x3*(parseInt(_0x465389(0x18a))/0x4)+-parseInt(_0x465389(0x145))/0x5+-parseInt(_0x465389(0x1af))/0x6+parseInt(_0x465389(0x163))/0x7+parseInt(_0x465389(0x19d))/0x8*(-parseInt(_0x465389(0x1e1))/0x9)+parseInt(_0x465389(0x15a))/0xa*(parseInt(_0x465389(0x190))/0xb);if(_0x5f5901===_0x4ebed8)break;else _0x49b94d['push'](_0x49b94d['shift']());}catch(_0x3566f4){_0x49b94d['push'](_0x49b94d['shift']());}}}(_0x3977,0x82a2d));var __decorate=this&&this[_0x65f768(0x1ee)]||function(_0x583aeb,_0x38980d,_0x358216,_0x2b98d7){const _0x3e3c7a=_0x65f768;var _0x1fe500=arguments[_0x3e3c7a(0x18e)],_0x5564a2=_0x1fe500<0x3?_0x38980d:_0x2b98d7===null?_0x2b98d7=Object[_0x3e3c7a(0x196)](_0x38980d,_0x358216):_0x2b98d7,_0x1884d5;if(typeof Reflect===_0x3e3c7a(0x170)&&typeof Reflect[_0x3e3c7a(0x172)]===_0x3e3c7a(0x1d6))_0x5564a2=Reflect[_0x3e3c7a(0x172)](_0x583aeb,_0x38980d,_0x358216,_0x2b98d7);else{for(var _0x34624c=_0x583aeb[_0x3e3c7a(0x18e)]-0x1;_0x34624c>=0x0;_0x34624c--)if(_0x1884d5=_0x583aeb[_0x34624c])_0x5564a2=(_0x1fe500<0x3?_0x1884d5(_0x5564a2):_0x1fe500>0x3?_0x1884d5(_0x38980d,_0x358216,_0x5564a2):_0x1884d5(_0x38980d,_0x358216))||_0x5564a2;}return _0x1fe500>0x3&&_0x5564a2&&Object[_0x3e3c7a(0x1b3)](_0x38980d,_0x358216,_0x5564a2),_0x5564a2;},__metadata=this&&this[_0x65f768(0x159)]||function(_0x459a70,_0x5b1eac){const _0x277fc6=_0x65f768;if(typeof Reflect===_0x277fc6(0x170)&&typeof Reflect[_0x277fc6(0x15c)]===_0x277fc6(0x1d6))return Reflect[_0x277fc6(0x15c)](_0x459a70,_0x5b1eac);},__param=this&&this[_0x65f768(0x1b1)]||function(_0x3009bf,_0x1dce38){return function(_0x3c5537,_0x34c7a2){_0x1dce38(_0x3c5537,_0x34c7a2,_0x3009bf);};};function _0x3977(){const _0x33d031=['user','Repository','修改用户信息失败！','1151703HErSRm','getClientIp','globalConfigService','bindWx','saveRealNameInfo','没有变更，无需更改！',']成功!','consecutiveDays','updateStatus','getSuper','save','\x22\x20已存在','push','object','maskIpAddress','decorate','UNAUTHORIZED','userDefautlAvatar','visitor','toUpperCase','role','用户不存在','当前用户信息失效、请重新登录！','configVal','lastLoginIp','design:paramtypes','queryUserInfoById','status','Connection','\x22\x20已被注册','openId','phone','Like','assign','error','getOpenIdByUserId','GlobalConfigService','LOCKED','../mailer/mailer.service','4YVxiPR','createVerification','password','reduce','length','createUserFromContact','1078ERPWgk','registerBaseUrl','verifyUserPassword','createdAt','update','getUserByContact','getOwnPropertyDescriptor','当前绑定用户不存在！','configMap:\x20','恭喜您绑定成功、后续可直接扫码登录了！','createUserFromOpenId','密码重置为[','VerificationService','224snkRKF','DESC','修改用户信息成功！','getUserFromOpenId','addBalanceToUser','用户名或者邮箱已被注册！','尝试发送邮件到:\x20','userEntity','../../common/constants/balance.constant','sign','compareSync','super','./../globalConfig/globalConfig.service','BAD_REQUEST','userBalanceService','balanceInfo','绑定微信失败、请联系管理员！','Not','5404902yFqJsN','queryAll','__param','InjectRepository','defineProperty','当前邮箱已注册、请勿重复注册！','configKey','校验邮箱注册:\x20成功\x20-\x20用户名:\x20','updateUserPhone','toString','findOne','HttpStatus','@nestjs/typeorm','getUserStatus','error:\x20','MailerService','cloneDeep','用户不存在！','addBalanceToNewUser','userId','当前用户不存在！','Logger','createUserAndVerifycation','@default.com','Registration','getUserInfo','queryUserBalanceByIds','2109381ckQFNF','./user.entity','createRandomUid','registerVerifyEmailTitle','userRecharge','当前账户不存在！','@nestjs/common','用户名已存在、请更换用户名！','PENDING','registerIp','修改密码失败、请重新试试吧。','../../common/utils','function','ConfigEntity','BLACKLISTED','verifyUserRegisterByPhone','../userBalance/userBalance.service','123456','校验邮箱注册:\x20开始\x20-\x20用户名:\x20','email','bcryptjs','avatar','find','71883OKFXyk','connection','UserStatusEnum','ADMIN_GIFT','修改用户状态失败！','verificationService','resetUserPass','idCard','./../verification/verification.service','getConfigs','forEach',',\x20邮箱:\x20','savaLoginIp','__decorate','../globalConfig/config.entity','findAndCount','UserEntity','129892sjJCUd','log','4499600ZcPBby','重置密码失败！','您的账户已被封禁、如有疑问、请联系管理员！','registerVerifyEmailFrom','isBindWx','8pSGgrO','HttpException','UserService','affected','verifyUserCredentials','isVerifyEmail','isUsernameTaken','registerVerifyExpir','该微信已绑定其他账号！','slice','getUserOpenId','username','ACTIVE','lodash','hashSync','__metadata','225650PoOhIP','超级管理员不可被操作！','metadata','saveRecordRechargeLog','updateUserStatus','当前密码错误！'];_0x3977=function(){return _0x33d031;};return _0x3977();}Object[_0x65f768(0x1b3)](exports,'__esModule',{'value':!![]}),exports[_0x65f768(0x14c)]=void 0x0;const balance_constant_1=require(_0x65f768(0x1a5)),verification_constant_1=require('../../common/constants/verification.constant'),utils_1=require(_0x65f768(0x1d5)),mailer_service_1=require(_0x65f768(0x189)),common_1=require(_0x65f768(0x1d0)),typeorm_1=require(_0x65f768(0x1bb)),bcrypt=require(_0x65f768(0x1de)),_=require(_0x65f768(0x157)),typeorm_2=require('typeorm'),config_entity_1=require(_0x65f768(0x1ef)),userBalance_service_1=require(_0x65f768(0x1da)),user_constant_1=require('./../../common/constants/user.constant'),globalConfig_service_1=require(_0x65f768(0x1a9)),verification_service_1=require(_0x65f768(0x1e9)),user_entity_1=require(_0x65f768(0x1cb));let UserService=class UserService{constructor(_0x405b34,_0x5bb0e1,_0x171e38,_0x36cd6,_0x445a6,_0xbcfce4,_0x14b14e){const _0x3f4d68=_0x65f768;this[_0x3f4d68(0x1a4)]=_0x405b34,this[_0x3f4d68(0x1e2)]=_0x5bb0e1,this[_0x3f4d68(0x1e6)]=_0x171e38,this['mailerService']=_0x36cd6,this[_0x3f4d68(0x1ab)]=_0x445a6,this[_0x3f4d68(0x165)]=_0xbcfce4,this['configEntity']=_0x14b14e;}async[_0x65f768(0x1c5)](_0x1a38da,_0x4f465a){const _0x9195eb=_0x65f768,{username:_0xb3e536,email:_0x1ab1d0,password:_0x55aad9,client:client=0x0}=_0x1a38da,_0x437a91=[{'username':_0xb3e536},{'email':_0x1ab1d0}],_0x5934f4=await this[_0x9195eb(0x1a4)][_0x9195eb(0x1b9)]({'where':_0x437a91});if(_0x5934f4&&_0x5934f4[_0x9195eb(0x17e)]!==user_constant_1[_0x9195eb(0x1e3)][_0x9195eb(0x1d2)])throw new common_1[(_0x9195eb(0x14b))](_0x9195eb(0x1a2),common_1[_0x9195eb(0x1ba)][_0x9195eb(0x1aa)]);try{const _0x24e180=_[_0x9195eb(0x1bf)](_0x1a38da),_0x4b5e0e=bcrypt['hashSync'](_0x55aad9,0xa),_0x4f948a=(0x0,utils_1[_0x9195eb(0x164)])(_0x4f465a);_0x24e180[_0x9195eb(0x18c)]=_0x4b5e0e,_0x24e180[_0x9195eb(0x1d3)]=_0x4f948a,_0x24e180['client']=client;let _0xcb5bba;if(!_0x5934f4){const _0x35e0b8=await this['globalConfigService'][_0x9195eb(0x1ea)]([_0x9195eb(0x174)]);_0x24e180[_0x9195eb(0x1df)]=_0x35e0b8,_0xcb5bba=await this[_0x9195eb(0x1a4)]['save'](_0x24e180);}else _0xcb5bba=_0x5934f4;const _0x4f7798=await this['configEntity'][_0x9195eb(0x1e0)]({'where':{'configKey':(0x0,typeorm_2['In'])([_0x9195eb(0x14f),_0x9195eb(0x191),_0x9195eb(0x1cd),'registerVerifyEmailDesc',_0x9195eb(0x148),'registerVerifyExpir'])}}),_0x35642a=_0x4f7798[_0x9195eb(0x18d)]((_0x2e738b,_0x11ff5a)=>{const _0x265287=_0x9195eb;return _0x2e738b[_0x11ff5a[_0x265287(0x1b5)]]=_0x11ff5a[_0x265287(0x17a)],_0x2e738b;},{}),_0x1f2e60=_0x35642a[_0x9195eb(0x14f)]?Number(_0x35642a[_0x9195eb(0x14f)]):0x1;if(_0x1f2e60){const _0x445911=_0x35642a['registerVerifyExpir']?Number(_0x35642a[_0x9195eb(0x151)]):0x1e*0x3c,_0x1e683b=await this[_0x9195eb(0x1e6)][_0x9195eb(0x18b)](_0xcb5bba,verification_constant_1['VerificationEnum'][_0x9195eb(0x1c7)],_0x445911),{code:_0x1b9439,email:_0x322142,id:_0x51f1ec}=_0x1e683b,{registerVerifyEmailFrom:_0x3ddb1b}=_0x35642a;console['log'](_0x9195eb(0x198),_0x35642a),console[_0x9195eb(0x144)](_0x9195eb(0x1a3)+_0x322142);}else{const {id:_0x599b0e}=_0xcb5bba;await this['updateUserStatus'](_0x599b0e,user_constant_1[_0x9195eb(0x1e3)][_0x9195eb(0x156)]),await this[_0x9195eb(0x1ab)]['addBalanceToNewUser'](_0x599b0e);}return _0xcb5bba;}catch(_0x4c1636){console['log'](_0x9195eb(0x1bd),_0x4c1636);throw _0x4c1636;}}async[_0x65f768(0x16c)](){const _0x243b90=_0x65f768,_0x543bda=await this[_0x243b90(0x1a4)]['findOne']({'where':{'role':'super'}});return _0x543bda;}async[_0x65f768(0x14e)](_0x30ff1a){const _0x3fba30=_0x65f768,{username:_0x4824de,password:_0xe31a4c,uid:uid=0x0,phone:_0x99e193}=_0x30ff1a;let _0x4f3c09=null;if(uid>0x0){_0x4f3c09=await this[_0x3fba30(0x1a4)]['findOne']({'where':{'id':uid}});if(!_0x4f3c09)throw new common_1[(_0x3fba30(0x14b))](_0x3fba30(0x1cf),common_1[_0x3fba30(0x1ba)][_0x3fba30(0x1aa)]);if(!bcrypt[_0x3fba30(0x1a7)](_0xe31a4c,_0x4f3c09[_0x3fba30(0x18c)]))throw new common_1[(_0x3fba30(0x14b))](_0x3fba30(0x15f),common_1[_0x3fba30(0x1ba)][_0x3fba30(0x1aa)]);}if(_0x4824de&&_0xe31a4c){const _0x14178f=[{'username':_0x4824de},{'email':_0x4824de},{'phone':_0x4824de}];_0x4f3c09=await this[_0x3fba30(0x1a4)][_0x3fba30(0x1b9)]({'where':_0x14178f});if(!_0x4f3c09)throw new common_1[(_0x3fba30(0x14b))](_0x3fba30(0x1cf),common_1['HttpStatus']['BAD_REQUEST']);if(!bcrypt['compareSync'](_0xe31a4c,_0x4f3c09['password']))throw new common_1[(_0x3fba30(0x14b))](_0x3fba30(0x15f),common_1['HttpStatus'][_0x3fba30(0x1aa)]);}if(!_0x4f3c09)throw new common_1[(_0x3fba30(0x14b))]('当前账户不存在！',common_1['HttpStatus'][_0x3fba30(0x1aa)]);if(_0x4f3c09[_0x3fba30(0x17e)]!==user_constant_1[_0x3fba30(0x1e3)][_0x3fba30(0x156)])throw new common_1[(_0x3fba30(0x14b))](user_constant_1['UserStatusErrMsg'][_0x4f3c09['status']],common_1[_0x3fba30(0x1ba)][_0x3fba30(0x1aa)]);return _0x4f3c09;}async[_0x65f768(0x192)](_0x157a20,_0x4858c4){const _0x3a2491=_0x65f768,_0x526c6b=await this[_0x3a2491(0x1a4)][_0x3a2491(0x1b9)]({'where':{'id':_0x157a20}});return bcrypt['compareSync'](_0x4858c4,_0x526c6b[_0x3a2491(0x18c)]);}async[_0x65f768(0x15e)](_0x189965,_0x366e2b){const _0x4bebe6=_0x65f768,_0x2bdc1c=await this['userEntity'][_0x4bebe6(0x194)]({'id':_0x189965},{'status':_0x366e2b});return _0x2bdc1c[_0x4bebe6(0x14d)]>0x0;}async[_0x65f768(0x1bc)](_0x707128){const _0x5b353d=_0x65f768,_0x50b80d=await this[_0x5b353d(0x1a4)][_0x5b353d(0x1b9)]({'where':{'id':_0x707128}});return _0x50b80d['status'];}async[_0x65f768(0x17d)](_0xfeb579){return await this['userEntity']['findOne']({'where':{'id':_0xfeb579}});}async['queryOneUserInfo'](_0x326959){const _0x39cc5f=_0x65f768;return await this[_0x39cc5f(0x1a4)]['findOne']({'where':{'id':_0x326959}});}async['checkUserStatus'](_0x42f21e){const _0x135079=_0x65f768,{id:_0x3e2e36,role:_0x5594cb}=_0x42f21e;if(_0x5594cb===_0x135079(0x175))return!![];const _0x77172e=await this[_0x135079(0x1a4)][_0x135079(0x1b9)]({'where':{'id':_0x3e2e36}});if(!_0x77172e)throw new common_1['HttpException'](_0x135079(0x179),common_1['HttpStatus'][_0x135079(0x173)]);if(_0x77172e['status']===user_constant_1[_0x135079(0x1e3)][_0x135079(0x1d8)])throw new common_1['HttpException']('您的账户已被永久加入黑名单、如有疑问、请联系管理员！',common_1['HttpStatus'][_0x135079(0x1aa)]);if(_0x77172e['status']===user_constant_1[_0x135079(0x1e3)][_0x135079(0x188)])throw new common_1[(_0x135079(0x14b))](_0x135079(0x147),common_1[_0x135079(0x1ba)][_0x135079(0x1aa)]);}async[_0x65f768(0x1c8)](_0x4e109e){const _0x3f1545=_0x65f768,_0x5dd1bc=await this['userEntity'][_0x3f1545(0x1b9)]({'where':{'id':_0x4e109e},'select':['username',_0x3f1545(0x1df),_0x3f1545(0x177),_0x3f1545(0x1dd),_0x3f1545(0x1a6),_0x3f1545(0x181),_0x3f1545(0x16a)]});if(!_0x5dd1bc)throw new common_1[(_0x3f1545(0x14b))](_0x3f1545(0x179),common_1[_0x3f1545(0x1ba)][_0x3f1545(0x173)]);_0x5dd1bc[_0x3f1545(0x149)]=!!(_0x5dd1bc===null||_0x5dd1bc===void 0x0?void 0x0:_0x5dd1bc[_0x3f1545(0x181)]),delete _0x5dd1bc['openId'];const _0x22085c=await this[_0x3f1545(0x1ab)]['queryUserBalance'](_0x4e109e),_0x5357f4=(_0x4e109e*0x7b+0x5f5e100)[_0x3f1545(0x1b8)](0x24)[_0x3f1545(0x176)]()[_0x3f1545(0x153)](-0x6);return _0x5dd1bc['id']=_0x5357f4,{'userInfo':_0x5dd1bc,'userBalance':Object[_0x3f1545(0x184)]({},_0x22085c)};}async['getUserById'](_0x411b2c){const _0x1ab12d=_0x65f768;return await this[_0x1ab12d(0x1a4)][_0x1ab12d(0x1b9)]({'where':{'id':_0x411b2c}});}async[_0x65f768(0x154)](_0x31b637){const _0x2abdfa=_0x65f768;return await this[_0x2abdfa(0x1a4)][_0x2abdfa(0x1b9)]({'where':{'openId':_0x31b637}});}async['updateInfo'](_0x161526,_0x31b7ba){const _0x3976ea=_0x65f768,{id:_0xe77552}=_0x31b7ba['user'],_0x1adf72=await this[_0x3976ea(0x1a4)][_0x3976ea(0x1b9)]({'where':{'id':_0xe77552}});if(!_0x1adf72)throw new common_1[(_0x3976ea(0x14b))](_0x3976ea(0x1c3),common_1[_0x3976ea(0x1ba)]['BAD_REQUEST']);if(_0x161526[_0x3976ea(0x155)]&&_0x1adf72[_0x3976ea(0x155)]===_0x161526[_0x3976ea(0x155)])throw new common_1['HttpException'](_0x3976ea(0x168),common_1[_0x3976ea(0x1ba)][_0x3976ea(0x1aa)]);if(_0x161526[_0x3976ea(0x155)]){const _0x13c3ce=await this[_0x3976ea(0x150)](_0x161526['username'],_0xe77552);if(_0x13c3ce)throw new common_1['HttpException']('用户名已存在！',common_1[_0x3976ea(0x1ba)][_0x3976ea(0x1aa)]);}const _0x2b1a7d=await this[_0x3976ea(0x1a4)][_0x3976ea(0x194)]({'id':_0xe77552},_0x161526);if(_0x2b1a7d[_0x3976ea(0x14d)]<=0x0)throw new common_1['HttpException'](_0x3976ea(0x162),common_1[_0x3976ea(0x1ba)][_0x3976ea(0x1aa)]);return _0x3976ea(0x19f);}async['isUsernameTaken'](_0x3a6138,_0x215cbc){const _0x4e7cd8=_0x65f768,_0x5c08e9={'username':_0x3a6138};_0x215cbc&&(_0x5c08e9['id']=(0x0,typeorm_2[_0x4e7cd8(0x1ae)])(_0x215cbc));const _0x2d0b5f=await this['userEntity'][_0x4e7cd8(0x1b9)]({'where':_0x5c08e9});return!!_0x2d0b5f;}async['updateUserPassword'](_0x415b74,_0x2d9b93){const _0x251fee=_0x65f768,_0x3dffe8=bcrypt[_0x251fee(0x158)](_0x2d9b93,0xa),_0x31fd80=await this[_0x251fee(0x1a4)][_0x251fee(0x194)]({'id':_0x415b74},{'password':_0x3dffe8});if(_0x31fd80[_0x251fee(0x14d)]<=0x0)throw new common_1[(_0x251fee(0x14b))](_0x251fee(0x1d4),common_1[_0x251fee(0x1ba)][_0x251fee(0x1aa)]);}async[_0x65f768(0x1ce)](_0x25d89f){const _0x39726a=_0x65f768,{userId:_0x928557,model3Count:model3Count=0x0,model4Count:model4Count=0x0,drawMjCount:drawMjCount=0x0}=_0x25d89f;await this['userBalanceService'][_0x39726a(0x1a1)](_0x928557,{'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount});const _0x1f4a4f=await this['userBalanceService'][_0x39726a(0x15d)]({'userId':_0x928557,'rechargeType':balance_constant_1['RechargeType'][_0x39726a(0x1e4)],'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount,'extent':''});return _0x1f4a4f;}async[_0x65f768(0x1b0)](_0x15e716,_0x34f311){const _0x2a7bef=_0x65f768,{page:page=0x1,size:size=0xa,username:_0x44576a,email:_0x2ec01e,status:_0x540178,keyword:_0x38cde3,phone:_0x13deb5}=_0x15e716;let _0x116830={};_0x44576a&&Object[_0x2a7bef(0x184)](_0x116830,{'username':(0x0,typeorm_2[_0x2a7bef(0x183)])('%'+_0x44576a+'%')}),_0x2ec01e&&Object[_0x2a7bef(0x184)](_0x116830,{'email':(0x0,typeorm_2[_0x2a7bef(0x183)])('%'+_0x2ec01e+'%')}),_0x13deb5&&Object[_0x2a7bef(0x184)](_0x116830,{'phone':(0x0,typeorm_2['Like'])('%'+_0x13deb5+'%')}),_0x540178&&Object[_0x2a7bef(0x184)](_0x116830,{'status':_0x540178});_0x38cde3&&(_0x116830=[{'username':(0x0,typeorm_2[_0x2a7bef(0x183)])('%'+_0x38cde3+'%')},{'email':(0x0,typeorm_2['Like'])('%'+_0x38cde3+'%')},{'phone':(0x0,typeorm_2[_0x2a7bef(0x183)])('%'+_0x38cde3+'%')}]);const [_0x4e33b7,_0x616838]=await this['userEntity'][_0x2a7bef(0x1f0)]({'skip':(page-0x1)*size,'where':_0x116830,'take':size,'order':{'createdAt':_0x2a7bef(0x19e)},'cache':!![],'select':[_0x2a7bef(0x155),_0x2a7bef(0x1df),_0x2a7bef(0x177),_0x2a7bef(0x1a6),_0x2a7bef(0x17e),'id',_0x2a7bef(0x1dd),_0x2a7bef(0x193),'lastLoginIp',_0x2a7bef(0x182),'realName',_0x2a7bef(0x1e8)]}),_0xf90f29=_0x4e33b7['map'](_0x259fd8=>_0x259fd8['id']),_0x3a8ca2=await this['userBalanceService'][_0x2a7bef(0x1c9)](_0xf90f29);return _0x4e33b7[_0x2a7bef(0x1eb)](_0x13128a=>_0x13128a[_0x2a7bef(0x1ac)]=_0x3a8ca2['find'](_0x46d161=>_0x46d161[_0x2a7bef(0x1c2)]===_0x13128a['id'])),_0x34f311[_0x2a7bef(0x160)][_0x2a7bef(0x177)]!==_0x2a7bef(0x1a8)&&_0x4e33b7['forEach'](_0x24cb3e=>_0x24cb3e['email']=(0x0,utils_1['maskEmail'])(_0x24cb3e[_0x2a7bef(0x1dd)])),_0x34f311[_0x2a7bef(0x160)][_0x2a7bef(0x177)]!==_0x2a7bef(0x1a8)&&_0x4e33b7[_0x2a7bef(0x1eb)](_0x12f3be=>_0x12f3be[_0x2a7bef(0x17b)]=(0x0,utils_1[_0x2a7bef(0x171)])(_0x12f3be['lastLoginIp'])),_0x34f311[_0x2a7bef(0x160)]['role']!==_0x2a7bef(0x1a8)&&_0x4e33b7['forEach'](_0x413461=>_0x413461[_0x2a7bef(0x182)]=(0x0,utils_1['maskIpAddress'])(_0x413461['phone'])),{'rows':_0x4e33b7,'count':_0x616838};}async['queryOne']({id:_0x1ba19e}){const _0x5c7233=_0x65f768;return await this[_0x5c7233(0x1a4)][_0x5c7233(0x1b9)]({'where':{'id':_0x1ba19e},'select':[_0x5c7233(0x155),_0x5c7233(0x1df),_0x5c7233(0x177),_0x5c7233(0x1a6),_0x5c7233(0x17e)]});}async[_0x65f768(0x16b)](_0xa30bb9){const _0x38cc53=_0x65f768,{id:_0x3d9326,status:_0x2f8f3a}=_0xa30bb9,_0x326ac1=await this[_0x38cc53(0x1a4)][_0x38cc53(0x1b9)]({'where':{'id':_0x3d9326}});if(!_0x326ac1)throw new common_1[(_0x38cc53(0x14b))]('用户不存在！',common_1[_0x38cc53(0x1ba)][_0x38cc53(0x1aa)]);if(_0x326ac1[_0x38cc53(0x177)]===_0x38cc53(0x1a8))throw new common_1[(_0x38cc53(0x14b))](_0x38cc53(0x15b),common_1[_0x38cc53(0x1ba)][_0x38cc53(0x1aa)]);if(_0x326ac1[_0x38cc53(0x177)]===_0x38cc53(0x1a8))throw new common_1[(_0x38cc53(0x14b))](_0x38cc53(0x15b),common_1[_0x38cc53(0x1ba)][_0x38cc53(0x1aa)]);const _0xa292fc=await this[_0x38cc53(0x1a4)][_0x38cc53(0x194)]({'id':_0x3d9326},{'status':_0x2f8f3a});if(_0xa292fc[_0x38cc53(0x14d)]<=0x0)throw new common_1[(_0x38cc53(0x14b))](_0x38cc53(0x1e5),common_1[_0x38cc53(0x1ba)][_0x38cc53(0x1aa)]);return'修改用户状态成功！';}async[_0x65f768(0x1e7)](_0x52a369){const _0x3dd41e=_0x65f768,{id:_0xc93dec}=_0x52a369,_0x7a26c4=await this[_0x3dd41e(0x1a4)][_0x3dd41e(0x1b9)]({'where':{'id':_0xc93dec}});if(!_0x7a26c4)throw new common_1[(_0x3dd41e(0x14b))](_0x3dd41e(0x1c0),common_1[_0x3dd41e(0x1ba)][_0x3dd41e(0x1aa)]);const _0x15e5f4=_0x3dd41e(0x1db),_0x48a712=bcrypt['hashSync'](_0x15e5f4,0xa),_0x17df06=await this[_0x3dd41e(0x1a4)][_0x3dd41e(0x194)]({'id':_0xc93dec},{'password':_0x48a712});if(_0x17df06['affected']<=0x0)throw new common_1['HttpException'](_0x3dd41e(0x146),common_1['HttpStatus'][_0x3dd41e(0x1aa)]);return _0x3dd41e(0x19b)+_0x15e5f4+_0x3dd41e(0x169);}async[_0x65f768(0x1ed)](_0x33067b,_0x1abd51){const _0x2100dd=_0x65f768;return await this[_0x2100dd(0x1a4)]['update']({'id':_0x33067b},{'lastLoginIp':_0x1abd51});}async[_0x65f768(0x1a0)](_0x3469d2,_0x5e7ac5){const _0x18ce80=_0x65f768,_0x29d12d=await this['userEntity'][_0x18ce80(0x1b9)]({'where':{'openId':_0x3469d2}});if(!_0x29d12d){const _0x15552b=await this[_0x18ce80(0x19a)](_0x3469d2);return await this[_0x18ce80(0x1ab)][_0x18ce80(0x1c1)](_0x15552b['id']),_0x15552b;}return _0x29d12d;}async['createUserFromOpenId'](_0x45513e){const _0x506e3f=_0x65f768,_0x40b76f=await this['globalConfigService'][_0x506e3f(0x1ea)](['userDefautlAvatar']),_0xe8aab1={'avatar':_0x40b76f,'username':'用户'+(0x0,utils_1[_0x506e3f(0x1cc)])(),'status':user_constant_1[_0x506e3f(0x1e3)][_0x506e3f(0x156)],'sex':0x0,'email':(0x0,utils_1['createRandomUid'])()+_0x506e3f(0x1c6),'openId':_0x45513e},_0x4ee38e=await this['userEntity'][_0x506e3f(0x16d)](_0xe8aab1);return _0x4ee38e;}async[_0x65f768(0x18f)](_0x29443d){const _0x58cfc5=_0x65f768,{username:_0x7679fe,email:_0x3ed046,phone:_0x3417a6}=_0x29443d,_0x38a922=await this['globalConfigService']['getConfigs'](['userDefautlAvatar']),_0xe2f6b9={'avatar':_0x38a922,'username':'用户'+(0x0,utils_1[_0x58cfc5(0x1cc)])(),'status':user_constant_1['UserStatusEnum'][_0x58cfc5(0x156)],'sex':0x0};_0x7679fe&&(_0xe2f6b9['username']=_0x7679fe);_0x3ed046&&(_0xe2f6b9[_0x58cfc5(0x1dd)]=_0x3ed046);_0x3417a6&&(_0xe2f6b9[_0x58cfc5(0x182)]=_0x3417a6);const _0x382a76=await this['userEntity'][_0x58cfc5(0x16d)](_0xe2f6b9);return _0x382a76;}async[_0x65f768(0x195)](_0x2f2ccf){const _0x532b49=_0x65f768,{username:_0x2d7e2b,email:_0xdf0671,phone:_0x45e1c5}=_0x2f2ccf,_0x36e923=[];return _0x2d7e2b&&_0x36e923[_0x532b49(0x16f)]({'username':_0x2d7e2b}),_0xdf0671&&_0x36e923['push']({'email':_0xdf0671}),_0x45e1c5&&_0x36e923[_0x532b49(0x16f)]({'phone':_0x45e1c5}),await this['userEntity'][_0x532b49(0x1b9)]({'where':_0x36e923});}async[_0x65f768(0x166)](_0x25a3c7,_0x4c0b84){const _0x169d6b=_0x65f768;try{const _0x513808=await this[_0x169d6b(0x1a4)][_0x169d6b(0x1b9)]({'where':{'id':_0x4c0b84}});if(!_0x513808)return{'status':![],'msg':_0x169d6b(0x197)};const _0x555b8a=await this['userEntity'][_0x169d6b(0x1b9)]({'where':{'openId':_0x25a3c7}});if(_0x555b8a)return{'status':![],'msg':_0x169d6b(0x152)};const _0x1414a2=await this[_0x169d6b(0x1a4)][_0x169d6b(0x194)]({'id':_0x4c0b84},{'openId':_0x25a3c7});if(_0x1414a2[_0x169d6b(0x14d)]<=0x0)return{'status':![],'msg':_0x169d6b(0x1ad)};return{'status':!![],'msg':_0x169d6b(0x199)};}catch(_0x3016d7){return{'status':![],'msg':_0x169d6b(0x1ad)};}}async[_0x65f768(0x186)](_0x354772){const _0x299222=_0x65f768,_0x5757e=await this[_0x299222(0x1a4)][_0x299222(0x1b9)]({'where':{'id':_0x354772}});return _0x5757e===null||_0x5757e===void 0x0?void 0x0:_0x5757e['openId'];}async['verifyUserRegister'](_0x493398){const _0x1b63b6=_0x65f768,{username:_0x5d8543,phone:_0x428a0b,email:_0x2eea65}=_0x493398;if(_0x428a0b){const _0x1e781d=await this[_0x1b63b6(0x1a4)]['findOne']({'where':{'phone':_0x428a0b}});if(_0x1e781d)return![];}if(_0x2eea65){const _0x26c5a8=await this['userEntity']['findOne']({'where':{'email':_0x2eea65}});if(_0x26c5a8)return![];}if(_0x5d8543){const _0x15f934=await this['userEntity'][_0x1b63b6(0x1b9)]({'where':{'username':_0x5d8543}});if(_0x15f934)return![];}if(!_0x428a0b&&!_0x2eea65&&!_0x5d8543)return![];return!![];}async[_0x65f768(0x1d9)](_0x399077){const _0x23f923=_0x65f768,{username:_0x5fb2f1,password:_0x16393a,phone:_0x5c4d7b,phoneCode:_0x5ed2eb}=_0x399077,_0x3cbd35=await this[_0x23f923(0x1a4)][_0x23f923(0x1b9)]({'where':[{'username':_0x5fb2f1},{'phone':_0x5c4d7b}]});if(_0x3cbd35&&_0x3cbd35[_0x23f923(0x155)]===_0x5fb2f1)throw new common_1['HttpException'](_0x23f923(0x1d1),common_1[_0x23f923(0x1ba)]['BAD_REQUEST']);if(_0x3cbd35&&_0x3cbd35[_0x23f923(0x182)]===_0x5c4d7b)throw new common_1[(_0x23f923(0x14b))]('当前手机号已注册、请勿重复注册！',common_1[_0x23f923(0x1ba)][_0x23f923(0x1aa)]);}async['verifyUserRegisterByEmail'](_0x4c2692){const _0x322efb=_0x65f768,{username:_0x65e23d,email:_0x533458}=_0x4c2692;console['log'](_0x322efb(0x1dc)+_0x65e23d+_0x322efb(0x1ec)+_0x533458);const _0x3de8c4=await this[_0x322efb(0x1a4)][_0x322efb(0x1b9)]({'where':[{'username':_0x65e23d},{'email':_0x533458}]});if(_0x3de8c4&&_0x3de8c4['username']===_0x65e23d){console['error']('校验失败:\x20用户名\x20\x22'+_0x65e23d+_0x322efb(0x16e));throw new common_1[(_0x322efb(0x14b))](_0x322efb(0x1d1),common_1[_0x322efb(0x1ba)]['BAD_REQUEST']);}if(_0x3de8c4&&_0x3de8c4[_0x322efb(0x1dd)]===_0x533458){console['error']('校验失败:\x20邮箱\x20\x22'+_0x533458+_0x322efb(0x180));throw new common_1[(_0x322efb(0x14b))](_0x322efb(0x1b4),common_1[_0x322efb(0x1ba)][_0x322efb(0x1aa)]);}console[_0x322efb(0x144)](_0x322efb(0x1b6)+_0x65e23d+_0x322efb(0x1ec)+_0x533458+'\x20未被占用');}async['createUser'](_0x29430b){const _0x30cdb2=_0x65f768;return await this[_0x30cdb2(0x1a4)][_0x30cdb2(0x16d)](_0x29430b);}async[_0x65f768(0x167)](_0x18d519,_0x12ddad,_0x374393){const _0x4d0664=_0x65f768,_0x19770c=await this[_0x4d0664(0x1a4)][_0x4d0664(0x1b9)]({'where':{'id':_0x18d519}});!_0x19770c&&common_1[_0x4d0664(0x1c4)][_0x4d0664(0x185)](_0x4d0664(0x178));await this[_0x4d0664(0x1a4)][_0x4d0664(0x194)]({'id':_0x18d519},{'realName':_0x12ddad,'idCard':_0x374393});return;}async[_0x65f768(0x1b7)](_0x583b9b,_0x21e270,_0x2f9988,_0x23d889){const _0x4fd295=_0x65f768,_0x255dcb=await this[_0x4fd295(0x1a4)][_0x4fd295(0x1b9)]({'where':{'id':_0x583b9b}}),_0x4462d7=bcrypt['hashSync'](_0x23d889,0xa);!_0x255dcb&&common_1[_0x4fd295(0x1c4)]['error'](_0x4fd295(0x178));if(!_0x21e270||!_0x2f9988||!_0x4462d7)throw new common_1[(_0x4fd295(0x14b))]('参数错误！',common_1[_0x4fd295(0x1ba)][_0x4fd295(0x1aa)]);await this[_0x4fd295(0x1a4)]['update']({'id':_0x583b9b},{'phone':_0x21e270,'username':_0x2f9988,'password':_0x4462d7});return;}};UserService=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,typeorm_1[_0x65f768(0x1b2)])(user_entity_1[_0x65f768(0x1f1)])),__param(0x6,(0x0,typeorm_1['InjectRepository'])(config_entity_1[_0x65f768(0x1d7)])),__metadata(_0x65f768(0x17c),[typeorm_2[_0x65f768(0x161)],typeorm_2[_0x65f768(0x17f)],verification_service_1[_0x65f768(0x19c)],mailer_service_1[_0x65f768(0x1be)],userBalance_service_1['UserBalanceService'],globalConfig_service_1[_0x65f768(0x187)],typeorm_2['Repository']])],UserService),exports[_0x65f768(0x14c)]=UserService;