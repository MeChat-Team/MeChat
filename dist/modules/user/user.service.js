'use strict';function _0x50a2(_0x231361,_0x39e197){const _0x4da208=_0x4da2();return _0x50a2=function(_0x50a28c,_0x5712e3){_0x50a28c=_0x50a28c-0xac;let _0xac69c7=_0x4da208[_0x50a28c];return _0xac69c7;},_0x50a2(_0x231361,_0x39e197);}const _0x594f7b=_0x50a2;(function(_0x146019,_0x13aedd){const _0x3cf38a=_0x50a2,_0xffaa97=_0x146019();while(!![]){try{const _0x4e7fd5=-parseInt(_0x3cf38a(0xac))/0x1+parseInt(_0x3cf38a(0xcd))/0x2+parseInt(_0x3cf38a(0x150))/0x3+parseInt(_0x3cf38a(0xf9))/0x4+parseInt(_0x3cf38a(0x136))/0x5*(parseInt(_0x3cf38a(0x14f))/0x6)+parseInt(_0x3cf38a(0xf5))/0x7+-parseInt(_0x3cf38a(0xf4))/0x8*(parseInt(_0x3cf38a(0x130))/0x9);if(_0x4e7fd5===_0x13aedd)break;else _0xffaa97['push'](_0xffaa97['shift']());}catch(_0x2c21e8){_0xffaa97['push'](_0xffaa97['shift']());}}}(_0x4da2,0xac659));var __decorate=this&&this[_0x594f7b(0xec)]||function(_0x3d9a46,_0x2c6895,_0x35912d,_0x27de53){const _0x2fbd76=_0x594f7b;var _0xa78f21=arguments[_0x2fbd76(0x148)],_0x1a0c32=_0xa78f21<0x3?_0x2c6895:_0x27de53===null?_0x27de53=Object[_0x2fbd76(0xb7)](_0x2c6895,_0x35912d):_0x27de53,_0x4448d7;if(typeof Reflect===_0x2fbd76(0x11a)&&typeof Reflect[_0x2fbd76(0xe2)]===_0x2fbd76(0x125))_0x1a0c32=Reflect[_0x2fbd76(0xe2)](_0x3d9a46,_0x2c6895,_0x35912d,_0x27de53);else{for(var _0x186c70=_0x3d9a46[_0x2fbd76(0x148)]-0x1;_0x186c70>=0x0;_0x186c70--)if(_0x4448d7=_0x3d9a46[_0x186c70])_0x1a0c32=(_0xa78f21<0x3?_0x4448d7(_0x1a0c32):_0xa78f21>0x3?_0x4448d7(_0x2c6895,_0x35912d,_0x1a0c32):_0x4448d7(_0x2c6895,_0x35912d))||_0x1a0c32;}return _0xa78f21>0x3&&_0x1a0c32&&Object[_0x2fbd76(0x10a)](_0x2c6895,_0x35912d,_0x1a0c32),_0x1a0c32;},__metadata=this&&this[_0x594f7b(0x110)]||function(_0x3e9511,_0x4702f9){const _0x598d8b=_0x594f7b;if(typeof Reflect===_0x598d8b(0x11a)&&typeof Reflect[_0x598d8b(0xf0)]==='function')return Reflect['metadata'](_0x3e9511,_0x4702f9);},__param=this&&this[_0x594f7b(0x149)]||function(_0x3274e2,_0x37590f){return function(_0x5a2d94,_0x39ec81){_0x37590f(_0x5a2d94,_0x39ec81,_0x3274e2);};};Object[_0x594f7b(0x10a)](exports,'__esModule',{'value':!![]}),exports[_0x594f7b(0xc5)]=void 0x0;function _0x4da2(){const _0x165c8a=['openId','getUserFromOpenId','verifyUserRegisterByPhone','../../common/constants/balance.constant','./../verification/verification.service','UserService','createUser','当前密码错误！','./../globalConfig/globalConfig.service','updateUserPhone','userEntity','verifyUserCredentials','cloneDeep','2076842RAuSFC','lastLoginIp','idCard','findOne','password','bcryptjs','queryUserBalanceByIds','globalConfigService','当前账户不存在！','isUsernameTaken','校验失败:\x20用户名\x20\x22','InjectRepository','avatar','queryUserBalance','Not','getSuper','toString','当前用户不存在！','ACTIVE','用户不存在！','HttpStatus','decorate','HttpException','用户名或者邮箱已被注册！','@nestjs/typeorm','修改用户信息失败！','修改用户信息成功！','email','reduce','校验失败:\x20邮箱\x20\x22','typeorm','__decorate','当前绑定用户不存在！','isVerifyEmail','用户名已存在、请更换用户名！','metadata','恭喜您绑定成功、后续可直接扫码登录了！','createdAt','slice','1112rewRhA','2424226yBTwxs','当前手机号已注册、请勿重复注册！','username','assign','5589588LfpQMw','verifyUserRegisterByEmail','registerVerifyEmailTitle','123456','Injectable','UserEntity','savaLoginIp','getUserOpenId','configVal','Like','registerVerifyEmailDesc','map','error:\x20','addBalanceToNewUser','重置密码失败！','queryAll','balanceInfo','defineProperty','BAD_REQUEST','save','Registration','BLACKLISTED','Logger','__metadata','userRecharge','../../common/utils','find','updateUserStatus','registerVerifyExpir','maskEmail','密码重置为[','visitor','saveRealNameInfo','object','registerBaseUrl','verifyUserPassword','UserStatusEnum','../userBalance/userBalance.service','./user.entity','userId','@nestjs/common','error','createUserFromOpenId','您的账户已被封禁、如有疑问、请联系管理员！','function','queryOneUserInfo','校验邮箱注册:\x20开始\x20-\x20用户名:\x20','参数错误！',']成功!','Repository','userDefautlAvatar','toUpperCase','用户名已存在！','verificationService','VerificationService','184707tAJkki','affected','maskIpAddress','design:paramtypes','修改密码失败、请重新试试吧。','role','8715gYpesX','PENDING','user','sign','修改用户状态成功！','compareSync','UserBalanceService','client','hashSync','超级管理员不可被操作！','绑定微信失败、请联系管理员！','userBalanceService','getConfigs','您的账户已被永久加入黑名单、如有疑问、请联系管理员！','getOpenIdByUserId','当前用户信息失效、请重新登录！','@default.com','用户不存在','length','__param','../globalConfig/config.entity','没有变更，无需更改！','forEach','phone','DESC','2592miHDTc','3155079aMrUVW','super','configKey','getUserInfo','consecutiveDays','1027971Ofqbfb','mailerService','checkUserStatus','getClientIp','log','bindWx','registerVerifyEmailFrom','update','resetUserPass','ConfigEntity','configEntity','getOwnPropertyDescriptor','GlobalConfigService','MailerService','该微信已绑定其他账号！',',\x20邮箱:\x20','尝试发送邮件到:\x20','\x20未被占用','push','status'];_0x4da2=function(){return _0x165c8a;};return _0x4da2();}const balance_constant_1=require(_0x594f7b(0xc3)),verification_constant_1=require('../../common/constants/verification.constant'),utils_1=require(_0x594f7b(0x112)),mailer_service_1=require('../mailer/mailer.service'),common_1=require(_0x594f7b(0x121)),typeorm_1=require(_0x594f7b(0xe5)),bcrypt=require(_0x594f7b(0xd2)),_=require('lodash'),typeorm_2=require(_0x594f7b(0xeb)),config_entity_1=require(_0x594f7b(0x14a)),userBalance_service_1=require(_0x594f7b(0x11e)),user_constant_1=require('./../../common/constants/user.constant'),globalConfig_service_1=require(_0x594f7b(0xc8)),verification_service_1=require(_0x594f7b(0xc4)),user_entity_1=require(_0x594f7b(0x11f));let UserService=class UserService{constructor(_0x2cbb51,_0x136c33,_0xa9f304,_0x23f29f,_0xd54ea7,_0x8ed734,_0x16832b){const _0x46a656=_0x594f7b;this[_0x46a656(0xca)]=_0x2cbb51,this['connection']=_0x136c33,this[_0x46a656(0x12e)]=_0xa9f304,this[_0x46a656(0xad)]=_0x23f29f,this[_0x46a656(0x141)]=_0xd54ea7,this[_0x46a656(0xd4)]=_0x8ed734,this['configEntity']=_0x16832b;}async['createUserAndVerifycation'](_0x2b2b00,_0x5e642d){const _0x502cb2=_0x594f7b,{username:_0x49658b,email:_0x52404e,password:_0xa6e39c,client:client=0x0}=_0x2b2b00,_0x422b80=[{'username':_0x49658b},{'email':_0x52404e}],_0x111f59=await this[_0x502cb2(0xca)][_0x502cb2(0xd0)]({'where':_0x422b80});if(_0x111f59&&_0x111f59[_0x502cb2(0xbf)]!==user_constant_1[_0x502cb2(0x11d)][_0x502cb2(0x137)])throw new common_1[(_0x502cb2(0xe3))](_0x502cb2(0xe4),common_1[_0x502cb2(0xe1)][_0x502cb2(0x10b)]);try{const _0x330757=_[_0x502cb2(0xcc)](_0x2b2b00),_0x287ddd=bcrypt[_0x502cb2(0x13e)](_0xa6e39c,0xa),_0x1925f6=(0x0,utils_1[_0x502cb2(0xaf)])(_0x5e642d);_0x330757[_0x502cb2(0xd1)]=_0x287ddd,_0x330757['registerIp']=_0x1925f6,_0x330757[_0x502cb2(0x13d)]=client;let _0x2fdafc;if(!_0x111f59){const _0x1d49cd=await this[_0x502cb2(0xd4)][_0x502cb2(0x142)]([_0x502cb2(0x12b)]);_0x330757['avatar']=_0x1d49cd,_0x2fdafc=await this[_0x502cb2(0xca)][_0x502cb2(0x10c)](_0x330757);}else _0x2fdafc=_0x111f59;const _0xb2fbf5=await this[_0x502cb2(0xb6)][_0x502cb2(0x113)]({'where':{'configKey':(0x0,typeorm_2['In'])([_0x502cb2(0xee),_0x502cb2(0x11b),_0x502cb2(0xfb),_0x502cb2(0x103),_0x502cb2(0xb2),_0x502cb2(0x115)])}}),_0x238a79=_0xb2fbf5[_0x502cb2(0xe9)]((_0x17230f,_0x52864a)=>{const _0x8b0d0c=_0x502cb2;return _0x17230f[_0x52864a[_0x8b0d0c(0x152)]]=_0x52864a[_0x8b0d0c(0x101)],_0x17230f;},{}),_0x25152c=_0x238a79[_0x502cb2(0xee)]?Number(_0x238a79[_0x502cb2(0xee)]):0x1;if(_0x25152c){const _0x2cc740=_0x238a79['registerVerifyExpir']?Number(_0x238a79[_0x502cb2(0x115)]):0x1e*0x3c,_0xedd524=await this[_0x502cb2(0x12e)]['createVerification'](_0x2fdafc,verification_constant_1['VerificationEnum'][_0x502cb2(0x10d)],_0x2cc740),{code:_0x2f7a3e,email:_0xaedcc0,id:_0x51d49a}=_0xedd524,{registerVerifyEmailFrom:_0x1dd800}=_0x238a79;console[_0x502cb2(0xb0)]('configMap:\x20',_0x238a79),console[_0x502cb2(0xb0)](_0x502cb2(0xbc)+_0xaedcc0);}else{const {id:_0x4d2428}=_0x2fdafc;await this[_0x502cb2(0x114)](_0x4d2428,user_constant_1[_0x502cb2(0x11d)][_0x502cb2(0xdf)]),await this[_0x502cb2(0x141)][_0x502cb2(0x106)](_0x4d2428);}return _0x2fdafc;}catch(_0x5a0152){console[_0x502cb2(0xb0)](_0x502cb2(0x105),_0x5a0152);throw _0x5a0152;}}async[_0x594f7b(0xdc)](){const _0x5213d9=_0x594f7b,_0x557c33=await this[_0x5213d9(0xca)][_0x5213d9(0xd0)]({'where':{'role':'super'}});return _0x557c33;}async[_0x594f7b(0xcb)](_0xc3ff66){const _0xf62ae2=_0x594f7b,{username:_0x5d3e23,password:_0xd7e512,uid:uid=0x0,phone:_0x133c03}=_0xc3ff66;let _0x118e6b=null;if(uid>0x0){_0x118e6b=await this['userEntity'][_0xf62ae2(0xd0)]({'where':{'id':uid}});if(!_0x118e6b)throw new common_1[(_0xf62ae2(0xe3))](_0xf62ae2(0xd5),common_1[_0xf62ae2(0xe1)][_0xf62ae2(0x10b)]);if(!bcrypt['compareSync'](_0xd7e512,_0x118e6b[_0xf62ae2(0xd1)]))throw new common_1['HttpException'](_0xf62ae2(0xc7),common_1[_0xf62ae2(0xe1)]['BAD_REQUEST']);}if(_0x5d3e23&&_0xd7e512){const _0x56bd43=[{'username':_0x5d3e23},{'email':_0x5d3e23},{'phone':_0x5d3e23}];_0x118e6b=await this['userEntity'][_0xf62ae2(0xd0)]({'where':_0x56bd43});if(!_0x118e6b)throw new common_1[(_0xf62ae2(0xe3))](_0xf62ae2(0xd5),common_1['HttpStatus']['BAD_REQUEST']);if(!bcrypt[_0xf62ae2(0x13b)](_0xd7e512,_0x118e6b[_0xf62ae2(0xd1)]))throw new common_1[(_0xf62ae2(0xe3))]('当前密码错误！',common_1[_0xf62ae2(0xe1)][_0xf62ae2(0x10b)]);}if(!_0x118e6b)throw new common_1['HttpException'](_0xf62ae2(0xd5),common_1[_0xf62ae2(0xe1)]['BAD_REQUEST']);if(_0x118e6b[_0xf62ae2(0xbf)]!==user_constant_1[_0xf62ae2(0x11d)]['ACTIVE'])throw new common_1['HttpException'](user_constant_1['UserStatusErrMsg'][_0x118e6b[_0xf62ae2(0xbf)]],common_1[_0xf62ae2(0xe1)][_0xf62ae2(0x10b)]);return _0x118e6b;}async[_0x594f7b(0x11c)](_0x38aac0,_0x7c936f){const _0x51820e=_0x594f7b,_0x3ba3de=await this[_0x51820e(0xca)]['findOne']({'where':{'id':_0x38aac0}});return bcrypt[_0x51820e(0x13b)](_0x7c936f,_0x3ba3de[_0x51820e(0xd1)]);}async[_0x594f7b(0x114)](_0x4d99c4,_0x51be5a){const _0x1209a4=_0x594f7b,_0x527fcc=await this[_0x1209a4(0xca)]['update']({'id':_0x4d99c4},{'status':_0x51be5a});return _0x527fcc[_0x1209a4(0x131)]>0x0;}async['getUserStatus'](_0x13c2a5){const _0x64785f=_0x594f7b,_0x9f16d4=await this[_0x64785f(0xca)][_0x64785f(0xd0)]({'where':{'id':_0x13c2a5}});return _0x9f16d4[_0x64785f(0xbf)];}async['queryUserInfoById'](_0x4c3d48){const _0x47b3fb=_0x594f7b;return await this[_0x47b3fb(0xca)]['findOne']({'where':{'id':_0x4c3d48}});}async[_0x594f7b(0x126)](_0x9da3e6){const _0x58998a=_0x594f7b;return await this[_0x58998a(0xca)]['findOne']({'where':{'id':_0x9da3e6}});}async[_0x594f7b(0xae)](_0x302298){const _0x190cb7=_0x594f7b,{id:_0x5655b0,role:_0x175a2a}=_0x302298;if(_0x175a2a===_0x190cb7(0x118))return!![];const _0x1005d2=await this[_0x190cb7(0xca)][_0x190cb7(0xd0)]({'where':{'id':_0x5655b0}});if(!_0x1005d2)throw new common_1['HttpException'](_0x190cb7(0x145),common_1[_0x190cb7(0xe1)]['UNAUTHORIZED']);if(_0x1005d2[_0x190cb7(0xbf)]===user_constant_1[_0x190cb7(0x11d)][_0x190cb7(0x10e)])throw new common_1['HttpException'](_0x190cb7(0x143),common_1[_0x190cb7(0xe1)]['BAD_REQUEST']);if(_0x1005d2[_0x190cb7(0xbf)]===user_constant_1['UserStatusEnum']['LOCKED'])throw new common_1[(_0x190cb7(0xe3))](_0x190cb7(0x124),common_1[_0x190cb7(0xe1)][_0x190cb7(0x10b)]);}async[_0x594f7b(0x153)](_0x1b9c0f){const _0x3a7f32=_0x594f7b,_0x255b27=await this[_0x3a7f32(0xca)][_0x3a7f32(0xd0)]({'where':{'id':_0x1b9c0f},'select':[_0x3a7f32(0xf7),_0x3a7f32(0xd9),'role',_0x3a7f32(0xe8),_0x3a7f32(0x139),'openId',_0x3a7f32(0x154)]});if(!_0x255b27)throw new common_1[(_0x3a7f32(0xe3))]('当前用户信息失效、请重新登录！',common_1[_0x3a7f32(0xe1)]['UNAUTHORIZED']);_0x255b27['isBindWx']=!!(_0x255b27===null||_0x255b27===void 0x0?void 0x0:_0x255b27[_0x3a7f32(0xc0)]),delete _0x255b27['openId'];const _0x5de44e=await this[_0x3a7f32(0x141)][_0x3a7f32(0xda)](_0x1b9c0f),_0x173b3c=(_0x1b9c0f*0x7b+0x5f5e100)[_0x3a7f32(0xdd)](0x24)[_0x3a7f32(0x12c)]()[_0x3a7f32(0xf3)](-0x6);return _0x255b27['id']=_0x173b3c,{'userInfo':_0x255b27,'userBalance':Object['assign']({},_0x5de44e)};}async['getUserById'](_0x464490){const _0x529299=_0x594f7b;return await this[_0x529299(0xca)][_0x529299(0xd0)]({'where':{'id':_0x464490}});}async[_0x594f7b(0x100)](_0x43fca6){const _0xcfa3c1=_0x594f7b;return await this[_0xcfa3c1(0xca)][_0xcfa3c1(0xd0)]({'where':{'openId':_0x43fca6}});}async['updateInfo'](_0x4d210d,_0x555a30){const _0x3467a9=_0x594f7b,{id:_0xb92456}=_0x555a30[_0x3467a9(0x138)],_0x24c445=await this[_0x3467a9(0xca)][_0x3467a9(0xd0)]({'where':{'id':_0xb92456}});if(!_0x24c445)throw new common_1['HttpException'](_0x3467a9(0xde),common_1['HttpStatus'][_0x3467a9(0x10b)]);if(_0x4d210d['username']&&_0x24c445['username']===_0x4d210d[_0x3467a9(0xf7)])throw new common_1[(_0x3467a9(0xe3))](_0x3467a9(0x14b),common_1[_0x3467a9(0xe1)]['BAD_REQUEST']);if(_0x4d210d[_0x3467a9(0xf7)]){const _0x475c28=await this[_0x3467a9(0xd6)](_0x4d210d[_0x3467a9(0xf7)],_0xb92456);if(_0x475c28)throw new common_1[(_0x3467a9(0xe3))](_0x3467a9(0x12d),common_1[_0x3467a9(0xe1)][_0x3467a9(0x10b)]);}const _0x5bfeb8=await this[_0x3467a9(0xca)][_0x3467a9(0xb3)]({'id':_0xb92456},_0x4d210d);if(_0x5bfeb8[_0x3467a9(0x131)]<=0x0)throw new common_1[(_0x3467a9(0xe3))](_0x3467a9(0xe6),common_1[_0x3467a9(0xe1)][_0x3467a9(0x10b)]);return _0x3467a9(0xe7);}async[_0x594f7b(0xd6)](_0x2f1b34,_0x58fdc5){const _0x253548=_0x594f7b,_0x1e48d8={'username':_0x2f1b34};_0x58fdc5&&(_0x1e48d8['id']=(0x0,typeorm_2[_0x253548(0xdb)])(_0x58fdc5));const _0x4cbb7c=await this['userEntity']['findOne']({'where':_0x1e48d8});return!!_0x4cbb7c;}async['updateUserPassword'](_0x4bd1d9,_0x213ca9){const _0x4c6bb9=_0x594f7b,_0x309a02=bcrypt['hashSync'](_0x213ca9,0xa),_0x5c30e2=await this[_0x4c6bb9(0xca)]['update']({'id':_0x4bd1d9},{'password':_0x309a02});if(_0x5c30e2[_0x4c6bb9(0x131)]<=0x0)throw new common_1['HttpException'](_0x4c6bb9(0x134),common_1[_0x4c6bb9(0xe1)][_0x4c6bb9(0x10b)]);}async[_0x594f7b(0x111)](_0x469884){const _0x4e3a42=_0x594f7b,{userId:_0x371891,model3Count:model3Count=0x0,model4Count:model4Count=0x0,drawMjCount:drawMjCount=0x0}=_0x469884;await this[_0x4e3a42(0x141)]['addBalanceToUser'](_0x371891,{'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount});const _0x5a9fdd=await this[_0x4e3a42(0x141)]['saveRecordRechargeLog']({'userId':_0x371891,'rechargeType':balance_constant_1['RechargeType']['ADMIN_GIFT'],'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount,'extent':''});return _0x5a9fdd;}async[_0x594f7b(0x108)](_0x550187,_0x4f3fee){const _0x59737a=_0x594f7b,{page:page=0x1,size:size=0xa,username:_0x817a1e,email:_0x125f9f,status:_0x869207,keyword:_0x44f5eb,phone:_0x31a2f5}=_0x550187;let _0x1e6732={};_0x817a1e&&Object['assign'](_0x1e6732,{'username':(0x0,typeorm_2[_0x59737a(0x102)])('%'+_0x817a1e+'%')}),_0x125f9f&&Object[_0x59737a(0xf8)](_0x1e6732,{'email':(0x0,typeorm_2['Like'])('%'+_0x125f9f+'%')}),_0x31a2f5&&Object[_0x59737a(0xf8)](_0x1e6732,{'phone':(0x0,typeorm_2[_0x59737a(0x102)])('%'+_0x31a2f5+'%')}),_0x869207&&Object[_0x59737a(0xf8)](_0x1e6732,{'status':_0x869207});_0x44f5eb&&(_0x1e6732=[{'username':(0x0,typeorm_2[_0x59737a(0x102)])('%'+_0x44f5eb+'%')},{'email':(0x0,typeorm_2['Like'])('%'+_0x44f5eb+'%')},{'phone':(0x0,typeorm_2[_0x59737a(0x102)])('%'+_0x44f5eb+'%')}]);const [_0x23f363,_0x4c8779]=await this[_0x59737a(0xca)]['findAndCount']({'skip':(page-0x1)*size,'where':_0x1e6732,'take':size,'order':{'createdAt':_0x59737a(0x14e)},'cache':!![],'select':[_0x59737a(0xf7),_0x59737a(0xd9),_0x59737a(0x135),_0x59737a(0x139),_0x59737a(0xbf),'id',_0x59737a(0xe8),_0x59737a(0xf2),_0x59737a(0xce),_0x59737a(0x14d),'realName',_0x59737a(0xcf)]}),_0x56c546=_0x23f363[_0x59737a(0x104)](_0x18315a=>_0x18315a['id']),_0x10b6af=await this['userBalanceService'][_0x59737a(0xd3)](_0x56c546);return _0x23f363[_0x59737a(0x14c)](_0x58de7f=>_0x58de7f[_0x59737a(0x109)]=_0x10b6af[_0x59737a(0x113)](_0x1d7feb=>_0x1d7feb[_0x59737a(0x120)]===_0x58de7f['id'])),_0x4f3fee[_0x59737a(0x138)]['role']!==_0x59737a(0x151)&&_0x23f363[_0x59737a(0x14c)](_0x3a1eff=>_0x3a1eff[_0x59737a(0xe8)]=(0x0,utils_1[_0x59737a(0x116)])(_0x3a1eff['email'])),_0x4f3fee[_0x59737a(0x138)][_0x59737a(0x135)]!=='super'&&_0x23f363['forEach'](_0x55ea2d=>_0x55ea2d[_0x59737a(0xce)]=(0x0,utils_1['maskIpAddress'])(_0x55ea2d[_0x59737a(0xce)])),_0x4f3fee['user'][_0x59737a(0x135)]!==_0x59737a(0x151)&&_0x23f363[_0x59737a(0x14c)](_0x1e5328=>_0x1e5328[_0x59737a(0x14d)]=(0x0,utils_1[_0x59737a(0x132)])(_0x1e5328[_0x59737a(0x14d)])),{'rows':_0x23f363,'count':_0x4c8779};}async['queryOne']({id:_0x1c36f2}){const _0x30443c=_0x594f7b;return await this[_0x30443c(0xca)][_0x30443c(0xd0)]({'where':{'id':_0x1c36f2},'select':[_0x30443c(0xf7),_0x30443c(0xd9),_0x30443c(0x135),'sign',_0x30443c(0xbf)]});}async['updateStatus'](_0x69dc41){const _0x22ab78=_0x594f7b,{id:_0x3d0530,status:_0x53581c}=_0x69dc41,_0x20452d=await this[_0x22ab78(0xca)]['findOne']({'where':{'id':_0x3d0530}});if(!_0x20452d)throw new common_1[(_0x22ab78(0xe3))](_0x22ab78(0xe0),common_1[_0x22ab78(0xe1)]['BAD_REQUEST']);if(_0x20452d[_0x22ab78(0x135)]===_0x22ab78(0x151))throw new common_1['HttpException']('超级管理员不可被操作！',common_1[_0x22ab78(0xe1)][_0x22ab78(0x10b)]);if(_0x20452d['role']==='super')throw new common_1['HttpException'](_0x22ab78(0x13f),common_1[_0x22ab78(0xe1)][_0x22ab78(0x10b)]);const _0x969500=await this['userEntity']['update']({'id':_0x3d0530},{'status':_0x53581c});if(_0x969500['affected']<=0x0)throw new common_1['HttpException']('修改用户状态失败！',common_1[_0x22ab78(0xe1)]['BAD_REQUEST']);return _0x22ab78(0x13a);}async[_0x594f7b(0xb4)](_0x726a75){const _0x53e9e7=_0x594f7b,{id:_0x33a48b}=_0x726a75,_0x23184d=await this[_0x53e9e7(0xca)]['findOne']({'where':{'id':_0x33a48b}});if(!_0x23184d)throw new common_1[(_0x53e9e7(0xe3))](_0x53e9e7(0xe0),common_1[_0x53e9e7(0xe1)]['BAD_REQUEST']);const _0x5148b5=_0x53e9e7(0xfc),_0x4fc0a7=bcrypt[_0x53e9e7(0x13e)](_0x5148b5,0xa),_0x254fa0=await this[_0x53e9e7(0xca)][_0x53e9e7(0xb3)]({'id':_0x33a48b},{'password':_0x4fc0a7});if(_0x254fa0['affected']<=0x0)throw new common_1['HttpException'](_0x53e9e7(0x107),common_1[_0x53e9e7(0xe1)][_0x53e9e7(0x10b)]);return _0x53e9e7(0x117)+_0x5148b5+_0x53e9e7(0x129);}async[_0x594f7b(0xff)](_0x330ac3,_0x4b4903){const _0x4bbae3=_0x594f7b;return await this[_0x4bbae3(0xca)][_0x4bbae3(0xb3)]({'id':_0x330ac3},{'lastLoginIp':_0x4b4903});}async[_0x594f7b(0xc1)](_0x5d4e3d,_0x16ffe9){const _0x5afcec=_0x594f7b,_0x5daee6=await this['userEntity'][_0x5afcec(0xd0)]({'where':{'openId':_0x5d4e3d}});if(!_0x5daee6){const _0x4ec9b5=await this[_0x5afcec(0x123)](_0x5d4e3d);return await this['userBalanceService']['addBalanceToNewUser'](_0x4ec9b5['id']),_0x4ec9b5;}return _0x5daee6;}async['createUserFromOpenId'](_0xf282ca){const _0xb1cf86=_0x594f7b,_0xcbc009=await this['globalConfigService'][_0xb1cf86(0x142)](['userDefautlAvatar']),_0x38fc83={'avatar':_0xcbc009,'username':'用户'+(0x0,utils_1['createRandomUid'])(),'status':user_constant_1[_0xb1cf86(0x11d)][_0xb1cf86(0xdf)],'sex':0x0,'email':(0x0,utils_1['createRandomUid'])()+_0xb1cf86(0x146),'openId':_0xf282ca},_0x3435ac=await this[_0xb1cf86(0xca)][_0xb1cf86(0x10c)](_0x38fc83);return _0x3435ac;}async['createUserFromContact'](_0x5ba6bb){const _0x3f7872=_0x594f7b,{username:_0x3b7e82,email:_0x5b9bdf,phone:_0x18c0bd}=_0x5ba6bb,_0x4b6c20=await this[_0x3f7872(0xd4)][_0x3f7872(0x142)]([_0x3f7872(0x12b)]),_0x25d6b0={'avatar':_0x4b6c20,'username':'用户'+(0x0,utils_1['createRandomUid'])(),'status':user_constant_1[_0x3f7872(0x11d)]['ACTIVE'],'sex':0x0};_0x3b7e82&&(_0x25d6b0[_0x3f7872(0xf7)]=_0x3b7e82);_0x5b9bdf&&(_0x25d6b0[_0x3f7872(0xe8)]=_0x5b9bdf);_0x18c0bd&&(_0x25d6b0[_0x3f7872(0x14d)]=_0x18c0bd);const _0x5691ba=await this[_0x3f7872(0xca)]['save'](_0x25d6b0);return _0x5691ba;}async['getUserByContact'](_0x2c64db){const _0x550f08=_0x594f7b,{username:_0x1fd939,email:_0xdb2693,phone:_0x3641ca}=_0x2c64db,_0xf02328=[];return _0x1fd939&&_0xf02328[_0x550f08(0xbe)]({'username':_0x1fd939}),_0xdb2693&&_0xf02328[_0x550f08(0xbe)]({'email':_0xdb2693}),_0x3641ca&&_0xf02328[_0x550f08(0xbe)]({'phone':_0x3641ca}),await this[_0x550f08(0xca)]['findOne']({'where':_0xf02328});}async[_0x594f7b(0xb1)](_0x58289f,_0x22b78b){const _0x40e8f6=_0x594f7b;try{const _0xb21914=await this[_0x40e8f6(0xca)][_0x40e8f6(0xd0)]({'where':{'id':_0x22b78b}});if(!_0xb21914)return{'status':![],'msg':_0x40e8f6(0xed)};const _0xd7379f=await this[_0x40e8f6(0xca)][_0x40e8f6(0xd0)]({'where':{'openId':_0x58289f}});if(_0xd7379f)return{'status':![],'msg':_0x40e8f6(0xba)};const _0x2c1e06=await this[_0x40e8f6(0xca)]['update']({'id':_0x22b78b},{'openId':_0x58289f});if(_0x2c1e06[_0x40e8f6(0x131)]<=0x0)return{'status':![],'msg':_0x40e8f6(0x140)};return{'status':!![],'msg':_0x40e8f6(0xf1)};}catch(_0x222b1b){return{'status':![],'msg':_0x40e8f6(0x140)};}}async[_0x594f7b(0x144)](_0x3a42e0){const _0x4c1bc8=_0x594f7b,_0x5abe23=await this['userEntity'][_0x4c1bc8(0xd0)]({'where':{'id':_0x3a42e0}});return _0x5abe23===null||_0x5abe23===void 0x0?void 0x0:_0x5abe23[_0x4c1bc8(0xc0)];}async['verifyUserRegister'](_0x4134ae){const _0x56c1c0=_0x594f7b,{username:_0x1ff857,phone:_0x428149,email:_0x34b854}=_0x4134ae;if(_0x428149){const _0x26c0d1=await this['userEntity'][_0x56c1c0(0xd0)]({'where':{'phone':_0x428149}});if(_0x26c0d1)return![];}if(_0x34b854){const _0x362a20=await this[_0x56c1c0(0xca)][_0x56c1c0(0xd0)]({'where':{'email':_0x34b854}});if(_0x362a20)return![];}if(_0x1ff857){const _0x373a91=await this[_0x56c1c0(0xca)]['findOne']({'where':{'username':_0x1ff857}});if(_0x373a91)return![];}if(!_0x428149&&!_0x34b854&&!_0x1ff857)return![];return!![];}async[_0x594f7b(0xc2)](_0x40ea52){const _0x5556b1=_0x594f7b,{username:_0x1c744b,password:_0x4e4983,phone:_0xd782be,phoneCode:_0x48f202}=_0x40ea52,_0x200437=await this[_0x5556b1(0xca)]['findOne']({'where':[{'username':_0x1c744b},{'phone':_0xd782be}]});if(_0x200437&&_0x200437[_0x5556b1(0xf7)]===_0x1c744b)throw new common_1[(_0x5556b1(0xe3))](_0x5556b1(0xef),common_1[_0x5556b1(0xe1)][_0x5556b1(0x10b)]);if(_0x200437&&_0x200437['phone']===_0xd782be)throw new common_1['HttpException'](_0x5556b1(0xf6),common_1[_0x5556b1(0xe1)]['BAD_REQUEST']);}async[_0x594f7b(0xfa)](_0x159e46){const _0x10136e=_0x594f7b,{username:_0x1d9013,email:_0x37ceaa}=_0x159e46;console[_0x10136e(0xb0)](_0x10136e(0x127)+_0x1d9013+',\x20邮箱:\x20'+_0x37ceaa);const _0x599ff8=await this[_0x10136e(0xca)][_0x10136e(0xd0)]({'where':[{'username':_0x1d9013},{'email':_0x37ceaa}]});if(_0x599ff8&&_0x599ff8[_0x10136e(0xf7)]===_0x1d9013){console[_0x10136e(0x122)](_0x10136e(0xd7)+_0x1d9013+'\x22\x20已存在');throw new common_1[(_0x10136e(0xe3))](_0x10136e(0xef),common_1[_0x10136e(0xe1)][_0x10136e(0x10b)]);}if(_0x599ff8&&_0x599ff8[_0x10136e(0xe8)]===_0x37ceaa){console[_0x10136e(0x122)](_0x10136e(0xea)+_0x37ceaa+'\x22\x20已被注册');throw new common_1[(_0x10136e(0xe3))]('当前邮箱已注册、请勿重复注册！',common_1[_0x10136e(0xe1)][_0x10136e(0x10b)]);}console['log']('校验邮箱注册:\x20成功\x20-\x20用户名:\x20'+_0x1d9013+_0x10136e(0xbb)+_0x37ceaa+_0x10136e(0xbd));}async[_0x594f7b(0xc6)](_0x4a2cc2){const _0x2a579e=_0x594f7b;return await this[_0x2a579e(0xca)]['save'](_0x4a2cc2);}async[_0x594f7b(0x119)](_0x52c096,_0x26cbe4,_0x577f6d){const _0x53fe6a=_0x594f7b,_0x3a6ead=await this['userEntity']['findOne']({'where':{'id':_0x52c096}});!_0x3a6ead&&common_1['Logger'][_0x53fe6a(0x122)](_0x53fe6a(0x147));await this[_0x53fe6a(0xca)][_0x53fe6a(0xb3)]({'id':_0x52c096},{'realName':_0x26cbe4,'idCard':_0x577f6d});return;}async[_0x594f7b(0xc9)](_0xfb5d54,_0x4166da,_0x4c5b2b,_0xe96dbf){const _0xf346a8=_0x594f7b,_0x4c8ab7=await this[_0xf346a8(0xca)]['findOne']({'where':{'id':_0xfb5d54}}),_0x2f8c57=bcrypt[_0xf346a8(0x13e)](_0xe96dbf,0xa);!_0x4c8ab7&&common_1[_0xf346a8(0x10f)][_0xf346a8(0x122)](_0xf346a8(0x147));if(!_0x4166da||!_0x4c5b2b||!_0x2f8c57)throw new common_1[(_0xf346a8(0xe3))](_0xf346a8(0x128),common_1['HttpStatus'][_0xf346a8(0x10b)]);await this['userEntity'][_0xf346a8(0xb3)]({'id':_0xfb5d54},{'phone':_0x4166da,'username':_0x4c5b2b,'password':_0x2f8c57});return;}};UserService=__decorate([(0x0,common_1[_0x594f7b(0xfd)])(),__param(0x0,(0x0,typeorm_1[_0x594f7b(0xd8)])(user_entity_1[_0x594f7b(0xfe)])),__param(0x6,(0x0,typeorm_1[_0x594f7b(0xd8)])(config_entity_1[_0x594f7b(0xb5)])),__metadata(_0x594f7b(0x133),[typeorm_2[_0x594f7b(0x12a)],typeorm_2['Connection'],verification_service_1[_0x594f7b(0x12f)],mailer_service_1[_0x594f7b(0xb9)],userBalance_service_1[_0x594f7b(0x13c)],globalConfig_service_1[_0x594f7b(0xb8)],typeorm_2[_0x594f7b(0x12a)]])],UserService),exports[_0x594f7b(0xc5)]=UserService;