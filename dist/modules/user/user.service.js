'use strict';const _0x3e12b1=_0xb935;(function(_0x246f33,_0x4599ba){const _0x32bd78=_0xb935,_0x1b2be4=_0x246f33();while(!![]){try{const _0x5e56d5=-parseInt(_0x32bd78(0x1f4))/0x1+-parseInt(_0x32bd78(0x1b9))/0x2*(parseInt(_0x32bd78(0x1fe))/0x3)+parseInt(_0x32bd78(0x1c4))/0x4+parseInt(_0x32bd78(0x1e3))/0x5*(-parseInt(_0x32bd78(0x219))/0x6)+-parseInt(_0x32bd78(0x217))/0x7+-parseInt(_0x32bd78(0x1f6))/0x8+parseInt(_0x32bd78(0x20f))/0x9;if(_0x5e56d5===_0x4599ba)break;else _0x1b2be4['push'](_0x1b2be4['shift']());}catch(_0x3ae198){_0x1b2be4['push'](_0x1b2be4['shift']());}}}(_0x59db,0xc5ef7));function _0xb935(_0x2c0836,_0x23d5b4){const _0x59db35=_0x59db();return _0xb935=function(_0x4bd552,_0x17ce16){_0x4bd552=_0x4bd552-0x186;let _0x3a0653=_0x59db35[_0x4bd552];return _0x3a0653;},_0xb935(_0x2c0836,_0x23d5b4);}function _0x59db(){const _0x14519b=['configMap:\x20','userBalanceService','consecutiveDays','__decorate','queryOneUserInfo','avatar','\x22\x20已存在','isUsernameTaken','push','role','RechargeType','forEach','userId','getUserById','当前绑定用户不存在！','openId','metadata','UserService','当前密码错误！','reduce','Injectable','updateUserStatus','当前邮箱已注册、请勿重复注册！','@default.com','InjectRepository','registerBaseUrl','verifyUserRegisterByPhone','Logger','getOwnPropertyDescriptor',']成功!','update','function','getUserInfo','UserStatusEnum','VerificationService','ConfigEntity','当前用户信息失效、请重新登录！','createUserAndVerifycation','verifyUserPassword','connection','client','save','updateUserPhone','UserStatusErrMsg','Registration','40564uCBfRA','createUser','error:\x20',',\x20邮箱:\x20','Repository','super','maskEmail','getOpenIdByUserId','修改密码失败、请重新试试吧。','saveRealNameInfo','DESC','641284PodNVZ','registerVerifyEmailTitle','./../verification/verification.service','尝试发送邮件到:\x20','校验失败:\x20用户名\x20\x22','decorate','密码重置为[','@nestjs/typeorm','queryAll','length','该微信已绑定其他账号！','registerVerifyEmailDesc','log','__metadata','findAndCount','createRandomUid','email','Connection','queryUserBalanceByIds','balanceInfo','maskIpAddress','lodash','当前用户不存在！','registerVerifyExpir','用户不存在！','VerificationEnum','GlobalConfigService','queryUserBalance','createUserFromOpenId','userDefautlAvatar','\x22\x20已被注册','10470Xmuipj','bindWx','password','configEntity','cloneDeep','__esModule','assign','affected','getUserFromOpenId','校验邮箱注册:\x20成功\x20-\x20用户名:\x20','isVerifyEmail','registerVerifyEmailFrom','defineProperty','UNAUTHORIZED','重置密码失败！','compareSync','校验失败:\x20邮箱\x20\x22','1224379SxGiJL','status','9547112BrJEOO','../../common/constants/verification.constant','verifyUserRegisterByEmail','PENDING','userEntity','ACTIVE','超级管理员不可被操作！','registerIp','231vpQfCi','saveRecordRechargeLog','updateUserPassword','sign','./../../common/constants/user.constant','idCard','用户名或者邮箱已被注册！','当前账户不存在！','toString','修改用户状态失败！','参数错误！','LOCKED','getSuper','findOne','\x20未被占用','HttpStatus','visitor','43501878xcBeWM','verificationService','user','Like','123456','用户名已存在、请更换用户名！','resetUserPass','用户不存在','971068SypBfO','updateInfo','186FYFdEY','校验邮箱注册:\x20开始\x20-\x20用户名:\x20','getUserOpenId','createVerification','UserBalanceService','HttpException','phone','绑定微信失败、请联系管理员！','username','isBindWx','BLACKLISTED','verifyUserRegister','BAD_REQUEST','../../common/utils','MailerService','slice','object','createUserFromContact','createdAt','hashSync','getConfigs','addBalanceToNewUser','userRecharge','lastLoginIp','修改用户状态成功！','../../common/constants/balance.constant','addBalanceToUser','UserEntity','design:paramtypes','queryUserInfoById','globalConfigService','修改用户信息失败！','typeorm','getUserStatus','error'];_0x59db=function(){return _0x14519b;};return _0x59db();}var __decorate=this&&this[_0x3e12b1(0x18f)]||function(_0x4e15b6,_0x4da689,_0x452990,_0x2ad334){const _0x178201=_0x3e12b1;var _0x57c441=arguments['length'],_0x17f822=_0x57c441<0x3?_0x4da689:_0x2ad334===null?_0x2ad334=Object[_0x178201(0x1a8)](_0x4da689,_0x452990):_0x2ad334,_0x1f093;if(typeof Reflect===_0x178201(0x229)&&typeof Reflect[_0x178201(0x1c9)]===_0x178201(0x1ab))_0x17f822=Reflect[_0x178201(0x1c9)](_0x4e15b6,_0x4da689,_0x452990,_0x2ad334);else{for(var _0x2088a2=_0x4e15b6[_0x178201(0x1cd)]-0x1;_0x2088a2>=0x0;_0x2088a2--)if(_0x1f093=_0x4e15b6[_0x2088a2])_0x17f822=(_0x57c441<0x3?_0x1f093(_0x17f822):_0x57c441>0x3?_0x1f093(_0x4da689,_0x452990,_0x17f822):_0x1f093(_0x4da689,_0x452990))||_0x17f822;}return _0x57c441>0x3&&_0x17f822&&Object[_0x178201(0x1ef)](_0x4da689,_0x452990,_0x17f822),_0x17f822;},__metadata=this&&this[_0x3e12b1(0x1d1)]||function(_0x4e77e4,_0x55d96f){const _0x379297=_0x3e12b1;if(typeof Reflect==='object'&&typeof Reflect['metadata']===_0x379297(0x1ab))return Reflect[_0x379297(0x19c)](_0x4e77e4,_0x55d96f);},__param=this&&this['__param']||function(_0x14655c,_0x4d9939){return function(_0x2c09f1,_0x343d9b){_0x4d9939(_0x2c09f1,_0x343d9b,_0x14655c);};};Object[_0x3e12b1(0x1ef)](exports,_0x3e12b1(0x1e8),{'value':!![]}),exports[_0x3e12b1(0x19d)]=void 0x0;const balance_constant_1=require(_0x3e12b1(0x232)),verification_constant_1=require(_0x3e12b1(0x1f7)),utils_1=require(_0x3e12b1(0x226)),mailer_service_1=require('../mailer/mailer.service'),common_1=require('@nestjs/common'),typeorm_1=require(_0x3e12b1(0x1cb)),bcrypt=require('bcryptjs'),_=require(_0x3e12b1(0x1d9)),typeorm_2=require(_0x3e12b1(0x189)),config_entity_1=require('../globalConfig/config.entity'),userBalance_service_1=require('../userBalance/userBalance.service'),user_constant_1=require(_0x3e12b1(0x202)),globalConfig_service_1=require('./../globalConfig/globalConfig.service'),verification_service_1=require(_0x3e12b1(0x1c6)),user_entity_1=require('./user.entity');let UserService=class UserService{constructor(_0x2a4d07,_0x1d481f,_0x43aad3,_0x3998db,_0x57e8f7,_0x3b198f,_0x32b248){const _0x37048c=_0x3e12b1;this[_0x37048c(0x1fa)]=_0x2a4d07,this[_0x37048c(0x1b3)]=_0x1d481f,this[_0x37048c(0x210)]=_0x43aad3,this['mailerService']=_0x3998db,this[_0x37048c(0x18d)]=_0x57e8f7,this['globalConfigService']=_0x3b198f,this['configEntity']=_0x32b248;}async[_0x3e12b1(0x1b1)](_0x354d9a,_0x2a6bb7){const _0x2ac9d0=_0x3e12b1,{username:_0x4e8cc0,email:_0x4834e3,password:_0x466499,client:client=0x0}=_0x354d9a,_0x4c59e9=[{'username':_0x4e8cc0},{'email':_0x4834e3}],_0x196f5e=await this[_0x2ac9d0(0x1fa)][_0x2ac9d0(0x20b)]({'where':_0x4c59e9});if(_0x196f5e&&_0x196f5e[_0x2ac9d0(0x1f5)]!==user_constant_1[_0x2ac9d0(0x1ad)][_0x2ac9d0(0x1f9)])throw new common_1[(_0x2ac9d0(0x21e))](_0x2ac9d0(0x204),common_1[_0x2ac9d0(0x20d)][_0x2ac9d0(0x225)]);try{const _0x54fbf2=_[_0x2ac9d0(0x1e7)](_0x354d9a),_0x1a345e=bcrypt[_0x2ac9d0(0x22c)](_0x466499,0xa),_0x39adad=(0x0,utils_1['getClientIp'])(_0x2a6bb7);_0x54fbf2[_0x2ac9d0(0x1e5)]=_0x1a345e,_0x54fbf2[_0x2ac9d0(0x1fd)]=_0x39adad,_0x54fbf2[_0x2ac9d0(0x1b4)]=client;let _0x2f8cb3;if(!_0x196f5e){const _0x2afb02=await this[_0x2ac9d0(0x187)][_0x2ac9d0(0x22d)]([_0x2ac9d0(0x1e1)]);_0x54fbf2[_0x2ac9d0(0x191)]=_0x2afb02,_0x2f8cb3=await this[_0x2ac9d0(0x1fa)]['save'](_0x54fbf2);}else _0x2f8cb3=_0x196f5e;const _0x2a215a=await this[_0x2ac9d0(0x1e6)]['find']({'where':{'configKey':(0x0,typeorm_2['In'])([_0x2ac9d0(0x1ed),_0x2ac9d0(0x1a5),_0x2ac9d0(0x1c5),_0x2ac9d0(0x1cf),_0x2ac9d0(0x1ee),_0x2ac9d0(0x1db)])}}),_0x1acb26=_0x2a215a[_0x2ac9d0(0x19f)]((_0x5ef1ae,_0xb8900c)=>{return _0x5ef1ae[_0xb8900c['configKey']]=_0xb8900c['configVal'],_0x5ef1ae;},{}),_0x5d64f7=_0x1acb26[_0x2ac9d0(0x1ed)]?Number(_0x1acb26['isVerifyEmail']):0x1;if(_0x5d64f7){const _0x20f651=_0x1acb26['registerVerifyExpir']?Number(_0x1acb26['registerVerifyExpir']):0x1e*0x3c,_0x1a0a9b=await this[_0x2ac9d0(0x210)][_0x2ac9d0(0x21c)](_0x2f8cb3,verification_constant_1[_0x2ac9d0(0x1dd)][_0x2ac9d0(0x1b8)],_0x20f651),{code:_0x378a02,email:_0x4ec351,id:_0xea0561}=_0x1a0a9b,{registerVerifyEmailFrom:_0x3d23db}=_0x1acb26;console[_0x2ac9d0(0x1d0)](_0x2ac9d0(0x18c),_0x1acb26),console['log'](_0x2ac9d0(0x1c7)+_0x4ec351);}else{const {id:_0x1a575c}=_0x2f8cb3;await this[_0x2ac9d0(0x1a1)](_0x1a575c,user_constant_1[_0x2ac9d0(0x1ad)][_0x2ac9d0(0x1fb)]),await this[_0x2ac9d0(0x18d)][_0x2ac9d0(0x22e)](_0x1a575c);}return _0x2f8cb3;}catch(_0x30b16f){console['log'](_0x2ac9d0(0x1bb),_0x30b16f);throw _0x30b16f;}}async[_0x3e12b1(0x20a)](){const _0x58086a=_0x3e12b1,_0x1be9db=await this['userEntity'][_0x58086a(0x20b)]({'where':{'role':_0x58086a(0x1be)}});return _0x1be9db;}async['verifyUserCredentials'](_0x46306d){const _0x1b3699=_0x3e12b1,{username:_0x18eeaa,password:_0x104c8b,uid:uid=0x0,phone:_0x91c728}=_0x46306d;let _0x34f507=null;if(uid>0x0){_0x34f507=await this[_0x1b3699(0x1fa)]['findOne']({'where':{'id':uid}});if(!_0x34f507)throw new common_1[(_0x1b3699(0x21e))]('当前账户不存在！',common_1[_0x1b3699(0x20d)][_0x1b3699(0x225)]);if(!bcrypt[_0x1b3699(0x1f2)](_0x104c8b,_0x34f507['password']))throw new common_1[(_0x1b3699(0x21e))](_0x1b3699(0x19e),common_1[_0x1b3699(0x20d)]['BAD_REQUEST']);}if(_0x18eeaa&&_0x104c8b){const _0x46690a=[{'username':_0x18eeaa},{'email':_0x18eeaa},{'phone':_0x18eeaa}];_0x34f507=await this[_0x1b3699(0x1fa)][_0x1b3699(0x20b)]({'where':_0x46690a});if(!_0x34f507)throw new common_1['HttpException'](_0x1b3699(0x205),common_1[_0x1b3699(0x20d)][_0x1b3699(0x225)]);if(!bcrypt['compareSync'](_0x104c8b,_0x34f507['password']))throw new common_1[(_0x1b3699(0x21e))](_0x1b3699(0x19e),common_1[_0x1b3699(0x20d)][_0x1b3699(0x225)]);}if(!_0x34f507)throw new common_1[(_0x1b3699(0x21e))](_0x1b3699(0x205),common_1[_0x1b3699(0x20d)][_0x1b3699(0x225)]);if(_0x34f507[_0x1b3699(0x1f5)]!==user_constant_1['UserStatusEnum']['ACTIVE'])throw new common_1[(_0x1b3699(0x21e))](user_constant_1[_0x1b3699(0x1b7)][_0x34f507['status']],common_1[_0x1b3699(0x20d)][_0x1b3699(0x225)]);return _0x34f507;}async[_0x3e12b1(0x1b2)](_0x25a830,_0x2e9c6c){const _0x777a58=_0x3e12b1,_0x420192=await this[_0x777a58(0x1fa)][_0x777a58(0x20b)]({'where':{'id':_0x25a830}});return bcrypt[_0x777a58(0x1f2)](_0x2e9c6c,_0x420192[_0x777a58(0x1e5)]);}async['updateUserStatus'](_0x4d3766,_0x43569a){const _0x58771f=_0x3e12b1,_0x5206cd=await this[_0x58771f(0x1fa)][_0x58771f(0x1aa)]({'id':_0x4d3766},{'status':_0x43569a});return _0x5206cd[_0x58771f(0x1ea)]>0x0;}async[_0x3e12b1(0x18a)](_0x26e2d4){const _0x1eca6f=_0x3e12b1,_0x194ad5=await this[_0x1eca6f(0x1fa)][_0x1eca6f(0x20b)]({'where':{'id':_0x26e2d4}});return _0x194ad5[_0x1eca6f(0x1f5)];}async[_0x3e12b1(0x186)](_0x875cd9){const _0x456653=_0x3e12b1;return await this[_0x456653(0x1fa)]['findOne']({'where':{'id':_0x875cd9}});}async[_0x3e12b1(0x190)](_0x10b2fe){const _0x199e82=_0x3e12b1;return await this[_0x199e82(0x1fa)][_0x199e82(0x20b)]({'where':{'id':_0x10b2fe}});}async['checkUserStatus'](_0x48300d){const _0x538e90=_0x3e12b1,{id:_0x2fc8d6,role:_0x4c8a1e}=_0x48300d;if(_0x4c8a1e===_0x538e90(0x20e))return!![];const _0x32c700=await this['userEntity'][_0x538e90(0x20b)]({'where':{'id':_0x2fc8d6}});if(!_0x32c700)throw new common_1[(_0x538e90(0x21e))](_0x538e90(0x1b0),common_1[_0x538e90(0x20d)]['UNAUTHORIZED']);if(_0x32c700['status']===user_constant_1[_0x538e90(0x1ad)][_0x538e90(0x223)])throw new common_1[(_0x538e90(0x21e))]('您的账户已被永久加入黑名单、如有疑问、请联系管理员！',common_1[_0x538e90(0x20d)]['BAD_REQUEST']);if(_0x32c700[_0x538e90(0x1f5)]===user_constant_1['UserStatusEnum'][_0x538e90(0x209)])throw new common_1[(_0x538e90(0x21e))]('您的账户已被封禁、如有疑问、请联系管理员！',common_1[_0x538e90(0x20d)][_0x538e90(0x225)]);}async[_0x3e12b1(0x1ac)](_0x2de9bb){const _0x163a07=_0x3e12b1,_0x17ea11=await this['userEntity'][_0x163a07(0x20b)]({'where':{'id':_0x2de9bb},'select':[_0x163a07(0x221),_0x163a07(0x191),'role',_0x163a07(0x1d4),_0x163a07(0x201),'openId',_0x163a07(0x18e)]});if(!_0x17ea11)throw new common_1[(_0x163a07(0x21e))](_0x163a07(0x1b0),common_1['HttpStatus'][_0x163a07(0x1f0)]);_0x17ea11[_0x163a07(0x222)]=!!(_0x17ea11===null||_0x17ea11===void 0x0?void 0x0:_0x17ea11['openId']),delete _0x17ea11[_0x163a07(0x19b)];const _0x2abe27=await this[_0x163a07(0x18d)][_0x163a07(0x1df)](_0x2de9bb),_0x206b04=(_0x2de9bb*0x7b+0x5f5e100)[_0x163a07(0x206)](0x24)['toUpperCase']()[_0x163a07(0x228)](-0x6);return _0x17ea11['id']=_0x206b04,{'userInfo':_0x17ea11,'userBalance':Object[_0x163a07(0x1e9)]({},_0x2abe27)};}async[_0x3e12b1(0x199)](_0x1f4242){const _0x19d489=_0x3e12b1;return await this[_0x19d489(0x1fa)][_0x19d489(0x20b)]({'where':{'id':_0x1f4242}});}async[_0x3e12b1(0x21b)](_0x43db4c){const _0x2a71fb=_0x3e12b1;return await this[_0x2a71fb(0x1fa)]['findOne']({'where':{'openId':_0x43db4c}});}async[_0x3e12b1(0x218)](_0x5d61e6,_0x271107){const _0x498a0e=_0x3e12b1,{id:_0x1f5e52}=_0x271107[_0x498a0e(0x211)],_0x3d769a=await this['userEntity']['findOne']({'where':{'id':_0x1f5e52}});if(!_0x3d769a)throw new common_1[(_0x498a0e(0x21e))](_0x498a0e(0x1da),common_1['HttpStatus'][_0x498a0e(0x225)]);if(_0x5d61e6['username']&&_0x3d769a[_0x498a0e(0x221)]===_0x5d61e6[_0x498a0e(0x221)])throw new common_1[(_0x498a0e(0x21e))]('没有变更，无需更改！',common_1[_0x498a0e(0x20d)][_0x498a0e(0x225)]);if(_0x5d61e6[_0x498a0e(0x221)]){const _0x3103a6=await this['isUsernameTaken'](_0x5d61e6[_0x498a0e(0x221)],_0x1f5e52);if(_0x3103a6)throw new common_1[(_0x498a0e(0x21e))]('用户名已存在！',common_1[_0x498a0e(0x20d)][_0x498a0e(0x225)]);}const _0x300fe3=await this[_0x498a0e(0x1fa)]['update']({'id':_0x1f5e52},_0x5d61e6);if(_0x300fe3[_0x498a0e(0x1ea)]<=0x0)throw new common_1[(_0x498a0e(0x21e))](_0x498a0e(0x188),common_1[_0x498a0e(0x20d)]['BAD_REQUEST']);return'修改用户信息成功！';}async[_0x3e12b1(0x193)](_0x593b41,_0x359a36){const _0x1e2d47=_0x3e12b1,_0x2246ed={'username':_0x593b41};_0x359a36&&(_0x2246ed['id']=(0x0,typeorm_2['Not'])(_0x359a36));const _0x44e4af=await this[_0x1e2d47(0x1fa)][_0x1e2d47(0x20b)]({'where':_0x2246ed});return!!_0x44e4af;}async[_0x3e12b1(0x200)](_0x15de0c,_0x2a3fca){const _0x2d091e=_0x3e12b1,_0x40f6c5=bcrypt['hashSync'](_0x2a3fca,0xa),_0x56da84=await this[_0x2d091e(0x1fa)][_0x2d091e(0x1aa)]({'id':_0x15de0c},{'password':_0x40f6c5});if(_0x56da84[_0x2d091e(0x1ea)]<=0x0)throw new common_1['HttpException'](_0x2d091e(0x1c1),common_1[_0x2d091e(0x20d)][_0x2d091e(0x225)]);}async[_0x3e12b1(0x22f)](_0x59ed93){const _0x5a7bff=_0x3e12b1,{userId:_0x5acf2a,model3Count:model3Count=0x0,model4Count:model4Count=0x0,drawMjCount:drawMjCount=0x0}=_0x59ed93;await this[_0x5a7bff(0x18d)][_0x5a7bff(0x233)](_0x5acf2a,{'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount});const _0x43d7dc=await this[_0x5a7bff(0x18d)][_0x5a7bff(0x1ff)]({'userId':_0x5acf2a,'rechargeType':balance_constant_1[_0x5a7bff(0x196)]['ADMIN_GIFT'],'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount,'extent':''});return _0x43d7dc;}async[_0x3e12b1(0x1cc)](_0x52d672,_0x3b835e){const _0x52107c=_0x3e12b1,{page:page=0x1,size:size=0xa,username:_0x814726,email:_0x5b9b09,status:_0x9762ed,keyword:_0x1daa56,phone:_0x2717d0}=_0x52d672;let _0x4940fa={};_0x814726&&Object[_0x52107c(0x1e9)](_0x4940fa,{'username':(0x0,typeorm_2['Like'])('%'+_0x814726+'%')}),_0x5b9b09&&Object['assign'](_0x4940fa,{'email':(0x0,typeorm_2[_0x52107c(0x212)])('%'+_0x5b9b09+'%')}),_0x2717d0&&Object[_0x52107c(0x1e9)](_0x4940fa,{'phone':(0x0,typeorm_2['Like'])('%'+_0x2717d0+'%')}),_0x9762ed&&Object[_0x52107c(0x1e9)](_0x4940fa,{'status':_0x9762ed});_0x1daa56&&(_0x4940fa=[{'username':(0x0,typeorm_2[_0x52107c(0x212)])('%'+_0x1daa56+'%')},{'email':(0x0,typeorm_2[_0x52107c(0x212)])('%'+_0x1daa56+'%')},{'phone':(0x0,typeorm_2[_0x52107c(0x212)])('%'+_0x1daa56+'%')}]);const [_0x23cd24,_0x2da3f5]=await this[_0x52107c(0x1fa)][_0x52107c(0x1d2)]({'skip':(page-0x1)*size,'where':_0x4940fa,'take':size,'order':{'createdAt':_0x52107c(0x1c3)},'cache':!![],'select':[_0x52107c(0x221),_0x52107c(0x191),_0x52107c(0x195),_0x52107c(0x201),_0x52107c(0x1f5),'id',_0x52107c(0x1d4),_0x52107c(0x22b),_0x52107c(0x230),'phone','realName',_0x52107c(0x203)]}),_0x274420=_0x23cd24['map'](_0x2466d8=>_0x2466d8['id']),_0x34c535=await this[_0x52107c(0x18d)][_0x52107c(0x1d6)](_0x274420);return _0x23cd24[_0x52107c(0x197)](_0x540570=>_0x540570[_0x52107c(0x1d7)]=_0x34c535['find'](_0x3b24ed=>_0x3b24ed[_0x52107c(0x198)]===_0x540570['id'])),_0x3b835e[_0x52107c(0x211)][_0x52107c(0x195)]!==_0x52107c(0x1be)&&_0x23cd24[_0x52107c(0x197)](_0x1cbc4c=>_0x1cbc4c[_0x52107c(0x1d4)]=(0x0,utils_1[_0x52107c(0x1bf)])(_0x1cbc4c['email'])),_0x3b835e['user'][_0x52107c(0x195)]!==_0x52107c(0x1be)&&_0x23cd24[_0x52107c(0x197)](_0x3ae393=>_0x3ae393['lastLoginIp']=(0x0,utils_1[_0x52107c(0x1d8)])(_0x3ae393[_0x52107c(0x230)])),_0x3b835e['user'][_0x52107c(0x195)]!=='super'&&_0x23cd24[_0x52107c(0x197)](_0x2d86cb=>_0x2d86cb[_0x52107c(0x21f)]=(0x0,utils_1[_0x52107c(0x1d8)])(_0x2d86cb[_0x52107c(0x21f)])),{'rows':_0x23cd24,'count':_0x2da3f5};}async['queryOne']({id:_0x5143a2}){const _0x45d8f9=_0x3e12b1;return await this[_0x45d8f9(0x1fa)][_0x45d8f9(0x20b)]({'where':{'id':_0x5143a2},'select':['username',_0x45d8f9(0x191),_0x45d8f9(0x195),_0x45d8f9(0x201),_0x45d8f9(0x1f5)]});}async['updateStatus'](_0x18ccab){const _0x31ae74=_0x3e12b1,{id:_0xd7b714,status:_0x128a4b}=_0x18ccab,_0x5d445b=await this[_0x31ae74(0x1fa)][_0x31ae74(0x20b)]({'where':{'id':_0xd7b714}});if(!_0x5d445b)throw new common_1[(_0x31ae74(0x21e))](_0x31ae74(0x1dc),common_1['HttpStatus'][_0x31ae74(0x225)]);if(_0x5d445b[_0x31ae74(0x195)]===_0x31ae74(0x1be))throw new common_1[(_0x31ae74(0x21e))](_0x31ae74(0x1fc),common_1['HttpStatus'][_0x31ae74(0x225)]);if(_0x5d445b[_0x31ae74(0x195)]===_0x31ae74(0x1be))throw new common_1[(_0x31ae74(0x21e))]('超级管理员不可被操作！',common_1[_0x31ae74(0x20d)][_0x31ae74(0x225)]);const _0x1d2c58=await this[_0x31ae74(0x1fa)]['update']({'id':_0xd7b714},{'status':_0x128a4b});if(_0x1d2c58[_0x31ae74(0x1ea)]<=0x0)throw new common_1[(_0x31ae74(0x21e))](_0x31ae74(0x207),common_1['HttpStatus']['BAD_REQUEST']);return _0x31ae74(0x231);}async[_0x3e12b1(0x215)](_0x3573c5){const _0x3742f7=_0x3e12b1,{id:_0x1c6b50}=_0x3573c5,_0x3e6a3e=await this['userEntity'][_0x3742f7(0x20b)]({'where':{'id':_0x1c6b50}});if(!_0x3e6a3e)throw new common_1[(_0x3742f7(0x21e))](_0x3742f7(0x1dc),common_1[_0x3742f7(0x20d)][_0x3742f7(0x225)]);const _0x4bd111=_0x3742f7(0x213),_0x19068f=bcrypt[_0x3742f7(0x22c)](_0x4bd111,0xa),_0x166e41=await this[_0x3742f7(0x1fa)][_0x3742f7(0x1aa)]({'id':_0x1c6b50},{'password':_0x19068f});if(_0x166e41[_0x3742f7(0x1ea)]<=0x0)throw new common_1['HttpException'](_0x3742f7(0x1f1),common_1['HttpStatus']['BAD_REQUEST']);return _0x3742f7(0x1ca)+_0x4bd111+_0x3742f7(0x1a9);}async['savaLoginIp'](_0x319ca5,_0x286e24){const _0x4ccbd6=_0x3e12b1;return await this[_0x4ccbd6(0x1fa)]['update']({'id':_0x319ca5},{'lastLoginIp':_0x286e24});}async[_0x3e12b1(0x1eb)](_0x205eb2,_0xff24f3){const _0x1999a9=_0x3e12b1,_0xa2ed1=await this[_0x1999a9(0x1fa)]['findOne']({'where':{'openId':_0x205eb2}});if(!_0xa2ed1){const _0x3d85b8=await this[_0x1999a9(0x1e0)](_0x205eb2);return await this[_0x1999a9(0x18d)][_0x1999a9(0x22e)](_0x3d85b8['id']),_0x3d85b8;}return _0xa2ed1;}async[_0x3e12b1(0x1e0)](_0x2bdba4){const _0x1cf6f6=_0x3e12b1,_0x1704aa=await this[_0x1cf6f6(0x187)][_0x1cf6f6(0x22d)](['userDefautlAvatar']),_0x308015={'avatar':_0x1704aa,'username':'用户'+(0x0,utils_1[_0x1cf6f6(0x1d3)])(),'status':user_constant_1['UserStatusEnum']['ACTIVE'],'sex':0x0,'email':(0x0,utils_1[_0x1cf6f6(0x1d3)])()+_0x1cf6f6(0x1a3),'openId':_0x2bdba4},_0x6d1a41=await this[_0x1cf6f6(0x1fa)][_0x1cf6f6(0x1b5)](_0x308015);return _0x6d1a41;}async[_0x3e12b1(0x22a)](_0x124188){const _0x42cc82=_0x3e12b1,{username:_0x4817a1,email:_0x3e76db,phone:_0x1b1869}=_0x124188,_0x5888d9=await this[_0x42cc82(0x187)][_0x42cc82(0x22d)]([_0x42cc82(0x1e1)]),_0x3066e8={'avatar':_0x5888d9,'username':'用户'+(0x0,utils_1[_0x42cc82(0x1d3)])(),'status':user_constant_1[_0x42cc82(0x1ad)]['ACTIVE'],'sex':0x0};_0x4817a1&&(_0x3066e8['username']=_0x4817a1);_0x3e76db&&(_0x3066e8[_0x42cc82(0x1d4)]=_0x3e76db);_0x1b1869&&(_0x3066e8[_0x42cc82(0x21f)]=_0x1b1869);const _0x3a8136=await this[_0x42cc82(0x1fa)][_0x42cc82(0x1b5)](_0x3066e8);return _0x3a8136;}async['getUserByContact'](_0x5a8581){const _0x1bab36=_0x3e12b1,{username:_0x432b55,email:_0x3c81e3,phone:_0x31a377}=_0x5a8581,_0x5a32ae=[];return _0x432b55&&_0x5a32ae[_0x1bab36(0x194)]({'username':_0x432b55}),_0x3c81e3&&_0x5a32ae[_0x1bab36(0x194)]({'email':_0x3c81e3}),_0x31a377&&_0x5a32ae[_0x1bab36(0x194)]({'phone':_0x31a377}),await this[_0x1bab36(0x1fa)][_0x1bab36(0x20b)]({'where':_0x5a32ae});}async[_0x3e12b1(0x1e4)](_0x27e75c,_0x32d4b8){const _0x73d99c=_0x3e12b1;try{const _0x205b6f=await this[_0x73d99c(0x1fa)][_0x73d99c(0x20b)]({'where':{'id':_0x32d4b8}});if(!_0x205b6f)return{'status':![],'msg':_0x73d99c(0x19a)};const _0x591dad=await this[_0x73d99c(0x1fa)][_0x73d99c(0x20b)]({'where':{'openId':_0x27e75c}});if(_0x591dad)return{'status':![],'msg':_0x73d99c(0x1ce)};const _0x3541c9=await this[_0x73d99c(0x1fa)][_0x73d99c(0x1aa)]({'id':_0x32d4b8},{'openId':_0x27e75c});if(_0x3541c9[_0x73d99c(0x1ea)]<=0x0)return{'status':![],'msg':_0x73d99c(0x220)};return{'status':!![],'msg':'恭喜您绑定成功、后续可直接扫码登录了！'};}catch(_0x5d7099){return{'status':![],'msg':_0x73d99c(0x220)};}}async[_0x3e12b1(0x1c0)](_0x1b8781){const _0x43097d=_0x3e12b1,_0x5bb6de=await this['userEntity'][_0x43097d(0x20b)]({'where':{'id':_0x1b8781}});return _0x5bb6de===null||_0x5bb6de===void 0x0?void 0x0:_0x5bb6de[_0x43097d(0x19b)];}async[_0x3e12b1(0x224)](_0x4ffcfd){const _0x203313=_0x3e12b1,{username:_0x1ead38,phone:_0x18adac,email:_0x3e6f7e}=_0x4ffcfd;if(_0x18adac){const _0x469ef8=await this[_0x203313(0x1fa)][_0x203313(0x20b)]({'where':{'phone':_0x18adac}});if(_0x469ef8)return![];}if(_0x3e6f7e){const _0x33ca2d=await this[_0x203313(0x1fa)]['findOne']({'where':{'email':_0x3e6f7e}});if(_0x33ca2d)return![];}if(_0x1ead38){const _0x136cea=await this['userEntity'][_0x203313(0x20b)]({'where':{'username':_0x1ead38}});if(_0x136cea)return![];}if(!_0x18adac&&!_0x3e6f7e&&!_0x1ead38)return![];return!![];}async[_0x3e12b1(0x1a6)](_0x3a0b98){const _0x16bd34=_0x3e12b1,{username:_0x30e853,password:_0x3d90dc,phone:_0x506d44,phoneCode:_0x519acd}=_0x3a0b98,_0x937c26=await this[_0x16bd34(0x1fa)]['findOne']({'where':[{'username':_0x30e853},{'phone':_0x506d44}]});if(_0x937c26&&_0x937c26['username']===_0x30e853)throw new common_1[(_0x16bd34(0x21e))](_0x16bd34(0x214),common_1['HttpStatus']['BAD_REQUEST']);if(_0x937c26&&_0x937c26[_0x16bd34(0x21f)]===_0x506d44)throw new common_1[(_0x16bd34(0x21e))]('当前手机号已注册、请勿重复注册！',common_1[_0x16bd34(0x20d)][_0x16bd34(0x225)]);}async[_0x3e12b1(0x1f8)](_0x5a9b23){const _0x89716d=_0x3e12b1,{username:_0x368738,email:_0x48f625}=_0x5a9b23;console['log'](_0x89716d(0x21a)+_0x368738+_0x89716d(0x1bc)+_0x48f625);const _0x5c9379=await this[_0x89716d(0x1fa)][_0x89716d(0x20b)]({'where':[{'username':_0x368738},{'email':_0x48f625}]});if(_0x5c9379&&_0x5c9379['username']===_0x368738){console[_0x89716d(0x18b)](_0x89716d(0x1c8)+_0x368738+_0x89716d(0x192));throw new common_1[(_0x89716d(0x21e))](_0x89716d(0x214),common_1[_0x89716d(0x20d)]['BAD_REQUEST']);}if(_0x5c9379&&_0x5c9379[_0x89716d(0x1d4)]===_0x48f625){console['error'](_0x89716d(0x1f3)+_0x48f625+_0x89716d(0x1e2));throw new common_1['HttpException'](_0x89716d(0x1a2),common_1[_0x89716d(0x20d)][_0x89716d(0x225)]);}console[_0x89716d(0x1d0)](_0x89716d(0x1ec)+_0x368738+_0x89716d(0x1bc)+_0x48f625+_0x89716d(0x20c));}async[_0x3e12b1(0x1ba)](_0xad656a){const _0x43adb0=_0x3e12b1;return await this[_0x43adb0(0x1fa)][_0x43adb0(0x1b5)](_0xad656a);}async[_0x3e12b1(0x1c2)](_0x54b10f,_0x31b4fb,_0x1902e0){const _0x349a79=_0x3e12b1,_0xe7b81d=await this[_0x349a79(0x1fa)]['findOne']({'where':{'id':_0x54b10f}});!_0xe7b81d&&common_1[_0x349a79(0x1a7)]['error'](_0x349a79(0x216));await this[_0x349a79(0x1fa)][_0x349a79(0x1aa)]({'id':_0x54b10f},{'realName':_0x31b4fb,'idCard':_0x1902e0});return;}async[_0x3e12b1(0x1b6)](_0x51615f,_0x36b412,_0x4f2123,_0x413da2){const _0x383186=_0x3e12b1,_0xefaf4=await this[_0x383186(0x1fa)]['findOne']({'where':{'id':_0x51615f}}),_0x1eb110=bcrypt[_0x383186(0x22c)](_0x413da2,0xa);!_0xefaf4&&common_1[_0x383186(0x1a7)][_0x383186(0x18b)]('用户不存在');if(!_0x36b412||!_0x4f2123||!_0x1eb110)throw new common_1[(_0x383186(0x21e))](_0x383186(0x208),common_1[_0x383186(0x20d)]['BAD_REQUEST']);await this['userEntity']['update']({'id':_0x51615f},{'phone':_0x36b412,'username':_0x4f2123,'password':_0x1eb110});return;}};UserService=__decorate([(0x0,common_1[_0x3e12b1(0x1a0)])(),__param(0x0,(0x0,typeorm_1[_0x3e12b1(0x1a4)])(user_entity_1[_0x3e12b1(0x234)])),__param(0x6,(0x0,typeorm_1[_0x3e12b1(0x1a4)])(config_entity_1[_0x3e12b1(0x1af)])),__metadata(_0x3e12b1(0x235),[typeorm_2[_0x3e12b1(0x1bd)],typeorm_2[_0x3e12b1(0x1d5)],verification_service_1[_0x3e12b1(0x1ae)],mailer_service_1[_0x3e12b1(0x227)],userBalance_service_1[_0x3e12b1(0x21d)],globalConfig_service_1[_0x3e12b1(0x1de)],typeorm_2['Repository']])],UserService),exports[_0x3e12b1(0x19d)]=UserService;