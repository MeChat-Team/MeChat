'use strict';const _0x36ccaa=_0x391e;(function(_0x57e07f,_0x29d03e){const _0x22001e=_0x391e,_0x26e117=_0x57e07f();while(!![]){try{const _0x4e947a=parseInt(_0x22001e(0x73))/0x1*(-parseInt(_0x22001e(0xa1))/0x2)+parseInt(_0x22001e(0xbe))/0x3*(parseInt(_0x22001e(0x9d))/0x4)+-parseInt(_0x22001e(0x6e))/0x5*(parseInt(_0x22001e(0x9e))/0x6)+parseInt(_0x22001e(0x94))/0x7+-parseInt(_0x22001e(0xae))/0x8+-parseInt(_0x22001e(0xba))/0x9*(-parseInt(_0x22001e(0xab))/0xa)+parseInt(_0x22001e(0xb2))/0xb*(parseInt(_0x22001e(0x7b))/0xc);if(_0x4e947a===_0x29d03e)break;else _0x26e117['push'](_0x26e117['shift']());}catch(_0x199dbf){_0x26e117['push'](_0x26e117['shift']());}}}(_0x5016,0x7e6ee));var __decorate=this&&this[_0x36ccaa(0x8a)]||function(_0x22450b,_0x42cea5,_0x9b20fd,_0x33a577){const _0x5e814d=_0x36ccaa;var _0x3850de=arguments[_0x5e814d(0xad)],_0x26c46f=_0x3850de<0x3?_0x42cea5:_0x33a577===null?_0x33a577=Object[_0x5e814d(0xa3)](_0x42cea5,_0x9b20fd):_0x33a577,_0x34318e;if(typeof Reflect===_0x5e814d(0x71)&&typeof Reflect['decorate']==='function')_0x26c46f=Reflect['decorate'](_0x22450b,_0x42cea5,_0x9b20fd,_0x33a577);else{for(var _0x13a317=_0x22450b[_0x5e814d(0xad)]-0x1;_0x13a317>=0x0;_0x13a317--)if(_0x34318e=_0x22450b[_0x13a317])_0x26c46f=(_0x3850de<0x3?_0x34318e(_0x26c46f):_0x3850de>0x3?_0x34318e(_0x42cea5,_0x9b20fd,_0x26c46f):_0x34318e(_0x42cea5,_0x9b20fd))||_0x26c46f;}return _0x3850de>0x3&&_0x26c46f&&Object['defineProperty'](_0x42cea5,_0x9b20fd,_0x26c46f),_0x26c46f;},__metadata=this&&this[_0x36ccaa(0x69)]||function(_0x2af213,_0x499b6c){const _0x50006b=_0x36ccaa;if(typeof Reflect===_0x50006b(0x71)&&typeof Reflect[_0x50006b(0xbb)]===_0x50006b(0xb7))return Reflect[_0x50006b(0xbb)](_0x2af213,_0x499b6c);},__param=this&&this[_0x36ccaa(0xb9)]||function(_0x4b2fdc,_0x5906ac){return function(_0x76ecc,_0x1686e8){_0x5906ac(_0x76ecc,_0x1686e8,_0x4b2fdc);};};Object[_0x36ccaa(0xaf)](exports,_0x36ccaa(0x75),{'value':!![]}),exports[_0x36ccaa(0x77)]=void 0x0;function _0x391e(_0x341f3c,_0x2e62e2){const _0x5016cc=_0x5016();return _0x391e=function(_0x391e61,_0x29c19b){_0x391e61=_0x391e61-0x66;let _0x181232=_0x5016cc[_0x391e61];return _0x181232;},_0x391e(_0x341f3c,_0x2e62e2);}const user_entity_1=require('./../user/user.entity'),typeorm_1=require(_0x36ccaa(0x9f)),common_1=require(_0x36ccaa(0x80)),typeorm_2=require(_0x36ccaa(0x79)),order_entity_1=require(_0x36ccaa(0xa8)),cramiPackage_entity_1=require(_0x36ccaa(0xb3)),utils_1=require(_0x36ccaa(0x95)),pay_service_1=require(_0x36ccaa(0xbd)),globalConfig_service_1=require(_0x36ccaa(0x7f));function _0x5016(){const _0x4195ac=['map','goodsId','findAndCount','find','160764WfkyWl','63198lgfAmG','@nestjs/typeorm','cramiPackageEntity','169928bHEydj','HttpException','getOwnPropertyDescriptor','InjectRepository','DESC','findOne','total_price','./order.entity','userEntity','order:\x20','43390uXkimg','channel','length','3416808UfEvIn','defineProperty','订单不存在!','name','20119wkEfJe','../crami/cramiPackage.entity','请先注册账号后购买商品！','status','coverImg','function','where','__param','36AItDwR','metadata','OrderEntity','../pay/pay.service','3aXAERk','order.status\x20=\x20:status','assign','SUM(order.price)','query','__metadata','Repository','userInfo','save','price','275sLUSHH','购买失败!','payService','object','email','4EGaxmO','orderId','__esModule','GlobalConfigService','OrderService','BAD_REQUEST','typeorm','createQueryBuilder','7020wApLQp','log','PayService','userId','../globalConfig/globalConfig.service','@nestjs/common','UNAUTHORIZED','queryAllOrder','total','payPlatform','order','getRawOne','username','des','count','__decorate','design:paramtypes','pay','goodsInfo','user','message','globalConfigService','HttpStatus','forEach','select','5156410SltBcm','../../common/utils','delete','orderEntity','create'];_0x5016=function(){return _0x4195ac;};return _0x5016();}let OrderService=class OrderService{constructor(_0x1bc0b7,_0x5d22bc,_0x1bb359,_0x11a00b,_0x24737f){const _0x3052f1=_0x36ccaa;this[_0x3052f1(0x97)]=_0x1bc0b7,this[_0x3052f1(0xa0)]=_0x5d22bc,this[_0x3052f1(0xa9)]=_0x1bb359,this[_0x3052f1(0x70)]=_0x11a00b,this[_0x3052f1(0x90)]=_0x24737f;}async['buy'](_0x9c535b,_0x547255){const _0x39bf63=_0x36ccaa;try{const {goodsId:_0x29d30f,count:count=0x1,payType:_0x4e1a87}=_0x9c535b,{id:_0x62685e}=_0x547255[_0x39bf63(0x8e)];if(_0x62685e>0xf4240)throw new common_1[(_0x39bf63(0xa2))](_0x39bf63(0xb4),common_1[_0x39bf63(0x91)][_0x39bf63(0x81)]);const _0x6c2e4e=await this[_0x39bf63(0x98)](_0x62685e,_0x29d30f,count,_0x4e1a87),_0x101c24=await this[_0x39bf63(0x70)][_0x39bf63(0x8c)](_0x62685e,_0x6c2e4e[_0x39bf63(0x74)],_0x4e1a87);return Object[_0x39bf63(0x66)](Object['assign']({},_0x101c24),{'orderId':_0x6c2e4e[_0x39bf63(0x74)],'platform':_0x6c2e4e[_0x39bf63(0x84)],'total':_0x6c2e4e[_0x39bf63(0x83)]});}catch(_0x29ee44){if(_0x29ee44['status']===0x191)throw new common_1[(_0x39bf63(0xa2))](_0x29ee44[_0x39bf63(0x8f)],common_1['HttpStatus']['UNAUTHORIZED']);throw new common_1[(_0x39bf63(0xa2))](_0x29ee44[_0x39bf63(0x8f)]||_0x39bf63(0x6f),common_1[_0x39bf63(0x91)][_0x39bf63(0x78)]);}}async['queryByOrderId'](_0x53407a,_0x2ff91a){const _0x45c2eb=_0x36ccaa,{id:_0x505ca6}=_0x53407a[_0x45c2eb(0x8e)],{orderId:_0x527b08}=_0x2ff91a,_0x54a148=await this[_0x45c2eb(0x97)]['findOne']({'where':{'userId':_0x505ca6,'orderId':_0x527b08}});if(!_0x54a148)throw new common_1[(_0x45c2eb(0xa2))](_0x45c2eb(0xb0),common_1[_0x45c2eb(0x91)]['BAD_REQUEST']);return _0x54a148;}async[_0x36ccaa(0x98)](_0x527615,_0x811094,_0x32a483,_0x1fb40a){const _0xb4f8ca=_0x36ccaa,_0x93d2d9=await this[_0xb4f8ca(0x90)]['queryPayType'](),_0x1cd3bb=await this[_0xb4f8ca(0xa0)][_0xb4f8ca(0xa6)]({'where':{'id':_0x811094}});if(!_0x1cd3bb)throw new common_1[(_0xb4f8ca(0xa2))]('套餐不存在!',common_1[_0xb4f8ca(0x91)][_0xb4f8ca(0x78)]);const _0x435290={};_0x435290[_0xb4f8ca(0x74)]=(0x0,utils_1['createOrderId'])(),_0x435290[_0xb4f8ca(0x7e)]=_0x527615,_0x435290[_0xb4f8ca(0x9a)]=_0x811094,_0x435290[_0xb4f8ca(0x6d)]=Number(_0x1cd3bb[_0xb4f8ca(0x6d)]),_0x435290[_0xb4f8ca(0x89)]=_0x32a483,_0x435290['total']=Number(_0x1cd3bb['price'])*_0x32a483,_0x435290[_0xb4f8ca(0x84)]=_0x93d2d9,_0x435290[_0xb4f8ca(0xac)]=_0x1fb40a;const _0x25de03=await this[_0xb4f8ca(0x97)][_0xb4f8ca(0x6c)](_0x435290);return console[_0xb4f8ca(0x7c)](_0xb4f8ca(0xaa),_0x25de03),_0x25de03;}async[_0x36ccaa(0x68)](_0x1ce448,_0x38ec66,_0x2aa142){const _0x3ac905=_0x36ccaa;return await this[_0x3ac905(0x97)][_0x3ac905(0x9b)]({'where':{'userId':_0x1ce448},'order':{'id':_0x3ac905(0xa5)},'skip':(_0x38ec66-0x1)*_0x2aa142,'take':_0x2aa142});}async[_0x36ccaa(0x82)](_0x1ecd07){const _0x5bfa7d=_0x36ccaa,{page:_0xc706fd,size:_0x5b98f4,userId:_0x196c65,platform:_0x4996df,status:_0x514e65}=_0x1ecd07,_0x295b06={};if(_0x196c65)_0x295b06['userId']=_0x196c65;if(_0x4996df)_0x295b06[_0x5bfa7d(0x84)]=_0x4996df;if(_0x514e65)_0x295b06[_0x5bfa7d(0xb5)]=_0x514e65;const [_0x1098dd,_0x20dfbc]=await this[_0x5bfa7d(0x97)][_0x5bfa7d(0x9b)]({'order':{'id':_0x5bfa7d(0xa5)},'where':_0x295b06,'skip':(_0xc706fd-0x1)*_0x5b98f4,'take':_0x5b98f4}),_0x2601d8=_0x1098dd[_0x5bfa7d(0x99)](_0x42c0a0=>_0x42c0a0['userId']),_0x5ed35a=_0x1098dd[_0x5bfa7d(0x99)](_0x220a89=>_0x220a89[_0x5bfa7d(0x9a)]),_0x326f0b=await this['userEntity'][_0x5bfa7d(0x9c)]({'where':{'id':(0x0,typeorm_2['In'])(_0x2601d8)},'select':['id',_0x5bfa7d(0x87),_0x5bfa7d(0x72)]}),_0x103b54=await this[_0x5bfa7d(0xa0)][_0x5bfa7d(0x9c)]({'where':{'id':(0x0,typeorm_2['In'])(_0x5ed35a)},'select':['id',_0x5bfa7d(0xb1),_0x5bfa7d(0xb6),_0x5bfa7d(0x88)]});_0x1098dd[_0x5bfa7d(0x92)](_0x58d77f=>{const _0x22031a=_0x5bfa7d;_0x58d77f[_0x22031a(0x6b)]=_0x326f0b[_0x22031a(0x9c)](_0x2ad388=>_0x2ad388['id']===_0x58d77f[_0x22031a(0x7e)]),_0x58d77f[_0x22031a(0x8d)]=_0x103b54[_0x22031a(0x9c)](_0x11faf2=>_0x11faf2['id']===_0x58d77f[_0x22031a(0x9a)]);});const _0x2f259e=await this[_0x5bfa7d(0x97)][_0x5bfa7d(0x7a)](_0x5bfa7d(0x85))[_0x5bfa7d(0xb8)](_0x5bfa7d(0xbf),{'status':0x1})[_0x5bfa7d(0x93)](_0x5bfa7d(0x67),_0x5bfa7d(0xa7))[_0x5bfa7d(0x86)]();return Object[_0x5bfa7d(0x66)]({'rows':_0x1098dd,'count':_0x20dfbc},_0x2f259e);}async['deleteOrder'](_0x1fbad8){const _0x370296=_0x36ccaa,{orderId:_0x3302ef}=_0x1fbad8,_0x273b47=await this[_0x370296(0x97)][_0x370296(0xa6)]({'where':{'orderId':_0x3302ef}});if(!_0x273b47)throw new common_1['HttpException'](_0x370296(0xb0),common_1['HttpStatus'][_0x370296(0x78)]);return await this[_0x370296(0x97)][_0x370296(0x96)]({'orderId':_0x3302ef});}async['deleteNotPay'](){const _0x23e981=_0x36ccaa;return await this[_0x23e981(0x97)][_0x23e981(0x96)]({'status':0x0});}};OrderService=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,typeorm_1[_0x36ccaa(0xa4)])(order_entity_1[_0x36ccaa(0xbc)])),__param(0x1,(0x0,typeorm_1['InjectRepository'])(cramiPackage_entity_1['CramiPackageEntity'])),__param(0x2,(0x0,typeorm_1[_0x36ccaa(0xa4)])(user_entity_1['UserEntity'])),__metadata(_0x36ccaa(0x8b),[typeorm_2[_0x36ccaa(0x6a)],typeorm_2[_0x36ccaa(0x6a)],typeorm_2[_0x36ccaa(0x6a)],pay_service_1[_0x36ccaa(0x7d)],globalConfig_service_1[_0x36ccaa(0x76)]])],OrderService),exports[_0x36ccaa(0x77)]=OrderService;