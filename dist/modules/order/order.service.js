'use strict';const _0x4ef14f=_0x44b4;(function(_0x1f2f66,_0x1cee4d){const _0x3f7e04=_0x44b4,_0x1a68f0=_0x1f2f66();while(!![]){try{const _0x27442b=parseInt(_0x3f7e04(0x1a9))/0x1+-parseInt(_0x3f7e04(0x1ab))/0x2*(-parseInt(_0x3f7e04(0x1c3))/0x3)+parseInt(_0x3f7e04(0x183))/0x4*(-parseInt(_0x3f7e04(0x18c))/0x5)+-parseInt(_0x3f7e04(0x1c5))/0x6*(-parseInt(_0x3f7e04(0x1c1))/0x7)+-parseInt(_0x3f7e04(0x1aa))/0x8*(parseInt(_0x3f7e04(0x1b8))/0x9)+-parseInt(_0x3f7e04(0x17c))/0xa+parseInt(_0x3f7e04(0x18f))/0xb;if(_0x27442b===_0x1cee4d)break;else _0x1a68f0['push'](_0x1a68f0['shift']());}catch(_0x1bbd06){_0x1a68f0['push'](_0x1a68f0['shift']());}}}(_0x2ef7,0xa32cb));function _0x44b4(_0x2db6e0,_0x32f795){const _0x2ef772=_0x2ef7();return _0x44b4=function(_0x44b44e,_0x194bec){_0x44b44e=_0x44b44e-0x17c;let _0x8fb1b=_0x2ef772[_0x44b44e];return _0x8fb1b;},_0x44b4(_0x2db6e0,_0x32f795);}function _0x2ef7(){const _0x193331=['234783GibJKI','typeorm','order.status\x20=\x20:status','SUM(order.price)','message','object','forEach','query','请先注册账号后购买商品！','9597qWxwQF','design:paramtypes','3UXeRHC','findOne','3702fFbLrk','UNAUTHORIZED','DESC','name','cramiPackageEntity','@nestjs/typeorm','BAD_REQUEST','__decorate','save','globalConfigService','find','8599360VhtknW','../../common/utils','status','@nestjs/common','userId','../crami/cramiPackage.entity','__param','4xmCAcv','userInfo','userEntity','where','__metadata','function','InjectRepository','order:\x20','select','2664670QxyufD','total_price','queryAllOrder','9944187mGnxjc','CramiPackageEntity','length','order','Repository','log','goodsId','getRawOne','delete','total','metadata','购买失败!','channel','createOrderId','OrderService','findAndCount','price','HttpException','payService','username','assign','create','./order.entity','orderEntity','defineProperty','套餐不存在!','130433QwNvBB','88QrNNbq','935666DCnErz','orderId','UserEntity','des','__esModule','getOwnPropertyDescriptor','订单不存在!','OrderEntity','deleteNotPay','pay','decorate','email','HttpStatus'];_0x2ef7=function(){return _0x193331;};return _0x2ef7();}var __decorate=this&&this[_0x4ef14f(0x1cc)]||function(_0x1d899d,_0x923c93,_0x270600,_0x1e74c5){const _0x4df29=_0x4ef14f;var _0x355938=arguments[_0x4df29(0x191)],_0x126665=_0x355938<0x3?_0x923c93:_0x1e74c5===null?_0x1e74c5=Object[_0x4df29(0x1b0)](_0x923c93,_0x270600):_0x1e74c5,_0x14e258;if(typeof Reflect===_0x4df29(0x1bd)&&typeof Reflect[_0x4df29(0x1b5)]==='function')_0x126665=Reflect[_0x4df29(0x1b5)](_0x1d899d,_0x923c93,_0x270600,_0x1e74c5);else{for(var _0x3c03c8=_0x1d899d[_0x4df29(0x191)]-0x1;_0x3c03c8>=0x0;_0x3c03c8--)if(_0x14e258=_0x1d899d[_0x3c03c8])_0x126665=(_0x355938<0x3?_0x14e258(_0x126665):_0x355938>0x3?_0x14e258(_0x923c93,_0x270600,_0x126665):_0x14e258(_0x923c93,_0x270600))||_0x126665;}return _0x355938>0x3&&_0x126665&&Object[_0x4df29(0x1a7)](_0x923c93,_0x270600,_0x126665),_0x126665;},__metadata=this&&this[_0x4ef14f(0x187)]||function(_0x2848fa,_0x317049){const _0x5d0604=_0x4ef14f;if(typeof Reflect===_0x5d0604(0x1bd)&&typeof Reflect[_0x5d0604(0x199)]===_0x5d0604(0x188))return Reflect['metadata'](_0x2848fa,_0x317049);},__param=this&&this[_0x4ef14f(0x182)]||function(_0x3a9505,_0x42c0ce){return function(_0xbf8e76,_0x221fda){_0x42c0ce(_0xbf8e76,_0x221fda,_0x3a9505);};};Object[_0x4ef14f(0x1a7)](exports,_0x4ef14f(0x1af),{'value':!![]}),exports[_0x4ef14f(0x19d)]=void 0x0;const user_entity_1=require('./../user/user.entity'),typeorm_1=require(_0x4ef14f(0x1ca)),common_1=require(_0x4ef14f(0x17f)),typeorm_2=require(_0x4ef14f(0x1b9)),order_entity_1=require(_0x4ef14f(0x1a5)),cramiPackage_entity_1=require(_0x4ef14f(0x181)),utils_1=require(_0x4ef14f(0x17d)),pay_service_1=require('../pay/pay.service'),globalConfig_service_1=require('../globalConfig/globalConfig.service');let OrderService=class OrderService{constructor(_0x1980bd,_0x715ec7,_0x11c2aa,_0x5af078,_0x4d0d18){const _0x511b37=_0x4ef14f;this[_0x511b37(0x1a6)]=_0x1980bd,this[_0x511b37(0x1c9)]=_0x715ec7,this[_0x511b37(0x185)]=_0x11c2aa,this[_0x511b37(0x1a1)]=_0x5af078,this[_0x511b37(0x1ce)]=_0x4d0d18;}async['buy'](_0x1288f6,_0x20a7d0){const _0xb55a21=_0x4ef14f;try{const {goodsId:_0x516352,count:count=0x1,payType:_0x839c69}=_0x1288f6,{id:_0x596dbd}=_0x20a7d0['user'];if(_0x596dbd>0xf4240)throw new common_1[(_0xb55a21(0x1a0))](_0xb55a21(0x1c0),common_1[_0xb55a21(0x1b7)][_0xb55a21(0x1c6)]);const _0x56a818=await this[_0xb55a21(0x1a4)](_0x596dbd,_0x516352,count,_0x839c69),_0x2b494b=await this[_0xb55a21(0x1a1)][_0xb55a21(0x1b4)](_0x596dbd,_0x56a818['orderId'],_0x839c69);return Object['assign'](Object[_0xb55a21(0x1a3)]({},_0x2b494b),{'orderId':_0x56a818[_0xb55a21(0x1ac)],'platform':_0x56a818['payPlatform'],'total':_0x56a818[_0xb55a21(0x198)]});}catch(_0x10118d){if(_0x10118d[_0xb55a21(0x17e)]===0x191)throw new common_1[(_0xb55a21(0x1a0))](_0x10118d['message'],common_1[_0xb55a21(0x1b7)][_0xb55a21(0x1c6)]);throw new common_1[(_0xb55a21(0x1a0))](_0x10118d[_0xb55a21(0x1bc)]||_0xb55a21(0x19a),common_1[_0xb55a21(0x1b7)][_0xb55a21(0x1cb)]);}}async['queryByOrderId'](_0x14fefa,_0x288b61){const _0x1c2437=_0x4ef14f,{id:_0x30eb69}=_0x14fefa['user'],{orderId:_0x20d317}=_0x288b61,_0x87584=await this['orderEntity'][_0x1c2437(0x1c4)]({'where':{'userId':_0x30eb69,'orderId':_0x20d317}});if(!_0x87584)throw new common_1['HttpException'](_0x1c2437(0x1b1),common_1[_0x1c2437(0x1b7)]['BAD_REQUEST']);return _0x87584;}async[_0x4ef14f(0x1a4)](_0x135ce6,_0x32ad08,_0x5f3dd6,_0x445e22){const _0x162942=_0x4ef14f,_0x11646a=await this[_0x162942(0x1ce)]['queryPayType'](),_0x50bcd2=await this['cramiPackageEntity'][_0x162942(0x1c4)]({'where':{'id':_0x32ad08}});if(!_0x50bcd2)throw new common_1['HttpException'](_0x162942(0x1a8),common_1[_0x162942(0x1b7)]['BAD_REQUEST']);const _0x118cb5={};_0x118cb5[_0x162942(0x1ac)]=(0x0,utils_1[_0x162942(0x19c)])(),_0x118cb5[_0x162942(0x180)]=_0x135ce6,_0x118cb5[_0x162942(0x195)]=_0x32ad08,_0x118cb5[_0x162942(0x19f)]=Number(_0x50bcd2[_0x162942(0x19f)]),_0x118cb5['count']=_0x5f3dd6,_0x118cb5[_0x162942(0x198)]=Number(_0x50bcd2[_0x162942(0x19f)])*_0x5f3dd6,_0x118cb5['payPlatform']=_0x11646a,_0x118cb5[_0x162942(0x19b)]=_0x445e22;const _0x1bcd55=await this[_0x162942(0x1a6)][_0x162942(0x1cd)](_0x118cb5);return console[_0x162942(0x194)](_0x162942(0x18a),_0x1bcd55),_0x1bcd55;}async[_0x4ef14f(0x1bf)](_0x17837f,_0x289cd9,_0x3cc1fc){const _0x18b777=_0x4ef14f;return await this[_0x18b777(0x1a6)]['findAndCount']({'where':{'userId':_0x17837f},'order':{'id':_0x18b777(0x1c7)},'skip':(_0x289cd9-0x1)*_0x3cc1fc,'take':_0x3cc1fc});}async[_0x4ef14f(0x18e)](_0x428a26){const _0x18da15=_0x4ef14f,{page:_0x2b2f09,size:_0x5a1e17,userId:_0x358e1d,platform:_0x4e0d71,status:_0x5e793a}=_0x428a26,_0x2f0042={};if(_0x358e1d)_0x2f0042['userId']=_0x358e1d;if(_0x4e0d71)_0x2f0042['payPlatform']=_0x4e0d71;if(_0x5e793a)_0x2f0042[_0x18da15(0x17e)]=_0x5e793a;const [_0x3601d5,_0x26dff2]=await this[_0x18da15(0x1a6)][_0x18da15(0x19e)]({'order':{'id':_0x18da15(0x1c7)},'where':_0x2f0042,'skip':(_0x2b2f09-0x1)*_0x5a1e17,'take':_0x5a1e17}),_0x51b331=_0x3601d5['map'](_0x57521c=>_0x57521c[_0x18da15(0x180)]),_0x3aee7e=_0x3601d5['map'](_0x155650=>_0x155650[_0x18da15(0x195)]),_0x12664c=await this[_0x18da15(0x185)][_0x18da15(0x1cf)]({'where':{'id':(0x0,typeorm_2['In'])(_0x51b331)},'select':['id',_0x18da15(0x1a2),_0x18da15(0x1b6)]}),_0x52c9bd=await this['cramiPackageEntity'][_0x18da15(0x1cf)]({'where':{'id':(0x0,typeorm_2['In'])(_0x3aee7e)},'select':['id',_0x18da15(0x1c8),'coverImg',_0x18da15(0x1ae)]});_0x3601d5[_0x18da15(0x1be)](_0x503ce0=>{const _0x540a9b=_0x18da15;_0x503ce0[_0x540a9b(0x184)]=_0x12664c[_0x540a9b(0x1cf)](_0x28afcc=>_0x28afcc['id']===_0x503ce0[_0x540a9b(0x180)]),_0x503ce0['goodsInfo']=_0x52c9bd['find'](_0x2a453b=>_0x2a453b['id']===_0x503ce0[_0x540a9b(0x195)]);});const _0x7eeada=await this[_0x18da15(0x1a6)]['createQueryBuilder'](_0x18da15(0x192))[_0x18da15(0x186)](_0x18da15(0x1ba),{'status':0x1})[_0x18da15(0x18b)](_0x18da15(0x1bb),_0x18da15(0x18d))[_0x18da15(0x196)]();return Object[_0x18da15(0x1a3)]({'rows':_0x3601d5,'count':_0x26dff2},_0x7eeada);}async['deleteOrder'](_0xe8f8fb){const _0x2d1d3e=_0x4ef14f,{orderId:_0x806b8b}=_0xe8f8fb,_0x23257d=await this[_0x2d1d3e(0x1a6)][_0x2d1d3e(0x1c4)]({'where':{'orderId':_0x806b8b}});if(!_0x23257d)throw new common_1[(_0x2d1d3e(0x1a0))](_0x2d1d3e(0x1b1),common_1['HttpStatus']['BAD_REQUEST']);return await this['orderEntity'][_0x2d1d3e(0x197)]({'orderId':_0x806b8b});}async[_0x4ef14f(0x1b3)](){const _0x266eb8=_0x4ef14f;return await this[_0x266eb8(0x1a6)][_0x266eb8(0x197)]({'status':0x0});}};OrderService=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,typeorm_1[_0x4ef14f(0x189)])(order_entity_1[_0x4ef14f(0x1b2)])),__param(0x1,(0x0,typeorm_1[_0x4ef14f(0x189)])(cramiPackage_entity_1[_0x4ef14f(0x190)])),__param(0x2,(0x0,typeorm_1['InjectRepository'])(user_entity_1[_0x4ef14f(0x1ad)])),__metadata(_0x4ef14f(0x1c2),[typeorm_2[_0x4ef14f(0x193)],typeorm_2['Repository'],typeorm_2[_0x4ef14f(0x193)],pay_service_1['PayService'],globalConfig_service_1['GlobalConfigService']])],OrderService),exports[_0x4ef14f(0x19d)]=OrderService;