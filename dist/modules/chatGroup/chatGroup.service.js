'use strict';const _0x209fc6=_0x127d;(function(_0x2f5c78,_0x157f94){const _0x1e6c3b=_0x127d,_0x10c4dc=_0x2f5c78();while(!![]){try{const _0x3a90a6=-parseInt(_0x1e6c3b(0xe4))/0x1*(parseInt(_0x1e6c3b(0xe2))/0x2)+parseInt(_0x1e6c3b(0xbb))/0x3+-parseInt(_0x1e6c3b(0xdb))/0x4*(-parseInt(_0x1e6c3b(0xc4))/0x5)+parseInt(_0x1e6c3b(0xea))/0x6*(-parseInt(_0x1e6c3b(0xf1))/0x7)+-parseInt(_0x1e6c3b(0xd2))/0x8*(parseInt(_0x1e6c3b(0xcb))/0x9)+parseInt(_0x1e6c3b(0xee))/0xa*(parseInt(_0x1e6c3b(0xe0))/0xb)+parseInt(_0x1e6c3b(0xbf))/0xc;if(_0x3a90a6===_0x157f94)break;else _0x10c4dc['push'](_0x10c4dc['shift']());}catch(_0x2ebbb5){_0x10c4dc['push'](_0x10c4dc['shift']());}}}(_0x3185,0x3d2bd));function _0x3185(){const _0x2f42f2=['getBaseConfig','updateTime','default','PDF\x20解析失败:','getOwnPropertySymbols','del','object','delAll','getOwnPropertyDescriptor','@nestjs/typeorm','save','hasOwnProperty','metadata','Repository','design:paramtypes','axios','filter','decorate','./chatGroup.entity','prototype','appEntity','extractPdfText','text','__param','非法操作、您在使用一个不存在的应用！','deductType','ModelsService','arraybuffer','__esModule','getCurrentModelKeyInfo','assign','chatGroupEntity','call','删除成功','findOne','PDF\x20解析失败','modelsService','__decorate','../models/models.service','250995fsJtAV','ChatGroupService','请先选择一个对话或者新加一个对话再操作！','appId','3561168RSwQJs','defineProperty','modelInfo','update','isSticky','45TKEwgX','keyType','find','error','ChatGroupEntity','indexOf','function','72iNNRai','title','非法操作、您在使用一个未启用的应用！','parse','新对话','handlePdfExtraction','HttpStatus','286448ggAZis','BAD_REQUEST','user','affected','管理员未配置任何AI模型、请先联系管理员开通聊天模型配置！','gpts','pdfTextContent','map','appLogo','161436UlRAiF','getGroupInfoFromId','typeorm','fileUrl','from','11DpyUgw','propertyIsEnumerable','301018PZFPry','DESC','1iLTouE','includes','pdf-parse','undefined','stringify','Injectable','10734anGupR','InjectRepository','更新对话失败！','length','2354610RSyAHA','coverImg','HttpException','1141YWXmNg'];_0x3185=function(){return _0x2f42f2;};return _0x3185();}var __decorate=this&&this[_0x209fc6(0xb9)]||function(_0x59c116,_0x2438fa,_0xe0c57c,_0x3d0b4f){const _0x3d1f03=_0x209fc6;var _0x2915e6=arguments[_0x3d1f03(0xed)],_0x4a31be=_0x2915e6<0x3?_0x2438fa:_0x3d0b4f===null?_0x3d0b4f=Object[_0x3d1f03(0xfa)](_0x2438fa,_0xe0c57c):_0x3d0b4f,_0x11354b;if(typeof Reflect===_0x3d1f03(0xf8)&&typeof Reflect[_0x3d1f03(0x103)]==='function')_0x4a31be=Reflect[_0x3d1f03(0x103)](_0x59c116,_0x2438fa,_0xe0c57c,_0x3d0b4f);else{for(var _0x8141b=_0x59c116['length']-0x1;_0x8141b>=0x0;_0x8141b--)if(_0x11354b=_0x59c116[_0x8141b])_0x4a31be=(_0x2915e6<0x3?_0x11354b(_0x4a31be):_0x2915e6>0x3?_0x11354b(_0x2438fa,_0xe0c57c,_0x4a31be):_0x11354b(_0x2438fa,_0xe0c57c))||_0x4a31be;}return _0x2915e6>0x3&&_0x4a31be&&Object[_0x3d1f03(0xc0)](_0x2438fa,_0xe0c57c,_0x4a31be),_0x4a31be;},__metadata=this&&this['__metadata']||function(_0x4a4f4c,_0x531c80){const _0x33aae9=_0x209fc6;if(typeof Reflect===_0x33aae9(0xf8)&&typeof Reflect[_0x33aae9(0xfe)]===_0x33aae9(0xca))return Reflect['metadata'](_0x4a4f4c,_0x531c80);},__param=this&&this[_0x209fc6(0x109)]||function(_0x6c04cd,_0x276e19){return function(_0x401595,_0x30f8a8){_0x276e19(_0x401595,_0x30f8a8,_0x6c04cd);};},__rest=this&&this['__rest']||function(_0x4c0b78,_0x1d607e){const _0x205bb2=_0x209fc6;var _0x1ba3e0={};for(var _0x49819f in _0x4c0b78)if(Object[_0x205bb2(0x105)][_0x205bb2(0xfd)][_0x205bb2(0x112)](_0x4c0b78,_0x49819f)&&_0x1d607e[_0x205bb2(0xc9)](_0x49819f)<0x0)_0x1ba3e0[_0x49819f]=_0x4c0b78[_0x49819f];if(_0x4c0b78!=null&&typeof Object['getOwnPropertySymbols']===_0x205bb2(0xca))for(var _0x2d3a94=0x0,_0x49819f=Object[_0x205bb2(0xf6)](_0x4c0b78);_0x2d3a94<_0x49819f[_0x205bb2(0xed)];_0x2d3a94++){if(_0x1d607e['indexOf'](_0x49819f[_0x2d3a94])<0x0&&Object[_0x205bb2(0x105)][_0x205bb2(0xe1)][_0x205bb2(0x112)](_0x4c0b78,_0x49819f[_0x2d3a94]))_0x1ba3e0[_0x49819f[_0x2d3a94]]=_0x4c0b78[_0x49819f[_0x2d3a94]];}return _0x1ba3e0;};Object['defineProperty'](exports,_0x209fc6(0x10e),{'value':!![]}),exports[_0x209fc6(0xbc)]=void 0x0;const common_1=require('@nestjs/common'),typeorm_1=require(_0x209fc6(0xfb)),axios_1=require(_0x209fc6(0x101)),pdf=require(_0x209fc6(0xe6)),typeorm_2=require(_0x209fc6(0xdd)),app_entity_1=require('../app/app.entity'),models_service_1=require(_0x209fc6(0xba)),chatGroup_entity_1=require(_0x209fc6(0x104));function _0x127d(_0x53ea3b,_0x1de9de){const _0x318594=_0x3185();return _0x127d=function(_0x127dd1,_0x44a4de){_0x127dd1=_0x127dd1-0xb5;let _0x191d56=_0x318594[_0x127dd1];return _0x191d56;},_0x127d(_0x53ea3b,_0x1de9de);}let ChatGroupService=class ChatGroupService{constructor(_0x44a81b,_0x31a3f8,_0x5d355c){const _0x1cb6a7=_0x209fc6;this[_0x1cb6a7(0x111)]=_0x44a81b,this['appEntity']=_0x31a3f8,this[_0x1cb6a7(0xb8)]=_0x5d355c;}async['create'](_0x1e1c77,_0x677556){const _0x6eb31b=_0x209fc6,{id:_0x4eb9ac}=_0x677556[_0x6eb31b(0xd4)],{appId:_0x26df81,modelConfig:_0x2b0afe,params:_0x2582ee}=_0x1e1c77;let _0x3eb71b=_0x2b0afe||await this['modelsService'][_0x6eb31b(0xf2)]();if(!_0x3eb71b)throw new common_1[(_0x6eb31b(0xf0))](_0x6eb31b(0xd6),common_1['HttpStatus'][_0x6eb31b(0xd3)]);_0x3eb71b=JSON['parse'](JSON[_0x6eb31b(0xe8)](_0x3eb71b));const _0x261e66={'title':_0x6eb31b(0xcf),'userId':_0x4eb9ac,'appId':_0x26df81,'params':_0x2582ee};if(_0x26df81){const _0x56d0a7=await this[_0x6eb31b(0x106)][_0x6eb31b(0xb6)]({'where':{'id':_0x26df81}});if(!_0x56d0a7)throw new common_1[(_0x6eb31b(0xf0))](_0x6eb31b(0x10a),common_1[_0x6eb31b(0xd1)][_0x6eb31b(0xd3)]);const {status:_0x1e4c03,name:_0x4b184d,isFixedModel:_0x4de53e,isGPTs:_0xbcef,appModel:_0x110a96,coverImg:_0x1ad05d}=_0x56d0a7;Object[_0x6eb31b(0x110)](_0x3eb71b['modelInfo'],{'isGPTs':_0xbcef,'isFixedModel':_0x4de53e,'modelAvatar':_0x1ad05d,'modelName':_0x4b184d});if(_0xbcef===0x1||_0x4de53e===0x1){const _0x4b0d28=await this[_0x6eb31b(0xb8)][_0x6eb31b(0x10f)](_0x4de53e===0x1?_0x110a96:_0x6eb31b(0xd7));Object[_0x6eb31b(0x110)](_0x3eb71b[_0x6eb31b(0xc1)],{'deductType':_0x4b0d28[_0x6eb31b(0x10b)],'deduct':_0x4b0d28['deduct'],'model':_0x110a96,'isFileUpload':_0x4b0d28['isFileUpload']});}if(![0x1,0x3,0x4,0x5][_0x6eb31b(0xe5)](_0x1e4c03))throw new common_1[(_0x6eb31b(0xf0))](_0x6eb31b(0xcd),common_1[_0x6eb31b(0xd1)]['BAD_REQUEST']);_0x4b184d&&(_0x261e66[_0x6eb31b(0xcc)]=_0x4b184d);}const _0x3f0416=await this[_0x6eb31b(0x111)][_0x6eb31b(0xfc)](Object[_0x6eb31b(0x110)](Object[_0x6eb31b(0x110)]({},_0x261e66),{'config':JSON[_0x6eb31b(0xe8)](_0x3eb71b)}));return _0x3f0416;}async['query'](_0x50f8b1){const _0x1e93d7=_0x209fc6;try{const {id:_0x1d2274}=_0x50f8b1['user'],_0x1a26e1={'userId':_0x1d2274,'isDelete':![]},_0x2fab1b=await this[_0x1e93d7(0x111)][_0x1e93d7(0xc6)]({'where':_0x1a26e1,'order':{'isSticky':_0x1e93d7(0xe3),'updatedAt':'DESC'}});return _0x2fab1b;const _0x2cdca5=_0x2fab1b[_0x1e93d7(0x102)](_0x1d4960=>_0x1d4960[_0x1e93d7(0xbe)])[_0x1e93d7(0xd9)](_0x52c8c1=>_0x52c8c1[_0x1e93d7(0xbe)]),_0x2ce0ca=await this[_0x1e93d7(0x106)]['find']({'where':{'id':(0x0,typeorm_2['In'])(_0x2cdca5)}});return _0x2fab1b[_0x1e93d7(0xd9)](_0xfb31cd=>{const _0x373283=_0x1e93d7;var _0x4d8faa;return _0xfb31cd[_0x373283(0xda)]=(_0x4d8faa=_0x2ce0ca['find'](_0x5b515e=>_0x5b515e['id']===_0xfb31cd[_0x373283(0xbe)]))===null||_0x4d8faa===void 0x0?void 0x0:_0x4d8faa[_0x373283(0xef)],_0xfb31cd;});}catch(_0x4849b6){console['log']('error:\x20',_0x4849b6);}}async[_0x209fc6(0xc2)](_0x1269a8,_0x1c087a){const _0x3f487c=_0x209fc6,{title:_0x259cc5,isSticky:_0x3b1e47,groupId:_0x28ee33,config:_0x138b36,fileUrl:_0x130494}=_0x1269a8,{id:_0x19f719}=_0x1c087a[_0x3f487c(0xd4)],_0x21a3aa=await this[_0x3f487c(0x111)][_0x3f487c(0xb6)]({'where':{'id':_0x28ee33,'userId':_0x19f719}});if(!_0x21a3aa)throw new common_1[(_0x3f487c(0xf0))](_0x3f487c(0xbd),common_1[_0x3f487c(0xd1)]['BAD_REQUEST']);const {appId:_0x25dafa}=_0x21a3aa;if(_0x25dafa&&!_0x259cc5)try{const _0x4463eb=JSON[_0x3f487c(0xce)](_0x138b36);if(Number(_0x4463eb[_0x3f487c(0xc5)])!==0x1)throw new common_1[(_0x3f487c(0xf0))]('应用对话名称不能修改哟！',common_1['HttpStatus'][_0x3f487c(0xd3)]);}catch(_0x540653){}const _0x2b1438={};_0x259cc5&&(_0x2b1438['title']=_0x259cc5),typeof _0x3b1e47!==_0x3f487c(0xe7)&&(_0x2b1438[_0x3f487c(0xc3)]=_0x3b1e47),_0x138b36&&(_0x2b1438['config']=_0x138b36),_0x130494&&(_0x2b1438[_0x3f487c(0xde)]=_0x130494);const _0x365580=await this[_0x3f487c(0x111)][_0x3f487c(0xc2)]({'id':_0x28ee33},_0x2b1438);if(_0x365580[_0x3f487c(0xd5)])return _0x130494&&this[_0x3f487c(0xd0)](_0x130494,_0x28ee33),!![];else throw new common_1[(_0x3f487c(0xf0))](_0x3f487c(0xec),common_1['HttpStatus'][_0x3f487c(0xd3)]);}async[_0x209fc6(0xd0)](_0x15d5db,_0x2adfc7){const _0x4bd76a=_0x209fc6;try{const _0x585c47=await this[_0x4bd76a(0x107)](_0x15d5db);await this[_0x4bd76a(0x111)][_0x4bd76a(0xc2)]({'id':_0x2adfc7},{'pdfTextContent':_0x585c47});}catch(_0x5f1249){console[_0x4bd76a(0xc7)]('PDF\x20读取失败:',_0x5f1249);}}async['extractPdfText'](_0x1b1851){const _0x52f463=_0x209fc6;try{const _0x321a8b=await axios_1[_0x52f463(0xf4)]['get'](_0x1b1851,{'responseType':_0x52f463(0x10d)}),_0x31f3a9=Buffer[_0x52f463(0xdf)](_0x321a8b['data']),_0x91be01=await pdf(_0x31f3a9);return _0x91be01[_0x52f463(0x108)];}catch(_0x324905){console[_0x52f463(0xc7)](_0x52f463(0xf5),_0x324905);throw new Error(_0x52f463(0xb7));}}async[_0x209fc6(0xf3)](_0x5d1d09){const _0x216b08=_0x209fc6;await this[_0x216b08(0x111)][_0x216b08(0xc2)](_0x5d1d09,{'updatedAt':new Date()});}async[_0x209fc6(0xf7)](_0x520e57,_0x444b7c){const _0x2c9858=_0x209fc6,{groupId:_0xb78fa4}=_0x520e57,{id:_0x42b179}=_0x444b7c['user'],_0x211a1d=await this[_0x2c9858(0x111)][_0x2c9858(0xb6)]({'where':{'id':_0xb78fa4,'userId':_0x42b179}});if(!_0x211a1d)throw new common_1[(_0x2c9858(0xf0))]('非法操作、您在删除一个非法资源！',common_1[_0x2c9858(0xd1)][_0x2c9858(0xd3)]);const _0x21420e=await this[_0x2c9858(0x111)][_0x2c9858(0xc2)]({'id':_0xb78fa4},{'isDelete':!![]});if(_0x21420e[_0x2c9858(0xd5)])return _0x2c9858(0xb5);else throw new common_1[(_0x2c9858(0xf0))]('删除失败！',common_1[_0x2c9858(0xd1)][_0x2c9858(0xd3)]);}async[_0x209fc6(0xf9)](_0x3b3f88){const _0x27ed7d=_0x209fc6,{id:_0x195e0f}=_0x3b3f88['user'],_0x4e5449=await this[_0x27ed7d(0x111)][_0x27ed7d(0xc2)]({'userId':_0x195e0f,'isSticky':![],'isDelete':![]},{'isDelete':!![]});if(_0x4e5449[_0x27ed7d(0xd5)])return _0x27ed7d(0xb5);else throw new common_1[(_0x27ed7d(0xf0))]('删除失败！',common_1[_0x27ed7d(0xd1)][_0x27ed7d(0xd3)]);}async[_0x209fc6(0xdc)](_0x5b6451){const _0x41fbf5=_0x209fc6;if(!_0x5b6451)return;const _0x2394b4=await this[_0x41fbf5(0x111)][_0x41fbf5(0xb6)]({'where':{'id':_0x5b6451}});if(_0x2394b4){const {pdfTextContent:_0x1d8923}=_0x2394b4,_0x4fa74a=__rest(_0x2394b4,[_0x41fbf5(0xd8)]);return _0x4fa74a;}}async['getGroupPdfText'](_0x298a4d){const _0x190952=_0x209fc6,_0x5043fe=await this[_0x190952(0x111)][_0x190952(0xb6)]({'where':{'id':_0x298a4d}});if(_0x5043fe)return _0x5043fe['pdfTextContent'];}};ChatGroupService=__decorate([(0x0,common_1[_0x209fc6(0xe9)])(),__param(0x0,(0x0,typeorm_1['InjectRepository'])(chatGroup_entity_1[_0x209fc6(0xc8)])),__param(0x1,(0x0,typeorm_1[_0x209fc6(0xeb)])(app_entity_1['AppEntity'])),__metadata(_0x209fc6(0x100),[typeorm_2[_0x209fc6(0xff)],typeorm_2[_0x209fc6(0xff)],models_service_1[_0x209fc6(0x10c)]])],ChatGroupService),exports[_0x209fc6(0xbc)]=ChatGroupService;