'use strict';function _0x4659(){const _0x99d503=['BAD_REQUEST','InjectRepository','删除成功','HttpStatus','getOwnPropertyDescriptor','hasOwnProperty','update','209393tRBIqR','appEntity','__metadata','assign','save','handlePdfExtraction','appId','error:\x20','ChatGroupService','14AUudfR','管理员未配置任何AI模型、请先联系管理员开通聊天模型配置！','非法操作、您在删除一个非法资源！','arraybuffer','findOne','defineProperty','chatGroupEntity','PDF\x20解析失败:','374dBOjdF','query','@nestjs/typeorm','stringify','PDF\x20解析失败','6igxxNM','indexOf','error','新对话','936708RZVxcX','getCurrentModelKeyInfo','create','应用对话名称不能修改哟！','2656lOkhDw','user','extractPdfText','modelInfo','keyType','AppEntity','modelsService','4282680UJOpWM','../app/app.entity','2109282Vtkusr','metadata','appLogo','map','undefined','function','__rest','filter','非法操作、您在使用一个不存在的应用！','getGroupInfoFromId','931974XCtRne','deductType','getBaseConfig','get','text','gpts','object','5436KcADps','delAll','1994415UltmkW','includes','删除失败！','title','__esModule','getOwnPropertySymbols','HttpException','__param','affected','__decorate','design:paramtypes','coverImg','find','16xHuZal','非法操作、您在使用一个未启用的应用！','propertyIsEnumerable','length','请先选择一个对话或者新加一个对话再操作！','prototype','default','call','updateTime','del','Repository','DESC','PDF\x20读取失败:','axios','isSticky','../models/models.service','getGroupPdfText','decorate','pdfTextContent','@nestjs/common','./chatGroup.entity'];_0x4659=function(){return _0x99d503;};return _0x4659();}const _0x1a3549=_0x1dee;(function(_0x2f7b11,_0x18cffb){const _0x530edf=_0x1dee,_0x2c98bf=_0x2f7b11();while(!![]){try{const _0x46191a=parseInt(_0x530edf(0x1be))/0x1*(parseInt(_0x530edf(0x1c7))/0x2)+parseInt(_0x530edf(0x1ef))/0x3*(parseInt(_0x530edf(0x1a2))/0x4)+-parseInt(_0x530edf(0x1f8))/0x5*(-parseInt(_0x530edf(0x1d4))/0x6)+-parseInt(_0x530edf(0x1e5))/0x7+-parseInt(_0x530edf(0x1dc))/0x8*(-parseInt(_0x530edf(0x1f6))/0x9)+parseInt(_0x530edf(0x1e3))/0xa+-parseInt(_0x530edf(0x1cf))/0xb*(parseInt(_0x530edf(0x1d8))/0xc);if(_0x46191a===_0x18cffb)break;else _0x2c98bf['push'](_0x2c98bf['shift']());}catch(_0xc59e02){_0x2c98bf['push'](_0x2c98bf['shift']());}}}(_0x4659,0xbe9ba));function _0x1dee(_0x45098f,_0x39ad10){const _0x465959=_0x4659();return _0x1dee=function(_0x1dee39,_0x1990ef){_0x1dee39=_0x1dee39-0x197;let _0x3df190=_0x465959[_0x1dee39];return _0x3df190;},_0x1dee(_0x45098f,_0x39ad10);}var __decorate=this&&this[_0x1a3549(0x19e)]||function(_0x182ffe,_0x475964,_0x987646,_0x1f9ce5){const _0x3dd7c2=_0x1a3549;var _0x435357=arguments['length'],_0x4fbcd4=_0x435357<0x3?_0x475964:_0x1f9ce5===null?_0x1f9ce5=Object[_0x3dd7c2(0x1bb)](_0x475964,_0x987646):_0x1f9ce5,_0xf4563b;if(typeof Reflect===_0x3dd7c2(0x1f5)&&typeof Reflect[_0x3dd7c2(0x1b3)]===_0x3dd7c2(0x1ea))_0x4fbcd4=Reflect[_0x3dd7c2(0x1b3)](_0x182ffe,_0x475964,_0x987646,_0x1f9ce5);else{for(var _0x38f51f=_0x182ffe['length']-0x1;_0x38f51f>=0x0;_0x38f51f--)if(_0xf4563b=_0x182ffe[_0x38f51f])_0x4fbcd4=(_0x435357<0x3?_0xf4563b(_0x4fbcd4):_0x435357>0x3?_0xf4563b(_0x475964,_0x987646,_0x4fbcd4):_0xf4563b(_0x475964,_0x987646))||_0x4fbcd4;}return _0x435357>0x3&&_0x4fbcd4&&Object[_0x3dd7c2(0x1cc)](_0x475964,_0x987646,_0x4fbcd4),_0x4fbcd4;},__metadata=this&&this[_0x1a3549(0x1c0)]||function(_0x1c99b5,_0xd8ca8f){const _0x195705=_0x1a3549;if(typeof Reflect===_0x195705(0x1f5)&&typeof Reflect[_0x195705(0x1e6)]===_0x195705(0x1ea))return Reflect[_0x195705(0x1e6)](_0x1c99b5,_0xd8ca8f);},__param=this&&this[_0x1a3549(0x19c)]||function(_0x14b691,_0xf2c55b){return function(_0x4ef936,_0x1a2047){_0xf2c55b(_0x4ef936,_0x1a2047,_0x14b691);};},__rest=this&&this[_0x1a3549(0x1eb)]||function(_0x4a02fe,_0x34f060){const _0x317580=_0x1a3549;var _0x32f5b6={};for(var _0x38e81c in _0x4a02fe)if(Object[_0x317580(0x1a7)][_0x317580(0x1bc)][_0x317580(0x1a9)](_0x4a02fe,_0x38e81c)&&_0x34f060[_0x317580(0x1d5)](_0x38e81c)<0x0)_0x32f5b6[_0x38e81c]=_0x4a02fe[_0x38e81c];if(_0x4a02fe!=null&&typeof Object[_0x317580(0x19a)]==='function')for(var _0x544627=0x0,_0x38e81c=Object[_0x317580(0x19a)](_0x4a02fe);_0x544627<_0x38e81c[_0x317580(0x1a5)];_0x544627++){if(_0x34f060[_0x317580(0x1d5)](_0x38e81c[_0x544627])<0x0&&Object[_0x317580(0x1a7)][_0x317580(0x1a4)][_0x317580(0x1a9)](_0x4a02fe,_0x38e81c[_0x544627]))_0x32f5b6[_0x38e81c[_0x544627]]=_0x4a02fe[_0x38e81c[_0x544627]];}return _0x32f5b6;};Object[_0x1a3549(0x1cc)](exports,_0x1a3549(0x199),{'value':!![]}),exports[_0x1a3549(0x1c6)]=void 0x0;const common_1=require(_0x1a3549(0x1b5)),typeorm_1=require(_0x1a3549(0x1d1)),axios_1=require(_0x1a3549(0x1af)),pdf=require('pdf-parse'),typeorm_2=require('typeorm'),app_entity_1=require(_0x1a3549(0x1e4)),models_service_1=require(_0x1a3549(0x1b1)),chatGroup_entity_1=require(_0x1a3549(0x1b6));let ChatGroupService=class ChatGroupService{constructor(_0x376736,_0x361d55,_0x3374f2){const _0x2bcdfb=_0x1a3549;this[_0x2bcdfb(0x1cd)]=_0x376736,this[_0x2bcdfb(0x1bf)]=_0x361d55,this[_0x2bcdfb(0x1e2)]=_0x3374f2;}async[_0x1a3549(0x1da)](_0xcacac2,_0x7b49c3){const _0xd6aa4b=_0x1a3549,{id:_0xc5978e}=_0x7b49c3['user'],{appId:_0x1c798c,modelConfig:_0xdcb52d,params:_0x48f76e}=_0xcacac2;let _0x1756aa=_0xdcb52d||await this[_0xd6aa4b(0x1e2)][_0xd6aa4b(0x1f1)]();if(!_0x1756aa)throw new common_1['HttpException'](_0xd6aa4b(0x1c8),common_1[_0xd6aa4b(0x1ba)][_0xd6aa4b(0x1b7)]);_0x1756aa=JSON['parse'](JSON[_0xd6aa4b(0x1d2)](_0x1756aa));const _0x44ae0e={'title':_0xd6aa4b(0x1d7),'userId':_0xc5978e,'appId':_0x1c798c,'params':_0x48f76e};if(_0x1c798c){const _0x173fee=await this[_0xd6aa4b(0x1bf)]['findOne']({'where':{'id':_0x1c798c}});if(!_0x173fee)throw new common_1['HttpException'](_0xd6aa4b(0x1ed),common_1[_0xd6aa4b(0x1ba)][_0xd6aa4b(0x1b7)]);const {status:_0x10a087,name:_0xfd05c0,isFixedModel:_0x59b572,isGPTs:_0x78af86,appModel:_0x14c4e9,coverImg:_0x3a3baf}=_0x173fee;Object['assign'](_0x1756aa[_0xd6aa4b(0x1df)],{'isGPTs':_0x78af86,'isFixedModel':_0x59b572,'modelAvatar':_0x3a3baf,'modelName':_0xfd05c0});if(_0x78af86===0x1||_0x59b572===0x1){const _0x459c35=await this[_0xd6aa4b(0x1e2)][_0xd6aa4b(0x1d9)](_0x59b572===0x1?_0x14c4e9:_0xd6aa4b(0x1f4));Object['assign'](_0x1756aa[_0xd6aa4b(0x1df)],{'deductType':_0x459c35[_0xd6aa4b(0x1f0)],'deduct':_0x459c35['deduct'],'model':_0x14c4e9,'isFileUpload':_0x459c35['isFileUpload']});}if(![0x1,0x3,0x4,0x5][_0xd6aa4b(0x1f9)](_0x10a087))throw new common_1[(_0xd6aa4b(0x19b))](_0xd6aa4b(0x1a3),common_1[_0xd6aa4b(0x1ba)][_0xd6aa4b(0x1b7)]);_0xfd05c0&&(_0x44ae0e[_0xd6aa4b(0x198)]=_0xfd05c0);}const _0x20664f=await this['chatGroupEntity'][_0xd6aa4b(0x1c2)](Object[_0xd6aa4b(0x1c1)](Object[_0xd6aa4b(0x1c1)]({},_0x44ae0e),{'config':JSON[_0xd6aa4b(0x1d2)](_0x1756aa)}));return _0x20664f;}async[_0x1a3549(0x1d0)](_0x3ef61a){const _0x8a1ab0=_0x1a3549;try{const {id:_0x12ef74}=_0x3ef61a[_0x8a1ab0(0x1dd)],_0x157505={'userId':_0x12ef74,'isDelete':![]},_0x201cd2=await this[_0x8a1ab0(0x1cd)][_0x8a1ab0(0x1a1)]({'where':_0x157505,'order':{'isSticky':_0x8a1ab0(0x1ad),'updatedAt':_0x8a1ab0(0x1ad)}});return _0x201cd2;const _0x555b6c=_0x201cd2[_0x8a1ab0(0x1ec)](_0x28c175=>_0x28c175[_0x8a1ab0(0x1c4)])['map'](_0x57f246=>_0x57f246[_0x8a1ab0(0x1c4)]),_0x996cb1=await this[_0x8a1ab0(0x1bf)]['find']({'where':{'id':(0x0,typeorm_2['In'])(_0x555b6c)}});return _0x201cd2[_0x8a1ab0(0x1e8)](_0x174d0d=>{const _0x59d59c=_0x8a1ab0;var _0x5987c9;return _0x174d0d[_0x59d59c(0x1e7)]=(_0x5987c9=_0x996cb1[_0x59d59c(0x1a1)](_0x4ac606=>_0x4ac606['id']===_0x174d0d[_0x59d59c(0x1c4)]))===null||_0x5987c9===void 0x0?void 0x0:_0x5987c9[_0x59d59c(0x1a0)],_0x174d0d;});}catch(_0x3c050e){console['log'](_0x8a1ab0(0x1c5),_0x3c050e);}}async[_0x1a3549(0x1bd)](_0x4e4ac0,_0x2d2c3f){const _0x1823c3=_0x1a3549,{title:_0x59dc3f,isSticky:_0x1d08f5,groupId:_0x41a485,config:_0x463a69,fileUrl:_0x3b2b4a}=_0x4e4ac0,{id:_0x721c2f}=_0x2d2c3f['user'],_0xe38238=await this[_0x1823c3(0x1cd)][_0x1823c3(0x1cb)]({'where':{'id':_0x41a485,'userId':_0x721c2f}});if(!_0xe38238)throw new common_1[(_0x1823c3(0x19b))](_0x1823c3(0x1a6),common_1['HttpStatus'][_0x1823c3(0x1b7)]);const {appId:_0x2b5a13}=_0xe38238;if(_0x2b5a13&&!_0x59dc3f)try{const _0x4eae36=JSON['parse'](_0x463a69);if(Number(_0x4eae36[_0x1823c3(0x1e0)])!==0x1)throw new common_1[(_0x1823c3(0x19b))](_0x1823c3(0x1db),common_1['HttpStatus']['BAD_REQUEST']);}catch(_0x1ea64f){}const _0x4b3df4={};_0x59dc3f&&(_0x4b3df4['title']=_0x59dc3f),typeof _0x1d08f5!==_0x1823c3(0x1e9)&&(_0x4b3df4[_0x1823c3(0x1b0)]=_0x1d08f5),_0x463a69&&(_0x4b3df4['config']=_0x463a69),_0x3b2b4a&&(_0x4b3df4['fileUrl']=_0x3b2b4a);const _0x451aef=await this['chatGroupEntity']['update']({'id':_0x41a485},_0x4b3df4);if(_0x451aef['affected'])return _0x3b2b4a&&this[_0x1823c3(0x1c3)](_0x3b2b4a,_0x41a485),!![];else throw new common_1['HttpException']('更新对话失败！',common_1['HttpStatus'][_0x1823c3(0x1b7)]);}async[_0x1a3549(0x1c3)](_0x181319,_0x5e25bd){const _0x1a0ed9=_0x1a3549;try{const _0x182af5=await this[_0x1a0ed9(0x1de)](_0x181319);await this[_0x1a0ed9(0x1cd)][_0x1a0ed9(0x1bd)]({'id':_0x5e25bd},{'pdfTextContent':_0x182af5});}catch(_0x4ac26c){console[_0x1a0ed9(0x1d6)](_0x1a0ed9(0x1ae),_0x4ac26c);}}async[_0x1a3549(0x1de)](_0xa66650){const _0x50faf6=_0x1a3549;try{const _0x27a8f7=await axios_1[_0x50faf6(0x1a8)][_0x50faf6(0x1f2)](_0xa66650,{'responseType':_0x50faf6(0x1ca)}),_0x2744c9=Buffer['from'](_0x27a8f7['data']),_0x52a5e4=await pdf(_0x2744c9);return _0x52a5e4[_0x50faf6(0x1f3)];}catch(_0x237e87){console['error'](_0x50faf6(0x1ce),_0x237e87);throw new Error(_0x50faf6(0x1d3));}}async[_0x1a3549(0x1aa)](_0x5f1431){const _0x5247a6=_0x1a3549;await this[_0x5247a6(0x1cd)][_0x5247a6(0x1bd)](_0x5f1431,{'updatedAt':new Date()});}async[_0x1a3549(0x1ab)](_0x47c7b6,_0x45a4e0){const _0x5c4f7a=_0x1a3549,{groupId:_0x30fb0d}=_0x47c7b6,{id:_0x170247}=_0x45a4e0[_0x5c4f7a(0x1dd)],_0x2ce9df=await this[_0x5c4f7a(0x1cd)][_0x5c4f7a(0x1cb)]({'where':{'id':_0x30fb0d,'userId':_0x170247}});if(!_0x2ce9df)throw new common_1[(_0x5c4f7a(0x19b))](_0x5c4f7a(0x1c9),common_1[_0x5c4f7a(0x1ba)][_0x5c4f7a(0x1b7)]);const _0x130441=await this[_0x5c4f7a(0x1cd)][_0x5c4f7a(0x1bd)]({'id':_0x30fb0d},{'isDelete':!![]});if(_0x130441[_0x5c4f7a(0x19d)])return _0x5c4f7a(0x1b9);else throw new common_1[(_0x5c4f7a(0x19b))](_0x5c4f7a(0x197),common_1[_0x5c4f7a(0x1ba)][_0x5c4f7a(0x1b7)]);}async[_0x1a3549(0x1f7)](_0x485bcc){const _0x2f30a8=_0x1a3549,{id:_0x3ea162}=_0x485bcc[_0x2f30a8(0x1dd)],_0x13cdb1=await this[_0x2f30a8(0x1cd)][_0x2f30a8(0x1bd)]({'userId':_0x3ea162,'isSticky':![],'isDelete':![]},{'isDelete':!![]});if(_0x13cdb1[_0x2f30a8(0x19d)])return _0x2f30a8(0x1b9);else throw new common_1['HttpException'](_0x2f30a8(0x197),common_1['HttpStatus'][_0x2f30a8(0x1b7)]);}async[_0x1a3549(0x1ee)](_0x213c8d){const _0x26d6f7=_0x1a3549;if(!_0x213c8d)return;const _0x41629a=await this['chatGroupEntity'][_0x26d6f7(0x1cb)]({'where':{'id':_0x213c8d}});if(_0x41629a){const {pdfTextContent:_0x23757d}=_0x41629a,_0x1efcdd=__rest(_0x41629a,[_0x26d6f7(0x1b4)]);return _0x1efcdd;}}async[_0x1a3549(0x1b2)](_0x150058){const _0x3e02d8=_0x1a3549,_0x3c5694=await this[_0x3e02d8(0x1cd)][_0x3e02d8(0x1cb)]({'where':{'id':_0x150058}});if(_0x3c5694)return _0x3c5694['pdfTextContent'];}};ChatGroupService=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,typeorm_1[_0x1a3549(0x1b8)])(chatGroup_entity_1['ChatGroupEntity'])),__param(0x1,(0x0,typeorm_1[_0x1a3549(0x1b8)])(app_entity_1[_0x1a3549(0x1e1)])),__metadata(_0x1a3549(0x19f),[typeorm_2[_0x1a3549(0x1ac)],typeorm_2['Repository'],models_service_1['ModelsService']])],ChatGroupService),exports['ChatGroupService']=ChatGroupService;