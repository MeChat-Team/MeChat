'use strict';const _0x4a1d66=_0x11b1;function _0x11b1(_0x2d4fa0,_0x492859){const _0x1f0afc=_0x1f0a();return _0x11b1=function(_0x11b1ab,_0x26a02b){_0x11b1ab=_0x11b1ab-0x13f;let _0x5e9fd7=_0x1f0afc[_0x11b1ab];return _0x5e9fd7;},_0x11b1(_0x2d4fa0,_0x492859);}(function(_0x557785,_0x39bcbe){const _0x2fc320=_0x11b1,_0x5ee69f=_0x557785();while(!![]){try{const _0x5a08a8=parseInt(_0x2fc320(0x189))/0x1*(parseInt(_0x2fc320(0x171))/0x2)+parseInt(_0x2fc320(0x14b))/0x3+parseInt(_0x2fc320(0x18a))/0x4*(parseInt(_0x2fc320(0x18e))/0x5)+-parseInt(_0x2fc320(0x173))/0x6*(parseInt(_0x2fc320(0x18f))/0x7)+parseInt(_0x2fc320(0x163))/0x8*(parseInt(_0x2fc320(0x17b))/0x9)+parseInt(_0x2fc320(0x169))/0xa+parseInt(_0x2fc320(0x153))/0xb*(-parseInt(_0x2fc320(0x19b))/0xc);if(_0x5a08a8===_0x39bcbe)break;else _0x5ee69f['push'](_0x5ee69f['shift']());}catch(_0x570baa){_0x5ee69f['push'](_0x5ee69f['shift']());}}}(_0x1f0a,0xe1683));var __decorate=this&&this[_0x4a1d66(0x146)]||function(_0x382666,_0x86e15e,_0x45a230,_0x286368){const _0x22edc6=_0x4a1d66;var _0x69f6ef=arguments[_0x22edc6(0x151)],_0x190fb6=_0x69f6ef<0x3?_0x86e15e:_0x286368===null?_0x286368=Object['getOwnPropertyDescriptor'](_0x86e15e,_0x45a230):_0x286368,_0x1c3e02;if(typeof Reflect==='object'&&typeof Reflect[_0x22edc6(0x143)]===_0x22edc6(0x199))_0x190fb6=Reflect[_0x22edc6(0x143)](_0x382666,_0x86e15e,_0x45a230,_0x286368);else{for(var _0xac7a3b=_0x382666[_0x22edc6(0x151)]-0x1;_0xac7a3b>=0x0;_0xac7a3b--)if(_0x1c3e02=_0x382666[_0xac7a3b])_0x190fb6=(_0x69f6ef<0x3?_0x1c3e02(_0x190fb6):_0x69f6ef>0x3?_0x1c3e02(_0x86e15e,_0x45a230,_0x190fb6):_0x1c3e02(_0x86e15e,_0x45a230))||_0x190fb6;}return _0x69f6ef>0x3&&_0x190fb6&&Object[_0x22edc6(0x16a)](_0x86e15e,_0x45a230,_0x190fb6),_0x190fb6;},__metadata=this&&this['__metadata']||function(_0x2b82dc,_0x4eeb78){const _0x53fb94=_0x4a1d66;if(typeof Reflect===_0x53fb94(0x193)&&typeof Reflect[_0x53fb94(0x194)]===_0x53fb94(0x199))return Reflect['metadata'](_0x2b82dc,_0x4eeb78);},__param=this&&this[_0x4a1d66(0x17d)]||function(_0x34db47,_0x44349d){return function(_0x501a14,_0x1f3c70){_0x44349d(_0x501a14,_0x1f3c70,_0x34db47);};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[_0x4a1d66(0x160)]=void 0x0;function _0x1f0a(){const _0x27902f=['ISDEV','design:returntype','decorate','../../common/utils','genXmlMsgByConfig','__decorate','ApiOperation','env','url','@nestjs/common','4093584jPEpcJ','eventkey','https://mp.weixin.qq.com','content','prototype','weChatMpUrl','length','design:paramtypes','959926VNgema','formatUrl','notifyPost','JwtAuthGuard','ApiTags','UseGuards','scanBindWx','CLICK','getRedirectUrl','GetQrCodeDto','officialService','send','扫码绑定轮询查询','OfficialController','./official.service','includes','1114008iLzDpg','获取登录二维码sceneStr','loginBySceneStr','公众号静默登录','获取二维码','event','18254900BhfLXT','defineProperty','获取注册配置','getQRCode','Query','Post','Get','notify','1175844JLkrLs','unsubscribe','19038rJbaMH','@nestjs/swagger','getQRSceneStrByBind','getJsapiTicket','Controller','bindWxBySceneStr','officialSubscribeText','officialBindAccountText','9RedkDK','getQRCodeTicket','__param','split','status','getQRSceneStr','get\x20通知>>>','获取登录跳转地址','Res','nonce','扫码登录轮询查询','OfficialService','fromusername','official','1FFXHvR','184396UhVdZe','echostr','msgtype','Body','5yttbjt','161MqFVQk','TRUE','获取绑定二维码的sceneStr','design:type','object','metadata','Req','genXmlMsg','log','sceneStr','function','text','408RgBYfG','loginByCode','scan'];_0x1f0a=function(){return _0x27902f;};return _0x1f0a();}const jwtAuth_guard_1=require('../../common/auth/jwtAuth.guard'),utils_1=require(_0x4a1d66(0x144)),common_1=require(_0x4a1d66(0x14a)),swagger_1=require(_0x4a1d66(0x174)),getQrCode_dto_1=require('./dto/getQrCode.dto'),official_service_1=require(_0x4a1d66(0x161));let OfficialController=class OfficialController{constructor(_0x3e9827){const _0x385595=_0x4a1d66;this[_0x385595(0x15d)]=_0x3e9827;}async[_0x4a1d66(0x170)](_0x2a97ed,_0x14e34f,_0x59567b){const _0x3b62f0=_0x4a1d66;console['log'](_0x3b62f0(0x181),_0x14e34f,_0x59567b);const _0x5afb51=await this[_0x3b62f0(0x15d)]['verify'](_0x14e34f['signature'],_0x14e34f[_0x3b62f0(0x184)],_0x14e34f['timestamp']);return _0x5afb51?_0x14e34f[_0x3b62f0(0x18b)]:'';}async['notifyPost'](_0xbdae32,_0x3fbd2a,_0x345590,_0x584cc5){const _0x46ac86=_0x4a1d66,{xml:_0x4355da}=_0x345590;console[_0x46ac86(0x197)]('xml:\x20',_0x4355da);if(_0x4355da[_0x46ac86(0x18c)][0x0]==_0x46ac86(0x168)){if(_0x4355da[_0x46ac86(0x168)][0x0]=='VIEW'||_0x4355da[_0x46ac86(0x168)][0x0]==_0x46ac86(0x15a))return _0x584cc5[_0x46ac86(0x17f)](0xc8)[_0x46ac86(0x15e)]('');if(_0x4355da['event'][0x0]=='SCAN'){console['log']('扫码');const _0x133d2d=_0x4355da[_0x46ac86(0x14c)][0x0];if(_0x133d2d[_0x46ac86(0x162)]('/')){this['officialService'][_0x46ac86(0x159)](_0x4355da[_0x46ac86(0x187)][0x0],_0x133d2d);const _0xc28333=await this[_0x46ac86(0x15d)][_0x46ac86(0x145)](_0x4355da,'officialBindAccountText');return _0x584cc5['status'](0xc8)['send'](_0xc28333);}this['officialService'][_0x46ac86(0x140)](_0x4355da['fromusername'][0x0],_0x133d2d);const _0x4ff8c7=await this[_0x46ac86(0x15d)][_0x46ac86(0x145)](_0x4355da,'officialScanLoginText');return _0x584cc5[_0x46ac86(0x17f)](0xc8)['send'](_0x4ff8c7);}if(_0x4355da[_0x46ac86(0x168)][0x0]=='subscribe'){console[_0x46ac86(0x197)]('订阅',_0x4355da[_0x46ac86(0x14c)][0x0]);const _0x220249=_0x4355da[_0x46ac86(0x14c)][0x0][_0x46ac86(0x17e)]('qrscene_')[0x1];console[_0x46ac86(0x197)]('sceneStr:\x20',_0x220249);if(!_0x220249){const _0x3e10e0=await this[_0x46ac86(0x15d)][_0x46ac86(0x145)](_0x4355da,'officialSubscribeText');return _0x584cc5[_0x46ac86(0x17f)](0xc8)[_0x46ac86(0x15e)](_0x3e10e0);}if(_0x220249[_0x46ac86(0x162)]('/')){this['officialService']['scanBindWx'](_0x4355da[_0x46ac86(0x187)][0x0],_0x220249);const _0x2e6082=await this[_0x46ac86(0x15d)][_0x46ac86(0x145)](_0x4355da,_0x46ac86(0x17a));return _0x584cc5[_0x46ac86(0x17f)](0xc8)[_0x46ac86(0x15e)](_0x2e6082);}this[_0x46ac86(0x15d)][_0x46ac86(0x140)](_0x4355da['fromusername'][0x0],_0x220249);const _0x44fca3=await this['officialService']['genXmlMsgByConfig'](_0x4355da,_0x46ac86(0x179));return _0x584cc5['status'](0xc8)['send'](_0x44fca3);}if(_0x4355da['event'][0x0]==_0x46ac86(0x172))return _0x584cc5['status'](0xc8)['send']('');}if(_0x4355da[_0x46ac86(0x18c)][0x0]==_0x46ac86(0x19a)){const _0x311339=await this[_0x46ac86(0x15d)]['aotoPlay'](_0x4355da[_0x46ac86(0x14e)][0x0]),_0x41beee=await this[_0x46ac86(0x15d)][_0x46ac86(0x196)](_0x4355da,_0x311339);return _0x584cc5[_0x46ac86(0x17f)](0xc8)['send'](_0x41beee);}return'success';}async['getQRSceneStr'](){const _0x3922e2=_0x4a1d66;return this[_0x3922e2(0x15d)][_0x3922e2(0x180)]();}async[_0x4a1d66(0x175)](_0x779eee){const _0x46689f=_0x4a1d66;return this[_0x46689f(0x15d)][_0x46689f(0x175)](_0x779eee);}async['getQRCode'](_0x4fddc9){const _0x2aece9=_0x4a1d66;if(process['env'][_0x2aece9(0x141)]===_0x2aece9(0x190))return'';const _0xcef58=await this[_0x2aece9(0x15d)][_0x2aece9(0x17c)](_0x4fddc9[_0x2aece9(0x198)]),_0x5996b8=(0x0,utils_1[_0x2aece9(0x154)])(process[_0x2aece9(0x148)][_0x2aece9(0x150)]||_0x2aece9(0x14d));return _0x5996b8+'/cgi-bin/showqrcode?ticket='+encodeURIComponent(_0xcef58);}async[_0x4a1d66(0x165)](_0x3c7ceb,_0x356731){const _0x2214da=_0x4a1d66;return this['officialService'][_0x2214da(0x165)](_0x3c7ceb,_0x356731);}async[_0x4a1d66(0x178)](_0x115591,_0x1e6599){const _0x1e6dab=_0x4a1d66;return this[_0x1e6dab(0x15d)][_0x1e6dab(0x178)](_0x115591,_0x1e6599[_0x1e6dab(0x198)]);}async[_0x4a1d66(0x15b)](_0x57a337){const _0x1968a0=_0x4a1d66;return this[_0x1968a0(0x15d)][_0x1968a0(0x15b)](_0x57a337['url']);}async['getJsapiTicket'](_0x4b17a3){const _0x3b8e45=_0x4a1d66;return this['officialService']['getJsapiTicket'](_0x4b17a3[_0x3b8e45(0x149)]);}async[_0x4a1d66(0x13f)](_0x2088a7,_0x2b7e87){const _0x1775d7=_0x4a1d66;return this['officialService'][_0x1775d7(0x13f)](_0x2088a7,_0x2b7e87['code']);}};__decorate([(0x0,common_1[_0x4a1d66(0x16f)])(_0x4a1d66(0x170)),(0x0,swagger_1[_0x4a1d66(0x147)])({'summary':'公众号通知接口GET'}),__param(0x0,(0x0,common_1['Req'])()),__param(0x1,(0x0,common_1['Query'])()),__param(0x2,(0x0,common_1[_0x4a1d66(0x18d)])()),__metadata('design:type',Function),__metadata(_0x4a1d66(0x152),[Object,Object,Object]),__metadata('design:returntype',Promise)],OfficialController[_0x4a1d66(0x14f)],_0x4a1d66(0x170),null),__decorate([(0x0,common_1[_0x4a1d66(0x16e)])(_0x4a1d66(0x170)),(0x0,swagger_1[_0x4a1d66(0x147)])({'summary':'公众号通知接口POST'}),__param(0x0,(0x0,common_1[_0x4a1d66(0x195)])()),__param(0x1,(0x0,common_1[_0x4a1d66(0x16d)])()),__param(0x2,(0x0,common_1[_0x4a1d66(0x18d)])()),__param(0x3,(0x0,common_1[_0x4a1d66(0x183)])()),__metadata(_0x4a1d66(0x192),Function),__metadata('design:paramtypes',[Object,Object,Object,Object]),__metadata('design:returntype',Promise)],OfficialController['prototype'],_0x4a1d66(0x155),null),__decorate([(0x0,common_1[_0x4a1d66(0x16e)])(_0x4a1d66(0x180)),(0x0,swagger_1[_0x4a1d66(0x147)])({'summary':_0x4a1d66(0x164)}),__metadata('design:type',Function),__metadata(_0x4a1d66(0x152),[]),__metadata(_0x4a1d66(0x142),Promise)],OfficialController[_0x4a1d66(0x14f)],'getQRSceneStr',null),__decorate([(0x0,common_1['Post'])(_0x4a1d66(0x175)),(0x0,swagger_1['ApiOperation'])({'summary':_0x4a1d66(0x191)}),(0x0,common_1['UseGuards'])(jwtAuth_guard_1['JwtAuthGuard']),__param(0x0,(0x0,common_1['Req'])()),__metadata(_0x4a1d66(0x192),Function),__metadata(_0x4a1d66(0x152),[Object]),__metadata('design:returntype',Promise)],OfficialController['prototype'],_0x4a1d66(0x175),null),__decorate([(0x0,common_1[_0x4a1d66(0x16f)])(_0x4a1d66(0x16c)),(0x0,swagger_1[_0x4a1d66(0x147)])({'summary':_0x4a1d66(0x167)}),__param(0x0,(0x0,common_1[_0x4a1d66(0x16d)])()),__metadata(_0x4a1d66(0x192),Function),__metadata(_0x4a1d66(0x152),[getQrCode_dto_1[_0x4a1d66(0x15c)]]),__metadata(_0x4a1d66(0x142),Promise)],OfficialController[_0x4a1d66(0x14f)],_0x4a1d66(0x16c),null),__decorate([(0x0,common_1[_0x4a1d66(0x16e)])(_0x4a1d66(0x165)),(0x0,swagger_1[_0x4a1d66(0x147)])({'summary':_0x4a1d66(0x185)}),__param(0x0,(0x0,common_1[_0x4a1d66(0x195)])()),__param(0x1,(0x0,common_1[_0x4a1d66(0x18d)])()),__metadata(_0x4a1d66(0x192),Function),__metadata('design:paramtypes',[Object,Object]),__metadata(_0x4a1d66(0x142),Promise)],OfficialController['prototype'],_0x4a1d66(0x165),null),__decorate([(0x0,common_1[_0x4a1d66(0x16e)])(_0x4a1d66(0x178)),(0x0,swagger_1[_0x4a1d66(0x147)])({'summary':_0x4a1d66(0x15f)}),(0x0,common_1[_0x4a1d66(0x158)])(jwtAuth_guard_1[_0x4a1d66(0x156)]),__param(0x0,(0x0,common_1[_0x4a1d66(0x195)])()),__param(0x1,(0x0,common_1['Body'])()),__metadata(_0x4a1d66(0x192),Function),__metadata(_0x4a1d66(0x152),[Object,getQrCode_dto_1[_0x4a1d66(0x15c)]]),__metadata(_0x4a1d66(0x142),Promise)],OfficialController[_0x4a1d66(0x14f)],_0x4a1d66(0x178),null),__decorate([(0x0,common_1['Post'])(_0x4a1d66(0x15b)),(0x0,swagger_1[_0x4a1d66(0x147)])({'summary':_0x4a1d66(0x182)}),__param(0x0,(0x0,common_1[_0x4a1d66(0x18d)])()),__metadata(_0x4a1d66(0x192),Function),__metadata(_0x4a1d66(0x152),[Object]),__metadata(_0x4a1d66(0x142),Promise)],OfficialController[_0x4a1d66(0x14f)],_0x4a1d66(0x15b),null),__decorate([(0x0,common_1[_0x4a1d66(0x16e)])(_0x4a1d66(0x176)),(0x0,swagger_1[_0x4a1d66(0x147)])({'summary':_0x4a1d66(0x16b)}),__param(0x0,(0x0,common_1['Body'])()),__metadata(_0x4a1d66(0x192),Function),__metadata(_0x4a1d66(0x152),[Object]),__metadata('design:returntype',Promise)],OfficialController[_0x4a1d66(0x14f)],'getJsapiTicket',null),__decorate([(0x0,common_1[_0x4a1d66(0x16e)])(_0x4a1d66(0x13f)),(0x0,swagger_1[_0x4a1d66(0x147)])({'summary':_0x4a1d66(0x166)}),__param(0x0,(0x0,common_1[_0x4a1d66(0x195)])()),__param(0x1,(0x0,common_1[_0x4a1d66(0x18d)])()),__metadata(_0x4a1d66(0x192),Function),__metadata('design:paramtypes',[Object,Object]),__metadata('design:returntype',Promise)],OfficialController['prototype'],_0x4a1d66(0x13f),null),OfficialController=__decorate([(0x0,swagger_1[_0x4a1d66(0x157)])(_0x4a1d66(0x188)),(0x0,common_1[_0x4a1d66(0x177)])(_0x4a1d66(0x188)),__metadata('design:paramtypes',[official_service_1[_0x4a1d66(0x186)]])],OfficialController),exports[_0x4a1d66(0x160)]=OfficialController;