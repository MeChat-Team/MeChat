'use strict';const _0x1e7725=_0x1452;function _0x20d6(){const _0x54035e=['wechatOfficialAppSecret','weChatApiUrl','now','4276250msUUAP','createRandomNonceStr','./../user/user.service','BAD_REQUEST','906SnkWfT','&secret=','/cgi-bin/qrcode/create?access_token=','45605443jKmlac','axios','OfficialService','QR_STR_SCENE','&grant_type=authorization_code','scan','getQRSceneStr','由于公众号的回复限制、过长的问题我们可能无法回复、您可以前往我们的官方站点享受更加完善的服务、如果您有更多问题、欢迎像我提问！','__decorate','getOwnPropertyDescriptor','loginByCode','metadata','update','18366458MURvDC','message','Injectable','hex','AuthService','处理扫码事件时发生错误','&redirect_uri=','4guGtdw','object','https://api.weixin.qq.com','14110jfgVfp',']]></ToUserName>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<FromUserName><![CDATA[','@nestjs/common','/sns/oauth2/access_token?appid=','user','loginByOpenId','verify','wechatAccessToken','非法参数:\x20未找到的\x20sceneStr\x20','sha1','bindWxBySceneStr','post','getWechatAccessToken','default','split','fromusername','wechatOfficialAppId','16LVvOQw','fetchQRCodeTicket','https://open.weixin.qq.com','24jPhTrp','306330JOLhiY','formatUrl','No\x20user\x20found','globalConfigService','scanedSceneStrMap','sceneStrMap','userService','error','getUserById','get','authService','env','onModuleInit','./../auth/auth.service','aotoPlay','str:\x20','HttpException','&url=','genXmlMsgByConfig','getConfigs','join','function','bindWx','decorate','./../globalConfig/globalConfig.service','jsapi_ticket=','getUserOpenId','scanBindWx','\x0a\x20\x20\x20\x20<xml>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<ToUserName><![CDATA[','getUserFromOpenId','length','getTime','&noncestr=','sort','__esModule','weChatOpenUrl','autoreplyService','getQRCodeTicket','wechatOfficialToken','15OmTyya','1123580fgpCeS','getJsapiTicket','digest','../chat/chat.service','36htvswY','Error\x20in\x20scan\x20method:','appId:\x20','design:paramtypes','../../common/utils','log','createHash',']]></Content>\x0a\x20\x20\x20\x20</xml>','非法参数','genXmlMsg','getRedirectUrl','AutoreplyService','Scanning\x20with\x20openID:\x20','chatgptService','Logger','请求超时','defineProperty','1116241kdAHnq','HttpStatus','officialAutoReplyText','getQRSceneStrByBind'];_0x20d6=function(){return _0x54035e;};return _0x20d6();}(function(_0x20a6e3,_0xaef535){const _0x337c7c=_0x1452,_0x437ae0=_0x20a6e3();while(!![]){try{const _0x3929c7=parseInt(_0x337c7c(0x1bb))/0x1*(-parseInt(_0x337c7c(0x1d3))/0x2)+-parseInt(_0x337c7c(0x183))/0x3*(parseInt(_0x337c7c(0x184))/0x4)+-parseInt(_0x337c7c(0x1be))/0x5*(parseInt(_0x337c7c(0x1a4))/0x6)+parseInt(_0x337c7c(0x199))/0x7*(-parseInt(_0x337c7c(0x1cf))/0x8)+-parseInt(_0x337c7c(0x188))/0x9*(parseInt(_0x337c7c(0x1a0))/0xa)+-parseInt(_0x337c7c(0x1b4))/0xb+parseInt(_0x337c7c(0x1d2))/0xc*(parseInt(_0x337c7c(0x1a7))/0xd);if(_0x3929c7===_0xaef535)break;else _0x437ae0['push'](_0x437ae0['shift']());}catch(_0x2ac887){_0x437ae0['push'](_0x437ae0['shift']());}}}(_0x20d6,0xd5585));var __decorate=this&&this[_0x1e7725(0x1af)]||function(_0x4bf882,_0x33079b,_0x33d10c,_0x536bdb){const _0x502ea1=_0x1e7725;var _0x37f526=arguments[_0x502ea1(0x17a)],_0x4fe4a8=_0x37f526<0x3?_0x33079b:_0x536bdb===null?_0x536bdb=Object[_0x502ea1(0x1b0)](_0x33079b,_0x33d10c):_0x536bdb,_0x35010c;if(typeof Reflect===_0x502ea1(0x1bc)&&typeof Reflect[_0x502ea1(0x173)]===_0x502ea1(0x1e8))_0x4fe4a8=Reflect[_0x502ea1(0x173)](_0x4bf882,_0x33079b,_0x33d10c,_0x536bdb);else{for(var _0xe2079e=_0x4bf882[_0x502ea1(0x17a)]-0x1;_0xe2079e>=0x0;_0xe2079e--)if(_0x35010c=_0x4bf882[_0xe2079e])_0x4fe4a8=(_0x37f526<0x3?_0x35010c(_0x4fe4a8):_0x37f526>0x3?_0x35010c(_0x33079b,_0x33d10c,_0x4fe4a8):_0x35010c(_0x33079b,_0x33d10c))||_0x4fe4a8;}return _0x37f526>0x3&&_0x4fe4a8&&Object[_0x502ea1(0x198)](_0x33079b,_0x33d10c,_0x4fe4a8),_0x4fe4a8;},__metadata=this&&this['__metadata']||function(_0x2138ad,_0x3efd79){const _0x5811c6=_0x1e7725;if(typeof Reflect===_0x5811c6(0x1bc)&&typeof Reflect[_0x5811c6(0x1b2)]==='function')return Reflect[_0x5811c6(0x1b2)](_0x2138ad,_0x3efd79);};Object[_0x1e7725(0x198)](exports,_0x1e7725(0x17e),{'value':!![]}),exports[_0x1e7725(0x1a9)]=void 0x0;const utils_1=require(_0x1e7725(0x18c)),common_1=require(_0x1e7725(0x1c0)),axios_1=require(_0x1e7725(0x1a8)),crypto=require('crypto'),chat_service_1=require(_0x1e7725(0x187)),auth_service_1=require(_0x1e7725(0x1e0)),autoreply_service_1=require('./../autoreply/autoreply.service'),globalConfig_service_1=require(_0x1e7725(0x174)),user_service_1=require(_0x1e7725(0x1a2));let OfficialService=class OfficialService{constructor(_0x116b20,_0x75ccc9,_0x281304,_0x17c5fe,_0x5f321e){const _0x15c481=_0x1e7725;this[_0x15c481(0x180)]=_0x116b20,this[_0x15c481(0x1d9)]=_0x75ccc9,this[_0x15c481(0x1dd)]=_0x281304,this[_0x15c481(0x1d6)]=_0x17c5fe,this[_0x15c481(0x195)]=_0x5f321e,this[_0x15c481(0x1d8)]={},this['scanedSceneStrMap']={};}async[_0x1e7725(0x1df)](){const _0x54072c=_0x1e7725;await this['globalConfigService'][_0x54072c(0x1ca)](!![]);}async[_0x1e7725(0x1ad)](){const _0x2614ae=_0x1e7725;let _0x123787=(0x0,utils_1[_0x2614ae(0x1a1)])(0x20);return this[_0x2614ae(0x1d8)][_0x123787]=!![],_0x123787;}async[_0x1e7725(0x19c)](_0x54588){const _0x18a833=_0x1e7725,{id:_0x91f6cd}=_0x54588['user'],_0xd3729=(0x0,utils_1[_0x18a833(0x1a1)])(0x20)+'/'+_0x91f6cd;return this[_0x18a833(0x1d8)][_0xd3729]=!![],_0xd3729;}async[_0x1e7725(0x181)](_0x41c74c){const _0x3d14e9=_0x1e7725;return this[_0x3d14e9(0x1d0)](_0x41c74c);}async[_0x1e7725(0x192)](_0x444c78){const _0x4157ef=_0x1e7725,_0x19dcaa=await this[_0x4157ef(0x1d6)][_0x4157ef(0x1e6)]([_0x4157ef(0x1ce)]),_0x279e49=(0x0,utils_1['formatUrl'])(process['env'][_0x4157ef(0x17f)]||_0x4157ef(0x1d1)),_0x5ddd78=_0x279e49+'/connect/oauth2/authorize?appid='+_0x19dcaa+_0x4157ef(0x1ba)+encodeURIComponent(_0x444c78)+'&response_type=code&scope=snsapi_base&state=weChatLogin#wechat_redirect';return console[_0x4157ef(0x18d)]('回跳跳转地址:\x20',_0x5ddd78),_0x5ddd78;}async[_0x1e7725(0x185)](_0x2dbec3){const _0x23d945=_0x1e7725,_0x14d2b4=(0x0,utils_1[_0x23d945(0x1a1)])(0x20),_0x12f291=(Date[_0x23d945(0x19f)]()/0x3e8)['toFixed'](0x0),_0x3f9f11=await this['globalConfigService'][_0x23d945(0x1e6)](['wechatJsapiTicket']);console[_0x23d945(0x18d)]('jsapiTicket:\x20',_0x3f9f11);const _0x2cce9f=await this[_0x23d945(0x1d6)][_0x23d945(0x1e6)]([_0x23d945(0x1ce)]);console[_0x23d945(0x18d)](_0x23d945(0x18a),_0x2cce9f);const _0x633f5f=_0x23d945(0x175)+_0x3f9f11+_0x23d945(0x17c)+_0x14d2b4+'&timestamp='+_0x12f291+_0x23d945(0x1e4)+_0x2dbec3;console[_0x23d945(0x18d)](_0x23d945(0x1e2),_0x633f5f);const _0x415cef=this['sha1'](_0x633f5f);return{'appId':_0x2cce9f,'nonceStr':_0x14d2b4,'timestamp':_0x12f291,'signature':_0x415cef};}async[_0x1e7725(0x1d0)](_0x36776f){const _0x4c59a5=_0x1e7725,_0x6a294f=await this[_0x4c59a5(0x1d6)][_0x4c59a5(0x1e6)]([_0x4c59a5(0x1c5)]),_0x24f0d9=(0x0,utils_1[_0x4c59a5(0x1d4)])(process[_0x4c59a5(0x1de)][_0x4c59a5(0x19e)]||_0x4c59a5(0x1bd)),_0x27e518={'action_name':_0x4c59a5(0x1aa),'action_info':{'scene':{'scene_str':_0x36776f}}},_0x422fef=await axios_1[_0x4c59a5(0x1cb)][_0x4c59a5(0x1c9)](_0x24f0d9+_0x4c59a5(0x1a6)+_0x6a294f,_0x27e518),{data:{errmsg:_0x309920,ticket:_0x4049ff}}=_0x422fef;if(_0x309920)throw new common_1[(_0x4c59a5(0x1e3))](_0x309920,common_1['HttpStatus']['BAD_REQUEST']);return _0x4049ff;}async[_0x1e7725(0x1b1)](_0x48959c,_0x30921e){const _0xd17915=_0x1e7725,_0x239a7d=await this[_0xd17915(0x1d6)][_0xd17915(0x1e6)](['wechatOfficialAppId']),_0x38183c=await this[_0xd17915(0x1d6)][_0xd17915(0x1e6)]([_0xd17915(0x19d)]),_0x4bbcd9=(0x0,utils_1[_0xd17915(0x1d4)])(process[_0xd17915(0x1de)][_0xd17915(0x19e)]||_0xd17915(0x1bd)),_0x4770ab=await axios_1['default'][_0xd17915(0x1dc)](_0x4bbcd9+_0xd17915(0x1c1)+_0x239a7d+_0xd17915(0x1a5)+_0x38183c+'&code='+_0x30921e+_0xd17915(0x1ab)),{data:{errmsg:_0x1f53c3,openid:_0x47bd78}}=_0x4770ab;if(_0x1f53c3)throw new common_1[(_0xd17915(0x1e3))](_0x1f53c3,common_1[_0xd17915(0x19a)]['BAD_REQUEST']);let _0x15390c;return _0x15390c=await this[_0xd17915(0x1d9)][_0xd17915(0x176)](_0x47bd78),!_0x15390c&&(_0x15390c=await this[_0xd17915(0x1d9)][_0xd17915(0x179)](_0x47bd78)),this[_0xd17915(0x1dd)][_0xd17915(0x1c3)](_0x15390c,_0x48959c);}async[_0x1e7725(0x1ac)](_0x3182d8,_0x1bfca6){const _0x2522b7=_0x1e7725;try{common_1[_0x2522b7(0x196)][_0x2522b7(0x18d)](_0x2522b7(0x194)+_0x3182d8+',\x20sceneStr:\x20'+_0x1bfca6,_0x2522b7(0x1a9));if(!this[_0x2522b7(0x1d8)][_0x1bfca6]){common_1[_0x2522b7(0x196)][_0x2522b7(0x1da)](_0x2522b7(0x1c6)+_0x1bfca6);throw new common_1[(_0x2522b7(0x1e3))](_0x2522b7(0x190),common_1['HttpStatus'][_0x2522b7(0x1a3)]);}const _0xdd23ba=await this[_0x2522b7(0x1d9)][_0x2522b7(0x179)](_0x3182d8,_0x1bfca6);common_1['Logger'][_0x2522b7(0x18d)]('User\x20found:\x20'+(_0xdd23ba?_0xdd23ba['id']:_0x2522b7(0x1d5)),_0x2522b7(0x1a9)),this[_0x2522b7(0x1d7)][_0x1bfca6]=_0xdd23ba['id'];}catch(_0x4d750f){common_1['Logger'][_0x2522b7(0x1da)](_0x2522b7(0x189),_0x4d750f[_0x2522b7(0x1b5)]),common_1[_0x2522b7(0x196)][_0x2522b7(0x1da)]('Stack\x20trace:',_0x4d750f['stack']);throw new common_1[(_0x2522b7(0x1e3))](_0x2522b7(0x1b9),common_1['HttpStatus']['INTERNAL_SERVER_ERROR']);}}async['loginBySceneStr'](_0x41314b,_0x505375){const _0x3ce40a=_0x1e7725,{sceneStr:_0x29a6ed}=_0x505375;if(!this[_0x3ce40a(0x1d8)][_0x29a6ed])return;const _0x5c9b1=this[_0x3ce40a(0x1d7)][_0x29a6ed];if(!_0x5c9b1)return'';const _0x477837=await this[_0x3ce40a(0x1d9)][_0x3ce40a(0x1db)](_0x5c9b1);return delete this[_0x3ce40a(0x1d7)][_0x29a6ed],this[_0x3ce40a(0x1dd)]['loginByOpenId'](_0x477837,_0x41314b);}async[_0x1e7725(0x177)](_0x317821,_0x479f75){const _0x5649ff=_0x1e7725;if(!this[_0x5649ff(0x1d8)][_0x479f75])throw new common_1[(_0x5649ff(0x1e3))]('非法参数',common_1['HttpStatus'][_0x5649ff(0x1a3)]);const _0x425cb6=_0x479f75[_0x5649ff(0x1cc)]('/')[0x1],_0x152af5=await this[_0x5649ff(0x1d9)][_0x5649ff(0x172)](_0x317821,_0x425cb6);this['scanedSceneStrMap'][_0x479f75]=_0x152af5;}async[_0x1e7725(0x1c8)](_0x206e58,_0x247e9e){const _0x41c09a=_0x1e7725;if(!this[_0x41c09a(0x1d8)][_0x247e9e])throw new common_1[(_0x41c09a(0x1e3))](_0x41c09a(0x190),common_1[_0x41c09a(0x19a)][_0x41c09a(0x1a3)]);const {id:_0xabae14}=_0x206e58[_0x41c09a(0x1c2)],_0x1993a0=this[_0x41c09a(0x1d7)][_0x247e9e];if(!_0x1993a0)return'';return delete this[_0x41c09a(0x1d7)][_0x247e9e],_0x1993a0;}async[_0x1e7725(0x1c4)](_0x581df8,_0x16a866,_0x1a32ac){const _0x5a057a=_0x1e7725,_0x20c288=await this['globalConfigService'][_0x5a057a(0x1e6)]([_0x5a057a(0x182)])||'';return await this[_0x5a057a(0x1c7)]([_0x20c288,_0x16a866,_0x1a32ac][_0x5a057a(0x17d)]()[_0x5a057a(0x1e7)](''))==_0x581df8;}[_0x1e7725(0x1c7)](_0x28d1a5){const _0x339634=_0x1e7725;return crypto[_0x339634(0x18e)](_0x339634(0x1c7))[_0x339634(0x1b3)](_0x28d1a5)[_0x339634(0x186)](_0x339634(0x1b7));}async[_0x1e7725(0x1e5)](_0x267a63,_0x123dbe){const _0x19ef72=_0x1e7725,_0x57e322=await this[_0x19ef72(0x1d6)][_0x19ef72(0x1e6)]([_0x123dbe]);return this[_0x19ef72(0x191)](_0x267a63,_0x57e322);}async[_0x1e7725(0x191)](_0x19ab58,_0x4e6e85){const _0x1ec11a=_0x1e7725;return _0x1ec11a(0x178)+_0x19ab58[_0x1ec11a(0x1cd)][0x0]+_0x1ec11a(0x1bf)+_0x19ab58['tousername'][0x0]+']]></FromUserName>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<CreateTime>'+new Date()[_0x1ec11a(0x17b)]()+'</CreateTime>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<MsgType><![CDATA[text]]></MsgType>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<Content><![CDATA['+_0x4e6e85+_0x1ec11a(0x18f);}async[_0x1e7725(0x1e1)](_0x5ec7e7){const _0x17a2eb=_0x1e7725,_0x25e4d0=new Promise((_0x1eec8c,_0x14ce72)=>{setTimeout(()=>{const _0x153f86=_0x1452;_0x14ce72(new Error(_0x153f86(0x197)));},0x12c0);});let _0x52be7c=await this['globalConfigService'][_0x17a2eb(0x1e6)]([_0x17a2eb(0x19b)])||_0x17a2eb(0x1ae);return _0x52be7c;}};function _0x1452(_0x326412,_0x2d7645){const _0x20d69d=_0x20d6();return _0x1452=function(_0x1452eb,_0x469cfc){_0x1452eb=_0x1452eb-0x172;let _0x205e95=_0x20d69d[_0x1452eb];return _0x205e95;},_0x1452(_0x326412,_0x2d7645);}OfficialService=__decorate([(0x0,common_1[_0x1e7725(0x1b6)])(),__metadata(_0x1e7725(0x18b),[autoreply_service_1[_0x1e7725(0x193)],user_service_1['UserService'],auth_service_1[_0x1e7725(0x1b8)],globalConfig_service_1['GlobalConfigService'],chat_service_1['ChatService']])],OfficialService),exports['OfficialService']=OfficialService;