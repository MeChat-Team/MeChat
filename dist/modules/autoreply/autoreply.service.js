'use strict';const _0xe5044c=_0xbc36;function _0xbc36(_0x557c0,_0x59bbc1){const _0x56c68a=_0x56c6();return _0xbc36=function(_0xbc3642,_0x24a15f){_0xbc3642=_0xbc3642-0xf5;let _0x2d927c=_0x56c68a[_0xbc3642];return _0x2d927c;},_0xbc36(_0x557c0,_0x59bbc1);}(function(_0x1264de,_0x1f549f){const _0x696d7b=_0xbc36,_0x1e0534=_0x1264de();while(!![]){try{const _0x228184=parseInt(_0x696d7b(0x131))/0x1+-parseInt(_0x696d7b(0x127))/0x2*(parseInt(_0x696d7b(0x102))/0x3)+-parseInt(_0x696d7b(0x134))/0x4*(parseInt(_0x696d7b(0x10a))/0x5)+parseInt(_0x696d7b(0x114))/0x6+parseInt(_0x696d7b(0xf8))/0x7+-parseInt(_0x696d7b(0x126))/0x8+parseInt(_0x696d7b(0x10b))/0x9;if(_0x228184===_0x1f549f)break;else _0x1e0534['push'](_0x1e0534['shift']());}catch(_0x168a8f){_0x1e0534['push'](_0x1e0534['shift']());}}}(_0x56c6,0xb9e88));var __decorate=this&&this[_0xe5044c(0xff)]||function(_0x2ac7dd,_0x3f30c6,_0x232355,_0x136d83){const _0x442ab4=_0xe5044c;var _0x415df2=arguments[_0x442ab4(0x122)],_0x4e8d37=_0x415df2<0x3?_0x3f30c6:_0x136d83===null?_0x136d83=Object['getOwnPropertyDescriptor'](_0x3f30c6,_0x232355):_0x136d83,_0x5be38d;if(typeof Reflect===_0x442ab4(0x12c)&&typeof Reflect['decorate']===_0x442ab4(0x132))_0x4e8d37=Reflect[_0x442ab4(0x12b)](_0x2ac7dd,_0x3f30c6,_0x232355,_0x136d83);else{for(var _0x5e9a97=_0x2ac7dd[_0x442ab4(0x122)]-0x1;_0x5e9a97>=0x0;_0x5e9a97--)if(_0x5be38d=_0x2ac7dd[_0x5e9a97])_0x4e8d37=(_0x415df2<0x3?_0x5be38d(_0x4e8d37):_0x415df2>0x3?_0x5be38d(_0x3f30c6,_0x232355,_0x4e8d37):_0x5be38d(_0x3f30c6,_0x232355))||_0x4e8d37;}return _0x415df2>0x3&&_0x4e8d37&&Object[_0x442ab4(0xfc)](_0x3f30c6,_0x232355,_0x4e8d37),_0x4e8d37;},__metadata=this&&this[_0xe5044c(0x119)]||function(_0x36affd,_0x23514b){const _0xbdfa61=_0xe5044c;if(typeof Reflect===_0xbdfa61(0x12c)&&typeof Reflect[_0xbdfa61(0x107)]==='function')return Reflect['metadata'](_0x36affd,_0x23514b);},__param=this&&this[_0xe5044c(0x12d)]||function(_0x4bbeb4,_0x3e9687){return function(_0x10b961,_0x58b3ed){_0x3e9687(_0x10b961,_0x58b3ed,_0x4bbeb4);};};function _0x56c6(){const _0x175317=['AutoReplyEntity','autoReplyMap','6356360MEyujk','2BpUceD','trim','AutoreplyService','Like','decorate','object','__param','loadAutoReplyList','添加问题成功！','删除失败','123257igvcZf','function','autoReplyKes','39660fdvqMK','autoReplyFuzzyMatch','join','autoReplyEntity','delAutoreply','save','6428492OBGOHQ','some','HttpStatus','Injectable','defineProperty','add','addAutoreply','__decorate','删除问题成功','has','2722911WcfIKs','checkAutoReply','@nestjs/common','answer','更新失败','metadata','map','BAD_REQUEST','30KYMiRv','7790004xCEXOd','onModuleInit','__esModule','affected','isAIReplyEnabled','push','findOne','delete','status','3695898rLTFTo','includes','DESC','updateAutoreply','update','__metadata','forEach','./autoreply.entity','filter','findAndCount','InjectRepository','该问题不存在,请检查您的提交信息','find','HttpException','length','prompt'];_0x56c6=function(){return _0x175317;};return _0x56c6();}Object[_0xe5044c(0xfc)](exports,_0xe5044c(0x10d),{'value':!![]}),exports[_0xe5044c(0x129)]=void 0x0;const common_1=require(_0xe5044c(0x104)),typeorm_1=require('@nestjs/typeorm'),typeorm_2=require('typeorm'),autoreply_entity_1=require(_0xe5044c(0x11b));let AutoreplyService=class AutoreplyService{constructor(_0x752d19){const _0x1f7b28=_0xe5044c;this[_0x1f7b28(0xf5)]=_0x752d19,this[_0x1f7b28(0x133)]=[],this[_0x1f7b28(0x125)]={},this[_0x1f7b28(0x135)]=!![];}async[_0xe5044c(0x10c)](){const _0x2fb08d=_0xe5044c;await this[_0x2fb08d(0x12e)]();}async[_0xe5044c(0x12e)](){const _0x5ec1b9=_0xe5044c,_0x37880d=await this[_0x5ec1b9(0xf5)][_0x5ec1b9(0x120)]({'where':{'status':0x1},'select':[_0x5ec1b9(0x123),_0x5ec1b9(0x105),'isAIReplyEnabled']});this['autoReplyMap']={},this[_0x5ec1b9(0x133)]=[],_0x37880d[_0x5ec1b9(0x11a)](_0x4c4fc3=>{const _0x1e2540=_0x5ec1b9;this[_0x1e2540(0x125)][_0x4c4fc3[_0x1e2540(0x123)]]={'answer':_0x4c4fc3[_0x1e2540(0x105)],'isAIReplyEnabled':_0x4c4fc3[_0x1e2540(0x10f)]};const _0x438425=_0x4c4fc3[_0x1e2540(0x123)]['split']('\x20')[_0x1e2540(0x108)](_0x3dfcd1=>_0x3dfcd1[_0x1e2540(0x128)]());this[_0x1e2540(0x133)]['push']({'prompt':_0x4c4fc3['prompt'],'keywords':_0x438425});});}async[_0xe5044c(0x103)](_0x1f005a){const _0x3c7343=_0xe5044c;let _0x40d276=[],_0x2ebead=0x0;const _0x2a2965=new Set();if(this[_0x3c7343(0x135)])for(const _0xab34b of this[_0x3c7343(0x133)]){_0xab34b['keywords'][_0x3c7343(0xf9)](_0xf1c071=>_0x1f005a[_0x3c7343(0x115)](_0xf1c071))&&(!_0x2a2965[_0x3c7343(0x101)](_0xab34b['prompt'])&&(_0x40d276[_0x3c7343(0x110)](this[_0x3c7343(0x125)][_0xab34b[_0x3c7343(0x123)]]['answer']),_0x2a2965['add'](_0xab34b[_0x3c7343(0x123)]),this['autoReplyMap'][_0xab34b['prompt']][_0x3c7343(0x10f)]===0x1&&(_0x2ebead=0x1)));}else{const _0x3ed082=this[_0x3c7343(0x133)][_0x3c7343(0x11c)](_0x459e6f=>_0x459e6f['prompt']===_0x1f005a);for(const _0x595a9e of _0x3ed082){!_0x2a2965['has'](_0x595a9e['prompt'])&&(_0x40d276[_0x3c7343(0x110)](this[_0x3c7343(0x125)][_0x595a9e['prompt']][_0x3c7343(0x105)]),_0x2a2965[_0x3c7343(0xfd)](_0x595a9e['prompt']),this[_0x3c7343(0x125)][_0x595a9e[_0x3c7343(0x123)]]['isAIReplyEnabled']===0x1&&(_0x2ebead=0x1));}}return{'answer':_0x40d276[_0x3c7343(0x136)]('\x0a'),'isAIReplyEnabled':_0x2ebead};}async['queryAutoreply'](_0x35c523){const _0x3e77d6=_0xe5044c,{page:page=0x1,size:size=0xa,prompt:_0x27d541,status:_0x4a30b4}=_0x35c523,_0x44c58a={};[0x0,0x1,'0','1']['includes'](_0x4a30b4)&&(_0x44c58a[_0x3e77d6(0x113)]=_0x4a30b4),_0x27d541&&(_0x44c58a['prompt']=(0x0,typeorm_2[_0x3e77d6(0x12a)])('%'+_0x27d541+'%'));const [_0x38faed,_0x1af85f]=await this[_0x3e77d6(0xf5)][_0x3e77d6(0x11d)]({'where':_0x44c58a,'skip':(page-0x1)*size,'take':size,'order':{'id':_0x3e77d6(0x116)}});return{'rows':_0x38faed,'count':_0x1af85f};}async[_0xe5044c(0xfe)](_0x438e97){const _0x4fe482=_0xe5044c;return await this[_0x4fe482(0xf5)][_0x4fe482(0xf7)](_0x438e97),await this[_0x4fe482(0x12e)](),_0x4fe482(0x12f);}async[_0xe5044c(0x117)](_0x462096){const _0x5167db=_0xe5044c,{id:_0x178ed5}=_0x462096,_0x54e5d4=await this['autoReplyEntity'][_0x5167db(0x118)]({'id':_0x178ed5},_0x462096);if(_0x54e5d4[_0x5167db(0x10e)]>0x0)return await this[_0x5167db(0x12e)](),'更新问题成功';throw new common_1[(_0x5167db(0x121))](_0x5167db(0x106),common_1['HttpStatus'][_0x5167db(0x109)]);}async[_0xe5044c(0xf6)](_0x5397a8){const _0x5788c8=_0xe5044c,{id:_0x1b681a}=_0x5397a8,_0x29796b=await this[_0x5788c8(0xf5)][_0x5788c8(0x111)]({'where':{'id':_0x1b681a}});if(!_0x29796b)throw new common_1[(_0x5788c8(0x121))](_0x5788c8(0x11f),common_1[_0x5788c8(0xfa)]['BAD_REQUEST']);const _0x581927=await this['autoReplyEntity'][_0x5788c8(0x112)]({'id':_0x1b681a});if(_0x581927['affected']>0x0)return await this[_0x5788c8(0x12e)](),_0x5788c8(0x100);throw new common_1[(_0x5788c8(0x121))](_0x5788c8(0x130),common_1[_0x5788c8(0xfa)]['BAD_REQUEST']);}};AutoreplyService=__decorate([(0x0,common_1[_0xe5044c(0xfb)])(),__param(0x0,(0x0,typeorm_1[_0xe5044c(0x11e)])(autoreply_entity_1[_0xe5044c(0x124)])),__metadata('design:paramtypes',[typeorm_2['Repository']])],AutoreplyService),exports[_0xe5044c(0x129)]=AutoreplyService;