'use strict';function _0x4036(){const _0x2a045d=['添加问题成功！','580612wSGekG','findAndCount','610hCTgjg','queryAutoreply','filter','length','save','update','17lGFLDx','decorate','该问题不存在,请检查您的提交信息','203103vdkvSZ','BAD_REQUEST','AutoReplyEntity','76839tFKKUz','1112qYBCvN','__metadata','trim','4494477nEplip','checkAutoReply','autoReplyKes','prompt','function','delete','Repository','answer','affected','isAIReplyEnabled','metadata','HttpException','270192FqTgSy','getOwnPropertyDescriptor','更新失败','DESC','add','9018BfJonQ','updateAutoreply','has','object','@nestjs/common','loadAutoReplyList','keywords','54950885ayYRvm','HttpStatus','delAutoreply','删除问题成功','5tbjlIK','autoReplyEntity','split','__esModule','push','__decorate','defineProperty','status','includes','InjectRepository','autoReplyFuzzyMatch','map','onModuleInit','autoReplyMap','删除失败','typeorm','__param','join','@nestjs/typeorm','./autoreply.entity'];_0x4036=function(){return _0x2a045d;};return _0x4036();}const _0x275982=_0x4a53;(function(_0xb35272,_0x2d27b0){const _0x138b1d=_0x4a53,_0x526814=_0xb35272();while(!![]){try{const _0x3e2f28=parseInt(_0x138b1d(0xfe))/0x1*(parseInt(_0x138b1d(0x119))/0x2)+-parseInt(_0x138b1d(0x108))/0x3+parseInt(_0x138b1d(0xf6))/0x4+parseInt(_0x138b1d(0xe1))/0x5*(-parseInt(_0x138b1d(0x114))/0x6)+parseInt(_0x138b1d(0x104))/0x7*(-parseInt(_0x138b1d(0x105))/0x8)+parseInt(_0x138b1d(0x101))/0x9*(-parseInt(_0x138b1d(0xf8))/0xa)+parseInt(_0x138b1d(0xdd))/0xb;if(_0x3e2f28===_0x2d27b0)break;else _0x526814['push'](_0x526814['shift']());}catch(_0x2efd9e){_0x526814['push'](_0x526814['shift']());}}}(_0x4036,0xbc6b0));var __decorate=this&&this[_0x275982(0xe6)]||function(_0x46189f,_0x4a568b,_0x722504,_0x576a11){const _0x9799=_0x275982;var _0x3a6bda=arguments[_0x9799(0xfb)],_0x121f37=_0x3a6bda<0x3?_0x4a568b:_0x576a11===null?_0x576a11=Object[_0x9799(0x115)](_0x4a568b,_0x722504):_0x576a11,_0x3be9fe;if(typeof Reflect===_0x9799(0x11c)&&typeof Reflect['decorate']===_0x9799(0x10c))_0x121f37=Reflect[_0x9799(0xff)](_0x46189f,_0x4a568b,_0x722504,_0x576a11);else{for(var _0x413d32=_0x46189f[_0x9799(0xfb)]-0x1;_0x413d32>=0x0;_0x413d32--)if(_0x3be9fe=_0x46189f[_0x413d32])_0x121f37=(_0x3a6bda<0x3?_0x3be9fe(_0x121f37):_0x3a6bda>0x3?_0x3be9fe(_0x4a568b,_0x722504,_0x121f37):_0x3be9fe(_0x4a568b,_0x722504))||_0x121f37;}return _0x3a6bda>0x3&&_0x121f37&&Object[_0x9799(0xe7)](_0x4a568b,_0x722504,_0x121f37),_0x121f37;},__metadata=this&&this[_0x275982(0x106)]||function(_0x105d64,_0x49de3c){const _0x342985=_0x275982;if(typeof Reflect===_0x342985(0x11c)&&typeof Reflect['metadata']===_0x342985(0x10c))return Reflect[_0x342985(0x112)](_0x105d64,_0x49de3c);},__param=this&&this[_0x275982(0xf1)]||function(_0x45c103,_0x6a0819){return function(_0x386c8d,_0x4b5598){_0x6a0819(_0x386c8d,_0x4b5598,_0x45c103);};};Object['defineProperty'](exports,_0x275982(0xe4),{'value':!![]}),exports['AutoreplyService']=void 0x0;const common_1=require(_0x275982(0x11d)),typeorm_1=require(_0x275982(0xf3)),typeorm_2=require(_0x275982(0xf0)),autoreply_entity_1=require(_0x275982(0xf4));function _0x4a53(_0x5687f6,_0x3d0dda){const _0x40360b=_0x4036();return _0x4a53=function(_0x4a535d,_0x562f9b){_0x4a535d=_0x4a535d-0xdd;let _0x51849b=_0x40360b[_0x4a535d];return _0x51849b;},_0x4a53(_0x5687f6,_0x3d0dda);}let AutoreplyService=class AutoreplyService{constructor(_0x2ecf53){const _0x451df5=_0x275982;this[_0x451df5(0xe2)]=_0x2ecf53,this[_0x451df5(0x10a)]=[],this[_0x451df5(0xee)]={},this[_0x451df5(0xeb)]=!![];}async[_0x275982(0xed)](){const _0x4a0c7b=_0x275982;await this[_0x4a0c7b(0x11e)]();}async[_0x275982(0x11e)](){const _0x5c4901=_0x275982,_0x1b84bf=await this[_0x5c4901(0xe2)]['find']({'where':{'status':0x1},'select':[_0x5c4901(0x10b),_0x5c4901(0x10f),'isAIReplyEnabled']});this[_0x5c4901(0xee)]={},this[_0x5c4901(0x10a)]=[],_0x1b84bf['forEach'](_0x15ef1f=>{const _0x53781e=_0x5c4901;this[_0x53781e(0xee)][_0x15ef1f[_0x53781e(0x10b)]]={'answer':_0x15ef1f[_0x53781e(0x10f)],'isAIReplyEnabled':_0x15ef1f[_0x53781e(0x111)]};const _0x434b7b=_0x15ef1f['prompt'][_0x53781e(0xe3)]('\x20')[_0x53781e(0xec)](_0x19d705=>_0x19d705[_0x53781e(0x107)]());this[_0x53781e(0x10a)][_0x53781e(0xe5)]({'prompt':_0x15ef1f[_0x53781e(0x10b)],'keywords':_0x434b7b});});}async[_0x275982(0x109)](_0x106a1b){const _0x935f70=_0x275982;let _0x4ff1c0=[],_0x1c763c=0x0;const _0x2e113d=new Set();if(this[_0x935f70(0xeb)])for(const _0x2b2914 of this[_0x935f70(0x10a)]){_0x2b2914[_0x935f70(0x11f)]['some'](_0x240577=>_0x106a1b[_0x935f70(0xe9)](_0x240577))&&(!_0x2e113d[_0x935f70(0x11b)](_0x2b2914[_0x935f70(0x10b)])&&(_0x4ff1c0['push'](this['autoReplyMap'][_0x2b2914[_0x935f70(0x10b)]][_0x935f70(0x10f)]),_0x2e113d[_0x935f70(0x118)](_0x2b2914['prompt']),this[_0x935f70(0xee)][_0x2b2914[_0x935f70(0x10b)]]['isAIReplyEnabled']===0x1&&(_0x1c763c=0x1)));}else{const _0x56e99e=this['autoReplyKes'][_0x935f70(0xfa)](_0x1f4510=>_0x1f4510[_0x935f70(0x10b)]===_0x106a1b);for(const _0x21c14f of _0x56e99e){!_0x2e113d[_0x935f70(0x11b)](_0x21c14f[_0x935f70(0x10b)])&&(_0x4ff1c0['push'](this[_0x935f70(0xee)][_0x21c14f[_0x935f70(0x10b)]]['answer']),_0x2e113d[_0x935f70(0x118)](_0x21c14f[_0x935f70(0x10b)]),this[_0x935f70(0xee)][_0x21c14f[_0x935f70(0x10b)]][_0x935f70(0x111)]===0x1&&(_0x1c763c=0x1));}}return{'answer':_0x4ff1c0[_0x935f70(0xf2)]('\x0a'),'isAIReplyEnabled':_0x1c763c};}async[_0x275982(0xf9)](_0x2fd6e8){const _0x398172=_0x275982,{page:page=0x1,size:size=0xa,prompt:_0x183dc6,status:_0x519937}=_0x2fd6e8,_0x23d5e9={};[0x0,0x1,'0','1']['includes'](_0x519937)&&(_0x23d5e9[_0x398172(0xe8)]=_0x519937),_0x183dc6&&(_0x23d5e9[_0x398172(0x10b)]=(0x0,typeorm_2['Like'])('%'+_0x183dc6+'%'));const [_0x1e7b98,_0x394fc9]=await this[_0x398172(0xe2)][_0x398172(0xf7)]({'where':_0x23d5e9,'skip':(page-0x1)*size,'take':size,'order':{'id':_0x398172(0x117)}});return{'rows':_0x1e7b98,'count':_0x394fc9};}async['addAutoreply'](_0x5356ae){const _0x5eb87a=_0x275982;return await this[_0x5eb87a(0xe2)][_0x5eb87a(0xfc)](_0x5356ae),await this[_0x5eb87a(0x11e)](),_0x5eb87a(0xf5);}async[_0x275982(0x11a)](_0x2764ec){const _0xbb0cd0=_0x275982,{id:_0x583ec6}=_0x2764ec,_0x242312=await this[_0xbb0cd0(0xe2)][_0xbb0cd0(0xfd)]({'id':_0x583ec6},_0x2764ec);if(_0x242312[_0xbb0cd0(0x110)]>0x0)return await this['loadAutoReplyList'](),'更新问题成功';throw new common_1[(_0xbb0cd0(0x113))](_0xbb0cd0(0x116),common_1[_0xbb0cd0(0xde)]['BAD_REQUEST']);}async[_0x275982(0xdf)](_0x5d758d){const _0x204791=_0x275982,{id:_0x1531ff}=_0x5d758d,_0x375d04=await this[_0x204791(0xe2)]['findOne']({'where':{'id':_0x1531ff}});if(!_0x375d04)throw new common_1[(_0x204791(0x113))](_0x204791(0x100),common_1[_0x204791(0xde)]['BAD_REQUEST']);const _0x466280=await this[_0x204791(0xe2)][_0x204791(0x10d)]({'id':_0x1531ff});if(_0x466280[_0x204791(0x110)]>0x0)return await this[_0x204791(0x11e)](),_0x204791(0xe0);throw new common_1[(_0x204791(0x113))](_0x204791(0xef),common_1['HttpStatus'][_0x204791(0x102)]);}};AutoreplyService=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,typeorm_1[_0x275982(0xea)])(autoreply_entity_1[_0x275982(0x103)])),__metadata('design:paramtypes',[typeorm_2[_0x275982(0x10e)]])],AutoreplyService),exports['AutoreplyService']=AutoreplyService;