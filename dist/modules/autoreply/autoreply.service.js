'use strict';const _0xaaa724=_0x5632;(function(_0x50504e,_0xd9809b){const _0x514909=_0x5632,_0x581b98=_0x50504e();while(!![]){try{const _0x523f95=parseInt(_0x514909(0x21d))/0x1+parseInt(_0x514909(0x20d))/0x2*(-parseInt(_0x514909(0x1f7))/0x3)+-parseInt(_0x514909(0x1ff))/0x4*(-parseInt(_0x514909(0x210))/0x5)+-parseInt(_0x514909(0x201))/0x6*(-parseInt(_0x514909(0x220))/0x7)+parseInt(_0x514909(0x1eb))/0x8+parseInt(_0x514909(0x1f6))/0x9+-parseInt(_0x514909(0x1f9))/0xa*(parseInt(_0x514909(0x20e))/0xb);if(_0x523f95===_0xd9809b)break;else _0x581b98['push'](_0x581b98['shift']());}catch(_0x2f46e1){_0x581b98['push'](_0x581b98['shift']());}}}(_0x27f7,0x21878));var __decorate=this&&this[_0xaaa724(0x1f2)]||function(_0x4e521f,_0x3f73b8,_0x54744a,_0x1cbbb4){const _0x25923e=_0xaaa724;var _0x103bf4=arguments['length'],_0x4e44d1=_0x103bf4<0x3?_0x3f73b8:_0x1cbbb4===null?_0x1cbbb4=Object[_0x25923e(0x228)](_0x3f73b8,_0x54744a):_0x1cbbb4,_0x22ec4a;if(typeof Reflect===_0x25923e(0x1ee)&&typeof Reflect[_0x25923e(0x225)]==='function')_0x4e44d1=Reflect[_0x25923e(0x225)](_0x4e521f,_0x3f73b8,_0x54744a,_0x1cbbb4);else{for(var _0x19f811=_0x4e521f['length']-0x1;_0x19f811>=0x0;_0x19f811--)if(_0x22ec4a=_0x4e521f[_0x19f811])_0x4e44d1=(_0x103bf4<0x3?_0x22ec4a(_0x4e44d1):_0x103bf4>0x3?_0x22ec4a(_0x3f73b8,_0x54744a,_0x4e44d1):_0x22ec4a(_0x3f73b8,_0x54744a))||_0x4e44d1;}return _0x103bf4>0x3&&_0x4e44d1&&Object['defineProperty'](_0x3f73b8,_0x54744a,_0x4e44d1),_0x4e44d1;},__metadata=this&&this[_0xaaa724(0x1f0)]||function(_0x5cef1a,_0x22e67d){const _0x5ec971=_0xaaa724;if(typeof Reflect===_0x5ec971(0x1ee)&&typeof Reflect['metadata']===_0x5ec971(0x203))return Reflect[_0x5ec971(0x214)](_0x5cef1a,_0x22e67d);},__param=this&&this[_0xaaa724(0x1f4)]||function(_0x5adddf,_0x31e195){return function(_0x44c607,_0x91d61){_0x31e195(_0x44c607,_0x91d61,_0x5adddf);};};Object[_0xaaa724(0x229)](exports,_0xaaa724(0x1f8),{'value':!![]}),exports[_0xaaa724(0x21a)]=void 0x0;const common_1=require(_0xaaa724(0x1f3)),typeorm_1=require(_0xaaa724(0x21e)),typeorm_2=require(_0xaaa724(0x20c)),autoreply_entity_1=require(_0xaaa724(0x218));let AutoreplyService=class AutoreplyService{constructor(_0x1a49c3){const _0x1c92b7=_0xaaa724;this[_0x1c92b7(0x21b)]=_0x1a49c3,this[_0x1c92b7(0x21f)]=[],this['autoReplyMap']={},this[_0x1c92b7(0x211)]=!![];}async[_0xaaa724(0x221)](){const _0x33eec6=_0xaaa724;await this[_0x33eec6(0x217)]();}async[_0xaaa724(0x217)](){const _0x4c0100=_0xaaa724,_0x3dbcc6=await this['autoReplyEntity']['find']({'where':{'status':0x1},'select':[_0x4c0100(0x200),_0x4c0100(0x215),_0x4c0100(0x1f5)]});this[_0x4c0100(0x206)]={},this[_0x4c0100(0x21f)]=[],_0x3dbcc6['forEach'](_0xeca3bf=>{const _0x4307a0=_0x4c0100;this[_0x4307a0(0x206)][_0xeca3bf[_0x4307a0(0x200)]]={'answer':_0xeca3bf[_0x4307a0(0x215)],'isAIReplyEnabled':_0xeca3bf[_0x4307a0(0x1f5)]};const _0x2d74f0=_0xeca3bf[_0x4307a0(0x200)][_0x4307a0(0x202)]('\x20')['map'](_0x176d2f=>_0x176d2f['trim']());this[_0x4307a0(0x21f)][_0x4307a0(0x213)]({'prompt':_0xeca3bf[_0x4307a0(0x200)],'keywords':_0x2d74f0});});}async['checkAutoReply'](_0x14a652){const _0x6498ce=_0xaaa724;let _0x5c97eb=[],_0x337c71=0x0;const _0x58e90e=new Set();if(this[_0x6498ce(0x211)])for(const _0x2c1830 of this[_0x6498ce(0x21f)]){_0x2c1830[_0x6498ce(0x212)][_0x6498ce(0x216)](_0x3f3d48=>_0x14a652['includes'](_0x3f3d48))&&(!_0x58e90e[_0x6498ce(0x1ec)](_0x2c1830[_0x6498ce(0x200)])&&(_0x5c97eb[_0x6498ce(0x213)](this[_0x6498ce(0x206)][_0x2c1830['prompt']][_0x6498ce(0x215)]),_0x58e90e[_0x6498ce(0x204)](_0x2c1830[_0x6498ce(0x200)]),this[_0x6498ce(0x206)][_0x2c1830[_0x6498ce(0x200)]][_0x6498ce(0x1f5)]===0x1&&(_0x337c71=0x1)));}else{const _0x376e1d=this[_0x6498ce(0x21f)][_0x6498ce(0x209)](_0x1aa893=>_0x1aa893['prompt']===_0x14a652);for(const _0x135496 of _0x376e1d){!_0x58e90e[_0x6498ce(0x1ec)](_0x135496[_0x6498ce(0x200)])&&(_0x5c97eb['push'](this[_0x6498ce(0x206)][_0x135496[_0x6498ce(0x200)]][_0x6498ce(0x215)]),_0x58e90e[_0x6498ce(0x204)](_0x135496[_0x6498ce(0x200)]),this[_0x6498ce(0x206)][_0x135496[_0x6498ce(0x200)]][_0x6498ce(0x1f5)]===0x1&&(_0x337c71=0x1));}}return{'answer':_0x5c97eb['join']('\x0a'),'isAIReplyEnabled':_0x337c71};}async[_0xaaa724(0x205)](_0x3af650){const _0x31081c=_0xaaa724,{page:page=0x1,size:size=0xa,prompt:_0x37f31a,status:_0x31208f}=_0x3af650,_0x9a608e={};[0x0,0x1,'0','1'][_0x31081c(0x222)](_0x31208f)&&(_0x9a608e[_0x31081c(0x1ef)]=_0x31208f),_0x37f31a&&(_0x9a608e[_0x31081c(0x200)]=(0x0,typeorm_2[_0x31081c(0x1fb)])('%'+_0x37f31a+'%'));const [_0x2d4235,_0x13d26c]=await this['autoReplyEntity'][_0x31081c(0x1fa)]({'where':_0x9a608e,'skip':(page-0x1)*size,'take':size,'order':{'id':_0x31081c(0x1f1)}});return{'rows':_0x2d4235,'count':_0x13d26c};}async['addAutoreply'](_0x3cd5fd){const _0x3a579a=_0xaaa724;return await this['autoReplyEntity']['save'](_0x3cd5fd),await this[_0x3a579a(0x217)](),_0x3a579a(0x21c);}async[_0xaaa724(0x20a)](_0x302cf5){const _0x341514=_0xaaa724,{id:_0xa6d80f}=_0x302cf5,_0x390fa8=await this[_0x341514(0x21b)][_0x341514(0x224)]({'id':_0xa6d80f},_0x302cf5);if(_0x390fa8['affected']>0x0)return await this[_0x341514(0x217)](),'更新问题成功';throw new common_1['HttpException'](_0x341514(0x20b),common_1['HttpStatus'][_0x341514(0x1fc)]);}async[_0xaaa724(0x208)](_0x29caf9){const _0x3a6554=_0xaaa724,{id:_0x223ae9}=_0x29caf9,_0x4c4291=await this[_0x3a6554(0x21b)]['findOne']({'where':{'id':_0x223ae9}});if(!_0x4c4291)throw new common_1[(_0x3a6554(0x223))]('该问题不存在,请检查您的提交信息',common_1[_0x3a6554(0x1ed)]['BAD_REQUEST']);const _0x3c265a=await this['autoReplyEntity'][_0x3a6554(0x226)]({'id':_0x223ae9});if(_0x3c265a['affected']>0x0)return await this[_0x3a6554(0x217)](),'删除问题成功';throw new common_1[(_0x3a6554(0x223))](_0x3a6554(0x1fe),common_1[_0x3a6554(0x1ed)][_0x3a6554(0x1fc)]);}};function _0x5632(_0x2c97f4,_0x4cc96f){const _0x27f778=_0x27f7();return _0x5632=function(_0x563230,_0x47f264){_0x563230=_0x563230-0x1eb;let _0x262f3e=_0x27f778[_0x563230];return _0x262f3e;},_0x5632(_0x2c97f4,_0x4cc96f);}function _0x27f7(){const _0x3944be=['answer','some','loadAutoReplyList','./autoreply.entity','AutoReplyEntity','AutoreplyService','autoReplyEntity','添加问题成功！','85172LilmiU','@nestjs/typeorm','autoReplyKes','7336ZgzkPE','onModuleInit','includes','HttpException','update','decorate','delete','Repository','getOwnPropertyDescriptor','defineProperty','78464MJcEtP','has','HttpStatus','object','status','__metadata','DESC','__decorate','@nestjs/common','__param','isAIReplyEnabled','1457190hodMlN','147CKJDoa','__esModule','6420WOYdjV','findAndCount','Like','BAD_REQUEST','InjectRepository','删除失败','77596SDxRnb','prompt','858nDdKUQ','split','function','add','queryAutoreply','autoReplyMap','design:paramtypes','delAutoreply','filter','updateAutoreply','更新失败','typeorm','6690kIyZBN','2805gBodVL','Injectable','15WdNGcU','autoReplyFuzzyMatch','keywords','push','metadata'];_0x27f7=function(){return _0x3944be;};return _0x27f7();}AutoreplyService=__decorate([(0x0,common_1[_0xaaa724(0x20f)])(),__param(0x0,(0x0,typeorm_1[_0xaaa724(0x1fd)])(autoreply_entity_1[_0xaaa724(0x219)])),__metadata(_0xaaa724(0x207),[typeorm_2[_0xaaa724(0x227)]])],AutoreplyService),exports[_0xaaa724(0x21a)]=AutoreplyService;