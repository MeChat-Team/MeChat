'use strict';const _0x2bf9e3=_0x3b7e;function _0x3b7e(_0x5cca96,_0x49ed28){const _0x4aff24=_0x4aff();return _0x3b7e=function(_0x3b7e99,_0x10b50c){_0x3b7e99=_0x3b7e99-0x144;let _0x1e6bc6=_0x4aff24[_0x3b7e99];return _0x1e6bc6;},_0x3b7e(_0x5cca96,_0x49ed28);}(function(_0x41e7c6,_0x29ba71){const _0x39fe43=_0x3b7e,_0x5b29d4=_0x41e7c6();while(!![]){try{const _0x173752=-parseInt(_0x39fe43(0x16f))/0x1*(parseInt(_0x39fe43(0x14e))/0x2)+parseInt(_0x39fe43(0x166))/0x3+-parseInt(_0x39fe43(0x170))/0x4*(parseInt(_0x39fe43(0x16d))/0x5)+parseInt(_0x39fe43(0x145))/0x6+-parseInt(_0x39fe43(0x167))/0x7*(-parseInt(_0x39fe43(0x17f))/0x8)+-parseInt(_0x39fe43(0x165))/0x9+parseInt(_0x39fe43(0x14a))/0xa*(parseInt(_0x39fe43(0x147))/0xb);if(_0x173752===_0x29ba71)break;else _0x5b29d4['push'](_0x5b29d4['shift']());}catch(_0xe2130c){_0x5b29d4['push'](_0x5b29d4['shift']());}}}(_0x4aff,0x983b1));var __decorate=this&&this['__decorate']||function(_0x2b6c10,_0xf1e325,_0x47cdcf,_0x17c860){const _0x33cbaf=_0x3b7e;var _0x538dc8=arguments['length'],_0x36d651=_0x538dc8<0x3?_0xf1e325:_0x17c860===null?_0x17c860=Object[_0x33cbaf(0x17c)](_0xf1e325,_0x47cdcf):_0x17c860,_0x2a5c85;if(typeof Reflect===_0x33cbaf(0x14d)&&typeof Reflect['decorate']===_0x33cbaf(0x17b))_0x36d651=Reflect[_0x33cbaf(0x179)](_0x2b6c10,_0xf1e325,_0x47cdcf,_0x17c860);else{for(var _0x103187=_0x2b6c10[_0x33cbaf(0x14b)]-0x1;_0x103187>=0x0;_0x103187--)if(_0x2a5c85=_0x2b6c10[_0x103187])_0x36d651=(_0x538dc8<0x3?_0x2a5c85(_0x36d651):_0x538dc8>0x3?_0x2a5c85(_0xf1e325,_0x47cdcf,_0x36d651):_0x2a5c85(_0xf1e325,_0x47cdcf))||_0x36d651;}return _0x538dc8>0x3&&_0x36d651&&Object['defineProperty'](_0xf1e325,_0x47cdcf,_0x36d651),_0x36d651;},__metadata=this&&this[_0x2bf9e3(0x17e)]||function(_0x420a13,_0x2012ae){const _0x6b7015=_0x2bf9e3;if(typeof Reflect===_0x6b7015(0x14d)&&typeof Reflect[_0x6b7015(0x187)]===_0x6b7015(0x17b))return Reflect['metadata'](_0x420a13,_0x2012ae);},__param=this&&this['__param']||function(_0x14c2fe,_0x29263e){return function(_0x2deaa3,_0x39e1aa){_0x29263e(_0x2deaa3,_0x39e1aa,_0x14c2fe);};};function _0x4aff(){const _0x715a39=['HttpException','checkAutoReply','更新失败','AutoReplyEntity','metadata','./autoreply.entity','5911350hlARAI','删除失败','319DOusSo','Repository','loadAutoReplyList','436530OrMHhL','length','includes','object','56370RjNuwV','delete','answer','add','keywords','autoReplyEntity','AutoreplyService','save','DESC','status','InjectRepository','autoReplyKes','has','autoReplyFuzzyMatch','defineProperty','delAutoreply','onModuleInit','findAndCount','isAIReplyEnabled','autoReplyMap','__esModule','findOne','BAD_REQUEST','7610436RaiKES','3141657mVlmFs','7lLrTyJ','trim','HttpStatus','forEach','affected','queryAutoreply','35NjqOHs','filter','39VpFenM','575492ZYLBBb','Like','addAutoreply','push','updateAutoreply','prompt','更新问题成功','some','update','decorate','split','function','getOwnPropertyDescriptor','添加问题成功！','__metadata','2216688QUuEEK','design:paramtypes','join','find'];_0x4aff=function(){return _0x715a39;};return _0x4aff();}Object[_0x2bf9e3(0x15c)](exports,_0x2bf9e3(0x162),{'value':!![]}),exports['AutoreplyService']=void 0x0;const common_1=require('@nestjs/common'),typeorm_1=require('@nestjs/typeorm'),typeorm_2=require('typeorm'),autoreply_entity_1=require(_0x2bf9e3(0x144));let AutoreplyService=class AutoreplyService{constructor(_0x4b5afd){const _0x12ba16=_0x2bf9e3;this[_0x12ba16(0x153)]=_0x4b5afd,this[_0x12ba16(0x159)]=[],this[_0x12ba16(0x161)]={},this[_0x12ba16(0x15b)]=!![];}async[_0x2bf9e3(0x15e)](){const _0x9a35aa=_0x2bf9e3;await this[_0x9a35aa(0x149)]();}async['loadAutoReplyList'](){const _0x3eaf2f=_0x2bf9e3,_0x35e8fe=await this[_0x3eaf2f(0x153)][_0x3eaf2f(0x182)]({'where':{'status':0x1},'select':[_0x3eaf2f(0x175),_0x3eaf2f(0x150),_0x3eaf2f(0x160)]});this['autoReplyMap']={},this[_0x3eaf2f(0x159)]=[],_0x35e8fe[_0x3eaf2f(0x16a)](_0x59b871=>{const _0x431e40=_0x3eaf2f;this[_0x431e40(0x161)][_0x59b871[_0x431e40(0x175)]]={'answer':_0x59b871['answer'],'isAIReplyEnabled':_0x59b871[_0x431e40(0x160)]};const _0x1018cf=_0x59b871['prompt'][_0x431e40(0x17a)]('\x20')['map'](_0x4ce54d=>_0x4ce54d[_0x431e40(0x168)]());this[_0x431e40(0x159)][_0x431e40(0x173)]({'prompt':_0x59b871[_0x431e40(0x175)],'keywords':_0x1018cf});});}async[_0x2bf9e3(0x184)](_0x1028df){const _0x5a2b21=_0x2bf9e3;let _0x5c7bb6=[],_0xa9f791=0x0;const _0x3985b6=new Set();if(this[_0x5a2b21(0x15b)])for(const _0x446735 of this[_0x5a2b21(0x159)]){_0x446735[_0x5a2b21(0x152)][_0x5a2b21(0x177)](_0x228be0=>_0x1028df[_0x5a2b21(0x14c)](_0x228be0))&&(!_0x3985b6[_0x5a2b21(0x15a)](_0x446735[_0x5a2b21(0x175)])&&(_0x5c7bb6[_0x5a2b21(0x173)](this[_0x5a2b21(0x161)][_0x446735['prompt']]['answer']),_0x3985b6[_0x5a2b21(0x151)](_0x446735[_0x5a2b21(0x175)]),this[_0x5a2b21(0x161)][_0x446735['prompt']][_0x5a2b21(0x160)]===0x1&&(_0xa9f791=0x1)));}else{const _0x2baa9c=this[_0x5a2b21(0x159)][_0x5a2b21(0x16e)](_0x3718f6=>_0x3718f6[_0x5a2b21(0x175)]===_0x1028df);for(const _0x9448ad of _0x2baa9c){!_0x3985b6[_0x5a2b21(0x15a)](_0x9448ad[_0x5a2b21(0x175)])&&(_0x5c7bb6[_0x5a2b21(0x173)](this[_0x5a2b21(0x161)][_0x9448ad[_0x5a2b21(0x175)]][_0x5a2b21(0x150)]),_0x3985b6[_0x5a2b21(0x151)](_0x9448ad[_0x5a2b21(0x175)]),this[_0x5a2b21(0x161)][_0x9448ad['prompt']]['isAIReplyEnabled']===0x1&&(_0xa9f791=0x1));}}return{'answer':_0x5c7bb6[_0x5a2b21(0x181)]('\x0a'),'isAIReplyEnabled':_0xa9f791};}async[_0x2bf9e3(0x16c)](_0x50d25c){const _0xb4700c=_0x2bf9e3,{page:page=0x1,size:size=0xa,prompt:_0x50d30f,status:_0x133416}=_0x50d25c,_0x4e1462={};[0x0,0x1,'0','1'][_0xb4700c(0x14c)](_0x133416)&&(_0x4e1462[_0xb4700c(0x157)]=_0x133416),_0x50d30f&&(_0x4e1462[_0xb4700c(0x175)]=(0x0,typeorm_2[_0xb4700c(0x171)])('%'+_0x50d30f+'%'));const [_0x5a77ec,_0x3d4dee]=await this[_0xb4700c(0x153)][_0xb4700c(0x15f)]({'where':_0x4e1462,'skip':(page-0x1)*size,'take':size,'order':{'id':_0xb4700c(0x156)}});return{'rows':_0x5a77ec,'count':_0x3d4dee};}async[_0x2bf9e3(0x172)](_0x5de4b7){const _0x6462f6=_0x2bf9e3;return await this[_0x6462f6(0x153)][_0x6462f6(0x155)](_0x5de4b7),await this[_0x6462f6(0x149)](),_0x6462f6(0x17d);}async[_0x2bf9e3(0x174)](_0x44c0b3){const _0x1202fb=_0x2bf9e3,{id:_0x198c66}=_0x44c0b3,_0x67a489=await this[_0x1202fb(0x153)][_0x1202fb(0x178)]({'id':_0x198c66},_0x44c0b3);if(_0x67a489[_0x1202fb(0x16b)]>0x0)return await this[_0x1202fb(0x149)](),_0x1202fb(0x176);throw new common_1[(_0x1202fb(0x183))](_0x1202fb(0x185),common_1[_0x1202fb(0x169)][_0x1202fb(0x164)]);}async[_0x2bf9e3(0x15d)](_0x20d049){const _0x87c283=_0x2bf9e3,{id:_0x5d9068}=_0x20d049,_0x120607=await this[_0x87c283(0x153)][_0x87c283(0x163)]({'where':{'id':_0x5d9068}});if(!_0x120607)throw new common_1[(_0x87c283(0x183))]('该问题不存在,请检查您的提交信息',common_1[_0x87c283(0x169)][_0x87c283(0x164)]);const _0x4968f3=await this[_0x87c283(0x153)][_0x87c283(0x14f)]({'id':_0x5d9068});if(_0x4968f3[_0x87c283(0x16b)]>0x0)return await this[_0x87c283(0x149)](),'删除问题成功';throw new common_1[(_0x87c283(0x183))](_0x87c283(0x146),common_1[_0x87c283(0x169)][_0x87c283(0x164)]);}};AutoreplyService=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,typeorm_1[_0x2bf9e3(0x158)])(autoreply_entity_1[_0x2bf9e3(0x186)])),__metadata(_0x2bf9e3(0x180),[typeorm_2[_0x2bf9e3(0x148)]])],AutoreplyService),exports[_0x2bf9e3(0x154)]=AutoreplyService;