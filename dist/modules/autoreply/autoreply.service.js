'use strict';const _0x305d3e=_0x22f4;(function(_0x3ac80e,_0x3b5e74){const _0x4da028=_0x22f4,_0x486162=_0x3ac80e();while(!![]){try{const _0x2ac25e=-parseInt(_0x4da028(0xcf))/0x1+-parseInt(_0x4da028(0xef))/0x2+parseInt(_0x4da028(0xe9))/0x3+-parseInt(_0x4da028(0xd1))/0x4+-parseInt(_0x4da028(0xd3))/0x5+parseInt(_0x4da028(0xdb))/0x6+-parseInt(_0x4da028(0xd2))/0x7*(-parseInt(_0x4da028(0xbf))/0x8);if(_0x2ac25e===_0x3b5e74)break;else _0x486162['push'](_0x486162['shift']());}catch(_0x497b4a){_0x486162['push'](_0x486162['shift']());}}}(_0x230f,0x4cfb0));var __decorate=this&&this[_0x305d3e(0xca)]||function(_0x337f0b,_0x2ec927,_0x47294b,_0x71d614){const _0x4dd29f=_0x305d3e;var _0x5b4a98=arguments['length'],_0x5ab1bf=_0x5b4a98<0x3?_0x2ec927:_0x71d614===null?_0x71d614=Object[_0x4dd29f(0xe6)](_0x2ec927,_0x47294b):_0x71d614,_0x177b86;if(typeof Reflect===_0x4dd29f(0xce)&&typeof Reflect[_0x4dd29f(0xc4)]===_0x4dd29f(0xb9))_0x5ab1bf=Reflect[_0x4dd29f(0xc4)](_0x337f0b,_0x2ec927,_0x47294b,_0x71d614);else{for(var _0x4cef58=_0x337f0b[_0x4dd29f(0xcd)]-0x1;_0x4cef58>=0x0;_0x4cef58--)if(_0x177b86=_0x337f0b[_0x4cef58])_0x5ab1bf=(_0x5b4a98<0x3?_0x177b86(_0x5ab1bf):_0x5b4a98>0x3?_0x177b86(_0x2ec927,_0x47294b,_0x5ab1bf):_0x177b86(_0x2ec927,_0x47294b))||_0x5ab1bf;}return _0x5b4a98>0x3&&_0x5ab1bf&&Object[_0x4dd29f(0xe0)](_0x2ec927,_0x47294b,_0x5ab1bf),_0x5ab1bf;},__metadata=this&&this[_0x305d3e(0xd5)]||function(_0x655895,_0x25bf1d){const _0x455155=_0x305d3e;if(typeof Reflect===_0x455155(0xce)&&typeof Reflect['metadata']==='function')return Reflect[_0x455155(0xc2)](_0x655895,_0x25bf1d);},__param=this&&this[_0x305d3e(0xed)]||function(_0x57648d,_0x144697){return function(_0x5a4776,_0x105993){_0x144697(_0x5a4776,_0x105993,_0x57648d);};};function _0x230f(){const _0x52b75f=['@nestjs/typeorm','answer','80kxjLaD','该问题不存在,请检查您的提交信息','design:paramtypes','metadata','onModuleInit','decorate','add','prompt','push','Injectable','isAIReplyEnabled','__decorate','save','some','length','object','488946OghbKW','delete','1182696kcLLVM','998984lDnpeS','884645jxKXHB','queryAutoreply','__metadata','@nestjs/common','__esModule','autoReplyMap','forEach','Repository','1300146GYntBN','split','keywords','findOne','AutoreplyService','defineProperty','join','has','status','loadAutoReplyList','typeorm','getOwnPropertyDescriptor','删除问题成功','HttpException','505137QzUpUQ','添加问题成功！','delAutoreply','updateAutoreply','__param','autoReplyFuzzyMatch','1070658CKRfdv','更新问题成功','autoReplyKes','trim','./autoreply.entity','function','findAndCount','autoReplyEntity','map'];_0x230f=function(){return _0x52b75f;};return _0x230f();}Object[_0x305d3e(0xe0)](exports,_0x305d3e(0xd7),{'value':!![]}),exports[_0x305d3e(0xdf)]=void 0x0;function _0x22f4(_0x75e0aa,_0x4aff81){const _0x230fcb=_0x230f();return _0x22f4=function(_0x22f42d,_0x746e46){_0x22f42d=_0x22f42d-0xb7;let _0x1d9d30=_0x230fcb[_0x22f42d];return _0x1d9d30;},_0x22f4(_0x75e0aa,_0x4aff81);}const common_1=require(_0x305d3e(0xd6)),typeorm_1=require(_0x305d3e(0xbd)),typeorm_2=require(_0x305d3e(0xe5)),autoreply_entity_1=require(_0x305d3e(0xb8));let AutoreplyService=class AutoreplyService{constructor(_0x506d87){const _0x286519=_0x305d3e;this['autoReplyEntity']=_0x506d87,this['autoReplyKes']=[],this['autoReplyMap']={},this[_0x286519(0xee)]=!![];}async[_0x305d3e(0xc3)](){const _0x50177b=_0x305d3e;await this[_0x50177b(0xe4)]();}async[_0x305d3e(0xe4)](){const _0x3f9ea9=_0x305d3e,_0x5a5ef0=await this[_0x3f9ea9(0xbb)]['find']({'where':{'status':0x1},'select':[_0x3f9ea9(0xc6),'answer',_0x3f9ea9(0xc9)]});this[_0x3f9ea9(0xd8)]={},this[_0x3f9ea9(0xf1)]=[],_0x5a5ef0[_0x3f9ea9(0xd9)](_0xb6ccac=>{const _0x385c8a=_0x3f9ea9;this[_0x385c8a(0xd8)][_0xb6ccac[_0x385c8a(0xc6)]]={'answer':_0xb6ccac['answer'],'isAIReplyEnabled':_0xb6ccac[_0x385c8a(0xc9)]};const _0x480c68=_0xb6ccac[_0x385c8a(0xc6)][_0x385c8a(0xdc)]('\x20')[_0x385c8a(0xbc)](_0x5df234=>_0x5df234[_0x385c8a(0xb7)]());this[_0x385c8a(0xf1)][_0x385c8a(0xc7)]({'prompt':_0xb6ccac[_0x385c8a(0xc6)],'keywords':_0x480c68});});}async['checkAutoReply'](_0x2ca299){const _0x1d7e8d=_0x305d3e;let _0xd763c=[],_0x35df37=0x0;const _0x16319c=new Set();if(this[_0x1d7e8d(0xee)])for(const _0x32783e of this[_0x1d7e8d(0xf1)]){_0x32783e[_0x1d7e8d(0xdd)][_0x1d7e8d(0xcc)](_0x127430=>_0x2ca299['includes'](_0x127430))&&(!_0x16319c[_0x1d7e8d(0xe2)](_0x32783e['prompt'])&&(_0xd763c['push'](this[_0x1d7e8d(0xd8)][_0x32783e[_0x1d7e8d(0xc6)]]['answer']),_0x16319c['add'](_0x32783e[_0x1d7e8d(0xc6)]),this[_0x1d7e8d(0xd8)][_0x32783e[_0x1d7e8d(0xc6)]][_0x1d7e8d(0xc9)]===0x1&&(_0x35df37=0x1)));}else{const _0x2fc107=this[_0x1d7e8d(0xf1)]['filter'](_0x1a7f7c=>_0x1a7f7c['prompt']===_0x2ca299);for(const _0x3f26be of _0x2fc107){!_0x16319c[_0x1d7e8d(0xe2)](_0x3f26be[_0x1d7e8d(0xc6)])&&(_0xd763c[_0x1d7e8d(0xc7)](this[_0x1d7e8d(0xd8)][_0x3f26be[_0x1d7e8d(0xc6)]][_0x1d7e8d(0xbe)]),_0x16319c[_0x1d7e8d(0xc5)](_0x3f26be[_0x1d7e8d(0xc6)]),this[_0x1d7e8d(0xd8)][_0x3f26be[_0x1d7e8d(0xc6)]][_0x1d7e8d(0xc9)]===0x1&&(_0x35df37=0x1));}}return{'answer':_0xd763c[_0x1d7e8d(0xe1)]('\x0a'),'isAIReplyEnabled':_0x35df37};}async[_0x305d3e(0xd4)](_0x4cbe70){const _0x71e497=_0x305d3e,{page:page=0x1,size:size=0xa,prompt:_0xff9f38,status:_0x507c2d}=_0x4cbe70,_0x219a16={};[0x0,0x1,'0','1']['includes'](_0x507c2d)&&(_0x219a16[_0x71e497(0xe3)]=_0x507c2d),_0xff9f38&&(_0x219a16['prompt']=(0x0,typeorm_2['Like'])('%'+_0xff9f38+'%'));const [_0xe81e2b,_0x42879e]=await this[_0x71e497(0xbb)][_0x71e497(0xba)]({'where':_0x219a16,'skip':(page-0x1)*size,'take':size,'order':{'id':'DESC'}});return{'rows':_0xe81e2b,'count':_0x42879e};}async['addAutoreply'](_0x246e42){const _0x346485=_0x305d3e;return await this['autoReplyEntity'][_0x346485(0xcb)](_0x246e42),await this[_0x346485(0xe4)](),_0x346485(0xea);}async[_0x305d3e(0xec)](_0x5ad56b){const _0x56531b=_0x305d3e,{id:_0x27b999}=_0x5ad56b,_0x2daf30=await this['autoReplyEntity']['update']({'id':_0x27b999},_0x5ad56b);if(_0x2daf30['affected']>0x0)return await this['loadAutoReplyList'](),_0x56531b(0xf0);throw new common_1[(_0x56531b(0xe8))]('更新失败',common_1['HttpStatus']['BAD_REQUEST']);}async[_0x305d3e(0xeb)](_0x234210){const _0x5a8537=_0x305d3e,{id:_0x3646b9}=_0x234210,_0x210a88=await this['autoReplyEntity'][_0x5a8537(0xde)]({'where':{'id':_0x3646b9}});if(!_0x210a88)throw new common_1['HttpException'](_0x5a8537(0xc0),common_1['HttpStatus']['BAD_REQUEST']);const _0x109ffa=await this[_0x5a8537(0xbb)][_0x5a8537(0xd0)]({'id':_0x3646b9});if(_0x109ffa['affected']>0x0)return await this[_0x5a8537(0xe4)](),_0x5a8537(0xe7);throw new common_1[(_0x5a8537(0xe8))]('删除失败',common_1['HttpStatus']['BAD_REQUEST']);}};AutoreplyService=__decorate([(0x0,common_1[_0x305d3e(0xc8)])(),__param(0x0,(0x0,typeorm_1['InjectRepository'])(autoreply_entity_1['AutoReplyEntity'])),__metadata(_0x305d3e(0xc1),[typeorm_2[_0x305d3e(0xda)]])],AutoreplyService),exports[_0x305d3e(0xdf)]=AutoreplyService;