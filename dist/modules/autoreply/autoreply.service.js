'use strict';const _0x8524ea=_0x86a2;(function(_0x1b3951,_0x56c949){const _0x17008f=_0x86a2,_0xed6c29=_0x1b3951();while(!![]){try{const _0x35362b=-parseInt(_0x17008f(0xbb))/0x1+-parseInt(_0x17008f(0xbf))/0x2+-parseInt(_0x17008f(0xd3))/0x3+parseInt(_0x17008f(0xc6))/0x4+-parseInt(_0x17008f(0xcc))/0x5+parseInt(_0x17008f(0xbd))/0x6*(parseInt(_0x17008f(0xd4))/0x7)+parseInt(_0x17008f(0xd0))/0x8*(parseInt(_0x17008f(0xc3))/0x9);if(_0x35362b===_0x56c949)break;else _0xed6c29['push'](_0xed6c29['shift']());}catch(_0x5d6f9b){_0xed6c29['push'](_0xed6c29['shift']());}}}(_0x409b,0x311ed));function _0x86a2(_0x1dc1c4,_0x193df2){const _0x409b9d=_0x409b();return _0x86a2=function(_0x86a210,_0x4d5a0e){_0x86a210=_0x86a210-0xa7;let _0x29e422=_0x409b9d[_0x86a210];return _0x29e422;},_0x86a2(_0x1dc1c4,_0x193df2);}var __decorate=this&&this[_0x8524ea(0xdd)]||function(_0x4064f2,_0x55fdac,_0x2dc595,_0x347c65){const _0x87a9d7=_0x8524ea;var _0x58c949=arguments[_0x87a9d7(0xb0)],_0x53b3f9=_0x58c949<0x3?_0x55fdac:_0x347c65===null?_0x347c65=Object[_0x87a9d7(0xd5)](_0x55fdac,_0x2dc595):_0x347c65,_0x54ddbe;if(typeof Reflect===_0x87a9d7(0xe4)&&typeof Reflect[_0x87a9d7(0xc5)]===_0x87a9d7(0xaa))_0x53b3f9=Reflect[_0x87a9d7(0xc5)](_0x4064f2,_0x55fdac,_0x2dc595,_0x347c65);else{for(var _0x3c5c91=_0x4064f2['length']-0x1;_0x3c5c91>=0x0;_0x3c5c91--)if(_0x54ddbe=_0x4064f2[_0x3c5c91])_0x53b3f9=(_0x58c949<0x3?_0x54ddbe(_0x53b3f9):_0x58c949>0x3?_0x54ddbe(_0x55fdac,_0x2dc595,_0x53b3f9):_0x54ddbe(_0x55fdac,_0x2dc595))||_0x53b3f9;}return _0x58c949>0x3&&_0x53b3f9&&Object[_0x87a9d7(0xbe)](_0x55fdac,_0x2dc595,_0x53b3f9),_0x53b3f9;},__metadata=this&&this[_0x8524ea(0xb9)]||function(_0x1c0fd5,_0xab2ef8){const _0x1fd9b6=_0x8524ea;if(typeof Reflect===_0x1fd9b6(0xe4)&&typeof Reflect['metadata']===_0x1fd9b6(0xaa))return Reflect['metadata'](_0x1c0fd5,_0xab2ef8);},__param=this&&this[_0x8524ea(0xb3)]||function(_0x360e1c,_0x3e7abc){return function(_0x41aa18,_0x5708b8){_0x3e7abc(_0x41aa18,_0x5708b8,_0x360e1c);};};Object[_0x8524ea(0xbe)](exports,'__esModule',{'value':!![]}),exports[_0x8524ea(0xaf)]=void 0x0;const common_1=require('@nestjs/common'),typeorm_1=require('@nestjs/typeorm'),typeorm_2=require(_0x8524ea(0xdb)),autoreply_entity_1=require(_0x8524ea(0xd1));let AutoreplyService=class AutoreplyService{constructor(_0x58dab0){const _0x1834b6=_0x8524ea;this[_0x1834b6(0xc7)]=_0x58dab0,this['autoReplyKes']=[],this[_0x1834b6(0xd7)]={},this[_0x1834b6(0xc9)]=!![];}async['onModuleInit'](){const _0x5c7d66=_0x8524ea;await this[_0x5c7d66(0xd9)]();}async['loadAutoReplyList'](){const _0x3fcaaf=_0x8524ea,_0x621334=await this[_0x3fcaaf(0xc7)][_0x3fcaaf(0xac)]({'where':{'status':0x1},'select':[_0x3fcaaf(0xad),_0x3fcaaf(0xb4),_0x3fcaaf(0xb2)]});this[_0x3fcaaf(0xd7)]={},this[_0x3fcaaf(0xde)]=[],_0x621334[_0x3fcaaf(0xbc)](_0x24b30f=>{const _0x40159f=_0x3fcaaf;this[_0x40159f(0xd7)][_0x24b30f[_0x40159f(0xad)]]={'answer':_0x24b30f[_0x40159f(0xb4)],'isAIReplyEnabled':_0x24b30f[_0x40159f(0xb2)]};const _0xd8ca69=_0x24b30f[_0x40159f(0xad)][_0x40159f(0xca)]('\x20')['map'](_0x2e9d8c=>_0x2e9d8c[_0x40159f(0xe3)]());this['autoReplyKes'][_0x40159f(0xb5)]({'prompt':_0x24b30f[_0x40159f(0xad)],'keywords':_0xd8ca69});});}async['checkAutoReply'](_0x294f44){const _0x1ec581=_0x8524ea;let _0x178dcf=[],_0x1c8979=0x0;const _0x16162d=new Set();if(this['autoReplyFuzzyMatch'])for(const _0x22e319 of this[_0x1ec581(0xde)]){_0x22e319[_0x1ec581(0xcd)]['some'](_0x26cd03=>_0x294f44[_0x1ec581(0xb1)](_0x26cd03))&&(!_0x16162d[_0x1ec581(0xc8)](_0x22e319[_0x1ec581(0xad)])&&(_0x178dcf[_0x1ec581(0xb5)](this[_0x1ec581(0xd7)][_0x22e319[_0x1ec581(0xad)]][_0x1ec581(0xb4)]),_0x16162d[_0x1ec581(0xe0)](_0x22e319[_0x1ec581(0xad)]),this[_0x1ec581(0xd7)][_0x22e319[_0x1ec581(0xad)]][_0x1ec581(0xb2)]===0x1&&(_0x1c8979=0x1)));}else{const _0x1ded23=this[_0x1ec581(0xde)]['filter'](_0x19c91b=>_0x19c91b[_0x1ec581(0xad)]===_0x294f44);for(const _0x44ded2 of _0x1ded23){!_0x16162d[_0x1ec581(0xc8)](_0x44ded2[_0x1ec581(0xad)])&&(_0x178dcf[_0x1ec581(0xb5)](this['autoReplyMap'][_0x44ded2[_0x1ec581(0xad)]][_0x1ec581(0xb4)]),_0x16162d[_0x1ec581(0xe0)](_0x44ded2[_0x1ec581(0xad)]),this[_0x1ec581(0xd7)][_0x44ded2[_0x1ec581(0xad)]]['isAIReplyEnabled']===0x1&&(_0x1c8979=0x1));}}return{'answer':_0x178dcf[_0x1ec581(0xe2)]('\x0a'),'isAIReplyEnabled':_0x1c8979};}async['queryAutoreply'](_0x1af91e){const _0x5acdd6=_0x8524ea,{page:page=0x1,size:size=0xa,prompt:_0x1cdebb,status:_0x1b8e15}=_0x1af91e,_0x3c33e4={};[0x0,0x1,'0','1'][_0x5acdd6(0xb1)](_0x1b8e15)&&(_0x3c33e4[_0x5acdd6(0xcf)]=_0x1b8e15),_0x1cdebb&&(_0x3c33e4[_0x5acdd6(0xad)]=(0x0,typeorm_2[_0x5acdd6(0xb6)])('%'+_0x1cdebb+'%'));const [_0x300554,_0x1d3e07]=await this[_0x5acdd6(0xc7)][_0x5acdd6(0xc0)]({'where':_0x3c33e4,'skip':(page-0x1)*size,'take':size,'order':{'id':_0x5acdd6(0xcb)}});return{'rows':_0x300554,'count':_0x1d3e07};}async['addAutoreply'](_0x46d253){const _0x2dabc9=_0x8524ea;return await this['autoReplyEntity'][_0x2dabc9(0xa8)](_0x46d253),await this['loadAutoReplyList'](),_0x2dabc9(0xdc);}async[_0x8524ea(0xda)](_0x3344d2){const _0x39700b=_0x8524ea,{id:_0x47d8dc}=_0x3344d2,_0x3957ed=await this['autoReplyEntity'][_0x39700b(0xd6)]({'id':_0x47d8dc},_0x3344d2);if(_0x3957ed[_0x39700b(0xc2)]>0x0)return await this[_0x39700b(0xd9)](),_0x39700b(0xce);throw new common_1['HttpException'](_0x39700b(0xe1),common_1[_0x39700b(0xdf)][_0x39700b(0xae)]);}async['delAutoreply'](_0x28c476){const _0x3d7809=_0x8524ea,{id:_0x1218b0}=_0x28c476,_0x27ca16=await this[_0x3d7809(0xc7)][_0x3d7809(0xb8)]({'where':{'id':_0x1218b0}});if(!_0x27ca16)throw new common_1[(_0x3d7809(0xab))]('该问题不存在,请检查您的提交信息',common_1[_0x3d7809(0xdf)][_0x3d7809(0xae)]);const _0x3ee424=await this[_0x3d7809(0xc7)][_0x3d7809(0xc1)]({'id':_0x1218b0});if(_0x3ee424[_0x3d7809(0xc2)]>0x0)return await this[_0x3d7809(0xd9)](),_0x3d7809(0xa7);throw new common_1[(_0x3d7809(0xab))](_0x3d7809(0xd8),common_1[_0x3d7809(0xdf)][_0x3d7809(0xae)]);}};function _0x409b(){const _0x48d2ad=['findAndCount','delete','affected','261EIPqJc','Injectable','decorate','1495560ofdEHe','autoReplyEntity','has','autoReplyFuzzyMatch','split','DESC','1021530MlxcYq','keywords','更新问题成功','status','139816tVmVmA','./autoreply.entity','Repository','508692kEjKLG','63469lLpbEy','getOwnPropertyDescriptor','update','autoReplyMap','删除失败','loadAutoReplyList','updateAutoreply','typeorm','添加问题成功！','__decorate','autoReplyKes','HttpStatus','add','更新失败','join','trim','object','删除问题成功','save','design:paramtypes','function','HttpException','find','prompt','BAD_REQUEST','AutoreplyService','length','includes','isAIReplyEnabled','__param','answer','push','Like','AutoReplyEntity','findOne','__metadata','InjectRepository','357937XaAVpr','forEach','258zpKgkM','defineProperty','675200KvJdgh'];_0x409b=function(){return _0x48d2ad;};return _0x409b();}AutoreplyService=__decorate([(0x0,common_1[_0x8524ea(0xc4)])(),__param(0x0,(0x0,typeorm_1[_0x8524ea(0xba)])(autoreply_entity_1[_0x8524ea(0xb7)])),__metadata(_0x8524ea(0xa9),[typeorm_2[_0x8524ea(0xd2)]])],AutoreplyService),exports[_0x8524ea(0xaf)]=AutoreplyService;