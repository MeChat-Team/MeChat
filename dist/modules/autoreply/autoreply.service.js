'use strict';const _0x5d8114=_0x3b2a;(function(_0x2c02de,_0x2921db){const _0x165384=_0x3b2a,_0x4f4fc9=_0x2c02de();while(!![]){try{const _0x3d1d7c=-parseInt(_0x165384(0x95))/0x1*(parseInt(_0x165384(0x72))/0x2)+-parseInt(_0x165384(0x92))/0x3+parseInt(_0x165384(0x8d))/0x4*(parseInt(_0x165384(0x76))/0x5)+parseInt(_0x165384(0x80))/0x6+parseInt(_0x165384(0x9e))/0x7*(-parseInt(_0x165384(0x78))/0x8)+parseInt(_0x165384(0xa2))/0x9+parseInt(_0x165384(0x84))/0xa*(-parseInt(_0x165384(0xac))/0xb);if(_0x3d1d7c===_0x2921db)break;else _0x4f4fc9['push'](_0x4f4fc9['shift']());}catch(_0xa798b7){_0x4f4fc9['push'](_0x4f4fc9['shift']());}}}(_0x1b8a,0x503e6));function _0x1b8a(){const _0x564c72=['Injectable','metadata','design:paramtypes','HttpStatus','2899860FdRhzF','AutoReplyEntity','@nestjs/typeorm','更新失败','818210MHyfyG','split','HttpException','__decorate','answer','addAutoreply','删除问题成功','findOne','BAD_REQUEST','679828QCCAjm','delAutoreply','defineProperty','push','update','655902BBGjTu','autoReplyMap','添加问题成功！','251399gjoEFP','has','Repository','typeorm','prompt','affected','__metadata','DESC','add','252wQVLkK','delete','decorate','some','5107968tEFMFq','AutoreplyService','autoReplyKes','filter','length','findAndCount','getOwnPropertyDescriptor','object','loadAutoReplyList','map','44QCteDa','status','autoReplyEntity','join','autoReplyFuzzyMatch','isAIReplyEnabled','更新问题成功','2DrMegm','function','includes','Like','5DWaHHX','删除失败','21072IltPBo','updateAutoreply','该问题不存在,请检查您的提交信息','find'];_0x1b8a=function(){return _0x564c72;};return _0x1b8a();}function _0x3b2a(_0xb934a6,_0x54a583){const _0x1b8afe=_0x1b8a();return _0x3b2a=function(_0x3b2a5b,_0x2a909d){_0x3b2a5b=_0x3b2a5b-0x70;let _0xd72270=_0x1b8afe[_0x3b2a5b];return _0xd72270;},_0x3b2a(_0xb934a6,_0x54a583);}var __decorate=this&&this[_0x5d8114(0x87)]||function(_0xdaec79,_0x19a31a,_0x4bbde2,_0x3a76aa){const _0x2d834e=_0x5d8114;var _0x14d196=arguments[_0x2d834e(0xa6)],_0x214cfe=_0x14d196<0x3?_0x19a31a:_0x3a76aa===null?_0x3a76aa=Object[_0x2d834e(0xa8)](_0x19a31a,_0x4bbde2):_0x3a76aa,_0x3f753e;if(typeof Reflect===_0x2d834e(0xa9)&&typeof Reflect['decorate']===_0x2d834e(0x73))_0x214cfe=Reflect[_0x2d834e(0xa0)](_0xdaec79,_0x19a31a,_0x4bbde2,_0x3a76aa);else{for(var _0x555353=_0xdaec79[_0x2d834e(0xa6)]-0x1;_0x555353>=0x0;_0x555353--)if(_0x3f753e=_0xdaec79[_0x555353])_0x214cfe=(_0x14d196<0x3?_0x3f753e(_0x214cfe):_0x14d196>0x3?_0x3f753e(_0x19a31a,_0x4bbde2,_0x214cfe):_0x3f753e(_0x19a31a,_0x4bbde2))||_0x214cfe;}return _0x14d196>0x3&&_0x214cfe&&Object[_0x2d834e(0x8f)](_0x19a31a,_0x4bbde2,_0x214cfe),_0x214cfe;},__metadata=this&&this[_0x5d8114(0x9b)]||function(_0x45c5a1,_0x1ec658){const _0x306149=_0x5d8114;if(typeof Reflect==='object'&&typeof Reflect[_0x306149(0x7d)]===_0x306149(0x73))return Reflect[_0x306149(0x7d)](_0x45c5a1,_0x1ec658);},__param=this&&this['__param']||function(_0x5590eb,_0x1cd7e3){return function(_0x503645,_0x2e3927){_0x1cd7e3(_0x503645,_0x2e3927,_0x5590eb);};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[_0x5d8114(0xa3)]=void 0x0;const common_1=require('@nestjs/common'),typeorm_1=require(_0x5d8114(0x82)),typeorm_2=require(_0x5d8114(0x98)),autoreply_entity_1=require('./autoreply.entity');let AutoreplyService=class AutoreplyService{constructor(_0x20c83d){const _0x242b82=_0x5d8114;this[_0x242b82(0xae)]=_0x20c83d,this[_0x242b82(0xa4)]=[],this['autoReplyMap']={},this[_0x242b82(0xb0)]=!![];}async['onModuleInit'](){const _0x349d66=_0x5d8114;await this[_0x349d66(0xaa)]();}async['loadAutoReplyList'](){const _0x5eb168=_0x5d8114,_0x23b5c5=await this['autoReplyEntity'][_0x5eb168(0x7b)]({'where':{'status':0x1},'select':[_0x5eb168(0x99),_0x5eb168(0x88),_0x5eb168(0x70)]});this[_0x5eb168(0x93)]={},this['autoReplyKes']=[],_0x23b5c5['forEach'](_0x2df4e2=>{const _0x2314ff=_0x5eb168;this['autoReplyMap'][_0x2df4e2[_0x2314ff(0x99)]]={'answer':_0x2df4e2[_0x2314ff(0x88)],'isAIReplyEnabled':_0x2df4e2['isAIReplyEnabled']};const _0x23fce4=_0x2df4e2[_0x2314ff(0x99)][_0x2314ff(0x85)]('\x20')[_0x2314ff(0xab)](_0x4247f3=>_0x4247f3['trim']());this[_0x2314ff(0xa4)][_0x2314ff(0x90)]({'prompt':_0x2df4e2['prompt'],'keywords':_0x23fce4});});}async['checkAutoReply'](_0x1d3135){const _0x16e7fe=_0x5d8114;let _0x16fc7b=[],_0x23b53a=0x0;const _0x511614=new Set();if(this[_0x16e7fe(0xb0)])for(const _0x5ec0bc of this[_0x16e7fe(0xa4)]){_0x5ec0bc['keywords'][_0x16e7fe(0xa1)](_0x186e6b=>_0x1d3135[_0x16e7fe(0x74)](_0x186e6b))&&(!_0x511614['has'](_0x5ec0bc['prompt'])&&(_0x16fc7b[_0x16e7fe(0x90)](this['autoReplyMap'][_0x5ec0bc[_0x16e7fe(0x99)]][_0x16e7fe(0x88)]),_0x511614[_0x16e7fe(0x9d)](_0x5ec0bc[_0x16e7fe(0x99)]),this[_0x16e7fe(0x93)][_0x5ec0bc[_0x16e7fe(0x99)]][_0x16e7fe(0x70)]===0x1&&(_0x23b53a=0x1)));}else{const _0x1ff39b=this['autoReplyKes'][_0x16e7fe(0xa5)](_0x2bb9d3=>_0x2bb9d3['prompt']===_0x1d3135);for(const _0x72f873 of _0x1ff39b){!_0x511614[_0x16e7fe(0x96)](_0x72f873[_0x16e7fe(0x99)])&&(_0x16fc7b[_0x16e7fe(0x90)](this[_0x16e7fe(0x93)][_0x72f873[_0x16e7fe(0x99)]]['answer']),_0x511614[_0x16e7fe(0x9d)](_0x72f873[_0x16e7fe(0x99)]),this['autoReplyMap'][_0x72f873[_0x16e7fe(0x99)]][_0x16e7fe(0x70)]===0x1&&(_0x23b53a=0x1));}}return{'answer':_0x16fc7b[_0x16e7fe(0xaf)]('\x0a'),'isAIReplyEnabled':_0x23b53a};}async['queryAutoreply'](_0x489844){const _0x1507c7=_0x5d8114,{page:page=0x1,size:size=0xa,prompt:_0x438d4b,status:_0x3c356c}=_0x489844,_0x2cdb6f={};[0x0,0x1,'0','1']['includes'](_0x3c356c)&&(_0x2cdb6f[_0x1507c7(0xad)]=_0x3c356c),_0x438d4b&&(_0x2cdb6f['prompt']=(0x0,typeorm_2[_0x1507c7(0x75)])('%'+_0x438d4b+'%'));const [_0x2b0f6e,_0x22f99e]=await this[_0x1507c7(0xae)][_0x1507c7(0xa7)]({'where':_0x2cdb6f,'skip':(page-0x1)*size,'take':size,'order':{'id':_0x1507c7(0x9c)}});return{'rows':_0x2b0f6e,'count':_0x22f99e};}async[_0x5d8114(0x89)](_0x4f6055){const _0x2c82f5=_0x5d8114;return await this[_0x2c82f5(0xae)]['save'](_0x4f6055),await this[_0x2c82f5(0xaa)](),_0x2c82f5(0x94);}async[_0x5d8114(0x79)](_0x48e3cd){const _0x3a51b0=_0x5d8114,{id:_0x157758}=_0x48e3cd,_0x55d4af=await this[_0x3a51b0(0xae)][_0x3a51b0(0x91)]({'id':_0x157758},_0x48e3cd);if(_0x55d4af['affected']>0x0)return await this['loadAutoReplyList'](),_0x3a51b0(0x71);throw new common_1[(_0x3a51b0(0x86))](_0x3a51b0(0x83),common_1[_0x3a51b0(0x7f)][_0x3a51b0(0x8c)]);}async[_0x5d8114(0x8e)](_0x21bfca){const _0x32694e=_0x5d8114,{id:_0x49e198}=_0x21bfca,_0xab566f=await this['autoReplyEntity'][_0x32694e(0x8b)]({'where':{'id':_0x49e198}});if(!_0xab566f)throw new common_1[(_0x32694e(0x86))](_0x32694e(0x7a),common_1[_0x32694e(0x7f)][_0x32694e(0x8c)]);const _0x5d0259=await this[_0x32694e(0xae)][_0x32694e(0x9f)]({'id':_0x49e198});if(_0x5d0259[_0x32694e(0x9a)]>0x0)return await this[_0x32694e(0xaa)](),_0x32694e(0x8a);throw new common_1['HttpException'](_0x32694e(0x77),common_1[_0x32694e(0x7f)]['BAD_REQUEST']);}};AutoreplyService=__decorate([(0x0,common_1[_0x5d8114(0x7c)])(),__param(0x0,(0x0,typeorm_1['InjectRepository'])(autoreply_entity_1[_0x5d8114(0x81)])),__metadata(_0x5d8114(0x7e),[typeorm_2[_0x5d8114(0x97)]])],AutoreplyService),exports['AutoreplyService']=AutoreplyService;